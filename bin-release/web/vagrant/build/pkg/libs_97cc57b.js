;/*!libs/modules/egret/egret.min.js*/
function __extends(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i}var egret;!function(t){function e(){return""}function i(t){throw new Error("#"+t)}function n(){}function r(){}function s(){}t.getString=e,t.$error=i,t.$warn=n,t.$markReadOnly=r,t.$markCannotUse=s}(egret||(egret={}));var egret;!function(t){function e(t,e,i){var n=t.prototype;n.__class__=e;var r=[e];i&&(r=r.concat(i));var s=n.__types__;if(n.__types__)for(var a=s.length,o=0;a>o;o++){var h=s[o];-1==r.indexOf(h)&&r.push(h)}n.__types__=r}t.registerClass=e}(egret||(egret={}));var __define=this.__define||function(t,e,i,n){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:i,set:n})},egret;!function(t){t.$hashCount=1;var e=function(){function e(){this.$hashCode=t.$hashCount++}var i=__define,n=e,r=n.prototype;return i(r,"hashCode",function(){return this.$hashCode}),e}();t.HashObject=e,t.registerClass(e,"egret.HashObject",["egret.IHashObject"])}(egret||(egret={}));var egret;!function(t){var e=[],i=function(i){function n(t){void 0===t&&(t=null),i.call(this),this.$EventDispatcher={0:t?t:this,1:{},2:{},3:0}}__extends(n,i);var r=n,s=r.prototype;return s.$getEventMap=function(t){var e=this.$EventDispatcher,i=t?e[2]:e[1];return i},s.addEventListener=function(t,e,i,n,r){this.$addListener(t,e,i,n,r)},s.once=function(t,e,i,n,r){this.$addListener(t,e,i,n,r,!0)},s.$addListener=function(t,e,i,n,r,s){var a=this.$EventDispatcher,o=n?a[2]:a[1],h=o[t];h?0!==a[3]&&(o[t]=h=h.concat()):h=o[t]=[],this.$insertEventBin(h,t,e,i,n,r,s)},s.$insertEventBin=function(t,e,i,n,r,s,a){s=0|+s;for(var o=-1,h=t.length,l=0;h>l;l++){var u=t[l];if(u.listener==i&&u.thisObject==n&&u.target==this)return!1;-1==o&&u.priority<s&&(o=l)}var c={type:e,listener:i,thisObject:n,priority:s,target:this,useCapture:r,dispatchOnce:!!a};return-1!==o?t.splice(o,0,c):t.push(c),!0},s.removeEventListener=function(t,e,i,n){var r=this.$EventDispatcher,s=n?r[2]:r[1],a=s[t];a&&(0!==r[3]&&(s[t]=a=a.concat()),this.$removeEventBin(a,e,i),0==a.length&&(s[t]=null))},s.$removeEventBin=function(t,e,i){for(var n=t.length,r=0;n>r;r++){var s=t[r];if(s.listener==e&&s.thisObject==i&&s.target==this)return t.splice(r,1),!0}return!1},s.hasEventListener=function(t){var e=this.$EventDispatcher;return!(!e[1][t]&&!e[2][t])},s.willTrigger=function(t){return this.hasEventListener(t)},s.dispatchEvent=function(t){return t.$currentTarget=this.$EventDispatcher[0],t.$setTarget(t.$currentTarget),this.$notifyListener(t,!1)},s.$notifyListener=function(t,i){var n=this.$EventDispatcher,r=i?n[2]:n[1],s=r[t.$type];if(!s)return!0;var a=s.length;if(0==a)return!0;var o=e;n[3]++;for(var h=0;a>h;h++){var l=s[h];if(l.listener.call(l.thisObject,t),l.dispatchOnce&&o.push(l),t.$isPropagationImmediateStopped)break}for(n[3]--;o.length;)l=o.pop(),l.target.removeEventListener(l.type,l.listener,l.thisObject,l.useCapture);return!t.$isDefaultPrevented},s.dispatchEventWith=function(e,i,n,r){if(i||this.hasEventListener(e)){var s=t.Event.create(t.Event,e,i,r);s.data=n;var a=this.dispatchEvent(s);return t.Event.release(s),a}return!0},n}(t.HashObject);t.EventDispatcher=i,t.registerClass(i,"egret.EventDispatcher",["egret.IEventDispatcher"])}(egret||(egret={}));var egret;!function(t){var e=[],i=function(i){function n(t,e,n,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),i.call(this),this.x=t,this.y=e,this.width=n,this.height=r}__extends(n,i);var r=__define,s=n,a=s.prototype;return n.release=function(t){t&&e.push(t)},n.create=function(){var t=e.pop();return t||(t=new n),t},r(a,"right",function(){return this.x+this.width},function(t){this.width=t-this.x}),r(a,"bottom",function(){return this.y+this.height},function(t){this.height=t-this.y}),r(a,"left",function(){return this.x},function(t){this.width+=this.x-t,this.x=t}),r(a,"top",function(){return this.y},function(t){this.height+=this.y-t,this.y=t}),r(a,"topLeft",function(){return new t.Point(this.left,this.top)},function(t){this.top=t.y,this.left=t.x}),r(a,"bottomRight",function(){return new t.Point(this.right,this.bottom)},function(t){this.bottom=t.y,this.right=t.x}),a.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},a.setTo=function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this},a.contains=function(t,e){return this.x<=t&&this.x+this.width>=t&&this.y<=e&&this.y+this.height>=e},a.intersection=function(t){return this.clone().$intersectInPlace(t)},a.inflate=function(t,e){this.x-=t,this.width+=2*t,this.y-=e,this.height+=2*e},a.$intersectInPlace=function(t){var e=this.x,i=this.y,n=t.x,r=t.y,s=Math.max(e,n),a=Math.min(e+this.width,n+t.width);if(a>=s){var o=Math.max(i,r),h=Math.min(i+this.height,r+t.height);if(h>=o)return this.setTo(s,o,a-s,h-o),this}return this.setEmpty(),this},a.intersects=function(t){return Math.max(this.x,t.x)<=Math.min(this.right,t.right)&&Math.max(this.y,t.y)<=Math.min(this.bottom,t.bottom)},a.isEmpty=function(){return this.width<=0||this.height<=0},a.setEmpty=function(){this.x=0,this.y=0,this.width=0,this.height=0},a.clone=function(){return new n(this.x,this.y,this.width,this.height)},a.containsPoint=function(t){return this.x<t.x&&this.x+this.width>t.x&&this.y<t.y&&this.y+this.height>t.y?!0:!1},a.containsRect=function(t){var e=t.x+t.width,i=t.y+t.height,n=this.x+this.width,r=this.y+this.height;return t.x>=this.x&&t.x<n&&t.y>=this.y&&t.y<r&&e>this.x&&n>=e&&i>this.y&&r>=i},a.equals=function(t){return this===t?!0:this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},a.inflatePoint=function(t){this.inflate(t.x,t.y)},a.offset=function(t,e){this.x+=t,this.y+=e},a.offsetPoint=function(t){this.offset(t.x,t.y)},a.toString=function(){return"(x="+this.x+", y="+this.y+", width="+this.width+", height="+this.height+")"},a.union=function(t){var e=this.clone();if(t.isEmpty())return e;if(e.isEmpty())return e.copyFrom(t),e;var i=Math.min(e.x,t.x),n=Math.min(e.y,t.y);return e.setTo(i,n,Math.max(e.right,t.right)-i,Math.max(e.bottom,t.bottom)-n),e},a.$getBaseWidth=function(t){var e=Math.abs(Math.cos(t)),i=Math.abs(Math.sin(t));return e*this.width+i*this.height},a.$getBaseHeight=function(t){var e=Math.abs(Math.cos(t)),i=Math.abs(Math.sin(t));return i*this.width+e*this.height},n}(t.HashObject);t.Rectangle=i,t.registerClass(i,"egret.Rectangle"),t.$TempRectangle=new i}(egret||(egret={}));var egret;!function(t){function e(t){return t%=360,t>180?t-=360:-180>t&&(t+=360),t}var i=function(i){function n(){i.call(this),this.$children=null,this.$parent=null,this.$stage=null,this.$nestLevel=0,this.$visible=!0,this.$displayList=null,this.$alpha=1,this.$touchEnabled=n.defaultTouchEnabled,this.$scrollRect=null,this.$blendMode=0,this.$maskedObject=null,this.$mask=null,this.$maskRect=null,this.$parentDisplayList=null,this.$renderNode=null,this.$displayFlags=2032,this.$DisplayObject={0:1,1:1,2:0,3:0,4:0,5:"",6:new t.Matrix,7:new t.Matrix,8:new t.Matrix,9:new t.Rectangle,10:new t.Rectangle,11:!1,12:0,13:0,14:0/0,15:0/0,16:0,17:0,18:0,19:null,20:null}}__extends(n,i);var r=__define,s=n,a=s.prototype;return a.$setFlags=function(t){this.$displayFlags|=t},a.$removeFlags=function(t){this.$displayFlags&=~t},a.$removeFlagsUp=function(t){if(this.$hasAnyFlags(t)){this.$removeFlags(t);var e=this.$parent;e&&e.$removeFlagsUp(t)}},a.$hasFlags=function(t){return(this.$displayFlags&t)==t},a.$propagateFlagsUp=function(t){if(!this.$hasFlags(t)){this.$setFlags(t);var e=this.$parent;e&&e.$propagateFlagsUp(t)}},a.$propagateFlagsDown=function(t){this.$setFlags(t)},a.$hasAnyFlags=function(t){return!!(this.$displayFlags&t)},a.$invalidateMatrix=function(){this.$setFlags(8),this.$invalidatePosition()},a.$invalidatePosition=function(){var t=this;t.$invalidateTransform(),t.$propagateFlagsDown(48),t.$parent&&t.$parent.$propagateFlagsUp(4)},r(a,"name",function(){return this.$DisplayObject[5]},function(t){this.$DisplayObject[5]=t}),r(a,"parent",function(){return this.$parent}),a.$setParent=function(t){return this.$parent==t?!1:(this.$parent=t,!0)},a.$onAddToStage=function(e,i){this.$stage=e,this.$nestLevel=i,this.$hasAddToStage=!0,t.Sprite.$EVENT_ADD_TO_STAGE_LIST.push(this)},a.$onRemoveFromStage=function(){this.$nestLevel=0,t.Sprite.$EVENT_REMOVE_FROM_STAGE_LIST.push(this)},r(a,"stage",function(){return this.$stage}),r(a,"matrix",function(){return this.$getMatrix().clone()},function(t){this.$setMatrix(t)}),a.$getMatrix=function(){var t=this.$DisplayObject;return this.$hasFlags(8)&&(t[6].$updateScaleAndRotation(t[0],t[1],t[2],t[3]),this.$removeFlags(8)),t[6]},a.$setMatrix=function(t,i){void 0===i&&(i=!0);var n=this,r=n.$DisplayObject,s=r[6];return s.equals(t)?!1:(s.copyFrom(t),i&&(r[0]=s.$getScaleX(),r[1]=s.$getScaleY(),r[2]=t.$getSkewX(),r[3]=t.$getSkewY(),r[16]=e(180*r[2]/Math.PI),r[17]=e(180*r[3]/Math.PI),r[4]=e(180*r[3]/Math.PI)),n.$removeFlags(8),n.$invalidatePosition(),!0)},a.$getConcatenatedMatrix=function(){var e=this.$DisplayObject[7];if(this.$hasFlags(16)){this.$parent?this.$parent.$getConcatenatedMatrix().$preMultiplyInto(this.$getMatrix(),e):e.copyFrom(this.$getMatrix());var i=this.$DisplayObject,n=i[12],r=i[13],s=this.$scrollRect;s?e.$preMultiplyInto(t.$TempMatrix.setTo(1,0,0,1,-s.x-n,-s.y-r),e):(0!=n||0!=r)&&e.$preMultiplyInto(t.$TempMatrix.setTo(1,0,0,1,-n,-r),e),this.$displayList&&(this.$displayList.$renderNode.moved=!0),this.$renderNode&&(this.$renderNode.moved=!0),this.$removeFlags(16)}return e},a.$getInvertedConcatenatedMatrix=function(){var t=this.$DisplayObject;return this.$hasFlags(32)&&(this.$getConcatenatedMatrix().$invertInto(t[8]),this.$removeFlags(32)),t[8]},r(a,"x",function(){return this.$getX()},function(t){this.$setX(t)}),a.$getX=function(){return this.$DisplayObject[6].tx},a.$setX=function(t){t=+t||0;var e=this.$DisplayObject[6];return t==e.tx?!1:(e.tx=t,this.$invalidatePosition(),!0)},r(a,"y",function(){return this.$getY()},function(t){this.$setY(t)}),a.$getY=function(){return this.$DisplayObject[6].ty},a.$setY=function(t){t=+t||0;var e=this.$DisplayObject[6];return t==e.ty?!1:(e.ty=t,this.$invalidatePosition(),!0)},r(a,"scaleX",function(){return this.$getScaleX()},function(t){this.$setScaleX(t)}),a.$getScaleX=function(){return this.$DisplayObject[0]},a.$setScaleX=function(t){t=+t||0;var e=this.$DisplayObject;return t==e[0]?!1:(e[0]=t,this.$invalidateMatrix(),!0)},r(a,"scaleY",function(){return this.$getScaleY()},function(t){this.$setScaleY(t)}),a.$getScaleY=function(){return this.$DisplayObject[1]},a.$setScaleY=function(t){return t=+t||0,t==this.$DisplayObject[1]?!1:(this.$DisplayObject[1]=t,this.$invalidateMatrix(),!0)},r(a,"rotation",function(){return this.$getRotation()},function(t){this.$setRotation(t)}),a.$getRotation=function(){return this.$DisplayObject[4]},a.$setRotation=function(t){t=+t||0,t=e(t);var i=this.$DisplayObject;if(t==i[4])return!1;var n=t-i[4],r=n/180*Math.PI;return i[2]+=r,i[3]+=r,i[4]=t,this.$invalidateMatrix(),!0},r(a,"skewX",function(){return this.$DisplayObject[16]},function(t){this.$setSkewX(t)}),a.$setSkewX=function(t){t=+t||0;var i=this.$DisplayObject;return t==i[16]?!1:(i[16]=t,t=e(t),t=t/180*Math.PI,i[2]=t,this.$invalidateMatrix(),!0)},r(a,"skewY",function(){return this.$DisplayObject[17]},function(t){this.$setSkewY(t)}),a.$setSkewY=function(t){t=+t||0;var i=this.$DisplayObject;return t==i[17]?!1:(i[17]=t,t=e(t),t=t/180*Math.PI,i[3]=t,this.$invalidateMatrix(),!0)},r(a,"width",function(){return this.$getWidth()},function(t){this.$setWidth(t)}),a.$getWidth=function(){return isNaN(this.$getExplicitWidth())?this.$getOriginalBounds().width:this.$getExplicitWidth()},a.$getExplicitWidth=function(){return this.$DisplayObject[14]},a.$setWidth=function(t){return this.$DisplayObject[14]=isNaN(t)?0/0:t,t=+t,0>t?!1:(this.$invalidateMatrix(),!0)},r(a,"height",function(){return this.$getHeight()},function(t){this.$setHeight(t)}),a.$getHeight=function(){return isNaN(this.$getExplicitHeight())?this.$getOriginalBounds().height:this.$getExplicitHeight()},a.$getExplicitHeight=function(){return this.$DisplayObject[15]},a.$setHeight=function(t){return this.$DisplayObject[15]=isNaN(t)?0/0:t,t=+t,0>t?!1:(this.$invalidateMatrix(),!0)},r(a,"measuredWidth",function(){return this.$getOriginalBounds().width}),r(a,"measuredHeight",function(){return this.$getOriginalBounds().height}),r(a,"anchorOffsetX",function(){return this.$DisplayObject[12]},function(t){this.$setAnchorOffsetX(t)}),a.$getAnchorOffsetX=function(){return this.$DisplayObject[12]},a.$setAnchorOffsetX=function(t){return t=+t||0,t==this.$DisplayObject[12]?!1:(this.$DisplayObject[12]=t,this.$invalidatePosition(),!0)},r(a,"anchorOffsetY",function(){return this.$DisplayObject[13]},function(t){this.$setAnchorOffsetY(t)}),a.$getAnchorOffsetY=function(){return this.$DisplayObject[13]},a.$setAnchorOffsetY=function(t){return t=+t||0,t==this.$DisplayObject[13]?!1:(this.$DisplayObject[13]=t,this.$invalidatePosition(),!0)},r(a,"visible",function(){return this.$visible},function(t){this.$setVisible(t)}),a.$setVisible=function(t){return t=!!t,t==this.$visible?!1:(this.$visible=t,this.$propagateFlagsDown(1024),this.$invalidateTransform(),!0)},a.$getConcatenatedVisible=function(){var t=this.$DisplayObject;if(this.$hasFlags(1024)){if(this.$parent){var e=this.$parent.$getConcatenatedVisible();t[19]=e&&this.$visible}else t[19]=this.$visible;this.$removeFlags(1024)}return t[19]},r(a,"cacheAsBitmap",function(){return this.$DisplayObject[11]},function(t){t=!!t,this.$DisplayObject[11]=t,this.$setHasDisplayList(t)}),a.$setHasDisplayList=function(e){var i=!!this.$displayList;if(i!=e)if(e){var n=t.sys.DisplayList.create(this);n&&(this.$displayList=n,this.$parentDisplayList&&this.$parentDisplayList.markDirty(n),this.$cacheAsBitmapChanged())}else this.$displayList=null,this.$cacheAsBitmapChanged()},a.$cacheAsBitmapChanged=function(){var t=this.$displayList||this.$parentDisplayList;this.$renderNode&&t&&t.markDirty(this),this.$propagateFlagsDown(48)},r(a,"alpha",function(){return this.$alpha},function(t){this.$setAlpha(t)}),a.$setAlpha=function(t){return t=+t||0,t==this.$alpha?!1:(this.$alpha=t,this.$propagateFlagsDown(64),this.$invalidate(),!0)},a.$getConcatenatedAlpha=function(){var t=this.$DisplayObject;if(this.$hasFlags(64)){if(this.$parent){var e=this.$parent.$getConcatenatedAlpha();t[18]=e*this.$alpha}else t[18]=this.$alpha;this.$removeFlags(64)}return t[18]},r(a,"touchEnabled",function(){return this.$getTouchEnabled()},function(t){this.$setTouchEnabled(t)}),a.$getTouchEnabled=function(){return this.$touchEnabled},a.$setTouchEnabled=function(t){return this.$touchEnabled==t?!1:(this.$touchEnabled=t,!0)},r(a,"scrollRect",function(){return this.$scrollRect},function(t){this.$setScrollRect(t)}),a.$setScrollRect=function(e){return e||this.$scrollRect?(e?(this.$scrollRect||(this.$scrollRect=new t.Rectangle),this.$scrollRect.copyFrom(e)):this.$scrollRect=null,this.$invalidatePosition(),!0):!1},r(a,"blendMode",function(){return t.sys.numberToBlendMode(this.$blendMode)},function(e){var i=t.sys.blendModeToNumber(e);i!=this.$blendMode&&(this.$blendMode=i,this.$invalidateTransform())}),r(a,"mask",function(){return this.$mask?this.$mask:this.$maskRect},function(t){if(t!==this){if(t)if(t instanceof n){if(t==this.$mask)return;t.$maskedObject&&(t.$maskedObject.mask=null),t.$maskedObject=this,t.$invalidateTransform(),this.$mask=t,this.$maskRect=null}else this.$setMaskRect(t),this.$mask&&(this.$mask.$maskedObject=null,this.$mask.$invalidateTransform()),this.$mask=null;else this.$mask&&(this.$mask.$maskedObject=null,this.$mask.$invalidateTransform()),this.$mask=null,this.$maskRect=null;this.$invalidateTransform()}}),a.$setMaskRect=function(e){return e||this.$maskRect?(e?(this.$maskRect||(this.$maskRect=new t.Rectangle),this.$maskRect.copyFrom(e)):this.$maskRect=null,this.$invalidatePosition(),!0):!1},r(a,"filters",function(){return this.$DisplayObject[20]},function(t){var e=this.$DisplayObject[20];if(!e&&!t)return void(this.$DisplayObject[20]=t);if(this.$invalidateContentBounds(),this.$invalidate(!0),e&&e.length)for(var i=e.length,n=0;i>n;n++)e[n].$removeTarget(this);if(this.$DisplayObject[20]=t,t&&t.length)for(i=t.length,n=0;i>n;n++)t[n].$addTarget(this)}),a.$getFilters=function(){return this.$DisplayObject[20]},a.getTransformedBounds=function(t,e){return t=t||this,this.$getTransformedBounds(t,e)},a.getBounds=function(t,e){if(void 0===e&&(e=!0),t=this.$getTransformedBounds(this,t),e){var i=this.$DisplayObject;(0!=i[12]||0!=i[13])&&(t.x-=i[12],t.y-=i[13])}return t},a.$getTransformedBounds=function(e,i){var n=this.$getOriginalBounds();if(i||(i=new t.Rectangle),i.copyFrom(n),e==this||i.isEmpty())return i;var r;if(e){r=t.$TempMatrix;var s=e.$getInvertedConcatenatedMatrix();s.$preMultiplyInto(this.$getConcatenatedMatrix(),r)}else r=this.$getConcatenatedMatrix();return r.$transformBounds(i),i},a.globalToLocal=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0);var n=this.$getInvertedConcatenatedMatrix();return n.transformPoint(t,e,i)},a.localToGlobal=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0);var n=this.$getConcatenatedMatrix();return n.transformPoint(t,e,i)},a.$invalidateContentBounds=function(){this.$invalidate(),this.$setFlags(2),this.$propagateFlagsUp(4)},a.$getOriginalBounds=function(){var t=this.$DisplayObject[9];if(this.$hasFlags(4)){t.copyFrom(this.$getContentBounds()),this.$measureChildBounds(t),this.$removeFlags(4),this.$displayList&&(this.$displayList.$renderNode.moved=!0);var e=this.$measureFiltersOffset();e&&(t.x+=e.minX,t.y+=e.minY,t.width+=e.maxX,t.height+=e.maxY)}return t},a.$measureChildBounds=function(){},a.$getContentBounds=function(){var t=this.$DisplayObject[10];return this.$hasFlags(2)&&(this.$measureContentBounds(t),this.$renderNode&&(this.$renderNode.moved=!0),this.$removeFlags(2)),t},a.$measureContentBounds=function(){},a.$invalidate=function(){if(this.$renderNode&&!this.$hasFlags(256)){this.$setFlags(384);var t=this.$displayList?this.$displayList:this.$parentDisplayList;t&&t.markDirty(this)}},a.$invalidateTransform=function(){var t=this;if(!t.$hasFlags(512)){t.$setFlags(512);var e=t.$displayList;(e||t.$renderNode)&&t.$parentDisplayList&&t.$parentDisplayList.markDirty(e||t)}},a.$getRenderNode=function(){var t=this.$renderNode;return t?(128&this.$displayFlags&&(t.cleanBeforeRender(),this.$render(),this.$removeFlags(128),t=this.$renderNode),t):null},a.$update=function(e,i){var n=this;n.$removeFlagsUp(768);var r=n.$renderNode;r.renderAlpha=n.$getConcatenatedAlpha();var s=n.$getConcatenatedMatrix();if(e==t.DirtyRegionPolicy.OFF){var a=n.$displayList||n.$parentDisplayList;if(!a)return!1;var o=r.renderMatrix;o.copyFrom(s);var h=a.root;h!==n.$stage&&n.$getConcatenatedMatrixAt(h,o)}else{var l=i||n.$getContentBounds();r.renderVisible=n.$getConcatenatedVisible();var a=n.$displayList||n.$parentDisplayList,u=r.renderRegion;if(!a)return u.setTo(0,0,0,0),r.moved=!1,!1;if(!r.moved)return!1;r.moved=!1;var o=r.renderMatrix;o.copyFrom(s);var h=a.root;h!==n.$stage&&n.$getConcatenatedMatrixAt(h,o),u.updateRegion(l,o);var c=n.$measureFiltersOffset();c&&(u.minX+=c.minX,u.minY+=c.minY,u.maxX+=c.maxX,u.maxY+=c.maxY,u.updateArea())}return!0},a.$measureFiltersOffset=function(){var e=this.$DisplayObject[20];if(e&&e.length){for(var i=e.length,n=0,r=0,s=0,a=0,o=0;i>o;o++){var h=e[o];if("blur"==h.type){var l=h.blurX,u=h.blurY;n-=l,r-=u,s+=2*l,a+=2*u}else if("glow"==h.type){var l=h.blurX,u=h.blurY;n-=l,r-=u,s+=2*l,a+=2*u;var c=h.distance||0,d=h.angle||0,f=0,g=0;0!=c&&(f=Math.ceil(c*t.NumberUtils.cos(d)),g=Math.ceil(c*t.NumberUtils.sin(d)),f>0?s+=f:0>f&&(n+=f,s-=f),g>0?a+=g:0>g&&(r+=g,a-=g))}}return{minX:n,minY:r,maxX:s,maxY:a}}return null},a.$getConcatenatedMatrixAt=function(e,i){var n=e.$getInvertedConcatenatedMatrix();if(0===n.a||0===n.d){var r=this,s=e.$nestLevel;for(i.identity();r.$nestLevel>s;){var a=r.$scrollRect;a&&i.concat(t.$TempMatrix.setTo(1,0,0,1,-a.x,-a.y)),i.concat(r.$getMatrix()),r=r.$parent}}else n.$preMultiplyInto(i,i)},a.$getConcatenatedAlphaAt=function(t,e){var i=t.$getConcatenatedAlpha();if(0===i){e=1;for(var n=this,r=t.$nestLevel;n.$nestLevel>r;)e*=n.$alpha,n=n.$parent}else e/=i;return e},a.$render=function(){},a.$hitTest=function(t,e){var i=this.$DisplayObject;if(!this.$renderNode||!this.$visible||0==i[0]||0==i[1])return null;var n=this.$getInvertedConcatenatedMatrix();if(0==n.a&&0==n.b&&0==n.c&&0==n.d)return null;var r=this.$getContentBounds(),s=n.a*t+n.c*e+n.tx,a=n.b*t+n.d*e+n.ty;if(r.contains(s,a)){if(!this.$children){var o=this.$scrollRect?this.$scrollRect:this.$maskRect;if(o&&!o.contains(s,a))return null;if(this.$mask&&!this.$mask.$hitTest(t,e))return null}return this}return null},a.hitTestPoint=function(e,i,n){if(n){var r,s=this.$getInvertedConcatenatedMatrix(),a=s.a*e+s.c*i+s.tx,o=s.b*e+s.d*i+s.ty,h=this.$displayList;if(h){var l=h.renderBuffer;try{r=l.getPixel(a-h.offsetX,o-h.offsetY)}catch(u){throw new Error(t.sys.tr(1039))}}else{var l=t.sys.customHitTestBuffer;l.resize(3,3);var c=t.Matrix.create();c.identity(),c.translate(1-a,1-o),t.sys.systemRenderer.render(this,l,c,null,!0),t.Matrix.release(c);try{r=l.getPixel(1,1)}catch(u){throw new Error(t.sys.tr(1039))}}return 0===r[3]?!1:!0}var d=this.$DisplayObject;if(0==d[0]||0==d[1])return!1;var s=this.$getInvertedConcatenatedMatrix(),f=this.getBounds(null,!1),a=s.a*e+s.c*i+s.tx,o=s.b*e+s.d*i+s.ty;if(f.contains(a,o)){var g=this.$scrollRect?this.$scrollRect:this.$maskRect;return g&&!g.contains(a,o)?!1:!0}return!1},a.$addListener=function(e,r,s,a,o,h){i.prototype.$addListener.call(this,e,r,s,a,o,h);var l=e==t.Event.ENTER_FRAME;if(l||e==t.Event.RENDER){var u=l?n.$enterFrameCallBackList:n.$renderCallBackList;-1==u.indexOf(this)&&u.push(this)}},a.removeEventListener=function(e,r,s,a){i.prototype.removeEventListener.call(this,e,r,s,a);var o=e==t.Event.ENTER_FRAME;if((o||e==t.Event.RENDER)&&!this.hasEventListener(e)){var h=o?n.$enterFrameCallBackList:n.$renderCallBackList,l=h.indexOf(this);-1!==l&&h.splice(l,1)}},a.dispatchEvent=function(t){if(!t.$bubbles)return i.prototype.dispatchEvent.call(this,t);var e=this.$getPropagationList(this),n=.5*e.length;return t.$setTarget(this),this.$dispatchPropagationEvent(t,e,n),!t.$isDefaultPrevented},a.$getPropagationList=function(t){for(var e=[];t;)e.push(t),t=t.$parent;var i=e.concat();return i.reverse(),e=i.concat(e)},a.$dispatchPropagationEvent=function(t,e,i){for(var n=e.length,r=i-1,s=0;n>s;s++){var a=e[s];if(t.$currentTarget=a,t.$eventPhase=r>s?1:s==i||s==r?2:3,a.$notifyListener(t,i>s),t.$isPropagationStopped||t.$isPropagationImmediateStopped)return}},a.willTrigger=function(t){for(var e=this;e;){if(e.hasEventListener(t))return!0;e=e.$parent}return!1},n.defaultTouchEnabled=!1,n.boundsForUpdate=new t.Rectangle,n.$enterFrameCallBackList=[],n.$renderCallBackList=[],n}(t.EventDispatcher);t.DisplayObject=i,t.registerClass(i,"egret.DisplayObject",["egret.sys.Renderable"])}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(n){e.call(this),this.$scale9Grid=null,this.$fillMode="scale",this._pixelHitTest=!1,this.$renderNode=new t.sys.BitmapNode,this.$Bitmap={0:null,1:null,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:i.defaultSmoothing,11:0/0,12:0/0},this.$setBitmapData(n)}__extends(i,e);var n=__define,r=i,s=r.prototype;return s.$onAddToStage=function(i,n){e.prototype.$onAddToStage.call(this,i,n);var r=this.$Bitmap[0];r&&t.BitmapData.$addDisplayObject(this,r)},s.$onRemoveFromStage=function(){e.prototype.$onRemoveFromStage.call(this);var i=this.$Bitmap[0];i&&t.BitmapData.$removeDisplayObject(this,i)},n(s,"bitmapData",function(){var e=this.$Bitmap[0];return e instanceof t.Texture?null:e},function(t){this.$setBitmapData(t)}),n(s,"texture",function(){var e=this.$Bitmap[0];return e instanceof t.Texture?e:null},function(t){this.$setBitmapData(t)}),s.$setBitmapData=function(e){var i=this.$Bitmap,n=i[0];if(e==n)return!1;if(i[0]=e,!e)return n&&t.BitmapData.$removeDisplayObject(this,n),this.setImageData(null,0,0,0,0,0,0,0,0,0,0),this.$invalidateContentBounds(),!0;if(this.$refreshImageData(),this.$stage){if(n){var r;r=n._bitmapData&&n._bitmapData.hashCode?n._bitmapData.hashCode:n.hashCode;var s;if(s=e._bitmapData&&e._bitmapData.hashCode?e._bitmapData.hashCode:e.hashCode,r==s)return this.$invalidateContentBounds(),!0;t.BitmapData.$removeDisplayObject(this,n)}t.BitmapData.$addDisplayObject(this,e)}return this.$invalidateContentBounds(),!0},s.$refreshImageData=function(){var e=this.$Bitmap,i=e[0];if(i)if(i instanceof t.Texture){var n=i;this.setImageData(n._bitmapData,n._bitmapX,n._bitmapY,n._bitmapWidth,n._bitmapHeight,n._offsetX,n._offsetY,n.$getTextureWidth(),n.$getTextureHeight(),n._sourceWidth,n._sourceHeight)}else{var r=i.width,s=i.height;this.setImageData(i,0,0,r,s,0,0,r,s,r,s)}},s.setImageData=function(t,e,i,n,r,s,a,o,h,l,u){var c=this.$Bitmap;c[1]=t,c[2]=e,c[3]=i,c[4]=n,c[5]=r,c[6]=s,c[7]=a,c[8]=o,c[9]=h,c[13]=l,c[14]=u},n(s,"scale9Grid",function(){return this.$scale9Grid},function(t){this.$scale9Grid=t,this.$invalidateContentBounds()}),n(s,"fillMode",function(){return this.$fillMode},function(t){this.$setFillMode(t)}),s.$setFillMode=function(t){return t==this.$fillMode?!1:(this.$fillMode=t,!0)},n(s,"smoothing",function(){var t=this.$Bitmap;return t[10]},function(t){t=!!t;var e=this.$Bitmap;t!=e[10]&&(e[10]=t,this.$invalidate())}),s.$setWidth=function(t){var e=this.$Bitmap;return 0>t||t==e[11]?!1:(e[11]=t,this.$invalidateContentBounds(),!0)},s.$setHeight=function(t){var e=this.$Bitmap;return 0>t||t==e[12]?!1:(e[12]=t,this.$invalidateContentBounds(),!0)},s.$getWidth=function(){var t=this.$Bitmap;return isNaN(t[11])?this.$getContentBounds().width:t[11]},s.$getHeight=function(){var t=this.$Bitmap;return isNaN(t[12])?this.$getContentBounds().height:t[12]},s.$measureContentBounds=function(t){var e=this.$Bitmap;if(e[1]){var e=this.$Bitmap,i=isNaN(e[11])?e[8]:e[11],n=isNaN(e[12])?e[9]:e[12];t.setTo(0,0,i,n)}else i=isNaN(e[11])?0:e[11],n=isNaN(e[12])?0:e[12],t.setTo(0,0,i,n)},s.$render=function(){var e=this.$Bitmap;if(e[1]){var i=isNaN(e[11])?e[8]:e[11],n=isNaN(e[12])?e[9]:e[12];t.sys.BitmapNode.$updateTextureData(this.$renderNode,e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],i,n,e[13],e[14],this.scale9Grid||e[0].scale9Grid,this.fillMode,e[10])}},n(s,"pixelHitTest",function(){return this._pixelHitTest},function(t){this._pixelHitTest=!!t}),s.$hitTest=function(t,i){var n=e.prototype.$hitTest.call(this,t,i);return n&&this._pixelHitTest&&(n=this.hitTestPixel(t,i)),n},s.hitTestPixel=function(e,i){var n,r=this.$getInvertedConcatenatedMatrix(),s=r.a*e+r.c*i+r.tx,a=r.b*e+r.d*i+r.ty,o=this.$displayList;if(o){var h=o.renderBuffer;try{n=h.getPixel(s-o.offsetX,a-o.offsetY)}catch(l){throw console.log(this.$Bitmap[0]),new Error(t.sys.tr(1039))}}else{var h=t.sys.customHitTestBuffer;h.resize(3,3);var u=this.$getRenderNode(),c=t.Matrix.create();c.identity(),c.translate(1-s,1-a),t.sys.systemRenderer.drawNodeToBuffer(u,h,c,!0),t.Matrix.release(c);try{n=h.getPixel(1,1)}catch(l){throw console.log(this.$Bitmap[0]),new Error(t.sys.tr(1039))}}return 0===n[3]?null:this},i.$drawImage=function(e,i,n,r,s,a,o,h,l,u,c,d,f,g,p,v,$){console.warn("deprecated method : Bitmap.$drawImage,use egret.sys.BitmapNode.$drawImage instead of it"),t.sys.BitmapNode.$updateTextureData(e,i,n,r,s,a,o,h,l,u,c,d,f,g,p,v,$)},i.defaultSmoothing=!0,i}(t.DisplayObject);t.Bitmap=e,t.registerClass(e,"egret.Bitmap")}(egret||(egret={}));var egret;!function(t){function e(){var t=Object.create(null);return t.__v8__=void 0,delete t.__v8__,t}t.createMap=e}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(t){e.call(this),this.format="image",this.$deleteSource=!0,this.source=t,this.width=t.width,this.height=t.height}__extends(i,e);var n=i,r=n.prototype;return r.$dispose=function(){t.Capabilities.runtimeType==t.RuntimeType.WEB&&"webgl"==t.Capabilities.renderMode&&this.webGLTexture&&(t.WebGLUtils.deleteWebGLTexture(this.webGLTexture),this.webGLTexture=null),this.source&&this.source.dispose&&this.source.dispose(),this.source=null,i.$dispose(this)},i.$addDisplayObject=function(t,e){var n;if(n=e._bitmapData&&e._bitmapData.hashCode?e._bitmapData.hashCode:e.hashCode){if(!i._displayList[n])return void(i._displayList[n]=[t]);var r=i._displayList[n];r.indexOf(t)<0&&r.push(t)}},i.$removeDisplayObject=function(t,e){var n;if(n=e._bitmapData&&e._bitmapData.hashCode?e._bitmapData.hashCode:e.hashCode,n&&i._displayList[n]){var r=i._displayList[n],s=r.indexOf(t);s>=0&&r.splice(s)}},i.$invalidate=function(e){var n;if(n=e._bitmapData&&e._bitmapData.hashCode?e._bitmapData.hashCode:e.hashCode,n&&i._displayList[n])for(var r=i._displayList[n],s=0;s<r.length;s++)r[s]instanceof t.Bitmap&&r[s].$refreshImageData(),r[s].$invalidateContentBounds()},i.$dispose=function(e){var n;if(n=e._bitmapData&&e._bitmapData.hashCode?e._bitmapData.hashCode:e.hashCode,n&&i._displayList[n]){for(var r=i._displayList[n],s=0;s<r.length;s++)r[s]instanceof t.Bitmap&&(r[s].$Bitmap[1]=null),r[s].$invalidateContentBounds();delete i._displayList[n]}},i._displayList=t.createMap(),i}(t.HashObject);t.BitmapData=e,t.registerClass(e,"egret.BitmapData")}(egret||(egret={}));var egret;!function(t){t.BitmapFillMode={REPEAT:"repeat",SCALE:"scale",CLIP:"clip"}}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}var e=t;return e.prototype,t.NORMAL="normal",t.ADD="add",t.ERASE="erase",t}();t.BlendMode=e,t.registerClass(e,"egret.BlendMode")}(egret||(egret={}));var egret;!function(t){var e;!function(t){function e(t){var e=r[t];return void 0===e?0:e}function i(t){var e=n[t];return void 0===e?"normal":e}for(var n=["normal","add","erase"],r={},s=n.length,a=0;s>a;a++){var o=n[a];r[o]=a}t.blendModeToNumber=e,t.numberToBlendMode=i}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){t.CapsStyle={NONE:"none",ROUND:"round",SQUARE:"square"}}(egret||(egret={}));var egret;!function(t){t.DirtyRegionPolicy={OFF:"off",ON:"on"}}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){e.call(this),this.$touchChildren=!0,this.$children=[]}__extends(i,e);var n=__define,r=i,s=r.prototype;return s.$propagateFlagsDown=function(t){if(!this.$hasFlags(t)){this.$setFlags(t);for(var e=this.$children,i=e.length,n=0;i>n;n++)e[n].$propagateFlagsDown(t)}},n(s,"numChildren",function(){return this.$children.length}),s.addChild=function(t){var e=this.$children.length;return t.$parent==this&&e--,this.$doAddChild(t,e)},s.addChildAt=function(t,e){return e=0|+e,(0>e||e>=this.$children.length)&&(e=this.$children.length,t.$parent==this&&e--),this.$doAddChild(t,e)},s.$doAddChild=function(e,n,r){void 0===r&&(r=!0);var s=e.$parent;if(s==this)return this.doSetChildIndex(e,n),e;s&&s.removeChild(e),this.$children.splice(n,0,e),e.$setParent(this);var a=this.$stage;if(a&&e.$onAddToStage(a,this.$nestLevel+1),r&&e.dispatchEventWith(t.Event.ADDED,!0),a)for(var o=i.$EVENT_ADD_TO_STAGE_LIST;o.length;){var h=o.shift();h.$stage&&r&&h.dispatchEventWith(t.Event.ADDED_TO_STAGE)}var l=this.$displayList||this.$parentDisplayList;return this.assignParentDisplayList(e,l,l),e.$propagateFlagsDown(1648),this.$propagateFlagsUp(4),this.$childAdded(e,n),e},s.contains=function(t){for(;t;){if(t==this)return!0;t=t.$parent}return!1},s.getChildAt=function(t){return t=0|+t,t>=0&&t<this.$children.length?this.$children[t]:null},s.getChildIndex=function(t){return this.$children.indexOf(t)},s.getChildByName=function(t){for(var e,i=this.$children,n=i.length,r=0;n>r;r++)if(e=i[r],e.name==t)return e;return null},s.removeChild=function(t){var e=this.$children.indexOf(t);return e>=0?this.$doRemoveChild(e):null},s.removeChildAt=function(t){return t=0|+t,t>=0&&t<this.$children.length?this.$doRemoveChild(t):null},s.$doRemoveChild=function(e,n){void 0===n&&(n=!0),e=0|+e;var r=this.$children,s=r[e];if(this.$childRemoved(s,e),n&&s.dispatchEventWith(t.Event.REMOVED,!0),this.$stage){s.$onRemoveFromStage();for(var a=i.$EVENT_REMOVE_FROM_STAGE_LIST;a.length>0;){var o=a.shift();n&&o.$hasAddToStage&&(o.$hasAddToStage=!1,o.dispatchEventWith(t.Event.REMOVED_FROM_STAGE)),o.$hasAddToStage=!1,o.$stage=null}}var h=this.$displayList||this.$parentDisplayList;this.assignParentDisplayList(s,h,null),s.$propagateFlagsDown(1648),s.$setParent(null);
var l=r.indexOf(s);return-1!=l&&r.splice(l,1),this.$propagateFlagsUp(4),s},s.setChildIndex=function(t,e){e=0|+e,(0>e||e>=this.$children.length)&&(e=this.$children.length-1),this.doSetChildIndex(t,e)},s.doSetChildIndex=function(t,e){var i=this.$children.indexOf(t);i!=e&&(this.$childRemoved(t,i),this.$children.splice(i,1),this.$children.splice(e,0,t),this.$childAdded(t,e),t.$invalidateTransform(),this.$propagateFlagsUp(4))},s.swapChildrenAt=function(t,e){t=0|+t,e=0|+e,t>=0&&t<this.$children.length&&e>=0&&e<this.$children.length&&this.doSwapChildrenAt(t,e)},s.swapChildren=function(t,e){var i=this.$children.indexOf(t),n=this.$children.indexOf(e);-1==i||-1==n||this.doSwapChildrenAt(i,n)},s.doSwapChildrenAt=function(t,e){if(t>e){var i=e;e=t,t=i}else if(t==e)return;var n=this.$children,r=n[t],s=n[e];this.$childRemoved(r,t),this.$childRemoved(s,e),n[t]=s,n[e]=r,this.$childAdded(s,t),this.$childAdded(r,e),r.$invalidateTransform(),s.$invalidateTransform(),this.$propagateFlagsUp(4)},s.removeChildren=function(){for(var t=this.$children,e=t.length-1;e>=0;e--)this.$doRemoveChild(e)},s.$childAdded=function(){},s.$childRemoved=function(){},s.$onAddToStage=function(t,i){e.prototype.$onAddToStage.call(this,t,i);var n=this.$children,r=n.length;i++;for(var s=0;r>s;s++){var a=this.$children[s];a.$onAddToStage(t,i)}},s.$onRemoveFromStage=function(){e.prototype.$onRemoveFromStage.call(this);for(var t=this.$children,i=t.length,n=0;i>n;n++){var r=t[n];r.$onRemoveFromStage()}},s.$measureChildBounds=function(e){var i=this.$children,n=i.length;if(0!=n){for(var r=0,s=0,a=0,o=0,h=!1,l=-1;n>l;l++){var u=-1==l?e:i[l].$getTransformedBounds(this,t.$TempRectangle);u.isEmpty()||(h?(r=Math.min(r,u.x),s=Math.max(s,u.x+u.width),a=Math.min(a,u.y),o=Math.max(o,u.y+u.height)):(h=!0,r=u.x,s=r+u.width,a=u.y,o=a+u.height))}e.setTo(r,a,s-r,o-a)}},n(s,"touchChildren",function(){return this.$getTouchChildren()},function(t){this.$setTouchChildren(!!t)}),s.$getTouchChildren=function(){return this.$touchChildren},s.$setTouchChildren=function(t){return this.$touchChildren==t?!1:(this.$touchChildren=t,!0)},s.$invalidate=function(t){if(e.prototype.$invalidate.call(this,t),t){var i=this.$displayList||this.$parentDisplayList,n=this.$children;if(n)for(var r=n.length-1;r>=0;r--)this.markChildDirty(n[r],i)}},s.$invalidateTransform=function(){this.markChildDirty(this,this.$parentDisplayList)},s.markChildDirty=function(t,e){if(!t.$hasFlags(512)){t.$setFlags(512);var i=t.$displayList;if((i||t.$renderNode)&&e&&e.markDirty(i||t),!i){var n=t.$children;if(n)for(var r=n.length-1;r>=0;r--)this.markChildDirty(n[r],e)}}},s.$cacheAsBitmapChanged=function(){e.prototype.$cacheAsBitmapChanged.call(this);for(var t=this.$displayList||this.$parentDisplayList,i=this.$children,n=i.length-1;n>=0;n--)this.assignParentDisplayList(i[n],t,t)},s.assignParentDisplayList=function(t,e,i){t.$parentDisplayList=i,t.$setFlags(512);var n=t.$displayList;if((t.$renderNode||n)&&e&&e.markDirty(n||t),!n){var r=t.$children;if(r)for(var s=r.length-1;s>=0;s--)this.assignParentDisplayList(r[s],e,i)}},s.$hitTest=function(t,i){if(!this.$visible)return null;var n=this.$getInvertedConcatenatedMatrix(),r=n.a*t+n.c*i+n.tx,s=n.b*t+n.d*i+n.ty,a=this.$scrollRect?this.$scrollRect:this.$maskRect;if(a&&!a.contains(r,s))return null;if(this.$mask&&!this.$mask.$hitTest(t,i))return null;for(var o=this.$children,h=!1,l=o.length-1;l>=0;l--){var u=o[l];if(!u.$maskedObject){var c=u.$hitTest(t,i);if(c){if(h=!0,c.$touchEnabled)break;c=null}}}return c?this.$touchChildren?c:this:h?this:e.prototype.$hitTest.call(this,t,i)},s.$setAlpha=function(t){return t=+t||0,t==this.$alpha?!1:(this.$alpha=t,this.$propagateFlagsDown(64),this.$invalidate(),this.$invalidateAllChildren(),!0)},s.$invalidateAllChildren=function(){var t=this.$children;if(t)for(var e=t.length-1;e>=0;e--){var i=t[e];i.$invalidate(),i.$children&&i.$invalidateAllChildren()}},i.$EVENT_ADD_TO_STAGE_LIST=[],i.$EVENT_REMOVE_FROM_STAGE_LIST=[],i}(t.DisplayObject);t.DisplayObjectContainer=e,t.registerClass(e,"egret.DisplayObjectContainer")}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}var e=t;return e.prototype,t.LINEAR="linear",t.RADIAL="radial",t}();t.GradientType=e,t.registerClass(e,"egret.GradientType")}(egret||(egret={}));var egret;!function(t){function e(t){return t%=2*Math.PI,0>t&&(t+=2*Math.PI),t}var i=function(i){function n(){i.call(this),this.lastX=0,this.lastY=0,this.fillPath=null,this.strokePath=null,this.topLeftStrokeWidth=0,this.bottomRightStrokeWidth=0,this.minX=1/0,this.minY=1/0,this.maxX=-(1/0),this.maxY=-(1/0),this.includeLastPosition=!0,this.$renderNode=new t.sys.GraphicsNode}__extends(n,i);var r=n,s=r.prototype;return s.$setTarget=function(t){this.targetDisplay&&(this.targetDisplay.$renderNode=null),t.$renderNode=this.$renderNode,this.targetDisplay=t},s.setStrokeWidth=function(t){switch(t){case 1:this.topLeftStrokeWidth=0,this.bottomRightStrokeWidth=1;break;case 3:this.topLeftStrokeWidth=1,this.bottomRightStrokeWidth=2;break;default:var e=0|Math.ceil(.5*t);this.topLeftStrokeWidth=e,this.bottomRightStrokeWidth=e}},s.beginFill=function(t,e){void 0===e&&(e=1),t=+t||0,e=+e||0,this.fillPath=this.$renderNode.beginFill(t,e,this.strokePath),this.$renderNode.drawData.length>1&&this.fillPath.moveTo(this.lastX,this.lastY)},s.beginGradientFill=function(t,e,i,n,r){void 0===r&&(r=null),this.fillPath=this.$renderNode.beginGradientFill(t,e,i,n,r,this.strokePath),this.$renderNode.drawData.length>1&&this.fillPath.moveTo(this.lastX,this.lastY)},s.endFill=function(){this.fillPath=null},s.lineStyle=function(t,e,i,n,r,s,a,o){void 0===t&&(t=0/0),void 0===e&&(e=0),void 0===i&&(i=1),void 0===n&&(n=!1),void 0===r&&(r="normal"),void 0===s&&(s=null),void 0===a&&(a=null),void 0===o&&(o=3),t=+t||0,0>=t?(this.strokePath=null,this.setStrokeWidth(0)):(e=+e||0,i=+i||0,o=+o||0,this.setStrokeWidth(t),this.strokePath=this.$renderNode.lineStyle(t,e,i,s,a,o),this.$renderNode.drawData.length>1&&this.strokePath.moveTo(this.lastX,this.lastY))},s.drawRect=function(t,e,i,n){t=+t||0,e=+e||0,i=+i||0,n=+n||0;var r=this.fillPath,s=this.strokePath;r&&r.drawRect(t,e,i,n),s&&s.drawRect(t,e,i,n),this.extendBoundsByPoint(t+i,e+n),this.updatePosition(t,e),this.$renderNode.dirtyRender=!0},s.drawRoundRect=function(t,e,i,n,r,s){t=+t||0,e=+e||0,i=+i||0,n=+n||0,r=+r||0,s=+s||0;var a=this.fillPath,o=this.strokePath;a&&a.drawRoundRect(t,e,i,n,r,s),o&&o.drawRoundRect(t,e,i,n,r,s);var h=.5*r|0,l=s?.5*s|0:h,u=t+i,c=e+n,d=c-l;this.extendBoundsByPoint(t,e),this.extendBoundsByPoint(u,c),this.updatePosition(u,d),this.$renderNode.dirtyRender=!0},s.drawCircle=function(t,e,i){t=+t||0,e=+e||0,i=+i||0;var n=this.fillPath,r=this.strokePath;n&&n.drawCircle(t,e,i),r&&r.drawCircle(t,e,i),this.extendBoundsByPoint(t-i,e-i),this.extendBoundsByPoint(t+i,e+i),this.updatePosition(t+i,e),this.$renderNode.dirtyRender=!0},s.drawEllipse=function(t,e,i,n){t=+t||0,e=+e||0,i=+i||0,n=+n||0;var r=this.fillPath,s=this.strokePath;r&&r.drawEllipse(t,e,i,n),s&&s.drawEllipse(t,e,i,n),this.extendBoundsByPoint(t+i,e+n),this.updatePosition(t+i,e+.5*n),this.$renderNode.dirtyRender=!0},s.moveTo=function(t,e){t=+t||0,e=+e||0;var i=this.fillPath,n=this.strokePath;i&&i.moveTo(t,e),n&&n.moveTo(t,e),this.includeLastPosition=!1,this.lastX=t,this.lastY=e,this.$renderNode.dirtyRender=!0},s.lineTo=function(t,e){t=+t||0,e=+e||0;var i=this.fillPath,n=this.strokePath;i&&i.lineTo(t,e),n&&n.lineTo(t,e),this.updatePosition(t,e),this.$renderNode.dirtyRender=!0},s.curveTo=function(t,e,i,n){t=+t||0,e=+e||0,i=+i||0,n=+n||0;var r=this.fillPath,s=this.strokePath;r&&r.curveTo(t,e,i,n),s&&s.curveTo(t,e,i,n),this.extendBoundsByPoint(t,e),this.extendBoundsByPoint(i,n),this.updatePosition(i,n),this.$renderNode.dirtyRender=!0},s.cubicCurveTo=function(t,e,i,n,r,s){t=+t||0,e=+e||0,i=+i||0,n=+n||0,r=+r||0,s=+s||0;var a=this.fillPath,o=this.strokePath;a&&a.cubicCurveTo(t,e,i,n,r,s),o&&o.cubicCurveTo(t,e,i,n,r,s),this.extendBoundsByPoint(t,e),this.extendBoundsByPoint(i,n),this.extendBoundsByPoint(r,s),this.updatePosition(r,s),this.$renderNode.dirtyRender=!0},s.drawArc=function(t,i,n,r,s,a){if(!(0>n||r===s)){t=+t||0,i=+i||0,n=+n||0,r=+r||0,s=+s||0,a=!!a,r=e(r),s=e(s);var o=this.fillPath,h=this.strokePath;o&&(o.$lastX=this.lastX,o.$lastY=this.lastY,o.drawArc(t,i,n,r,s,a)),h&&(h.$lastX=this.lastX,h.$lastY=this.lastY,h.drawArc(t,i,n,r,s,a)),a?this.arcBounds(t,i,n,s,r):this.arcBounds(t,i,n,r,s);var l=t+Math.cos(s)*n,u=i+Math.sin(s)*n;this.updatePosition(l,u),this.$renderNode.dirtyRender=!0}},s.arcBounds=function(t,e,i,n,r){var s=Math.PI;if(Math.abs(n-r)<.01)return this.extendBoundsByPoint(t-i,e-i),void this.extendBoundsByPoint(t+i,e+i);n>r&&(r+=2*s);for(var a=Math.cos(n)*i,o=Math.cos(r)*i,h=Math.min(a,o),l=Math.max(a,o),u=Math.sin(n)*i,c=Math.sin(r)*i,d=Math.min(u,c),f=Math.max(u,c),g=n/(.5*s),p=r/(.5*s),v=Math.ceil(g);p>=v;v++)switch(v%4){case 0:l=i;break;case 1:f=i;break;case 2:h=-i;break;case 3:d=-i}h=Math.floor(h),d=Math.floor(d),l=Math.ceil(l),f=Math.ceil(f),this.extendBoundsByPoint(h+t,d+e),this.extendBoundsByPoint(l+t,f+e)},s.clear=function(){this.$renderNode.clear(),this.updatePosition(0,0),this.minX=1/0,this.minY=1/0,this.maxX=-(1/0),this.maxY=-(1/0)},s.extendBoundsByPoint=function(t,e){this.extendBoundsByX(t),this.extendBoundsByY(e)},s.extendBoundsByX=function(t){this.minX=Math.min(this.minX,t-this.topLeftStrokeWidth),this.maxX=Math.max(this.maxX,t+this.bottomRightStrokeWidth),this.updateNodeBounds()},s.extendBoundsByY=function(t){this.minY=Math.min(this.minY,t-this.topLeftStrokeWidth),this.maxY=Math.max(this.maxY,t+this.bottomRightStrokeWidth),this.updateNodeBounds()},s.updateNodeBounds=function(){var t=this.$renderNode;t.x=this.minX,t.y=this.minY,t.width=Math.ceil(this.maxX-this.minX),t.height=Math.ceil(this.maxY-this.minY)},s.updatePosition=function(t,e){this.includeLastPosition||(this.extendBoundsByPoint(this.lastX,this.lastY),this.includeLastPosition=!0),this.lastX=t,this.lastY=e,this.extendBoundsByPoint(t,e),this.targetDisplay.$invalidateContentBounds()},s.$measureContentBounds=function(t){this.minX===1/0?t.setEmpty():t.setTo(this.minX,this.minY,this.maxX-this.minX,this.maxY-this.minY)},s.$hitTest=function(e,i){var n=this.targetDisplay,r=n.$getInvertedConcatenatedMatrix(),s=r.a*e+r.c*i+r.tx,a=r.b*e+r.d*i+r.ty,o=t.sys.canvasHitTestBuffer;o.resize(3,3);var h=this.$renderNode,l=t.Matrix.create();l.identity(),l.translate(1-s,1-a),t.sys.canvasRenderer.drawNodeToBuffer(h,o,l,!0),t.Matrix.release(l);try{var u=o.getPixel(1,1)}catch(c){throw new Error(t.sys.tr(1039))}return 0===u[3]?null:n},s.$onRemoveFromStage=function(){this.$renderNode&&this.$renderNode.clean()},n}(t.HashObject);t.Graphics=i,t.registerClass(i,"egret.Graphics")}(egret||(egret={}));var egret;!function(t){t.JointStyle={BEVEL:"bevel",MITER:"miter",ROUND:"round"}}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(i){e.call(this,i),this._verticesDirty=!0,this._bounds=new t.Rectangle,this.$renderNode=new t.sys.MeshNode}__extends(i,e);var n=i,r=n.prototype;return r.$render=function(){var e=this.$Bitmap,i=e[1];if(i){var n=(t.$TextureScaleFactor,this.$renderNode);n.smoothing=e[10],n.image=i,n.imageWidth=e[13],n.imageHeight=e[14];var r=isNaN(e[11])?e[8]:e[11],s=isNaN(e[12])?e[9]:e[12],a=r/e[8],o=s/e[9],h=e[4],l=e[5];n.drawMesh(e[2],e[3],h,l,e[6]*a,e[7]*o,a*h,o*l)}},r.$updateVertices=function(){this._verticesDirty=!0,this.$invalidateContentBounds()},r.$measureContentBounds=function(t){if(this._verticesDirty){this._verticesDirty=!1;var e=this.$renderNode,i=e.vertices;if(i.length){this._bounds.setTo(Number.MAX_VALUE,Number.MAX_VALUE,Number.MIN_VALUE,Number.MIN_VALUE);for(var n=0,r=i.length;r>n;n+=2){var s=i[n],a=i[n+1];this._bounds.x>s&&(this._bounds.x=s),this._bounds.width<s&&(this._bounds.width=s),this._bounds.y>a&&(this._bounds.y=a),this._bounds.height<a&&(this._bounds.height=a)}this._bounds.width-=this._bounds.x,this._bounds.height-=this._bounds.y}else this._bounds.setTo(0,0,0,0);e.bounds.copyFrom(this._bounds)}t.copyFrom(this._bounds)},i}(t.Bitmap);t.Mesh=e,t.registerClass(e,"egret.Mesh")}(egret||(egret={}));var egret;!function(t){t.OrientationMode={AUTO:"auto",PORTRAIT:"portrait",LANDSCAPE:"landscape",LANDSCAPE_FLIPPED:"landscapeFlipped"}}(egret||(egret={}));var egret;!function(t){t.$TextureScaleFactor=1;var e=function(e){function i(){e.call(this),this._bitmapX=0,this._bitmapY=0,this._bitmapWidth=0,this._bitmapHeight=0,this._offsetX=0,this._offsetY=0,this._textureWidth=0,this._textureHeight=0,this._sourceWidth=0,this._sourceHeight=0,this._bitmapData=null}__extends(i,e);var n=__define,r=i,s=r.prototype;return n(s,"textureWidth",function(){return this.$getTextureWidth()}),s.$getTextureWidth=function(){return this._textureWidth},n(s,"textureHeight",function(){return this.$getTextureHeight()}),s.$getTextureHeight=function(){return this._textureHeight},s.$getScaleBitmapWidth=function(){return this._bitmapWidth*t.$TextureScaleFactor},s.$getScaleBitmapHeight=function(){return this._bitmapHeight*t.$TextureScaleFactor},n(s,"bitmapData",function(){return this._bitmapData}),s._setBitmapData=function(e){this._bitmapData=e;var i=t.$TextureScaleFactor,n=e.width*i,r=e.height*i;this.$initData(0,0,n,r,0,0,n,r,e.width,e.height)},s.$initData=function(e,i,n,r,s,a,o,h,l,u){var c=t.$TextureScaleFactor;this._bitmapX=e/c,this._bitmapY=i/c,this._bitmapWidth=n/c,this._bitmapHeight=r/c,this._offsetX=s,this._offsetY=a,this._textureWidth=o,this._textureHeight=h,this._sourceWidth=l,this._sourceHeight=u,t.BitmapData.$invalidate(this)},s.getPixel32=function(){throw new Error},s.toDataURL=function(){throw new Error},s.saveToFile=function(){throw new Error},s.dispose=function(){this._bitmapData&&(this._bitmapData.$dispose(),this._bitmapData=null)},i}(t.HashObject);t.Texture=e,t.registerClass(e,"egret.Texture")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){e.call(this),this.renderBuffer=new t.sys.CanvasRenderBuffer;var i=new t.BitmapData(this.renderBuffer.surface);i.$deleteSource=!1,this._setBitmapData(i)}__extends(i,e);var n=i,r=n.prototype;return r.drawToTexture=function(e,i,n){if(void 0===n&&(n=1),i&&(0==i.width||0==i.height))return!1;var r=i||e.$getOriginalBounds();if(0==r.width||0==r.height)return!1;n/=t.$TextureScaleFactor;var s=(r.x+r.width)*n,a=(r.y+r.height)*n;i&&(s=r.width*n,a=r.height*n);var o=this.renderBuffer;if(!o)return!1;o.resize(s,a),this._bitmapData.width=s,this._bitmapData.height=a;var h=t.Matrix.create();return h.identity(),i&&h.translate(-i.x,-i.y),h.scale(n,n),t.sys.canvasRenderer.render(e,o,h,null,!0),t.Matrix.release(h),this.$initData(0,0,s,a,0,0,s,a,s,a),e.$propagateFlagsDown(128),!0},r.getPixel32=function(e,i){var n;if(this.renderBuffer){var r=t.$TextureScaleFactor;e=Math.round(e/r),i=Math.round(i/r),n=this.renderBuffer.getPixel(e,i)}return n},r.dispose=function(){e.prototype.dispose.call(this),this.renderBuffer=null},i}(t.Texture);t.RenderTexture=e,t.registerClass(e,"egret.RenderTexture")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){e.call(this),this.$graphics=new t.Graphics,this.$graphics.$setTarget(this)}__extends(i,e);var n=__define,r=i,s=r.prototype;return n(s,"graphics",function(){return this.$graphics}),s.$measureContentBounds=function(t){this.$graphics.$measureContentBounds(t)},s.$hitTest=function(t,i){var n=e.prototype.$hitTest.call(this,t,i);return n==this&&(n=this.$graphics.$hitTest(t,i)),n},s.$onRemoveFromStage=function(){e.prototype.$onRemoveFromStage.call(this),this.$graphics&&this.$graphics.$onRemoveFromStage()},i}(t.DisplayObject);t.Shape=e,t.registerClass(e,"egret.Shape")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){e.call(this),this.$graphics=new t.Graphics,this.$graphics.$setTarget(this)}__extends(i,e);var n=__define,r=i,s=r.prototype;return n(s,"graphics",function(){return this.$graphics}),s.$hitTest=function(e,i){if(!this.$visible)return null;var n=this.$getInvertedConcatenatedMatrix(),r=n.a*e+n.c*i+n.tx,s=n.b*e+n.d*i+n.ty,a=this.$scrollRect?this.$scrollRect:this.$maskRect;if(a&&!a.contains(r,s))return null;if(this.$mask&&!this.$mask.$hitTest(e,i))return null;for(var o=this.$children,h=!1,l=o.length-1;l>=0;l--){var u=o[l];if(!u.$maskedObject){var c=u.$hitTest(e,i);if(c){if(h=!0,c.$touchEnabled)break;c=null}}}return c?this.$touchChildren?c:this:h?this:(c=t.DisplayObject.prototype.$hitTest.call(this,e,i),c&&(c=this.$graphics.$hitTest(e,i)),c)},s.$measureContentBounds=function(t){this.$graphics.$measureContentBounds(t)},s.$onRemoveFromStage=function(){e.prototype.$onRemoveFromStage.call(this),this.$graphics&&this.$graphics.$onRemoveFromStage()},i}(t.DisplayObjectContainer);t.Sprite=e,t.registerClass(e,"egret.Sprite")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(i){e.call(this),this._bitmapX=0,this._bitmapY=0,this._textureMap=t.createMap(),this.$texture=i,this._bitmapX=i._bitmapX-i._offsetX,this._bitmapY=i._bitmapY-i._offsetY}__extends(i,e);var n=i,r=n.prototype;return r.getTexture=function(t){return this._textureMap[t]},r.createTexture=function(e,i,n,r,s,a,o,h,l){void 0===a&&(a=0),void 0===o&&(o=0),void 0===h&&(h=a+r),void 0===l&&(l=o+s);var u=new t.Texture;return u._bitmapData=this.$texture._bitmapData,u.$initData(this._bitmapX+i,this._bitmapY+n,r,s,a,o,h,l,this.$texture._sourceWidth,this.$texture._sourceHeight),this._textureMap[e]=u,u},r.dispose=function(){this.$texture&&this.$texture.dispose()},i}(t.HashObject);t.SpriteSheet=e,t.registerClass(e,"egret.SpriteSheet")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){e.call(this),this.$stageWidth=0,this.$stageHeight=0,this.implMap={},this.$scaleMode=t.StageScaleMode.SHOW_ALL,this.$orientation=t.OrientationMode.AUTO,this.$maxTouches=99,this.$dirtyRegionPolicy=t.DirtyRegionPolicy.ON,this.$stage=this,this.$nestLevel=1}__extends(i,e);var n=__define,r=i,s=r.prototype;return n(s,"frameRate",function(){return t.sys.$ticker.$frameRate},function(e){t.sys.$ticker.$setFrameRate(e)}),n(s,"stageWidth",function(){return this.$stageWidth}),n(s,"stageHeight",function(){return this.$stageHeight}),s.invalidate=function(){t.sys.$invalidateRenderFlag=!0},s.registerImplementation=function(t,e){this.implMap[t]=e},s.getImplementation=function(t){return this.implMap[t]},n(s,"scaleMode",function(){return this.$scaleMode},function(t){this.$scaleMode!=t&&(this.$scaleMode=t,this.$screen.updateScreenSize())}),n(s,"orientation",function(){return this.$orientation},function(t){this.$orientation!=t&&(this.$orientation=t,this.$screen.updateScreenSize())}),n(s,"textureScaleFactor",function(){return t.$TextureScaleFactor},function(e){t.$TextureScaleFactor=e}),n(s,"maxTouches",function(){return this.$maxTouches},function(t){this.$maxTouches!=t&&(this.$maxTouches=t,this.$screen.updateMaxTouches())}),n(s,"dirtyRegionPolicy",function(){return this.$dirtyRegionPolicy},function(t){this.$dirtyRegionPolicy!=t&&(this.$dirtyRegionPolicy=t,this.$displayList.setDirtyRegionPolicy(t))}),s.setContentSize=function(t,e){this.$screen.setContentSize(t,e)},i}(t.DisplayObjectContainer);t.Stage=e,t.registerClass(e,"egret.Stage")}(egret||(egret={}));var egret;!function(t){var e=function(t){function e(e,i,n,r){t.call(this),this.$eventPhase=2,this.$currentTarget=null,this.$target=null,this.$isDefaultPrevented=!1,this.$isPropagationStopped=!1,this.$isPropagationImmediateStopped=!1,this.$type=e,this.$bubbles=!!i,this.$cancelable=!!n,this.data=r}__extends(e,t);var i=__define,n=e,r=n.prototype;return i(r,"type",function(){return this.$type}),i(r,"bubbles",function(){return this.$bubbles}),i(r,"cancelable",function(){return this.$cancelable}),i(r,"eventPhase",function(){return this.$eventPhase}),i(r,"currentTarget",function(){return this.$currentTarget}),i(r,"target",function(){return this.$target}),r.$setTarget=function(t){return this.$target=t,!0},r.isDefaultPrevented=function(){return this.$isDefaultPrevented},r.preventDefault=function(){this.$cancelable&&(this.$isDefaultPrevented=!0)},r.stopPropagation=function(){this.$bubbles&&(this.$isPropagationStopped=!0)},r.stopImmediatePropagation=function(){this.$bubbles&&(this.$isPropagationImmediateStopped=!0)},r.clean=function(){this.data=this.$currentTarget=null,this.$setTarget(null)},e.dispatchEvent=function(t,i,n,r){void 0===n&&(n=!1);var s=e.create(e,i,n),a=e._getPropertyData(e);void 0!=r&&(a.data=r);var o=t.dispatchEvent(s);return e.release(s),o},e._getPropertyData=function(t){var e=t._props;return e||(e=t._props={}),e},e.create=function(t,e,i,n){var r=t.eventPool;if(r||(r=t.eventPool=[]),r.length){var s=r.pop();return s.$type=e,s.$bubbles=!!i,s.$cancelable=!!n,s.$isDefaultPrevented=!1,s.$isPropagationStopped=!1,s.$isPropagationImmediateStopped=!1,s.$eventPhase=2,s}return new t(e,i,n)},e.release=function(t){t.clean();var e=Object.getPrototypeOf(t).constructor;e.eventPool.push(t)},e.ADDED_TO_STAGE="addedToStage",e.REMOVED_FROM_STAGE="removedFromStage",e.ADDED="added",e.REMOVED="removed",e.ENTER_FRAME="enterFrame",e.RENDER="render",e.RESIZE="resize",e.CHANGE="change",e.CHANGING="changing",e.COMPLETE="complete",e.LOOP_COMPLETE="loopComplete",e.FOCUS_IN="focusIn",e.FOCUS_OUT="focusOut",e.ENDED="ended",e.ACTIVATE="activate",e.DEACTIVATE="deactivate",e.CLOSE="close",e.CONNECT="connect",e.LEAVE_STAGE="leaveStage",e.SOUND_COMPLETE="soundComplete",e}(t.HashObject);t.Event=e,t.registerClass(e,"egret.Event")}(egret||(egret={}));var egret;!function(t){var e=function(t){function e(e,i,n){void 0===i&&(i=!1),void 0===n&&(n=!1),t.call(this,e,i,n)}__extends(e,t);var i=e;return i.prototype,e.FOCUS_IN="focusIn",e.FOCUS_OUT="focusOut",e}(t.Event);t.FocusEvent=e,t.registerClass(e,"egret.FocusEvent")}(egret||(egret={}));var egret;!function(t){var e=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=e;return i.prototype,e.PERMISSION_DENIED="permissionDenied",e.UNAVAILABLE="unavailable",e}(t.Event);t.GeolocationEvent=e,t.registerClass(e,"egret.GeolocationEvent")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(t,i,n){void 0===i&&(i=!1),void 0===n&&(n=!1),e.call(this,t,i,n),this._status=0}__extends(i,e);var n=__define,r=i,s=r.prototype;return n(s,"status",function(){return this._status}),i.dispatchHTTPStatusEvent=function(e,n){var r=t.Event.create(i,i.HTTP_STATUS);r._status=n;var s=e.dispatchEvent(r);return t.Event.release(r),s},i.HTTP_STATUS="httpStatus",i}(t.Event);t.HTTPStatusEvent=e,t.registerClass(e,"egret.HTTPStatusEvent")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(t,i,n){void 0===i&&(i=!1),void 0===n&&(n=!1),e.call(this,t,i,n)}__extends(i,e);var n=i;return n.prototype,i.dispatchIOErrorEvent=function(e){var n=t.Event.create(i,i.IO_ERROR),r=e.dispatchEvent(n);return t.Event.release(n),r},i.IO_ERROR="ioError",i}(t.Event);t.IOErrorEvent=e,t.registerClass(e,"egret.IOErrorEvent")}(egret||(egret={}));var egret;!function(t){var e=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=e;return i.prototype,e}(t.Event);t.MotionEvent=e,t.registerClass(e,"egret.MotionEvent")}(egret||(egret={}));var egret;!function(t){var e=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=e;return i.prototype,e}(t.Event);t.OrientationEvent=e,t.registerClass(e,"egret.OrientationEvent")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(t,i,n,r,s){void 0===i&&(i=!1),void 0===n&&(n=!1),void 0===r&&(r=0),void 0===s&&(s=0),e.call(this,t,i,n),this.bytesLoaded=0,this.bytesTotal=0,this.bytesLoaded=r,this.bytesTotal=s}__extends(i,e);var n=i;return n.prototype,i.dispatchProgressEvent=function(e,n,r,s){void 0===r&&(r=0),void 0===s&&(s=0);var a=t.Event.create(i,n);a.bytesLoaded=r,a.bytesTotal=s;var o=e.dispatchEvent(a);return t.Event.release(a),o},i.PROGRESS="progress",i.SOCKET_DATA="socketData",i}(t.Event);t.ProgressEvent=e,t.registerClass(e,"egret.ProgressEvent")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(t,i,n){void 0===i&&(i=!1),void 0===n&&(n=!1),e.call(this,t,i,n)}__extends(i,e);var n=i;return n.prototype,i.dispatchStageOrientationEvent=function(e,n){var r=t.Event.create(i,n),s=e.dispatchEvent(r);return t.Event.release(r),s},i.ORIENTATION_CHANGE="orientationChange",i}(t.Event);t.StageOrientationEvent=e,t.registerClass(e,"egret.StageOrientationEvent")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(t,i,n,r){void 0===i&&(i=!1),void 0===n&&(n=!1),void 0===r&&(r=""),e.call(this,t,i,n),this.text=r}__extends(i,e);var n=i;return n.prototype,i.dispatchTextEvent=function(e,n,r){var s=t.Event.create(i,n);s.text=r;var a=e.dispatchEvent(s);return t.Event.release(s),a},i.LINK="link",i}(t.Event);t.TextEvent=e,t.registerClass(e,"egret.TextEvent")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(t,i,n){e.call(this,t,i,n)}__extends(i,e);var n=i,r=n.prototype;return r.updateAfterEvent=function(){t.sys.$requestRenderingFlag=!0},i.dispatchTimerEvent=function(e,n,r,s){var a=t.Event.create(i,n,r,s),o=e.dispatchEvent(a);return t.Event.release(a),o},i.TIMER="timer",i.TIMER_COMPLETE="timerComplete",i}(t.Event);t.TimerEvent=e,t.registerClass(e,"egret.TimerEvent")}(egret||(egret={}));var egret;!function(t){var e=[],i=Math.PI/180,n=function(n){function r(t,e){void 0===t&&(t=0),void 0===e&&(e=0),n.call(this),this.x=t,this.y=e}__extends(r,n);var s=__define,a=r,o=a.prototype;return r.release=function(t){t&&e.push(t)},r.create=function(t,i){var n=e.pop();return n||(n=new r),n.setTo(t,i)},s(o,"length",function(){return Math.sqrt(this.x*this.x+this.y*this.y)}),o.setTo=function(t,e){return this.x=t,this.y=e,this},o.clone=function(){return new r(this.x,this.y)},o.equals=function(t){return this.x==t.x&&this.y==t.y},r.distance=function(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))},o.copyFrom=function(t){this.x=t.x,this.y=t.y},o.add=function(t){return new r(this.x+t.x,this.y+t.y)},r.interpolate=function(t,e,i){var n=1-i;return new r(t.x*i+e.x*n,t.y*i+e.y*n)},o.normalize=function(t){if(0!=this.x||0!=this.y){var e=t/this.length;this.x*=e,this.y*=e}},o.offset=function(t,e){this.x+=t,this.y+=e},r.polar=function(e,n){return new r(e*t.NumberUtils.cos(n/i),e*t.NumberUtils.sin(n/i))},o.subtract=function(t){return new r(this.x-t.x,this.y-t.y)},o.toString=function(){return"(x="+this.x+", y="+this.y+")"},r}(t.HashObject);t.Point=n,t.registerClass(n,"egret.Point"),t.$TempPoint=new n}(egret||(egret={}));var egret;!function(t){var e=new t.Point,i=function(i){function n(t,e,n,r,s,a){i.call(this,t,e,n),this.targetChanged=!0,this.touchDown=!1,this.$initTo(r,s,a)}__extends(n,i);var r=__define,s=n,a=s.prototype;return a.$initTo=function(t,e,i){this.touchPointID=+i||0,this.$stageX=+t||0,this.$stageY=+e||0},r(a,"stageX",function(){return this.$stageX}),r(a,"stageY",function(){return this.$stageY}),r(a,"localX",function(){return this.targetChanged&&this.getLocalXY(),this._localX}),r(a,"localY",function(){return this.targetChanged&&this.getLocalXY(),this._localY}),a.getLocalXY=function(){this.targetChanged=!1;var t=this.$target.$getInvertedConcatenatedMatrix();t.transformPoint(this.$stageX,this.$stageY,e),this._localX=e.x,this._localY=e.y},a.$setTarget=function(t){return this.$target=t,this.targetChanged=!!t,!0},a.updateAfterEvent=function(){t.sys.$requestRenderingFlag=!0},n.dispatchTouchEvent=function(e,i,r,s,a,o,h,l){if(void 0===l&&(l=!1),!r&&!e.hasEventListener(i))return!0;var u=t.Event.create(n,i,r,s);u.$initTo(a,o,h),u.touchDown=l;var c=e.dispatchEvent(u);return t.Event.release(u),c},n.TOUCH_MOVE="touchMove",n.TOUCH_BEGIN="touchBegin",n.TOUCH_END="touchEnd",n.TOUCH_CANCEL="touchcancel",n.TOUCH_TAP="touchTap",n.TOUCH_RELEASE_OUTSIDE="touchReleaseOutside",n.TOUCH_ROLL_OUT="touchRollOut",n.TOUCH_ROLL_OVER="touchRollOver",n}(t.Event);t.TouchEvent=i,t.registerClass(i,"egret.TouchEvent")}(egret||(egret={}));var egret;!function(){}(egret||(egret={}));var egret;!function(t){var e=function(t){function e(){t.apply(this,arguments),this.type=null,this.$targets=[]}__extends(e,t);var i=e,n=i.prototype;return n.$addTarget=function(t){for(var e=this.$targets.length,i=0;e>i;i++)if(this.$targets[i].$hashCode==t.$hashCode)return;this.$targets.push(t)},n.$removeTarget=function(t){for(var e=this.$targets.length,i=0;e>i;i++)if(this.$targets[i].$hashCode==t.$hashCode)return void this.$targets.splice(i,1)},n.invalidate=function(){for(var t=this.$targets.length,e=0;t>e;e++)this.$targets[e].$invalidateContentBounds()},n.$toJson=function(){return""},e}(t.HashObject);t.Filter=e,t.registerClass(e,"egret.Filter")}(egret||(egret={}));var egret;!function(t){var e=function(t){function e(e,i,n){void 0===e&&(e=4),void 0===i&&(i=4),void 0===n&&(n=1),t.call(this),this.type="blur",this.$blurX=e,this.$blurY=i,this.$quality=n}__extends(e,t);var i=__define,n=e,r=n.prototype;return i(r,"blurX",function(){return this.$blurX},function(t){this.$blurX!=t&&(this.$blurX=t,this.invalidate())}),i(r,"blurY",function(){return this.$blurY},function(t){this.$blurY!=t&&(this.$blurY=t,this.invalidate())}),r.$toJson=function(){return'{"blurX": '+this.$blurX+', "blurY": '+this.$blurY+', "quality": 1}'},e}(t.Filter);t.BlurFilter=e,t.registerClass(e,"egret.BlurFilter")}(egret||(egret={}));var egret;!function(t){var e=function(t){function e(e){void 0===e&&(e=null),t.call(this),this.$matrix=[],this.matrix2=[],this.type="colorTransform",this.setMatrix(e)}__extends(e,t);var i=__define,n=e,r=n.prototype;return i(r,"matrix",function(){for(var t=0;20>t;t++)this.matrix2[t]=this.$matrix[t];return this.matrix2},function(t){this.setMatrix(t),this.invalidate()}),r.setMatrix=function(t){if(t)for(var e=0;20>e;e++)this.$matrix[e]=t[e];else for(var e=0;20>e;e++)this.$matrix[e]=0==e||6==e||12==e||18==e?1:0},r.$toJson=function(){return'{"matrix": ['+this.$matrix.toString()+"]}"},e}(t.Filter);t.ColorMatrixFilter=e,t.registerClass(e,"egret.ColorMatrixFilter")}(egret||(egret={}));var egret;!function(t){var e=function(t){function e(e,i,n,r,s,a,o,h){void 0===e&&(e=16711680),void 0===i&&(i=1),void 0===n&&(n=6),void 0===r&&(r=6),void 0===s&&(s=2),void 0===a&&(a=1),void 0===o&&(o=!1),void 0===h&&(h=!1),t.call(this),this.type="glow",this.$color=e,this.$blue=255&e,this.$green=(65280&e)>>8,this.$red=e>>16,this.$alpha=i,this.$blurX=n,this.$blurY=r,this.$strength=s,this.$quality=a,this.$inner=o,this.$knockout=h}__extends(e,t);var i=__define,n=e,r=n.prototype;return i(r,"color",function(){return this.$color},function(t){this.$color!=t&&(this.$color=t,this.$blue=255&t,this.$green=(65280&t)>>8,this.$red=t>>16,this.invalidate())}),i(r,"alpha",function(){return this.$alpha},function(t){this.$alpha!=t&&(this.$alpha=t,this.invalidate())}),i(r,"blurX",function(){return this.$blurX},function(t){this.$blurX!=t&&(this.$blurX=t,this.invalidate())}),i(r,"blurY",function(){return this.$blurY},function(t){this.$blurY!=t&&(this.$blurY=t,this.invalidate())}),i(r,"strength",function(){return this.$strength},function(t){this.$strength!=t&&(this.$strength=t,this.invalidate())}),i(r,"quality",function(){return this.$quality},function(t){this.$quality!=t&&(this.$quality=t,this.invalidate())}),i(r,"inner",function(){return this.$inner},function(t){this.$inner!=t&&(this.$inner=t,this.invalidate())}),i(r,"knockout",function(){return this.$knockout},function(t){this.$knockout!=t&&(this.$knockout=t,this.invalidate())}),r.$toJson=function(){return'{"color": '+this.$color+', "red": '+this.$red+', "green": '+this.$green+', "blue": '+this.$blue+', "alpha": '+this.$alpha+', "blurX": '+this.$blurX+', "blurY": '+this.blurY+', "strength": '+this.$strength+', "quality": '+this.$quality+', "inner": '+this.$inner+', "knockout": '+this.$knockout+"}"},e}(t.Filter);t.GlowFilter=e,t.registerClass(e,"egret.GlowFilter")}(egret||(egret={}));var egret;!function(t){var e=function(t){function e(e,i,n,r,s,a,o,h,l,u,c){void 0===e&&(e=4),void 0===i&&(i=45),void 0===n&&(n=0),void 0===r&&(r=1),void 0===s&&(s=4),void 0===a&&(a=4),void 0===o&&(o=1),void 0===h&&(h=1),void 0===l&&(l=!1),void 0===u&&(u=!1),void 0===c&&(c=!1),t.call(this,n,r,s,a,o,h,l,u),this.$distance=e,this.$angle=i,this.$hideObject=c}__extends(e,t);
var i=__define,n=e,r=n.prototype;return i(r,"distance",function(){return this.$distance},function(t){this.$distance!=t&&(this.$distance=t,this.invalidate())}),i(r,"angle",function(){return this.$angle},function(t){this.$angle!=t&&(this.$angle=t,this.invalidate())}),i(r,"hideObject",function(){return this.$hideObject},function(t){this.$hideObject!=t&&(this.$hideObject=t,this.invalidate())}),r.$toJson=function(){return'{"distance": '+this.$distance+', "angle": '+this.$angle+', "color": '+this.$color+', "red": '+this.$red+', "green": '+this.$green+', "blue": '+this.$blue+', "alpha": '+this.$alpha+', "blurX": '+this.$blurX+', "blurY": '+this.blurY+', "strength": '+this.$strength+', "quality": '+this.$quality+', "inner": '+this.$inner+', "knockout": '+this.$knockout+', "hideObject": '+this.$hideObject+"}"},e}(t.GlowFilter);t.DropShadowFilter=e,t.registerClass(e,"egret.DropShadowFilter")}(egret||(egret={}));var egret;!function(t){var e=Math.PI,i=2*e,n=e/180,r=[],s=function(s){function a(t,e,i,n,r,a){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===r&&(r=0),void 0===a&&(a=0),s.call(this),this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=a}__extends(a,s);var o=a,h=o.prototype;return a.release=function(t){t&&r.push(t)},a.create=function(){var t=r.pop();return t||(t=new a),t},h.clone=function(){return new a(this.a,this.b,this.c,this.d,this.tx,this.ty)},h.concat=function(t){var e=this.a*t.a,i=0,n=0,r=this.d*t.d,s=this.tx*t.a+t.tx,a=this.ty*t.d+t.ty;(0!==this.b||0!==this.c||0!==t.b||0!==t.c)&&(e+=this.b*t.c,r+=this.c*t.b,i+=this.a*t.b+this.b*t.d,n+=this.c*t.a+this.d*t.c,s+=this.ty*t.c,a+=this.tx*t.b),this.a=e,this.b=i,this.c=n,this.d=r,this.tx=s,this.ty=a},h.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},h.identity=function(){this.a=this.d=1,this.b=this.c=this.tx=this.ty=0},h.invert=function(){this.$invertInto(this)},h.$invertInto=function(t){var e=this.a,i=this.b,n=this.c,r=this.d,s=this.tx,a=this.ty;if(0==i&&0==n)return t.b=t.c=0,void(0==e||0==r?t.a=t.d=t.tx=t.ty=0:(e=t.a=1/e,r=t.d=1/r,t.tx=-e*s,t.ty=-r*a));var o=e*r-i*n;if(0==o)return void t.identity();o=1/o;var h=t.a=r*o;i=t.b=-i*o,n=t.c=-n*o,r=t.d=e*o,t.tx=-(h*s+n*a),t.ty=-(i*s+r*a)},h.rotate=function(e){if(e=+e,0!==e){e/=n;var i=t.NumberUtils.cos(e),r=t.NumberUtils.sin(e),s=this.a,a=this.b,o=this.c,h=this.d,l=this.tx,u=this.ty;this.a=s*i-a*r,this.b=s*r+a*i,this.c=o*i-h*r,this.d=o*r+h*i,this.tx=l*i-u*r,this.ty=l*r+u*i}},h.scale=function(t,e){1!==t&&(this.a*=t,this.c*=t,this.tx*=t),1!==e&&(this.b*=e,this.d*=e,this.ty*=e)},h.setTo=function(t,e,i,n,r,s){return this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=s,this},h.transformPoint=function(e,i,n){var r=this.a*e+this.c*i+this.tx,s=this.b*e+this.d*i+this.ty;return n?(n.setTo(r,s),n):new t.Point(r,s)},h.translate=function(t,e){this.tx+=t,this.ty+=e},h.equals=function(t){return this.a==t.a&&this.b==t.b&&this.c==t.c&&this.d==t.d&&this.tx==t.tx&&this.ty==t.ty},h.prepend=function(t,e,i,n,r,s){var a=this.tx;if(1!=t||0!=e||0!=i||1!=n){var o=this.a,h=this.c;this.a=o*t+this.b*i,this.b=o*e+this.b*n,this.c=h*t+this.d*i,this.d=h*e+this.d*n}return this.tx=a*t+this.ty*i+r,this.ty=a*e+this.ty*n+s,this},h.append=function(t,e,i,n,r,s){var a=this.a,o=this.b,h=this.c,l=this.d;return(1!=t||0!=e||0!=i||1!=n)&&(this.a=t*a+e*h,this.b=t*o+e*l,this.c=i*a+n*h,this.d=i*o+n*l),this.tx=r*a+s*h+this.tx,this.ty=r*o+s*l+this.ty,this},h.deltaTransformPoint=function(e){var i=this,n=i.a*e.x+i.c*e.y,r=i.b*e.x+i.d*e.y;return new t.Point(n,r)},h.toString=function(){return"(a="+this.a+", b="+this.b+", c="+this.c+", d="+this.d+", tx="+this.tx+", ty="+this.ty+")"},h.createBox=function(e,i,r,s,a){void 0===r&&(r=0),void 0===s&&(s=0),void 0===a&&(a=0);var o=this;if(0!==r){r/=n;var h=t.NumberUtils.cos(r),l=t.NumberUtils.sin(r);o.a=h*e,o.b=l*i,o.c=-l*e,o.d=h*i}else o.a=e,o.b=0,o.c=0,o.d=i;o.tx=s,o.ty=a},h.createGradientBox=function(t,e,i,n,r){void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),this.createBox(t/1638.4,e/1638.4,i,n+t/2,r+e/2)},h.$transformBounds=function(t){var e=this.a,i=this.b,n=this.c,r=this.d,s=this.tx,a=this.ty,o=t.x,h=t.y,l=o+t.width,u=h+t.height,c=e*o+n*h+s,d=i*o+r*h+a,f=e*l+n*h+s,g=i*l+r*h+a,p=e*l+n*u+s,v=i*l+r*u+a,$=e*o+n*u+s,m=i*o+r*u+a,y=0;c>f&&(y=c,c=f,f=y),p>$&&(y=p,p=$,$=y),t.x=Math.floor(p>c?c:p),t.width=Math.ceil((f>$?f:$)-t.x),d>g&&(y=d,d=g,g=y),v>m&&(y=v,v=m,m=y),t.y=Math.floor(v>d?d:v),t.height=Math.ceil((g>m?g:m)-t.y)},h.getDeterminant=function(){return this.a*this.d-this.b*this.c},h.$getScaleX=function(){var t=this;if(1==t.a&&0==t.b)return 1;var e=Math.sqrt(t.a*t.a+t.b*t.b);return this.getDeterminant()<0?-e:e},h.$getScaleY=function(){var t=this;if(0==t.c&&1==t.d)return 1;var e=Math.sqrt(t.c*t.c+t.d*t.d);return this.getDeterminant()<0?-e:e},h.$getSkewX=function(){return Math.atan2(this.d,this.c)-e/2},h.$getSkewY=function(){return Math.atan2(this.b,this.a)},h.$updateScaleAndRotation=function(e,r,s,a){if(!(0!=s&&s!=i||0!=a&&a!=i))return this.a=e,this.b=this.c=0,void(this.d=r);s/=n,a/=n;var o=t.NumberUtils.cos(s),h=t.NumberUtils.sin(s);s==a?(this.a=o*e,this.b=h*e):(this.a=t.NumberUtils.cos(a)*e,this.b=t.NumberUtils.sin(a)*e),this.c=-h*r,this.d=o*r},h.$preMultiplyInto=function(t,e){var i=t.a*this.a,n=0,r=0,s=t.d*this.d,a=t.tx*this.a+this.tx,o=t.ty*this.d+this.ty;(0!==t.b||0!==t.c||0!==this.b||0!==this.c)&&(i+=t.b*this.c,s+=t.c*this.b,n+=t.a*this.b+t.b*this.d,r+=t.c*this.a+t.d*this.c,a+=t.ty*this.c,o+=t.tx*this.b),e.a=i,e.b=n,e.c=r,e.d=s,e.tx=a,e.ty=o},a}(t.HashObject);t.Matrix=s,t.registerClass(s,"egret.Matrix"),t.$TempMatrix=new s}(egret||(egret={}));var egret;!function(t){t.$locale_strings=t.$locale_strings||{},t.$locale_strings.en_US=t.$locale_strings.en_US||{};var e=t.$locale_strings.en_US;e[1001]="Could not find Egret entry class: {0}",e[1002]="Egret entry class '{0}' must inherit from egret.DisplayObject.",e[1003]="Parameter {0} must be non-null.",e[1004]="An object cannot be added as a child to one of it's children (or children's children, etc.).",e[1005]="An object cannot be added as a child of itself.",e[1006]="The supplied DisplayObject must be a child of the caller.",e[1007]="An index specified for a parameter was out of range.",e[1008]="Instantiate singleton errorsingleton class {0} can not create multiple instances.",e[1009]='the Class {0} cannot use the property "{1}"',e[1010]='the property "{1}" of the Class "{0}" is readonly',e[1011]="Stream Error. URL: {0}",e[1012]="The type of parameter {0} must be Class.",e[1013]="Variable assignment is NaN, please see the code!",e[1014]='the constant "{1}" of the Class "{0}" is read-only',e[1015]="xml not found!",e[1016]="{0}has been obsoleted",e[1017]="The format of JSON file is incorrect: {0}\ndata: {1}",e[1018]="the scale9Grid is not correct",e[1019]="Network ab:{0}",e[1020]="Cannot initialize Shader",e[1021]="Current browser does not support webgl",e[1022]="{0} ArgumentError",e[1023]="This method is not available in the ScrollView!",e[1025]="end of the file",e[1026]="! EncodingError The code point {0} could not be encoded.",e[1027]="DecodingError",e[1028]=". called injection is not configured rule: {0}, please specify configuration during its initial years of injection rule, and then call the corresponding single case.",e[1029]="Function.prototype.bind - what is trying to be bound is not callable",e[1033]="Photos can not be used across domains toDataURL to convert base64",e[1034]='Music file decoding failed: "{0}", please use the standard conversion tool reconversion under mp3.',e[1035]="Native does not support this feature!",e[1036]="Sound has stopped, please recall Sound.play () to play the sound!",e[1037]="Non-load the correct blob!",e[1038]="XML format error!",e[1039]="crossOrigin images can not set pixelHitTest  property!",e[1040]="hitTestPoint can not detect crossOrigin images! Please check if the display object has crossOrigin elements.",e[1041]="egret.MainContext.runtimeType is deprecated, please use egret.Capabilities.runtimeType replace",e[1042]="The parameters passed in the region needs is an integer in drawToTexture method. Otherwise, some browsers will draw abnormal.",e[1043]="Compile errors in {0}, the attribute name: {1}, the attribute value: {2}.",e[1044]="The current version of the Runtime does not support video playback, please use the latest version",e[1045]="The resource url is not found",e[1046]="BitmapText no corresponding characters: {0}, please check the configuration file",e[1047]="egret.localStorage.setItem save failed,key={0}&value={1}",e[1048]="Video loading failed",e[1049]="In the absence of sound is not allowed to play after loading",e[3e3]="Theme configuration file failed to load: {0}",e[3001]="Cannot find the skin name which is configured in Theme: {0}",e[3002]='Index:"{0}" is out of the collection element index range',e[3003]="Cannot be available in this component. If this component is container, please continue to use",e[3004]="addChild(){0}addElement() replace",e[3005]="addChildAt(){0}addElementAt() replace",e[3006]="removeChild(){0}removeElement() replace",e[3007]="removeChildAt(){0}removeElementAt() replace",e[3008]="setChildIndex(){0}setElementIndex() replace",e[3009]="swapChildren(){0}swapElements() replace",e[3010]="swapChildrenAt(){0}swapElementsAt() replace",e[3011]='Index:"{0}" is out of the visual element index range',e[3012]="This method is not available in Scroller component!",e[3013]="UIStage is GUI root container, and only one such instant is in the display list",e[3014]="set fullscreen error",e[3100]="Current browser does not support WebSocket",e[3101]="Please connect Socket firstly",e[3102]="Please set the type of binary type",e[4e3]="An Bone cannot be added as a child to itself or one of its children (or children's children, etc.)",e[4001]="Abstract class can not be instantiated!",e[4002]="Unnamed data!",e[4003]="Nonsupport version!"}(egret||(egret={}));var egret;!function(t){t.$locale_strings=t.$locale_strings||{},t.$language="en_US"}(egret||(egret={}));var egret;!function(t){var e;!function(e){function i(e){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var r=t.$locale_strings[t.$language][e];if(!r)return"{"+e+"}";for(var s=i.length,a=0;s>a;a++)r=r.replace("{"+a+"}",i[a]);return r}e.tr=i}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){t.$locale_strings=t.$locale_strings||{},t.$locale_strings.zh_CN=t.$locale_strings.zh_CN||{};var e=t.$locale_strings.zh_CN;e[1001]="Egret: {0}",e[1002]="Egret {0} egret.DisplayObject",e[1003]=" {0}  null",e[1004]="",e[1005]="",e[1006]=" DisplayObject ",e[1007]="",e[1008]=" {0} ",e[1009]=" {0}  {1}",e[1010]=" {0}  {1} ",e[1011]="URL: {0}",e[1012]=" {0}  Class",e[1013]="NaN",e[1014]=" {0}  {1} ",e[1015]="xml not found!",e[1016]="{0}",e[1017]="JSON: {0}\ndata: {1}",e[1018]="9",e[1019]=":{0}",e[1020]="",e[1021]="webgl",e[1022]="{0} ArgumentError",e[1023]="ScrollView!",e[1025]="",e[1026]="EncodingError! The code point {0} could not be encoded.",e[1027]="DecodingError",e[1028]=":{0} ",e[1029]="Function.prototype.bind - what is trying to be bound is not callable",e[1033]="toDataURLbase64",e[1034]='"{0}"mp3',e[1035]="Native ",e[1036]=" Sound.play() ",e[1037]="blob",e[1038]="XML !",e[1039]=" pixelHitTest !",e[1040]="hitTestPoint ! ",e[1041]="egret.MainContext.runtimeType ,egret.Capabilities.runtimeType ",e[1042]="drawToTexture,",e[1043]="{0}  : {1} : {2}",e[1044]=" runtime ,",e[1045]="",e[1046]="BitmapText :{0}",e[1047]="egret.localStorage.setItem,key={0}&value={1}",e[1048]="",e[1049]="",e[3e3]=": {0}",e[3001]=": {0}",e[3002]=':"{0}"',e[3003]="",e[3004]="addChild(){0}addElement()",e[3005]="addChildAt(){0}addElementAt()",e[3006]="removeChild(){0}removeElement()",e[3007]="removeChildAt(){0}removeElementAt()",e[3008]="setChildIndex(){0}setElementIndex()",e[3009]="swapChildren(){0}swapElements()",e[3010]="swapChildrenAt(){0}swapElementsAt()",e[3011]=':"{0}"',e[3012]="Scroller!",e[3013]="UIStageGUI",e[3014]="",e[3100]="WebSocket",e[3101]="WebSocket",e[3102]="type",e[4e3]="An Bone cannot be added as a child to itself or one of its children (or children's children, etc.)",e[4001]="Abstract class can not be instantiated!",e[4002]="Unnamed data!",e[4003]="Nonsupport version!"}(egret||(egret={}));var egret;!function(t){var e;!function(){}(e=t.localStorage||(t.localStorage={}))}(egret||(egret={}));var egret;!function(t){var e;!function(t){function e(t){n.indexOf(t)<0&&n.push(t)}function i(t){var e=n.indexOf(t);return e>=0?(n.splice(e,1),!0):!1}var n=[];t.$pushSoundChannel=e,t.$popSoundChannel=i}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(){}(egret||(egret={}));var egret;!function(){}(egret||(egret={}));var egret;!function(t){var e=function(){function e(){this.onSuccessFunc=null,this.onSuccessThisObject=null,this.onErrorFunc=null,this.onErrorThisObject=null,this.downloadingSizeFunc=null,this.downloadingSizeThisObject=null,this.onResponseHeaderFunc=null,this.onResponseHeaderThisObject=null}var i=e,n=i.prototype;return e.create=function(){return e.promiseObjectList.length?e.promiseObjectList.pop():new t.PromiseObject},n.onSuccess=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];this.onSuccessFunc&&this.onSuccessFunc.apply(this.onSuccessThisObject,t),this.destroy()},n.onError=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];this.onErrorFunc&&this.onErrorFunc.apply(this.onErrorThisObject,t),this.destroy()},n.downloadingSize=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];this.downloadingSizeFunc&&this.downloadingSizeFunc.apply(this.downloadingSizeThisObject,t)},n.onResponseHeader=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];this.onResponseHeaderFunc&&this.onResponseHeaderFunc.apply(this.onResponseHeaderThisObject,t)},n.destroy=function(){this.onSuccessFunc=void 0,this.onSuccessThisObject=void 0,this.onErrorFunc=void 0,this.onErrorThisObject=void 0,this.downloadingSizeFunc=void 0,this.downloadingSizeThisObject=void 0,this.onResponseHeaderFunc=void 0,this.onResponseHeaderThisObject=void 0,e.promiseObjectList.push(this)},e.promiseObjectList=[],e}();t.PromiseObject=e,t.registerClass(e,"egret.PromiseObject")}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}var e=t;return e.prototype,t.GET="GET",t.POST="POST",t}();t.HttpMethod=e,t.registerClass(e,"egret.HttpMethod")}(egret||(egret={}));var egret;!function(){}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}var e=t;return e.prototype,t.TEXT="text",t.ARRAY_BUFFER="arraybuffer",t}();t.HttpResponseType=e,t.registerClass(e,"egret.HttpResponseType")}(egret||(egret={}));var egret;!function(){}(egret||(egret={}));var egret;!function(t){var e;!function(e){function i(t,e){var i=t.minX<e.minX?t.minX:e.minX,n=t.minY<e.minY?t.minY:e.minY,r=t.maxX>e.maxX?t.maxX:e.maxX,s=t.maxY>e.maxY?t.maxY:e.maxY;return(r-i)*(s-n)}var n=function(){function n(e){this.dirtyList=[],this.hasClipRect=!1,this.clipWidth=0,this.clipHeight=0,this.clipArea=0,this.clipRectChanged=!1,this.$dirtyRegionPolicy=t.DirtyRegionPolicy.ON,this.root=e}var r=n,s=r.prototype;return s.setClipRect=function(t,e){this.hasClipRect=!0,this.clipRectChanged=!0,this.clipWidth=Math.ceil(t),this.clipHeight=Math.ceil(e),this.clipArea=this.clipWidth*this.clipHeight},s.addRegion=function(i){var n=i.minX,r=i.minY,s=i.maxX,a=i.maxY;if(this.hasClipRect&&(0>n&&(n=0),0>r&&(r=0),s>this.clipWidth&&(s=this.clipWidth),a>this.clipHeight&&(a=this.clipHeight)),n>=s||r>=a)return!1;if(this.clipRectChanged)return!0;var o=this.dirtyList,h=e.Region.create();return o.push(h.setTo(n,r,s,a)),this.$dirtyRegionPolicy!=t.DirtyRegionPolicy.OFF&&this.mergeDirtyList(o),!0},s.clear=function(){for(var t=this.dirtyList,i=t.length,n=0;i>n;n++)e.Region.release(t[n]);t.length=0},s.getDirtyRegions=function(){var i=this.dirtyList;if(this.$dirtyRegionPolicy==t.DirtyRegionPolicy.OFF||t.Capabilities.runtimeType==t.RuntimeType.NATIVE&&!t["native"].$supportCanvas){this.clipRectChanged=!0,this.clear();var n=e.Region.create();if(this.hasClipRect)i.push(n.setTo(0,0,this.clipWidth,this.clipHeight));else{var r=this.root.$getOriginalBounds();i.push(n.setTo(r.x,r.y,r.width,r.height))}}else if(this.clipRectChanged){this.clipRectChanged=!1,this.clear();var n=e.Region.create();i.push(n.setTo(0,0,this.clipWidth,this.clipHeight))}else for(;this.mergeDirtyList(i););var s=this.dirtyList.length;if(s>0)for(var a=0;s>a;a++)this.dirtyList[a].intValues();return this.dirtyList},s.mergeDirtyList=function(t){var n=t.length;if(2>n)return!1;for(var r=this.hasClipRect,s=n>3?Number.POSITIVE_INFINITY:0,a=0,o=0,h=0,l=0;n-1>l;l++){var u=t[l];r&&(h+=u.area);for(var c=l+1;n>c;c++){var d=t[c],f=i(u,d)-u.area-d.area;s>f&&(a=l,o=c,s=f)}}if(r&&h/this.clipArea>.95&&(this.clipRectChanged=!0),a!=o){var g=t[o];return t[a].union(g),e.Region.release(g),t.splice(o,1),!0}return!1},s.setDirtyRegionPolicy=function(t){this.$dirtyRegionPolicy=t},n}();e.DirtyRegion=n,t.registerClass(n,"egret.sys.DirtyRegion")}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(i){function n(n){i.call(this),this.isStage=!1,this.$renderNode=new e.BitmapNode,this.renderBuffer=null,this.offsetX=0,this.offsetY=0,this.offsetMatrix=new t.Matrix,this.isDirty=!1,this.needUpdateRegions=!1,this.dirtyNodeList=[],this.dirtyList=null,this.sizeChanged=!1,this.$dirtyRegionPolicy=t.DirtyRegionPolicy.ON,this.root=n,this.dirtyRegion=new e.DirtyRegion(n),this.isStage=n instanceof t.Stage,this.dirtyNodes=t.createMap()}__extends(n,i);var r=n,s=r.prototype;return n.create=function(i){var n=new t.sys.DisplayList(i);try{var r=new e.RenderBuffer}catch(s){return null}return n.renderBuffer=r,n.root=i,n},s.$getRenderNode=function(){return this.$renderNode},s.$update=function(e){var i=this.root;if(null==i)return!1;i.$removeFlagsUp(768);var n=this.$renderNode,r=i.$getConcatenatedMatrix();if(e==t.DirtyRegionPolicy.OFF){var s=i.$parentDisplayList;if(this.needUpdateRegions&&this.updateDirtyRegions(),!s)return!1;var a=n.renderMatrix;a.copyFrom(r);var o=s.root;o!==i.$stage&&i.$getConcatenatedMatrixAt(o,a)}else{var h=i.$getOriginalBounds(),s=i.$parentDisplayList,l=n.renderRegion;if(this.needUpdateRegions&&this.updateDirtyRegions(),!s)return l.setTo(0,0,0,0),n.moved=!1,!1;if(!n.moved)return!1;n.moved=!1;var a=n.renderMatrix;a.copyFrom(r);var o=s.root;o!==i.$stage&&i.$getConcatenatedMatrixAt(o,a),l.updateRegion(h,a)}return!0},s.setClipRect=function(t,e){this.dirtyRegion.setClipRect(t,e),this.renderBuffer.resize(t,e)},s.markDirty=function(t){var e=t.$hashCode;if(!this.dirtyNodes[e]&&(this.dirtyNodes[e]=!0,this.dirtyNodeList.push(t),!this.needUpdateRegions)){this.needUpdateRegions=!0,this.isDirty=!0;var i=this.root.$parentDisplayList;i&&i.markDirty(this)}},s.updateDirtyRegions=function(){var e=this.dirtyNodeList;this.dirtyNodeList=[],this.dirtyNodes=t.createMap(),this.needUpdateRegions=!1;for(var i=this.dirtyRegion,n=e.length,r=0;n>r;r++){var s=e[r],a=s.$getRenderNode();if(a)if(a.needRedraw=!1,this.isStage){a.renderAlpha>0&&a.renderVisible&&i.addRegion(a.renderRegion)&&(a.needRedraw=!0);var o=s.$update(this.$dirtyRegionPolicy);a.renderAlpha>0&&a.renderVisible&&(o||!a.needRedraw)&&i.addRegion(a.renderRegion)&&(a.needRedraw=!0)}else{i.addRegion(a.renderRegion)&&(a.needRedraw=!0);var o=s.$update(this.$dirtyRegionPolicy);(o||!a.needRedraw)&&i.addRegion(a.renderRegion)&&(a.needRedraw=!0)}}return this.dirtyList=i.getDirtyRegions(),this.dirtyList},s.drawToSurface=function(){var i=0,n=this.dirtyList;if(n&&n.length>0){this.isStage||this.changeSurfaceSize();var r=this.renderBuffer;r.beginClip(this.dirtyList,this.offsetX,this.offsetY);var n=this.$dirtyRegionPolicy==t.DirtyRegionPolicy.OFF?null:this.dirtyList,i=e.systemRenderer.render(this.root,r,this.offsetMatrix,n);if(r.endClip(),!this.isStage){var s=r.surface,a=this.$renderNode;a.drawData.length=0;var o=s.width,h=s.height;this.bitmapData?(this.bitmapData.source=s,this.bitmapData.width=o,this.bitmapData.height=h):this.bitmapData=new t.BitmapData(s),a.image=this.bitmapData,a.imageWidth=o,a.imageHeight=h,a.drawImage(0,0,o,h,-this.offsetX,-this.offsetY,o,h)}}return this.dirtyList=null,this.dirtyRegion.clear(),this.isDirty=!1,i},s.changeSurfaceSize=function(){var t=(this.root,this.offsetX),e=this.offsetY,i=this.root.$getOriginalBounds();this.offsetX=-i.x,this.offsetY=-i.y,this.offsetMatrix.setTo(1,0,0,1,this.offsetX,this.offsetY);var n=this.renderBuffer,r=Math.max(257,i.width),s=Math.max(257,i.height);(this.offsetX!=t||this.offsetY!=e||n.surface.width!=r||n.surface.height!=s)&&(this.sizeChanged?n.resizeTo(r,s,this.offsetX-t,this.offsetY-e):(this.sizeChanged=!0,n.resize(r,s)))},s.setDirtyRegionPolicy=function(t){this.$dirtyRegionPolicy=t,this.dirtyRegion.setDirtyRegionPolicy(t),this.renderBuffer.setDirtyRegionPolicy(t)},n}(t.HashObject);e.DisplayList=i,t.registerClass(i,"egret.sys.DisplayList",["egret.sys.Renderable"])}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(){}(egret||(egret={}));var egret;!function(){}(egret||(egret={}));var egret;!function(t){var e;!function(e){function i(i,n,r,s){if(n&&(t.log=function(){for(var t=arguments.length,i="",n=0;t>n;n++)i+=arguments[n]+" ";e.$logToFPS(i),console.log.apply(console,a(arguments))}),l=s?{}:s,n=!!n,this.showFPS=!!i,this.showLog=n,!this.fpsDisplay){var o=void 0===s.x?0:s.x,c=void 0===s.y?0:s.y;h=this.fpsDisplay=new FPS(this.stage,i,n,r,s),h.x=o,h.y=c;for(var d=u.length,f=0;d>f;f++)h.updateInfo(u[f]);u=null}}function n(t){t=!!t,this._showPaintRect!=t&&(this._showPaintRect=t,t?(this.stageDisplayList||(this.stageDisplayList=e.DisplayList.create(this.stage)),this.stage.$displayList=this.stageDisplayList):this.stage.$displayList=this.screenDisplayList)}function r(t){for(var e=t.length,i=[],n=0;e>n;n++){var r=t[n];i[n]=[r.minX,r.minY,r.width,r.height],r.width-=1,r.height-=1}var s=this.paintList;s.push(i),s.length>1&&s.shift();var a=this.screenDisplayList.renderBuffer,o=a.context;for(o.setTransform(1,0,0,1,0,0),o.clearRect(0,0,a.surface.width,a.surface.height),o.drawImage(this.stageDisplayList.renderBuffer.surface,0,0),e=s.length,n=0;e>n;n++){i=s[n];for(var h=i.length-1;h>=0;h--){var l=i[h];this.drawDirtyRect(l[0],l[1],l[2],l[3],o)}}o.save(),o.beginPath();for(var e=t.length,n=0;e>n;n++){var r=t[n];o.clearRect(r.minX,r.minY,r.width,r.height),o.rect(r.minX,r.minY,r.width,r.height)}o.clip(),o.drawImage(this.stageDisplayList.renderBuffer.surface,0,0),o.restore()}function s(t,e,i,n,r){r.strokeStyle="rgb(255,0,0)",r.lineWidth=5,r.strokeRect(t-.5,e-.5,i,n)}function a(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i]);return e}var o=function(a){function o(t,e,o){a.call(this),this.isPlaying=!1,this.entryClassName=o,this.stage=e,this.screenDisplayList=this.createDisplayList(e,t),this.showFPS=!1,this.showLog=!1,this._showPaintRect=!1,this.stageDisplayList=null,this.paintList=[],this.displayFPS=i,this.showPaintRect=n,this.drawPaintRect=r,this.drawDirtyRect=s}__extends(o,a);var h=o,l=h.prototype;return l.createDisplayList=function(t,i){var n=new e.DisplayList(t);return n.renderBuffer=i,t.$displayList=n,n},l.start=function(){!this.isPlaying&&this.stage&&(e.$TempStage=e.$TempStage||this.stage,this.isPlaying=!0,this.root||this.initialize(),e.$ticker.$addPlayer(this))},l.initialize=function(){var e;if(this.entryClassName&&(e=t.getDefinitionByName(this.entryClassName)),e){var i=new e;this.root=i,i instanceof t.DisplayObject&&this.stage.addChild(i)}},l.stop=function(){this.pause(),this.stage=null},l.pause=function(){this.isPlaying&&(this.isPlaying=!1,e.$ticker.$removePlayer(this))},l.$render=function(e,i){(this.showFPS||this.showLog)&&this.stage.addChild(this.fpsDisplay),this.callLaters(),this.callLaterAsyncs();var n=this.stage,r=t.getTimer(),s=n.$displayList.updateDirtyRegions(),a=t.getTimer();s=s.concat();var o=n.$displayList.drawToSurface();this._showPaintRect&&this.drawPaintRect(s);var h=t.getTimer();if(e&&this.showFPS){var l=0;if(o>0){for(var u=s.length,c=0,d=0;u>d;d++)c+=s[d].area;l=Math.ceil(1e3*c/(n.stageWidth*n.stageHeight))/10}this.fpsDisplay.update(o,l,a-r,h-a,i)}},l.callLaters=function(){if(t.$callLaterFunctionList.length>0){var e=t.$callLaterFunctionList;t.$callLaterFunctionList=[];var i=t.$callLaterThisList;t.$callLaterThisList=[];var n=t.$callLaterArgsList;t.$callLaterArgsList=[]}if(e)for(var r=e.length,s=0;r>s;s++){var a=e[s];null!=a&&a.apply(i[s],n[s])}},l.callLaterAsyncs=function(){if(t.$callAsyncFunctionList.length>0){var e=t.$callAsyncFunctionList,i=t.$callAsyncThisList,n=t.$callAsyncArgsList;t.$callAsyncFunctionList=[],t.$callAsyncThisList=[],t.$callAsyncArgsList=[];for(var r=0;r<e.length;r++){var s=e[r];null!=s&&s.apply(i[r],n[r])}}},l.updateStageSize=function(e,i){var n=this.stage;n.$stageWidth=e,n.$stageHeight=i,this.screenDisplayList.setClipRect(e,i),this.stageDisplayList&&this.stageDisplayList.setClipRect(e,i),n.dispatchEventWith(t.Event.RESIZE),n.$invalidate(!0)},o}(t.HashObject);e.Player=o,t.registerClass(o,"egret.sys.Player");var h,l,u=[];e.$logToFPS=function(t){return h?void h.updateInfo(t):void u.push(t)},FPS=function(i){function n(e,n,r,s,a){i.call(this),this.isFPS=!0,this.infoLines=[],this.totalTime=0,this.totalTick=0,this.lastTime=0,this.drawCalls=0,this.dirtyRatio=0,this.costDirty=0,this.costRender=0,this.costTicker=0,this._stage=e,this.showFPS=n,this.showLog=r,this.logFilter=s,this.touchChildren=!1,this.touchEnabled=!1,this.styles=a,this.fpsDisplay=new t.FPSDisplay(e,n,r,s,a),this.addChild(this.fpsDisplay);try{var o=s?new RegExp(s):null}catch(h){t.log(h)}this.filter=function(t){return o?o.test(t):!s||0==t.indexOf(s)}}return __extends(n,i),n.prototype.update=function(i,n,r,s,a){var o=t.getTimer();if(this.totalTime+=o-this.lastTime,this.lastTime=o,this.totalTick++,this.drawCalls+=i,this.dirtyRatio+=n,this.costDirty+=r,this.costRender+=s,this.costTicker+=a,this.totalTime>=1e3){var h=Math.min(Math.ceil(1e3*this.totalTick/this.totalTime),e.$ticker.$frameRate),l=Math.round(this.drawCalls/this.totalTick),u=Math.round(this.dirtyRatio/this.totalTick),c=Math.round(this.costDirty/this.totalTick),d=Math.round(this.costRender/this.totalTick),f=Math.round(this.costTicker/this.totalTick);this.fpsDisplay.update({fps:h,draw:l,dirty:u,costTicker:f,costDirty:c,costRender:d}),this.totalTick=0,this.totalTime=this.totalTime%1e3,this.drawCalls=0,this.dirtyRatio=0,this.costDirty=0,this.costRender=0,this.costTicker=0}},n.prototype.updateInfo=function(t){t&&this.showLog&&this.filter(t)&&this.fpsDisplay.updateInfo(t)},n}(t.Sprite),t.warn=function(){console.warn.apply(console,a(arguments))},t.error=function(){console.error.apply(console,a(arguments))},t.assert=function(){console.assert.apply(console,a(arguments))},t.log=function(){console.log.apply(console,a(arguments))}}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=[],n=function(){function t(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.width=0,this.height=0,this.area=0,this.moved=!1}var e=t,n=e.prototype;return t.release=function(t){i.push(t)},t.create=function(){var e=i.pop();return e||(e=new t),e},n.setTo=function(t,e,i,n){return this.minX=t,this.minY=e,this.maxX=i,this.maxY=n,this.updateArea(),this},n.intValues=function(){this.minX=Math.floor(this.minX),this.minY=Math.floor(this.minY),this.maxX=Math.ceil(this.maxX),this.maxY=Math.ceil(this.maxY),this.updateArea()},n.updateArea=function(){this.width=this.maxX-this.minX,this.height=this.maxY-this.minY,this.area=this.width*this.height},n.union=function(t){this.minX>t.minX&&(this.minX=t.minX),this.minY>t.minY&&(this.minY=t.minY),this.maxX<t.maxX&&(this.maxX=t.maxX),this.maxY<t.maxY&&(this.maxY=t.maxY),this.updateArea()},n.intersect=function(t){return this.minX<t.minX&&(this.minX=t.minX),this.maxX>t.maxX&&(this.maxX=t.maxX),this.minX>=this.maxX?void this.setEmpty():(this.minY<t.minY&&(this.minY=t.minY),this.maxY>t.maxY&&(this.maxY=t.maxY),this.minY>=this.maxY?void this.setEmpty():void this.updateArea())},n.setEmpty=function(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.width=0,this.height=0,this.area=0},n.isEmpty=function(){return this.width<=0||this.height<=0},n.intersects=function(t){if(this.isEmpty())return!1;var e=this.minX>t.minX?this.minX:t.minX,i=this.maxX<t.maxX?this.maxX:t.maxX;return e>i?!1:(e=this.minY>t.minY?this.minY:t.minY,i=this.maxY<t.maxY?this.maxY:t.maxY,i>=e)},n.updateRegion=function(t,e){if(0==t.width||0==t.height)return void this.setEmpty();var i,n,r,s,a=e,o=a.a,h=a.b,l=a.c,u=a.d,c=a.tx,d=a.ty,f=t.x,g=t.y,p=f+t.width,v=g+t.height;if(1==o&&0==h&&0==l&&1==u)i=f+c-1,n=g+d-1,r=p+c+1,s=v+d+1;else{var $=o*f+l*g+c,m=h*f+u*g+d,y=o*p+l*g+c,T=h*p+u*g+d,x=o*p+l*v+c,b=h*p+u*v+d,_=o*f+l*v+c,E=h*f+u*v+d,C=0;$>y&&(C=$,$=y,y=C),x>_&&(C=x,x=_,_=C),i=(x>$?$:x)-1,r=(y>_?y:_)+1,m>T&&(C=m,m=T,T=C),b>E&&(C=b,b=E,E=C),n=(b>m?m:b)-1,s=(T>E?T:E)+1}this.minX=i,this.minY=n,this.maxX=r,this.maxY=s,this.width=r-i,this.height=s-n,this.area=this.width*this.height},t}();e.Region=n,t.registerClass(n,"egret.sys.Region")}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(){}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}__extends(i,e);var n=i,r=n.prototype;return r.calculateStageSize=function(e,i,n,r,s){var a=i,o=n,h=r,l=s,u=i/h||0,c=n/l||0;switch(e){case t.StageScaleMode.EXACT_FIT:break;case t.StageScaleMode.FIXED_HEIGHT:h=Math.round(i/c);break;case t.StageScaleMode.FIXED_WIDTH:l=Math.round(n/u);break;case t.StageScaleMode.NO_BORDER:u>c?o=Math.round(l*u):a=Math.round(h*c);break;case t.StageScaleMode.SHOW_ALL:u>c?a=Math.round(h*c):o=Math.round(l*u);break;case t.StageScaleMode.FIXED_NARROW:u>c?h=Math.round(i/c):l=Math.round(n/u);break;case t.StageScaleMode.FIXED_WIDE:u>c?l=Math.round(n/u):h=Math.round(i/c);break;default:h=i,l=n}return a%2!=0&&(a+=1),o%2!=0&&(o+=1),{stageWidth:h,stageHeight:l,displayWidth:a,displayHeight:o}},i}(t.HashObject);e.DefaultScreenAdapter=i,t.registerClass(i,"egret.sys.DefaultScreenAdapter",["egret.sys.IScreenAdapter"])}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}var e=t;return e.prototype,t.NO_SCALE="noScale",t.SHOW_ALL="showAll",t.NO_BORDER="noBorder",t.EXACT_FIT="exactFit",t.FIXED_WIDTH="fixedWidth",t.FIXED_HEIGHT="fixedHeight",t.FIXED_NARROW="fixedNarrow",t.FIXED_WIDE="fixedWide",t}();t.StageScaleMode=e,t.registerClass(e,"egret.StageScaleMode")}(egret||(egret={}));var egret;!function(t){var e;!function(){}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){e.$START_TIME=0,e.$invalidateRenderFlag=!1,e.$requestRenderingFlag=!1;var i=function(){function i(){this.playerList=[],this.callBackList=[],this.thisObjectList=[],this.$frameRate=30,this.lastTimeStamp=0,this.costEnterFrame=0,e.$START_TIME=Date.now(),this.frameDeltaTime=1e3/this.$frameRate,this.lastCount=this.frameInterval=Math.round(6e4/this.$frameRate)}var n=i,r=n.prototype;return r.$addPlayer=function(t){-1==this.playerList.indexOf(t)&&(this.playerList=this.playerList.concat(),this.playerList.push(t))},r.$removePlayer=function(t){var e=this.playerList.indexOf(t);-1!==e&&(this.playerList=this.playerList.concat(),this.playerList.splice(e,1))},r.$startTick=function(t,e){var i=this.getTickIndex(t,e);-1==i&&(this.concatTick(),this.callBackList.push(t),this.thisObjectList.push(e))},r.$stopTick=function(t,e){var i=this.getTickIndex(t,e);
-1!=i&&(this.concatTick(),this.callBackList.splice(i,1),this.thisObjectList.splice(i,1))},r.getTickIndex=function(t,e){for(var i=this.callBackList,n=this.thisObjectList,r=i.length-1;r>=0;r--)if(i[r]==t&&n[r]==e)return r;return-1},r.concatTick=function(){this.callBackList=this.callBackList.concat(),this.thisObjectList=this.thisObjectList.concat()},r.$setFrameRate=function(e){return e=+e||0,0>=e?!1:this.$frameRate==e?!1:(this.$frameRate=e,e>60&&(e=60),t.Capabilities.runtimeType==t.RuntimeType.NATIVE&&(egret_native.setFrameRate(e),e=60),this.frameDeltaTime=1e3/e,this.lastCount=this.frameInterval=Math.round(6e4/e),!0)},r.update=function(){for(var i=t.getTimer(),n=this.callBackList,r=this.thisObjectList,s=n.length,a=e.$requestRenderingFlag,o=t.getTimer(),h=0;s>h;h++)n[h].call(r[h],o)&&(a=!0);var l=t.getTimer(),u=o-this.lastTimeStamp;if(this.lastTimeStamp=o,u>=this.frameDeltaTime)this.lastCount=this.frameInterval;else{if(this.lastCount-=1e3,this.lastCount>0)return void(a&&this.render(!1,this.costEnterFrame+l-i));this.lastCount+=this.frameInterval}this.render(!0,this.costEnterFrame+l-i);var c=t.getTimer();this.broadcastEnterFrame();var d=t.getTimer();this.costEnterFrame=d-c},r.render=function(t,i){var n=this.playerList,r=n.length;if(0!=r){e.$invalidateRenderFlag&&(this.broadcastRender(),e.$invalidateRenderFlag=!1);for(var s=0;r>s;s++)n[s].$render(t,i);e.$requestRenderingFlag=!1}},r.broadcastEnterFrame=function(){var e=t.DisplayObject.$enterFrameCallBackList,i=e.length;if(0!=i){e=e.concat();for(var n=0;i>n;n++)e[n].dispatchEventWith(t.Event.ENTER_FRAME)}},r.broadcastRender=function(){var e=t.DisplayObject.$renderCallBackList,i=e.length;if(0!=i){e=e.concat();for(var n=0;i>n;n++)e[n].dispatchEventWith(t.Event.RENDER)}},i}();e.SystemTicker=i,t.registerClass(i,"egret.sys.SystemTicker"),e.$ticker=new e.SystemTicker}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret_stages,egret;!function(t){var e;!function(e){var i=function(e){function i(t){e.call(this),this.maxTouches=0,this.useTouchesCount=0,this.touchDownTarget={},this.lastTouchX=-1,this.lastTouchY=-1,this.stage=t}__extends(i,e);var n=i,r=n.prototype;return r.$initMaxTouches=function(){this.maxTouches=this.stage.$maxTouches},r.onTouchBegin=function(e,i,n){if(!(this.useTouchesCount>=this.maxTouches)){this.lastTouchX=e,this.lastTouchY=i;var r=this.findTarget(e,i);null==this.touchDownTarget[n]&&(this.touchDownTarget[n]=r,this.useTouchesCount++),t.TouchEvent.dispatchTouchEvent(r,t.TouchEvent.TOUCH_BEGIN,!0,!0,e,i,n,!0)}},r.onTouchMove=function(e,i,n){if(null!=this.touchDownTarget[n]&&(this.lastTouchX!=e||this.lastTouchY!=i)){this.lastTouchX=e,this.lastTouchY=i;var r=this.findTarget(e,i);t.TouchEvent.dispatchTouchEvent(r,t.TouchEvent.TOUCH_MOVE,!0,!0,e,i,n,!0)}},r.onTouchEnd=function(e,i,n){if(null!=this.touchDownTarget[n]){var r=this.findTarget(e,i),s=this.touchDownTarget[n];delete this.touchDownTarget[n],this.useTouchesCount--,t.TouchEvent.dispatchTouchEvent(r,t.TouchEvent.TOUCH_END,!0,!0,e,i,n,!1),s==r?t.TouchEvent.dispatchTouchEvent(r,t.TouchEvent.TOUCH_TAP,!0,!0,e,i,n,!1):t.TouchEvent.dispatchTouchEvent(s,t.TouchEvent.TOUCH_RELEASE_OUTSIDE,!0,!0,e,i,n,!1)}},r.findTarget=function(t,e){var i=this.stage.$hitTest(t,e);return i||(i=this.stage),i},i}(t.HashObject);e.TouchHandler=i,t.registerClass(i,"egret.sys.TouchHandler")}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(){function i(){this.type=0,this.needRedraw=!1,this.renderAlpha=1,this.renderVisible=!0,this.renderMatrix=new t.Matrix,this.renderRegion=new e.Region,this.moved=!1,this.drawData=[],this.renderCount=0}var n=i,r=n.prototype;return r.cleanBeforeRender=function(){this.drawData.length=0,this.renderCount=0},r.$getRenderCount=function(){return this.renderCount},i}();e.RenderNode=i,t.registerClass(i,"egret.sys.RenderNode")}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this),this.image=null,this.smoothing=!0,this.blendMode=null,this.alpha=0/0,this.filter=null,this.type=1}__extends(i,e);var n=i,r=n.prototype;return r.drawImage=function(t,e,i,n,r,s,a,o){this.drawData.push(t,e,i,n,r,s,a,o),this.renderCount++},r.cleanBeforeRender=function(){e.prototype.cleanBeforeRender.call(this),this.image=null,this.matrix=null,this.blendMode=null,this.alpha=0/0,this.filter=null},i.$updateTextureData=function(e,n,r,s,a,o,h,l,u,c,d,f,g,p,v,$,m){if(n){var y=t.$TextureScaleFactor;if(e.smoothing=m,e.image=n,e.imageWidth=g,e.imageHeight=p,v)i.$updateTextureDataWithScale9Grid(e,v,r,s,a,o,h,l,u,c,d,f);else if($==t.BitmapFillMode.SCALE){var T=d/u*y,x=f/c*y;e.drawImage(r,s,a,o,h,l,T*a,x*o)}else if($==t.BitmapFillMode.CLIP){var b=Math.min(u,d),_=Math.min(c,f),E=a*y,C=o*y;i.drawClipImage(e,y,r,s,E,C,h,l,b,_)}else for(var E=a*y,C=o*y,F=0;d>F;F+=u)for(var w=0;f>w;w+=c){var b=Math.min(d-F,u),_=Math.min(f-w,c);i.drawClipImage(e,y,r,s,E,C,h,l,b,_,F,w)}}},i.$updateTextureDataWithScale9Grid=function(e,i,n,r,s,a,o,h,l,u,c,d){var f=s,g=a;c-=l-s*t.$TextureScaleFactor,d-=u-a*t.$TextureScaleFactor;var p=i.x-o,v=i.y-h,$=p/t.$TextureScaleFactor,m=v/t.$TextureScaleFactor,y=i.width/t.$TextureScaleFactor,T=i.height/t.$TextureScaleFactor;0==T&&(T=1,m>=g&&m--),0==y&&(y=1,$>=f&&$--);var x=n,b=x+$,_=b+y,E=f-$-y,C=r,F=C+m,w=F+T,R=g-m-T,S=E*t.$TextureScaleFactor,D=R*t.$TextureScaleFactor;if(($+E)*t.$TextureScaleFactor>c||(m+R)*t.$TextureScaleFactor>d)return void e.drawImage(n,r,s,a,o,h,c,d);var O=o,L=O+p,M=O+(c-S),N=c-p-S,A=h,I=A+v,B=A+d-D,P=d-v-D;m>0&&($>0&&e.drawImage(x,C,$,m,O,A,p,v),y>0&&e.drawImage(b,C,y,m,L,A,N,v),E>0&&e.drawImage(_,C,E,m,M,A,S,v)),T>0&&($>0&&e.drawImage(x,F,$,T,O,I,p,P),y>0&&e.drawImage(b,F,y,T,L,I,N,P),E>0&&e.drawImage(_,F,E,T,M,I,S,P)),R>0&&($>0&&e.drawImage(x,w,$,R,O,B,p,D),y>0&&e.drawImage(b,w,y,R,L,B,N,D),E>0&&e.drawImage(_,w,E,R,M,B,S,D))},i.drawClipImage=function(t,e,i,n,r,s,a,o,h,l,u,c){void 0===u&&(u=0),void 0===c&&(c=0);var d=a+r-h;d>0&&(r-=d),d=o+s-l,d>0&&(s-=d),t.drawImage(i,n,r/e,s/e,u+a,c+o,r,s)},i}(e.RenderNode);e.BitmapNode=i,t.registerClass(i,"egret.sys.BitmapNode")}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=["none","round","square"],n=["bevel","miter","round"],r=function(r){function s(){r.call(this),this.dirtyRender=!0,this.type=3}__extends(s,r);var a=s,o=a.prototype;return o.beginFill=function(t,i,n){void 0===i&&(i=1);var r=new e.FillPath;if(r.fillColor=t,r.fillAlpha=i,n){var s=this.drawData.lastIndexOf(n);this.drawData.splice(s,0,r)}else this.drawData.push(r);return r},o.beginGradientFill=function(i,n,r,s,a,o){var h=new t.Matrix;a?(h.a=819.2*a.a,h.b=819.2*a.b,h.c=819.2*a.c,h.d=819.2*a.d,h.tx=a.tx,h.ty=a.ty):(h.a=100,h.d=100);var l=new e.GradientFillPath;if(l.gradientType=i,l.colors=n,l.alphas=r,l.ratios=s,l.matrix=h,o){var u=this.drawData.lastIndexOf(o);this.drawData.splice(u,0,l)}else this.drawData.push(l);return l},o.lineStyle=function(r,s,a,o,h,l){void 0===a&&(a=1),void 0===l&&(l=3),-1==i.indexOf(o)&&(o="round"),-1==n.indexOf(h)&&(h="round");var u=new e.StrokePath;return u.lineWidth=r,u.lineColor=s,u.lineAlpha=a,u.caps=o||t.CapsStyle.ROUND,u.joints=h,u.miterLimit=l,this.drawData.push(u),u},o.clear=function(){this.drawData.length=0,this.dirtyRender=!0},o.cleanBeforeRender=function(){},o.clean=function(){this.$texture&&(t.WebGLUtils.deleteWebGLTexture(this.$texture),this.$texture=null,this.dirtyRender=!0)},s}(e.RenderNode);e.GraphicsNode=r,t.registerClass(r,"egret.sys.GraphicsNode")}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(t){function e(){t.call(this),this.type=4}__extends(e,t);var i=e,n=i.prototype;return n.addNode=function(t){this.drawData.push(t)},n.cleanBeforeRender=function(){for(var t=this.drawData,e=t.length-1;e>=0;e--)t[e].cleanBeforeRender()},n.$getRenderCount=function(){for(var t=0,e=this.drawData,i=e.length-1;i>=0;i--)t+=e[i].$getRenderCount();return t},e}(e.RenderNode);e.GroupNode=i,t.registerClass(i,"egret.sys.GroupNode")}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this),this.image=null,this.smoothing=!0,this.bounds=new t.Rectangle,this.type=7,this.vertices=[],this.uvs=[],this.indices=[]}__extends(i,e);var n=i,r=n.prototype;return r.drawMesh=function(t,e,i,n,r,s,a,o){this.drawData.push(t,e,i,n,r,s,a,o),this.renderCount++},r.cleanBeforeRender=function(){e.prototype.cleanBeforeRender.call(this),this.image=null,this.matrix=null},i}(e.RenderNode);e.MeshNode=i,t.registerClass(i,"egret.sys.MeshNode")}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(t){function e(){t.call(this),this.type=6}__extends(e,t);var i=e,n=i.prototype;return n.setAlpha=function(t){0!=this.drawData.length&&(this.drawData.length=0),this.drawData.push(t),this.renderCount++},e}(e.RenderNode);e.SetAlphaNode=i,t.registerClass(i,"egret.sys.SetAlphaNode")}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this),this.textColor=16777215,this.strokeColor=0,this.size=30,this.stroke=0,this.bold=!1,this.italic=!1,this.fontFamily="Arial",this.dirtyRender=!0,this.type=2}__extends(i,e);var n=i,r=n.prototype;return r.drawText=function(t,e,i,n){this.drawData.push(t,e,i,n),this.renderCount++,this.dirtyRender=!0},r.cleanBeforeRender=function(){e.prototype.cleanBeforeRender.call(this)},r.clean=function(){this.$texture&&(t.WebGLUtils.deleteWebGLTexture(this.$texture),this.$texture=null,this.dirtyRender=!0)},i}(e.RenderNode);e.TextNode=i,t.registerClass(i,"egret.sys.TextNode")}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(){function t(){this.type=0,this.$commands=[],this.$data=[],this.commandPosition=0,this.dataPosition=0,this.$lastX=0,this.$lastY=0}var e=t,i=e.prototype;return i.moveTo=function(t,e){this.$commands[this.commandPosition++]=1;var i=this.dataPosition;this.$data[i++]=t,this.$data[i++]=e,this.dataPosition=i},i.lineTo=function(t,e){this.$commands[this.commandPosition++]=2;var i=this.dataPosition;this.$data[i++]=t,this.$data[i++]=e,this.dataPosition=i},i.curveTo=function(t,e,i,n){this.$commands[this.commandPosition++]=3;var r=this.dataPosition;this.$data[r++]=t,this.$data[r++]=e,this.$data[r++]=i,this.$data[r++]=n,this.dataPosition=r},i.cubicCurveTo=function(t,e,i,n,r,s){this.$commands[this.commandPosition++]=4;var a=this.dataPosition;this.$data[a++]=t,this.$data[a++]=e,this.$data[a++]=i,this.$data[a++]=n,this.$data[a++]=r,this.$data[a++]=s,this.dataPosition=a},i.drawRect=function(t,e,i,n){var r=t+i,s=e+n;this.moveTo(t,e),this.lineTo(r,e),this.lineTo(r,s),this.lineTo(t,s),this.lineTo(t,e)},i.drawRoundRect=function(t,e,i,n,r,s){var a=.5*r|0,o=s?.5*s|0:a;if(!a||!o)return void this.drawRect(t,e,i,n);var h=.5*i,l=.5*n;if(a>h&&(a=h),o>l&&(o=l),h===a&&l===o)return void(a===o?this.drawCircle(t+a,e+o,a):this.drawEllipse(t,e,2*a,2*o));var u=t+i,c=e+n,d=t+a,f=u-a,g=e+o,p=c-o;this.moveTo(u,p),this.curveTo(u,c,f,c),this.lineTo(d,c),this.curveTo(t,c,t,p),this.lineTo(t,g),this.curveTo(t,e,d,e),this.lineTo(f,e),this.curveTo(u,e,u,g),this.lineTo(u,p)},i.drawCircle=function(t,e,i){this.arcToBezier(t,e,i,i,0,2*Math.PI)},i.drawEllipse=function(t,e,i,n){var r=.5*i,s=.5*n;t+=r,e+=s,this.arcToBezier(t,e,r,s,0,2*Math.PI)},i.drawArc=function(t,e,i,n,r,s){s?r>=n&&(r-=2*Math.PI):n>=r&&(r+=2*Math.PI),this.arcToBezier(t,e,i,i,n,r,s)},i.arcToBezier=function(t,e,i,n,r,s,a){var o=.5*Math.PI,h=r,l=h;a?(l+=-o-h%o,s>l&&(l=s)):(l+=o-h%o,l>s&&(l=s));var u=t+Math.cos(h)*i,c=e+Math.sin(h)*n;(this.$lastX!=u||this.$lastY!=c)&&this.moveTo(u,c);for(var d=Math.cos(h),f=Math.sin(h),g=0;4>g;g++){var p=l-h,v=4*Math.tan(p/4)/3,$=u-f*v*i,m=c+d*v*n;d=Math.cos(l),f=Math.sin(l),u=t+d*i,c=e+f*n;var y=u+f*v*i,T=c-d*v*n;if(this.cubicCurveTo($,m,y,T,u,c),l===s)break;h=l,a?(l=h-o,s>l&&(l=s)):(l=h+o,l>s&&(l=s))}},t}();e.Path2D=i,t.registerClass(i,"egret.sys.Path2D")}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(t){function e(){t.call(this),this.type=1}__extends(e,t);var i=e;return i.prototype,e}(e.Path2D);e.FillPath=i,t.registerClass(i,"egret.sys.FillPath")}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(t){function e(){t.call(this),this.type=2}__extends(e,t);var i=e;return i.prototype,e}(e.Path2D);e.GradientFillPath=i,t.registerClass(i,"egret.sys.GradientFillPath")}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(t){function e(){t.call(this),this.type=3}__extends(e,t);var i=e;return i.prototype,e}(e.Path2D);e.StrokePath=i,t.registerClass(i,"egret.sys.StrokePath")}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){function e(t,e){var i=null==e.italic?t.italic:e.italic,n=null==e.bold?t.bold:e.bold,r=null==e.size?t.size:e.size,s=e.fontFamily||t.fontFamily,a=i?"italic ":"normal ";return a+=n?"bold ":"normal ",a+=r+"px "+s}function i(t,e){var i=t>>16,n=t>>8&255,r=255&t;return"rgba("+i+","+n+","+r+","+e+")"}function n(e,n,r,s,a){var o;o=n==t.GradientType.LINEAR?e.createLinearGradient(-1,0,1,0):e.createRadialGradient(0,0,0,0,0,1);for(var h=r.length,l=0;h>l;l++)o.addColorStop(a[l]/255,i(r[l],s[l]));return o}function r(t,e,i,n){for(var r=n[0],s=n[1],a=n[2],o=n[3],h=n[4],l=n[5],u=n[6],c=n[7],d=n[8],f=n[9],g=n[10],p=n[11],v=n[12],$=n[13],m=n[14],y=n[15],T=n[16],x=n[17],b=n[18],_=n[19],E=0,C=e*i*4;C>E;E+=4){var F=t[E+0],w=t[E+1],R=t[E+2],S=t[E+3];t[E+0]=r*F+s*w+a*R+o*S+h,t[E+1]=l*F+u*w+c*R+d*S+f,t[E+2]=g*F+p*w+v*R+$*S+m,t[E+3]=y*F+T*w+x*R+b*S+_}}function s(t,e,i,n,r){a(t,e,i,n),o(t,e,i,r)}function a(t,e,i,n){for(var r=new Uint8ClampedArray(4*e),s=4*e,a=2*n+1,o=0;i>o;o++){for(var h=o*s,l=0,u=0,c=0,d=0,f=0,g=0,p=4*-n,v=4*n+4;v>p;p+=4){var $=h+p;h>$||$>=h+s||(f=t[$+3],l+=t[$+0]*f,u+=t[$+1]*f,c+=t[$+2]*f,d+=f)}for(var p=h,v=h+s,m=0,y=p-4*n,T=p+4*(n+1);v>p;p+=4,m+=4,T+=4,y+=4)r[m+0]=l/d,r[m+1]=u/d,r[m+2]=c/d,r[m+3]=d/a,f=t[T+3],g=t[y+3],f||0==f?g||0==g?(l+=t[T+0]*f-t[y+0]*g,u+=t[T+1]*f-t[y+1]*g,c+=t[T+2]*f-t[y+2]*g,d+=f-g):(l+=t[T+0]*f,u+=t[T+1]*f,c+=t[T+2]*f,d+=f):(g||0==g)&&(l+=-t[y+0]*g,u+=-t[y+1]*g,c+=-t[y+2]*g,d+=-g);t.set(r,h)}}function o(t,e,i,n){for(var r=new Uint8ClampedArray(4*i),s=4*e,a=2*n+1,o=0;e>o;o++){for(var h=4*o,l=0,u=0,c=0,d=0,f=0,g=0,p=-n*s,v=n*s+s;v>p;p+=s){var $=h+p;h>$||$>=h+i*s||(f=t[$+3],l+=t[$+0]*f,u+=t[$+1]*f,c+=t[$+2]*f,d+=f)}for(var p=h,v=h+i*s,m=0,y=h-n*s,T=h+(n+1)*s;v>p;p+=s,m+=4,T+=s,y+=s)r[m+0]=l/d,r[m+1]=u/d,r[m+2]=c/d,r[m+3]=d/a,f=t[T+3],g=t[y+3],f||0==f?g||0==g?(l+=t[T+0]*f-t[y+0]*g,u+=t[T+1]*f-t[y+1]*g,c+=t[T+2]*f-t[y+2]*g,d+=f-g):(l+=t[T+0]*f,u+=t[T+1]*f,c+=t[T+2]*f,d+=f):(g||0==g)&&(l+=-t[y+0]*g,u+=-t[y+1]*g,c+=-t[y+2]*g,d+=-g);for(var x=4*o,v=x+i*s,b=0;v>x;x+=s,b+=4)t[x+0]=r[b+0],t[x+1]=r[b+1],t[x+2]=r[b+2],t[x+3]=r[b+3]}}function h(t,e,i,n,r,a,o,h,f){var g=l(t,n);u(g,e,i,o,h),s(g,e,i,r,a),c(g,f),d(g,t),t.set(g)}function l(t,e){e||(e=[0,0,0,0]);for(var i=new Uint8ClampedArray(t),n=0,r=i.length;r>n;n+=4){var s=i[n+3];i[n+0]=e[0]*s,i[n+1]=e[1]*s,i[n+2]=e[2]*s}return i}function u(t,e,i,n,r){for(var s=Math.sin(n)*r|0,a=Math.cos(n)*r|0,o=new Int32Array(t.buffer),h=new Int32Array(o.length),l=0;i>l;l++){var u=l+s;if(!(0>u||u>i))for(var c=0;e>c;c++){var d=c+a;0>d||d>e||(h[u*e+d]=o[l*e+c])}}o.set(h)}function c(t,e){for(var i=0,n=t.length;n>i;i+=4)t[i+3]*=e}function d(t,e){for(var i=0,n=t.length;n>i;i+=4){var r=t[i+0],s=t[i+1],a=t[i+2],o=t[i+3]/255,h=e[i+0],l=e[i+1],u=e[i+2],c=e[i+3]/255;t[i+0]=h+r*(1-c),t[i+1]=l+s*(1-c),t[i+2]=u+a*(1-c),t[i+3]=255*(c+o*(1-c))}}function f(t,e,i){return t*(1-i)+e*i}function g(t,e,i,n,r,s,a,o,h,l,u,c){for(var d,g,p=new Uint8ClampedArray(t),v=n[3],$=0,m=0,y=o*Math.cos(a),T=o*Math.sin(a),x=7,b=12,_=3.141592653589793,E=r/x,C=s/x,F=0;e>F;F++)for(var w=0;i>w;w++){for(var R=0,S=w*e*4+4*F,D=0,O=0,L=t[S+0]/255,M=t[S+1]/255,N=t[S+2]/255,A=t[S+3]/255,I=0;2*_>=I;I+=2*_/b){d=Math.cos(I+R),g=Math.sin(I+R);for(var B=0;x>B;B++){$=B*E*d,m=B*C*g;var P=Math.round(F+$-y),k=Math.round(w+m-T),U=0;if(P>=e||0>P||0>k||k>=i)U=0;else{var X=k*e*4+4*P;U=t[X+3]/255}D+=(x-B)*U,O+=x-B}}A=Math.max(A,1e-4);var Y=D/O*h*v*(1-l)*Math.max(Math.min(c,u),1-A),H=(O-D)/O*h*v*l*A;A=Math.max(A*u*(1-c),1e-4);var j=H/(H+A),W=f(L,n[0],j),G=f(M,n[1],j),V=f(N,n[2],j),z=Y/(H+A+Y),Z=f(W,n[0],z),q=f(G,n[1],z),J=f(V,n[2],z),K=Math.min(A+Y+H,1);p[S+0]=255*Z,p[S+1]=255*q,p[S+2]=255*J,p[S+3]=255*K}t.set(p)}var p=["source-over","lighter","destination-out"],v="source-over",$="#000000",m={none:"butt",square:"square",round:"round"},y=[],T=function(){function a(){this.nestLevel=0,this.renderingMask=!1}var o=a,l=o.prototype;return l.render=function(t,e,i,n,r){this.nestLevel++;var s=e.context,a=r?t:null,o=this.drawDisplayObject(t,s,n,i,null,null,a);if(this.nestLevel--,0===this.nestLevel){y.length>6&&(y.length=6);for(var h=y.length,l=0;h>l;l++)y[l].resize(0,0)}return o},l.drawDisplayObject=function(e,i,n,r,s,a,o){var h,l=0;if(s&&!o?(s.isDirty&&(l+=s.drawToSurface()),h=s.$renderNode):h=e.$getRenderNode(),h){if(n){var u=h.renderRegion;if(a&&!a.intersects(u))h.needRedraw=!1;else if(!h.needRedraw)for(var c=n.length,d=0;c>d;d++)if(u.intersects(n[d])){h.needRedraw=!0;break}}else h.needRedraw=!0;if(h.needRedraw){var f,g;o?(f=e.$getConcatenatedAlphaAt(o,e.$getConcatenatedAlpha()),g=t.Matrix.create().copyFrom(e.$getConcatenatedMatrix()),e.$getConcatenatedMatrixAt(o,g),r.$preMultiplyInto(g,g),i.setTransform(g.a,g.b,g.c,g.d,g.tx,g.ty),t.Matrix.release(g)):(f=h.renderAlpha,g=h.renderMatrix,i.setTransform(g.a,g.b,g.c,g.d,g.tx+r.tx,g.ty+r.ty)),i.globalAlpha=f,l+=this.renderNode(h,i),h.needRedraw=!1}}if(s&&!o)return l;var p=e.$children;if(p)for(var v=p.length,$=0;v>$;$++){var m=p[$];if(!(!m.$visible||m.$alpha<=0||m.$maskedObject)){var y=m.$getFilters();y&&y.length>0?l+=this.drawWithFilter(m,i,n,r,a,o):0!==m.$blendMode||m.$mask&&(m.$mask.$parentDisplayList||o)?l+=this.drawWithClip(m,i,n,r,a,o):m.$scrollRect||m.$maskRect?l+=this.drawWithScrollRect(m,i,n,r,a,o):m.isFPS?this.drawDisplayObject(m,i,n,r,m.$displayList,a,o):l+=this.drawDisplayObject(m,i,n,r,m.$displayList,a,o)}}return l},l.drawWithFilter=function(e,i,n,a,o,l){if(t.Capabilities.runtimeType==t.RuntimeType.NATIVE){var u=0,c=e.$getFilters(),d=0!==e.$blendMode;if(d){var f=p[e.$blendMode];f||(f=v)}if(1==c.length&&"colorTransform"==c[0].type&&!e.$children)return d&&(i.globalCompositeOperation=f),i.setGlobalShader(c[0].$toJson()),u+=e.$mask&&(e.$mask.$parentDisplayList||l)?this.drawWithClip(e,i,n,a,o,l):e.$scrollRect||e.$maskRect?this.drawWithScrollRect(e,i,n,a,o,l):this.drawDisplayObject(e,i,n,a,e.$displayList,o,l),i.setGlobalShader(""),d&&(i.globalCompositeOperation=v),u;var $=t.Matrix.create();$.copyFrom(e.$getConcatenatedMatrix());var m;m=t.sys.Region.create();var T=e.$getOriginalBounds();m.updateRegion(T,$);var x=this.createRenderBuffer(m.width,m.height);x.context.setTransform(1,0,0,1,-m.minX,-m.minY);var b=t.Matrix.create().setTo(1,0,0,1,-m.minX,-m.minY);return u+=e.$mask&&(e.$mask.$parentDisplayList||l)?this.drawWithClip(e,x.context,n,b,m,l):e.$scrollRect||e.$maskRect?this.drawWithScrollRect(e,x.context,n,b,m,l):this.drawDisplayObject(e,x.context,n,b,e.$displayList,m,l),t.Matrix.release(b),u>0&&(d&&(i.globalCompositeOperation=f),u++,i.globalAlpha=1,i.setTransform(1,0,0,1,m.minX+a.tx,m.minY+a.ty),i.setGlobalShader(c[0].$toJson()),i.drawImage(x.surface,0,0,x.width,x.height,0,0,x.width,x.height),i.setGlobalShader(""),d&&(i.globalCompositeOperation=v)),y.push(x),t.sys.Region.release(m),t.Matrix.release($),u}var u=0,c=e.$getFilters(),_=c.length,d=0!==e.$blendMode;if(d){var f=p[e.$blendMode];f||(f=v)}var $=t.Matrix.create();$.copyFrom(e.$getConcatenatedMatrix());var m;m=t.sys.Region.create();var T=e.$getOriginalBounds();m.updateRegion(T,$);var x=this.createRenderBuffer(m.width,m.height),E=x.context;E.setTransform(1,0,0,1,-m.minX,-m.minY);var b=t.Matrix.create().setTo(1,0,0,1,-m.minX,-m.minY);if(u+=e.$mask&&(e.$mask.$parentDisplayList||l)?this.drawWithClip(e,E,n,b,m,l):e.$scrollRect||e.$maskRect?this.drawWithScrollRect(e,E,n,b,m,l):this.drawDisplayObject(e,E,n,b,e.$displayList,m,l),t.Matrix.release(b),u>0){d&&(i.globalCompositeOperation=f),u++,i.globalAlpha=1,i.setTransform(1,0,0,1,m.minX+a.tx,m.minY+a.ty);for(var C=E.getImageData(0,0,x.surface.width,x.surface.height),F=0;_>F;F++){var w=c[F];if("colorTransform"==w.type)r(C.data,x.surface.width,x.surface.height,w.$matrix);else if("blur"==w.type)s(C.data,x.surface.width,x.surface.height,w.$blurX,w.$blurY);else if("glow"==w.type){var R=w.$red,S=w.$green,D=w.$blue,O=w.$alpha;w.$inner||w.$knockout||w.$hideObject?g(C.data,x.surface.width,x.surface.height,[R/255,S/255,D/255,O],w.$blurX,w.$blurY,w.$angle?w.$angle/180*Math.PI:0,w.$distance||0,w.$strength,w.$inner?1:0,w.$knockout?0:1,w.$hideObject?1:0):h(C.data,x.surface.width,x.surface.height,[R/255,S/255,D/255,O/255],w.$blurX,w.$blurY,w.$angle?w.$angle/180*Math.PI:0,w.$distance||0,w.$strength)}}E.putImageData(C,0,0),i.drawImage(x.surface,0,0),d&&(i.globalCompositeOperation=v)}return y.push(x),t.sys.Region.release(m),t.Matrix.release($),u},l.drawWithClip=function(e,i,n,r,s,a){var o=0,h=0!==e.$blendMode;if(h){var l=p[e.$blendMode];l||(l=v)}var u=e.$scrollRect?e.$scrollRect:e.$maskRect,c=e.$mask;if(c){var d=c.$getRenderNode();if(d){var f=d.renderMatrix;if(0==f.a&&0==f.b||0==f.c&&0==f.d)return o}}var g,$=t.Matrix.create();if($.copyFrom(e.$getConcatenatedMatrix()),e.$parentDisplayList){var m,T=e.$parentDisplayList.root;T!==e.$stage&&e.$getConcatenatedMatrixAt(T,$)}if(c){var x=c.$getOriginalBounds();g=t.sys.Region.create();var b=t.Matrix.create();b.copyFrom(c.$getConcatenatedMatrix()),m&&m.$preMultiplyInto(b,b),g.updateRegion(x,b),t.Matrix.release(b)}var _;if(u&&(_=t.sys.Region.create(),_.updateRegion(u,$)),_&&g?(_.intersect(g),t.sys.Region.release(g)):!_&&g&&(_=g),_){if(_.isEmpty()||s&&!s.intersects(_))return t.sys.Region.release(_),t.Matrix.release($),o}else _=t.sys.Region.create(),x=e.$getOriginalBounds(),_.updateRegion(x,$);var E=!1;if(n){for(var C=n.length,F=0;C>F;F++)if(_.intersects(n[F])){E=!0;break}}else E=!0;if(!E)return t.sys.Region.release(_),t.Matrix.release($),o;if(!(c||e.$children&&0!=e.$children.length)){if(u){var b=$;i.save(),i.setTransform(b.a,b.b,b.c,b.d,b.tx-_.minX,b.ty-_.minY),i.beginPath(),i.rect(u.x,u.y,u.width,u.height),i.clip()}return h&&(i.globalCompositeOperation=l),o+=this.drawDisplayObject(e,i,n,r,e.$displayList,s,a),h&&(i.globalCompositeOperation=v),u&&i.restore(),o}if(c&&t.Capabilities.$runtimeType==t.RuntimeType.WEB&&(!c.$children||0==c.$children.length)&&d&&3==d.type&&1==d.drawData.length&&1==d.drawData[0].type&&1==d.drawData[0].fillAlpha){this.renderingMask=!0,i.save();var w=this.drawDisplayObject(c,i,n,r,c.$displayList,s,a);if(this.renderingMask=!1,u){var b=$;i.setTransform(b.a,b.b,b.c,b.d,b.tx-_.minX,b.ty-_.minY),i.beginPath(),i.rect(u.x,u.y,u.width,u.height),i.clip()}return w+=this.drawDisplayObject(e,i,n,r,e.$displayList,s,a),i.restore(),w}var R=this.createRenderBuffer(_.width,_.height),S=R.context;if(!S)return o+=this.drawDisplayObject(e,i,n,r,e.$displayList,s,a),t.sys.Region.release(_),t.Matrix.release($),o;S.setTransform(1,0,0,1,-_.minX,-_.minY);var D=t.Matrix.create().setTo(1,0,0,1,-_.minX,-_.minY);if(o+=this.drawDisplayObject(e,S,n,D,e.$displayList,_,a),c)if(t.Capabilities.$runtimeType==t.RuntimeType.WEB&&d&&1==d.$getRenderCount()||c.$displayList)S.globalCompositeOperation="destination-in",o+=this.drawDisplayObject(c,S,n,D,c.$displayList,_,a);else{var O=this.createRenderBuffer(_.width,_.height),L=O.context;if(!L)return o+=this.drawDisplayObject(e,i,n,r,e.$displayList,s,a),y.push(R),t.sys.Region.release(_),t.Matrix.release($),o;L.setTransform(1,0,0,1,-_.minX,-_.minY),D=t.Matrix.create().setTo(1,0,0,1,-_.minX,-_.minY);var w=this.drawDisplayObject(c,L,n,D,c.$displayList,_,a);w>0&&(o+=w,S.globalCompositeOperation="destination-in",S.setTransform(1,0,0,1,0,0),S.globalAlpha=1,S.drawImage(O.surface,0,0)),y.push(O)}if(t.Matrix.release(D),o>0){if(o++,h&&(i.globalCompositeOperation=l),u){var b=$;i.save(),i.setTransform(b.a,b.b,b.c,b.d,b.tx-_.minX,b.ty-_.minY),i.beginPath(),i.rect(u.x,u.y,u.width,u.height),i.clip()}i.globalAlpha=1,i.setTransform(1,0,0,1,_.minX+r.tx,_.minY+r.ty),i.drawImage(R.surface,0,0),u&&i.restore(),h&&(i.globalCompositeOperation=v)}return y.push(R),t.sys.Region.release(_),t.Matrix.release($),o},l.drawWithScrollRect=function(e,i,n,r,s,a){var o=0,h=e.$scrollRect?e.$scrollRect:e.$maskRect;if(0==h.width||0==h.height)return o;var l=t.Matrix.create();if(l.copyFrom(e.$getConcatenatedMatrix()),a)e.$getConcatenatedMatrixAt(a,l);else if(e.$parentDisplayList){var u=e.$parentDisplayList.root;u!==e.$stage&&e.$getConcatenatedMatrixAt(u,l)}var c=t.sys.Region.create();if(h.isEmpty()||c.updateRegion(h,l),c.isEmpty()||s&&!s.intersects(c))return t.sys.Region.release(c),t.Matrix.release(l),o;var d=!1;if(n){for(var f=n.length,g=0;f>g;g++)if(c.intersects(n[g])){d=!0;break}}else d=!0;return d?(i.save(),i.setTransform(l.a,l.b,l.c,l.d,l.tx+r.tx,l.ty+r.ty),i.beginPath(),i.rect(h.x,h.y,h.width,h.height),i.clip(),o+=this.drawDisplayObject(e,i,n,r,e.$displayList,c,a),i.restore(),t.sys.Region.release(c),t.Matrix.release(l),o):(t.sys.Region.release(c),t.Matrix.release(l),o)},l.drawNodeToBuffer=function(t,e,i,n){var r=e.context;r.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),this.renderNode(t,r,n)},l.renderNode=function(t,e,i){var n=0;switch(t.type){case 1:n=this.renderBitmap(t,e);break;case 2:n=1,this.renderText(t,e);break;case 3:n=1,this.renderGraphics(t,e,i);break;case 4:n=this.renderGroup(t,e);break;case 6:e.globalAlpha=t.drawData[0];break;case 7:n=this.renderMesh(t,e)}return n},l.renderMesh=function(e,i){if(t.Capabilities.runtimeType!=t.RuntimeType.NATIVE)return 0;var n=e.image,r=e.drawData,s=r.length,a=0,o=e.matrix;for(o&&(i.saveTransform(),i.transform(o.a,o.b,o.c,o.d,o.tx,o.ty));s>a;)i.drawMesh(n.source,r[a++],r[a++],r[a++],r[a++],r[a++],r[a++],r[a++],r[a++],e.imageWidth,e.imageHeight,e.uvs,e.vertices,e.indices,e.bounds);return o&&i.restoreTransform(),1},l.renderBitmap=function(e,i){var n=e.image;if(!n||!n.source)return 0;i.$imageSmoothingEnabled!=e.smoothing&&(i.imageSmoothingEnabled=e.smoothing,i.$imageSmoothingEnabled=e.smoothing);var s=e.drawData,a=s.length,o=0,h=e.matrix,l=e.blendMode,u=e.alpha,c=!1;if(h&&(i.saveTransform?i.saveTransform():i.save(),c=!0,i.transform(h.a,h.b,h.c,h.d,h.tx,h.ty)),l&&(i.globalCompositeOperation=p[l]),u==u){var d=i.globalAlpha;i.globalAlpha*=u}var f=0,g=e.filter;if(g&&8==a)if(t.Capabilities.runtimeType==t.RuntimeType.NATIVE){for(egret_native.Graphics.setGlobalShader(g);a>o;)f++,i.drawImage(n.source,s[o++],s[o++],s[o++],s[o++],s[o++],s[o++],s[o++],s[o++]);egret_native.Graphics.setGlobalShader(null)}else{var $=this.createRenderBuffer(s[6],s[7]),m=$.context;f++,m.drawImage(n.source,s[0],s[1],s[2],s[3],0,0,s[6],s[7]),f++;var T=m.getImageData(0,0,$.surface.width,$.surface.height);r(T.data,$.surface.width,$.surface.height,g.$matrix),m.putImageData(T,0,0),i.drawImage($.surface,0,0,s[6],s[7],s[4],s[5],s[6],s[7]),y.push($)}else for(;a>o;)f++,i.drawImage(n.source,s[o++],s[o++],s[o++],s[o++],s[o++],s[o++],s[o++],s[o++]);return c?i.restoreTransform?(i.restoreTransform(),l&&(i.globalCompositeOperation=v),u==u&&(i.globalAlpha=d)):i.restore():(l&&(i.globalCompositeOperation=v),u==u&&(i.globalAlpha=d)),f},l.renderText=function(i,n){n.textAlign="left",n.textBaseline="middle",n.lineJoin="round";for(var r=i.drawData,s=r.length,a=0;s>a;){var o=r[a++],h=r[a++],l=r[a++],u=r[a++];n.font=e(i,u);var c=null==u.textColor?i.textColor:u.textColor,d=null==u.strokeColor?i.strokeColor:u.strokeColor,f=null==u.stroke?i.stroke:u.stroke;n.fillStyle=t.toColorString(c),n.strokeStyle=t.toColorString(d),f&&(n.lineWidth=2*f,n.strokeText(l,o,h)),n.fillText(l,o,h)}},l.renderGraphics=function(t,e,r){var s=t.drawData,a=s.length;r=!!r;for(var o=0;a>o;o++){var h=s[o];switch(h.type){case 1:var l=h;e.fillStyle=r?$:i(l.fillColor,l.fillAlpha),this.renderPath(h,e),this.renderingMask?e.clip():e.fill();break;case 2:var u=h;e.fillStyle=r?$:n(e,u.gradientType,u.colors,u.alphas,u.ratios,u.matrix),e.save();var c=u.matrix;this.renderPath(h,e),e.transform(c.a,c.b,c.c,c.d,c.tx,c.ty),e.fill(),e.restore();break;case 3:var d=h,f=d.lineWidth;e.lineWidth=f,e.strokeStyle=r?$:i(d.lineColor,d.lineAlpha),e.lineCap=m[d.caps],e.lineJoin=d.joints,e.miterLimit=d.miterLimit;var g=1===f||3===f;g&&e.translate(.5,.5),this.renderPath(h,e),e.stroke(),g&&e.translate(-.5,-.5)}}},l.renderPath=function(t,e){e.beginPath();for(var i=t.$data,n=t.$commands,r=n.length,s=0,a=0;r>a;a++){var o=n[a];switch(o){case 4:e.bezierCurveTo(i[s++],i[s++],i[s++],i[s++],i[s++],i[s++]);break;case 3:e.quadraticCurveTo(i[s++],i[s++],i[s++],i[s++]);break;case 2:e.lineTo(i[s++],i[s++]);break;case 1:e.moveTo(i[s++],i[s++])}}},l.renderGroup=function(t,e){for(var i=0,n=t.drawData,r=n.length,s=0;r>s;s++){var a=n[s];i+=this.renderNode(a,e)}return i},l.createRenderBuffer=function(e,i){var n=y.pop();return n?n.resize(e,i,!0):n=new t.sys.CanvasRenderBuffer(e,i),n},a}();t.CanvasRenderer=T,t.registerClass(T,"egret.CanvasRenderer",["egret.sys.SystemRenderer"])}(egret||(egret={}));var egret;!function(t){t.DeviceOrientation=null}(egret||(egret={}));var egret;!function(){}(egret||(egret={}));var egret;!function(){}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}var e=t;return e.prototype,t.WEB="web",t.NATIVE="native",t}();t.RuntimeType=e,t.registerClass(e,"egret.RuntimeType");var i=function(){function t(){}var e=__define,i=t;return i.prototype,e(t,"language",function(){return t.$language}),e(t,"isMobile",function(){return t.$isMobile}),e(t,"os",function(){return t.$os}),e(t,"runtimeType",function(){return t.$runtimeType}),e(t,"supportVersion",function(){return t.$supportVersion}),e(t,"engineVersion",function(){return"3.2.0"}),t.$setNativeCapabilities=function(e){var i=e.split("-");if(i.length<=4){var n=i[0];switch(n){case"android":n="Android";break;case"ios":n="iOS"}t.$os=n;var r=i[2].substring(1,i[2].length);t.$supportVersion=r}},e(t,"renderMode",function(){return t.$renderMode}),e(t,"boundingClientWidth",function(){return t.$boundingClientWidth}),e(t,"boundingClientHeight",function(){return t.$boundingClientHeight}),t.$language="zh-CN",t.$os="Unknown",t.$runtimeType="Unknown",t.$supportVersion="Unknown",t.$renderMode="Unknown",t.$boundingClientWidth=0,t.$boundingClientHeight=0,t}();t.Capabilities=i,t.registerClass(i,"egret.Capabilities")}(egret||(egret={}));var testDeviceType=function(){if(!this.navigator)return!0;var t=navigator.userAgent.toLowerCase();return-1!=t.indexOf("mobile")||-1!=t.indexOf("android")},testRuntimeType=function(){return this.navigator?!0:!1};egret.Capabilities.$isMobile=testDeviceType(),egret.Capabilities.$runtimeType=testRuntimeType()?egret.RuntimeType.WEB:egret.RuntimeType.NATIVE;var egret;!function(t){var e=function(t){function e(e,i){t.call(this,e),this.firstCharHeight=0,this.charList="string"==typeof i?this.parseConfig(i):i&&i.hasOwnProperty("frames")?i.frames:{}}__extends(e,t);var i=e,n=i.prototype;return n.getTexture=function(t){var e=this._textureMap[t];if(!e){var i=this.charList[t];if(!i)return null;e=this.createTexture(t,i.x,i.y,i.w,i.h,i.offX,i.offY,i.sourceW,i.sourceH),this._textureMap[t]=e}return e},n.getConfig=function(t,e){return this.charList[t]?this.charList[t][e]:0},n._getFirstCharHeight=function(){if(0==this.firstCharHeight)for(var t in this.charList){var e=this.charList[t];if(e){var i=e.sourceH;if(void 0===i){var n=e.h;void 0===n&&(n=0);var r=e.offY;void 0===r&&(r=0),i=n+r}if(0>=i)continue;this.firstCharHeight=i;break}}return this.firstCharHeight},n.parseConfig=function(t){t=t.split("\r\n").join("\n");for(var e=t.split("\n"),i=this.getConfigByKey(e[3],"count"),n={},r=4;4+i>r;r++){var s=e[r],a=String.fromCharCode(this.getConfigByKey(s,"id")),o={};n[a]=o,o.x=this.getConfigByKey(s,"x"),o.y=this.getConfigByKey(s,"y"),o.w=this.getConfigByKey(s,"width"),o.h=this.getConfigByKey(s,"height"),o.offX=this.getConfigByKey(s,"xoffset"),o.offY=this.getConfigByKey(s,"yoffset"),o.xadvance=this.getConfigByKey(s,"xadvance")
}return n},n.getConfigByKey=function(t,e){for(var i=t.split(" "),n=0,r=i.length;r>n;n++){var s=i[n];if(e==s.substring(0,e.length)){var a=s.substring(e.length+1);return parseInt(a)}}return 0},e}(t.SpriteSheet);t.BitmapFont=e,t.registerClass(e,"egret.BitmapFont")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){e.call(this),this.$textOffsetX=0,this.$textOffsetY=0,this.$textStartX=0,this.$textStartY=0,this.$lineHeights=[],this.$renderNode=new t.sys.BitmapNode,this.$BitmapText={0:0/0,1:0/0,2:"",3:0,4:0,5:null,6:!1,7:!1,8:!1,9:!1,10:"left",11:"top",12:t.Bitmap.defaultSmoothing}}__extends(i,e);var n=__define,r=i,s=r.prototype;return n(s,"smoothing",function(){var t=this.$BitmapText;return t[12]},function(t){t=!!t;var e=this.$BitmapText;t!=e[12]&&(e[12]=t,this.$invalidate())}),n(s,"text",function(){return this.$BitmapText[2]},function(t){this.$setText(t)}),s.$setText=function(t){null==t&&(t=""),t=String(t);var e=this.$BitmapText;return t==e[2]?!1:(e[2]=t,this.$invalidateContentBounds(),!0)},s.$getWidth=function(){var t=this.$BitmapText[0];return isNaN(t)?this.$getContentBounds().width:t},s.$setWidth=function(t){var e=this.$BitmapText;return 0>t||t==e[0]?!1:(e[0]=t,this.$invalidateContentBounds(),!0)},s.$invalidateContentBounds=function(){e.prototype.$invalidateContentBounds.call(this),this.$BitmapText[7]=!0},s.$getHeight=function(){var t=this.$BitmapText[1];return isNaN(t)?this.$getContentBounds().height:t},s.$setHeight=function(t){var e=this.$BitmapText;return 0>t||t==e[1]?!1:(e[1]=t,this.$invalidateContentBounds(),!0)},n(s,"font",function(){return this.$BitmapText[5]},function(t){this.$setFont(t)}),s.$setFont=function(t){var e=this.$BitmapText;return e[5]==t?!1:(e[5]=t,this.$BitmapText[6]=!0,this.$invalidateContentBounds(),!0)},n(s,"lineSpacing",function(){return this.$BitmapText[3]},function(t){this.$setLineSpacing(t)}),s.$setLineSpacing=function(t){t=+t||0;var e=this.$BitmapText;return e[3]==t?!1:(e[3]=t,this.$invalidateContentBounds(),!0)},n(s,"letterSpacing",function(){return this.$BitmapText[4]},function(t){this.$setLetterSpacing(t)}),s.$setLetterSpacing=function(t){t=+t||0;var e=this.$BitmapText;return e[4]==t?!1:(e[4]=t,this.$invalidateContentBounds(),!0)},n(s,"textAlign",function(){return this.$BitmapText[10]},function(t){this.$setTextAlign(t)}),s.$setTextAlign=function(t){var e=this.$BitmapText;return e[10]==t?!1:(e[10]=t,this.$invalidateContentBounds(),!0)},n(s,"verticalAlign",function(){return this.$BitmapText[11]},function(t){this.$setVerticalAlign(t)}),s.$setVerticalAlign=function(t){var e=this.$BitmapText;return e[11]==t?!1:(e[11]=t,this.$invalidateContentBounds(),!0)},s.$render=function(){var e=this.$BitmapText,n=this.$getTextLines(),r=n.length;if(0!=r){var s=this.$textLinesWidth,a=e[5],o=this.$renderNode;a.$texture&&(o.image=a.$texture._bitmapData),o.smoothing=e[12];for(var h=a._getFirstCharHeight(),l=Math.ceil(h*i.EMPTY_FACTOR),u=!isNaN(e[1]),c=e[8],d=e[0],f=e[1],g=e[10],p=this.$textOffsetY+this.$textStartY,v=this.$lineHeights,$=0;r>$;$++){var m=v[$];if(u&&$>0&&p+m>f)break;var y=n[$],T=y.length,x=this.$textOffsetX;if(g!=t.HorizontalAlign.LEFT){var b=d>c?d:c;g==t.HorizontalAlign.RIGHT?x+=b-s[$]:g==t.HorizontalAlign.CENTER&&(x+=Math.floor((b-s[$])/2))}for(var _=0;T>_;_++){var E=y.charAt(_),C=a.getTexture(E);if(C){var F=C._bitmapWidth,w=C._bitmapHeight;o.imageWidth=C._sourceWidth,o.imageHeight=C._sourceHeight,o.drawImage(C._bitmapX,C._bitmapY,F,w,x+C._offsetX,p+C._offsetY,C.$getScaleBitmapWidth(),C.$getScaleBitmapHeight()),x+=(a.getConfig(E,"xadvance")||C.$getTextureWidth())+e[4]}else" "==E?x+=l:t.$warn(1046,E)}p+=m+e[3]}}},s.$measureContentBounds=function(t){var e=this.$getTextLines();0==e.length?t.setEmpty():t.setTo(this.$textOffsetX+this.$textStartX,this.$textOffsetY+this.$textStartY,this.$BitmapText[8]-this.$textOffsetX,this.$BitmapText[9]-this.$textOffsetY)},n(s,"textWidth",function(){return this.$getTextLines(),this.$BitmapText[8]}),n(s,"textHeight",function(){return this.$getTextLines(),this.$BitmapText[9]}),s.$getTextLines=function(){function e(t){return p&&r.length>0&&u>p?!1:(u+=F+o,R||S||(w-=h),r.push(t),a.push(F),s.push(w),l=Math.max(w,l),!0)}var n=this.$BitmapText;if(!n[7])return this.textLines;var r=[];this.textLines=r;var s=[];this.$textLinesWidth=s,n[7]=!1;var a=[];if(this.$lineHeights=a,!n[2]||!n[5])return r;for(var o=n[3],h=n[4],l=0,u=0,c=0,d=0,f=!isNaN(n[0]),g=n[0],p=n[1],v=n[5],$=v._getFirstCharHeight(),m=Math.ceil($*i.EMPTY_FACTOR),y=n[2],T=y.split(/(?:\r\n|\r|\n)/),x=T.length,b=!0,_=0;x>_;_++){for(var E=T[_],C=E.length,F=0,w=0,R=!0,S=!1,D=0;C>D;D++){R||(w+=h);var O,L,M=E.charAt(D),N=0,A=0,I=v.getTexture(M);if(I)O=I.$getTextureWidth(),L=I.$getTextureHeight(),N=I._offsetX,A=I._offsetY;else{if(" "!=M){t.$warn(1046,M),R&&(R=!1);continue}O=m,L=$}if(R&&(R=!1,c=Math.min(N,c)),b&&(b=!1,d=Math.min(A,d)),f&&D>0&&w+O>g){if(!e(E.substring(0,D)))break;E=E.substring(D),C=E.length,D=0,w=D==C-1?O:v.getConfig(M,"xadvance")||O,F=L}else w+=D==C-1?O:v.getConfig(M,"xadvance")||O,F=Math.max(L,F)}if(p&&_>0&&u>p)break;if(S=!0,!e(E))break}u-=o,n[8]=l,n[9]=u,this.$textOffsetX=c,this.$textOffsetY=d,this.$textStartX=0,this.$textStartY=0;var B;return g>l&&(B=n[10],B==t.HorizontalAlign.RIGHT?this.$textStartX=g-l:B==t.HorizontalAlign.CENTER&&(this.$textStartX=Math.floor((g-l)/2))),p>u&&(B=n[11],B==t.VerticalAlign.BOTTOM?this.$textStartY=p-u:B==t.VerticalAlign.MIDDLE&&(this.$textStartY=Math.floor((p-u)/2))),r},i.EMPTY_FACTOR=.33,i}(t.DisplayObject);t.BitmapText=e,t.registerClass(e,"egret.BitmapText")}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}var e=t;return e.prototype,t.LEFT="left",t.RIGHT="right",t.CENTER="center",t.JUSTIFY="justify",t.CONTENT_JUSTIFY="contentJustify",t}();t.HorizontalAlign=e,t.registerClass(e,"egret.HorizontalAlign")}(egret||(egret={}));var egret;!function(t){var e=function(){function e(){this.replaceArr=[],this.resutlArr=[],this.initReplaceArr()}var i=e,n=i.prototype;return n.initReplaceArr=function(){this.replaceArr=[],this.replaceArr.push([/&lt;/g,"<"]),this.replaceArr.push([/&gt;/g,">"]),this.replaceArr.push([/&amp;/g,"&"]),this.replaceArr.push([/&quot;/g,'"']),this.replaceArr.push([/&apos;/g,"'"])},n.replaceSpecial=function(t){for(var e=0;e<this.replaceArr.length;e++){var i=this.replaceArr[e][0],n=this.replaceArr[e][1];t=t.replace(i,n)}return t},n.parser=function(e){this.stackArray=[],this.resutlArr=[];for(var i=0,n=e.length;n>i;){var r=e.indexOf("<",i);if(0>r)this.addToResultArr(e.substring(i)),i=n;else{this.addToResultArr(e.substring(i,r));var s=e.indexOf(">",r);-1==s?(t.$error(1038),s=r):"/"==e.charAt(r+1)?this.stackArray.pop():this.addToArray(e.substring(r+1,s)),i=s+1}}return this.resutlArr},n.addToResultArr=function(t){""!=t&&(t=this.replaceSpecial(t),this.resutlArr.push(this.stackArray.length>0?{text:t,style:this.stackArray[this.stackArray.length-1]}:{text:t}))},n.changeStringToObject=function(t){t=t.trim();var e={},i=[];if("i"==t.charAt(0)||"b"==t.charAt(0)||"u"==t.charAt(0))this.addProperty(e,t,"true");else if(i=t.match(/^(font|a)\s/)){t=t.substring(i[0].length).trim();for(var n,r=0;n=t.match(this.getHeadReg());){var s=n[0],a="",t=t.substring(s.length).trim();if('"'==t.charAt(0)){var r=t.indexOf('"',1);a=t.substring(1,r),r+=1}else if("'"==t.charAt(0)){var r=t.indexOf("'",1);a=t.substring(1,r),r+=1}else a=t.match(/(\S)+/)[0],r=a.length;this.addProperty(e,s.substring(0,s.length-1).trim(),a.trim()),t=t.substring(r).trim()}}return e},n.getHeadReg=function(){return/^(color|textcolor|strokecolor|stroke|b|bold|i|italic|u|size|fontfamily|href|target)(\s)*=/},n.addProperty=function(t,e,i){switch(e.toLowerCase()){case"color":case"textcolor":i=i.replace(/#/,"0x"),t.textColor=parseInt(i);break;case"strokecolor":i=i.replace(/#/,"0x"),t.strokeColor=parseInt(i);break;case"stroke":t.stroke=parseInt(i);break;case"b":case"bold":t.bold="true"==i;break;case"u":t.underline="true"==i;break;case"i":case"italic":t.italic="true"==i;break;case"size":t.size=parseInt(i);break;case"fontfamily":t.fontFamily=i;break;case"href":t.href=this.replaceSpecial(i);break;case"target":t.target=this.replaceSpecial(i)}},n.addToArray=function(t){var e=this.changeStringToObject(t);if(0==this.stackArray.length)this.stackArray.push(e);else{var i=this.stackArray[this.stackArray.length-1];for(var n in i)null==e[n]&&(e[n]=i[n]);this.stackArray.push(e)}},e}();t.HtmlTextParser=e,t.registerClass(e,"egret.HtmlTextParser")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){e.call(this),this.stageTextAdded=!1,this._text=null,this._isFocus=!1}__extends(i,e);var n=i,r=n.prototype;return r.init=function(e){this._text=e,this.stageText=new t.StageText,this.stageText.$setTextField(this._text)},r._addStageText=function(){this.stageTextAdded||(this._text.$inputEnabled||(this._text.$touchEnabled=!0),this.tempStage=this._text.stage,this.stageText.$addToStage(),this.stageText.addEventListener("updateText",this.updateTextHandler,this),this._text.addEventListener(t.TouchEvent.TOUCH_BEGIN,this.onMouseDownHandler,this),this.stageText.addEventListener("blur",this.blurHandler,this),this.stageText.addEventListener("focus",this.focusHandler,this),this.stageTextAdded=!0)},r._removeStageText=function(){this.stageTextAdded&&(this._text.$inputEnabled||(this._text.$touchEnabled=!1),this.stageText.$removeFromStage(),this.stageText.removeEventListener("updateText",this.updateTextHandler,this),this._text.removeEventListener(t.TouchEvent.TOUCH_BEGIN,this.onMouseDownHandler,this),this.tempStage.removeEventListener(t.TouchEvent.TOUCH_BEGIN,this.onStageDownHandler,this),this.stageText.removeEventListener("blur",this.blurHandler,this),this.stageText.removeEventListener("focus",this.focusHandler,this),this.stageTextAdded=!1)},r._getText=function(){return this.stageText.$getText()},r._setText=function(t){this.stageText.$setText(t)},r._setColor=function(t){this.stageText.$setColor(t)},r.focusHandler=function(e){this._isFocus||(this._isFocus=!0,e.showing||(this._text.$isTyping=!0),this._text.$invalidateContentBounds(),this._text.dispatchEvent(new t.FocusEvent(t.FocusEvent.FOCUS_IN,!0)))},r.blurHandler=function(){this._isFocus&&(this._isFocus=!1,this.tempStage.removeEventListener(t.TouchEvent.TOUCH_BEGIN,this.onStageDownHandler,this),this._text.$isTyping=!1,this._text.$invalidateContentBounds(),this.stageText.$onBlur(),this._text.dispatchEvent(new t.FocusEvent(t.FocusEvent.FOCUS_OUT,!0)))},r.onMouseDownHandler=function(t){t.stopPropagation(),this.$onFocus()},r.$onFocus=function(){this._text.visible&&(this._isFocus||(this.tempStage.addEventListener(t.TouchEvent.TOUCH_BEGIN,this.onStageDownHandler,this),this.stageText.$show()))},r.onStageDownHandler=function(){this.stageText.$hide()},r.updateTextHandler=function(){var e=this._text.$TextField,i=this.stageText.$getText(),n=!1;if(null!=e[35]){var r=new RegExp("["+e[35]+"]","g"),s=i.match(r);i=s?s.join(""):"",n=!0}null!=e[36]&&(r=new RegExp("[^"+e[36]+"]","g"),s=i.match(r),i=s?s.join(""):"",n=!0),n&&this.stageText.$getText()!=i&&this.stageText.$setText(i),this.resetText(),this._text.dispatchEvent(new t.Event(t.Event.CHANGE,!0))},r.resetText=function(){this._text.$setBaseText(this.stageText.$getText())},r._hideInput=function(){this.stageText.$removeFromStage()},r.updateInput=function(){!this._text.$visible&&this.stageText&&this._hideInput()},r._updateProperties=function(){if(this._isFocus)return this.stageText.$resetStageText(),void this.updateInput();var t=this._text.$stage;if(null==t);else for(var e=this._text,i=e.$visible;i&&(e=e.parent,e!=t);)i=e.$visible;this.stageText.$setText(this._text.$TextField[13]),this.stageText.$resetStageText(),this.updateInput()},i}(t.HashObject);t.InputController=e,t.registerClass(e,"egret.InputController")}(egret||(egret={}));var egret;!function(){}(egret||(egret={}));var egret;!function(t){function e(e,i,r){r=r||{};var s=null==r.italic?i[16]:r.italic,a=null==r.bold?i[15]:r.bold,o=null==r.size?i[0]:r.size,h=r.fontFamily||i[8]||n.default_fontFamily;return t.sys.measureText(e,h,o,a,s)}var i=new RegExp("(?=[\\u00BF-\\u1FFF\\u2C00-\\uD7FF]|\\b|\\s)(?![)}\\.\\,\\!\\?\\]\\:])"),n=function(n){function r(){n.call(this),this.$inputEnabled=!1,this.inputUtils=null,this.graphicsNode=null,this.isFlow=!1,this.textArr=[],this.linesArr=[],this.$isTyping=!1;var e=new t.sys.TextNode;e.fontFamily=r.default_fontFamily,this.textNode=e,this.$renderNode=e,this.$TextField={0:30,1:0,2:16777215,3:0/0,4:0/0,5:0,6:0,7:0,8:r.default_fontFamily,9:"left",10:"top",11:"#ffffff",12:"",13:"",14:[],15:!1,16:!1,17:!0,18:!1,19:!1,20:!1,21:0,22:0,23:0,24:t.TextFieldType.DYNAMIC,25:0,26:"#000000",27:0,28:-1,29:0,30:!1,31:!1,32:0,33:!1,34:16777215,35:null,36:null,37:t.TextFieldInputType.TEXT}}__extends(r,n);var s=__define,a=r,o=a.prototype;return o.isInput=function(){return this.$TextField[24]==t.TextFieldType.INPUT},o.$setTouchEnabled=function(t){var e=n.prototype.$setTouchEnabled.call(this,t);return this.isInput()&&(this.$inputEnabled=!0),e},s(o,"fontFamily",function(){return this.$TextField[8]},function(t){this.$setFontFamily(t)}),o.$setFontFamily=function(t){var e=this.$TextField;return e[8]==t?!1:(e[8]=t,this.invalidateFontString(),!0)},s(o,"size",function(){return this.$TextField[0]},function(t){this.$setSize(t)}),o.$setSize=function(t){t=+t||0;var e=this.$TextField;return e[0]==t?!1:(e[0]=t,this.invalidateFontString(),!0)},s(o,"bold",function(){return this.$TextField[15]},function(t){this.$setBold(t)}),o.$setBold=function(t){t=!!t;var e=this.$TextField;return t==e[15]?!1:(e[15]=t,this.invalidateFontString(),!0)},s(o,"italic",function(){return this.$TextField[16]},function(t){this.$setItalic(t)}),o.$setItalic=function(t){t=!!t;var e=this.$TextField;return t==e[16]?!1:(e[16]=t,this.invalidateFontString(),!0)},o.invalidateFontString=function(){this.$TextField[17]=!0,this.$invalidateTextField()},s(o,"textAlign",function(){return this.$TextField[9]},function(t){this.$setTextAlign(t)}),o.$setTextAlign=function(t){var e=this.$TextField;return e[9]==t?!1:(e[9]=t,this.$invalidateTextField(),!0)},s(o,"verticalAlign",function(){return this.$TextField[10]},function(t){this.$setVerticalAlign(t)}),o.$setVerticalAlign=function(t){var e=this.$TextField;return e[10]==t?!1:(e[10]=t,this.$invalidateTextField(),!0)},s(o,"lineSpacing",function(){return this.$TextField[1]},function(t){this.$setLineSpacing(t)}),o.$setLineSpacing=function(t){t=+t||0;var e=this.$TextField;return e[1]==t?!1:(e[1]=t,this.$invalidateTextField(),!0)},s(o,"textColor",function(){return this.$TextField[2]},function(t){this.$setTextColor(t)}),o.$setTextColor=function(t){t=0|+t;var e=this.$TextField;return e[2]==t?!1:(e[2]=t,this.inputUtils&&this.inputUtils._setColor(this.$TextField[2]),this.$invalidate(),!0)},s(o,"wordWrap",function(){return this.$TextField[19]},function(t){t=!!t;var e=this.$TextField;t!=e[19]&&(e[20]||(e[19]=t,this.$invalidateTextField()))}),s(o,"type",function(){return this.$TextField[24]},function(t){this.$setType(t)}),o.$setType=function(e){var i=this.$TextField;return i[24]!=e?(i[24]=e,e==t.TextFieldType.INPUT?(isNaN(i[3])&&this.$setWidth(100),isNaN(i[4])&&this.$setHeight(30),this.$setTouchEnabled(!0),null==this.inputUtils&&(this.inputUtils=new t.InputController),this.inputUtils.init(this),this.$invalidateTextField(),this.$stage&&this.inputUtils._addStageText()):(this.inputUtils&&(this.inputUtils._removeStageText(),this.inputUtils=null),this.$setTouchEnabled(!1)),!0):!1},s(o,"inputType",function(){return this.$TextField[37]},function(t){this.$TextField[37]=t}),s(o,"text",function(){return this.$getText()},function(t){this.$setText(t)}),o.$getText=function(){return this.$TextField[24]==t.TextFieldType.INPUT?this.inputUtils._getText():this.$TextField[13]},o.$setBaseText=function(t){null==t&&(t=""),t=t.toString(),this.isFlow=!1;var e=this.$TextField;if(e[13]!=t){this.$invalidateTextField(),e[13]=t;var i="";return i=e[20]?this.changeToPassText(t):t,this.setMiddleStyle([{text:i}]),!0}return!1},o.$setText=function(t){null==t&&(t="");var e=this.$setBaseText(t);return this.inputUtils&&this.inputUtils._setText(this.$TextField[13]),e},s(o,"displayAsPassword",function(){return this.$TextField[20]},function(t){this.$setDisplayAsPassword(t)}),o.$setDisplayAsPassword=function(t){var e=this.$TextField;if(e[20]!=t){e[20]=t,this.$invalidateTextField();var i="";return i=t?this.changeToPassText(e[13]):e[13],this.setMiddleStyle([{text:i}]),!0}return!1},s(o,"strokeColor",function(){return this.$TextField[25]},function(t){t=+t||0,this.$setStrokeColor(t)}),o.$setStrokeColor=function(e){var i=this.$TextField;return i[25]!=e?(this.$invalidateTextField(),i[25]=e,i[26]=t.toColorString(e),!0):!1},s(o,"stroke",function(){return this.$TextField[27]},function(t){this.$setStroke(t)}),o.$setStroke=function(t){return this.$TextField[27]!=t?(this.$invalidateTextField(),this.$TextField[27]=t,!0):!1},s(o,"maxChars",function(){return this.$TextField[21]},function(t){this.$setMaxChars(t)}),o.$setMaxChars=function(t){return this.$TextField[21]!=t?(this.$TextField[21]=t,!0):!1},s(o,"scrollV",function(){return Math.min(Math.max(this.$TextField[28],1),this.maxScrollV)},function(t){this.$TextField[28]=Math.max(t,1),this.$invalidateTextField()}),s(o,"maxScrollV",function(){return this.$getLinesArr(),Math.max(this.$TextField[29]-t.TextFieldUtils.$getScrollNum(this)+1,1)}),s(o,"selectionBeginIndex",function(){return 0}),s(o,"selectionEndIndex",function(){return 0}),s(o,"caretIndex",function(){return 0}),o.$setSelection=function(){return!1},o.$getLineHeight=function(){return this.$TextField[1]+this.$TextField[0]},s(o,"numLines",function(){return this.$getLinesArr(),this.$TextField[29]}),s(o,"multiline",function(){return this.$TextField[30]},function(t){this.$setMultiline(t)}),o.$setMultiline=function(t){return this.$TextField[30]=t,this.$invalidateTextField(),!0},s(o,"restrict",function(){var t=this.$TextField,e=null;return null!=t[35]&&(e=t[35]),null!=t[36]&&(null==e&&(e=""),e+="^"+t[36]),e},function(t){var e=this.$TextField;if(null==t)e[35]=null,e[36]=null;else{for(var i=-1;i<t.length&&(i=t.indexOf("^",i),0!=i)&&i>0&&"\\"==t.charAt(i-1);)i++;0==i?(e[35]=null,e[36]=t.substring(i+1)):i>0?(e[35]=t.substring(0,i),e[36]=t.substring(i+1)):(e[35]=t,e[36]=null)}}),o.$setWidth=function(t){var e=this.$TextField;if(isNaN(t)){if(isNaN(e[3]))return!1;e[3]=0/0}else{if(e[3]==t)return!1;e[3]=t}return t=+t,0>t?!1:(this.$invalidateTextField(),!0)},o.$setHeight=function(t){var e=this.$TextField;if(isNaN(t)){if(isNaN(e[4]))return!1;e[4]=0/0}else{if(e[4]==t)return!1;e[4]=t}return t=+t,0>t?!1:(this.$invalidateTextField(),!0)},o.$getWidth=function(){var t=this.$TextField;return isNaN(t[3])?this.$getContentBounds().width:t[3]},o.$getHeight=function(){var t=this.$TextField;return isNaN(t[4])?this.$getContentBounds().height:t[4]},s(o,"border",function(){return this.$TextField[31]},function(t){this.$TextField[31]=!!t,this.$invalidate()}),s(o,"borderColor",function(){return this.$TextField[32]},function(t){this.$TextField[32]=+t||0,this.$invalidate()}),s(o,"background",function(){return this.$TextField[33]},function(t){this.$TextField[33]=t,this.$invalidate()}),s(o,"backgroundColor",function(){return this.$TextField[34]},function(t){this.$TextField[34]=t,this.$invalidate()}),o.fillBackground=function(e){var i=this.graphicsNode;i&&i.clear();var n=this.$TextField;if(n[33]||n[31]||e&&e.length>0){if(!i){i=this.graphicsNode=new t.sys.GraphicsNode;var r=new t.sys.GroupNode;r.addNode(i),r.addNode(this.textNode),this.$renderNode=r}var s,a;if(n[33]&&(s=i.beginFill(n[34]),s.drawRect(0,0,this.$getWidth(),this.$getHeight())),n[31]&&(a=i.lineStyle(1,n[32]),a.drawRect(0,0,this.$getWidth()-1,this.$getHeight()-1)),e&&e.length>0)for(var o=n[2],h=-1,l=e.length,u=0;l>u;u+=4){var c=e[u],d=e[u+1],f=e[u+2],g=e[u+3]||o;(0>h||h!=g)&&(h=g,a=i.lineStyle(2,g,1,t.CapsStyle.NONE)),a.moveTo(c,d),a.lineTo(c+f,d)}}if(i){var p=this.$getRenderBounds();i.x=p.x,i.y=p.y,i.width=p.width,i.height=p.height,t.Rectangle.release(p)}},o.setFocus=function(){this.type==t.TextFieldType.INPUT&&this.$stage&&this.inputUtils.$onFocus()},o.$onRemoveFromStage=function(){n.prototype.$onRemoveFromStage.call(this),this.removeEvent(),this.$TextField[24]==t.TextFieldType.INPUT&&this.inputUtils._removeStageText(),this.textNode&&this.textNode.clean()},o.$onAddToStage=function(e,i){n.prototype.$onAddToStage.call(this,e,i),this.addEvent(),this.$TextField[24]==t.TextFieldType.INPUT&&this.inputUtils._addStageText()},o.$invalidateTextField=function(){this.$invalidateContentBounds(),this.$TextField[18]=!0},o.$update=function(e){var i=this.$getRenderBounds(),r=n.prototype.$update.call(this,e,i);return t.Rectangle.release(i),r},o.$getRenderBounds=function(){var e=this.$getContentBounds(),i=t.Rectangle.create();i.copyFrom(e),this.$TextField[31]&&(i.width+=2,i.height+=2);var n=2*this.$TextField[27];return n>0&&(i.width+=2*n,i.height+=2*n),i.x-=n+2,i.y-=n+2,i.width=Math.ceil(i.width)+4,i.height=Math.ceil(i.height)+4,i},o.$measureContentBounds=function(e){this.$getLinesArr();var i=isNaN(this.$TextField[3])?this.$TextField[5]:this.$TextField[3],n=isNaN(this.$TextField[4])?t.TextFieldUtils.$getTextHeight(this):this.$TextField[4];e.setTo(0,0,i,n)},o.$render=function(){if(this.$TextField[24]==t.TextFieldType.INPUT){if((this.$hasAnyFlags(2032)||this.$hasAnyFlags(1648))&&this.inputUtils._updateProperties(),this.$isTyping)return void this.fillBackground()}else if(0==this.$TextField[3])return;var e=this.drawText();this.fillBackground(e);var i=this.$getRenderBounds(),n=this.textNode;n.x=i.x,n.y=i.y,n.width=Math.ceil(i.width),n.height=Math.ceil(i.height),t.Rectangle.release(i)},s(o,"textFlow",function(){return this.textArr},function(t){this.isFlow=!0;var e="";null==t&&(t=[]);for(var i=0;i<t.length;i++){var n=t[i];e+=n.text}this.$TextField[20]?this.$setBaseText(e):(this.$TextField[13]=e,this.setMiddleStyle(t))}),o.changeToPassText=function(t){if(this.$TextField[20]){for(var e="",i=0,n=t.length;n>i;i++)switch(t.charAt(i)){case"\n":e+="\n";break;case"\r":break;default:e+="*"}return e}return t},o.setMiddleStyle=function(t){this.$TextField[18]=!0,this.textArr=t,this.$invalidateTextField()},s(o,"textWidth",function(){return this.$getLinesArr(),this.$TextField[5]}),s(o,"textHeight",function(){return this.$getLinesArr(),t.TextFieldUtils.$getTextHeight(this)}),o.appendText=function(t){this.appendElement({text:t})},o.appendElement=function(t){var e=this.$TextField[13]+t.text;this.$TextField[20]?this.$setBaseText(e):(this.$TextField[13]=e,this.textArr.push(t),this.setMiddleStyle(this.textArr))},o.$getLinesArr=function(){var n=this.$TextField;if(!n[18])return this.linesArr;n[18]=!1;var r=this.textArr;this.linesArr.length=0,n[6]=0,n[5]=0;var s=n[3];if(!isNaN(s)&&0==s)return n[29]=0,[{width:0,height:0,charNum:0,elements:[],hasNextLine:!1}];for(var a,o=this.linesArr,h=0,l=0,u=0,c=0,d=0,f=r.length;f>d;d++){var g=r[d];if(g.text){g.style=g.style||{};for(var p=g.text.toString(),v=p.split(/(?:\r\n|\r|\n)/),$=0,m=v.length;m>$;$++){null==o[c]&&(a={width:0,height:0,elements:[],charNum:0,hasNextLine:!1},o[c]=a,h=0,u=0,l=0),u=n[24]==t.TextFieldType.INPUT?n[0]:Math.max(u,g.style.size||n[0]);var y=!0;if(""==v[$])$==m-1&&(y=!1);else{var T=e(v[$],n,g.style);if(isNaN(s))h+=T,l+=v[$].length,a.elements.push({width:T,text:v[$],style:g.style}),$==m-1&&(y=!1);else if(s>=h+T)a.elements.push({width:T,text:v[$],style:g.style}),h+=T,l+=v[$].length,$==m-1&&(y=!1);else{var x=0,b=0,_=v[$];if(n[19])var E=_.split(i);else E=_.match(/./g);for(var C=E.length,F=0;C>x&&(T=e(E[x],n,g.style),!(0!=h&&h+T>s&&h+x!=0));x++)if(b+T>s)for(var w=E[x].match(/./g),R=0,S=w.length;S>R&&(T=e(w[R],n,g.style),!(R>0&&h+T>s));R++)F+=w[R].length,b+=T,h+=T,l+=F;else F+=E[x].length,b+=T,h+=T,l+=F;if(x>0){a.elements.push({width:b,text:_.substring(0,F),style:g.style});for(var D=_.substring(F),O=0,L=D.length;L>O&&" "==D.charAt(O);O++);v[$]=D.substring(O)}""!=v[$]&&($--,y=!1)}}y&&(l++,a.hasNextLine=!0),$<v.length-1&&(a.width=h,a.height=u,a.charNum=l,n[5]=Math.max(n[5],h),n[6]+=u,c++)}d==r.length-1&&a&&(a.width=h,a.height=u,a.charNum=l,n[5]=Math.max(n[5],h),n[6]+=u)}else a&&(a.width=h,a.height=u,a.charNum=l,n[5]=Math.max(n[5],h),n[6]+=u)}return n[29]=o.length,o},o.drawText=function(){var e=this.textNode,i=this.$TextField;e.bold=i[15],e.fontFamily=i[8]||r.default_fontFamily,e.italic=i[16],e.size=i[0],e.stroke=i[27],e.strokeColor=i[25],e.textColor=i[2];var n=this.$getLinesArr();if(0==i[5])return[];var s=isNaN(i[3])?i[5]:i[3],a=t.TextFieldUtils.$getTextHeight(this),o=0,h=t.TextFieldUtils.$getStartLine(this),l=i[4];if(!isNaN(l)&&l>a){var u=t.TextFieldUtils.$getValign(this);o+=u*(l-a)}o=Math.round(o);for(var c=t.TextFieldUtils.$getHalign(this),d=0,f=[],g=h,p=i[29];p>g;g++){var v=n[g],$=v.height;if(o+=$/2,g!=h){if(i[24]==t.TextFieldType.INPUT&&!i[30])break;if(!isNaN(l)&&o>l)break}d=Math.round((s-v.width)*c);for(var m=0,y=v.elements.length;y>m;m++){var T=v.elements[m],x=T.style.size||i[0];e.drawText(d,o+($-x)/2,T.text,T.style),T.style.underline&&f.push(d,o+$/2,T.width,T.style.textColor),d+=T.width}o+=$/2+i[1]}return f},o.addEvent=function(){this.addEventListener(t.TouchEvent.TOUCH_TAP,this.onTapHandler,this)},o.removeEvent=function(){this.removeEventListener(t.TouchEvent.TOUCH_TAP,this.onTapHandler,this)},o.onTapHandler=function(e){if(this.$TextField[24]!=t.TextFieldType.INPUT){var i=t.TextFieldUtils.$getTextElement(this,e.localX,e.localY);if(null!=i){var n=i.style;if(n&&n.href)if(n.href.match(/^event:/)){var r=n.href.match(/^event:/)[0];t.TextEvent.dispatchTextEvent(this,t.TextEvent.LINK,n.href.substring(r.length))}else open(n.href,n.target||"_blank")}}},r.default_fontFamily="Arial",r}(t.DisplayObject);t.TextField=n,t.registerClass(n,"egret.TextField")}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}var e=t;return e.prototype,t.TEXT="text",t.TEL="tel",t.PASSWORD="password",t}();t.TextFieldInputType=e,t.registerClass(e,"egret.TextFieldInputType")}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}var e=t;return e.prototype,t.DYNAMIC="dynamic",t.INPUT="input",t}();t.TextFieldType=e,t.registerClass(e,"egret.TextFieldType")}(egret||(egret={}));var egret;!function(t){var e=function(){function e(){}var i=e;return i.prototype,e.$getStartLine=function(t){var i=t.$TextField,n=e.$getTextHeight(t),r=0,s=i[4];return isNaN(s)||(s>n||n>s&&(r=Math.max(i[28]-1,0),r=Math.min(i[29]-1,r)),i[30]||(r=Math.max(i[28]-1,0),i[29]>0&&(r=Math.min(i[29]-1,r)))),r},e.$getHalign=function(e){var i=e.$getLinesArr(),n=0;return e.$TextField[9]==t.HorizontalAlign.CENTER?n=.5:e.$TextField[9]==t.HorizontalAlign.RIGHT&&(n=1),e.$TextField[24]==t.TextFieldType.INPUT&&!e.$TextField[30]&&i.length>1&&(n=0),n},e.$getTextHeight=function(e){var i=t.TextFieldType.INPUT!=e.$TextField[24]||e.$TextField[30]?e.$TextField[6]+(e.$TextField[29]-1)*e.$TextField[1]:e.$TextField[0];return i},e.$getValign=function(i){var n=e.$getTextHeight(i),r=i.$TextField[4];if(!isNaN(r)&&r>n){var s=0;return i.$TextField[10]==t.VerticalAlign.MIDDLE?s=.5:i.$TextField[10]==t.VerticalAlign.BOTTOM&&(s=1),s}return 0},e.$getTextElement=function(t,i,n){var r=e.$getHit(t,i,n),s=t.$getLinesArr();return r&&s[r.lineIndex]&&s[r.lineIndex].elements[r.textElementIndex]?s[r.lineIndex].elements[r.textElementIndex]:null},e.$getHit=function(t,i,n){var r=t.$getLinesArr();if(0==t.$TextField[3])return null;var s=0,a=e.$getTextHeight(t),o=0,h=t.$TextField[4];if(!isNaN(h)&&h>a){var l=e.$getValign(t);o=l*(h-a),0!=o&&(n-=o)}for(var u=e.$getStartLine(t),c=0,d=u;d<r.length;d++){var f=r[d];if(c+f.height>=n){n>c&&(s=d+1);break}if(c+=f.height,c+t.$TextField[1]>n)return null;c+=t.$TextField[1]}if(0==s)return null;var g=r[s-1],p=t.$TextField[3];isNaN(p)&&(p=t.textWidth);var v=e.$getHalign(t);i-=v*(p-g.width);var $=0;for(d=0;d<g.elements.length;d++){var m=g.elements[d];if($+m.width<=i)$+=m.width;else if(i>$)return{lineIndex:s-1,textElementIndex:d}}return null},e.$getScrollNum=function(t){var e=1;if(t.$TextField[30]){var i=t.height,n=t.size,r=t.lineSpacing;e=Math.floor(i/(n+r));var s=i-(n+r)*e;s>n/2&&e++}return e},e}();t.TextFieldUtils=e,t.registerClass(e,"egret.TextFieldUtils")}(egret||(egret={}));var egret;!function(t){var e;!function(){}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}var e=t;return e.prototype,t.TOP="top",t.BOTTOM="bottom",t.MIDDLE="middle",t.JUSTIFY="justify",t.CONTENT_JUSTIFY="contentJustify",t}();t.VerticalAlign=e,t.registerClass(e,"egret.VerticalAlign")}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}var e=t;return e.prototype,t.LITTLE_ENDIAN="littleEndian",t.BIG_ENDIAN="bigEndian",t}();t.Endian=e,t.registerClass(e,"egret.Endian");var i=function(){function i(t){this.BUFFER_EXT_SIZE=0,this.EOF_byte=-1,this.EOF_code_point=-1,this._setArrayBuffer(t||new ArrayBuffer(this.BUFFER_EXT_SIZE)),this.endian=e.BIG_ENDIAN}var n=__define,r=i,s=r.prototype;return s._setArrayBuffer=function(t){this.write_position=t.byteLength,this.data=new DataView(t),this._position=0},s.setArrayBuffer=function(){},n(s,"buffer",function(){return this.data.buffer},function(t){this.data=new DataView(t)}),n(s,"dataView",function(){return this.data},function(t){this.data=t,this.write_position=t.byteLength}),n(s,"bufferOffset",function(){return this.data.byteOffset}),n(s,"position",function(){return this._position},function(t){this._position=t,this.write_position=t>this.write_position?t:this.write_position}),n(s,"length",function(){return this.write_position},function(t){this.write_position=t;var e=new Uint8Array(new ArrayBuffer(t)),i=this.data.buffer.byteLength;i>t&&(this._position=t);var n=Math.min(i,t);e.set(new Uint8Array(this.data.buffer,0,n)),this.buffer=e.buffer}),n(s,"bytesAvailable",function(){return this.data.byteLength-this._position}),s.clear=function(){this._setArrayBuffer(new ArrayBuffer(this.BUFFER_EXT_SIZE))},s.readBoolean=function(){return this.validate(i.SIZE_OF_BOOLEAN)?0!=this.data.getUint8(this.position++):null},s.readByte=function(){return this.validate(i.SIZE_OF_INT8)?this.data.getInt8(this.position++):null},s.readBytes=function(t,e,n){if(void 0===e&&(e=0),void 0===n&&(n=0),0==n)n=this.bytesAvailable;else if(!this.validate(n))return null;t?t.validateBuffer(e+n):t=new i(new ArrayBuffer(e+n));for(var r=0;n>r;r++)t.data.setUint8(r+e,this.data.getUint8(this.position++))},s.readDouble=function(){if(!this.validate(i.SIZE_OF_FLOAT64))return null;var t=this.data.getFloat64(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=i.SIZE_OF_FLOAT64,t},s.readFloat=function(){if(!this.validate(i.SIZE_OF_FLOAT32))return null;var t=this.data.getFloat32(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=i.SIZE_OF_FLOAT32,t},s.readInt=function(){if(!this.validate(i.SIZE_OF_INT32))return null;var t=this.data.getInt32(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=i.SIZE_OF_INT32,t},s.readShort=function(){if(!this.validate(i.SIZE_OF_INT16))return null;var t=this.data.getInt16(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=i.SIZE_OF_INT16,t},s.readUnsignedByte=function(){return this.validate(i.SIZE_OF_UINT8)?this.data.getUint8(this.position++):null},s.readUnsignedInt=function(){if(!this.validate(i.SIZE_OF_UINT32))return null;var t=this.data.getUint32(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=i.SIZE_OF_UINT32,t},s.readUnsignedShort=function(){if(!this.validate(i.SIZE_OF_UINT16))return null;var t=this.data.getUint16(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=i.SIZE_OF_UINT16,t},s.readUTF=function(){if(!this.validate(i.SIZE_OF_UINT16))return null;var t=this.data.getUint16(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=i.SIZE_OF_UINT16,t>0?this.readUTFBytes(t):""},s.readUTFBytes=function(t){if(!this.validate(t))return null;var e=new Uint8Array(this.buffer,this.bufferOffset+this.position,t);return this.position+=t,this.decodeUTF8(e)},s.writeBoolean=function(t){this.validateBuffer(i.SIZE_OF_BOOLEAN),this.data.setUint8(this.position++,t?1:0)},s.writeByte=function(t){this.validateBuffer(i.SIZE_OF_INT8),this.data.setInt8(this.position++,t)
},s.writeBytes=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);var n;if(!(0>e)&&!(0>i)&&(n=0==i?t.length-e:Math.min(t.length-e,i),n>0)){this.validateBuffer(n);for(var r=new DataView(t.buffer),i=n,s=4;i>s;i-=s)this.data.setUint32(this._position,r.getUint32(e)),this.position+=s,e+=s;for(;i>0;i--)this.data.setUint8(this.position++,r.getUint8(e++))}},s.writeDouble=function(t){this.validateBuffer(i.SIZE_OF_FLOAT64),this.data.setFloat64(this.position,t,this.endian==e.LITTLE_ENDIAN),this.position+=i.SIZE_OF_FLOAT64},s.writeFloat=function(t){this.validateBuffer(i.SIZE_OF_FLOAT32),this.data.setFloat32(this.position,t,this.endian==e.LITTLE_ENDIAN),this.position+=i.SIZE_OF_FLOAT32},s.writeInt=function(t){this.validateBuffer(i.SIZE_OF_INT32),this.data.setInt32(this.position,t,this.endian==e.LITTLE_ENDIAN),this.position+=i.SIZE_OF_INT32},s.writeShort=function(t){this.validateBuffer(i.SIZE_OF_INT16),this.data.setInt16(this.position,t,this.endian==e.LITTLE_ENDIAN),this.position+=i.SIZE_OF_INT16},s.writeUnsignedInt=function(t){this.validateBuffer(i.SIZE_OF_UINT32),this.data.setUint32(this.position,t,this.endian==e.LITTLE_ENDIAN),this.position+=i.SIZE_OF_UINT32},s.writeUnsignedShort=function(t){this.validateBuffer(i.SIZE_OF_UINT16),this.data.setUint16(this.position,t,this.endian==e.LITTLE_ENDIAN),this.position+=i.SIZE_OF_UINT16},s.writeUTF=function(t){var n=this.encodeUTF8(t),r=n.length;this.validateBuffer(i.SIZE_OF_UINT16+r),this.data.setUint16(this.position,r,this.endian==e.LITTLE_ENDIAN),this.position+=i.SIZE_OF_UINT16,this._writeUint8Array(n,!1)},s.writeUTFBytes=function(t){this._writeUint8Array(this.encodeUTF8(t))},s.toString=function(){return"[ByteArray] length:"+this.length+", bytesAvailable:"+this.bytesAvailable},s._writeUint8Array=function(t,e){void 0===e&&(e=!0),e&&this.validateBuffer(this.position+t.length);for(var i=0;i<t.length;i++)this.data.setUint8(this.position++,t[i])},s.validate=function(e){return this.data.byteLength>0&&this._position+e<=this.data.byteLength?!0:void t.$error(1025)},s.validateBuffer=function(t,e){if(void 0===e&&(e=!1),this.write_position=t>this.write_position?t:this.write_position,t+=this._position,this.data.byteLength<t||e){var i=new Uint8Array(new ArrayBuffer(t+this.BUFFER_EXT_SIZE)),n=Math.min(this.data.buffer.byteLength,t+this.BUFFER_EXT_SIZE);i.set(new Uint8Array(this.data.buffer,0,n)),this.buffer=i.buffer}},s.encodeUTF8=function(t){for(var e=0,i=this.stringToCodePoints(t),n=[];i.length>e;){var r=i[e++];if(this.inRange(r,55296,57343))this.encoderError(r);else if(this.inRange(r,0,127))n.push(r);else{var s,a;for(this.inRange(r,128,2047)?(s=1,a=192):this.inRange(r,2048,65535)?(s=2,a=224):this.inRange(r,65536,1114111)&&(s=3,a=240),n.push(this.div(r,Math.pow(64,s))+a);s>0;){var o=this.div(r,Math.pow(64,s-1));n.push(128+o%64),s-=1}}}return new Uint8Array(n)},s.decodeUTF8=function(t){for(var e,i=!1,n=0,r="",s=0,a=0,o=0,h=0;t.length>n;){var l=t[n++];if(l==this.EOF_byte)e=0!=a?this.decoderError(i):this.EOF_code_point;else if(0==a)this.inRange(l,0,127)?e=l:(this.inRange(l,194,223)?(a=1,h=128,s=l-192):this.inRange(l,224,239)?(a=2,h=2048,s=l-224):this.inRange(l,240,244)?(a=3,h=65536,s=l-240):this.decoderError(i),s*=Math.pow(64,a),e=null);else if(this.inRange(l,128,191))if(o+=1,s+=(l-128)*Math.pow(64,a-o),o!==a)e=null;else{var u=s,c=h;s=0,a=0,o=0,h=0,e=this.inRange(u,c,1114111)&&!this.inRange(u,55296,57343)?u:this.decoderError(i,l)}else s=0,a=0,o=0,h=0,n--,e=this.decoderError(i,l);null!==e&&e!==this.EOF_code_point&&(65535>=e?e>0&&(r+=String.fromCharCode(e)):(e-=65536,r+=String.fromCharCode(55296+(e>>10&1023)),r+=String.fromCharCode(56320+(1023&e))))}return r},s.encoderError=function(e){t.$error(1026,e)},s.decoderError=function(e,i){return e&&t.$error(1027),i||65533},s.inRange=function(t,e,i){return t>=e&&i>=t},s.div=function(t,e){return Math.floor(t/e)},s.stringToCodePoints=function(t){for(var e=[],i=0,n=t.length;i<t.length;){var r=t.charCodeAt(i);if(this.inRange(r,55296,57343))if(this.inRange(r,56320,57343))e.push(65533);else if(i==n-1)e.push(65533);else{var s=t.charCodeAt(i+1);if(this.inRange(s,56320,57343)){var a=1023&r,o=1023&s;i+=1,e.push(65536+(a<<10)+o)}else e.push(65533)}else e.push(r);i+=1}return e},i.SIZE_OF_BOOLEAN=1,i.SIZE_OF_INT8=1,i.SIZE_OF_INT16=2,i.SIZE_OF_INT32=4,i.SIZE_OF_UINT8=1,i.SIZE_OF_UINT16=2,i.SIZE_OF_UINT32=4,i.SIZE_OF_FLOAT32=4,i.SIZE_OF_FLOAT64=8,i}();t.ByteArray=i,t.registerClass(i,"egret.ByteArray")}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}var e=__define,i=t;return i.prototype,e(t,"logLevel",void 0,function(){}),t.ALL="all",t.DEBUG="debug",t.INFO="info",t.WARN="warn",t.ERROR="error",t.OFF="off",t}();t.Logger=e,t.registerClass(e,"egret.Logger")}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}var e=t;return e.prototype,t.isNumber=function(t){return"number"==typeof t&&!isNaN(t)},t.sin=function(e){var i=Math.floor(e),n=i+1,r=t.sinInt(i);if(i==e)return r;var s=t.sinInt(n);return(e-i)*s+(n-e)*r},t.sinInt=function(t){return t%=360,0>t&&(t+=360),egret_sin_map[t]},t.cos=function(e){var i=Math.floor(e),n=i+1,r=t.cosInt(i);if(i==e)return r;var s=t.cosInt(n);return(e-i)*s+(n-e)*r},t.cosInt=function(t){return t%=360,0>t&&(t+=360),egret_cos_map[t]},t}();t.NumberUtils=e,t.registerClass(e,"egret.NumberUtils")}(egret||(egret={}));for(var egret_sin_map={},egret_cos_map={},DEG_TO_RAD=Math.PI/180,NumberUtils_i=0;360>NumberUtils_i;NumberUtils_i++)egret_sin_map[NumberUtils_i]=Math.sin(NumberUtils_i*DEG_TO_RAD),egret_cos_map[NumberUtils_i]=Math.cos(NumberUtils_i*DEG_TO_RAD);egret_sin_map[90]=1,egret_cos_map[90]=0,egret_sin_map[180]=0,egret_cos_map[180]=-1,egret_sin_map[270]=-1,egret_cos_map[270]=0,Function.prototype.bind||(Function.prototype.bind=function(t){"function"!=typeof this&&egret.$error(1029);var e=Array.prototype.slice.call(arguments,1),i=this,n=function(){},r=function(){return i.apply(this instanceof n&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return n.prototype=this.prototype,r.prototype=new n,r});var egret;!function(t){var e=function(e){function i(t,i){void 0===i&&(i=0),e.call(this),this._delay=0,this._currentCount=0,this._running=!1,this.updateInterval=1e3,this.lastCount=1e3,this.lastTimeStamp=0,this.delay=t,this.repeatCount=0|+i}__extends(i,e);var n=__define,r=i,s=r.prototype;return n(s,"delay",function(){return this._delay},function(t){1>t&&(t=1),this._delay!=t&&(this._delay=t,this.lastCount=this.updateInterval=Math.round(60*t))}),n(s,"currentCount",function(){return this._currentCount}),n(s,"running",function(){return this._running}),s.reset=function(){this.stop(),this._currentCount=0},s.start=function(){this._running||(this.lastCount=this.updateInterval,this.lastTimeStamp=t.getTimer(),t.sys.$ticker.$startTick(this.$update,this),this._running=!0)},s.stop=function(){this._running&&(t.stopTick(this.$update,this),this._running=!1)},s.$update=function(e){var i=e-this.lastTimeStamp;if(i>=this._delay)this.lastCount=this.updateInterval;else{if(this.lastCount-=1e3,this.lastCount>0)return!1;this.lastCount+=this.updateInterval}this.lastTimeStamp=e,this._currentCount++;var n=this.repeatCount>0&&this._currentCount>=this.repeatCount;return t.TimerEvent.dispatchTimerEvent(this,t.TimerEvent.TIMER),n&&(this.stop(),t.TimerEvent.dispatchTimerEvent(this,t.TimerEvent.TIMER_COMPLETE)),!1},i}(t.EventDispatcher);t.Timer=e,t.registerClass(e,"egret.Timer")}(egret||(egret={}));var egret;!function(){}(egret||(egret={}));var egret;!function(t){function e(e,i){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];t.$callLaterFunctionList.push(e),t.$callLaterThisList.push(i),t.$callLaterArgsList.push(n)}function i(e,i){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];t.$callAsyncFunctionList.push(e),t.$callAsyncThisList.push(i),t.$callAsyncArgsList.push(n)}t.$callLaterFunctionList=[],t.$callLaterThisList=[],t.$callLaterArgsList=[],t.callLater=e,t.$callAsyncFunctionList=[],t.$callAsyncThisList=[],t.$callAsyncArgsList=[],t.$callAsync=i}(egret||(egret={}));var egret;!function(t){function e(t,e,i){for(var n=[],r=3;r<arguments.length;r++)n[r-3]=arguments[r];var s,a=t.prototype;t.hasOwnProperty("__sets__")||Object.defineProperty(t,"__sets__",{value:{}}),s=t.__sets__;var o=s[i];if(o)return o.apply(e,n);var h=Object.getPrototypeOf(a);if(null!=h){for(;!h.hasOwnProperty(i);)if(h=Object.getPrototypeOf(h),null==h)return;o=Object.getOwnPropertyDescriptor(h,i).set,s[i]=o,o.apply(e,n)}}function i(t,e,i){var n,r=t.prototype;t.hasOwnProperty("__gets__")||Object.defineProperty(t,"__gets__",{value:{}}),n=t.__gets__;var s=n[i];if(s)return s.call(e);var a=Object.getPrototypeOf(r);if(null!=a){for(;!a.hasOwnProperty(i);)if(a=Object.getPrototypeOf(a),null==a)return;return s=Object.getOwnPropertyDescriptor(a,i).get,n[i]=s,s.call(e)}}t.superSetter=e,t.superGetter=i}(egret||(egret={}));var egret;!function(t){function e(t){if(!t)return null;var e=i[t];if(e)return e;var n=t.split("."),r=n.length;e=__global;for(var s=0;r>s;s++){var a=n[s];if(e=e[a],!e)return null}return i[t]=e,e}var i={};t.getDefinitionByName=e}(egret||(egret={}));var __global=__global||this,egret;!function(){}(egret||(egret={}));var egret;!function(t){function e(t){var e=typeof t;if(!t||"object"!=e&&!t.prototype)return e;var i=t.prototype?t.prototype:Object.getPrototypeOf(t);if(i.hasOwnProperty("__class__"))return i.__class__;var n=i.constructor.toString().trim(),r=n.indexOf("("),s=n.substring(9,r);return Object.defineProperty(i,"__class__",{value:s,enumerable:!1,writable:!0}),s}t.getQualifiedClassName=e}(egret||(egret={}));var egret;!function(t){function e(e){if(!e||"object"!=typeof e&&!e.prototype)return null;var i=e.prototype?e.prototype:Object.getPrototypeOf(e),n=Object.getPrototypeOf(i);if(!n)return null;var r=t.getQualifiedClassName(n.constructor);return r?r:null}t.getQualifiedSuperclassName=e}(egret||(egret={}));var egret;!function(t){function e(){return Date.now()-t.sys.$START_TIME}t.getTimer=e}(egret||(egret={}));var egret;!function(t){function e(e){var i=t.getDefinitionByName(e);return i?!0:!1}t.hasDefinition=e}(egret||(egret={}));var egret;!function(t){function e(t,e){if(!t||"object"!=typeof t)return!1;var i=Object.getPrototypeOf(t),n=i?i.__types__:null;return n?-1!==n.indexOf(e):!1}t.is=e}(egret||(egret={}));var egret;!function(t){function e(e,i){t.sys.$ticker.$startTick(e,i)}t.startTick=e}(egret||(egret={}));var egret;!function(t){function e(e,i){t.sys.$ticker.$stopTick(e,i)}t.stopTick=e}(egret||(egret={}));var egret;!function(t){function e(t){0>t&&(t=0),t>16777215&&(t=16777215);for(var e=t.toString(16).toUpperCase();e.length>6;)e=e.slice(1,e.length);for(;e.length<6;)e="0"+e;return"#"+e}t.toColorString=e}(egret||(egret={}));var egret;!function(t){var e=function(){function e(){}var i=e;return i.prototype,e.compileProgram=function(i,n,r){var s=e.compileFragmentShader(i,r),a=e.compileVertexShader(i,n),o=i.createProgram();return i.attachShader(o,a),i.attachShader(o,s),i.linkProgram(o),i.getProgramParameter(o,i.LINK_STATUS)||t.$warn(1020),o},e.compileFragmentShader=function(t,i){return e._compileShader(t,i,t.FRAGMENT_SHADER)},e.compileVertexShader=function(t,i){return e._compileShader(t,i,t.VERTEX_SHADER)},e._compileShader=function(t,e,i){var n=t.createShader(i);return t.shaderSource(n,e),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:null},e.checkCanUseWebGL=function(){if(void 0==e.canUseWebGL)try{var t=document.createElement("canvas");e.canUseWebGL=!(!window.WebGLRenderingContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(i){e.canUseWebGL=!1}return e.canUseWebGL},e.deleteWebGLTexture=function(t){if(t){var e=t.glContext;e&&e.deleteTexture(t)}},e}();t.WebGLUtils=e,t.registerClass(e,"egret.WebGLUtils")}(egret||(egret={}));
;/*!libs/modules/egret/egret.web.min.js*/
var egret;!function(e){var t;!function(){var t="egret.BitmapData";e.registerClass(HTMLImageElement,t),e.registerClass(HTMLCanvasElement,t),e.registerClass(HTMLVideoElement,t)}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){function t(t){return t.hashCode=t.$hashCode=e.$hashCount++,t}e.$toBitmapData=t}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(){function e(){}var t=e;return t.prototype,e.call=function(){},e.addCallback=function(){},e}();t.WebExternalInterface=i,e.registerClass(i,"egret.web.WebExternalInterface",["egret.ExternalInterface"]),e.ExternalInterface=i}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i;!function(){function i(e){return window.localStorage.getItem(e)}function r(t,i){try{return window.localStorage.setItem(t,i),!0}catch(r){return e.$warn(1047,t,i),!1}}function n(e){window.localStorage.removeItem(e)}function a(){window.localStorage.clear()}t.getItem=i,t.setItem=r,t.removeItem=n,t.clear=a}(i=t.web||(t.web={}))}(t=e.localStorage||(e.localStorage={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(i){function r(){i.call(this),this.loaded=!1}__extends(r,i);var n=__define,a=r,s=a.prototype;return n(s,"length",function(){if(this.originAudio)return this.originAudio.duration;throw new Error("sound not loaded!")}),s.load=function(t){function i(){a(),h.indexOf("firefox")>=0&&(o.pause(),o.muted=!1),s.loaded=!0,s.dispatchEventWith(e.Event.COMPLETE)}function n(){a(),s.dispatchEventWith(e.IOErrorEvent.IO_ERROR)}function a(){o.removeEventListener("canplaythrough",i),o.removeEventListener("error",n)}var s=this;this.url=t;var o=new Audio(t);o.addEventListener("canplaythrough",i),o.addEventListener("error",n);var h=navigator.userAgent.toLowerCase();h.indexOf("firefox")>=0&&(o.autoplay=!0,o.muted=!0),o.load(),this.originAudio=o,r.$recycle(this.url,o)},s.play=function(i,n){i=+i||0,n=+n||0;var a=r.$pop(this.url);null==a&&(a=this.originAudio.cloneNode()),a.autoplay=!0;var s=new t.HtmlSoundChannel(a);return s.$url=this.url,s.$loops=n,s.$startTime=i,s.$play(),e.sys.$pushSoundChannel(s),s},s.close=function(){0==this.loaded&&this.originAudio&&(this.originAudio.src=""),this.originAudio&&(this.originAudio=null),r.$clear(this.url)},r.$clear=function(e){var t=r.audios[e];t&&(t.length=0)},r.$pop=function(e){var t=r.audios[e];return t&&t.length>0?t.pop():null},r.$recycle=function(e,t){var i=r.audios[e];null==r.audios[e]&&(i=r.audios[e]=[]),i.push(t)},r.MUSIC="music",r.EFFECT="effect",r.audios={},r}(e.EventDispatcher);t.HtmlSound=i,e.registerClass(i,"egret.web.HtmlSound",["egret.Sound"])}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(i){function r(t){var r=this;i.call(this),this.$startTime=0,this.audio=null,this.isStopped=!1,this.canPlay=function(){r.audio.removeEventListener("canplay",r.canPlay);try{r.audio.currentTime=r.$startTime}catch(e){}finally{r.audio.play()}},this.onPlayEnd=function(){return 1==r.$loops?(r.stop(),void r.dispatchEventWith(e.Event.SOUND_COMPLETE)):(r.$loops>0&&r.$loops--,void r.$play())},t.addEventListener("ended",this.onPlayEnd),this.audio=t}__extends(r,i);var n=__define,a=r,s=a.prototype;return s.$play=function(){if(this.isStopped)return void e.$error(1036);try{this.audio.currentTime=this.$startTime}catch(t){return void this.audio.addEventListener("canplay",this.canPlay)}this.audio.play()},s.stop=function(){if(this.audio){this.isStopped||e.sys.$popSoundChannel(this),this.isStopped=!0;var i=this.audio;i.pause(),i.removeEventListener("ended",this.onPlayEnd),this.audio=null,t.HtmlSound.$recycle(this.$url,i)}},n(s,"volume",function(){return this.audio?this.audio.volume:1},function(t){return this.isStopped?void e.$error(1036):void(this.audio&&(this.audio.volume=t))}),n(s,"position",function(){return this.audio?this.audio.currentTime:0}),r}(e.EventDispatcher);t.HtmlSoundChannel=i,e.registerClass(i,"egret.web.HtmlSoundChannel",["egret.SoundChannel","egret.IEventDispatcher"])}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(i){function r(){i.call(this),this.loaded=!1}__extends(r,i);var n=__define,a=r,s=a.prototype;return s.load=function(i){var r=this;this.url=i,QZAppExternal.preloadSound(function(t){0==t.code?(r.loaded=!0,r.dispatchEventWith(e.Event.COMPLETE)):r.dispatchEventWith(e.IOErrorEvent.IO_ERROR)},{bid:-1,url:t.Html5Capatibility._QQRootPath+i,refresh:1})},n(s,"length",function(){throw new Error("qq sound not supported!")}),s.play=function(i,r){i=+i||0,r=+r||0;var n=new t.QQSoundChannel;return n.$url=this.url,n.$loops=r,n.$type=this.type,n.$startTime=i,n.$play(),e.sys.$pushSoundChannel(n),n},s.close=function(){},r.MUSIC="music",r.EFFECT="effect",r}(e.EventDispatcher);t.QQSound=i,e.registerClass(i,"egret.web.QQSound",["egret.Sound"])}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(t){function i(){var i=this;t.call(this),this.$startTime=0,this.isStopped=!1,this.onPlayEnd=function(){return 1==i.$loops?(i.stop(),void i.dispatchEventWith(e.Event.SOUND_COMPLETE)):(i.$loops>0&&i.$loops--,void i.$play())},this._startTime=0}__extends(i,t);var r=__define,n=i,a=n.prototype;return a.$play=function(){if(this.isStopped)return void e.$error(1036);var t=this;this._startTime=Date.now();var i=0;i=t.$loops>0?t.$loops-1:-1,this.$type==e.Sound.EFFECT?QZAppExternal.playLocalSound(function(){},{bid:-1,url:t.$url,loop:i}):QZAppExternal.playLocalBackSound(function(){},{bid:-1,url:t.$url,loop:i})},a.stop=function(){this.$type==e.Sound.EFFECT?QZAppExternal.stopSound():QZAppExternal.stopBackSound(),this.isStopped||e.sys.$popSoundChannel(this),this.isStopped=!0},r(a,"volume",function(){return 1},function(){return this.isStopped?void e.$error(1036):void 0}),r(a,"position",function(){return(Date.now()-this._startTime)/1e3}),i}(e.EventDispatcher);t.QQSoundChannel=i,e.registerClass(i,"egret.web.QQSoundChannel",["egret.SoundChannel","egret.IEventDispatcher"])}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(){function e(){}var t=e;return t.prototype,e.decodeAudios=function(){if(!(e.decodeArr.length<=0||e.isDecoding)){e.isDecoding=!0;var t=e.decodeArr.shift();e.ctx.decodeAudioData(t.buffer,function(i){t.self.audioBuffer=i,t.success&&t.success(),e.isDecoding=!1,e.decodeAudios()},function(){alert("sound decode error: "+t.url+"\nsee http://edn.egret.com/cn/docs/page/156"),t.fail&&t.fail(),e.isDecoding=!1,e.decodeAudios()})}},e.canUseWebAudio=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,e.ctx=e.canUseWebAudio?new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext):void 0,e.decodeArr=[],e.isDecoding=!1,e}();t.WebAudioDecode=i,e.registerClass(i,"egret.web.WebAudioDecode");var r=function(r){function n(){r.call(this),this.loaded=!1}__extends(n,r);var a=__define,s=n,o=s.prototype;return a(o,"length",function(){if(this.audioBuffer)return this.audioBuffer.duration;throw new Error("sound not loaded!")}),o.load=function(t){function r(){a.loaded=!0,a.dispatchEventWith(e.Event.COMPLETE)}function n(){a.dispatchEventWith(e.IOErrorEvent.IO_ERROR)}var a=this;this.url=t;var s=new XMLHttpRequest;s.open("GET",t,!0),s.responseType="arraybuffer",s.onload=function(){i.decodeArr.push({buffer:s.response,success:r,fail:n,self:a,url:a.url}),i.decodeAudios()},s.send()},o.play=function(i,r){i=+i||0,r=+r||0;var n=new t.WebAudioSoundChannel;return n.$url=this.url,n.$loops=r,n.$audioBuffer=this.audioBuffer,n.$startTime=i,n.$play(),e.sys.$pushSoundChannel(n),n},o.close=function(){},n.MUSIC="music",n.EFFECT="effect",n}(e.EventDispatcher);t.WebAudioSound=r,e.registerClass(r,"egret.web.WebAudioSound",["egret.Sound"])}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(i){function r(){var r=this;i.call(this),this.$startTime=0,this.bufferSource=null,this.context=t.WebAudioDecode.ctx,this.isStopped=!1,this._currentTime=0,this._volume=1,this.onPlayEnd=function(){return 1==r.$loops?(r.stop(),void r.dispatchEventWith(e.Event.SOUND_COMPLETE)):(r.$loops>0&&r.$loops--,void r.$play())},this._startTime=0,this.gain=this.context.createGain?this.context.createGain():this.context.createGainNode()}__extends(r,i);var n=__define,a=r,s=a.prototype;return s.$play=function(){if(this.isStopped)return void e.$error(1036);this.bufferSource&&(this.bufferSource.onended=null,this.bufferSource=null);var t=this.context,i=this.gain,r=t.createBufferSource();this.bufferSource=r,r.buffer=this.$audioBuffer,r.connect(i),i.connect(t.destination),r.onended=this.onPlayEnd,this._startTime=Date.now(),this.gain.gain.value=this._volume,r.start(0,this.$startTime),this._currentTime=0},s.stop=function(){if(this.bufferSource){var t=this.bufferSource;t.stop?t.stop(0):t.noteOff(0),this.bufferSource.disconnect(),this.bufferSource=null,this.$audioBuffer=null}this.isStopped||e.sys.$popSoundChannel(this),this.isStopped=!0},n(s,"volume",function(){return this._volume},function(t){return this.isStopped?void e.$error(1036):(this._volume=t,void(this.gain.gain.value=t))}),n(s,"position",function(){return this.bufferSource?(Date.now()-this._startTime)/1e3+this.$startTime:0}),r}(e.EventDispatcher);t.WebAudioSoundChannel=i,e.registerClass(i,"egret.web.WebAudioSoundChannel",["egret.SoundChannel","egret.IEventDispatcher"])}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(t){function i(i,r){var n=this;void 0===r&&(r=!0),t.call(this),this.loaded=!1,this.closed=!1,this.heightSet=0/0,this.widthSet=0/0,this.isPlayed=!1,this.screenChanged=function(){var t=!!n.video.webkitDisplayingFullscreen;t||(n.checkFullScreen(!1),e.Capabilities.isMobile||(n._fullscreen=t))},this._fullscreen=!0,this.onVideoLoaded=function(){n.video.removeEventListener("canplay",n.onVideoLoaded);var t=n.video;n.loaded=!0,n.posterData&&(n.posterData.width=n.getPlayWidth(),n.posterData.height=n.getPlayHeight()),t.width=t.videoWidth,t.height=t.videoHeight,n.$invalidateContentBounds(),window.setTimeout(function(){n.dispatchEventWith(e.Event.COMPLETE)},200)},this.$renderNode=new e.sys.BitmapNode,this.src=i,this.once(e.Event.ADDED_TO_STAGE,this.loadPoster,this),i&&this.load()}__extends(i,t);var r=__define,n=i,a=n.prototype;return a.load=function(t,i){var r=this;if(void 0===i&&(i=!0),t=t||this.src,this.src=t,!this.video||this.video.src!=t){if(!this.video||e.Capabilities.isMobile){var n=document.createElement("video");this.video=n,n.controls=null}else n=this.video;n.src=t,n.setAttribute("autoplay","autoplay"),n.setAttribute("webkit-playsinline","true"),n.addEventListener("canplay",this.onVideoLoaded),n.addEventListener("error",function(){return r.onVideoError()}),n.addEventListener("ended",function(){return r.onVideoEnded()}),n.load(),n.play(),n.style.position="absolute",n.style.top="0px",n.style.zIndex="-88888",n.style.left="0px",n.height=1,n.width=1,window.setTimeout(function(){return n.pause()},170)}},a.play=function(t,i){var r=this;if(void 0===i&&(i=!1),0==this.loaded)return this.load(this.src),void this.once(e.Event.COMPLETE,function(){return r.play(t,i)},this);this.isPlayed=!0;var n=this.video;void 0!=t&&(n.currentTime=+t||0),n.loop=!!i,n.style.zIndex=e.Capabilities.isMobile?"-88888":"9999",n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.height=n.videoHeight,n.width=n.videoWidth,"Windows PC"!=e.Capabilities.os&&"Mac OS"!=e.Capabilities.os&&window.setTimeout(function(){n.width=0},1e3),this.checkFullScreen(this._fullscreen)},a.checkFullScreen=function(t){var i=this.video;if(t)null==i.parentElement&&(i.removeAttribute("webkit-playsinline"),document.body.appendChild(i)),e.stopTick(this.markDirty,this),this.goFullscreen();else if(null!=i.parentElement&&i.parentElement.removeChild(i),i.setAttribute("webkit-playsinline","true"),this.setFullScreenMonitor(!1),e.startTick(this.markDirty,this),e.Capabilities.isMobile)return this.video.currentTime=0,void this.onVideoEnded();i.play()},a.goFullscreen=function(){var t,i=this.video;return t=e.web.getPrefixStyleName("requestFullscreen",i),i[t]||(t=e.web.getPrefixStyleName("requestFullScreen",i),i[t])?(i.removeAttribute("webkit-playsinline"),i[t](),this.setFullScreenMonitor(!0),!0):!0},a.setFullScreenMonitor=function(e){var t=this.video;e?(t.addEventListener("mozfullscreenchange",this.screenChanged),t.addEventListener("webkitfullscreenchange",this.screenChanged),t.addEventListener("mozfullscreenerror",this.screenError),t.addEventListener("webkitfullscreenerror",this.screenError)):(t.removeEventListener("mozfullscreenchange",this.screenChanged),t.removeEventListener("webkitfullscreenchange",this.screenChanged),t.removeEventListener("mozfullscreenerror",this.screenError),t.removeEventListener("webkitfullscreenerror",this.screenError))},a.screenError=function(){e.$error(3014)},a.exitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.oCancelFullScreen?document.oCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()},a.onVideoEnded=function(){this.pause(),this.isPlayed=!1,this.$invalidateContentBounds(),this.dispatchEventWith(e.Event.ENDED)},a.onVideoError=function(){this.dispatchEventWith(e.IOErrorEvent.IO_ERROR)},a.close=function(){var e=this;this.closed=!0,this.video.removeEventListener("canplay",this.onVideoLoaded),this.video.removeEventListener("error",function(){return e.onVideoError()}),this.video.removeEventListener("ended",function(){return e.onVideoEnded()}),this.pause(),0==this.loaded&&this.video&&(this.video.src=""),this.video&&this.video.parentElement&&(this.video.parentElement.removeChild(this.video),this.video=null),this.loaded=!1},a.pause=function(){this.video&&this.video.pause(),e.stopTick(this.markDirty,this),this.$invalidate()},r(a,"volume",function(){return this.video?this.video.volume:1},function(e){this.video&&(this.video.volume=e)}),r(a,"position",function(){return this.video?this.video.currentTime:0},function(e){this.video&&(this.video.currentTime=e)}),r(a,"fullscreen",function(){return this._fullscreen},function(t){e.Capabilities.isMobile||(this._fullscreen=!!t,this.video&&0==this.video.paused&&this.checkFullScreen(this._fullscreen))}),r(a,"bitmapData",function(){return this.video&&this.loaded?(this._bitmapData||(this.video.width=this.video.videoWidth,this.video.height=this.video.videoHeight,this._bitmapData=new e.BitmapData(this.video),this._bitmapData.$deleteSource=!1),this._bitmapData):null}),a.loadPoster=function(){var t=this,i=this.poster;if(i){var r=new e.ImageLoader;r.once(e.Event.COMPLETE,function(){r.data,t.posterData=r.data,t.posterData.width=t.getPlayWidth(),t.posterData.height=t.getPlayHeight(),t.$invalidateContentBounds()},this),r.load(i)}},a.$measureContentBounds=function(e){var t=this.bitmapData,i=this.posterData;t?e.setTo(0,0,this.getPlayWidth(),this.getPlayHeight()):i?e.setTo(0,0,this.getPlayWidth(),this.getPlayHeight()):e.setEmpty()},a.getPlayWidth=function(){return isNaN(this.widthSet)?this.bitmapData?this.bitmapData.width:this.posterData?this.posterData.width:0/0:this.widthSet},a.getPlayHeight=function(){return isNaN(this.heightSet)?this.bitmapData?this.bitmapData.height:this.posterData?this.posterData.height:0/0:this.heightSet},a.$render=function(){var t=this.$renderNode,i=this.bitmapData,r=this.posterData,n=this.getPlayWidth(),a=this.getPlayHeight();this.isPlayed&&!e.Capabilities.isMobile||!r?this.isPlayed&&i&&(t.image=i,e.WebGLUtils.deleteWebGLTexture(i.webGLTexture),i.webGLTexture=null,t.drawImage(0,0,i.width,i.height,0,0,n,a)):(t.image=r,t.drawImage(0,0,r.width,r.height,0,0,n,a))},a.markDirty=function(){return this.$invalidate(),!0},a.$setHeight=function(e){return this.heightSet=+e||0,this.$invalidate(),this.$invalidateContentBounds(),t.prototype.$setHeight.call(this,e)},a.$setWidth=function(e){return this.widthSet=+e||0,this.$invalidate(),this.$invalidateContentBounds(),t.prototype.$setWidth.call(this,e)},r(a,"paused",function(){return this.video?this.video.paused:!0}),r(a,"length",function(){if(this.video)return this.video.duration;throw new Error("Video not loaded!")}),i}(e.DisplayObject);t.WebVideo=i,e.registerClass(i,"egret.web.WebVideo",["egret.Video"]),e.Video=i}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(t){function i(){t.call(this),this._url="",this._method=""}__extends(i,t);var r=__define,n=i,a=n.prototype;return r(a,"response",function(){if(!this._xhr)return null;if(void 0!=this._xhr.response)return this._xhr.response;if("text"==this._responseType)return this._xhr.responseText;if("arraybuffer"==this._responseType&&/msie 9.0/i.test(navigator.userAgent)){var e=window;return e.convertResponseBodyToText(this._xhr.responseBody)}return"document"==this._responseType?this._xhr.responseXML:null}),r(a,"responseType",function(){return this._responseType},function(e){this._responseType=e}),r(a,"withCredentials",function(){return this._withCredentials},function(e){this._withCredentials=e}),a.getXHR=function(){return window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")},a.open=function(e,t){void 0===t&&(t="GET"),this._url=e,this._method=t,this._xhr&&(this._xhr.abort(),this._xhr=null),this._xhr=this.getXHR(),this._xhr.onreadystatechange=this.onReadyStateChange.bind(this),this._xhr.onprogress=this.updateProgress.bind(this),this._xhr.open(this._method,this._url,!0)},a.send=function(e){if(null!=this._responseType&&(this._xhr.responseType=this._responseType),null!=this._withCredentials&&(this._xhr.withCredentials=this._withCredentials),this.headerObj)for(var t in this.headerObj)this._xhr.setRequestHeader(t,this.headerObj[t]);this._xhr.send(e)},a.abort=function(){this._xhr&&this._xhr.abort()},a.getAllResponseHeaders=function(){if(!this._xhr)return null;var e=this._xhr.getAllResponseHeaders();return e?e:""},a.setRequestHeader=function(e,t){this.headerObj||(this.headerObj={}),this.headerObj[e]=t},a.getResponseHeader=function(e){if(!this._xhr)return null;var t=this._xhr.getResponseHeader(e);return t?t:""},a.onReadyStateChange=function(){var t=this._xhr;if(4==t.readyState){var i=t.status>=400||0==t.status,r=(this._url,this);window.setTimeout(function(){r.dispatchEventWith(i?e.IOErrorEvent.IO_ERROR:e.Event.COMPLETE)},0)}},a.updateProgress=function(t){t.lengthComputable&&e.ProgressEvent.dispatchProgressEvent(this,e.ProgressEvent.PROGRESS,t.loaded,t.total)},i}(e.EventDispatcher);t.WebHttpRequest=i,e.registerClass(i,"egret.web.WebHttpRequest",["egret.HttpRequest"]),e.HttpRequest=i}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=window.URL||window.webkitURL,r=function(r){function n(){r.apply(this,arguments),this.data=null,this._crossOrigin=null,this._hasCrossOriginSet=!1,this.currentImage=null,this.request=null}__extends(n,r);var a=__define,s=n,o=s.prototype;return a(o,"crossOrigin",function(){return this._crossOrigin},function(e){this._hasCrossOriginSet=!0,this._crossOrigin=e}),o.load=function(i){if(t.Html5Capatibility._canUseBlob&&0!=i.indexOf("wxLocalResource:")&&0!=i.indexOf("data:")&&0!=i.indexOf("http:")&&0!=i.indexOf("https:")){var r=this.request;r||(r=this.request=new e.web.WebHttpRequest,r.addEventListener(e.Event.COMPLETE,this.onBlobLoaded,this),r.addEventListener(e.IOErrorEvent.IO_ERROR,this.onBlobError,this),r.responseType="blob"),r.open(i),r.send()}else this.loadImage(i)},o.onBlobLoaded=function(){var e=this.request.response;this.loadImage(i.createObjectURL(e))},o.onBlobError=function(){this.dispatchIOError(this.currentURL)},o.loadImage=function(e){var t=new Image;this.data=null,this.currentImage=t,this._hasCrossOriginSet?this._crossOrigin&&(t.crossOrigin=this._crossOrigin):n.crossOrigin&&(t.crossOrigin=n.crossOrigin),t.onload=this.onImageComplete.bind(this),t.onerror=this.onLoadError.bind(this),t.src=e},o.onImageComplete=function(t){var i=this.getImage(t);if(i){this.data=new e.BitmapData(i);var r=this;window.setTimeout(function(){r.dispatchEventWith(e.Event.COMPLETE)},0)}},o.onLoadError=function(e){var t=this.getImage(e);t&&this.dispatchIOError(t.src)},o.dispatchIOError=function(){var t=this;window.setTimeout(function(){t.dispatchEventWith(e.IOErrorEvent.IO_ERROR)},0)},o.getImage=function(t){var r=t.target,n=r.src;if(0==n.indexOf("blob:"))try{i.revokeObjectURL(r.src)}catch(a){e.$warn(1037)}return r.onerror=null,r.onload=null,this.currentImage!==r?null:(this.currentImage=null,r)},n.crossOrigin=null,n}(e.EventDispatcher);t.WebImageLoader=r,e.registerClass(r,"egret.web.WebImageLoader",["egret.ImageLoader"]),e.ImageLoader=r}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(i){function r(){i.call(this),this._isNeedShow=!1,this.inputElement=null,this.inputDiv=null,this._gscaleX=0,this._gscaleY=0,this._isNeesHide=!1,this.textValue="",this.colorValue=16777215,this._styleInfoes={}}__extends(r,i);var n=r,a=n.prototype;return a.$setTextField=function(e){return this.$textfield=e,!0},a.$addToStage=function(){this.htmlInput=e.web.$getTextAdapter(this.$textfield)},a._initElement=function(){var t=this.$textfield.localToGlobal(0,0),i=t.x,r=t.y,n=this.htmlInput.$scaleX,a=this.htmlInput.$scaleY;this.inputDiv.style.left=i*n+"px",this.inputDiv.style.top=r*a+"px",this.$textfield.multiline&&this.$textfield.height>this.$textfield.size?(this.inputDiv.style.top=r*a+"px",this.inputElement.style.top=-this.$textfield.lineSpacing/2*a+"px"):(this.inputDiv.style.top=r*a+"px",this.inputElement.style.top="0px");for(var s=this.$textfield,o=1,h=1,l=0;s.parent;)o*=s.scaleX,h*=s.scaleY,l+=s.rotation,s=s.parent;var u=e.web.getPrefixStyleName("transform");this.inputDiv.style[u]="rotate("+l+"deg)",this._gscaleX=n*o,this._gscaleY=a*h},a.$show=function(){this.htmlInput.isCurrentStageText(this)?this.inputElement.onblur=null:(this.inputElement=this.htmlInput.getInputElement(this),this.inputElement.type=this.$textfield.multiline?"text":this.$textfield.inputType,this.inputDiv=this.htmlInput._inputDIV),this.htmlInput._needShow=!0,this._isNeedShow=!0,this._initElement()},a.onBlurHandler=function(){this.htmlInput.clearInputElement(),window.scrollTo(0,0)},a.executeShow=function(){this.inputElement.value=this.$getText(),null==this.inputElement.onblur&&(this.inputElement.onblur=this.onBlurHandler.bind(this)),this.$resetStageText(),this.$textfield.maxChars>0?this.inputElement.setAttribute("maxlength",this.$textfield.maxChars):this.inputElement.removeAttribute("maxlength"),this.inputElement.selectionStart=this.inputElement.value.length,this.inputElement.selectionEnd=this.inputElement.value.length,this.inputElement.focus()},a.$hide=function(){this._isNeesHide=!0,this.htmlInput&&e.web.Html5Capatibility._System_OS==e.web.SystemOSType.IOS&&this.htmlInput.disconnectStageText(this)},a.$getText=function(){return this.textValue||(this.textValue=""),this.textValue},a.$setText=function(e){return this.textValue=e,this.resetText(),!0},a.resetText=function(){this.inputElement&&(this.inputElement.value=this.textValue)},a.$setColor=function(e){return this.colorValue=e,this.resetColor(),!0},a.resetColor=function(){this.inputElement&&this.setElementStyle("color",e.toColorString(this.colorValue))},a.$onBlur=function(){t.Html5Capatibility._System_OS==t.SystemOSType.WPHONE&&e.Event.dispatchEvent(this,"updateText",!1)},a._onInput=function(){var i=this;if(t.Html5Capatibility._System_OS==t.SystemOSType.WPHONE){var r=this.$textfield.$TextField;null==r[35]&&null==r[36]?(i.textValue=i.inputElement.value,e.Event.dispatchEvent(i,"updateText",!1)):window.setTimeout(function(){i.inputElement&&i.inputElement.selectionStart&&i.inputElement.selectionEnd&&i.inputElement.selectionStart==i.inputElement.selectionEnd&&(i.textValue=i.inputElement.value,e.Event.dispatchEvent(i,"updateText",!1))},0)}else window.setTimeout(function(){i.inputElement&&i.inputElement.selectionStart==i.inputElement.selectionEnd&&(i.textValue=i.inputElement.value,e.Event.dispatchEvent(i,"updateText",!1))},0)},a.setAreaHeight=function(){var t=this.$textfield;if(t.multiline){var i=e.TextFieldUtils.$getTextHeight(t);if(t.height<=t.size)this.setElementStyle("height",t.size*this._gscaleY+"px"),this.setElementStyle("padding","0px"),this.setElementStyle("lineHeight",t.size*this._gscaleY+"px");else if(t.height<i)this.setElementStyle("height",t.height*this._gscaleY+"px"),this.setElementStyle("padding","0px"),this.setElementStyle("lineHeight",(t.size+t.lineSpacing)*this._gscaleY+"px");else{this.setElementStyle("height",(i+t.lineSpacing)*this._gscaleY+"px");var r=(t.height-i)*this._gscaleY,n=e.TextFieldUtils.$getValign(t),a=r*n,s=r-a;this.setElementStyle("padding",a+"px 0px "+s+"px 0px"),this.setElementStyle("lineHeight",(t.size+t.lineSpacing)*this._gscaleY+"px")}}},a._onClickHandler=function(t){this._isNeedShow&&(t.stopImmediatePropagation(),this._isNeedShow=!1,this.executeShow(),this.dispatchEvent(new e.Event("focus")))},a._onDisconnect=function(){this.inputElement=null,this.dispatchEvent(new e.Event("blur"))},a.setElementStyle=function(e,t){this.inputElement&&this._styleInfoes[e]!=t&&(this.inputElement.style[e]=t)},a.$removeFromStage=function(){this.inputElement&&this.htmlInput.disconnectStageText(this)},a.$resetStageText=function(){if(this.inputElement){var t=this.$textfield;if(this.setElementStyle("fontFamily",t.fontFamily),this.setElementStyle("fontStyle",t.italic?"italic":"normal"),this.setElementStyle("fontWeight",t.bold?"bold":"normal"),this.setElementStyle("textAlign",t.textAlign),this.setElementStyle("fontSize",t.size*this._gscaleY+"px"),this.setElementStyle("color",e.toColorString(t.textColor)),t.stage){var i=t.localToGlobal(0,0).x;i=Math.min(t.width,t.stage.stageWidth-i)}else i=t.width;if(this.setElementStyle("width",i*this._gscaleX+"px"),this.setElementStyle("verticalAlign",t.verticalAlign),t.multiline)this.setAreaHeight();else if(this.setElementStyle("lineHeight",t.size*this._gscaleY+"px"),t.height<t.size){this.setElementStyle("height",t.size*this._gscaleY+"px");var r=t.size/2*this._gscaleY;this.setElementStyle("padding","0px 0px "+r+"px 0px")}else{this.setElementStyle("height",t.size*this._gscaleY+"px");var n=(t.height-t.size)*this._gscaleY,a=e.TextFieldUtils.$getValign(t),s=n*a,r=n-s;r<t.size/2*this._gscaleY&&(r=t.size/2*this._gscaleY),this.setElementStyle("padding",s+"px 0px "+r+"px 0px")}this.inputDiv.style.clip="rect(0px "+t.width*this._gscaleX+"px "+t.height*this._gscaleY+"px 0px)",this.inputDiv.style.height=t.height*this._gscaleY+"px",this.inputDiv.style.width=i*this._gscaleX+"px"}},r}(e.EventDispatcher);t.HTML5StageText=i,e.registerClass(i,"egret.web.HTML5StageText",["egret.StageText"]),e.StageText=i}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(){function t(){this._needShow=!1,this.$scaleX=1,this.$scaleY=1}var i=t,r=i.prototype;return r.isInputOn=function(){return null!=this._stageText},r.isCurrentStageText=function(e){return this._stageText==e},r.initValue=function(e){e.style.position="absolute",e.style.left="0px",e.style.top="0px",e.style.border="none",e.style.padding="0"},r.$updateSize=function(){if(this.canvas){var t=this.canvas.width,i=this.canvas.height,r=this.canvas.style.width.split("px")[0],n=this.canvas.style.height.split("px")[0];this.$scaleX=r/t,this.$scaleY=n/i,this.StageDelegateDiv.style.left=this.canvas.style.left,this.StageDelegateDiv.style.top=this.canvas.style.top;var a=e.web.getPrefixStyleName("transform");this.StageDelegateDiv.style[a]=this.canvas.style[a],this.StageDelegateDiv.style[e.web.getPrefixStyleName("transformOrigin")]="0% 0% 0px"}},r._initStageDelegateDiv=function(t,i){this.canvas=i;var r,n=this;r||(r=document.createElement("div"),this.StageDelegateDiv=r,r.id="StageDelegateDiv",t.appendChild(r),n.initValue(r),n._inputDIV=document.createElement("div"),n.initValue(n._inputDIV),n._inputDIV.style.width="0px",n._inputDIV.style.height="0px",n._inputDIV.style.left="0px",n._inputDIV.style.top="-100px",n._inputDIV.style[e.web.getPrefixStyleName("transformOrigin")]="0% 0% 0px",r.appendChild(n._inputDIV),this.canvas.addEventListener("click",function(e){n._needShow?(n._needShow=!1,n._stageText._onClickHandler(e),n.show()):n._inputElement&&(n.clearInputElement(),n._inputElement.blur(),n._inputElement=null)}),n.initInputElement(!0),n.initInputElement(!1))},r.initInputElement=function(e){var t,i=this;e?(t=document.createElement("textarea"),t.style.resize="none",i._multiElement=t,t.id="egretTextarea"):(t=document.createElement("input"),i._simpleElement=t,t.id="egretInput"),t.type="text",i._inputDIV.appendChild(t),t.setAttribute("tabindex","-1"),t.style.width="1px",t.style.height="12px",i.initValue(t),t.style.outline="thin",t.style.background="none",t.style.overflow="hidden",t.style.wordBreak="break-all",t.style.opacity=0,t.oninput=function(){i._stageText&&i._stageText._onInput()}},r.show=function(){var t=this,i=t._inputElement;e.$callAsync(function(){i.style.opacity=1},t)},r.disconnectStageText=function(e){(null==this._stageText||this._stageText==e)&&(this.clearInputElement(),this._inputElement&&this._inputElement.blur())},r.clearInputElement=function(){var e=this;if(e._inputElement){e._inputElement.value="",e._inputElement.onblur=null,e._inputElement.style.width="1px",e._inputElement.style.height="12px",e._inputElement.style.left="0px",e._inputElement.style.top="0px",e._inputElement.style.opacity=0;var t;t=e._simpleElement==e._inputElement?e._multiElement:e._simpleElement,t.style.display="block",e._inputDIV.style.left="0px",e._inputDIV.style.top="-100px",e._inputDIV.style.height="0px",e._inputDIV.style.width="0px"}e._stageText&&(e._stageText._onDisconnect(),e._stageText=null,this.canvas.userTyping=!1)},r.getInputElement=function(e){var t=this;t.clearInputElement(),t._stageText=e,this.canvas.userTyping=!0,t._inputElement=t._stageText.$textfield.multiline?t._multiElement:t._simpleElement;var i;return i=t._simpleElement==t._inputElement?t._multiElement:t._simpleElement,i.style.display="none",t._inputElement},t}();t.HTMLInput=i,e.registerClass(i,"egret.web.HTMLInput")}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(e){function t(e){var t=e.stage?e.stage.$hashCode:0,i=r[t],s=n[t],o=a[t];return s&&o&&(delete n[t],delete a[t]),i}function i(e,t,i,s){e._initStageDelegateDiv(i,s),r[t.$hashCode]=e,n[t.$hashCode]=s,a[t.$hashCode]=i}var r={},n={},a={};e.$getTextAdapter=t,e.$cacheTextAdapter=i}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(){function t(e,t,a,s,o){r||i();var h="";o&&(h+="italic "),s&&(h+="bold "),h+=(a||12)+"px ",h+=t||"Arial";var l=0,u=n[h]||(n[h]={});r.font=h;for(var c=e.length,d=0;c>d;d++){var f=e.charCodeAt(d),v=u[f]||(u[f]=r.measureText(e.charAt(d)).width);l+=v}return l}function i(){r=e.sys.canvasHitTestBuffer.context,r.textAlign="left",r.textBaseline="middle"}var r=null,n={};e.sys.measureText=t}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function i(e,t){var i=document.createElement("canvas");isNaN(e)||isNaN(t)||(i.width=e,i.height=t);var r=i.getContext("2d");if(void 0===r.imageSmoothingEnabled){for(var n=["webkitImageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled"],a=n.length-1;a>=0;a--){var s=n[a];if(void 0!==r[s])break}try{Object.defineProperty(r,"imageSmoothingEnabled",{get:function(){return this[s]},set:function(e){this[s]=e}})}catch(o){r.imageSmoothingEnabled=r[s]}}return i}var r,n=function(){function e(e,t){this.surface=i(e,t),this.context=this.surface.getContext("2d")}var t=__define,n=e,a=n.prototype;return t(a,"width",function(){return this.surface.width}),t(a,"height",function(){return this.surface.height}),a.resize=function(e,t,i){var r=this.surface;if(i){var n=!1;r.width<e&&(r.width=e,n=!0),r.height<t&&(r.height=t,n=!0),n||(this.context.globalCompositeOperation="source-over",this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1)
}else r.width!=e&&(r.width=e),r.height!=t&&(r.height=t);this.clear()},a.resizeTo=function(e,t,n,a){r||(r=i());var s=(this.context,this.surface),o=r,h=o.getContext("2d");r=s,this.context=h,this.surface=o,o.width=Math.max(e,257),o.height=Math.max(t,257),h.setTransform(1,0,0,1,0,0),h.drawImage(s,n,a),s.height=1,s.width=1},a.setDirtyRegionPolicy=function(){},a.beginClip=function(e,t,i){t=+t||0,i=+i||0;var r=this.context;r.save(),r.beginPath(),r.setTransform(1,0,0,1,t,i);for(var n=e.length,a=0;n>a;a++){var s=e[a];r.clearRect(s.minX,s.minY,s.width,s.height),r.rect(s.minX,s.minY,s.width,s.height)}r.clip()},a.endClip=function(){this.context.restore()},a.getPixel=function(e,t){return this.context.getImageData(e,t,1,1).data},a.toDataURL=function(e,t){return this.surface.toDataURL(e,t)},a.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.surface.width,this.surface.height)},a.destroy=function(){this.surface.width=this.surface.height=0},e}();t.CanvasRenderBuffer=n,e.registerClass(n,"egret.web.CanvasRenderBuffer",["egret.sys.RenderBuffer"])}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(t){function i(i,r){var n=this;t.call(this),this.onTouchBegin=function(e){var t=n.getLocation(e);n.touch.onTouchBegin(t.x,t.y,e.identifier)},this.onTouchMove=function(e){var t=n.getLocation(e);n.touch.onTouchMove(t.x,t.y,e.identifier)},this.onTouchEnd=function(e){var t=n.getLocation(e);n.touch.onTouchEnd(t.x,t.y,e.identifier)},this.scaleX=1,this.scaleY=1,this.rotation=0,this.canvas=r,this.touch=new e.sys.TouchHandler(i),this.addListeners()}__extends(i,t);var r=i,n=r.prototype;return n.addListeners=function(){var t=this;window.navigator.msPointerEnabled?(this.canvas.addEventListener("MSPointerDown",function(e){e.identifier=e.pointerId,t.onTouchBegin(e),t.prevent(e)},!1),this.canvas.addEventListener("MSPointerMove",function(e){e.identifier=e.pointerId,t.onTouchMove(e),t.prevent(e)},!1),this.canvas.addEventListener("MSPointerUp",function(e){e.identifier=e.pointerId,t.onTouchEnd(e),t.prevent(e)},!1)):(e.Capabilities.$isMobile||this.addMouseListener(),this.addTouchListener())},n.addMouseListener=function(){this.canvas.addEventListener("mousedown",this.onTouchBegin),this.canvas.addEventListener("mousemove",this.onTouchMove),this.canvas.addEventListener("mouseup",this.onTouchEnd)},n.addTouchListener=function(){var e=this;this.canvas.addEventListener("touchstart",function(t){for(var i=t.changedTouches.length,r=0;i>r;r++)e.onTouchBegin(t.changedTouches[r]);e.prevent(t)},!1),this.canvas.addEventListener("touchmove",function(t){for(var i=t.changedTouches.length,r=0;i>r;r++)e.onTouchMove(t.changedTouches[r]);e.prevent(t)},!1),this.canvas.addEventListener("touchend",function(t){for(var i=t.changedTouches.length,r=0;i>r;r++)e.onTouchEnd(t.changedTouches[r]);e.prevent(t)},!1),this.canvas.addEventListener("touchcancel",function(t){for(var i=t.changedTouches.length,r=0;i>r;r++)e.onTouchEnd(t.changedTouches[r]);e.prevent(t)},!1)},n.prevent=function(e){e.stopPropagation(),1==e.isScroll||this.canvas.userTyping||e.preventDefault()},n.getLocation=function(t){t.identifier=+t.identifier||0;var i=document.documentElement,r=this.canvas.getBoundingClientRect(),n=r.left+window.pageXOffset-i.clientLeft,a=r.top+window.pageYOffset-i.clientTop,s=t.pageX-n,o=s,h=t.pageY-a,l=h;return 90==this.rotation?(o=h,l=r.width-s):-90==this.rotation&&(o=r.height-h,l=s),o/=this.scaleX,l/=this.scaleY,e.$TempPoint.setTo(Math.round(o),Math.round(l))},n.updateScaleMode=function(e,t,i){this.scaleX=e,this.scaleY=t,this.rotation=i},n.$updateMaxTouches=function(){this.touch.$initMaxTouches()},i}(e.HashObject);t.WebTouchHandler=i,e.registerClass(i,"egret.web.WebTouchHandler")}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(t){function i(e){t.call(this),this.isActivate=!0,this.stage=e,this.registerListener()}__extends(i,t);var r=i,n=r.prototype;return n.registerListener=function(){var t=this,i=function(){t.isActivate&&(t.isActivate=!1,t.stage.dispatchEvent(new e.Event(e.Event.DEACTIVATE)))},r=function(){t.isActivate||(t.isActivate=!0,t.stage.dispatchEvent(new e.Event(e.Event.ACTIVATE)))},n=function(){document[a]?i():r()};window.addEventListener("focus",r,!1),window.addEventListener("blur",i,!1);var a,s;"undefined"!=typeof document.hidden?(a="hidden",s="visibilitychange"):"undefined"!=typeof document.mozHidden?(a="mozHidden",s="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(a="msHidden",s="msvisibilitychange"):"undefined"!=typeof document.webkitHidden?(a="webkitHidden",s="webkitvisibilitychange"):"undefined"!=typeof document.oHidden&&(a="oHidden",s="ovisibilitychange"),"onpageshow"in window&&"onpagehide"in window&&(window.addEventListener("pageshow",r,!1),window.addEventListener("pagehide",i,!1)),a&&s&&document.addEventListener(s,n,!1);var o=navigator.userAgent,h=/micromessenger/gi.test(o),l=/mqq/gi.test(o),u=/mobile.*qq/gi.test(o);if((u||h)&&(l=!1),l){var c=window.browser||{};c.execWebFn=c.execWebFn||{},c.execWebFn.postX5GamePlayerMessage=function(e){var t=e.type;"app_enter_background"==t?i():"app_enter_foreground"==t&&r()},window.browser=c}},i}(e.HashObject);t.WebHideHandler=i,e.registerClass(i,"egret.web.WebHideHandler")}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function i(e,t){var i="";if(null!=t)i=r(e,t);else{if(null==o){var n=document.createElement("div").style;o=r("transform",n)}i=o}return""==i?e:i+e.charAt(0).toUpperCase()+e.substring(1,e.length)}function r(e,t){if(e in t)return"";e=e.charAt(0).toUpperCase()+e.substring(1,e.length);for(var i=["webkit","ms","Moz","O"],r=0;r<i.length;r++){var n=i[r]+e;if(n in t)return i[r]}return""}var n=function(){function e(){}var t=e;return t.prototype,e.QQ_AUDIO=1,e.WEB_AUDIO=2,e.HTML5_AUDIO=3,e}();t.AudioType=n,e.registerClass(n,"egret.web.AudioType");var a=function(){function e(){}var t=e;return t.prototype,e.WPHONE=1,e.IOS=2,e.ADNROID=3,e}();t.SystemOSType=a,e.registerClass(a,"egret.web.SystemOSType");var s=function(t){function i(){t.call(this)}__extends(i,t);var r=i;return r.prototype,i.$init=function(){var t=navigator.userAgent.toLowerCase();i.ua=t,e.Capabilities.$isMobile=-1!=t.indexOf("mobile")||-1!=t.indexOf("android"),i._canUseBlob=!1;var r,s=i._audioType,o=window.AudioContext||window.webkitAudioContext||window.mozAudioContext;if(1==s||2==s||3==s?(r=!1,i.setAudioType(s)):(r=!0,i.setAudioType(n.HTML5_AUDIO)),t.indexOf("windows phone")>=0)i._System_OS=a.WPHONE,e.Capabilities.$os="Windows Phone";else if(t.indexOf("android")>=0){if(e.Capabilities.$os="Android",i._System_OS=a.ADNROID,i.setAudioType(o?n.WEB_AUDIO:n.HTML5_AUDIO),window.hasOwnProperty("QZAppExternal")&&t.indexOf("qzone")>=0){i.setAudioType(n.QQ_AUDIO);var h=document.getElementsByTagName("base");if(h&&h.length>0)i._QQRootPath=h[0].baseURI;else{var l=window.location.href.indexOf("?");-1==l&&(l=window.location.href.length);var u=window.location.href.substring(0,l);u=u.substring(0,u.lastIndexOf("/")),i._QQRootPath=u+"/"}}}else t.indexOf("iphone")>=0||t.indexOf("ipad")>=0||t.indexOf("ipod")>=0?(e.Capabilities.$os="iOS",i._System_OS=a.IOS,i.getIOSVersion()>=7&&(i._canUseBlob=!0,i.setAudioType(n.WEB_AUDIO))):-1!=t.indexOf("windows nt")?e.Capabilities.$os="Windows PC":-1!=t.indexOf("mac os")&&(e.Capabilities.$os="Mac OS");var c=window.URL||window.webkitURL;c||(i._canUseBlob=!1),e.Sound=i._AudioClass},i.setAudioType=function(t){switch(i._audioType=t,t){case n.QQ_AUDIO:i._AudioClass=e.web.QQSound;break;case n.WEB_AUDIO:i._AudioClass=e.web.WebAudioSound;break;case n.HTML5_AUDIO:i._AudioClass=e.web.HtmlSound}},i.getIOSVersion=function(){var e=i.ua.toLowerCase().match(/cpu [^\d]*\d.*like mac os x/)[0];return parseInt(e.match(/\d+(_\d)*/)[0])||0},i.checkHtml5Support=function(){var t=(navigator.language||navigator.browserLanguage).toLowerCase(),i=t.split("-");i.length>1&&(i[1]=i[1].toUpperCase()),e.Capabilities.$language=i.join("-")},i._canUseBlob=!1,i._audioType=0,i._QQRootPath="",i._System_OS=0,i.ua="",i}(e.HashObject);t.Html5Capatibility=s,e.registerClass(s,"egret.web.Html5Capatibility");var o=null;t.getPrefixStyleName=i,t.getPrefix=r}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function i(){if(o)for(var e=document.querySelectorAll(".egret-player"),t=e.length,i=0;t>i;i++){var r=e[i],n=r["egret-player"];n.updateScreenSize()}}function r(i){if(!o){if(o=!0,i||(i={}),t.Html5Capatibility._audioType=i.audioType,t.Html5Capatibility.$init(),"webgl"==i.renderMode){var r=i.antialias;t.WebGLRenderContext.antialias=!!r}e.sys.CanvasRenderBuffer=t.CanvasRenderBuffer,n(i.renderMode);var s=e.sys.$ticker;a(s),i.screenAdapter?e.sys.screenAdapter=i.screenAdapter:e.sys.screenAdapter||(e.sys.screenAdapter=new e.sys.DefaultScreenAdapter);for(var h=document.querySelectorAll(".egret-player"),l=h.length,u=0;l>u;u++){var c=h[u],d=new t.WebPlayer(c,i);c["egret-player"]=d,"webgl"==i.renderMode&&(d.stage.dirtyRegionPolicy=e.DirtyRegionPolicy.OFF,e.sys.DisplayList.prototype.setDirtyRegionPolicy=function(){})}}}function n(i){"webgl"==i&&e.WebGLUtils.checkCanUseWebGL()?(e.sys.RenderBuffer=t.WebGLRenderBuffer,e.sys.systemRenderer=new t.WebGLRenderer,e.sys.canvasRenderer=new e.CanvasRenderer,e.sys.customHitTestBuffer=new t.WebGLRenderBuffer(3,3),e.sys.canvasHitTestBuffer=new t.CanvasRenderBuffer(3,3),e.Capabilities.$renderMode="webgl"):(e.sys.RenderBuffer=t.CanvasRenderBuffer,e.sys.systemRenderer=new e.CanvasRenderer,e.sys.canvasRenderer=e.sys.systemRenderer,e.sys.customHitTestBuffer=new t.CanvasRenderBuffer(3,3),e.sys.canvasHitTestBuffer=e.sys.customHitTestBuffer,e.Capabilities.$renderMode="canvas")}function a(e){function t(){e.update(),i.call(window,t)}var i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;i||(i=function(e){return window.setTimeout(e,1e3/60)}),i.call(window,t)}function s(){h=0/0,e.updateAllScreens()}var o=!1;window.isNaN=function(e){return e=+e,e!==e},e.runEgret=r,e.updateAllScreens=i;var h=0/0;window.addEventListener("resize",function(){isNaN(h)&&(h=window.setTimeout(s,300))})}(t=e.web||(e.web={}))}(egret||(egret={}));var language,egret;!function(e){var t;!function(t){var i=function(){function t(){}var i=t;return i.prototype,t.detect=function(){var i=e.Capabilities,r=navigator.userAgent.toLowerCase();i.$isMobile=-1!=r.indexOf("mobile")||-1!=r.indexOf("android"),i.$isMobile?r.indexOf("windows")<0&&(-1!=r.indexOf("iphone")||-1!=r.indexOf("ipad")||-1!=r.indexOf("ipod"))?i.$os="iOS":-1!=r.indexOf("android")&&-1!=r.indexOf("linux")?i.$os="Android":-1!=r.indexOf("windows")&&(i.$os="Windows Phone"):-1!=r.indexOf("windows nt")?i.$os="Windows PC":-1!=r.indexOf("mac os")&&(i.$os="Mac OS");var n=(navigator.language||navigator.browserLanguage).toLowerCase(),a=n.split("-");a.length>1&&(a[1]=a[1].toUpperCase()),i.$language=a.join("-"),t.injectUIntFixOnIE9()},t.injectUIntFixOnIE9=function(){if(/msie 9.0/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)){var e="<!-- IEBinaryToArray_ByteStr -->\r\n<script type='text/vbscript' language='VBScript'>\r\nFunction IEBinaryToArray_ByteStr(Binary)\r\n   IEBinaryToArray_ByteStr = CStr(Binary)\r\nEnd Function\r\nFunction IEBinaryToArray_ByteStr_Last(Binary)\r\n   Dim lastIndex\r\n   lastIndex = LenB(Binary)\r\n   if lastIndex mod 2 Then\r\n       IEBinaryToArray_ByteStr_Last = Chr( AscB( MidB( Binary, lastIndex, 1 ) ) )\r\n   Else\r\n       IEBinaryToArray_ByteStr_Last = \"\"\r\n   End If\r\nEnd Function\r\n</script>\r\n<!-- convertResponseBodyToText -->\r\n<script>\r\nvar convertResponseBodyToText = function (binary) {\r\n   var byteMapping = {};\r\n   for ( var i = 0; i < 256; i++ ) {\r\n       for ( var j = 0; j < 256; j++ ) {\r\n           byteMapping[ String.fromCharCode( i + j * 256 ) ] =\r\n           String.fromCharCode(i) + String.fromCharCode(j);\r\n       }\r\n   }\r\n   var rawBytes = IEBinaryToArray_ByteStr(binary);\r\n   var lastChr = IEBinaryToArray_ByteStr_Last(binary);\r\n   return rawBytes.replace(/[\\s\\S]/g,                           function( match ) { return byteMapping[match]; }) + lastChr;\r\n};\r\n</script>\r\n";document.write(e)}},t}();t.WebCapability=i,e.registerClass(i,"egret.web.WebCapability"),i.detect()}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(t){function i(i,r,n,a,s){if(t.call(this),this.showPanle=!0,this.fpsHeight=0,this.WIDTH=101,this.HEIGHT=20,this.bgCanvasColor="#18304b",this.fpsFrontColor="#18fefe",this.WIDTH_COST=33,this.cost1Color="#18fefe",this.cost2Color="#ffff00",this.cost3Color="#ff0000",this.arrFps=[],this.arrCost=[],this.arrLog=[],r||n){this.renderMode="canvas"==e.Capabilities.renderMode?"Canvas":"WebGL",this.panelX=void 0===s.x?0:parseInt(s.x),this.panelY=void 0===s.y?0:parseInt(s.y),this.fontColor=void 0===s.textColor?"#ffffff":s.textColor.replace("0x","#"),this.fontSize=void 0===s.size?12:parseInt(s.size),e.Capabilities.isMobile&&(this.fontSize-=2);var o=document.createElement("div");o.style.position="absolute",o.style.background="rgba(0,0,0,"+s.bgAlpha+")",o.style.left=this.panelX+"px",o.style.top=this.panelY+"px",o.style.pointerEvents="none",document.body.appendChild(o);var h=document.createElement("div");h.style.color=this.fontColor,h.style.fontSize=this.fontSize+"px",h.style.lineHeight=this.fontSize+"px",h.style.margin="4px 4px 4px 4px",this.container=h,o.appendChild(h),r&&this.addFps(),n&&this.addLog()}}__extends(i,t);var r=i,n=r.prototype;return n.addFps=function(){var e=document.createElement("div");e.style.display="inline-block",this.containerFps=e,this.container.appendChild(e);var t=document.createElement("div");t.style.paddingBottom="2px",this.fps=t,this.containerFps.appendChild(t),t.innerHTML="0 FPS "+this.renderMode+"<br/>min0 max0 avg0";var i=document.createElement("canvas");this.containerFps.appendChild(i),i.width=this.WIDTH,i.height=this.HEIGHT,this.canvasFps=i;var r=i.getContext("2d");this.contextFps=r,r.fillStyle=this.bgCanvasColor,r.fillRect(0,0,this.WIDTH,this.HEIGHT);var n=document.createElement("div");this.divDatas=n,this.containerFps.appendChild(n);var a=document.createElement("div");a.style["float"]="left",a.innerHTML="Draw<br/>Dirty<br/>Cost",n.appendChild(a);var s=document.createElement("div");s.style.paddingLeft=a.offsetWidth+20+"px",n.appendChild(s);var o=document.createElement("div");this.divDraw=o,o.innerHTML="0<br/>0<br/>",s.appendChild(o);var h=document.createElement("div");this.divCost=h,h.innerHTML='<font  style="color:'+this.cost1Color+'">0<font/> <font  style="color:'+this.cost2Color+'">0<font/> <font  style="color:'+this.cost3Color+'">0<font/>',s.appendChild(h);var i=document.createElement("canvas");this.canvasCost=i,this.containerFps.appendChild(i),i.width=this.WIDTH,i.height=this.HEIGHT;var r=i.getContext("2d");this.contextCost=r,r.fillStyle=this.bgCanvasColor,r.fillRect(0,0,this.WIDTH,this.HEIGHT),r.fillStyle="#000000",r.fillRect(this.WIDTH_COST,0,1,this.HEIGHT),r.fillRect(2*this.WIDTH_COST+1,0,1,this.HEIGHT),this.fpsHeight=this.container.offsetHeight},n.addLog=function(){var e=document.createElement("div");e.style.maxWidth=document.body.clientWidth-8-this.panelX+"px",e.style.wordWrap="break-word",this.log=e,this.container.appendChild(e)},n.update=function(e,t){if(void 0===t&&(t=!1),t)i=this.arrFps[this.arrFps.length-1],r=this.arrCost[this.arrCost.length-1][0],n=this.arrCost[this.arrCost.length-1][1],a=this.arrCost[this.arrCost.length-1][2];else{var i=e.fps,r=e.costTicker,n=e.costDirty,a=e.costRender;this.lastNumDraw=e.draw,this.lastNumDirty=e.dirty,this.arrFps.push(i),this.arrCost.push([r,n,a])}var s=0,o=this.arrFps.length;o>101&&(o=101,this.arrFps.shift());for(var h=this.arrFps[0],l=this.arrFps[0],u=0;o>u;u++){var c=this.arrFps[u];s+=c,h>c?h=c:c>l&&(l=c)}var d=this.WIDTH,f=this.HEIGHT,v=this.contextFps;v.drawImage(this.canvasFps,1,0,d-1,f,0,0,d-1,f),v.fillStyle=this.bgCanvasColor,v.fillRect(d-1,0,1,f);var p=Math.floor(i/60*20);1>p&&(p=1),v.fillStyle=this.fpsFrontColor,v.fillRect(d-1,20-p,1,p);var g=this.WIDTH_COST,v=this.contextCost;v.drawImage(this.canvasCost,1,0,g-1,f,0,0,g-1,f),v.drawImage(this.canvasCost,g+2,0,g-1,f,g+1,0,g-1,f),v.drawImage(this.canvasCost,2*g+3,0,g-1,f,2*g+2,0,g-1,f);var m=Math.floor(r/2);1>m?m=1:m>20&&(m=20);var x=Math.floor(n/2);1>x?x=1:x>20&&(x=20);var b=Math.floor(a/2);1>b?b=1:b>20&&(b=20),v.fillStyle=this.bgCanvasColor,v.fillRect(g-1,0,1,f),v.fillRect(2*g,0,1,f),v.fillRect(3*g+1,0,1,f),v.fillStyle=this.cost1Color,v.fillRect(g-1,20-m,1,m),v.fillStyle=this.cost2Color,v.fillRect(2*g,20-x,1,x),v.fillStyle=this.cost3Color,v.fillRect(3*g+1,20-b,1,b);var w=Math.floor(s/o),y=i+" FPS "+this.renderMode;this.showPanle&&(y+="<br/>min"+h+" max"+l+" avg"+w,this.divDraw.innerHTML=this.lastNumDraw+"<br/>"+this.lastNumDirty+"%<br/>",this.divCost.innerHTML='<font  style="color:#18fefe">'+r+'<font/> <font  style="color:#ffff00">'+n+'<font/> <font  style="color:#ff0000">'+a+"<font/>"),this.fps.innerHTML=y},n.updateInfo=function(e){for(this.arrLog.push(e),this.log.innerHTML=this.arrLog.join("<br/>");document.body.clientHeight<this.log.offsetHeight+this.fpsHeight+this.panelY+2*this.fontSize;)this.arrLog.shift(),this.log.innerHTML=this.arrLog.join("<br/>")},i}(e.DisplayObject);t.WebFps=i,e.registerClass(i,"egret.web.WebFps",["egret.FPSDisplay"]),e.FPSDisplay=i}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function i(e){if(window.location){var t=location.search;if(""==t)return"";t=t.slice(1);for(var i=t.split("&"),r=i.length,n=0;r>n;n++){var a=i[n],s=a.split("=");if(s[0]==e)return s[1]}}return""}t.getOption=i,e.getOption=i}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(i){function r(e,t){i.call(this),this.init(e,t),this.initOrientation()}__extends(r,i);var n=r,a=n.prototype;return a.init=function(i,r){var n=this.readOption(i,r),a=new e.Stage;a.$screen=this,a.$scaleMode=n.scaleMode,a.$orientation=n.orientation,a.$maxTouches=n.maxTouches,a.frameRate=n.frameRate,a.textureScaleFactor=n.textureScaleFactor;var s=new e.sys.RenderBuffer(void 0,void 0,!0),o=s.surface;this.attachCanvas(i,o);var h=new t.WebTouchHandler(a,o),l=new e.sys.Player(s,a,n.entryClassName),u=new e.web.WebHideHandler(a),c=new t.HTMLInput;l.showPaintRect(n.showPaintRect),(n.showFPS||n.showLog)&&l.displayFPS(n.showFPS,n.showLog,n.logFilter,n.fpsStyles),this.playerOption=n,this.container=i,this.canvas=o,this.stage=a,this.player=l,this.webTouchHandler=h,this.webInput=c,this.webHide=u,e.web.$cacheTextAdapter(c,a,i,o),this.updateScreenSize(),this.updateMaxTouches(),l.start()},a.initOrientation=function(){var t=this;window.addEventListener("orientationchange",function(){window.setTimeout(function(){e.StageOrientationEvent.dispatchStageOrientationEvent(t.stage,e.StageOrientationEvent.ORIENTATION_CHANGE)},350)})},a.readOption=function(t,i){var r={};r.entryClassName=t.getAttribute("data-entry-class"),r.scaleMode=t.getAttribute("data-scale-mode")||e.StageScaleMode.NO_SCALE,r.frameRate=+t.getAttribute("data-frame-rate")||30,r.contentWidth=+t.getAttribute("data-content-width")||480,r.contentHeight=+t.getAttribute("data-content-height")||800,r.orientation=t.getAttribute("data-orientation")||e.OrientationMode.AUTO,r.maxTouches=+t.getAttribute("data-multi-fingered")||2,r.textureScaleFactor=+t.getAttribute("texture-scale-factor")||1,r.showPaintRect="webgl"==i.renderMode?!1:"true"==t.getAttribute("data-show-paint-rect"),r.showFPS="true"==t.getAttribute("data-show-fps");for(var n=t.getAttribute("data-show-fps-style")||"",a=n.split(","),s={},o=0;o<a.length;o++){var h=a[o].split(":");s[h[0]]=h[1]}return r.fpsStyles=s,r.showLog="true"==t.getAttribute("data-show-log"),r.logFilter=t.getAttribute("data-log-filter"),r},a.attachCanvas=function(e,t){var i=t.style;i.cursor="inherit",i.position="absolute",i.top="0",i.bottom="0",i.left="0",i.right="0",e.appendChild(t),i=e.style,i.overflow="hidden",i.position="relative",i.webkitTransform="translateZ(0)"},a.updateScreenSize=function(){var t=this.canvas;if(!t.userTyping){var i=this.playerOption,r=this.container.getBoundingClientRect(),n=!1,a=this.stage.$orientation;a!=e.OrientationMode.AUTO&&(n=a!=e.OrientationMode.PORTRAIT&&r.height>r.width||a==e.OrientationMode.PORTRAIT&&r.width>r.height);var s=n?r.height:r.width,o=n?r.width:r.height;e.Capabilities.$boundingClientWidth=s,e.Capabilities.$boundingClientHeight=o;var h=e.sys.screenAdapter.calculateStageSize(this.stage.$scaleMode,s,o,i.contentWidth,i.contentHeight),l=h.stageWidth,u=h.stageHeight,c=h.displayWidth,d=h.displayHeight;t.width!==l&&(t.width=l),t.height!==u&&(t.height=u),t.style[e.web.getPrefixStyleName("transformOrigin")]="0% 0% 0px",t.style.width=c+"px",t.style.height=d+"px";var f=0;n?a==e.OrientationMode.LANDSCAPE?(f=90,t.style.top=(r.height-c)/2+"px",t.style.left=(r.width+d)/2+"px"):(f=-90,t.style.top=(r.height+c)/2+"px",t.style.left=(r.width-d)/2+"px"):(t.style.top=(r.height-d)/2+"px",t.style.left=(r.width-c)/2+"px");var v="rotate("+f+"deg)";t.style[e.web.getPrefixStyleName("transform")]=v;var p=c/l,g=d/u;this.webTouchHandler.updateScaleMode(p,g,f),this.webInput.$updateSize(),this.player.updateStageSize(l,u)}},a.setContentSize=function(e,t){var i=this.playerOption;i.contentWidth=e,i.contentHeight=t,this.updateScreenSize()},a.updateMaxTouches=function(){this.webTouchHandler.$updateMaxTouches()},r}(e.HashObject);t.WebPlayer=i,e.registerClass(i,"egret.web.WebPlayer",["egret.sys.Screen"])}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(){function t(t,i){a||(a=document.createElement("canvas"),s=a.getContext("2d"));var r=t.$getTextureWidth(),n=t.$getTextureHeight();null==i&&(i=e.$TempRectangle,i.x=0,i.y=0,i.width=r,i.height=n),i.x=Math.min(i.x,r-1),i.y=Math.min(i.y,n-1),i.width=Math.min(i.width,r-i.x),i.height=Math.min(i.height,n-i.y);var o=i.width,h=i.height,l=a;l.style.width=o+"px",l.style.height=h+"px",a.width=o,a.height=h;var u=t,c=Math.round(u._offsetX),d=Math.round(u._offsetY),f=u._bitmapWidth,v=u._bitmapHeight;return s.drawImage(u._bitmapData.source,u._bitmapX+i.x/e.$TextureScaleFactor,u._bitmapY+i.y/e.$TextureScaleFactor,f*i.width/r,v*i.height/n,c,d,i.width,i.height),l}function i(i,r){try{var n=t(this,r),a=n.toDataURL(i);return a}catch(s){e.$error(1033)}return null}function r(e,t,r){var n=i.call(this,e,r);if(null!=n){var a=n.replace(/^data:image[^;]*/,"data:image/octet-stream"),s=document.createElement("a");s.download=t,s.href=a;var o=document.createEvent("HTMLEvents");o.initEvent("click",!1,!1),s.dispatchEvent(o)}}function n(t,i){var r=e.sys.canvasHitTestBuffer;r.resize(3,3);var n=r.context;n.translate(1-t,1-i);var a=this._bitmapWidth,s=this._bitmapHeight,o=e.$TextureScaleFactor;n.drawImage(this._bitmapData.source,this._bitmapX,this._bitmapY,a,this._bitmapHeight,this._offsetX,this._offsetY,a*o,s*o);try{var h=r.getPixel(1,1)}catch(l){throw console.log(this),new Error(e.sys.tr(1039))}return h}var a,s;e.Texture.prototype.toDataURL=i,e.Texture.prototype.saveToFile=r,e.Texture.prototype.getPixel32=n}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function i(e){for(var t=o.parseFromString(e,"text/xml"),i=t.childNodes.length,n=0;i>n;n++){var a=t.childNodes[n];if(1==a.nodeType)return r(a,null)}return null}function r(e,t){if("parsererror"==e.localName)throw new Error(e.textContent);for(var i=new a(e.localName,t,e.prefix,e.namespaceURI,e.nodeName),n=e.attributes,o=i.attributes,h=n.length,l=0;h>l;l++){var u=n[l],c=u.name;0!=c.indexOf("xmlns:")&&(o[c]=u.value,i["$"+c]=u.value)}var d=e.childNodes;h=d.length;var f=i.children;for(l=0;h>l;l++){var v=d[l],p=v.nodeType,g=null;if(1==p)g=r(v,i);else if(3==p){var m=v.textContent.trim();m&&(g=new s(m,i))}g&&f.push(g)}return i}var n=function(){function e(e,t){this.nodeType=e,this.parent=t}var t=e;return t.prototype,e}();t.XMLNode=n,e.registerClass(n,"egret.web.XMLNode");var a=function(e){function t(t,i,r,n,a){e.call(this,1,i),this.attributes={},this.children=[],this.localName=t,this.prefix=r,this.namespace=n,this.name=a}__extends(t,e);var i=t;return i.prototype,t}(n);t.XML=a,e.registerClass(a,"egret.web.XML");var s=function(e){function t(t,i){e.call(this,3,i),this.text=t}__extends(t,e);var i=t;return i.prototype,t}(n);t.XMLText=s,e.registerClass(s,"egret.web.XMLText");var o=new DOMParser;e.XML={parse:i}}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(t){function i(){var i=this;t.apply(this,arguments),this.onChange=function(t){var r=new e.OrientationEvent(e.Event.CHANGE);r.beta=t.beta,r.gamma=t.gamma,r.alpha=t.alpha,i.dispatchEvent(r)}}__extends(i,t);var r=i,n=r.prototype;return n.start=function(){window.addEventListener("deviceorientation",this.onChange)},n.stop=function(){window.removeEventListener("deviceorientation",this.onChange)},i}(e.EventDispatcher);t.WebDeviceOrientation=i,e.registerClass(i,"egret.web.WebDeviceOrientation",["egret.DeviceOrientation"])}(t=e.web||(e.web={}))}(egret||(egret={})),egret.DeviceOrientation=egret.web.WebDeviceOrientation;var egret;!function(e){var t;!function(t){var i=function(t){function i(){var i=this;t.call(this),this.onUpdate=function(t){var r=new e.GeolocationEvent(e.Event.CHANGE),n=t.coords;r.altitude=n.altitude,r.heading=n.heading,r.accuracy=n.accuracy,r.latitude=n.latitude,r.longitude=n.longitude,r.speed=n.speed,r.altitudeAccuracy=n.altitudeAccuracy,i.dispatchEvent(r)},this.onError=function(t){var r=e.GeolocationEvent.UNAVAILABLE;t.code==t.PERMISSION_DENIED&&(r=e.GeolocationEvent.PERMISSION_DENIED);var n=new e.GeolocationEvent(e.IOErrorEvent.IO_ERROR);n.errorType=r,n.errorMessage=t.message,i.dispatchEvent(n)},this.geolocation=navigator.geolocation}__extends(i,t);var r=i,n=r.prototype;return n.start=function(){var t=this.geolocation;t?this.watchId=t.watchPosition(this.onUpdate,this.onError):this.onError({code:2,message:e.sys.tr(3004),PERMISSION_DENIED:1,POSITION_UNAVAILABLE:2})},n.stop=function(){var e=this.geolocation;e.clearWatch(this.watchId)},i}(e.EventDispatcher);t.WebGeolocation=i,e.registerClass(i,"egret.web.WebGeolocation",["egret.Geolocation"]),e.Geolocation=e.web.WebGeolocation}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(t){function i(){var i=this;t.apply(this,arguments),this.onChange=function(t){var r=new e.MotionEvent(e.Event.CHANGE),n={x:t.acceleration.x,y:t.acceleration.y,z:t.acceleration.z},a={x:t.accelerationIncludingGravity.x,y:t.accelerationIncludingGravity.y,z:t.accelerationIncludingGravity.z},s={alpha:t.rotationRate.alpha,beta:t.rotationRate.beta,gamma:t.rotationRate.gamma};r.acceleration=n,r.accelerationIncludingGravity=a,r.rotationRate=s,i.dispatchEvent(r)}}__extends(i,t);var r=i,n=r.prototype;return n.start=function(){window.addEventListener("devicemotion",this.onChange)},n.stop=function(){window.removeEventListener("devicemotion",this.onChange)},i}(e.EventDispatcher);t.WebMotion=i,e.registerClass(i,"egret.web.WebMotion",["egret.Motion"]),e.Motion=e.web.WebMotion}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(){}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(){function t(e){this.defaultVertexSrc="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec2 aColor;\nuniform vec2 projectionVector;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nconst vec2 center = vec2(-1.0, 1.0);\nvoid main(void) {\n   gl_Position = vec4( (aVertexPosition / projectionVector) + center , 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vColor = vec4(aColor.x, aColor.x, aColor.x, aColor.x);\n}",this.fragmentSrc="",this.gl=null,this.program=null,this.uniforms={projectionVector:{type:"2f",value:{x:0,y:0},dirty:!0}},this.gl=e}var i=t,r=i.prototype;return r.init=function(){var t=this.gl,i=e.WebGLUtils.compileProgram(t,this.defaultVertexSrc,this.fragmentSrc);t.useProgram(i),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord"),this.colorAttribute=t.getAttribLocation(i,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var r in this.uniforms)this.uniforms[r].uniformLocation=t.getUniformLocation(i,r);this.initUniforms(),this.program=i},r.initUniforms=function(){if(this.uniforms){var e,t=this.gl;for(var i in this.uniforms){e=this.uniforms[i],e.dirty=!0;var r=e.type;"mat2"===r||"mat3"===r||"mat4"===r?(e.glMatrix=!0,e.glValueLength=1,"mat2"===r?e.glFunc=t.uniformMatrix2fv:"mat3"===r?e.glFunc=t.uniformMatrix3fv:"mat4"===r&&(e.glFunc=t.uniformMatrix4fv)):(e.glFunc=t["uniform"+r],e.glValueLength="2f"===r||"2i"===r?2:"3f"===r||"3i"===r?3:"4f"===r||"4i"===r?4:1)}}},r.syncUniforms=function(){if(this.uniforms){var e,t=this.gl;for(var i in this.uniforms)e=this.uniforms[i],e.dirty&&(1===e.glValueLength?e.glMatrix===!0?e.glFunc.call(t,e.uniformLocation,e.transpose,e.value):e.glFunc.call(t,e.uniformLocation,e.value):2===e.glValueLength?e.glFunc.call(t,e.uniformLocation,e.value.x,e.value.y):3===e.glValueLength?e.glFunc.call(t,e.uniformLocation,e.value.x,e.value.y,e.value.z):4===e.glValueLength&&e.glFunc.call(t,e.uniformLocation,e.value.x,e.value.y,e.value.z,e.value.w),e.dirty=!1)}},r.setProjection=function(e,t){var i=this.uniforms.projectionVector;(i.value.x!=e||i.value.y!=t)&&(i.value.x=e,i.value.y=t,i.dirty=!0)},r.setAttribPointer=function(e){var t=this.gl;t.vertexAttribPointer(this.aVertexPosition,2,t.FLOAT,!1,e,0),t.vertexAttribPointer(this.aTextureCoord,2,t.FLOAT,!1,e,8),t.vertexAttribPointer(this.colorAttribute,1,t.FLOAT,!1,e,16)},t}();t.EgretShader=i,e.registerClass(i,"egret.web.EgretShader")}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(e){function t(){e.apply(this,arguments),this.fragmentSrc="precision lowp float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nuniform sampler2D uSampler;\nvoid main(void) {\ngl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;\n}"}__extends(t,e);var i=t;return i.prototype,t}(t.EgretShader);t.TextureShader=i,e.registerClass(i,"egret.web.TextureShader")}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(e){function t(){e.apply(this,arguments),this.fragmentSrc="precision lowp float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvoid main(void) {\ngl_FragColor = vColor;\n}"}__extends(t,e);var i=t;return i.prototype,t}(t.EgretShader);t.PrimitiveShader=i,e.registerClass(i,"egret.web.PrimitiveShader")}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(e){function t(){e.apply(this,arguments),this.fragmentSrc="precision mediump float;uniform vec2 blur;uniform sampler2D uSampler;varying vec2 vTextureCoord;uniform vec2 uTextureSize;void main(){const int sampleRadius = 5;const int samples = sampleRadius * 2 + 1;vec2 blurUv = blur / uTextureSize;vec4 color = vec4(0, 0, 0, 0);vec2 uv = vec2(0.0, 0.0);blurUv /= float(sampleRadius);for (int i = -sampleRadius; i <= sampleRadius; i++) {uv.x = vTextureCoord.x + float(i) * blurUv.x;uv.y = vTextureCoord.y + float(i) * blurUv.y;color += texture2D(uSampler, uv);}color /= float(samples);gl_FragColor = color;}",this.uniforms={projectionVector:{type:"2f",value:{x:0,y:0},dirty:!0},blur:{type:"2f",value:{x:2,y:2},dirty:!0},uTextureSize:{type:"2f",value:{x:100,y:100},dirty:!0}}}__extends(t,e);var i=t,r=i.prototype;return r.setBlur=function(e,t){var i=this.uniforms.blur;(i.value.x!=e||i.value.y!=t)&&(i.value.x=e,i.value.y=t,i.dirty=!0)},r.setTextureSize=function(e,t){var i=this.uniforms.uTextureSize;(e!=i.value.x||t!=i.value.y)&&(i.value.x=e,i.value.y=t,i.dirty=!0)},t}(t.TextureShader);t.BlurShader=i,e.registerClass(i,"egret.web.BlurShader")}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(e){function t(){e.apply(this,arguments),this.fragmentSrc="precision mediump float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nuniform mat4 matrix;\nuniform vec4 colorAdd;\nuniform sampler2D uSampler;\nvoid main(void) {\nvec4 texColor = texture2D(uSampler, vTextureCoord);\nif(texColor.a > 0.) {texColor = vec4(texColor.rgb / texColor.a, texColor.a);\n}vec4 locColor = clamp(texColor * matrix + colorAdd, 0., 1.);\ngl_FragColor = vColor * vec4(locColor.rgb * locColor.a, locColor.a);\n}",this.uniforms={projectionVector:{type:"2f",value:{x:0,y:0},dirty:!0},matrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],dirty:!0},colorAdd:{type:"4f",value:{x:0,y:0,z:0,w:0},dirty:!0}}
}__extends(t,e);var i=t,r=i.prototype;return r.setMatrix=function(e){var t=this.uniforms.matrix;(t.value[0]!=e[0]||t.value[0]!=e[0]||t.value[1]!=e[1]||t.value[2]!=e[2]||t.value[3]!=e[3]||t.value[4]!=e[5]||t.value[5]!=e[6]||t.value[6]!=e[7]||t.value[7]!=e[8]||t.value[8]!=e[10]||t.value[9]!=e[11]||t.value[10]!=e[12]||t.value[11]!=e[13]||t.value[12]!=e[15]||t.value[13]!=e[16]||t.value[14]!=e[17]||t.value[15]!=e[18])&&(t.value[0]=e[0],t.value[1]=e[1],t.value[2]=e[2],t.value[3]=e[3],t.value[4]=e[5],t.value[5]=e[6],t.value[6]=e[7],t.value[7]=e[8],t.value[8]=e[10],t.value[9]=e[11],t.value[10]=e[12],t.value[11]=e[13],t.value[12]=e[15],t.value[13]=e[16],t.value[14]=e[17],t.value[15]=e[18],t.dirty=!0);var i=this.uniforms.colorAdd;(i.value.x!=e[4]/255||i.value.y!=e[9]/255||i.value.z!=e[14]/255||i.value.w!=e[19]/255)&&(i.value.x=e[4]/255,i.value.y=e[9]/255,i.value.z=e[14]/255,i.value.w=e[19]/255,i.dirty=!0)},t}(t.TextureShader);t.ColorTransformShader=i,e.registerClass(i,"egret.web.ColorTransformShader")}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(e){function t(){e.apply(this,arguments),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform sampler2D uSampler;","uniform float distance;","uniform float angle;","uniform vec4 color;","uniform float alpha;","uniform float blurX;","uniform float blurY;","uniform float strength;","uniform float inner;","uniform float knockout;","uniform float hideObject;","uniform vec2 uTextureSize;vec2 px = vec2(1.0 / uTextureSize.x, 1.0 / uTextureSize.y);","float random(vec3 scale, float seed)","{","return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);","}","void main(void) {","const float linearSamplingTimes = 7.0;","const float circleSamplingTimes = 12.0;","vec4 ownColor = texture2D(uSampler, vTextureCoord);","vec4 curColor;","float totalAlpha = 0.0;","float maxTotalAlpha = 0.0;","float curDistanceX = 0.0;","float curDistanceY = 0.0;","float offsetX = distance * cos(angle) * px.x;","float offsetY = distance * sin(angle) * px.y;","const float PI = 3.14159265358979323846264;","float cosAngle;","float sinAngle;","float offset = PI * 2.0 / circleSamplingTimes * random(vec3(12.9898, 78.233, 151.7182), 0.0);","float stepX = blurX * px.x / linearSamplingTimes;","float stepY = blurY * px.y / linearSamplingTimes;","for (float a = 0.0; a <= PI * 2.0; a += PI * 2.0 / circleSamplingTimes) {","cosAngle = cos(a + offset);","sinAngle = sin(a + offset);","for (float i = 1.0; i <= linearSamplingTimes; i++) {","curDistanceX = i * stepX * cosAngle;","curDistanceY = i * stepY * sinAngle;","curColor = texture2D(uSampler, vec2(vTextureCoord.x + curDistanceX - offsetX, vTextureCoord.y + curDistanceY + offsetY));","totalAlpha += (linearSamplingTimes - i) * curColor.a;","maxTotalAlpha += (linearSamplingTimes - i);","}","}","ownColor.a = max(ownColor.a, 0.0001);","ownColor.rgb = ownColor.rgb / ownColor.a;","float outerGlowAlpha = (totalAlpha / maxTotalAlpha) * strength * alpha * (1. - inner) * max(min(hideObject, knockout), 1. - ownColor.a);","float innerGlowAlpha = ((maxTotalAlpha - totalAlpha) / maxTotalAlpha) * strength * alpha * inner * ownColor.a;","ownColor.a = max(ownColor.a * knockout * (1. - hideObject), 0.0001);","vec3 mix1 = mix(ownColor.rgb, color.rgb, innerGlowAlpha / (innerGlowAlpha + ownColor.a));","vec3 mix2 = mix(mix1, color.rgb, outerGlowAlpha / (innerGlowAlpha + ownColor.a + outerGlowAlpha));","float resultAlpha = min(ownColor.a + outerGlowAlpha + innerGlowAlpha, 1.);","gl_FragColor = vec4(mix2 * resultAlpha, resultAlpha);","}"].join("\n"),this.uniforms={projectionVector:{type:"2f",value:{x:0,y:0},dirty:!0},distance:{type:"1f",value:15,dirty:!0},angle:{type:"1f",value:1,dirty:!0},color:{type:"4f",value:{x:1,y:0,z:0,w:0},dirty:!0},alpha:{type:"1f",value:1,dirty:!0},blurX:{type:"1f",value:1,dirty:!0},blurY:{type:"1f",value:1,dirty:!0},strength:{type:"1f",value:1,dirty:!0},inner:{type:"1f",value:1,dirty:!0},knockout:{type:"1f",value:1,dirty:!0},hideObject:{type:"1f",value:0,dirty:!0},uTextureSize:{type:"2f",value:{x:100,y:100},dirty:!0}}}__extends(t,e);var i=t,r=i.prototype;return r.setDistance=function(e){var t=this.uniforms.distance;t.value!=e&&(t.value=e,t.dirty=!0)},r.setAngle=function(e){var t=this.uniforms.angle;t.value!=e&&(t.value=e,t.dirty=!0)},r.setColor=function(e,t,i){var r=this.uniforms.color;(r.value.x!=e||r.value.y!=t||r.value.z!=i)&&(r.value.x=e,r.value.y=t,r.value.z=i,r.dirty=!0)},r.setAlpha=function(e){var t=this.uniforms.alpha;t.value!=e&&(t.value=e,t.dirty=!0)},r.setBlurX=function(e){var t=this.uniforms.blurX;t.value!=e&&(t.value=e,t.dirty=!0)},r.setBlurY=function(e){var t=this.uniforms.blurY;t.value!=e&&(t.value=e,t.dirty=!0)},r.setStrength=function(e){var t=this.uniforms.strength;t.value!=e&&(t.value=e,t.dirty=!0)},r.setInner=function(e){var t=this.uniforms.inner;t.value!=e&&(t.value=e,t.dirty=!0)},r.setKnockout=function(e){var t=this.uniforms.knockout;t.value!=e&&(t.value=e,t.dirty=!0)},r.setHideObject=function(e){var t=this.uniforms.hideObject;t.value!=e&&(t.value=e,t.dirty=!0)},r.setTextureSize=function(e,t){var i=this.uniforms.uTextureSize;(e!=i.value.x||t!=i.value.y)&&(i.value.x=e,i.value.y=t,i.dirty=!0)},t}(t.TextureShader);t.GlowShader=i,e.registerClass(i,"egret.web.GlowShader")}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(){function e(e){this.gl=null,this.maxAttibs=10,this.attribState=[],this.tempAttribState=[],this.currentShader=null,this.defaultShader=null,this.primitiveShader=null,this.colorTransformShader=null,this.blurShader=null,this.glowShader=null;for(var t=0;t<this.maxAttibs;t++)this.attribState[t]=!1;this.setContext(e)}var i=e,r=i.prototype;return r.setContext=function(e){this.gl=e,this.primitiveShader=new t.PrimitiveShader(e),this.defaultShader=new t.TextureShader(e),this.colorTransformShader=new t.ColorTransformShader(e),this.glowShader=new t.GlowShader(e),this.blurShader=new t.BlurShader(e),this.primitiveShader.init(),this.defaultShader.init(),this.colorTransformShader.init(),this.blurShader.init(),this.glowShader.init()},r.activateShader=function(e,t){this.currentShader!=e&&(this.gl.useProgram(e.program),this.setAttribs(e.attributes),e.setAttribPointer(t),this.currentShader=e)},r.setAttribs=function(e){var t,i;for(i=this.tempAttribState.length,t=0;i>t;t++)this.tempAttribState[t]=!1;for(i=e.length,t=0;i>t;t++){var r=e[t];this.tempAttribState[r]=!0}var n=this.gl;for(i=this.attribState.length,t=0;i>t;t++)this.attribState[t]!==this.tempAttribState[t]&&(this.attribState[t]=this.tempAttribState[t],this.tempAttribState[t]?n.enableVertexAttribArray(t):n.disableVertexAttribArray(t))},e}();t.WebGLShaderManager=i,e.registerClass(i,"egret.web.WebGLShaderManager")}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(){function e(){this.drawData=[],this.drawDataLen=0}var t=e,i=t.prototype;return i.pushDrawRect=function(){if(0==this.drawDataLen||1!=this.drawData[this.drawDataLen-1].type){var e=this.drawData[this.drawDataLen]||{};e.type=1,e.count=0,this.drawData[this.drawDataLen]=e,this.drawDataLen++}this.drawData[this.drawDataLen-1].count+=2},i.pushDrawTexture=function(e,t,i,r,n){if(void 0===t&&(t=2),i){var a=this.drawData[this.drawDataLen]||{};a.type=0,a.texture=e,a.filter=i,a.count=t,a.textureWidth=r,a.textureHeight=n,this.drawData[this.drawDataLen]=a,this.drawDataLen++}else{if(0==this.drawDataLen||0!=this.drawData[this.drawDataLen-1].type||e!=this.drawData[this.drawDataLen-1].texture||this.drawData[this.drawDataLen-1].filter){var a=this.drawData[this.drawDataLen]||{};a.type=0,a.texture=e,a.count=0,this.drawData[this.drawDataLen]=a,this.drawDataLen++}this.drawData[this.drawDataLen-1].count+=t}},i.pushPushMask=function(e){void 0===e&&(e=1);var t=this.drawData[this.drawDataLen]||{};t.type=2,t.count=2*e,this.drawData[this.drawDataLen]=t,this.drawDataLen++},i.pushPopMask=function(e){void 0===e&&(e=1);var t=this.drawData[this.drawDataLen]||{};t.type=3,t.count=2*e,this.drawData[this.drawDataLen]=t,this.drawDataLen++},i.pushSetBlend=function(e){for(var t=this.drawDataLen,i=!1,r=t-1;r>=0;r--){var n=this.drawData[r];if(n){if((0==n.type||1==n.type)&&(i=!0),!i&&4==n.type){this.drawData.splice(r,1),this.drawDataLen--;continue}if(4==n.type){if(n.value==e)return;break}}}var a=this.drawData[this.drawDataLen]||{};a.type=4,a.value=e,this.drawData[this.drawDataLen]=a,this.drawDataLen++},i.pushResize=function(e,t,i){var r=this.drawData[this.drawDataLen]||{};r.type=5,r.buffer=e,r.width=t,r.height=i,this.drawData[this.drawDataLen]=r,this.drawDataLen++},i.pushClearColor=function(){var e=this.drawData[this.drawDataLen]||{};e.type=6,this.drawData[this.drawDataLen]=e,this.drawDataLen++},i.pushActivateBuffer=function(e){for(var t=this.drawDataLen,i=!1,r=t-1;r>=0;r--){var n=this.drawData[r];!n||(4!=n.type&&7!=n.type&&(i=!0),i||7!=n.type)||(this.drawData.splice(r,1),this.drawDataLen--)}var a=this.drawData[this.drawDataLen]||{};a.type=7,a.buffer=e,a.width=e.rootRenderTarget.width,a.height=e.rootRenderTarget.height,this.drawData[this.drawDataLen]=a,this.drawDataLen++},i.pushEnableScissor=function(e,t,i,r){var n=this.drawData[this.drawDataLen]||{};n.type=8,n.x=e,n.y=t,n.width=i,n.height=r,this.drawData[this.drawDataLen]=n,this.drawDataLen++},i.pushDisableScissor=function(){var e=this.drawData[this.drawDataLen]||{};e.type=9,this.drawData[this.drawDataLen]=e,this.drawDataLen++},i.clear=function(){for(var e=0;e<this.drawDataLen;e++){var t=this.drawData[e];t.type=0,t.count=0,t.texture=null,t.filter=null,t.uv=null,t.value="",t.buffer=null,t.width=0,t.height=0}this.drawDataLen=0},e}();t.WebGLDrawCmdManager=i,e.registerClass(i,"egret.web.WebGLDrawCmdManager")}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(){function e(){this.size=2e3,this.vertexMaxSize=4*this.size,this.indicesMaxSize=6*this.size,this.vertSize=5,this.vertices=null,this.indices=null,this.indicesForMesh=null,this.vertexIndex=0,this.indexIndex=0,this.hasMesh=!1;var e=this.vertexMaxSize*this.vertSize,t=this.indicesMaxSize;this.vertices=new Float32Array(e),this.indices=new Uint16Array(t),this.indicesForMesh=new Uint16Array(t);for(var i=0,r=0;t>i;i+=6,r+=4)this.indices[i+0]=r+0,this.indices[i+1]=r+1,this.indices[i+2]=r+2,this.indices[i+3]=r+0,this.indices[i+4]=r+2,this.indices[i+5]=r+3}var t=e,i=t.prototype;return i.reachMaxSize=function(e,t){return void 0===e&&(e=4),void 0===t&&(t=6),this.vertexIndex>this.vertexMaxSize-e||this.indexIndex>this.indicesMaxSize-t},i.getVertices=function(){var e=this.vertices.subarray(0,this.vertexIndex*this.vertSize);return e},i.getIndices=function(){return this.indices},i.getMeshIndices=function(){return this.indicesForMesh},i.changeToMeshIndices=function(){if(!this.hasMesh){for(var e=0,t=this.indexIndex;t>e;++e)this.indicesForMesh[e]=this.indices[e];this.hasMesh=!0}},i.isMesh=function(){return this.hasMesh},i.cacheArrays=function(e,t,i,r,n,a,s,o,h,l,u,c,d,f,v){var p=e,g=p.a,m=p.b,x=p.c,b=p.d,w=p.tx,y=p.ty;(0!=s||0!=o)&&p.append(1,0,0,1,s,o),(n/h!=1||a/l!=1)&&p.append(h/n,0,0,l/a,0,0);var T=p.a,E=p.b,S=p.c,C=p.d,R=p.tx,_=p.ty;if(p.a=g,p.b=m,p.c=x,p.d=b,p.tx=w,p.ty=y,f){var L=this.vertices,D=this.vertexIndex*this.vertSize,A=0,M=0,$=0,I=0,B=0,O=0,F=0;for(A=0,$=d.length;$>A;A+=2)M=5*A/2,O=f[A],F=f[A+1],I=d[A],B=d[A+1],L[D+M+0]=T*O+S*F+R,L[D+M+1]=E*O+C*F+_,L[D+M+2]=(i+I*n)/u,L[D+M+3]=(r+B*a)/c,L[D+M+4]=t;if(this.hasMesh)for(var A=0,$=v.length;$>A;++A)this.indicesForMesh[this.indexIndex+A]=v[A]+this.vertexIndex;this.vertexIndex+=d.length/2,this.indexIndex+=v.length}else{var P=u,W=c,H=n,G=a;i/=P,r/=W,n/=P,a/=W;var L=this.vertices,D=this.vertexIndex*this.vertSize;if(L[D++]=R,L[D++]=_,L[D++]=i,L[D++]=r,L[D++]=t,L[D++]=T*H+R,L[D++]=E*H+_,L[D++]=n+i,L[D++]=r,L[D++]=t,L[D++]=T*H+S*G+R,L[D++]=C*G+E*H+_,L[D++]=n+i,L[D++]=a+r,L[D++]=t,L[D++]=S*G+R,L[D++]=C*G+_,L[D++]=i,L[D++]=a+r,L[D++]=t,this.hasMesh){var k=this.indicesForMesh;k[this.indexIndex+0]=0+this.vertexIndex,k[this.indexIndex+1]=1+this.vertexIndex,k[this.indexIndex+2]=2+this.vertexIndex,k[this.indexIndex+3]=0+this.vertexIndex,k[this.indexIndex+4]=2+this.vertexIndex,k[this.indexIndex+5]=3+this.vertexIndex}this.vertexIndex+=4,this.indexIndex+=6}},i.clear=function(){this.hasMesh=!1,this.vertexIndex=0,this.indexIndex=0},e}();t.WebGLVertexArrayObject=i,e.registerClass(i,"egret.web.WebGLVertexArrayObject")}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(){function e(e,t,i){this.clearColor=[0,0,0,0],this.useFrameBuffer=!0,this.gl=e,this.width=t||1,this.height=i||1,this.texture=this.createTexture(),this.frameBuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0),this.stencilBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this.stencilBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,this.width,this.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,this.stencilBuffer)}var t=e,i=t.prototype;return i.resize=function(e,t){var i=this.gl;i.bindTexture(i.TEXTURE_2D,this.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,t,0,i.RGBA,i.UNSIGNED_BYTE,null),i.bindFramebuffer(i.FRAMEBUFFER,this.frameBuffer),i.bindRenderbuffer(i.RENDERBUFFER,this.stencilBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,e,t),this.width=e,this.height=t},i.activate=function(){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,this.getFrameBuffer())},i.getFrameBuffer=function(){return this.useFrameBuffer?this.frameBuffer:null},i.createTexture=function(){var e=this.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t},i.clear=function(e){var t=this.gl;e&&this.activate(),t.colorMask(!0,!0,!0,!0),t.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],this.clearColor[3]),t.clear(t.COLOR_BUFFER_BIT)},e}();t.WebGLRenderTarget=i,e.registerClass(i,"egret.web.WebGLRenderTarget")}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function i(e,t){var i=document.createElement("canvas");return isNaN(e)||isNaN(t)||(i.width=e,i.height=t),i}var r=function(){function r(e,r){this.glID=null,this.projectionX=0/0,this.projectionY=0/0,this.shaderManager=null,this.contextLost=!1,this.$scissorState=!1,this.vertSize=5,this.blurFilter=null,this.surface=i(e,r),this.initWebGL(),this.$bufferStack=[];var n=this.context;this.vertexBuffer=n.createBuffer(),this.indexBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.drawCmdManager=new t.WebGLDrawCmdManager,this.vao=new t.WebGLVertexArrayObject,this.setGlobalCompositeOperation("source-over")}var n=r,a=n.prototype;return r.getInstance=function(e,t){return this.instance?this.instance:(this.instance=new r(e,t),this.instance)},a.pushBuffer=function(e){this.$bufferStack.push(e),e!=this.currentBuffer&&(this.currentBuffer,this.drawCmdManager.pushActivateBuffer(e)),this.currentBuffer=e},a.popBuffer=function(){if(!(this.$bufferStack.length<=1)){var e=this.$bufferStack.pop(),t=this.$bufferStack[this.$bufferStack.length-1];e!=t&&this.drawCmdManager.pushActivateBuffer(t),this.currentBuffer=t}},a.activateBuffer=function(e){e.rootRenderTarget.activate(),this.bindIndices||(this.uploadIndicesArray(this.vao.getIndices()),this.bindIndices=!0),e.restoreStencil(),e.restoreScissor(),this.onResize(e.width,e.height)},a.uploadVerticesArray=function(e){var t=this.context;t.bufferData(t.ARRAY_BUFFER,e,t.STREAM_DRAW)},a.uploadIndicesArray=function(e){var t=this.context;t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)},a.destroy=function(){this.surface.width=this.surface.height=0},a.onResize=function(e,t){var e=e||this.surface.width,t=t||this.surface.height;this.projectionX=e/2,this.projectionY=-t/2,this.context&&this.context.viewport(0,0,e,t)},a.resize=function(e,t,i){var r=this.surface;i?(r.width<e&&(r.width=e),r.height<t&&(r.height=t)):(r.width!=e&&(r.width=e),r.height!=t&&(r.height=t)),this.onResize()},a.initWebGL=function(){this.onResize(),this.surface.addEventListener("webglcontextlost",this.handleContextLost.bind(this),!1),this.surface.addEventListener("webglcontextrestored",this.handleContextRestored.bind(this),!1),this.getWebGLContext(),this.shaderManager=new t.WebGLShaderManager(this.context)},a.handleContextLost=function(){this.contextLost=!0},a.handleContextRestored=function(){this.initWebGL(),this.contextLost=!1},a.getWebGLContext=function(){for(var t,i={antialias:r.antialias,stencil:!0},n=["webgl","experimental-webgl"],a=0;a<n.length;a++){try{t=this.surface.getContext(n[a],i)}catch(s){}if(t)break}t||e.$error(1021),this.setContext(t)},a.setContext=function(e){this.context=e,e.id=r.glContextId++,this.glID=e.id,e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE),e.enable(e.BLEND),e.colorMask(!0,!0,!0,!0),e.activeTexture(e.TEXTURE0)},a.enableStencilTest=function(){var e=this.context;e.enable(e.STENCIL_TEST)},a.disableStencilTest=function(){var e=this.context;e.disable(e.STENCIL_TEST)},a.enableScissorTest=function(e){var t=this.context;t.enable(t.SCISSOR_TEST),t.scissor(e.x,e.y,e.width,e.height)},a.disableScissorTest=function(){var e=this.context;e.disable(e.SCISSOR_TEST)},a.getPixels=function(e,t,i,r,n){var a=this.context;a.readPixels(e,t,i,r,a.RGBA,a.UNSIGNED_BYTE,n)},a.createTexture=function(e){var t=this.context,i=t.createTexture();return i?(i.glContext=t,t.bindTexture(t.TEXTURE_2D,i),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),i):void(this.contextLost=!0)},a.createTextureFromCompressedData=function(){return null},a.updateTexture=function(e,t){var i=this.context;i.bindTexture(i.TEXTURE_2D,e),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t)},a.getWebGLTexture=function(e){return e.webGLTexture||("image"==e.format?e.webGLTexture=this.createTexture(e.source):"pvr"==e.format&&(e.webGLTexture=this.createTextureFromCompressedData(e.source.pvrtcData,e.width,e.height,e.source.mipmapsCount,e.source.format)),e.$deleteSource&&e.webGLTexture&&(e.source=null)),e.webGLTexture},a.clearRect=function(e,t,i,r){if(0!=e||0!=t||i!=this.surface.width||r!=this.surface.height){var n=this.currentBuffer;if(n.$hasScissor)this.setGlobalCompositeOperation("destination-out"),this.drawRect(e,t,i,r),this.setGlobalCompositeOperation("source-over");else{var a=n.globalMatrix;0==a.b&&0==a.c?(e=e*a.a+a.tx,t=t*a.d+a.ty,i*=a.a,r*=a.d,this.enableScissor(e,-t-r+n.height,i,r),this.clear(),this.disableScissor()):(this.setGlobalCompositeOperation("destination-out"),this.drawRect(e,t,i,r),this.setGlobalCompositeOperation("source-over"))}}else this.clear()},a.setGlobalCompositeOperation=function(e){this.drawCmdManager.pushSetBlend(e)},a.drawImage=function(e,t,i,r,n,a,s,o,h,l,u){var c=this.currentBuffer;if(!this.contextLost&&e&&c){var d;if(e.source&&e.source.texture)d=e.source.texture,c.saveTransform(),c.transform(1,0,0,-1,0,h+2*s);else{if(!e.source&&!e.webGLTexture)return;d=this.getWebGLTexture(e)}d&&(this.drawTexture(d,t,i,r,n,a,s,o,h,l,u),e.source&&e.source.texture&&c.restoreTransform())}},a.drawMesh=function(e,t,i,r,n,a,s,o,h,l,u,c,d,f,v){var p=this.currentBuffer;if(!this.contextLost&&e&&p){var g;if(e.source&&e.source.texture)g=e.source.texture,p.saveTransform(),p.transform(1,0,0,-1,0,h+2*s);else{if(!e.source&&!e.webGLTexture)return;g=this.getWebGLTexture(e)}g&&this.drawTexture(g,t,i,r,n,a,s,o,h,l,u,c,d,f,v)}},a.drawTexture=function(e,t,i,r,n,a,s,o,h,l,u,c,d,f){var v=this.currentBuffer;if(!this.contextLost&&e&&v){d&&f?this.vao.reachMaxSize(d.length/2,f.length)&&this.$drawWebGL():this.vao.reachMaxSize()&&this.$drawWebGL(),c&&this.vao.changeToMeshIndices();var p=v.globalMatrix,g=v.globalAlpha,m=f?f.length/3:2;this.drawCmdManager.pushDrawTexture(e,m,this.$filter),this.vao.cacheArrays(p,g,t,i,r,n,a,s,o,h,l,u,c,d,f)}},a.drawRect=function(e,t,i,r){var n=this.currentBuffer;!this.contextLost&&n&&(this.vao.reachMaxSize()&&this.$drawWebGL(),this.drawCmdManager.pushDrawRect(),this.vao.cacheArrays(n.globalMatrix,n.globalAlpha,0,0,i,r,e,t,i,r,i,r))},a.pushMask=function(e){var t=this.currentBuffer;if(!this.contextLost&&t){t.$stencilList.push(e),this.vao.reachMaxSize()&&this.$drawWebGL();var i=e.length;if(i){this.drawCmdManager.pushPushMask(i);for(var r=0;i>r;r++){var n=e[r];this.vao.cacheArrays(t.globalMatrix,t.globalAlpha,0,0,n.width,n.height,n.minX,n.minY,n.width,n.height,n.width,n.height)}}else this.drawCmdManager.pushPushMask(),this.vao.cacheArrays(t.globalMatrix,t.globalAlpha,0,0,e.width,e.height,e.x,e.y,e.width,e.height,e.width,e.height)}},a.popMask=function(){var e=this.currentBuffer;if(!this.contextLost&&e){var t=e.$stencilList.pop();this.vao.reachMaxSize()&&this.$drawWebGL();var i=t.length;if(i){this.drawCmdManager.pushPopMask(i);for(var r=0;i>r;r++){var n=t[r];this.vao.cacheArrays(e.globalMatrix,e.globalAlpha,0,0,n.width,n.height,n.minX,n.minY,n.width,n.height,n.width,n.height)}}else this.drawCmdManager.pushPopMask(),this.vao.cacheArrays(e.globalMatrix,e.globalAlpha,0,0,t.width,t.height,t.x,t.y,t.width,t.height,t.width,t.height)}},a.clear=function(){this.drawCmdManager.pushClearColor()},a.enableScissor=function(e,t,i,r){var n=this.currentBuffer;this.drawCmdManager.pushEnableScissor(e,t,i,r),n.$hasScissor=!0},a.disableScissor=function(){var e=this.currentBuffer;this.drawCmdManager.pushDisableScissor(),e.$hasScissor=!1},a.$drawWebGL=function(){if(0!=this.drawCmdManager.drawDataLen&&!this.contextLost){this.uploadVerticesArray(this.vao.getVertices()),this.vao.isMesh()&&this.uploadIndicesArray(this.vao.getMeshIndices());for(var e=this.drawCmdManager.drawDataLen,t=0,i=0;e>i;i++){var r=this.drawCmdManager.drawData[i];t=this.drawData(r,t),7==r.type&&(this.activatedBuffer=r.buffer),(0==r.type||1==r.type||2==r.type||3==r.type)&&this.activatedBuffer&&this.activatedBuffer.$computeDrawCall&&this.activatedBuffer.$drawCalls++}this.vao.isMesh()&&this.uploadIndicesArray(this.vao.getIndices()),this.drawCmdManager.clear(),this.vao.clear()}},a.drawData=function(e,t){if(e){switch(e.type){case 0:var i,r=e.filter;r?"colorTransform"==r.type?(i=this.shaderManager.colorTransformShader,i.setMatrix(r.$matrix)):"blur"==r.type?(i=this.shaderManager.blurShader,i.setBlur(r.$blurX,r.$blurY),i.setTextureSize(e.textureWidth,e.textureHeight)):"glow"==r.type&&(i=this.shaderManager.glowShader,i.setDistance(r.$distance||0),i.setAngle(r.$angle?r.$angle/180*Math.PI:0),i.setColor(r.$red/255,r.$green/255,r.$blue/255),i.setAlpha(r.$alpha),i.setBlurX(r.$blurX),i.setBlurY(r.$blurY),i.setStrength(r.$strength),i.setInner(r.$inner?1:0),i.setKnockout(r.$knockout?0:1),i.setHideObject(r.$hideObject?1:0),i.setTextureSize(e.textureWidth,e.textureHeight)):i=this.shaderManager.defaultShader,i.setProjection(this.projectionX,this.projectionY),this.shaderManager.activateShader(i,4*this.vertSize),i.syncUniforms(),t+=this.drawTextureElements(e,t);break;case 1:var i=this.shaderManager.primitiveShader;i.setProjection(this.projectionX,this.projectionY),this.shaderManager.activateShader(i,4*this.vertSize),i.syncUniforms(),t+=this.drawRectElements(e,t);break;case 2:var i=this.shaderManager.primitiveShader;i.setProjection(this.projectionX,this.projectionY),this.shaderManager.activateShader(i,4*this.vertSize),i.syncUniforms(),t+=this.drawPushMaskElements(e,t);break;case 3:var i=this.shaderManager.primitiveShader;i.setProjection(this.projectionX,this.projectionY),this.shaderManager.activateShader(i,4*this.vertSize),i.syncUniforms(),t+=this.drawPopMaskElements(e,t);break;case 4:this.setBlendMode(e.value);break;case 5:e.buffer.rootRenderTarget.resize(e.width,e.height),this.onResize(e.width,e.height);break;case 6:if(this.activatedBuffer){var n=this.activatedBuffer.rootRenderTarget;(0!=n.width||0!=n.height)&&n.clear()}break;case 7:this.activateBuffer(e.buffer);break;case 8:var a=this.activatedBuffer;a&&a.enableScissor(e.x,e.y,e.width,e.height);break;case 9:var a=this.activatedBuffer;a&&a.disableScissor()}return t}},a.drawTextureElements=function(e,t){var i=this.context;i.bindTexture(i.TEXTURE_2D,e.texture);var r=3*e.count;return i.drawElements(i.TRIANGLES,r,i.UNSIGNED_SHORT,2*t),r},a.drawRectElements=function(e,t){var i=this.context,r=3*e.count;return i.drawElements(i.TRIANGLES,r,i.UNSIGNED_SHORT,2*t),r},a.drawPushMaskElements=function(e,t){var i=this.context,r=3*e.count,n=this.activatedBuffer;if(n){0==n.stencilHandleCount&&(n.enableStencil(),i.clear(i.STENCIL_BUFFER_BIT));var a=n.stencilHandleCount;n.stencilHandleCount++,i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.EQUAL,a,255),i.stencilOp(i.KEEP,i.KEEP,i.INCR),i.drawElements(i.TRIANGLES,r,i.UNSIGNED_SHORT,2*t),i.stencilFunc(i.EQUAL,a+1,255),i.colorMask(!0,!0,!0,!0),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)}return r},a.drawPopMaskElements=function(e,t){var i=this.context,r=3*e.count,n=this.activatedBuffer;if(n)if(n.stencilHandleCount--,0==n.stencilHandleCount)n.disableStencil();else{var a=n.stencilHandleCount;i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.EQUAL,a+1,255),i.stencilOp(i.KEEP,i.KEEP,i.DECR),i.drawElements(i.TRIANGLES,r,i.UNSIGNED_SHORT,2*t),i.stencilFunc(i.EQUAL,a,255),i.colorMask(!0,!0,!0,!0),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)}return r},a.setBlendMode=function(e){var t=this.context,i=r.blendModesForGL[e];i&&t.blendFunc(i[0],i[1])},a.drawTargetWidthFilters=function(e,i){var r,n=i,a=e.length;if(a>1)for(var s=0;a-1>s;s++){var o=e[s],h=i.rootRenderTarget.width,l=i.rootRenderTarget.height;r=t.WebGLRenderBuffer.create(h,l),r.setTransform(1,0,0,1,0,0),r.globalAlpha=1,this.drawToRenderTarget(o,i,r),i!=n&&t.WebGLRenderBuffer.release(i),i=r}var o=e[a-1];this.drawToRenderTarget(o,i,this.currentBuffer),i!=n&&t.WebGLRenderBuffer.release(i)},a.drawToRenderTarget=function(i,r,n){if(!this.contextLost){this.vao.reachMaxSize()&&this.$drawWebGL(),this.pushBuffer(n);var a,s=r,o=r.rootRenderTarget.width,h=r.rootRenderTarget.height;"blur"==i.type&&(this.blurFilter||(this.blurFilter=new e.BlurFilter(2,2)),0!=i.blurX&&0!=i.blurY?(this.blurFilter.blurX=i.blurX,this.blurFilter.blurY=0,a=t.WebGLRenderBuffer.create(o,h),a.setTransform(1,0,0,1,0,0),a.globalAlpha=1,this.drawToRenderTarget(this.blurFilter,r,a),r!=s&&t.WebGLRenderBuffer.release(r),r=a,this.blurFilter.blurX=0,this.blurFilter.blurY=i.blurY):(this.blurFilter.blurX=i.blurX,this.blurFilter.blurY=i.blurY),i=this.blurFilter),n.saveTransform(),n.transform(1,0,0,-1,0,h),this.vao.cacheArrays(n.globalMatrix,n.globalAlpha,0,0,o,h,0,0,o,h,o,h),n.restoreTransform();var l;l="blur"==i.type?{type:"blur",$blurX:i.$blurX,$blurY:i.$blurY}:i,this.drawCmdManager.pushDrawTexture(r.rootRenderTarget.texture,2,l,o,h),r!=s&&t.WebGLRenderBuffer.release(r),this.popBuffer()}},r.initBlendMode=function(){r.blendModesForGL={},r.blendModesForGL["source-over"]=[1,771],r.blendModesForGL.lighter=[1,772],r.blendModesForGL["lighter-in"]=[770,771],r.blendModesForGL["destination-out"]=[0,771],r.blendModesForGL["destination-in"]=[0,770]},r.glContextId=0,r.blendModesForGL=null,r}();t.WebGLRenderContext=r,e.registerClass(r,"egret.web.WebGLRenderContext"),r.initBlendMode()}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(){function i(i,r,n){if(this.globalAlpha=1,this.stencilState=!1,this.$stencilList=[],this.stencilHandleCount=0,this.$scissorState=!1,this.scissorRect=new e.Rectangle,this.$hasScissor=!0,this.dirtyRegionPolicy=!0,this._dirtyRegionPolicy=!0,this.$drawCalls=0,this.$computeDrawCall=!1,this.globalMatrix=new e.Matrix,this.savedGlobalMatrix=new e.Matrix,this.context=t.WebGLRenderContext.getInstance(i,r),this.rootRenderTarget=new t.WebGLRenderTarget(this.context.context,3,3),i&&r&&this.resize(i,r),this.root=n,this.root)this.context.pushBuffer(this),this.surface=this.context.surface;else{var a=this.context.activatedBuffer;a&&a.rootRenderTarget.activate(),this.surface=this.rootRenderTarget}}var n=__define,a=i,s=a.prototype;return s.enableStencil=function(){this.stencilState||(this.context.enableStencilTest(),this.stencilState=!0)},s.disableStencil=function(){this.stencilState&&(this.context.disableStencilTest(),this.stencilState=!1)},s.restoreStencil=function(){this.stencilState?this.context.enableStencilTest():this.context.disableStencilTest()},s.enableScissor=function(e,t,i,r){this.$scissorState||(this.$scissorState=!0,this.scissorRect.setTo(e,t,i,r),this.context.enableScissorTest(this.scissorRect))},s.disableScissor=function(){this.$scissorState&&(this.$scissorState=!1,this.scissorRect.setEmpty(),this.context.disableScissorTest())},s.restoreScissor=function(){this.$scissorState?this.context.enableScissorTest(this.scissorRect):this.context.disableScissorTest()},n(s,"width",function(){return this.rootRenderTarget.width}),n(s,"height",function(){return this.rootRenderTarget.height}),s.resize=function(e,t,i){this.context.pushBuffer(this),e=e||1,t=t||1,(e!=this.rootRenderTarget.width||t!=this.rootRenderTarget.height)&&(this.context.drawCmdManager.pushResize(this,e,t),this.rootRenderTarget.width=e,this.rootRenderTarget.height=t),this.root&&this.context.resize(e,t,i),this.context.clear(),this.context.popBuffer()},s.resizeTo=function(e,t,r,n){this.context.pushBuffer(this);var a=this.rootRenderTarget.width,s=this.rootRenderTarget.height,o=i.create(a,s);this.context.pushBuffer(o),this.context.drawImage(this.rootRenderTarget,0,0,a,s,0,0,a,s,a,s),this.context.popBuffer(),this.resize(e,t),this.setTransform(1,0,0,1,0,0),this.context.drawImage(o.rootRenderTarget,0,0,a,s,r,n,a,s,a,s),i.release(o),this.context.popBuffer()},s.setDirtyRegionPolicy=function(e){this.dirtyRegionPolicy="on"==e},s.beginClip=function(e,t,i){this.context.pushBuffer(this),this.root&&(this._dirtyRegionPolicy?(this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate()):(this.rootRenderTarget.useFrameBuffer=!1,this.rootRenderTarget.activate(),this.context.clear())),t=+t||0,i=+i||0,this.setTransform(1,0,0,1,t,i);var r=e.length;if(1==r&&0==e[0].minX&&0==e[0].minY&&e[0].width==this.rootRenderTarget.width&&e[0].height==this.rootRenderTarget.height)return this.maskPushed=!1,this.rootRenderTarget.useFrameBuffer&&this.context.clear(),void this.context.popBuffer();for(var n=0;r>n;n++){var a=e[n];this.context.clearRect(a.minX,a.minY,a.width,a.height)}if(r>0){if(this.$hasScissor||1!=r)this.scissorEnabled=!1;else{var a=e[0];e=e.slice(1);var s=a.minX+t,o=a.minY+i,h=a.width,l=a.height;this.context.enableScissor(s,-o-l+this.height,h,l),this.scissorEnabled=!0}e.length>0?(this.context.pushMask(e),this.maskPushed=!0):this.maskPushed=!1,this.offsetX=t,this.offsetY=i}else this.maskPushed=!1;this.context.popBuffer()},s.endClip=function(){(this.maskPushed||this.scissorEnabled)&&(this.context.pushBuffer(this),this.maskPushed&&(this.setTransform(1,0,0,1,this.offsetX,this.offsetY),this.context.popMask()),this.scissorEnabled&&this.context.disableScissor(),this.context.popBuffer())},s.getPixel=function(e,t){var i=new Uint8Array(4),r=this.rootRenderTarget.useFrameBuffer;return this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate(),this.context.getPixels(e,t,1,1,i),this.rootRenderTarget.useFrameBuffer=r,this.rootRenderTarget.activate(),i},s.toDataURL=function(e,t){return this.context.surface.toDataURL(e,t)},s.destroy=function(){this.context.destroy()},s.onRenderFinish=function(){this.$drawCalls=0,this.root&&(!this._dirtyRegionPolicy&&this.dirtyRegionPolicy&&this.drawSurfaceToFrameBuffer(0,0,this.rootRenderTarget.width,this.rootRenderTarget.height,0,0,this.rootRenderTarget.width,this.rootRenderTarget.height,!0),this._dirtyRegionPolicy&&this.drawFrameBufferToSurface(0,0,this.rootRenderTarget.width,this.rootRenderTarget.height,0,0,this.rootRenderTarget.width,this.rootRenderTarget.height),this._dirtyRegionPolicy=this.dirtyRegionPolicy)
},s.drawFrameBufferToSurface=function(e,t,i,r,n,a,s,o,h){void 0===h&&(h=!1),this.rootRenderTarget.useFrameBuffer=!1,this.rootRenderTarget.activate(),this.context.disableStencilTest(),this.context.disableScissorTest(),this.setTransform(1,0,0,1,0,0),this.globalAlpha=1,this.context.setGlobalCompositeOperation("source-over"),h&&this.context.clear(),this.context.drawImage(this.rootRenderTarget,e,t,i,r,n,a,s,o,i,r),this.context.$drawWebGL(),this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate(),this.restoreStencil(),this.restoreScissor()},s.drawSurfaceToFrameBuffer=function(e,t,i,r,n,a,s,o,h){void 0===h&&(h=!1),this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate(),this.context.disableStencilTest(),this.context.disableScissorTest(),this.setTransform(1,0,0,1,0,0),this.globalAlpha=1,this.context.setGlobalCompositeOperation("source-over"),h&&this.context.clear(),this.context.drawImage(this.context.surface,e,t,i,r,n,a,s,o,i,r),this.context.$drawWebGL(),this.rootRenderTarget.useFrameBuffer=!1,this.rootRenderTarget.activate(),this.restoreStencil(),this.restoreScissor()},s.clear=function(){this.context.clear()},s.setTransform=function(e,t,i,r,n,a){var s=this.globalMatrix;s.a=e,s.b=t,s.c=i,s.d=r,s.tx=n,s.ty=a},s.transform=function(e,t,i,r,n,a){var s=this.globalMatrix,o=s.a,h=s.b,l=s.c,u=s.d;(1!=e||0!=t||0!=i||1!=r)&&(s.a=e*o+t*l,s.b=e*h+t*u,s.c=i*o+r*l,s.d=i*h+r*u),s.tx=n*o+a*l+s.tx,s.ty=n*h+a*u+s.ty},s.translate=function(e,t){var i=this.globalMatrix;i.tx+=e,i.ty+=t},s.saveTransform=function(){var e=this.globalMatrix,t=this.savedGlobalMatrix;t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t.tx=e.tx,t.ty=e.ty},s.restoreTransform=function(){var e=this.globalMatrix,t=this.savedGlobalMatrix;e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.tx=t.tx,e.ty=t.ty},i.create=function(e,t){var n=r.pop();return n?n.resize(e,t):(n=new i(e,t),n.$computeDrawCall=!1),n},i.release=function(e){r.push(e)},i}();t.WebGLRenderBuffer=i,e.registerClass(i,"egret.web.WebGLRenderBuffer",["egret.sys.RenderBuffer"]);var r=[]}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=["source-over","lighter","destination-out"],r="source-over",n=[],a=function(){function a(){this.nestLevel=0}var s=a,o=s.prototype;return o.render=function(e,t,i,r,a){this.nestLevel++;var s=t,o=s.context,h=a?e:null;o.pushBuffer(s),this.drawDisplayObject(e,s,r,i,null,null,h),o.$drawWebGL();var l=s.$drawCalls;if(s.onRenderFinish(),o.popBuffer(),this.nestLevel--,0===this.nestLevel){n.length>6&&(n.length=6);for(var u=n.length,c=0;u>c;c++)n[c].resize(0,0)}return l},o.drawDisplayObject=function(t,i,r,n,a,s,o){var h,l=0;if(a&&!o?(a.isDirty&&(l+=a.drawToSurface()),h=a.$renderNode):h=t.$getRenderNode(),h){if(r){var u=h.renderRegion;if(s&&!s.intersects(u))h.needRedraw=!1;else if(!h.needRedraw)for(var c=r.length,d=0;c>d;d++)if(u.intersects(r[d])){h.needRedraw=!0;break}}else h.needRedraw=!0;if(h.needRedraw){l++;var f,v;o?(f=t.$getConcatenatedAlphaAt(o,t.$getConcatenatedAlpha()),v=e.Matrix.create().copyFrom(t.$getConcatenatedMatrix()),t.$getConcatenatedMatrixAt(o,v),n.$preMultiplyInto(v,v),i.setTransform(v.a,v.b,v.c,v.d,v.tx,v.ty),e.Matrix.release(v)):(f=h.renderAlpha,v=h.renderMatrix,i.setTransform(v.a,v.b,v.c,v.d,v.tx+n.tx,v.ty+n.ty)),i.globalAlpha=f,this.renderNode(h,i),h.needRedraw=!1}}if(a&&!o)return l;var p=t.$children;if(p)for(var g=p.length,m=0;g>m;m++){var x=p[m];if(!(!x.$visible||x.$alpha<=0||x.$maskedObject)){var b=x.$getFilters();b&&b.length>0?l+=this.drawWithFilter(x,i,r,n,s,o):0!==x.$blendMode||x.$mask&&(x.$mask.$parentDisplayList||o)?l+=this.drawWithClip(x,i,r,n,s,o):x.$scrollRect||x.$maskRect?l+=this.drawWithScrollRect(x,i,r,n,s,o):x.isFPS?(i.context.$drawWebGL(),i.$computeDrawCall=!1,this.drawDisplayObject(x,i,r,n,x.$displayList,s,o),i.context.$drawWebGL(),i.$computeDrawCall=!0):l+=this.drawDisplayObject(x,i,r,n,x.$displayList,s,o)}}return l},o.drawWithFilter=function(t,a,s,o,h,l){var u=0,c=t.$getFilters(),d=0!==t.$blendMode;if(d){var f=i[t.$blendMode];f||(f=r)}if(1==c.length&&"colorTransform"==c[0].type&&!t.$children)return d&&a.context.setGlobalCompositeOperation(f),a.context.$filter=c[0],u+=t.$mask&&(t.$mask.$parentDisplayList||l)?this.drawWithClip(t,a,s,o,h,l):t.$scrollRect||t.$maskRect?this.drawWithScrollRect(t,a,s,o,h,l):this.drawDisplayObject(t,a,s,o,t.$displayList,h,l),a.context.$filter=null,d&&a.context.setGlobalCompositeOperation(r),u;var v=e.Matrix.create();v.copyFrom(t.$getConcatenatedMatrix());var p;p=e.sys.Region.create();var g=t.$getOriginalBounds();p.updateRegion(g,v);var m=this.createRenderBuffer(p.width,p.height);m.context.pushBuffer(m),m.setTransform(1,0,0,1,-p.minX,-p.minY);var x=e.Matrix.create().setTo(1,0,0,1,-p.minX,-p.minY);return u+=t.$mask&&(t.$mask.$parentDisplayList||l)?this.drawWithClip(t,m,s,x,p,l):t.$scrollRect||t.$maskRect?this.drawWithScrollRect(t,m,s,x,p,l):this.drawDisplayObject(t,m,s,x,t.$displayList,p,l),e.Matrix.release(x),m.context.popBuffer(),u>0&&(d&&a.context.setGlobalCompositeOperation(f),u++,a.globalAlpha=1,a.setTransform(1,0,0,1,p.minX+o.tx,p.minY+o.ty),a.context.drawTargetWidthFilters(c,m),d&&a.context.setGlobalCompositeOperation(r)),n.push(m),e.sys.Region.release(p),e.Matrix.release(v),u},o.drawWithClip=function(t,a,s,o,h,l){var u=0,c=0!==t.$blendMode;if(c){var d=i[t.$blendMode];d||(d=r)}var f=t.$scrollRect?t.$scrollRect:t.$maskRect,v=t.$mask,v=t.$mask;if(v){var p=v.$getRenderNode();if(p){var g=p.renderMatrix;if(0==g.a&&0==g.b||0==g.c&&0==g.d)return u}}var m,x=e.Matrix.create();if(x.copyFrom(t.$getConcatenatedMatrix()),t.$parentDisplayList){var b,w=t.$parentDisplayList.root;w!==t.$stage&&t.$getConcatenatedMatrixAt(w,x)}if(v){var y=v.$getOriginalBounds();m=e.sys.Region.create();var T=e.Matrix.create();T.copyFrom(v.$getConcatenatedMatrix()),b&&b.$preMultiplyInto(T,T),m.updateRegion(y,T),e.Matrix.release(T)}var E;if(f&&(E=e.sys.Region.create(),E.updateRegion(f,x)),E&&m?(E.intersect(m),e.sys.Region.release(m)):!E&&m&&(E=m),E){if(E.isEmpty()||h&&!h.intersects(E))return e.sys.Region.release(E),e.Matrix.release(x),u}else E=e.sys.Region.create(),y=t.$getOriginalBounds(),E.updateRegion(y,x);var S=!1;if(s){for(var C=s.length,R=0;C>R;R++)if(E.intersects(s[R])){S=!0;break}}else S=!0;if(!S)return e.sys.Region.release(E),e.Matrix.release(x),u;if(v||t.$children&&0!=t.$children.length){var _=this.createRenderBuffer(E.width,E.height);_.context.pushBuffer(_),_.setTransform(1,0,0,1,-E.minX,-E.minY);var L=e.Matrix.create().setTo(1,0,0,1,-E.minX,-E.minY);if(u+=this.drawDisplayObject(t,_,s,L,t.$displayList,E,l),v){var D=this.createRenderBuffer(E.width,E.height);D.context.pushBuffer(D),D.setTransform(1,0,0,1,-E.minX,-E.minY),L=e.Matrix.create().setTo(1,0,0,1,-E.minX,-E.minY);var A=this.drawDisplayObject(v,D,s,L,v.$displayList,E,l);if(D.context.popBuffer(),A>0){u+=A,_.context.setGlobalCompositeOperation("destination-in"),_.setTransform(1,0,0,-1,0,D.height),_.globalAlpha=1;var M=D.rootRenderTarget.width,$=D.rootRenderTarget.height;_.context.drawTexture(D.rootRenderTarget.texture,0,0,M,$,0,0,M,$,M,$),_.context.setGlobalCompositeOperation("source-over")}n.push(D)}if(e.Matrix.release(L),_.context.setGlobalCompositeOperation(r),_.context.popBuffer(),u>0){if(u++,c&&a.context.setGlobalCompositeOperation(d),f){var T=x;_.setTransform(T.a,T.b,T.c,T.d,T.tx-E.minX,T.ty-E.minY),_.context.pushMask(f)}a.globalAlpha=1,a.setTransform(1,0,0,-1,E.minX+o.tx,E.minY+o.ty+_.height);var I=_.rootRenderTarget.width,B=_.rootRenderTarget.height;a.context.drawTexture(_.rootRenderTarget.texture,0,0,I,B,0,0,I,B,I,B),f&&_.context.popMask(),c&&a.context.setGlobalCompositeOperation(r)}return n.push(_),e.sys.Region.release(E),e.Matrix.release(x),u}if(f){var T=x;a.setTransform(T.a,T.b,T.c,T.d,T.tx-E.minX,T.ty-E.minY),a.context.pushMask(f)}return c&&a.context.setGlobalCompositeOperation(d),u+=this.drawDisplayObject(t,a,s,o,t.$displayList,E,null),c&&a.context.setGlobalCompositeOperation(r),f&&a.context.popMask(),e.sys.Region.release(E),e.Matrix.release(x),u},o.drawWithScrollRect=function(t,i,r,n,a,s){var o=0,h=t.$scrollRect?t.$scrollRect:t.$maskRect;if(0==h.width||0==h.height)return o;var l=e.Matrix.create();if(l.copyFrom(t.$getConcatenatedMatrix()),s)t.$getConcatenatedMatrixAt(s,l);else if(t.$parentDisplayList){var u=t.$parentDisplayList.root;u!==t.$stage&&t.$getConcatenatedMatrixAt(u,l)}var c=e.sys.Region.create();if(h.isEmpty()||c.updateRegion(h,l),c.isEmpty()||a&&!a.intersects(c))return e.sys.Region.release(c),e.Matrix.release(l),o;var d=!1;if(r){for(var f=r.length,v=0;f>v;v++)if(c.intersects(r[v])){d=!0;break}}else d=!0;if(!d)return e.sys.Region.release(c),e.Matrix.release(l),o;i.setTransform(l.a,l.b,l.c,l.d,l.tx+n.tx,l.ty+n.ty);var p=i.context,g=!1;if(i.$hasScissor||0!=l.b||0!=l.c)p.pushMask(h);else{var m=h.x,x=h.y,b=h.width,w=h.height;m=m*l.a+l.tx+n.tx,x=x*l.d+l.ty+n.ty,b*=l.a,w*=l.d,p.enableScissor(m,-x-w+i.height,b,w),g=!0}return o+=this.drawDisplayObject(t,i,r,n,t.$displayList,c,s),i.setTransform(l.a,l.b,l.c,l.d,l.tx+n.tx,l.ty+n.ty),g?p.disableScissor():p.popMask(),e.sys.Region.release(c),e.Matrix.release(l),o},o.drawNodeToBuffer=function(e,t,i,r){var n=t;n.context.pushBuffer(n),n.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),this.renderNode(e,t,r),n.context.$drawWebGL(),n.onRenderFinish(),n.context.popBuffer()},o.renderNode=function(e,t,i){switch(e.type){case 1:this.renderBitmap(e,t);break;case 2:this.renderText(e,t);break;case 3:this.renderGraphics(e,t,i);break;case 4:this.renderGroup(e,t);break;case 6:t.globalAlpha=e.drawData[0];break;case 7:this.renderMesh(e,t)}},o.renderBitmap=function(e,t){var n=e.image;if(n){var a=e.drawData,s=a.length,o=0,h=e.matrix,l=e.blendMode,u=e.alpha;if(h&&(t.saveTransform(),t.transform(h.a,h.b,h.c,h.d,h.tx,h.ty)),l&&t.context.setGlobalCompositeOperation(i[l]),u==u){var c=t.globalAlpha;t.globalAlpha*=u}if(e.filter){for(t.context.$filter=e.filter;s>o;)t.context.drawImage(n,a[o++],a[o++],a[o++],a[o++],a[o++],a[o++],a[o++],a[o++],e.imageWidth,e.imageHeight);t.context.$filter=null}else for(;s>o;)t.context.drawImage(n,a[o++],a[o++],a[o++],a[o++],a[o++],a[o++],a[o++],a[o++],e.imageWidth,e.imageHeight);l&&t.context.setGlobalCompositeOperation(r),u==u&&(t.globalAlpha=c),h&&t.restoreTransform()}},o.renderMesh=function(e,t){var i=e.image,r=e.drawData,n=r.length,a=0,s=e.matrix;for(s&&(t.saveTransform(),t.transform(s.a,s.b,s.c,s.d,s.tx,s.ty));n>a;)t.context.drawMesh(i,r[a++],r[a++],r[a++],r[a++],r[a++],r[a++],r[a++],r[a++],e.imageWidth,e.imageHeight,e.uvs,e.vertices,e.indices,e.bounds);s&&t.restoreTransform()},o.renderText=function(i,r){var n=i.width-i.x,a=i.height-i.y;if(0!=i.drawData.length&&(this.canvasRenderBuffer&&this.canvasRenderBuffer.context?i.dirtyRender&&this.canvasRenderBuffer.resize(n,a):(this.canvasRenderer=new e.CanvasRenderer,this.canvasRenderBuffer=new t.CanvasRenderBuffer(n,a)),this.canvasRenderBuffer.context)){if((i.x||i.y)&&(i.dirtyRender&&this.canvasRenderBuffer.context.translate(-i.x,-i.y),r.transform(1,0,0,1,i.x,i.y)),i.dirtyRender){var s=this.canvasRenderBuffer.surface;this.canvasRenderer.renderText(i,this.canvasRenderBuffer.context);var o=i.$texture;o?r.context.updateTexture(o,s):(o=r.context.createTexture(s),i.$texture=o),i.$textureWidth=s.width,i.$textureHeight=s.height}var h=i.$textureWidth,l=i.$textureHeight;r.context.drawTexture(i.$texture,0,0,h,l,0,0,h,l,h,l),(i.x||i.y)&&(i.dirtyRender&&this.canvasRenderBuffer.context.translate(i.x,i.y),r.transform(1,0,0,1,-i.x,-i.y)),i.dirtyRender=!1}},o.renderGraphics=function(i,r,n){var a=i.width,s=i.height;if(!(0>=a||0>=s)&&a&&s&&0!=i.drawData.length&&(this.canvasRenderBuffer&&this.canvasRenderBuffer.context?(i.dirtyRender||n)&&this.canvasRenderBuffer.resize(a,s):(this.canvasRenderer=new e.CanvasRenderer,this.canvasRenderBuffer=new t.CanvasRenderBuffer(a,s)),this.canvasRenderBuffer.context)){(i.x||i.y)&&((i.dirtyRender||n)&&this.canvasRenderBuffer.context.translate(-i.x,-i.y),r.transform(1,0,0,1,i.x,i.y));var o=this.canvasRenderBuffer.surface;if(n){this.canvasRenderer.renderGraphics(i,this.canvasRenderBuffer.context,!0),e.WebGLUtils.deleteWebGLTexture(o);var h=r.context.getWebGLTexture(o);r.context.drawTexture(h,0,0,a,s,0,0,a,s,o.width,o.height)}else{if(i.dirtyRender){this.canvasRenderer.renderGraphics(i,this.canvasRenderBuffer.context);var h=i.$texture;h?r.context.updateTexture(h,o):(h=r.context.createTexture(o),i.$texture=h),i.$textureWidth=o.width,i.$textureHeight=o.height}var l=i.$textureWidth,u=i.$textureHeight;r.context.drawTexture(i.$texture,0,0,l,u,0,0,l,u,l,u)}(i.x||i.y)&&((i.dirtyRender||n)&&this.canvasRenderBuffer.context.translate(i.x,i.y),r.transform(1,0,0,1,-i.x,-i.y)),n||(i.dirtyRender=!1)}},o.renderGroup=function(e,t){for(var i=e.drawData,r=i.length,n=0;r>n;n++){var a=i[n];this.renderNode(a,t)}},o.createRenderBuffer=function(e,i){var r=n.pop();return r?r.resize(e,i):(r=new t.WebGLRenderBuffer(e,i),r.$computeDrawCall=!1),r},a}();t.WebGLRenderer=a,e.registerClass(a,"egret.web.WebGLRenderer",["egret.sys.SystemRenderer"])}(t=e.web||(e.web={}))}(egret||(egret={}));
;/*!libs/modules/game/game.min.js*/
var egret;!function(t){var e=function(t){function e(e,i,r){t.call(this),this._name=e,this._frame=0|i,r&&(this._end=0|r)}__extends(e,t);var i=__define,r=e,s=r.prototype;return i(s,"name",function(){return this._name}),i(s,"frame",function(){return this._frame}),i(s,"end",function(){return this._end}),s.clone=function(){return new e(this._name,this._frame,this._end)},e}(t.EventDispatcher);t.FrameLabel=e,t.registerClass(e,"egret.FrameLabel")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(i){e.call(this),this.$bitmapData=null,this.offsetPoint=t.Point.create(0,0),this.$movieClipData=null,this.frames=null,this.$totalFrames=0,this.frameLabels=null,this.$frameLabelStart=0,this.$frameLabelEnd=0,this.frameEvents=null,this.frameIntervalTime=0,this.$eventPool=null,this.$isPlaying=!1,this.isStopped=!0,this.playTimes=0,this.$currentFrameNum=0,this.$nextFrameNum=0,this.displayedKeyFrameNum=0,this.passedTime=0,this.lastTime=0,this.$smoothing=t.Bitmap.defaultSmoothing,this.$renderNode=new t.sys.BitmapNode,this.setMovieClipData(i)}__extends(i,e);var r=__define,s=i,n=s.prototype;return r(n,"smoothing",function(){return this.$smoothing},function(t){t=!!t,t!=this.$smoothing&&(this.$smoothing=t,this.$invalidate())}),n.$init=function(){this.$reset();var t=this.$movieClipData;t&&t.$isDataValid()&&(this.frames=t.frames,this.$totalFrames=t.numFrames,this.frameLabels=t.labels,this.frameEvents=t.events,this.frameIntervalTime=1e3/t.frameRate,this._initFrame())},n.$reset=function(){this.frames=null,this.playTimes=0,this.$isPlaying=!1,this.setIsStopped(!0),this.$currentFrameNum=0,this.$nextFrameNum=1,this.displayedKeyFrameNum=0,this.passedTime=0,this.$eventPool=[]},n._initFrame=function(){this.$movieClipData.$isTextureValid()&&(this.advanceFrame(),this.constructFrame())},n.$render=function(){var e=this.$bitmapData;if(e){var i=Math.round(this.offsetPoint.x),r=Math.round(this.offsetPoint.y),s=e._bitmapWidth,n=e._bitmapHeight,o=e.$getTextureWidth(),a=e.$getTextureHeight(),h=Math.round(e.$getScaleBitmapWidth()),l=Math.round(e.$getScaleBitmapHeight()),c=e._sourceWidth,u=e._sourceHeight;t.sys.BitmapNode.$updateTextureData(this.$renderNode,e._bitmapData,e._bitmapX,e._bitmapY,s,n,i,r,o,a,h,l,c,u,null,t.BitmapFillMode.SCALE,this.$smoothing)}},n.$measureContentBounds=function(t){var e=this.$bitmapData;if(e){var i=this.offsetPoint.x,r=this.offsetPoint.y,s=e.$getTextureWidth(),n=e.$getTextureHeight();t.setTo(i,r,s,n)}else t.setEmpty()},n.$onAddToStage=function(t,i){e.prototype.$onAddToStage.call(this,t,i),this.$isPlaying&&this.$totalFrames>1&&this.setIsStopped(!1)},n.$onRemoveFromStage=function(){e.prototype.$onRemoveFromStage.call(this),this.setIsStopped(!0)},n.getFrameLabelByName=function(t,e){void 0===e&&(e=!1),e&&(t=t.toLowerCase());var i=this.frameLabels;if(i)for(var r=null,s=0;s<i.length;s++)if(r=i[s],e?r.name.toLowerCase()==t:r.name==t)return r;return null},n.getFrameStartEnd=function(t){var e=this.frameLabels;if(e)for(var i=null,r=0;r<e.length;r++)if(i=e[r],t==i.name){this.$frameLabelStart=i.frame,this.$frameLabelEnd=i.end;break}},n.getFrameLabelByFrame=function(t){var e=this.frameLabels;if(e)for(var i=null,r=0;r<e.length;r++)if(i=e[r],i.frame==t)return i;return null},n.getFrameLabelForFrame=function(t){var e=null,i=null,r=this.frameLabels;if(r)for(var s=0;s<r.length;s++){if(i=r[s],i.frame>t)return e;e=i}return e},n.play=function(t){void 0===t&&(t=0),this.$isPlaying=!0,this.setPlayTimes(t),this.$totalFrames>1&&this.$stage&&this.setIsStopped(!1)},n.stop=function(){this.$isPlaying=!1,this.setIsStopped(!0)},n.prevFrame=function(){this.gotoAndStop(this.$currentFrameNum-1)},n.nextFrame=function(){this.gotoAndStop(this.$currentFrameNum+1)},n.gotoAndPlay=function(e,i){void 0===i&&(i=0),(0==arguments.length||arguments.length>2)&&t.$error(1022,"MovieClip.gotoAndPlay()"),"string"==typeof e?this.getFrameStartEnd(e):(this.$frameLabelStart=0,this.$frameLabelEnd=0),this.play(i),this.gotoFrame(e)},n.gotoAndStop=function(e){1!=arguments.length&&t.$error(1022,"MovieClip.gotoAndStop()"),this.stop(),this.gotoFrame(e)},n.gotoFrame=function(e){var i;"string"==typeof e?i=this.getFrameLabelByName(e).frame:(i=parseInt(e+"",10),i!=e&&t.$error(1022,"Frame Label Not Found")),1>i?i=1:i>this.$totalFrames&&(i=this.$totalFrames),i!=this.$nextFrameNum&&(this.$nextFrameNum=i,this.advanceFrame(),this.constructFrame(),this.handlePendingEvent())},n.advanceTime=function(e){var i=this,r=e-i.lastTime;i.lastTime=e;var s=i.frameIntervalTime,n=i.passedTime+r;i.passedTime=n%s;var o=n/s;if(1>o)return!1;for(var a;o>=1;){if(o--,i.$nextFrameNum++,a=this.frameEvents[i.$nextFrameNum],a&&""!=a&&t.MovieClipEvent.dispatchMovieClipEvent(i,t.MovieClipEvent.FRAME_LABEL,a),i.$nextFrameNum>i.$totalFrames||i.$frameLabelStart>0&&i.$nextFrameNum>i.$frameLabelEnd)if(-1==i.playTimes)i.$eventPool.push(t.Event.LOOP_COMPLETE),i.$nextFrameNum=1;else{if(i.playTimes--,!(i.playTimes>0)){i.$nextFrameNum=i.$totalFrames,i.$eventPool.push(t.Event.COMPLETE),i.stop();break}i.$eventPool.push(t.Event.LOOP_COMPLETE),i.$nextFrameNum=1}i.$currentFrameNum==i.$frameLabelEnd&&(i.$nextFrameNum=i.$frameLabelStart),i.advanceFrame()}return i.constructFrame(),i.handlePendingEvent(),!1},n.advanceFrame=function(){this.$currentFrameNum=this.$nextFrameNum},n.constructFrame=function(){var t=this.$currentFrameNum;this.displayedKeyFrameNum!=t&&(this.$bitmapData=this.$movieClipData.getTextureByFrame(t),this.$movieClipData.$getOffsetByFrame(t,this.offsetPoint),this.$invalidateContentBounds(),this.displayedKeyFrameNum=t)},n.handlePendingEvent=function(){if(0!=this.$eventPool.length){this.$eventPool.reverse();for(var e=this.$eventPool,i=e.length,r=!1,s=!1,n=0;i>n;n++){var o=e.pop();o==t.Event.LOOP_COMPLETE?s=!0:o==t.Event.COMPLETE?r=!0:this.dispatchEventWith(o)}s&&this.dispatchEventWith(t.Event.LOOP_COMPLETE),r&&this.dispatchEventWith(t.Event.COMPLETE)}},r(n,"totalFrames",function(){return this.$totalFrames}),r(n,"currentFrame",function(){return this.$currentFrameNum}),r(n,"currentFrameLabel",function(){var t=this.getFrameLabelByFrame(this.$currentFrameNum);return t&&t.name}),r(n,"currentLabel",function(){var t=this.getFrameLabelForFrame(this.$currentFrameNum);return t?t.name:null}),r(n,"frameRate",function(){return this.$movieClipData.frameRate},function(t){t!=this.$movieClipData.frameRate&&(this.$movieClipData.frameRate=t,this.frameIntervalTime=1e3/this.$movieClipData.frameRate)}),r(n,"isPlaying",function(){return this.$isPlaying}),r(n,"movieClipData",function(){return this.$movieClipData},function(t){this.setMovieClipData(t)}),n.setMovieClipData=function(t){this.$movieClipData!=t&&(this.$movieClipData=t,this.$init())},n.setPlayTimes=function(t){(0>t||t>=1)&&(this.playTimes=0>t?-1:Math.floor(t))},n.setIsStopped=function(e){this.isStopped!=e&&(this.isStopped=e,e?(this.playTimes=0,t.sys.$ticker.$stopTick(this.advanceTime,this)):(this.playTimes=0==this.playTimes?1:this.playTimes,this.lastTime=t.getTimer(),t.sys.$ticker.$startTick(this.advanceTime,this)))},i}(t.DisplayObject);t.MovieClip=e,t.registerClass(e,"egret.MovieClip")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){e.call(this),this.$mcData=null,this.numFrames=1,this.frames=[],this.labels=null,this.events=[],this.frameRate=0,this.textureData=null,this.spriteSheet=null}__extends(i,e);var r=__define,s=i,n=s.prototype;return n.$init=function(t,e,i){this.textureData=e,this.spriteSheet=i,this.setMCData(t)},n.getKeyFrameData=function(t){var e=this.frames[t-1];return e.frame&&(e=this.frames[e.frame-1]),e},n.getTextureByFrame=function(t){var e=this.getKeyFrameData(t);if(e.res){var i=this.getTextureByResName(e.res);return i}return null},n.$getOffsetByFrame=function(t,e){var i=this.getKeyFrameData(t);i.res&&e.setTo(0|i.x,0|i.y)},n.getTextureByResName=function(t){var e=this.spriteSheet.getTexture(t);if(!e){var i=this.textureData[t];e=this.spriteSheet.createTexture(t,i.x,i.y,i.w,i.h)}return e},n.$isDataValid=function(){return this.frames.length>0},n.$isTextureValid=function(){return null!=this.textureData&&null!=this.spriteSheet},n.$fillMCData=function(t){this.frameRate=t.frameRate||24,this.fillFramesData(t.frames),this.fillFrameLabelsData(t.labels),this.fillFrameEventsData(t.events)},n.fillFramesData=function(t){for(var e,i=this.frames,r=t?t.length:0,s=0;r>s;s++){var n=t[s];if(i.push(n),n.duration){var o=parseInt(n.duration);if(o>1){e=i.length;for(var a=1;o>a;a++)i.push({frame:e})}}}this.numFrames=i.length},n.fillFrameLabelsData=function(e){if(e){var i=e.length;if(i>0){this.labels=[];for(var r=0;i>r;r++){var s=e[r];this.labels.push(new t.FrameLabel(s.name,s.frame,s.end))}}}},n.fillFrameEventsData=function(t){if(t){var e=t.length;if(e>0){this.events=[];for(var i=0;e>i;i++){var r=t[i];this.events[r.frame]=r.name}}}},r(n,"mcData",function(){return this.$mcData},function(t){this.setMCData(t)}),n.setMCData=function(t){this.$mcData!=t&&(this.$mcData=t,t&&this.$fillMCData(t))},i}(t.HashObject);t.MovieClipData=e,t.registerClass(e,"egret.MovieClipData")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(t,i){e.call(this),this.enableCache=!0,this.$mcDataCache={},this.$mcDataSet=t,this.setTexture(i)}__extends(i,e);var r=__define,s=i,n=s.prototype;return n.clearCache=function(){this.$mcDataCache={}},n.generateMovieClipData=function(e){if(void 0===e&&(e=""),""==e&&this.$mcDataSet)for(e in this.$mcDataSet.mc)break;if(""==e)return null;var i=this.findFromCache(e,this.$mcDataCache);return i||(i=new t.MovieClipData,this.fillData(e,i,this.$mcDataCache)),i},n.findFromCache=function(t,e){return this.enableCache&&e[t]?e[t]:null},n.fillData=function(t,e,i){if(this.$mcDataSet){var r=this.$mcDataSet.mc[t];r&&(e.$init(r,this.$mcDataSet.res,this.$spriteSheet),this.enableCache&&(i[t]=e))}},r(n,"mcDataSet",function(){return this.$mcDataSet},function(t){this.$mcDataSet=t}),r(n,"texture",void 0,function(t){this.setTexture(t)}),r(n,"spriteSheet",function(){return this.$spriteSheet}),n.setTexture=function(e){this.$spriteSheet=e?new t.SpriteSheet(e):null},i}(t.EventDispatcher);t.MovieClipDataFactory=e,t.registerClass(e,"egret.MovieClipDataFactory")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(t,i,r,s){void 0===i&&(i=!1),void 0===r&&(r=!1),void 0===s&&(s=null),e.call(this,t,i,r),this.frameLabel=null,this.frameLabel=s}__extends(i,e);var r=i;return r.prototype,i.dispatchMovieClipEvent=function(e,r,s){void 0===s&&(s=null);var n=t.Event.create(i,r);n.frameLabel=s;var o=e.dispatchEvent(n);return t.Event.release(n),o},i.FRAME_LABEL="frame_label",i}(t.Event);t.MovieClipEvent=e,t.registerClass(e,"egret.MovieClipEvent")}(egret||(egret={}));var egret;!function(t){var e=function(){function e(){t.$error(1014)}var i=e;return i.prototype,e.get=function(t){return-1>t&&(t=-1),t>1&&(t=1),function(e){return 0==t?e:0>t?e*(e*-t+1+t):e*((2-e)*t+(1-t))}},e.getPowOut=function(t){return function(e){return 1-Math.pow(1-e,t)}},e.quintOut=e.getPowOut(5),e.quartOut=e.getPowOut(4),e}();t.ScrollEase=e,t.registerClass(e,"egret.ScrollEase");var i=function(e){function i(t,i,r){e.call(this),this._target=null,this._useTicks=!1,this.ignoreGlobalPause=!1,this.loop=!1,this.pluginData=null,this._steps=null,this._actions=null,this.paused=!1,this.duration=0,this._prevPos=-1,this.position=null,this._prevPosition=0,this._stepPosition=0,this.passive=!1,this.initialize(t,i,r)}__extends(i,e);var r=i,s=r.prototype;return i.get=function(t,e,r,s){return void 0===e&&(e=null),void 0===r&&(r=null),void 0===s&&(s=!1),s&&i.removeTweens(t),new i(t,e,r)},i.removeTweens=function(t){if(t.tween_count){for(var e=i._tweens,r=e.length-1;r>=0;r--)e[r]._target==t&&(e[r].paused=!0,e.splice(r,1));t.tween_count=0}},i.tick=function(t,e){void 0===e&&(e=!1);var r=t-i._lastTime;i._lastTime=t;for(var s=i._tweens.concat(),n=s.length-1;n>=0;n--){var o=s[n];e&&!o.ignoreGlobalPause||o.paused||o.tick(o._useTicks?1:r)}return!1},i._register=function(e,r){var s=e._target,n=i._tweens;if(r)s&&(s.tween_count=s.tween_count>0?s.tween_count+1:1),n.push(e),i._inited||(i._lastTime=t.getTimer(),t.sys.$ticker.$startTick(i.tick,null),i._inited=!0);else{s&&s.tween_count--;for(var o=n.length;o--;)if(n[o]==e)return void n.splice(o,1)}},s.initialize=function(t,e,r){this._target=t,e&&(this._useTicks=e.useTicks,this.ignoreGlobalPause=e.ignoreGlobalPause,this.loop=e.loop,e.onChange&&this.addEventListener("change",e.onChange,e.onChangeObj),e.override&&i.removeTweens(t)),this.pluginData=r||{},this._curQueueProps={},this._initQueueProps={},this._steps=[],this._actions=[],e&&e.paused?this.paused=!0:i._register(this,!0),e&&null!=e.position&&this.setPosition(e.position)},s.setPosition=function(t,e){void 0===e&&(e=1),0>t&&(t=0);var i=t,r=!1;if(i>=this.duration&&(this.loop?i%=this.duration:(i=this.duration,r=!0)),i==this._prevPos)return r;var s=this._prevPos;if(this.position=this._prevPos=i,this._prevPosition=t,this._target)if(r)this._updateTargetProps(null,1);else if(this._steps.length>0){for(var n=0,o=this._steps.length;o>n&&!(this._steps[n].t>i);n++);var a=this._steps[n-1];this._updateTargetProps(a,(this._stepPosition=i-a.t)/a.d)}return r&&this.setPaused(!0),0!=e&&this._actions.length>0&&(this._useTicks?this._runActions(i,i):1==e&&s>i?(s!=this.duration&&this._runActions(s,this.duration),this._runActions(0,i,!0)):this._runActions(s,i)),this.dispatchEventWith("change"),r},s._runActions=function(t,e,i){void 0===i&&(i=!1);var r=t,s=e,n=-1,o=this._actions.length,a=1;for(t>e&&(r=e,s=t,n=o,o=a=-1);(n+=a)!=o;){var h=this._actions[n],l=h.t;(l==s||l>r&&s>l||i&&l==t)&&h.f.apply(h.o,h.p)}},s._updateTargetProps=function(t,e){var r,s,n,o,a,h;if(t||1!=e){if(this.passive=!!t.v,this.passive)return;t.e&&(e=t.e(e,0,1,1)),r=t.p0,s=t.p1}else this.passive=!1,r=s=this._curQueueProps;for(var l in this._initQueueProps){null==(o=r[l])&&(r[l]=o=this._initQueueProps[l]),null==(a=s[l])&&(s[l]=a=o),n=o==a||0==e||1==e||"number"!=typeof o?1==e?a:o:o+(a-o)*e;var c=!1;if(h=i._plugins[l])for(var u=0,_=h.length;_>u;u++){var p=h[u].tween(this,l,n,r,s,e,!!t&&r==s,!t);p==i.IGNORE?c=!0:n=p}c||(this._target[l]=n)}},s.setPaused=function(t){return this.paused=t,i._register(this,!t),this},s._cloneProps=function(t){var e={};for(var i in t)e[i]=t[i];return e},s._addStep=function(t){return t.d>0&&(this._steps.push(t),t.t=this.duration,this.duration+=t.d),this},s._appendQueueProps=function(t){var e,r,s,n,o;for(var a in t)if(void 0===this._initQueueProps[a]){if(r=this._target[a],e=i._plugins[a])for(s=0,n=e.length;n>s;s++)r=e[s].init(this,a,r);this._initQueueProps[a]=this._curQueueProps[a]=void 0===r?null:r}else r=this._curQueueProps[a];for(var a in t){if(r=this._curQueueProps[a],e=i._plugins[a])for(o=o||{},s=0,n=e.length;n>s;s++)e[s].step&&e[s].step(this,a,r,t[a],o);this._curQueueProps[a]=t[a]}return o&&this._appendQueueProps(o),this._curQueueProps},s._addAction=function(t){return t.t=this.duration,this._actions.push(t),this},s.to=function(t,e,i){return void 0===i&&(i=void 0),(isNaN(e)||0>e)&&(e=0),this._addStep({d:e||0,p0:this._cloneProps(this._curQueueProps),e:i,p1:this._cloneProps(this._appendQueueProps(t))})},s.call=function(t,e,i){return void 0===e&&(e=void 0),void 0===i&&(i=void 0),this._addAction({f:t,p:i?i:[],o:e?e:this._target})},s.tick=function(t){this.paused||this.setPosition(this._prevPosition+t)},i._tweens=[],i.IGNORE={},i._plugins={},i._inited=!1,i._lastTime=0,i}(t.EventDispatcher);t.ScrollTween=i,t.registerClass(i,"egret.ScrollTween")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(i){void 0===i&&(i=null),e.call(this),this.scrollBeginThreshold=10,this.scrollSpeed=1,this._content=null,this.delayTouchBeginEvent=null,this.touchBeginTimer=null,this.touchEnabled=!0,this._ScrV_Props_=new t.ScrollViewProperties,i&&this.setContent(i)}__extends(i,e);var r=__define,s=i,n=s.prototype;return r(n,"bounces",function(){return this._ScrV_Props_._bounces},function(t){this._ScrV_Props_._bounces=!!t}),n.setContent=function(t){this._content!==t&&(this.removeContent(),t&&(this._content=t,e.prototype.addChild.call(this,t),this._addEvents()))},n.removeContent=function(){this._content&&(this._removeEvents(),e.prototype.removeChildAt.call(this,0)),this._content=null},r(n,"verticalScrollPolicy",function(){return this._ScrV_Props_._verticalScrollPolicy},function(t){t!=this._ScrV_Props_._verticalScrollPolicy&&(this._ScrV_Props_._verticalScrollPolicy=t)}),r(n,"horizontalScrollPolicy",function(){return this._ScrV_Props_._horizontalScrollPolicy},function(t){t!=this._ScrV_Props_._horizontalScrollPolicy&&(this._ScrV_Props_._horizontalScrollPolicy=t)}),r(n,"scrollLeft",function(){return this._ScrV_Props_._scrollLeft},function(t){t!=this._ScrV_Props_._scrollLeft&&(this._ScrV_Props_._scrollLeft=t,this._validatePosition(!1,!0),this._updateContentPosition())}),r(n,"scrollTop",function(){return this._ScrV_Props_._scrollTop},function(t){t!=this._ScrV_Props_._scrollTop&&(this._ScrV_Props_._scrollTop=t,this._validatePosition(!0,!1),this._updateContentPosition())}),n.setScrollPosition=function(t,e,i){if(void 0===i&&(i=!1),!(i&&0==t&&0==e||!i&&this._ScrV_Props_._scrollTop==t&&this._ScrV_Props_._scrollLeft==e)){var r=this._ScrV_Props_._scrollTop,s=this._ScrV_Props_._scrollLeft;if(i){var n=this.getMaxScrollLeft(),o=this.getMaxScrollTop();(0>=r||r>=o)&&(t/=2),(0>=s||s>=n)&&(e/=2);var a=r+t,h=s+e,l=this._ScrV_Props_._bounces;l||((0>=a||a>=o)&&(a=Math.max(0,Math.min(a,o))),(0>=h||h>=n)&&(h=Math.max(0,Math.min(h,n)))),this._ScrV_Props_._scrollTop=a,this._ScrV_Props_._scrollLeft=h}else this._ScrV_Props_._scrollTop=t,this._ScrV_Props_._scrollLeft=e;this._validatePosition(!0,!0),this._updateContentPosition()}},n._validatePosition=function(t,e){if(void 0===t&&(t=!1),void 0===e&&(e=!1),t){var i=this.height,r=this._getContentHeight();this._ScrV_Props_._scrollTop=Math.max(this._ScrV_Props_._scrollTop,(0-i)/2),this._ScrV_Props_._scrollTop=Math.min(this._ScrV_Props_._scrollTop,r>i?r-i/2:i/2)}if(e){var s=this.width,n=this._getContentWidth();this._ScrV_Props_._scrollLeft=Math.max(this._ScrV_Props_._scrollLeft,(0-s)/2),this._ScrV_Props_._scrollLeft=Math.min(this._ScrV_Props_._scrollLeft,n>s?n-s/2:s/2)}},n.$setWidth=function(t){if(this.$getExplicitWidth()==t)return!1;var i=e.prototype.$setWidth.call(this,t);return this._updateContentPosition(),i},n.$setHeight=function(t){return this.$getExplicitHeight()==t?!1:(e.prototype.$setHeight.call(this,t),this._updateContentPosition(),!0)},n._updateContentPosition=function(){var e=this.height,i=this.width;this.scrollRect=new t.Rectangle(Math.round(this._ScrV_Props_._scrollLeft),Math.round(this._ScrV_Props_._scrollTop),i,e),this.dispatchEvent(new t.Event(t.Event.CHANGE))},n._checkScrollPolicy=function(){var t=this._ScrV_Props_._horizontalScrollPolicy,e=this.__checkScrollPolicy(t,this._getContentWidth(),this.width);this._ScrV_Props_._hCanScroll=e;var i=this._ScrV_Props_._verticalScrollPolicy,r=this.__checkScrollPolicy(i,this._getContentHeight(),this.height);return this._ScrV_Props_._vCanScroll=r,e||r},n.__checkScrollPolicy=function(t,e,i){return"on"==t?!0:"off"==t?!1:e>i},n._addEvents=function(){this.addEventListener(t.TouchEvent.TOUCH_BEGIN,this._onTouchBegin,this),this.addEventListener(t.TouchEvent.TOUCH_BEGIN,this._onTouchBeginCapture,this,!0),this.addEventListener(t.TouchEvent.TOUCH_END,this._onTouchEndCapture,this,!0)},n._removeEvents=function(){this.removeEventListener(t.TouchEvent.TOUCH_BEGIN,this._onTouchBegin,this),this.removeEventListener(t.TouchEvent.TOUCH_BEGIN,this._onTouchBeginCapture,this,!0),this.removeEventListener(t.TouchEvent.TOUCH_END,this._onTouchEndCapture,this,!0)},n._onTouchBegin=function(e){if(!e.$isDefaultPrevented){var i=this._checkScrollPolicy();i&&(this._ScrV_Props_._touchStartPosition.x=e.stageX,this._ScrV_Props_._touchStartPosition.y=e.stageY,(this._ScrV_Props_._isHTweenPlaying||this._ScrV_Props_._isVTweenPlaying)&&this._onScrollFinished(),this._tempStage=this.stage,this._tempStage.addEventListener(t.TouchEvent.TOUCH_MOVE,this._onTouchMove,this),this._tempStage.addEventListener(t.TouchEvent.TOUCH_END,this._onTouchEnd,this),this._tempStage.addEventListener(t.TouchEvent.LEAVE_STAGE,this._onTouchEnd,this),this.addEventListener(t.Event.ENTER_FRAME,this._onEnterFrame,this),this._logTouchEvent(e),e.preventDefault())}},n._onTouchBeginCapture=function(e){var i=this._checkScrollPolicy();if(i){for(var r=e.target;r!=this;){if("_checkScrollPolicy"in r&&(i=r._checkScrollPolicy()))return;r=r.parent}e.stopPropagation();var s=this.cloneTouchEvent(e);this.delayTouchBeginEvent=s,this.touchBeginTimer||(this.touchBeginTimer=new t.Timer(100,1),this.touchBeginTimer.addEventListener(t.TimerEvent.TIMER_COMPLETE,this._onTouchBeginTimer,this)),this.touchBeginTimer.start(),this._onTouchBegin(e)}},n._onTouchEndCapture=function(e){var i=this;if(this.delayTouchBeginEvent){this._onTouchBeginTimer(),e.stopPropagation();var r=this.cloneTouchEvent(e);t.callLater(function(){i.stage&&i.dispatchPropagationEvent(r)},this)}},n._onTouchBeginTimer=function(){this.touchBeginTimer.stop();var t=this.delayTouchBeginEvent;this.delayTouchBeginEvent=null,this.stage&&this.dispatchPropagationEvent(t)},n.dispatchPropagationEvent=function(e){for(var i=e.$target,r=this.$getPropagationList(i),s=r.length,n=.5*r.length,o=-1,a=0;s>a;a++)if(r[a]===this._content){o=a;break}r.splice(0,o+1),n-=o+1,this.$dispatchPropagationEvent(e,r,n),t.Event.release(e)},n._onTouchMove=function(t){if(this._ScrV_Props_._lastTouchPosition.x!=t.stageX||this._ScrV_Props_._lastTouchPosition.y!=t.stageY){if(!this._ScrV_Props_._scrollStarted){var e=t.stageX-this._ScrV_Props_._touchStartPosition.x,i=t.stageY-this._ScrV_Props_._touchStartPosition.y,r=Math.sqrt(e*e+i*i);if(r<this.scrollBeginThreshold)return void this._logTouchEvent(t)}this._ScrV_Props_._scrollStarted=!0,this.delayTouchBeginEvent&&(this.delayTouchBeginEvent=null,this.touchBeginTimer.stop()),this.touchChildren=!1;var s=this._getPointChange(t);this.setScrollPosition(s.y,s.x,!0),this._calcVelocitys(t),this._logTouchEvent(t)}},n._onTouchEnd=function(){this.touchChildren=!0,this._ScrV_Props_._scrollStarted=!1,this._tempStage.removeEventListener(t.TouchEvent.TOUCH_MOVE,this._onTouchMove,this),this._tempStage.removeEventListener(t.TouchEvent.TOUCH_END,this._onTouchEnd,this),this._tempStage.removeEventListener(t.TouchEvent.LEAVE_STAGE,this._onTouchEnd,this),this.removeEventListener(t.Event.ENTER_FRAME,this._onEnterFrame,this),this._moveAfterTouchEnd()},n._onEnterFrame=function(){var e=t.getTimer();e-this._ScrV_Props_._lastTouchTime>100&&e-this._ScrV_Props_._lastTouchTime<300&&this._calcVelocitys(this._ScrV_Props_._lastTouchEvent)},n._logTouchEvent=function(e){this._ScrV_Props_._lastTouchPosition.x=e.stageX,this._ScrV_Props_._lastTouchPosition.y=e.stageY,this._ScrV_Props_._lastTouchEvent=this.cloneTouchEvent(e),this._ScrV_Props_._lastTouchTime=t.getTimer()},n._getPointChange=function(t){return{x:this._ScrV_Props_._hCanScroll===!1?0:this._ScrV_Props_._lastTouchPosition.x-t.stageX,y:this._ScrV_Props_._vCanScroll===!1?0:this._ScrV_Props_._lastTouchPosition.y-t.stageY}},n._calcVelocitys=function(e){var i=t.getTimer();if(0==this._ScrV_Props_._lastTouchTime)return void(this._ScrV_Props_._lastTouchTime=i);var r=this._getPointChange(e),s=i-this._ScrV_Props_._lastTouchTime;r.x/=s,r.y/=s,this._ScrV_Props_._velocitys.push(r),this._ScrV_Props_._velocitys.length>5&&this._ScrV_Props_._velocitys.shift(),this._ScrV_Props_._lastTouchPosition.x=e.stageX,this._ScrV_Props_._lastTouchPosition.y=e.stageY},n._getContentWidth=function(){return this._content.$getExplicitWidth()||this._content.width},n._getContentHeight=function(){return this._content.$getExplicitHeight()||this._content.height},n.getMaxScrollLeft=function(){var t=this._getContentWidth()-this.width;return Math.max(0,t)},n.getMaxScrollTop=function(){var t=this._getContentHeight()-this.height;return Math.max(0,t)},n._moveAfterTouchEnd=function(){if(0!=this._ScrV_Props_._velocitys.length){for(var t={x:0,y:0},e=0,r=0;r<this._ScrV_Props_._velocitys.length;r++){var s=this._ScrV_Props_._velocitys[r],n=i.weight[r];t.x+=s.x*n,t.y+=s.y*n,e+=n}this._ScrV_Props_._velocitys.length=0,this.scrollSpeed<=0&&(this.scrollSpeed=1);var o=t.x/e*this.scrollSpeed,a=t.y/e*this.scrollSpeed,h=Math.abs(o),l=Math.abs(a),c=this.getMaxScrollLeft(),u=this.getMaxScrollTop(),_=h>.02?this.getAnimationDatas(o,this._ScrV_Props_._scrollLeft,c):{position:this._ScrV_Props_._scrollLeft,duration:1},p=l>.02?this.getAnimationDatas(a,this._ScrV_Props_._scrollTop,u):{position:this._ScrV_Props_._scrollTop,duration:1};this.setScrollLeft(_.position,_.duration),this.setScrollTop(p.position,p.duration)}},n.onTweenFinished=function(t){t==this._ScrV_Props_._vScrollTween&&(this._ScrV_Props_._isVTweenPlaying=!1),t==this._ScrV_Props_._hScrollTween&&(this._ScrV_Props_._isHTweenPlaying=!1),0==this._ScrV_Props_._isHTweenPlaying&&0==this._ScrV_Props_._isVTweenPlaying&&this._onScrollFinished()},n._onScrollStarted=function(){},n._onScrollFinished=function(){t.ScrollTween.removeTweens(this),this._ScrV_Props_._hScrollTween=null,this._ScrV_Props_._vScrollTween=null,this._ScrV_Props_._isHTweenPlaying=!1,this._ScrV_Props_._isVTweenPlaying=!1,this.dispatchEvent(new t.Event(t.Event.COMPLETE))},n.setScrollTop=function(e,i){void 0===i&&(i=0);var r=Math.min(this.getMaxScrollTop(),Math.max(e,0));if(0==i)return void(this.scrollTop=r);0==this._ScrV_Props_._bounces&&(e=r);var s=t.ScrollTween.get(this).to({scrollTop:e},i,t.ScrollEase.quartOut);r!=e&&s.to({scrollTop:r},300,t.ScrollEase.quintOut),this._ScrV_Props_._isVTweenPlaying=!0,this._ScrV_Props_._vScrollTween=s,s.call(this.onTweenFinished,this,[s]),this._ScrV_Props_._isHTweenPlaying||this._onScrollStarted()},n.setScrollLeft=function(e,i){void 0===i&&(i=0);var r=Math.min(this.getMaxScrollLeft(),Math.max(e,0));if(0==i)return void(this.scrollLeft=r);0==this._ScrV_Props_._bounces&&(e=r);var s=t.ScrollTween.get(this).to({scrollLeft:e},i,t.ScrollEase.quartOut);r!=e&&s.to({scrollLeft:r},300,t.ScrollEase.quintOut),this._ScrV_Props_._isHTweenPlaying=!0,this._ScrV_Props_._hScrollTween=s,s.call(this.onTweenFinished,this,[s]),this._ScrV_Props_._isVTweenPlaying||this._onScrollStarted()},n.getAnimationDatas=function(t,e,i){var r=Math.abs(t),s=.95,n=0,o=.998,a=.02,h=e+500*t;if(0>h||h>i)for(h=e;Math.abs(t)!=1/0&&Math.abs(t)>a;)h+=t,t*=0>h||h>i?o*s:o,n++;else n=500*-Math.log(a/r);var l={position:Math.min(i+50,Math.max(h,-50)),duration:n};return l},n.cloneTouchEvent=function(e){var i=new t.TouchEvent(e.type,e.bubbles,e.cancelable);return i.touchPointID=e.touchPointID,i.$stageX=e.stageX,i.$stageY=e.stageY,i.touchDown=e.touchDown,i.$isDefaultPrevented=!1,i.$target=e.target,i},n.throwNotSupportedError=function(){t.$error(1023)},n.addChild=function(){return this.throwNotSupportedError(),null},n.addChildAt=function(){return this.throwNotSupportedError(),null},n.removeChild=function(){return this.throwNotSupportedError(),null},n.removeChildAt=function(){return this.throwNotSupportedError(),null},n.setChildIndex=function(){this.throwNotSupportedError()},n.swapChildren=function(){this.throwNotSupportedError()},n.swapChildrenAt=function(){this.throwNotSupportedError()},i.weight=[1,1.33,1.66,2,2.33],i}(t.DisplayObjectContainer);t.ScrollView=e,t.registerClass(e,"egret.ScrollView")}(egret||(egret={}));var egret;!function(t){var e=function(){function e(){this._verticalScrollPolicy="auto",this._horizontalScrollPolicy="auto",this._scrollLeft=0,this._scrollTop=0,this._hCanScroll=!1,this._vCanScroll=!1,this._lastTouchPosition=new t.Point(0,0),this._touchStartPosition=new t.Point(0,0),this._scrollStarted=!1,this._lastTouchTime=0,this._lastTouchEvent=null,this._velocitys=[],this._isHTweenPlaying=!1,this._isVTweenPlaying=!1,this._hScrollTween=null,this._vScrollTween=null,this._bounces=!0}var i=e;return i.prototype,e}();t.ScrollViewProperties=e,t.registerClass(e,"egret.ScrollViewProperties")}(egret||(egret={}));var egret;!function(t){function e(e){var i=e.url;return-1==i.indexOf("?")&&e.method==t.URLRequestMethod.GET&&e.data&&e.data instanceof t.URLVariables&&(i=i+"?"+e.data.toString()),i}t.$getUrl=e}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(i){void 0===i&&(i=null),e.call(this),this.dataFormat=t.URLLoaderDataFormat.TEXT,this.data=null,this._request=null,this._status=-1,i&&this.load(i)}__extends(i,e);var r=i,s=r.prototype;return s.load=function(e){this._request=e,this.data=null,t.NetContext.getNetContext().proceed(this)},s.__recycle=function(){this._request=null,this.data=null},i}(t.EventDispatcher);t.URLLoader=e,t.registerClass(e,"egret.URLLoader")}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}var e=t;return e.prototype,t.BINARY="binary",t.TEXT="text",t.VARIABLES="variables",t.TEXTURE="texture",t.SOUND="sound",t}();t.URLLoaderDataFormat=e,t.registerClass(e,"egret.URLLoaderDataFormat")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(i){void 0===i&&(i=null),e.call(this),this.data=null,this.method=t.URLRequestMethod.GET,this.url="",this.requestHeaders=[],this.url=i}__extends(i,e);var r=i;return r.prototype,i}(t.HashObject);t.URLRequest=e,t.registerClass(e,"egret.URLRequest")}(egret||(egret={}));var egret;!function(t){var e=function(){function t(t,e){this.name="",this.value="",this.name=t,this.value=e}var e=t;return e.prototype,t}();t.URLRequestHeader=e,t.registerClass(e,"egret.URLRequestHeader")}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}var e=t;return e.prototype,t.GET="get",t.POST="post",t}();t.URLRequestMethod=e,t.registerClass(e,"egret.URLRequestMethod")}(egret||(egret={}));var egret;!function(t){var e=function(t){function e(e){void 0===e&&(e=null),t.call(this),this.variables=null,null!==e&&this.decode(e)}__extends(e,t);var i=e,r=i.prototype;return r.decode=function(t){this.variables||(this.variables={}),t=t.split("+").join(" ");for(var e,i=/[?&]?([^=]+)=([^&]*)/g;e=i.exec(t);){var r=decodeURIComponent(e[1]),s=decodeURIComponent(e[2]);if(r in this.variables!=0){var n=this.variables[r];n instanceof Array?n.push(s):this.variables[r]=[n,s]}else this.variables[r]=s}},r.toString=function(){if(!this.variables)return"";var t=this.variables,e=[];for(var i in t)e.push(this.encodeValue(i,t[i]));return e.join("&")},r.encodeValue=function(t,e){return e instanceof Array?this.encodeArray(t,e):encodeURIComponent(t)+"="+encodeURIComponent(e)},r.encodeArray=function(t,e){return t?0==e.length?encodeURIComponent(t)+"=":e.map(function(e){return encodeURIComponent(t)+"="+encodeURIComponent(e)}).join("&"):""},e}(t.HashObject);t.URLVariables=e,t.registerClass(e,"egret.URLVariables")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){e.call(this),this._timeScale=1,this._paused=!1,this._callIndex=-1,this._lastTime=0,this.callBackList=[],null!=i.instance,t.sys.$ticker.$startTick(this.update,this),this._lastTime=t.getTimer()}__extends(i,e);var r=i,s=r.prototype;return s.update=function(t){var e=t-this._lastTime;if(this._lastTime=t,this._paused)return!1;var i=e*this._timeScale;for(this._callList=this.callBackList.concat(),this._callIndex=0;this._callIndex<this._callList.length;this._callIndex++){var r=this._callList[this._callIndex];r.listener.call(r.thisObject,i)}return this._callIndex=-1,this._callList=null,!1},s.register=function(t,e,i){void 0===i&&(i=0),this.$insertEventBin(this.callBackList,"",t,e,!1,i,!1)},s.unregister=function(t,e){this.$removeEventBin(this.callBackList,t,e)},s.setTimeScale=function(t){this._timeScale=t},s.getTimeScale=function(){return this._timeScale},s.pause=function(){this._paused=!0},s.resume=function(){this._paused=!1},i.getInstance=function(){return null==i.instance&&(i.instance=new i),i.instance},i}(t.EventDispatcher);t.Ticker=e,t.registerClass(e,"egret.Ticker")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){e.call(this)}__extends(i,e);var r=__define,s=i,n=s.prototype;return r(n,"stage",function(){return t.sys.$TempStage}),r(i,"runtimeType",function(){return t.$warn(1041),i._runtimeType}),n.run=function(){},r(i,"instance",function(){return null==i._instance&&(i._instance=new i),i._instance
}),i.deviceType=null,i.DEVICE_PC="web",i.DEVICE_MOBILE="native",i.RUNTIME_HTML5="runtimeHtml5",i.RUNTIME_NATIVE="runtimeNative",i}(t.EventDispatcher);t.MainContext=e,t.registerClass(e,"egret.MainContext")}(egret||(egret={}));var testDeviceType1=function(){if(!this.navigator)return!0;var t=navigator.userAgent.toLowerCase();return-1!=t.indexOf("mobile")||-1!=t.indexOf("android")},testRuntimeType1=function(){return this.navigator?!0:!1};egret.MainContext.deviceType=testDeviceType1()?egret.MainContext.DEVICE_MOBILE:egret.MainContext.DEVICE_PC,egret.MainContext._runtimeType=testRuntimeType1()?egret.MainContext.RUNTIME_HTML5:egret.MainContext.RUNTIME_NATIVE,delete testDeviceType1,delete testRuntimeType1;var egret;!function(t){var e=function(e){function i(t){void 0===t&&(t=300),e.call(this),this.objectPool=[],this._length=0,1>t&&(t=1),this.autoDisposeTime=t,this.frameCount=0}__extends(i,e);var r=__define,s=i,n=s.prototype;return i.$init=function(){t.sys.$ticker.$startTick(i.onUpdate,i)},i.onUpdate=function(){for(var t=i._callBackList,e=t.length-1;e>=0;e--)t[e].$checkFrame();return!1},n.$checkFrame=function(){this.frameCount--,this.frameCount<=0&&this.dispose()},r(n,"length",function(){return this._length}),n.push=function(t){var e=this.objectPool;-1==e.indexOf(t)&&(e.push(t),t.__recycle&&t.__recycle(),this._length++,0==this.frameCount&&(this.frameCount=this.autoDisposeTime,i._callBackList.push(this)))},n.pop=function(){return 0==this._length?null:(this._length--,this.objectPool.pop())},n.dispose=function(){this._length>0&&(this.objectPool=[],this._length=0),this.frameCount=0;var t=i._callBackList,e=t.indexOf(this);-1!=e&&t.splice(e,1)},i._callBackList=[],i}(t.HashObject);t.Recycler=e,t.registerClass(e,"egret.Recycler"),e.$init()}(egret||(egret={}));var egret;!function(t){function e(e,i,h){for(var l=[],c=3;c<arguments.length;c++)l[c-3]=arguments[c];var u={listener:e,thisObject:i,delay:h,originDelay:h,params:l};return o++,1==o&&(a=t.getTimer(),t.sys.$ticker.$startTick(r,null)),n++,s[n]=u,n}function i(e){s[e]&&(o--,delete s[e],0==o&&t.sys.$ticker.$stopTick(r,null))}function r(t){var e=t-a;a=t;for(var i in s){var r=s[i];r.delay-=e,r.delay<=0&&(r.delay=r.originDelay,r.listener.apply(r.thisObject,r.params))}return!1}var s={},n=0,o=0,a=0;t.setInterval=e,t.clearInterval=i}(egret||(egret={}));var egret;!function(t){function e(e,i,h){for(var l=[],c=3;c<arguments.length;c++)l[c-3]=arguments[c];var u={listener:e,thisObject:i,delay:h,params:l};return o++,1==o&&t.sys.$ticker&&(a=t.getTimer(),t.sys.$ticker.$startTick(r,null)),n++,s[n]=u,n}function i(e){s[e]&&(o--,delete s[e],0==o&&t.sys.$ticker&&t.sys.$ticker.$stopTick(r,null))}function r(t){var e=t-a;a=t;for(var r in s){var n=r,o=s[n];o.delay-=e,o.delay<=0&&(o.listener.apply(o.thisObject,o.params),i(n))}return!1}var s={},n=0,o=0,a=0;t.setTimeout=e,t.clearTimeout=i}(egret||(egret={}));
;/*!libs/modules/game/game.web.min.js*/
var egret;!function(e){var t;!function(t){var n=function(t){function n(){t.call(this)}__extends(n,t);var r=n,a=r.prototype;return a.proceed=function(t){function n(e){t.dispatchEvent(e)}function r(e){o(),t.dispatchEvent(e)}function a(){switch(o(),t.dataFormat){case e.URLLoaderDataFormat.VARIABLES:t.data=new e.URLVariables(d.response);break;default:t.data=d.response}window.setTimeout(function(){e.Event.dispatchEvent(t,e.Event.COMPLETE)},0)}function o(){d.removeEventListener(e.Event.COMPLETE,a,i),d.removeEventListener(e.IOErrorEvent.IO_ERROR,r,i),d.removeEventListener(e.ProgressEvent.PROGRESS,n,i)}var i=this;if(t.dataFormat==e.URLLoaderDataFormat.TEXTURE)return void this.loadTexture(t);if(t.dataFormat==e.URLLoaderDataFormat.SOUND)return void this.loadSound(t);var s=t._request,E=i.getVirtualUrl(e.$getUrl(s)),d=new e.HttpRequest;if(d.addEventListener(e.Event.COMPLETE,a,this),d.addEventListener(e.IOErrorEvent.IO_ERROR,r,this),d.addEventListener(e.ProgressEvent.PROGRESS,n,this),d.open(E,s.method),d.responseType=this.getResponseType(t.dataFormat),s.method!=e.URLRequestMethod.GET&&s.data)if(s.data instanceof e.URLVariables){d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var v=s.data;d.send(v.toString())}else d.setRequestHeader("Content-Type","multipart/form-data"),d.send(s.data);else d.send()},a.getResponseType=function(t){switch(t){case e.URLLoaderDataFormat.TEXT:case e.URLLoaderDataFormat.VARIABLES:return e.URLLoaderDataFormat.TEXT;case e.URLLoaderDataFormat.BINARY:return"arraybuffer";default:return t}},a.loadSound=function(t){function n(e){t.dispatchEvent(e)}function r(e){o(),t.dispatchEvent(e)}function a(){o(),t.data=E,window.setTimeout(function(){t.dispatchEventWith(e.Event.COMPLETE)},0)}function o(){E.removeEventListener(e.Event.COMPLETE,a,i),E.removeEventListener(e.IOErrorEvent.IO_ERROR,r,i),E.removeEventListener(e.ProgressEvent.PROGRESS,n,i)}var i=this,s=this.getVirtualUrl(t._request.url),E=new e.Sound;E.addEventListener(e.Event.COMPLETE,a,i),E.addEventListener(e.IOErrorEvent.IO_ERROR,r,i),E.addEventListener(e.ProgressEvent.PROGRESS,n,i),E.load(s)},a.loadTexture=function(t){function n(e){t.dispatchEvent(e)}function r(e){o(),t.dispatchEvent(e)}function a(){o();var n=E.data;n.source.setAttribute("bitmapSrc",s);var r=new e.Texture;r._setBitmapData(n),t.data=r,window.setTimeout(function(){t.dispatchEventWith(e.Event.COMPLETE)},i)}function o(){E.removeEventListener(e.Event.COMPLETE,a,i),E.removeEventListener(e.IOErrorEvent.IO_ERROR,r,i),E.removeEventListener(e.ProgressEvent.PROGRESS,n,i)}var i=this,s=this.getVirtualUrl(t._request.url),E=new e.ImageLoader;E.addEventListener(e.Event.COMPLETE,a,i),E.addEventListener(e.IOErrorEvent.IO_ERROR,r,i),E.addEventListener(e.ProgressEvent.PROGRESS,n,i),E.load(s)},a.getChangeList=function(){return[]},a.getVirtualUrl=function(e){return e},n.getNetContext=function(){return null==n._instance&&(n._instance=new n),n._instance},n}(e.HashObject);t.HTML5NetContext=n,e.registerClass(n,"egret.web.HTML5NetContext",["egret.NetContext"]),e.NetContext=n}(t=e.web||(e.web={}))}(egret||(egret={}));
;/*!libs/modules/res/res.min.js*/
var RES;!function(e){var t=function(){function e(e,t,r){this.groupName="",this.data=null,this._loaded=!1,this.name=e,this.url=t,this.type=r}var t=__define,r=e,i=r.prototype;return t(i,"loaded",function(){return this.data?this.data.loaded:this._loaded},function(e){this.data&&(this.data.loaded=e),this._loaded=e}),i.toString=function(){return'[ResourceItem name="'+this.name+'" url="'+this.url+'" type="'+this.type+'"]'},e.TYPE_XML="xml",e.TYPE_IMAGE="image",e.TYPE_BIN="bin",e.TYPE_TEXT="text",e.TYPE_JSON="json",e.TYPE_SHEET="sheet",e.TYPE_FONT="font",e.TYPE_SOUND="sound",e}();e.ResourceItem=t,egret.registerClass(t,"RES.ResourceItem")}(RES||(RES={}));var RES;!function(e){var t=function(){function t(){this.keyMap={},this.groupDic={},e.configInstance=this}var r=t,i=r.prototype;return i.getGroupByName=function(e){var t=new Array;if(!this.groupDic[e])return t;for(var r=this.groupDic[e],i=r.length,n=0;i>n;n++){var s=r[n];t.push(this.parseResourceItem(s))}return t},i.getRawGroupByName=function(e){return this.groupDic[e]?this.groupDic[e]:[]},i.createGroup=function(e,t,r){if(void 0===r&&(r=!1),!r&&this.groupDic[e]||!t||0==t.length)return!1;for(var i=this.groupDic,n=[],s=t.length,a=0;s>a;a++){var o=t[a],u=i[o];if(u)for(var l=u.length,c=0;l>c;c++){var h=u[c];-1==n.indexOf(h)&&n.push(h)}else h=this.keyMap[o],h?-1==n.indexOf(h)&&n.push(h):egret.$warn(3200,o)}return 0==n.length?!1:(this.groupDic[e]=n,!0)},i.parseConfig=function(e,t){if(e){var r=e.resources;if(r)for(var i=r.length,n=0;i>n;n++){var s=r[n],a=s.url;a&&-1==a.indexOf("://")&&(s.url=t+a),this.addItemToKeyMap(s)}var o=e.groups;if(o)for(i=o.length,n=0;i>n;n++){for(var u=o[n],l=[],c=u.keys.split(","),h=c.length,f=0;h>f;f++){var d=c[f].trim();s=this.keyMap[d],s&&-1==l.indexOf(s)&&l.push(s)}this.groupDic[u.name]=l}}},i.addSubkey=function(e,t){var r=this.keyMap[t];r&&!this.keyMap[e]&&(this.keyMap[e]=r)},i.addItemToKeyMap=function(e){if(this.keyMap[e.name]||(this.keyMap[e.name]=e),e.hasOwnProperty("subkeys")){var t=e.subkeys.split(",");e.subkeys=t;for(var r=t.length,i=0;r>i;i++){var n=t[i];null==this.keyMap[n]&&(this.keyMap[n]=e)}}},i.getName=function(e){var t=this.keyMap[e];return t?t.name:""},i.getType=function(e){var t=this.keyMap[e];return t?t.type:""},i.getRawResourceItem=function(e){return this.keyMap[e]},i.getResourceItem=function(e){var t=this.keyMap[e];return t?this.parseResourceItem(t):null},i.parseResourceItem=function(t){var r=new e.ResourceItem(t.name,t.url,t.type);return r.data=t,r},t}();e.ResourceConfig=t,egret.registerClass(t,"RES.ResourceConfig")}(RES||(RES={}));var RES;!function(e){var t=function(t){function r(){t.call(this),this.thread=2,this.loadingCount=0,this.callBack=null,this.resInstance=null,this.groupTotalDic={},this.numLoadedDic={},this.itemListDic={},this.groupErrorDic={},this.retryTimesDic={},this.maxRetryTimes=3,this.failedList=new Array,this.priorityQueue={},this.lazyLoadList=new Array,this.analyzerDic={},this.queueIndex=0}__extends(r,t);var i=r,n=i.prototype;return n.isGroupInLoading=function(e){return void 0!==this.itemListDic[e]},n.loadGroup=function(t,r,i){if(void 0===i&&(i=0),!this.itemListDic[r]&&r){if(!t||0==t.length){egret.$warn(3201,r);var n=new e.ResourceEvent(e.ResourceEvent.GROUP_LOAD_ERROR);return n.groupName=r,void this.dispatchEvent(n)}this.priorityQueue[i]?this.priorityQueue[i].push(r):this.priorityQueue[i]=[r],this.itemListDic[r]=t;for(var s=t.length,a=0;s>a;a++){var o=t[a];o.groupName=r}this.groupTotalDic[r]=t.length,this.numLoadedDic[r]=0,this.next()}},n.loadItem=function(e){this.lazyLoadList.push(e),e.groupName="",this.next()},n.next=function(){for(;this.loadingCount<this.thread;){var e=this.getOneResourceItem();if(!e)break;if(this.loadingCount++,e.loaded)this.onItemComplete(e);else{var t=this.resInstance.$getAnalyzerByType(e.type);t.loadFile(e,this.onItemComplete,this)}}},n.getOneResourceItem=function(){if(this.failedList.length>0)return this.failedList.shift();var e=Number.NEGATIVE_INFINITY;for(var t in this.priorityQueue)e=Math.max(e,t);var r=this.priorityQueue[e];if(!r||0==r.length)return 0==this.lazyLoadList.length?null:this.lazyLoadList.pop();for(var i,n=r.length,s=0;n>s&&(this.queueIndex>=n&&(this.queueIndex=0),i=this.itemListDic[r[this.queueIndex]],!(i.length>0));s++)this.queueIndex++;return 0==i.length?null:i.shift()},n.onItemComplete=function(t){this.loadingCount--;var r=t.groupName;if(!t.loaded){var i=this.retryTimesDic[t.name]||1;if(!(i>this.maxRetryTimes))return this.retryTimesDic[t.name]=i+1,this.failedList.push(t),void this.next();delete this.retryTimesDic[t.name],e.ResourceEvent.dispatchResourceEvent(this.resInstance,e.ResourceEvent.ITEM_LOAD_ERROR,r,t)}if(r){this.numLoadedDic[r]++;var n=this.numLoadedDic[r],s=this.groupTotalDic[r];if(t.loaded||(this.groupErrorDic[r]=!0),e.ResourceEvent.dispatchResourceEvent(this.resInstance,e.ResourceEvent.GROUP_PROGRESS,r,t,n,s),n==s){var a=this.groupErrorDic[r];this.removeGroupName(r),delete this.groupTotalDic[r],delete this.numLoadedDic[r],delete this.itemListDic[r],delete this.groupErrorDic[r],a?e.ResourceEvent.dispatchResourceEvent(this,e.ResourceEvent.GROUP_LOAD_ERROR,r):e.ResourceEvent.dispatchResourceEvent(this,e.ResourceEvent.GROUP_COMPLETE,r)}}else this.callBack.call(this.resInstance,t);this.next()},n.removeGroupName=function(e){for(var t in this.priorityQueue){for(var r=this.priorityQueue[t],i=r.length,n=0,s=!1,i=r.length,a=0;i>a;a++){var o=r[a];if(o==e){r.splice(n,1),s=!0;break}n++}if(s){0==r.length&&delete this.priorityQueue[t];break}}},r}(egret.EventDispatcher);e.ResourceLoader=t,egret.registerClass(t,"RES.ResourceLoader")}(RES||(RES={}));var RES;!function(e){var t=function(e){function t(t,r,i){void 0===r&&(r=!1),void 0===i&&(i=!1),e.call(this,t,r,i),this.itemsLoaded=0,this.itemsTotal=0,this.groupName="",this.resItem=null}__extends(t,e);var r=t;return r.prototype,t.dispatchResourceEvent=function(e,r,i,n,s,a){void 0===i&&(i=""),void 0===n&&(n=null),void 0===s&&(s=0),void 0===a&&(a=0);var o=egret.Event.create(t,r);o.groupName=i,o.resItem=n,o.itemsLoaded=s,o.itemsTotal=a;var u=e.dispatchEvent(o);return egret.Event.release(o),u},t.ITEM_LOAD_ERROR="itemLoadError",t.CONFIG_COMPLETE="configComplete",t.CONFIG_LOAD_ERROR="configLoadError",t.GROUP_PROGRESS="groupProgress",t.GROUP_COMPLETE="groupComplete",t.GROUP_LOAD_ERROR="groupLoadError",t}(egret.Event);e.ResourceEvent=t,egret.registerClass(t,"RES.ResourceEvent")}(RES||(RES={}));var RES;!function(e){var t=function(t){function r(){t.call(this),this.resourceConfig=null,this.resourceConfig=e.configInstance}__extends(r,t);var i=r,n=i.prototype;return n.addSubkey=function(e,t){this.resourceConfig.addSubkey(e,t)},n.loadFile=function(){},n.getRes=function(){},n.destroyRes=function(){return!1},r.getStringPrefix=function(e){if(!e)return"";var t=e.indexOf(".");return-1!=t?e.substring(0,t):""},r.getStringTail=function(e){if(!e)return"";var t=e.indexOf(".");return-1!=t?e.substring(t+1):""},r}(egret.HashObject);e.AnalyzerBase=t,egret.registerClass(t,"RES.AnalyzerBase")}(RES||(RES={}));var RES;!function(e){var t=function(t){function r(){t.call(this),this.fileDic={},this.resItemDic=[],this._dataFormat=egret.HttpResponseType.ARRAY_BUFFER,this.recycler=[]}__extends(r,t);var i=r,n=i.prototype;return n.loadFile=function(t,r,i){if(this.fileDic[t.name])return void r.call(i,t);var n=this.getRequest();this.resItemDic[n.hashCode]={item:t,func:r,thisObject:i},n.open(e.$getVirtualUrl(t.url)),n.send()},n.getRequest=function(){var e=this.recycler.pop();return e||(e=new egret.HttpRequest,e.addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this)),e.responseType=this._dataFormat,e},n.onLoadFinish=function(e){var t=e.target,r=this.resItemDic[t.hashCode];delete this.resItemDic[t.hashCode];var i=r.item,n=r.func;i.loaded=e.type==egret.Event.COMPLETE,i.loaded&&this.analyzeData(i,t.response),this.recycler.push(t),n.call(r.thisObject,i)},n.analyzeData=function(e,t){var r=e.name;this.fileDic[r]||""!=t&&!t||(this.fileDic[r]=t)},n.getRes=function(e){return this.fileDic[e]},n.hasRes=function(e){var t=this.getRes(e);return null!=t},n.destroyRes=function(e){return this.fileDic[e]?(this.onResourceDestroy(this.fileDic[e]),delete this.fileDic[e],!0):!1},n.onResourceDestroy=function(){},r}(e.AnalyzerBase);e.BinAnalyzer=t,egret.registerClass(t,"RES.BinAnalyzer")}(RES||(RES={}));var RES;!function(e){var t=function(t){function r(){t.call(this),this.fileDic={},this.resItemDic=[],this.recycler=[]}__extends(r,t);var i=r,n=i.prototype;return n.loadFile=function(t,r,i){if(this.fileDic[t.name])return void r.call(i,t);var n=this.getLoader();this.resItemDic[n.$hashCode]={item:t,func:r,thisObject:i},n.load(e.$getVirtualUrl(t.url))},n.getLoader=function(){var e=this.recycler.pop();return e||(e=new egret.ImageLoader,e.addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this)),e},n.onLoadFinish=function(e){var t=e.$target,r=this.resItemDic[t.$hashCode];delete this.resItemDic[t.$hashCode];var i=r.item,n=r.func;if(i.loaded=e.$type==egret.Event.COMPLETE,i.loaded){var s=new egret.Texture;s._setBitmapData(t.data),this.analyzeData(i,s)}this.recycler.push(t),n.call(r.thisObject,i)},n.analyzeData=function(e,t){var r=e.name;if(!this.fileDic[r]&&t){this.fileDic[r]=t;var i=e.data;if(i&&i.scale9grid){var n=i.scale9grid,s=n.split(",");t.scale9Grid=new egret.Rectangle(parseInt(s[0]),parseInt(s[1]),parseInt(s[2]),parseInt(s[3]))}}},n.getRes=function(e){return this.fileDic[e]},n.hasRes=function(e){var t=this.getRes(e);return null!=t},n.destroyRes=function(e){return this.fileDic[e]?(this.onResourceDestroy(this.fileDic[e]),delete this.fileDic[e],!0):!1},n.onResourceDestroy=function(e){e.dispose()},r}(e.AnalyzerBase);e.ImageAnalyzer=t,egret.registerClass(t,"RES.ImageAnalyzer")}(RES||(RES={}));var RES;!function(e){var t=function(e){function t(){e.call(this),this._dataFormat=egret.HttpResponseType.TEXT}__extends(t,e);var r=t;return r.prototype,t}(e.BinAnalyzer);e.TextAnalyzer=t,egret.registerClass(t,"RES.TextAnalyzer")}(RES||(RES={}));var RES;!function(e){var t=function(e){function t(){e.call(this),this._dataFormat=egret.HttpResponseType.TEXT}__extends(t,e);var r=t,i=r.prototype;return i.analyzeData=function(e,t){var r=e.name;if(!this.fileDic[r]&&t)try{var i=t;this.fileDic[r]=JSON.parse(i)}catch(n){egret.$warn(1017,e.url,t)}},t}(e.BinAnalyzer);e.JsonAnalyzer=t,egret.registerClass(t,"RES.JsonAnalyzer")}(RES||(RES={}));var RES;!function(e){var t=function(t){function r(){t.call(this),this.sheetMap={},this.textureMap={},this.recyclerIamge=[],this._dataFormat=egret.HttpResponseType.TEXT}__extends(r,t);var i=r,n=i.prototype;return n.getRes=function(t){var r=this.fileDic[t];if(r||(r=this.textureMap[t]),!r){var i=e.AnalyzerBase.getStringPrefix(t);if(r=this.fileDic[i]){var n=e.AnalyzerBase.getStringTail(t);r=r.getTexture(n)}}return r},n.onLoadFinish=function(e){var t=e.target,r=this.resItemDic[t.$hashCode];delete this.resItemDic[t.hashCode];var i=r.item,n=r.func;if(i.loaded=e.type==egret.Event.COMPLETE,i.loaded)if(t instanceof egret.HttpRequest){i.loaded=!1;var s=this.analyzeConfig(i,t.response);if(s)return this.loadImage(s,r),void this.recycler.push(t)}else{var a=new egret.Texture;a._setBitmapData(t.data),this.analyzeBitmap(i,a)}t instanceof egret.HttpRequest?this.recycler.push(t):this.recyclerIamge.push(t),n.call(r.thisObject,i)},n.analyzeConfig=function(e,t){var r,i=e.name,n="";try{var s=t;r=JSON.parse(s)}catch(a){egret.$warn(1017,e.url,t)}return r&&(this.sheetMap[i]=r,n=this.getRelativePath(e.url,r.file)),n},n.analyzeBitmap=function(e,t){var r=e.name;if(!this.fileDic[r]&&t){var i=this.sheetMap[r];delete this.sheetMap[r];var n=e.data&&e.data.subkeys?"":r,s=this.parseSpriteSheet(t,i,n);this.fileDic[r]=s}},n.getRelativePath=function(e,t){e=e.split("\\").join("/");var r=e.match(/#.*|\?.*/),i="";r&&(i=r[0]);var n=e.lastIndexOf("/");return e=-1!=n?e.substring(0,n+1)+t:t,e+i},n.parseSpriteSheet=function(e,t,r){var i=t.frames;if(!i)return null;var n=new egret.SpriteSheet(e),s=this.textureMap;for(var a in i){var o=i[a],e=n.createTexture(a,o.x,o.y,o.w,o.h,o.offX,o.offY,o.sourceW,o.sourceH);if(o.scale9grid){var u=o.scale9grid,l=u.split(",");e.scale9Grid=new egret.Rectangle(parseInt(l[0]),parseInt(l[1]),parseInt(l[2]),parseInt(l[3]))}null==s[a]&&(s[a]=e,r&&this.addSubkey(a,r))}return n},n.destroyRes=function(e){var t=this.fileDic[e];if(t){delete this.fileDic[e];var r;for(var i in t._textureMap)null==r&&(r=t._textureMap[i],this.onResourceDestroy(r),r=null),delete this.textureMap[i];return t.dispose&&t.dispose(),!0}return!1},n.loadImage=function(t,r){var i=this.getImageLoader();this.resItemDic[i.hashCode]=r,i.load(e.$getVirtualUrl(t))},n.getImageLoader=function(){var e=this.recyclerIamge.pop();return e||(e=new egret.ImageLoader,e.addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this)),e},n.onResourceDestroy=function(e){e&&e.dispose()},r}(e.BinAnalyzer);e.SheetAnalyzer=t,egret.registerClass(t,"RES.SheetAnalyzer")}(RES||(RES={}));var RES;!function(e){var t=function(e){function t(){e.call(this)}__extends(t,e);var r=t,i=r.prototype;return i.analyzeConfig=function(e,t){var r,i=e.name,n="";try{var s=t;r=JSON.parse(s)}catch(a){}return r?n=this.getRelativePath(e.url,r.file):(r=t,n=this.getTexturePath(e.url,r)),this.sheetMap[i]=r,n},i.analyzeBitmap=function(e,t){var r=e.name;if(!this.fileDic[r]&&t){var i=this.sheetMap[r];delete this.sheetMap[r];var n=new egret.BitmapFont(t,i);this.fileDic[r]=n}},i.getTexturePath=function(e,t){var r="",i=t.split("\n"),n=i[2],s=n.indexOf('file="');-1!=s&&(n=n.substring(s+6),s=n.indexOf('"'),r=n.substring(0,s)),e=e.split("\\").join("/");var s=e.lastIndexOf("/");return e=-1!=s?e.substring(0,s+1)+r:r},i.onResourceDestroy=function(e){e&&e.dispose()},t}(e.SheetAnalyzer);e.FontAnalyzer=t,egret.registerClass(t,"RES.FontAnalyzer")}(RES||(RES={}));var RES;!function(e){var t=function(t){function r(){t.call(this),this.soundDic={},this.resItemDic=[]}__extends(r,t);var i=r,n=i.prototype;return n.loadFile=function(t,r,i){if(this.soundDic[t.name])return void r.call(i,t);var n=new egret.Sound;n.addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),n.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this),this.resItemDic[n.$hashCode]={item:t,func:r,thisObject:i},n.load(e.$getVirtualUrl(t.url)),t.data&&(n.type=t.data.soundType)},n.onLoadFinish=function(e){var t=e.$target;t.removeEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),t.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this);var r=this.resItemDic[t.$hashCode];delete this.resItemDic[t.$hashCode];var i=r.item,n=r.func;i.loaded=e.$type==egret.Event.COMPLETE,i.loaded&&this.analyzeData(i,t),n.call(r.thisObject,i)},n.analyzeData=function(e,t){var r=e.name;!this.soundDic[r]&&t&&(this.soundDic[r]=t)},n.getRes=function(e){return this.soundDic[e]},n.hasRes=function(e){return!!this.getRes(e)},n.destroyRes=function(e){return this.soundDic[e]?(delete this.soundDic[e],!0):!1},r}(e.AnalyzerBase);e.SoundAnalyzer=t,egret.registerClass(t,"RES.SoundAnalyzer")}(RES||(RES={}));var RES;!function(e){var t=function(e){function t(){e.call(this),this._dataFormat=egret.HttpResponseType.TEXT}__extends(t,e);var r=t,i=r.prototype;return i.analyzeData=function(e,t){var r=e.name;if(!this.fileDic[r]&&t)try{var i=t,n=egret.XML.parse(i);this.fileDic[r]=n}catch(s){}},t}(e.BinAnalyzer);e.XMLAnalyzer=t,egret.registerClass(t,"RES.XMLAnalyzer")}(RES||(RES={}));var RES;!function(){}(RES||(RES={}));var RES;!function(e){var t;!function(t){var r=function(e){function t(){e.call(this),this._versionInfo={}}__extends(t,e);var r=t,i=r.prototype;return i.fetchVersion=function(e){e.onSuccess(null)},i.getChangeList=function(){return[]},i.getVirtualUrl=function(e){return e},t}(egret.EventDispatcher);t.Html5VersionController=r,egret.registerClass(r,"RES.web.Html5VersionController",["RES.VersionController","RES.IVersionController"]),egret.Capabilities.runtimeType==egret.RuntimeType.WEB&&(e.VersionController=r)}(t=e.web||(e.web={}))}(RES||(RES={}));var RES;!function(e){var t;!function(t){var r=function(){function e(){this._versionInfo={},this._versionPath="",this._localFileArr=[]}var t=e,r=t.prototype;return r.fetchVersion=function(e){var t=this;if(t._versionPath="all.manifest",t._versionInfo=t.getLocalData(t._versionPath),null==t._versionInfo)return void egret.callLater(function(){e.onFail(1,null)},t);var r=0,i=function(i){if(i)for(var n=0;n<i.length;n++)i[n]&&""!=i[n]&&t._localFileArr.push("resource/"+i[n]);r++,2==r&&e.onSuccess(null)};t.getList(i,"assets","resource"),t.getList(i,"update","resource")},r.getList=function(e,t,r){void 0===r&&(r="");var i=egret.PromiseObject.create();i.onSuccessFunc=function(t){e(t)},i.onErrorFunc=function(){console.error("list files error")},"assets"==t?egret_native.Game.listResource(r,i):egret_native.Game.listUpdate(r,i)},r.getChangeList=function(){var e=[],t=this._localFileArr;for(var r in this._versionInfo)t.indexOf(this.getVirtualUrl(r))<0&&e.push({url:this.getVirtualUrl(r),size:this._versionInfo[r].s});return e},r.getVirtualUrl=function(e){return this._versionInfo&&this._versionInfo[e]?"resource/"+this._versionInfo[e].v.substring(0,2)+"/"+this._versionInfo[e].v+"_"+this._versionInfo[e].s+"."+e.substring(e.lastIndexOf(".")+1):e},r.getLocalData=function(e){if(egret_native.readUpdateFileSync&&egret_native.readResourceFileSync){var t=egret_native.readUpdateFileSync(e);if(null!=t)return JSON.parse(t);if(t=egret_native.readResourceFileSync(e),null!=t)return JSON.parse(t)}return null},e}();t.NativeVersionController=r,egret.registerClass(r,"RES.native.NativeVersionController",["RES.VersionController","RES.IVersionController"]),egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE&&(e.VersionController=r)}(t=e["native"]||(e["native"]={}))}(RES||(RES={}));var RES;!function(e){function t(e,t){I.registerAnalyzer(e,t)}function r(e){I.$registerVersionController(e)}function i(){return I.vcs}function n(e,t,r){void 0===t&&(t=""),void 0===r&&(r="json"),I.loadConfig(e,t,r)}function s(e,t){void 0===t&&(t=0),I.loadGroup(e,t)}function a(e){return I.isGroupLoaded(e)}function o(e){return I.getGroupByName(e)}function u(e,t,r){return void 0===r&&(r=!1),I.createGroup(e,t,r)}function l(e){return I.hasRes(e)}function c(e,t){void 0===t&&(t=""),I.parseConfig(e,t)}function h(e){return I.getRes(e)}function f(e,t,r){I.getResAsync(e,t,r)}function d(e,t,r,i){void 0===i&&(i=""),I.getResByUrl(e,t,r,i)}function g(e,t){return I.destroyRes(e,t)}function p(e){I.setMaxLoadingThread(e)}function v(e){I.setMaxRetryTimes(e)}function y(e,t,r,i,n){void 0===i&&(i=!1),void 0===n&&(n=0),I.addEventListener(e,t,r,i,n)}function R(e,t,r,i){void 0===i&&(i=!1),I.removeEventListener(e,t,r,i)}function E(e){return I.vcs?I.vcs.getVirtualUrl(e):e}e.registerAnalyzer=t,e.registerVersionController=r,e.getVersionController=i,e.loadConfig=n,e.loadGroup=s,e.isGroupLoaded=a,e.getGroupByName=o,e.createGroup=u,e.hasRes=l,e.parseConfig=c,e.getRes=h,e.getResAsync=f,e.getResByUrl=d,e.destroyRes=g,e.setMaxLoadingThread=p,e.setMaxRetryTimes=v,e.addEventListener=y,e.removeEventListener=R,e.$getVirtualUrl=E;var m=function(t){function r(){t.call(this),this.analyzerDic={},this.analyzerClassMap={},this.configItemList=[],this.callLaterFlag=!1,this.configComplete=!1,this.loadedGroups=[],this.groupNameList=[],this.asyncDic={},this._loadedUrlTypes={},this.init()}__extends(r,t);var i=r,n=i.prototype;return n.$getAnalyzerByType=function(e){var t=this.analyzerDic[e];if(!t){var r=this.analyzerClassMap[e];if(!r)return null;t=this.analyzerDic[e]=new r}return t},n.registerAnalyzer=function(e,t){this.analyzerClassMap[e]=t},n.$registerVersionController=function(e){this.vcs=e},n.init=function(){this.vcs=new e.VersionController;var t=this.analyzerClassMap;t[e.ResourceItem.TYPE_BIN]=e.BinAnalyzer,t[e.ResourceItem.TYPE_IMAGE]=e.ImageAnalyzer,t[e.ResourceItem.TYPE_TEXT]=e.TextAnalyzer,t[e.ResourceItem.TYPE_JSON]=e.JsonAnalyzer,t[e.ResourceItem.TYPE_SHEET]=e.SheetAnalyzer,t[e.ResourceItem.TYPE_FONT]=e.FontAnalyzer,t[e.ResourceItem.TYPE_SOUND]=e.SoundAnalyzer,t[e.ResourceItem.TYPE_XML]=e.XMLAnalyzer,this.resConfig=new e.ResourceConfig,this.resLoader=new e.ResourceLoader,this.resLoader.callBack=this.onResourceItemComp,this.resLoader.resInstance=this,this.resLoader.addEventListener(e.ResourceEvent.GROUP_COMPLETE,this.onGroupComp,this),this.resLoader.addEventListener(e.ResourceEvent.GROUP_LOAD_ERROR,this.onGroupError,this)},n.loadConfig=function(e,t,r){void 0===r&&(r="json");var i={url:e,resourceRoot:t,type:r};this.configItemList.push(i),this.callLaterFlag||(egret.callLater(this.startLoadConfig,this),this.callLaterFlag=!0)},n.startLoadConfig=function(){var t=this;this.callLaterFlag=!1;var i=this.configItemList;this.configItemList=[],this.loadingConfigList=i;for(var n=i.length,s=[],a=0;n>a;a++){var o=i[a],u=new e.ResourceItem(o.url,o.url,o.type);s.push(u)}var l={onSuccess:function(){t.resLoader.loadGroup(s,r.GROUP_CONFIG,Number.MAX_VALUE)},onFail:function(){e.ResourceEvent.dispatchResourceEvent(t,e.ResourceEvent.CONFIG_LOAD_ERROR)}};this.vcs?this.vcs.fetchVersion(l):this.resLoader.loadGroup(s,r.GROUP_CONFIG,Number.MAX_VALUE)},n.isGroupLoaded=function(e){return-1!=this.loadedGroups.indexOf(e)},n.getGroupByName=function(e){return this.resConfig.getGroupByName(e)},n.loadGroup=function(t,r){if(void 0===r&&(r=0),-1!=this.loadedGroups.indexOf(t))return void e.ResourceEvent.dispatchResourceEvent(this,e.ResourceEvent.GROUP_COMPLETE,t);if(!this.resLoader.isGroupInLoading(t))if(this.configComplete){var i=this.resConfig.getGroupByName(t);this.resLoader.loadGroup(i,t,r)}else this.groupNameList.push({name:t,priority:r})},n.createGroup=function(e,t,r){if(void 0===r&&(r=!1),r){var i=this.loadedGroups.indexOf(e);-1!=i&&this.loadedGroups.splice(i,1)}return this.resConfig.createGroup(e,t,r)},n.onGroupComp=function(t){if(t.groupName==r.GROUP_CONFIG){for(var i=this.loadingConfigList.length,n=0;i>n;n++){var s=this.loadingConfigList[n],a=this.$getAnalyzerByType(s.type),o=a.getRes(s.url);a.destroyRes(s.url),this.resConfig.parseConfig(o,s.resourceRoot)}this.configComplete=!0,this.loadingConfigList=null,e.ResourceEvent.dispatchResourceEvent(this,e.ResourceEvent.CONFIG_COMPLETE),this.loadDelayGroups()}else this.loadedGroups.push(t.groupName),this.dispatchEvent(t)},n.loadDelayGroups=function(){var e=this.groupNameList;this.groupNameList=[];for(var t=e.length,r=0;t>r;r++){var i=e[r];this.loadGroup(i.name,i.priority)}},n.onGroupError=function(t){t.groupName==r.GROUP_CONFIG?(this.loadingConfigList=null,e.ResourceEvent.dispatchResourceEvent(this,e.ResourceEvent.CONFIG_LOAD_ERROR)):this.dispatchEvent(t)},n.hasRes=function(t){var r=this.resConfig.getType(t);if(""==r){var i=e.AnalyzerBase.getStringTail(t);if(r=this.resConfig.getType(i),""==r)return!1}return!0},n.parseConfig=function(e,t){this.resConfig.parseConfig(e,t),this.configComplete||this.loadingConfigList||(this.configComplete=!0,this.loadDelayGroups())},n.getRes=function(t){var r=this.resConfig.getType(t);if(""==r){var i=e.AnalyzerBase.getStringPrefix(t);if(r=this.resConfig.getType(i),""==r)return null}var n=this.$getAnalyzerByType(r);return n.getRes(t)},n.getResAsync=function(t,r,i){var n=this.resConfig.getType(t),s=this.resConfig.getName(t);if(""==n&&(s=e.AnalyzerBase.getStringPrefix(t),n=this.resConfig.getType(s),""==n))return void egret.$callAsync(r,i);var a=this.$getAnalyzerByType(n),o=a.getRes(t);if(o)return void egret.$callAsync(r,i,o,t);var u={key:t,compFunc:r,thisObject:i};if(this.asyncDic[s])this.asyncDic[s].push(u);else{this.asyncDic[s]=[u];var l=this.resConfig.getResourceItem(s);this.resLoader.loadItem(l)}},n.getResByUrl=function(t,r,i,n){if(void 0===n&&(n=""),!t)return void egret.$callAsync(r,i);n||(n=this.getTypeByUrl(t)),null!=this._loadedUrlTypes[t]&&this._loadedUrlTypes[t]!=n&&egret.$warn(3202),this._loadedUrlTypes[t]=n;var s=this.$getAnalyzerByType(n),a=t,o=s.getRes(a);if(o)return void egret.$callAsync(r,i,o,t);var u={key:a,compFunc:r,thisObject:i};if(this.asyncDic[a])this.asyncDic[a].push(u);else{this.asyncDic[a]=[u];var l=new e.ResourceItem(a,t,n);this.resLoader.loadItem(l)}},n.getTypeByUrl=function(t){var r=t.substr(t.lastIndexOf(".")+1);r&&(r=r.toLowerCase());var i;switch(r){case e.ResourceItem.TYPE_XML:case e.ResourceItem.TYPE_JSON:case e.ResourceItem.TYPE_SHEET:i=r;break;case"png":case"jpg":case"gif":case"jpeg":case"bmp":i=e.ResourceItem.TYPE_IMAGE;break;case"fnt":i=e.ResourceItem.TYPE_FONT;break;case"txt":i=e.ResourceItem.TYPE_TEXT;break;case"mp3":case"ogg":case"mpeg":case"wav":case"m4a":case"mp4":case"aiff":case"wma":case"mid":i=e.ResourceItem.TYPE_SOUND;break;default:i=e.ResourceItem.TYPE_BIN}return i},n.onResourceItemComp=function(e){var t=this.asyncDic[e.name];delete this.asyncDic[e.name];for(var r=this.$getAnalyzerByType(e.type),i=t.length,n=0;i>n;n++){var s=t[n],a=r.getRes(s.key);s.compFunc.call(s.thisObject,a,s.key)}},n.destroyRes=function(e,t){void 0===t&&(t=!0);var r=this.resConfig.getRawGroupByName(e);if(r&&r.length>0){var i=this.loadedGroups.indexOf(e);-1!=i&&this.loadedGroups.splice(i,1);for(var n=r.length,s=0;n>s;s++){var a=r[s];if(!t&&this.isResInLoadedGroup(a.name));else{a.loaded=!1;var o=this.$getAnalyzerByType(a.type);o.destroyRes(a.name),this.removeLoadedGroupsByItemName(a.name)}}return!0}var u=this.resConfig.getType(e);if(""==u){if(u=this._loadedUrlTypes[e],null==u||""==u)return!1;delete this._loadedUrlTypes[e];var o=this.$getAnalyzerByType(u);return o.destroyRes(e),!0}a=this.resConfig.getRawResourceItem(e),a.loaded=!1,o=this.$getAnalyzerByType(u);var l=o.destroyRes(e);return this.removeLoadedGroupsByItemName(a.name),l},n.removeLoadedGroupsByItemName=function(e){for(var t=this.loadedGroups,r=t.length,i=0;r>i;i++)for(var n=this.resConfig.getRawGroupByName(t[i]),s=n.length,a=0;s>a;a++){var o=n[a];if(o.name==e){t.splice(i,1),i--,r=t.length;break}}},n.isResInLoadedGroup=function(e){for(var t=this.loadedGroups,r=t.length,i=0;r>i;i++)for(var n=this.resConfig.getRawGroupByName(t[i]),s=n.length,a=0;s>a;a++){var o=n[a];if(o.name==e)return!0}return!1},n.setMaxLoadingThread=function(e){1>e&&(e=1),this.resLoader.thread=e},n.setMaxRetryTimes=function(e){e=Math.max(e,0),this.resLoader.maxRetryTimes=e},r.GROUP_CONFIG="RES__CONFIG",r}(egret.EventDispatcher);egret.registerClass(m,"Resource");var I=new m}(RES||(RES={}));var RES;!function(e){var t=function(t){function r(){t.call(this),this.sheetMap={},this.recyclerIamge=[],this._dataFormat=egret.HttpResponseType.TEXT}__extends(r,t);var i=r,n=i.prototype;return n.onLoadFinish=function(e){var t=e.target,r=this.resItemDic[t.$hashCode];delete this.resItemDic[t.hashCode];var i=r.item,n=r.func;if(i.loaded=e.type==egret.Event.COMPLETE,i.loaded)if(t instanceof egret.HttpRequest){i.loaded=!1;var s=this.analyzeConfig(i,t.response);if(s)return this.loadImage(s,r),void this.recycler.push(t)}else this.analyzeBitmap(i,t.data);t instanceof egret.HttpRequest?this.recycler.push(t):this.recyclerIamge.push(t),n.call(r.thisObject,i)},n.analyzeConfig=function(e,t){var r,i=e.name,n="";try{var s=t;r=JSON.parse(s)}catch(a){egret.$warn(1017,e.url,t)}if(r)if(this.sheetMap[i]=r,r.file)n=this.getRelativePath(e.url,r.file);else{var o=e.url.split("?"),u=o[0].split("/");u[u.length-1]=u[u.length-1].split(".")[0]+".png",n="";for(var l=0;l<u.length;l++)n+=u[l]+(l<u.length-1?"/":"");2==o.length&&(n+=o[2])}return n},n.analyzeBitmap=function(e,t){var r=e.name;if(!this.fileDic[r]&&t){var i=this.sheetMap[r];delete this.sheetMap[r];var n=e.data&&e.data.subkeys?"":r,s=this.parseAnimation(t,i,n);this.fileDic[r]=s}},n.getRelativePath=function(e,t){e=e.split("\\").join("/");var r=e.lastIndexOf("/");return e=-1!=r?e.substring(0,r+1)+t:t},n.parseAnimation=function(e,t){for(var r,i=Object.keys(t.mc),n=t.mc[i[0]].frames,s=n.length,a=[],o=0;s>o;o++){r=t.res[n[o].res];var u=new egret.Texture;u._bitmapData=e,u.$initData(r.x,r.y,r.w,r.h,n[o].x,n[o].y,n[o].sourceW,n[o].sourceH,e.width,e.height)}return a},n.destroyRes=function(e){var t=this.fileDic[e];return t?(delete this.fileDic[e],!0):!1},n.loadImage=function(t,r){var i=this.getImageLoader();this.resItemDic[i.hashCode]=r,i.load(e.$getVirtualUrl(t))},n.getImageLoader=function(){var e=this.recyclerIamge.pop();return e||(e=new egret.ImageLoader,e.addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this)),e},r}(e.BinAnalyzer);e.AnimationAnalyzer=t,egret.registerClass(t,"RES.AnimationAnalyzer")}(RES||(RES={}));var egret;!function(e){e.$locale_strings=e.$locale_strings||{},e.$locale_strings.en_US=e.$locale_strings.en_US||{};var t=e.$locale_strings.en_US;t[3200]="RES.createGroup() passed in non-existed key value in configuration: {0}",t[3201]='RES loaded non-existed or empty resource group:"{0}"',t[3202]="Do not use the different types of ways to load the same material!",t[3203]="Can't find the analyzer of the specified file type:{0} Please register the specified analyzer in the initialization of the project first,then start the resource loading process"}(egret||(egret={}));var egret;!function(e){e.$locale_strings=e.$locale_strings||{},e.$locale_strings.zh_CN=e.$locale_strings.zh_CN||{};var t=e.$locale_strings.zh_CN;t[3200]="RES.createGroup(): {0}",t[3201]='RES:"{0}"',t[3202]="",t[3203]=":{0} "}(egret||(egret={}));
;/*!libs/modules/tween/tween.min.js*/
var egret;!function(t){var e=function(){function e(){t.$error(1014)}var n=e;return n.prototype,e.get=function(t){return-1>t&&(t=-1),t>1&&(t=1),function(e){return 0==t?e:0>t?e*(e*-t+1+t):e*((2-e)*t+(1-t))}},e.getPowIn=function(t){return function(e){return Math.pow(e,t)}},e.getPowOut=function(t){return function(e){return 1-Math.pow(1-e,t)}},e.getPowInOut=function(t){return function(e){return(e*=2)<1?.5*Math.pow(e,t):1-.5*Math.abs(Math.pow(2-e,t))}},e.sineIn=function(t){return 1-Math.cos(t*Math.PI/2)},e.sineOut=function(t){return Math.sin(t*Math.PI/2)},e.sineInOut=function(t){return-.5*(Math.cos(Math.PI*t)-1)},e.getBackIn=function(t){return function(e){return e*e*((t+1)*e-t)}},e.getBackOut=function(t){return function(e){return--e*e*((t+1)*e+t)+1}},e.getBackInOut=function(t){return t*=1.525,function(e){return(e*=2)<1?.5*e*e*((t+1)*e-t):.5*((e-=2)*e*((t+1)*e+t)+2)}},e.circIn=function(t){return-(Math.sqrt(1-t*t)-1)},e.circOut=function(t){return Math.sqrt(1- --t*t)},e.circInOut=function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},e.bounceIn=function(t){return 1-e.bounceOut(1-t)},e.bounceOut=function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},e.bounceInOut=function(t){return.5>t?.5*e.bounceIn(2*t):.5*e.bounceOut(2*t-1)+.5},e.getElasticIn=function(t,e){var n=2*Math.PI;return function(i){if(0==i||1==i)return i;var s=e/n*Math.asin(1/t);return-(t*Math.pow(2,10*(i-=1))*Math.sin((i-s)*n/e))}},e.getElasticOut=function(t,e){var n=2*Math.PI;return function(i){if(0==i||1==i)return i;var s=e/n*Math.asin(1/t);return t*Math.pow(2,-10*i)*Math.sin((i-s)*n/e)+1}},e.getElasticInOut=function(t,e){var n=2*Math.PI;return function(i){var s=e/n*Math.asin(1/t);return(i*=2)<1?-.5*t*Math.pow(2,10*(i-=1))*Math.sin((i-s)*n/e):t*Math.pow(2,-10*(i-=1))*Math.sin((i-s)*n/e)*.5+1}},e.quadIn=e.getPowIn(2),e.quadOut=e.getPowOut(2),e.quadInOut=e.getPowInOut(2),e.cubicIn=e.getPowIn(3),e.cubicOut=e.getPowOut(3),e.cubicInOut=e.getPowInOut(3),e.quartIn=e.getPowIn(4),e.quartOut=e.getPowOut(4),e.quartInOut=e.getPowInOut(4),e.quintIn=e.getPowIn(5),e.quintOut=e.getPowOut(5),e.quintInOut=e.getPowInOut(5),e.backIn=e.getBackIn(1.7),e.backOut=e.getBackOut(1.7),e.backInOut=e.getBackInOut(1.7),e.elasticIn=e.getElasticIn(1,.3),e.elasticOut=e.getElasticOut(1,.3),e.elasticInOut=e.getElasticInOut(1,.3*1.5),e}();t.Ease=e,t.registerClass(e,"egret.Ease")}(egret||(egret={}));var egret;!function(t){var e=function(e){function n(t,n,i){e.call(this),this._target=null,this._useTicks=!1,this.ignoreGlobalPause=!1,this.loop=!1,this.pluginData=null,this._steps=null,this._actions=null,this.paused=!1,this.duration=0,this._prevPos=-1,this.position=null,this._prevPosition=0,this._stepPosition=0,this.passive=!1,this.initialize(t,n,i)}__extends(n,e);var i=n,s=i.prototype;return n.get=function(t,e,i,s){return void 0===e&&(e=null),void 0===i&&(i=null),void 0===s&&(s=!1),s&&n.removeTweens(t),new n(t,e,i)},n.removeTweens=function(t){if(t.tween_count){for(var e=n._tweens,i=e.length-1;i>=0;i--)e[i]._target==t&&(e[i].paused=!0,e.splice(i,1));t.tween_count=0}},n.pauseTweens=function(e){if(e.tween_count)for(var n=t.Tween._tweens,i=n.length-1;i>=0;i--)n[i]._target==e&&(n[i].paused=!0)},n.resumeTweens=function(e){if(e.tween_count)for(var n=t.Tween._tweens,i=n.length-1;i>=0;i--)n[i]._target==e&&(n[i].paused=!1)},n.tick=function(t,e){void 0===e&&(e=!1);var i=t-n._lastTime;n._lastTime=t;for(var s=n._tweens.concat(),r=s.length-1;r>=0;r--){var u=s[r];e&&!u.ignoreGlobalPause||u.paused||u.tick(u._useTicks?1:i)}return!1},n._register=function(e,i){var s=e._target,r=n._tweens;if(i)s&&(s.tween_count=s.tween_count>0?s.tween_count+1:1),r.push(e),n._inited||(n._lastTime=t.getTimer(),t.sys.$ticker.$startTick(n.tick,null),n._inited=!0);else{s&&s.tween_count--;for(var u=r.length;u--;)if(r[u]==e)return void r.splice(u,1)}},n.removeAllTweens=function(){for(var t=n._tweens,e=0,i=t.length;i>e;e++){var s=t[e];s.paused=!0,s._target.tweenjs_count=0}t.length=0},s.initialize=function(t,e,i){this._target=t,e&&(this._useTicks=e.useTicks,this.ignoreGlobalPause=e.ignoreGlobalPause,this.loop=e.loop,e.onChange&&this.addEventListener("change",e.onChange,e.onChangeObj),e.override&&n.removeTweens(t)),this.pluginData=i||{},this._curQueueProps={},this._initQueueProps={},this._steps=[],this._actions=[],e&&e.paused?this.paused=!0:n._register(this,!0),e&&null!=e.position&&this.setPosition(e.position,n.NONE)},s.setPosition=function(t,e){void 0===e&&(e=1),0>t&&(t=0);var n=t,i=!1;if(n>=this.duration&&(this.loop?n%=this.duration:(n=this.duration,i=!0)),n==this._prevPos)return i;var s=this._prevPos;if(this.position=this._prevPos=n,this._prevPosition=t,this._target)if(i)this._updateTargetProps(null,1);else if(this._steps.length>0){for(var r=0,u=this._steps.length;u>r&&!(this._steps[r].t>n);r++);var o=this._steps[r-1];this._updateTargetProps(o,(this._stepPosition=n-o.t)/o.d)}return i&&this.setPaused(!0),0!=e&&this._actions.length>0&&(this._useTicks?this._runActions(n,n):1==e&&s>n?(s!=this.duration&&this._runActions(s,this.duration),this._runActions(0,n,!0)):this._runActions(s,n)),this.dispatchEventWith("change"),i},s._runActions=function(t,e,n){void 0===n&&(n=!1);var i=t,s=e,r=-1,u=this._actions.length,o=1;for(t>e&&(i=e,s=t,r=u,u=o=-1);(r+=o)!=u;){var a=this._actions[r],h=a.t;(h==s||h>i&&s>h||n&&h==t)&&a.f.apply(a.o,a.p)}},s._updateTargetProps=function(t,e){var i,s,r,u,o,a;if(t||1!=e){if(this.passive=!!t.v,this.passive)return;t.e&&(e=t.e(e,0,1,1)),i=t.p0,s=t.p1}else this.passive=!1,i=s=this._curQueueProps;for(var h in this._initQueueProps){null==(u=i[h])&&(i[h]=u=this._initQueueProps[h]),null==(o=s[h])&&(s[h]=o=u),r=u==o||0==e||1==e||"number"!=typeof u?1==e?o:u:u+(o-u)*e;var c=!1;if(a=n._plugins[h])for(var p=0,_=a.length;_>p;p++){var f=a[p].tween(this,h,r,i,s,e,!!t&&i==s,!t);f==n.IGNORE?c=!0:r=f}c||(this._target[h]=r)}},s.setPaused=function(t){return this.paused=t,n._register(this,!t),this},s._cloneProps=function(t){var e={};for(var n in t)e[n]=t[n];return e},s._addStep=function(t){return t.d>0&&(this._steps.push(t),t.t=this.duration,this.duration+=t.d),this},s._appendQueueProps=function(t){var e,i,s,r,u;for(var o in t)if(void 0===this._initQueueProps[o]){if(i=this._target[o],e=n._plugins[o])for(s=0,r=e.length;r>s;s++)i=e[s].init(this,o,i);this._initQueueProps[o]=this._curQueueProps[o]=void 0===i?null:i}else i=this._curQueueProps[o];for(var o in t){if(i=this._curQueueProps[o],e=n._plugins[o])for(u=u||{},s=0,r=e.length;r>s;s++)e[s].step&&e[s].step(this,o,i,t[o],u);this._curQueueProps[o]=t[o]}return u&&this._appendQueueProps(u),this._curQueueProps},s._addAction=function(t){return t.t=this.duration,this._actions.push(t),this},s._set=function(t,e){for(var n in t)e[n]=t[n]},s.wait=function(t,e){if(null==t||0>=t)return this;var n=this._cloneProps(this._curQueueProps);return this._addStep({d:t,p0:n,p1:n,v:e})},s.to=function(t,e,n){return void 0===n&&(n=void 0),(isNaN(e)||0>e)&&(e=0),this._addStep({d:e||0,p0:this._cloneProps(this._curQueueProps),e:n,p1:this._cloneProps(this._appendQueueProps(t))})},s.call=function(t,e,n){return void 0===e&&(e=void 0),void 0===n&&(n=void 0),this._addAction({f:t,p:n?n:[],o:e?e:this._target})},s.set=function(t,e){return void 0===e&&(e=null),this._appendQueueProps(t),this._addAction({f:this._set,o:this,p:[t,e?e:this._target]})},s.play=function(t){return t||(t=this),this.call(t.setPaused,t,[!1])},s.pause=function(t){return t||(t=this),this.call(t.setPaused,t,[!0])},s.tick=function(t){this.paused||this.setPosition(this._prevPosition+t)},n.NONE=0,n.LOOP=1,n.REVERSE=2,n._tweens=[],n.IGNORE={},n._plugins={},n._inited=!1,n._lastTime=0,n}(t.EventDispatcher);t.Tween=e,t.registerClass(e,"egret.Tween")}(egret||(egret={}));var egret;!function(t){var e;!function(e){function n(e){if("function"==typeof e)return e;var n=t.Ease[e];return"function"==typeof n?n:null}function i(t,e,n,i){var s=t.prototype;s.__meta__=s.__meta__||{},s.__meta__[e]=n,i&&(s.__defaultProperty__=e)}var s=function(t){function e(){t.apply(this,arguments),this.name=""}__extends(e,t);var n=e;return n.prototype,e}(t.EventDispatcher);e.BasePath=s,t.registerClass(s,"egret.tween.BasePath");var r=function(t){function e(){t.apply(this,arguments),this.props=void 0,this.duration=500,this.ease=void 0}__extends(e,t);var n=e;return n.prototype,e}(s);e.To=r,t.registerClass(r,"egret.tween.To");var u=function(t){function e(){t.apply(this,arguments),this.duration=500,this.passive=void 0}__extends(e,t);var n=e;return n.prototype,e}(s);e.Wait=u,t.registerClass(u,"egret.tween.Wait");var o=function(t){function e(){t.apply(this,arguments),this.props=void 0}__extends(e,t);var n=e;return n.prototype,e}(s);e.Set=o,t.registerClass(o,"egret.tween.Set");var a=function(t){function e(){t.apply(this,arguments),this.delta=0}__extends(e,t);var n=e;return n.prototype,e}(s);e.Tick=a,t.registerClass(a,"egret.tween.Tick");var h=function(e){function i(){e.call(this)}__extends(i,e);var s=__define,h=i,c=h.prototype;return s(c,"props",function(){return this._props},function(t){this._props=t}),s(c,"target",function(){return this._target},function(t){this._target=t}),s(c,"paths",function(){return this._paths},function(t){this._paths=t||[]}),c.play=function(){this.tween?this.tween.setPaused(!1):this.createTween()},c.pause=function(){this.tween&&this.tween.setPaused(!0)},c.createTween=function(){this.tween=t.Tween.get(this._target,this._props),this._paths&&this.applyPaths()},c.applyPaths=function(){for(var t=0;t<this._paths.length;t++){var e=this._paths[t];this.applyPath(e)}},c.applyPath=function(t){var e=this;t instanceof r?this.tween.to(t.props,t.duration,n(t.ease)):t instanceof u?this.tween.wait(t.duration,t.passive):t instanceof o?this.tween.set(t.props):t instanceof a&&this.tween.tick(t.delta),this.tween.call(function(){return e.pathComplete(t)})},c.pathComplete=function(t){t.dispatchEventWith("complete"),this.dispatchEventWith("pathComplete",!1,t);var e=this._paths.indexOf(t);e>=0&&e===this._paths.length-1&&this.dispatchEventWith("complete")},i}(t.EventDispatcher);e.TweenItem=h,t.registerClass(h,"egret.tween.TweenItem"),i(h,"paths","Array",!0);var c=function(t){function e(){t.call(this),this.completeCount=0}__extends(e,t);var n=__define,i=e,s=i.prototype;return n(s,"items",function(){return this._items},function(t){this.completeCount=0,this.registerEvent(!1),this._items=t,this.registerEvent(!0)}),s.registerEvent=function(t){var e=this;this._items&&this._items.forEach(function(n){t?n.addEventListener("complete",e.itemComplete,e):n.removeEventListener("complete",e.itemComplete,e)})},s.play=function(){if(this._items)for(var t=0;t<this._items.length;t++){var e=this._items[t];e.play()}},s.pause=function(){if(this._items)for(var t=0;t<this._items.length;t++){var e=this._items[t];e.pause()}},s.itemComplete=function(t){var e=t.currentTarget;this.completeCount++,this.dispatchEventWith("itemComplete",!1,e),this.completeCount===this.items.length&&(this.dispatchEventWith("complete"),this.completeCount=0)},e}(t.EventDispatcher);e.TweenGroup=c,t.registerClass(c,"egret.tween.TweenGroup"),i(c,"items","Array",!0)}(e=t.tween||(t.tween={}))}(egret||(egret={}));
;/*!libs/modules/egret3d/egret3d.min.js*/
var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},egret3d;!function(t){var e=function(){function e(){}return e.outError=function(t){console.log("Error:"+t)},e.outWarn=function(t){console.log("Warning:"+t)},e.outDebug=function(e){t.Egret3DEngine.instance.debug&&console.log("Debug:"+e)},e}();t.Egret3DLog=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){this.averageFPS=60,this.averageDelay=16,this.delayNumber=0,this.countFrame=30}return t.prototype.update=function(t,e){return this.delayNumber+=e-1,0==this.countFrame--&&(this.countFrame=30,this.averageDelay=Math.floor(this.delayNumber/this.countFrame),this.averageFPS=Math.floor(1e3/this.averageDelay),this.averageFPS=Math.min(this.averageFPS,60),this.delayNumber=0)," "+this.averageFPS.toString()+" fps/"+this.averageDelay.toString()+" delay"},t.fps=16.6666,t}(),i=function(){function i(){}return i.initState=function(){t.Egret3DEngine.instance.debug&&!i._canvas&&(i._canvas=document.createElement("canvas"),document.body.appendChild(i._canvas),i._canvas.width=i._width,i._canvas.height=i._height,i._canvas.style.backgroundColor="rgba(158,158,158,0.3)")},i.showTime=function(t,e){i.use||i.initState(),i._fps=i.fpsInfo.update(t,e)},i.showDataInfo=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];i.use||i.initState();var r;for(r in t)t[r]&&this.array.push(t[r].toString())},i.show=function(){if(i._canvas){var t=20,e=i._canvas.getContext("2d");e.fillStyle="lightblue",e.font="20px Corbel",e.clearRect(0,0,i._width,i._height),e.fillText(" Egret3D Graphics ",10,t),t+=20,e.fillText(i._fps,10,t),t+=20;for(var r=0;r<this.array.length;r++)e.fillText(this.array[r].toString(),10,t),t+=20;this.array.length=0}},i.use=!1,i._width=260,i._height=300,i.fpsInfo=new e,i._fps="",i.array=[],i}();t.Egret3DState=i}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t.diffuse=0]="diffuse",t[t.normal=1]="normal",t[t.specular=2]="specular",t[t.color=3]="color",t[t.shadow=4]="shadow"}(t.TextureMethodType||(t.TextureMethodType={})),t.TextureMethodType,!function(t){t[t.base_vertex=0]="base_vertex",t[t.start_vertex=1]="start_vertex",t[t.local_vertex=2]="local_vertex",t[t.global_vertex=3]="global_vertex",t[t.end_vertex=4]="end_vertex",t[t.base_fragment=5]="base_fragment",t[t.start_fragment=6]="start_fragment",t[t.materialsource_fragment=7]="materialsource_fragment",t[t.diffuse_fragment=8]="diffuse_fragment",t[t.normal_fragment=9]="normal_fragment",t[t.matCap_fragment=10]="matCap_fragment",t[t.specular_fragment=11]="specular_fragment",t[t.shadow_fragment=12]="shadow_fragment",t[t.lighting_fragment=13]="lighting_fragment",t[t.multi_end_fragment=14]="multi_end_fragment",t[t.end_fragment=15]="end_fragment"}(t.ShaderPhaseType||(t.ShaderPhaseType={})),t.ShaderPhaseType}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.u=0,this.v=0,this.u=t,this.v=e}return t}();t.UV=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},enumerable:!0,configurable:!0}),t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y},t.prototype.equals=function(t){return this.x==t.x&&this.y==t.y},t.prototype.normalize=function(t){if(void 0===t&&(t=1),0!=this.length){var e=t/this.length;return this.x*=e,void(this.y*=e)}throw"Cannot divide by zero length."},t.prototype.offset=function(t,e){this.x+=t,this.y+=e},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.toString=function(){return"[Point] (x="+this.x+", y="+this.y+")"},t.distance=function(t,e){var i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)},t}();t.Point=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),this.x=0,this.y=0,this.z=0,this.w=0,this.x=t,this.y=e,this.z=i,this.w=r}return Object.defineProperty(e.prototype,"a",{get:function(){return this.w},set:function(t){this.w=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"r",{get:function(){return this.x},set:function(t){this.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"g",{get:function(){return this.y},set:function(t){this.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"b",{get:function(){return this.z},set:function(t){this.z=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return Math.sqrt(this.lengthSquared)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lengthSquared",{get:function(){return this.x*this.x+this.y*this.y+this.z*this.z},enumerable:!0,configurable:!0}),e.prototype.add=function(t,i){void 0===i&&(i=null),i||(i=new e);var r=this.x,a=this.y,n=this.z,o=this.w,s=t.x,h=t.y,l=t.z,u=t.w;return i.setTo(r+s,a+h,n+l,o+u),i},e.prototype.clone=function(){return new e(this.x,this.y,this.z,this.w)},e.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w},e.prototype.crossProduct=function(t,i){return void 0===i&&(i=null),i=i||new e,i.x=this.y*t.z-this.z*t.y,i.y=this.z*t.x-this.x*t.z,i.z=this.x*t.y-this.y*t.x,i.w=1,i},e.prototype.decrementBy=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z},e.distance=function(t,e){var i=t.x-e.x,r=t.y-e.y,a=t.z-e.z;return Math.sqrt(i*i+r*r+a*a)},e.prototype.dotProduct=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},e.prototype.equals=function(t,e){return void 0===e&&(e=!1),this.x==t.x&&this.y==t.y&&this.z==t.z&&(!e||this.w==t.w)},e.prototype.incrementBy=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},e.prototype.divide=function(t){return t instanceof e?new e(this.x/t.x,this.y/t.y,this.z/t.z):(this.x=this.x/t,this.y=this.y/t,this.z=this.z/t,this)},e.prototype.negate=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},e.prototype.normalize=function(t){if(void 0===t&&(t=1),0!=this.length){var e=t/this.length;return this.x*=e,this.y*=e,void(this.z*=e)}},e.prototype.scaleBy=function(t){this.x*=t,this.y*=t,this.z*=t},e.prototype.setTo=function(t,e,i,r){void 0===r&&(r=1),this.x=t,this.y=e,this.z=i,this.w=r},e.prototype.subtract=function(t,i){return void 0===i&&(i=null),i||(i=new e),i.setTo(this.x-t.x,this.y-t.y,this.z-t.z),i},e.prototype.multiply=function(t,i){void 0===i&&(i=null),i||(i=new e);var r=this.x,a=this.y,n=this.z,o=t.x,s=t.y,h=t.z;return i.setTo(r*o,a*s,n*h),i},e.prototype.divided=function(t,i){void 0===i&&(i=null),i||(i=new e);var r=this.x,a=this.y,n=this.z,o=t.x,s=t.y,h=t.z;return i.setTo(r/o,a/s,n/h),i},e.prototype.lerp=function(t,e,i){var r=t.x,a=t.y,n=t.z,o=t.w,s=e.x,h=e.y,l=e.z,u=e.w;this.x=(s-r)*i+r,this.y=(h-a)*i+a,this.z=(l-n)*i+n,this.w=(u-o)*i+o},e.prototype.Dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},e.prototype.OrthoNormalVectorFast=function(t,i){i||(i=new e);var r,a;return Math.abs(t.z)>.70710678?(r=t.y*t.y+t.z*t.z,a=1/Math.sqrt(r),i.x=0,i.y=-t.z*a,i.z=t.y*a):(r=t.x*t.x+t.y*t.y,a=1/Math.sqrt(r),i.x=-t.y*a,i.y=t.x*a,i.z=0),i},e.prototype.slerp=function(i,r,a){var n=Math.sqrt(this.Dot(i,i)),o=Math.sqrt(this.Dot(r,r));if(1e-5>n||1e-5>o)return this.lerp(i,r,a);var s=n+a*(o-n),h=this.Dot(i,r)/(n*o);if(h>.99999)return this.lerp(i,r,a);if(-1+1e-5>h){e.HELP_0.copyFrom(i);var l=e.HELP_0.divide(n);this.OrthoNormalVectorFast(l,e.HELP_1);var u=e.HELP_1;t.Quaternion.HELP_0.fromAxisAngle(e.HELP_1,3.1415926*a*t.MathUtil.RADIANS_TO_DEGREES);var c=t.Quaternion.HELP_0.toMatrix3D(t.Matrix4_4.helpMatrix);return c.transformVector(l,this),void this.scaleBy(s)}i.dotProduct,this.Cross(i,r,e.HELP_0);var u=e.HELP_0;e.HELP_1.copyFrom(i);var l=e.HELP_1.divide(n);u.normalize();var d=Math.acos(h)*a;t.Quaternion.HELP_0.fromAxisAngle(u,d*t.MathUtil.RADIANS_TO_DEGREES);var c=t.Quaternion.HELP_0.toMatrix3D(t.Matrix4_4.helpMatrix);return c.transformVector(l,this),void this.scaleBy(s)},e.prototype.Cross=function(t,i,r){return void 0===r&&(r=null),r||(r=new e),r.x=t.y*i.z-t.z*i.y,r.y=t.z*i.x-t.x*i.z,r.z=t.x*i.y-t.y*i.x,r},e.prototype.toString=function(){return"<"+this.x+", "+this.y+", "+this.z+">"},e.prototype.parsing=function(t){var e=t.split(" ");e.length<3||(this.x=parseFloat(e[0]),this.y=parseFloat(e[1]),this.z=parseFloat(e[2]))},e.prototype.equal=function(t){return!(this.x!=t.x||this.y!=t.y||this.z!=t.z||this.w!=t.w)},e.X_AXIS=new e(1,0,0),e.Y_AXIS=new e(0,1,0),e.Z_AXIS=new e(0,0,1),e.HELP_0=new e,e.HELP_1=new e,e.HELP_2=new e,e.HELP_3=new e,e}();t.Vector3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),this.x=0,this.y=0,this.width=0,this.height=0,this.x=t,this.y=e,this.width=i,this.height=r}return t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},t.prototype.copyTo=function(t){t.copyFrom(this)},t.prototype.inner=function(t,e){return t<this.x||t>this.x+this.width||e<this.y||e>this.y+this.height?!1:!0},t.pointInRect=function(t,e,i,r,a,n){return i>t||t>a||r>e||e>n?!1:!0},t.prototype.equal=function(t){return!(this.x!=t.x||this.y!=t.y||this.width!=t.width||this.height!=t.height)},t.prototype.equalArea=function(t,e,i,r){return!(this.x!=t||this.y!=e||this.width!=i||this.height!=r)},t.prototype.equalInnerArea=function(t){var e=this.x,i=this.y,r=this.x+this.width,a=this.y+this.height,n=t.x,o=t.y,s=t.x+t.width,h=t.y+t.height;return Math.max(e,n)<=Math.min(r,s)&&Math.max(i,o)<=Math.min(a,h)?!0:!1},t.prototype.innerArea=function(e,i){i=i||new t;var r=this.x,a=this.y,n=this.x+this.width,o=this.y+this.height,s=e.x,h=e.y,l=e.x+e.width,u=e.y+e.height,c=Math.max(a,h),d=Math.min(o,u),p=Math.max(r,s),f=Math.min(l,n);return c>=0&&d>=0&&d-c>=0&&f-p>0?(i.x=p,i.y=c,i.width=f-p,i.height=d-c):(i.x=0,i.y=0,i.width=0,i.height=0),i},t.prototype.setTo=function(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r},t}();t.Rectangle=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),this.x=0,this.y=0,this.z=0,this.w=1,this.x=t,this.y=e,this.z=i,this.w=r}return Object.defineProperty(e.prototype,"magnitude",{get:function(){return Math.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z)},enumerable:!0,configurable:!0}),e.prototype.multiply=function(t,e){var i=t.w,r=t.x,a=t.y,n=t.z,o=e.w,s=e.x,h=e.y,l=e.z;this.w=i*o-r*s-a*h-n*l,this.x=i*s+r*o+a*l-n*h,this.y=i*h-r*l+a*o+n*s,this.z=i*l+r*h-a*s+n*o},e.prototype.multiplyVector=function(t,i){void 0===i&&(i=null),null===i&&(i=new e);var r=t.x,a=t.y,n=t.z;return i.w=-this.x*r-this.y*a-this.z*n,i.x=this.w*r+this.y*n-this.z*a,i.y=this.w*a-this.x*n+this.z*r,i.z=this.w*n+this.x*a-this.y*r,i},e.prototype.fromAxisAngle=function(t,e){e*=Math.PI/180;var i=.5*e,r=Math.sin(i);this.w=Math.cos(i),this.x=t.x*r,this.y=t.y*r,this.z=t.z*r,this.normalize()},e.prototype.toAxisAngle=function(t){var e=this.x*this.x+this.y*this.y+this.z*this.z,i=0;return e>0?(i=2*Math.acos(this.w),e=1/Math.sqrt(e),t.x=this.x*e,t.y=this.y*e,t.z=this.z*e):(i=0,t.x=1,t.y=0,t.z=0),i/=Math.PI/180},e.prototype.slerp=function(t,e,i){var r=t.w,a=t.x,n=t.y,o=t.z,s=e.w,h=e.x,l=e.y,u=e.z,c=r*s+a*h+n*l+o*u;if(0>c&&(c=-c,s=-s,h=-h,l=-l,u=-u),.95>c){var d=Math.acos(c),p=1/Math.sin(d),f=Math.sin(d*(1-i))*p,_=Math.sin(d*i)*p;this.w=r*f+s*_,this.x=a*f+h*_,this.y=n*f+l*_,this.z=o*f+u*_}else{this.w=r+i*(s-r),this.x=a+i*(h-a),this.y=n+i*(l-n),this.z=o+i*(u-o);var m=1/Math.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z);this.w*=m,this.x*=m,this.y*=m,this.z*=m}},e.prototype.lerp=function(t,e,i){var r,a=t.w,n=t.x,o=t.y,s=t.z,h=e.w,l=e.x,u=e.y,c=e.z;0>a*h+n*l+o*u+s*c&&(h=-h,l=-l,u=-u,c=-c),this.w=a+i*(h-a),this.x=n+i*(l-n),this.y=o+i*(u-o),this.z=s+i*(c-s),r=1/Math.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z),this.w*=r,this.x*=r,this.y*=r,this.z*=r},e.prototype.fromEulerAngles=function(e,i,r){e*=t.MathUtil.DEGREES_TO_RADIANS,i*=t.MathUtil.DEGREES_TO_RADIANS,r*=t.MathUtil.DEGREES_TO_RADIANS;var a=.5*e,n=.5*i,o=.5*r,s=Math.cos(a),h=Math.sin(a),l=Math.cos(n),u=Math.sin(n),c=Math.cos(o),d=Math.sin(o);return this.w=s*l*c+h*u*d,this.x=h*l*c-s*u*d,this.y=s*u*c+h*l*d,this.z=s*l*d-h*u*c,this},e.prototype.toEulerAngles=function(e){void 0===e&&(e=null),null===e&&(e=new t.Vector3D),e.x=Math.atan2(2*(this.w*this.x+this.y*this.z),1-2*(this.x*this.x+this.y*this.y));var i=2*(this.w*this.y-this.z*this.x);return i=t.MathUtil.clampf(i,-1,1),e.y=Math.asin(i),e.z=Math.atan2(2*(this.w*this.z+this.x*this.y),1-2*(this.y*this.y+this.z*this.z)),e.x/=t.MathUtil.DEGREES_TO_RADIANS,e.y/=t.MathUtil.DEGREES_TO_RADIANS,e.z/=t.MathUtil.DEGREES_TO_RADIANS,e},e.prototype.normalize=function(t){void 0===t&&(t=1);var e=t/Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);this.x*=e,this.y*=e,this.z*=e,this.w*=e},e.prototype.toString=function(){return"{x:"+this.x+" y:"+this.y+" z:"+this.z+" w:"+this.w+"}"},e.prototype.toMatrix3D=function(e){void 0===e&&(e=null);var i=t.MathUtil.RAW_DATA_CONTAINER,r=2*this.x*this.y,a=2*this.x*this.z,n=2*this.x*this.w,o=2*this.y*this.z,s=2*this.y*this.w,h=2*this.z*this.w,l=this.x*this.x,u=this.y*this.y,c=this.z*this.z,d=this.w*this.w;return i[0]=l-u-c+d,i[4]=r-h,i[8]=a+s,i[12]=0,i[1]=r+h,i[5]=-l+u-c+d,i[9]=o-n,i[13]=0,i[2]=a-s,i[6]=o+n,i[10]=-l-u+c+d,i[14]=0,i[3]=0,i[7]=0,i[11]=0,i[15]=1,e?(e.copyRawDataFrom(i),e):new t.Matrix4_4(new Float32Array(i))},e.prototype.fromMatrix=function(e){var i=e.decompose(t.Orientation3D.QUATERNION)[1];this.x=i.x,this.y=i.y,this.z=i.z,this.w=i.w},e.prototype.inverse=function(t){void 0===t&&(t=null),t||(t=new e);var i=this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z;if(i>0){var r=1/i;t.w=this.w*r,t.x=-this.x*r,t.y=-this.y*r,t.z=-this.z*r}return t},e.prototype.clone=function(){return new e(this.x,this.y,this.z,this.w)},e.prototype.transformVector=function(e,i){void 0===i&&(i=null);var r,a,n,o,s=e.x,h=e.y,l=e.z;return null===i&&(i=new t.Vector3D),o=-this.x*s-this.y*h-this.z*l,r=this.w*s+this.y*l-this.z*h,a=this.w*h-this.x*l+this.z*s,n=this.w*l+this.x*h-this.y*s,i.x=-o*this.x+r*this.w-a*this.z+n*this.y,i.y=-o*this.y+r*this.z+a*this.w-n*this.x,i.z=-o*this.z-r*this.y+a*this.x+n*this.w,i},e.prototype.fromToRotation=function(e,i){var r=new t.Matrix4_4;t.Matrix4_4.fromToRotation(e,i,r),this.fromMatrix(r)},e.fromToRotation=function(t,i,r){return void 0===r&&(r=null),r||(r=new e),r.fromToRotation(t,i),r},e.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w},e.HELP_0=new e,e.HELP_1=new e,e.HELP_2=new e,e}();t.Quaternion=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){}return t.AXIS_ANGLE="axisAngle",t.EULER_ANGLES="eulerAngles",t.QUATERNION="quaternion",t}();t.Orientation3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),this.a=t,this.b=e,this.c=i,this.d=r}return e.prototype.setTo=function(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),this.a=t,this.b=e,this.c=i,this.d=r},e.prototype.fromPoints=function(t,e,i){var r=e.x-t.x,a=e.y-t.y,n=e.z-t.z,o=i.x-t.x,s=i.y-t.y,h=i.z-t.z;this.a=a*h-n*s,this.b=n*o-r*h,this.c=r*s-a*o,this.d=-(this.a*t.x+this.b*t.y+this.c*t.z)},e.prototype.fromNormalAndPoint=function(t,e){this.a=t.x,this.b=t.y,this.c=t.z,this.d=-(this.a*e.x+this.b*e.y+this.c*e.z)},e.prototype.normalize=function(){var t=Math.sqrt(this.a*this.a+this.b*this.b+this.c*this.c);if(t>0){var e=1/t;this.a*=e,this.b*=e,this.c*=e,this.d*=e}return t},e.prototype.distance=function(t){return this.a*t.x+this.b*t.y+this.c*t.z+this.d},e.prototype.classifyPoint=function(e,i){void 0===i&&(i=.01);var r=this.distance(e);return-i>r?t.PlaneClassification.BACK:r>i?t.PlaneClassification.FRONT:t.PlaneClassification.INTERSECT},e.prototype.toString=function(){return"Plane3D [a:"+this.a+", b:"+this.b+", c:"+this.c+", d:"+this.d+"]"},e.ALIGN_ANY=0,e.ALIGN_XY_AXIS=1,e.ALIGN_YZ_AXIS=2,e.ALIGN_XZ_AXIS=3,e}();t.Plane3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(t){void 0===t&&(t=null),this.rawData=t?t:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return e.prototype.lookAt=function(e,i,r){i.subtract(e,t.Vector3D.HELP_0);var a=t.Vector3D.HELP_0;a.normalize();var n=r.crossProduct(a,t.Vector3D.HELP_1);n.normalize();var o=a.crossProduct(n,t.Vector3D.HELP_2);this.rawData[0]=n.x,this.rawData[1]=o.x,this.rawData[2]=a.x,this.rawData[3]=0,this.rawData[4]=n.y,this.rawData[5]=o.y,this.rawData[6]=a.y,this.rawData[7]=0,this.rawData[8]=n.z,this.rawData[9]=o.z,this.rawData[10]=a.z,this.rawData[11]=0,this.rawData[12]=-n.dotProduct(e),this.rawData[13]=-o.dotProduct(e),this.rawData[14]=-a.dotProduct(e),this.rawData[15]=1},e.prototype.multiply=function(t){var i=this.rawData,r=t.rawData,a=e.helpMatrix;a[0]=i[0]*r[0]+i[1]*r[4]+i[2]*r[8]+i[3]*r[12],a[1]=i[0]*r[1]+i[1]*r[5]+i[2]*r[9]+i[3]*r[13],a[2]=i[0]*r[2]+i[1]*r[6]+i[2]*r[10]+i[3]*r[14],a[3]=i[0]*r[3]+i[1]*r[7]+i[2]*r[11]+i[3]*r[15],a[4]=i[4]*r[0]+i[5]*r[4]+i[6]*r[8]+i[7]*r[12],a[5]=i[4]*r[1]+i[5]*r[5]+i[6]*r[9]+i[7]*r[13],a[6]=i[4]*r[2]+i[5]*r[6]+i[6]*r[10]+i[7]*r[14],a[7]=i[4]*r[3]+i[5]*r[7]+i[6]*r[11]+i[7]*r[15],a[8]=i[8]*r[0]+i[9]*r[4]+i[10]*r[8]+i[11]*r[12],a[9]=i[8]*r[1]+i[9]*r[5]+i[10]*r[9]+i[11]*r[13],a[10]=i[8]*r[2]+i[9]*r[6]+i[10]*r[10]+i[11]*r[14],a[11]=i[8]*r[3]+i[9]*r[7]+i[10]*r[11]+i[11]*r[15],a[12]=i[12]*r[0]+i[13]*r[4]+i[14]*r[8]+i[15]*r[12],a[13]=i[12]*r[1]+i[13]*r[5]+i[14]*r[9]+i[15]*r[13],a[14]=i[12]*r[2]+i[13]*r[6]+i[14]*r[10]+i[15]*r[14],a[15]=i[12]*r[3]+i[13]*r[7]+i[14]*r[11]+i[15]*r[15];for(var n=0;16>n;n++)this.rawData[n]=a[n]},e.prototype.perspectiveB=function(t,e,i,r){var a=Math.tan(t*Math.PI/360)*i,n=a*e;return this.frustum(-n,n,-a,a,i,r)},e.prototype.frustum=function(t,e,i,r,a,n){var o=this.rawData;return o[0]=2*a/(e-t),o[1]=0,o[2]=(e+t)/(e-t),o[3]=0,o[4]=0,o[5]=2*a/(r-i),o[6]=(r+i)/(r-i),o[7]=0,o[8]=0,o[9]=0,o[10]=-(n+a)/(n-a),o[11]=-2*n*a/(n-a),o[12]=0,o[13]=0,o[14]=-1,o[15]=0,this},e.prototype.perspective=function(t,e,i,r){var a=t*(Math.PI/180),n=Math.tan((Math.PI-a)/2),o=n/e;this.rawData[0]=o,this.rawData[1]=0,this.rawData[2]=0,this.rawData[3]=0,this.rawData[4]=0,this.rawData[5]=n,this.rawData[6]=0,this.rawData[7]=0,this.rawData[8]=0,this.rawData[9]=0,this.rawData[10]=r/(r-i),this.rawData[11]=1,this.rawData[12]=0,this.rawData[13]=0,this.rawData[14]=-i*r/(r-i),this.rawData[15]=0},e.prototype.ortho=function(t,e,i,r){this.rawData[0]=2/t,this.rawData[1]=0,this.rawData[2]=0,this.rawData[3]=0,this.rawData[4]=0,this.rawData[5]=2/e,this.rawData[6]=0,this.rawData[7]=0,this.rawData[8]=0,this.rawData[9]=0,this.rawData[10]=1/(r-i),this.rawData[11]=0,this.rawData[12]=0,this.rawData[13]=0,this.rawData[14]=i/(i-r),this.rawData[15]=1},e.prototype.orthoOffCenter=function(t,e,i,r,a,n){this.rawData[0]=2/(e-t),this.rawData[1]=0,this.rawData[2]=0,this.rawData[3]=0,this.rawData[4]=0,this.rawData[5]=2/(r-i),this.rawData[6]=0,this.rawData[7]=0,this.rawData[8]=0,this.rawData[9]=0,this.rawData[10]=1/(n-a),this.rawData[11]=0,this.rawData[12]=(t+e)/(t-e),this.rawData[13]=(r+i)/(i-r),this.rawData[14]=a/(a-n),this.rawData[15]=1},e.prototype.fromToRotation=function(e,i){var r=1e-6,a=t.Vector3D.HELP_0;i.crossProduct(e,a);var n=i.dotProduct(e);if(n>1-r)this.identity();else if(-1+r>3){var o,s,h,l,u,c,d,p,f,_,m,g,v,y,x,b,D,T,w=t.Vector3D.HELP_1,P=t.Vector3D.HELP_2,S=0;P.x=0,P.y=e.z,P.z=-e.y,P.dotProduct(P)<r&&(P.x=-e.z,P.y=0,P.z=e.x),S=1/Math.sqrt(P.dotProduct(P)),P[0]*=S,P[1]*=S,P[2]*=S,P.crossProduct(e,w),o=-e.x*e.x,s=-e.y*e.y,h=-e.z*e.z,l=-e.x*e.y,u=-e.x*e.z,c=-e.y*e.z,d=w.x*w.x,p=w.y*w.y,f=w.z*w.z,_=w.x*w.y,m=w.x*w.z,g=w.y*w.z,v=-P.x*P.x,y=-P.y*P.y,x=-P.z*P.z,b=-P.x*P.y,D=-P.x*P.z,T=-P.y*P.z,this.rawData[0]=o+d+v,this.rawData[1]=l+_+b,this.rawData[2]=u+m+D,this.rawData[4]=this.rawData[1],this.rawData[5]=s+p+y,this.rawData[6]=c+g+T,this.rawData[8]=this.rawData[2],this.rawData[9]=this.rawData[6],this.rawData[10]=h+f+x,this.rawData[3]=0,this.rawData[7]=0,this.rawData[11]=0,this.rawData[15]=1}else{var A,C,E,M,L,z=(1-n)/a.dotProduct(a);A=z*a.x,C=z*a.z,E=A*a.y,M=A*a.z,L=C*a.y,this.rawData[0]=n+A*a.x,this.rawData[1]=E-a.z,this.rawData[2]=M+a.y,this.rawData[4]=E+a.z,this.rawData[5]=n+z*a.y*a.y,this.rawData[6]=L-a.x,this.rawData[8]=M-a.y,this.rawData[9]=L+a.x,this.rawData[10]=n+C*a.z,this.rawData[3]=0,this.rawData[7]=0,this.rawData[11]=0,this.rawData[15]=1}},e.fromToRotation=function(t,i,r){return void 0===r&&(r=null),r||(r=new e),r.fromToRotation(t,i),r},e.prototype.append=function(t){var e=this.rawData[0],i=this.rawData[4],r=this.rawData[8],a=this.rawData[12],n=this.rawData[1],o=this.rawData[5],s=this.rawData[9],h=this.rawData[13],l=this.rawData[2],u=this.rawData[6],c=this.rawData[10],d=this.rawData[14],p=this.rawData[3],f=this.rawData[7],_=this.rawData[11],m=this.rawData[15],g=t.rawData[0],v=t.rawData[4],y=t.rawData[8],x=t.rawData[12],b=t.rawData[1],D=t.rawData[5],T=t.rawData[9],w=t.rawData[13],P=t.rawData[2],S=t.rawData[6],A=t.rawData[10],C=t.rawData[14],E=t.rawData[3],M=t.rawData[7],L=t.rawData[11],z=t.rawData[15];this.rawData[0]=e*g+n*v+l*y+p*x,this.rawData[1]=e*b+n*D+l*T+p*w,this.rawData[2]=e*P+n*S+l*A+p*C,this.rawData[3]=e*E+n*M+l*L+p*z,this.rawData[4]=i*g+o*v+u*y+f*x,this.rawData[5]=i*b+o*D+u*T+f*w,this.rawData[6]=i*P+o*S+u*A+f*C,this.rawData[7]=i*E+o*M+u*L+f*z,this.rawData[8]=r*g+s*v+c*y+_*x,this.rawData[9]=r*b+s*D+c*T+_*w,this.rawData[10]=r*P+s*S+c*A+_*C,this.rawData[11]=r*E+s*M+c*L+_*z,this.rawData[12]=a*g+h*v+d*y+m*x,this.rawData[13]=a*b+h*D+d*T+m*w,this.rawData[14]=a*P+h*S+d*A+m*C,this.rawData[15]=a*E+h*M+d*L+m*z},e.prototype.add=function(t){var e=this.rawData[0],i=this.rawData[4],r=this.rawData[8],a=this.rawData[12],n=this.rawData[1],o=this.rawData[5],s=this.rawData[9],h=this.rawData[13],l=this.rawData[2],u=this.rawData[6],c=this.rawData[10],d=this.rawData[14],p=this.rawData[3],f=this.rawData[7],_=this.rawData[11],m=this.rawData[15],g=t.rawData[0],v=t.rawData[4],y=t.rawData[8],x=t.rawData[12],b=t.rawData[1],D=t.rawData[5],T=t.rawData[9],w=t.rawData[13],P=t.rawData[2],S=t.rawData[6],A=t.rawData[10],C=t.rawData[14],E=t.rawData[3],M=t.rawData[7],L=t.rawData[11],z=t.rawData[15];return this.rawData[0]=e+g,this.rawData[1]=n+b,this.rawData[2]=l+P,this.rawData[3]=p+E,this.rawData[4]=i+v,this.rawData[5]=o+D,this.rawData[6]=u+S,this.rawData[7]=f+M,this.rawData[8]=r+y,this.rawData[9]=s+T,this.rawData[10]=c+A,this.rawData[11]=_+L,this.rawData[12]=a+x,this.rawData[13]=h+w,this.rawData[14]=d+C,this.rawData[15]=m+z,this},e.prototype.sub=function(t){var e=this.rawData[0],i=this.rawData[4],r=this.rawData[8],a=this.rawData[12],n=this.rawData[1],o=this.rawData[5],s=this.rawData[9],h=this.rawData[13],l=this.rawData[2],u=this.rawData[6],c=this.rawData[10],d=this.rawData[14],p=this.rawData[3],f=this.rawData[7],_=this.rawData[11],m=this.rawData[15],g=t.rawData[0],v=t.rawData[4],y=t.rawData[8],x=t.rawData[12],b=t.rawData[1],D=t.rawData[5],T=t.rawData[9],w=t.rawData[13],P=t.rawData[2],S=t.rawData[6],A=t.rawData[10],C=t.rawData[14],E=t.rawData[3],M=t.rawData[7],L=t.rawData[11],z=t.rawData[15];return this.rawData[0]=e-g,this.rawData[1]=n-b,this.rawData[2]=l-P,this.rawData[3]=p-E,this.rawData[4]=i-v,this.rawData[5]=o-D,this.rawData[6]=u-S,this.rawData[7]=f-M,this.rawData[8]=r-y,this.rawData[9]=s-T,this.rawData[10]=c-A,this.rawData[11]=_-L,this.rawData[12]=a-x,this.rawData[13]=h-w,this.rawData[14]=d-C,this.rawData[15]=m-z,this},e.prototype.mult=function(t){return this.rawData[0]*=t,this.rawData[1]*=t,this.rawData[2]*=t,this.rawData[3]*=t,this.rawData[4]*=t,this.rawData[5]*=t,this.rawData[6]*=t,this.rawData[7]*=t,this.rawData[8]*=t,this.rawData[9]*=t,this.rawData[10]*=t,this.rawData[11]*=t,this.rawData[12]*=t,this.rawData[13]*=t,this.rawData[14]*=t,this.rawData[15]*=t,this},e.prototype.rotation=function(e,i,r){this.appendRotation(e,t.Vector3D.X_AXIS),this.appendRotation(i,t.Vector3D.Y_AXIS),this.appendRotation(r,t.Vector3D.Z_AXIS)},e.prototype.appendRotation=function(i,r){var a,n,o=(e.getAxisRotation(r.x,r.y,r.z,i),t.MathUtil.CALCULATION_MATRIX),s=i*t.MathUtil.DEGREES_TO_RADIANS;a=Math.sin(s),n=Math.cos(s),1==r.x&&(o.rawData[0]=1,o.rawData[1]=0,o.rawData[2]=0,o.rawData[3]=0,o.rawData[4]=0,o.rawData[5]=n,o.rawData[6]=a,o.rawData[7]=0,o.rawData[8]=0,o.rawData[9]=-a,o.rawData[10]=n,o.rawData[7]=0,o.rawData[12]=0,o.rawData[13]=0,o.rawData[14]=0,o.rawData[15]=1),1==r.y&&(o.rawData[0]=n,o.rawData[1]=0,o.rawData[2]=-a,o.rawData[3]=0,o.rawData[4]=0,o.rawData[5]=1,o.rawData[6]=0,o.rawData[7]=0,o.rawData[8]=a,o.rawData[9]=0,o.rawData[10]=n,o.rawData[11]=0,o.rawData[12]=0,o.rawData[13]=0,o.rawData[14]=0,o.rawData[15]=1),1==r.z&&(o.rawData[0]=n,o.rawData[1]=a,o.rawData[2]=0,o.rawData[3]=0,o.rawData[4]=-a,o.rawData[5]=n,o.rawData[6]=0,o.rawData[7]=0,o.rawData[8]=0,o.rawData[9]=0,o.rawData[10]=1,o.rawData[11]=0,o.rawData[12]=0,o.rawData[13]=0,o.rawData[14]=0,o.rawData[15]=1),this.append(o)},e.prototype.appendScale=function(t,e,i){this.rawData[0]=t,this.rawData[1]=0,this.rawData[2]=0,this.rawData[4]=0,this.rawData[5]=e,this.rawData[6]=0,this.rawData[8]=0,this.rawData[9]=0,this.rawData[10]=i},e.prototype.appendTranslation=function(t,e,i){this.rawData[12]+=t,this.rawData[13]+=e,this.rawData[14]+=i},e.prototype.clone=function(){var t=new e;return t.copyFrom(this),t},e.prototype.copyColumnFrom=function(t,e){switch(t){case 0:this.rawData[0]=e.x,this.rawData[1]=e.y,this.rawData[2]=e.z,this.rawData[3]=e.w;break;case 1:this.rawData[4]=e.x,this.rawData[5]=e.y,this.rawData[6]=e.z,this.rawData[7]=e.w;break;case 2:this.rawData[8]=e.x,this.rawData[9]=e.y,this.rawData[10]=e.z,this.rawData[11]=e.w;break;case 3:this.rawData[12]=e.x,this.rawData[13]=e.y,this.rawData[14]=e.z,this.rawData[15]=e.w}},e.prototype.copyRowTo=function(t,e){switch(t){case 0:e.x=this.rawData[0],e.y=this.rawData[1],e.z=this.rawData[2],e.w=this.rawData[3];break;case 1:e.x=this.rawData[4],e.y=this.rawData[5],e.z=this.rawData[6],e.w=this.rawData[7];break;case 2:e.x=this.rawData[8],e.y=this.rawData[9],e.z=this.rawData[10],e.w=this.rawData[11];break;case 3:e.x=this.rawData[12],e.y=this.rawData[13],e.z=this.rawData[14],e.w=this.rawData[15]}},e.prototype.copyFrom=function(t){for(var e=t.rawData.length,i=0;e>i;i++)this.rawData[i]=t.rawData[i];return this},e.prototype.copyRawDataFrom=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=!1),i&&this.transpose();for(var r=t.length-e,a=0;r>a;a++)this.rawData[a]=t[a+e];i&&this.transpose()},e.prototype.copyRawDataTo=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=!1),i&&this.transpose();for(var r=this.rawData.length,a=0;r>a;a++)t[a+e]=this.rawData[a];i&&this.transpose()},e.prototype.copyColFrom=function(t,e){switch(t){case 0:this.rawData[0]=e.x,this.rawData[4]=e.y,this.rawData[8]=e.z,this.rawData[12]=e.w;break;case 1:this.rawData[1]=e.x,this.rawData[5]=e.y,this.rawData[9]=e.z,this.rawData[13]=e.w;break;case 2:this.rawData[2]=e.x,this.rawData[6]=e.y,this.rawData[10]=e.z,this.rawData[14]=e.w;break;case 3:this.rawData[3]=e.x,this.rawData[7]=e.y,this.rawData[11]=e.z,this.rawData[15]=e.w;break;default:new Error("no more raw!")}},e.prototype.copyColTo=function(t,e){switch(t){case 0:e.x=this.rawData[0],e.y=this.rawData[4],e.z=this.rawData[8],e.w=this.rawData[12];break;case 1:e.x=this.rawData[1],e.y=this.rawData[5],e.z=this.rawData[9],e.w=this.rawData[13];break;case 2:e.x=this.rawData[2],e.y=this.rawData[6],e.z=this.rawData[10],e.w=this.rawData[14];break;case 3:e.x=this.rawData[3],e.y=this.rawData[7],e.z=this.rawData[11],e.w=this.rawData[15];break;default:new Error("no more raw!")}},e.prototype.copyToMatrix3D=function(t){t.rawData=this.rawData.slice(0)},e.prototype.decompose=function(i,r){void 0===i&&(i="eulerAngles"),void 0===r&&(r=null);var a=t.MathUtil.CALCULATION_QUATERNION,n=r?r:[new t.Vector3D,new t.Vector3D,new t.Vector3D];this.copyRawDataTo(e.helpMatrix.rawData);var o=e.helpMatrix.rawData,s=n[0];s.x=o[12],s.y=o[13],s.z=o[14],o[12]=0,o[13]=0,o[14]=0;var h=n[2];h.x=Math.sqrt(o[0]*o[0]+o[1]*o[1]+o[2]*o[2]),h.y=Math.sqrt(o[4]*o[4]+o[5]*o[5]+o[6]*o[6]),h.z=Math.sqrt(o[8]*o[8]+o[9]*o[9]+o[10]*o[10]),o[0]*(o[5]*o[10]-o[6]*o[9])-o[1]*(o[4]*o[10]-o[6]*o[8])+o[2]*(o[4]*o[9]-o[5]*o[8])<0&&(h.z=-h.z),o[0]/=h.x,o[1]/=h.x,o[2]/=h.x,o[4]/=h.y,o[5]/=h.y,o[6]/=h.y,o[8]/=h.z,o[9]/=h.z,o[10]/=h.z;var l=n[1];switch(i){case t.Orientation3D.AXIS_ANGLE:l.w=Math.acos((o[0]+o[5]+o[10]-1)/2);var u=Math.sqrt((o[6]-o[9])*(o[6]-o[9])+(o[8]-o[2])*(o[8]-o[2])+(o[1]-o[4])*(o[1]-o[4]));l.x=(o[6]-o[9])/u,l.y=(o[8]-o[2])/u,l.z=(o[1]-o[4])/u;break;case t.Orientation3D.QUATERNION:var c=o[0]+o[5]+o[10];c>0?(l.w=Math.sqrt(1+c)/2,l.x=(o[6]-o[9])/(4*l.w),l.y=(o[8]-o[2])/(4*l.w),l.z=(o[1]-o[4])/(4*l.w)):o[0]>o[5]&&o[0]>o[10]?(l.x=Math.sqrt(1+o[0]-o[5]-o[10])/2,l.w=(o[6]-o[9])/(4*l.x),l.y=(o[1]+o[4])/(4*l.x),l.z=(o[8]+o[2])/(4*l.x)):o[5]>o[10]?(l.y=Math.sqrt(1+o[5]-o[0]-o[10])/2,l.x=(o[1]+o[4])/(4*l.y),l.w=(o[8]-o[2])/(4*l.y),l.z=(o[6]+o[9])/(4*l.y)):(l.z=Math.sqrt(1+o[10]-o[0]-o[5])/2,l.x=(o[8]+o[2])/(4*l.z),l.y=(o[6]+o[9])/(4*l.z),l.w=(o[1]-o[4])/(4*l.z));break;case t.Orientation3D.EULER_ANGLES:var c=o[0]+o[5]+o[10];c>0?(a.w=Math.sqrt(1+c)/2,a.x=(o[6]-o[9])/(4*a.w),a.y=(o[8]-o[2])/(4*a.w),a.z=(o[1]-o[4])/(4*a.w)):o[0]>o[5]&&o[0]>o[10]?(a.x=Math.sqrt(1+o[0]-o[5]-o[10])/2,a.w=(o[6]-o[9])/(4*a.x),a.y=(o[1]+o[4])/(4*a.x),a.z=(o[8]+o[2])/(4*a.x)):o[5]>o[10]?(l.y=Math.sqrt(1+o[5]-o[0]-o[10])/2,a.x=(o[1]+o[4])/(4*a.y),a.w=(o[8]-o[2])/(4*a.y),a.z=(o[6]+o[9])/(4*a.y)):(a.z=Math.sqrt(1+o[10]-o[0]-o[5])/2,a.x=(o[8]+o[2])/(4*a.z),a.y=(o[6]+o[9])/(4*a.z),a.w=(o[1]-o[4])/(4*a.z)),a.toEulerAngles(l)}return n[0]=s,n[1]=l,n[2]=h,n},e.prototype.deltaTransformVector=function(e,i){void 0===i&&(i=null),i||(i=new t.Vector3D);var r=e.x,a=e.y,n=e.z;return i.x=r*this.rawData[0]+a*this.rawData[4]+n*this.rawData[8],i.y=r*this.rawData[1]+a*this.rawData[5]+n*this.rawData[9],i.z=r*this.rawData[2]+a*this.rawData[6]+n*this.rawData[10],i.w=r*this.rawData[3]+a*this.rawData[7]+n*this.rawData[11],i},e.prototype.identity=function(){this.rawData[1]=0,this.rawData[2]=0,this.rawData[3]=0,this.rawData[4]=0,this.rawData[6]=0,this.rawData[7]=0,this.rawData[8]=0,this.rawData[9]=0,this.rawData[11]=0,this.rawData[12]=0,this.rawData[13]=0,this.rawData[14]=0,this.rawData[0]=1,this.rawData[5]=1,this.rawData[10]=1,this.rawData[15]=1},e.prototype.fill=function(t){this.rawData[1]=t,this.rawData[2]=t,this.rawData[3]=t,this.rawData[4]=t,this.rawData[6]=t,this.rawData[7]=t,this.rawData[8]=t,this.rawData[9]=t,this.rawData[11]=t,this.rawData[12]=t,this.rawData[13]=t,this.rawData[14]=t,this.rawData[0]=t,this.rawData[5]=t,this.rawData[10]=t,this.rawData[15]=t},e.prototype.invers33=function(){var t=this.rawData[5]*this.rawData[10]-this.rawData[9]*this.rawData[6],e=this.rawData[8]*this.rawData[6]-this.rawData[4]*this.rawData[10],i=this.rawData[4]*this.rawData[9]-this.rawData[8]*this.rawData[5],r=this.rawData[9]*this.rawData[2]-this.rawData[1]*this.rawData[10],a=this.rawData[0]*this.rawData[10]-this.rawData[8]*this.rawData[2],n=this.rawData[8]*this.rawData[1]-this.rawData[0]*this.rawData[9],o=this.rawData[1]*this.rawData[6]-this.rawData[5]*this.rawData[2],s=this.rawData[4]*this.rawData[2]-this.rawData[0]*this.rawData[6],h=this.rawData[0]*this.rawData[5]-this.rawData[4]*this.rawData[1],l=this.rawData[0]*t+this.rawData[4]*r+this.rawData[8]*o;if(Math.abs(l)>1e-11){var u=1/l;this.rawData[0]=u*t,this.rawData[4]=u*e,this.rawData[8]=u*i,this.rawData[1]=u*r,this.rawData[5]=u*a,this.rawData[9]=u*n,this.rawData[2]=u*o,this.rawData[6]=u*s,this.rawData[10]=u*h}},e.transpose=function(t,i){i=i||new e;var r=t.rawData,a=i.rawData;return a[0]=r[0],a[1]=r[4],a[2]=r[8],a[3]=r[12],a[4]=r[1],a[5]=r[5],a[6]=r[9],a[7]=r[13],a[8]=r[2],a[9]=r[6],a[10]=r[10],a[11]=r[14],a[12]=r[3],a[13]=r[7],a[14]=r[11],a[15]=r[15],i
},e.inverse=function(t,i){i=i||new e;var r=t.rawData,a=i.rawData;a[0]=r[5]*r[10]*r[15]-r[5]*r[14]*r[11]-r[6]*r[9]*r[15]+r[6]*r[13]*r[11]+r[7]*r[9]*r[14]-r[7]*r[13]*r[10],a[1]=-r[1]*r[10]*r[15]+r[1]*r[14]*r[11]+r[2]*r[9]*r[15]-r[2]*r[13]*r[11]-r[3]*r[9]*r[14]+r[3]*r[13]*r[10],a[2]=r[1]*r[6]*r[15]-r[1]*r[14]*r[7]-r[2]*r[5]*r[15]+r[2]*r[13]*r[7]+r[3]*r[5]*r[14]-r[3]*r[13]*r[6],a[3]=-r[1]*r[6]*r[11]+r[1]*r[10]*r[7]+r[2]*r[5]*r[11]-r[2]*r[9]*r[7]-r[3]*r[5]*r[10]+r[3]*r[9]*r[6],a[4]=-r[4]*r[10]*r[15]+r[4]*r[14]*r[11]+r[6]*r[8]*r[15]-r[6]*r[12]*r[11]-r[7]*r[8]*r[14]+r[7]*r[12]*r[10],a[5]=r[0]*r[10]*r[15]-r[0]*r[14]*r[11]-r[2]*r[8]*r[15]+r[2]*r[12]*r[11]+r[3]*r[8]*r[14]-r[3]*r[12]*r[10],a[6]=-r[0]*r[6]*r[15]+r[0]*r[14]*r[7]+r[2]*r[4]*r[15]-r[2]*r[12]*r[7]-r[3]*r[4]*r[14]+r[3]*r[12]*r[6],a[7]=r[0]*r[6]*r[11]-r[0]*r[10]*r[7]-r[2]*r[4]*r[11]+r[2]*r[8]*r[7]+r[3]*r[4]*r[10]-r[3]*r[8]*r[6],a[8]=r[4]*r[9]*r[15]-r[4]*r[13]*r[11]-r[5]*r[8]*r[15]+r[5]*r[12]*r[11]+r[7]*r[8]*r[13]-r[7]*r[12]*r[9],a[9]=-r[0]*r[9]*r[15]+r[0]*r[13]*r[11]+r[1]*r[8]*r[15]-r[1]*r[12]*r[11]-r[3]*r[8]*r[13]+r[3]*r[12]*r[9],a[10]=r[0]*r[5]*r[15]-r[0]*r[13]*r[7]-r[1]*r[4]*r[15]+r[1]*r[12]*r[7]+r[3]*r[4]*r[13]-r[3]*r[12]*r[5],a[11]=-r[0]*r[5]*r[11]+r[0]*r[9]*r[7]+r[1]*r[4]*r[11]-r[1]*r[8]*r[7]-r[3]*r[4]*r[9]+r[3]*r[8]*r[5],a[12]=-r[4]*r[9]*r[14]+r[4]*r[13]*r[10]+r[5]*r[8]*r[14]-r[5]*r[12]*r[10]-r[6]*r[8]*r[13]+r[6]*r[12]*r[9],a[13]=r[0]*r[9]*r[14]-r[0]*r[13]*r[10]-r[1]*r[8]*r[14]+r[1]*r[12]*r[10]+r[2]*r[8]*r[13]-r[2]*r[12]*r[9],a[14]=-r[0]*r[5]*r[14]+r[0]*r[13]*r[6]+r[1]*r[4]*r[14]-r[1]*r[12]*r[6]-r[2]*r[4]*r[13]+r[2]*r[12]*r[5],a[15]=r[0]*r[5]*r[10]-r[0]*r[9]*r[6]-r[1]*r[4]*r[10]+r[1]*r[8]*r[6]+r[2]*r[4]*r[9]-r[2]*r[8]*r[5];for(var n=r[0]*a[0]+r[1]*a[4]+r[2]*a[8]+r[3]*a[12],o=0;16>o;o++)a[o]/=n;return i},e.prototype.invert=function(){var t=this.determinant,e=Math.abs(t)>1e-11;if(e){t=1/t;var i=this.rawData[0],r=this.rawData[4],a=this.rawData[8],n=this.rawData[12],o=this.rawData[1],s=this.rawData[5],h=this.rawData[9],l=this.rawData[13],u=this.rawData[2],c=this.rawData[6],d=this.rawData[10],p=this.rawData[14],f=this.rawData[3],_=this.rawData[7],m=this.rawData[11],g=this.rawData[15];this.rawData[0]=t*(s*(d*g-p*m)-h*(c*g-p*_)+l*(c*m-d*_)),this.rawData[1]=-t*(o*(d*g-p*m)-h*(u*g-p*f)+l*(u*m-d*f)),this.rawData[2]=t*(o*(c*g-p*_)-s*(u*g-p*f)+l*(u*_-c*f)),this.rawData[3]=-t*(o*(c*m-d*_)-s*(u*m-d*f)+h*(u*_-c*f)),this.rawData[4]=-t*(r*(d*g-p*m)-a*(c*g-p*_)+n*(c*m-d*_)),this.rawData[5]=t*(i*(d*g-p*m)-a*(u*g-p*f)+n*(u*m-d*f)),this.rawData[6]=-t*(i*(c*g-p*_)-r*(u*g-p*f)+n*(u*_-c*f)),this.rawData[7]=t*(i*(c*m-d*_)-r*(u*m-d*f)+a*(u*_-c*f)),this.rawData[8]=t*(r*(h*g-l*m)-a*(s*g-l*_)+n*(s*m-h*_)),this.rawData[9]=-t*(i*(h*g-l*m)-a*(o*g-l*f)+n*(o*m-h*f)),this.rawData[10]=t*(i*(s*g-l*_)-r*(o*g-l*f)+n*(o*_-s*f)),this.rawData[11]=-t*(i*(s*m-h*_)-r*(o*m-h*f)+a*(o*_-s*f)),this.rawData[12]=-t*(r*(h*p-l*d)-a*(s*p-l*c)+n*(s*d-h*c)),this.rawData[13]=t*(i*(h*p-l*d)-a*(o*p-l*u)+n*(o*d-h*u)),this.rawData[14]=-t*(i*(s*p-l*c)-r*(o*p-l*u)+n*(o*c-s*u)),this.rawData[15]=t*(i*(s*d-h*c)-r*(o*d-h*u)+a*(o*c-s*u))}return e},e.prototype.makeTransform=function(e,i,r){this.appendScale(i.x,i.y,i.z),r.toMatrix3D(t.MathUtil.CALCULATION_MATRIX),this.append(t.MathUtil.CALCULATION_MATRIX),this.rawData[12]=e.x,this.rawData[13]=e.y,this.rawData[14]=e.z,this.rawData[15]=1},e.prototype.recompose=function(e){return t.MathUtil.CALCULATION_QUATERNION.fromEulerAngles(e[1].x,e[1].y,e[1].z),this.makeTransform(e[0],e[2],t.MathUtil.CALCULATION_QUATERNION),!0},e.prototype.transformVector=function(e,i){void 0===i&&(i=null),i||(i=new t.Vector3D);var r=e.x,a=e.y,n=e.z;return i.x=r*this.rawData[0]+a*this.rawData[4]+n*this.rawData[8]+this.rawData[12],i.y=r*this.rawData[1]+a*this.rawData[5]+n*this.rawData[9]+this.rawData[13],i.z=r*this.rawData[2]+a*this.rawData[6]+n*this.rawData[10]+this.rawData[14],i.w=r*this.rawData[3]+a*this.rawData[7]+n*this.rawData[11]+this.rawData[15],i},e.prototype.transformVector4=function(e,i){void 0===i&&(i=null),i||(i=new t.Vector3D);var r=e.x,a=e.y,n=e.z,o=e.w;return i.x=r*this.rawData[0]+a*this.rawData[4]+n*this.rawData[8]+o*this.rawData[12],i.y=r*this.rawData[1]+a*this.rawData[5]+n*this.rawData[9]+o*this.rawData[13],i.z=r*this.rawData[2]+a*this.rawData[6]+n*this.rawData[10]+o*this.rawData[14],i.w=r*this.rawData[3]+a*this.rawData[7]+n*this.rawData[11]+o*this.rawData[15],i},e.prototype.mat3TransformVector=function(e,i){void 0===i&&(i=null),i||(i=new t.Vector3D);var r=e.x,a=e.y,n=e.z;return i.x=r*this.rawData[0]+a*this.rawData[4]+n*this.rawData[8],i.y=r*this.rawData[1]+a*this.rawData[5]+n*this.rawData[9],i.z=r*this.rawData[2]+a*this.rawData[6]+n*this.rawData[10],i},e.prototype.transformPlane=function(i){var r=new e;r.copyFrom(this),r.invert(),r.transpose();var a=new t.Vector3D(i.a,i.b,i.c,i.d);a.copyFrom(r.transformVector(a));var n=new t.Plane3D;return n.a=a.x,n.b=a.y,n.c=a.z,n.d=a.w/Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z),n},e.prototype.transpose=function(){for(var t=0;t<e.helpMatrix.rawData.length;t++)e.helpMatrix.rawData[t]=this.rawData[t];this.rawData[1]=e.helpMatrix.rawData[4],this.rawData[2]=e.helpMatrix.rawData[8],this.rawData[3]=e.helpMatrix.rawData[12],this.rawData[4]=e.helpMatrix.rawData[1],this.rawData[6]=e.helpMatrix.rawData[9],this.rawData[7]=e.helpMatrix.rawData[13],this.rawData[8]=e.helpMatrix.rawData[2],this.rawData[9]=e.helpMatrix.rawData[6],this.rawData[11]=e.helpMatrix.rawData[14],this.rawData[12]=e.helpMatrix.rawData[3],this.rawData[13]=e.helpMatrix.rawData[7],this.rawData[14]=e.helpMatrix.rawData[11]},e.getAxisRotation=function(t,i,r,a){var n,o,s=new e,h=a*(Math.PI/180),l=Math.cos(h),u=Math.sin(h),c=1-l;return s.rawData[0]=l+t*t*c,s.rawData[5]=l+i*i*c,s.rawData[10]=l+r*r*c,n=t*i*c,o=r*u,s.rawData[1]=n+o,s.rawData[4]=n-o,n=t*r*c,o=i*u,s.rawData[8]=n+o,s.rawData[2]=n-o,n=i*r*c,o=t*u,s.rawData[9]=n-o,s.rawData[6]=n+o,s},Object.defineProperty(e.prototype,"determinant",{get:function(){return(this.rawData[0]*this.rawData[5]-this.rawData[4]*this.rawData[1])*(this.rawData[10]*this.rawData[15]-this.rawData[14]*this.rawData[11])-(this.rawData[0]*this.rawData[9]-this.rawData[8]*this.rawData[1])*(this.rawData[6]*this.rawData[15]-this.rawData[14]*this.rawData[7])+(this.rawData[0]*this.rawData[13]-this.rawData[12]*this.rawData[1])*(this.rawData[6]*this.rawData[11]-this.rawData[10]*this.rawData[7])+(this.rawData[4]*this.rawData[9]-this.rawData[8]*this.rawData[5])*(this.rawData[2]*this.rawData[15]-this.rawData[14]*this.rawData[3])-(this.rawData[4]*this.rawData[13]-this.rawData[12]*this.rawData[5])*(this.rawData[2]*this.rawData[11]-this.rawData[10]*this.rawData[3])+(this.rawData[8]*this.rawData[13]-this.rawData[12]*this.rawData[9])*(this.rawData[2]*this.rawData[7]-this.rawData[6]*this.rawData[3])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return new t.Vector3D(this.rawData[12],this.rawData[13],this.rawData[14])},set:function(t){this.rawData[12]=t.x,this.rawData[13]=t.y,this.rawData[14]=t.z},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return new t.Vector3D(this.rawData[0],this.rawData[5],this.rawData[10])},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return"matrix3d("+Math.round(1e3*this.rawData[0])/1e3+","+Math.round(1e3*this.rawData[1])/1e3+","+Math.round(1e3*this.rawData[2])/1e3+","+Math.round(1e3*this.rawData[3])/1e3+","+Math.round(1e3*this.rawData[4])/1e3+","+Math.round(1e3*this.rawData[5])/1e3+","+Math.round(1e3*this.rawData[6])/1e3+","+Math.round(1e3*this.rawData[7])/1e3+","+Math.round(1e3*this.rawData[8])/1e3+","+Math.round(1e3*this.rawData[9])/1e3+","+Math.round(1e3*this.rawData[10])/1e3+","+Math.round(1e3*this.rawData[11])/1e3+","+Math.round(1e3*this.rawData[12])/1e3+","+Math.round(1e3*this.rawData[13])/1e3+","+Math.round(1e3*this.rawData[14])/1e3+","+Math.round(1e3*this.rawData[15])/1e3+")"},e.prototype.lerp=function(t,e,i){this.copyFrom(e).sub(t).mult(i).add(t)},e.helpMatrix=new e,e}();t.Matrix4_4=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.eyeSpace=1,this.eyePosition=new t.Vector3D,this.eyeRotation=new t.Vector3D(0,1,0),this.eyeFocalLength=180,this.leftPos=new t.Vector3D,this.rightPos=new t.Vector3D,this.targetPos=new t.Vector3D(0,0,this.eyeFocalLength),this.lookAtPos=new t.Vector3D,this.quaternion=new t.Quaternion,this.dir=new t.Vector3D,this.leftEyeMatrix=new t.Matrix4_4,this.rightEyeMatrix=new t.Matrix4_4}return e.prototype.update=function(e){e.globalOrientation.transformVector(t.Vector3D.X_AXIS,this.dir),this.dir.normalize(),this.leftEyeMatrix.copyFrom(e.modelMatrix),this.rightEyeMatrix.copyFrom(e.modelMatrix);var i=.5*this.eyeSpace;this.leftEyeMatrix.appendTranslation(-this.dir.x*i,-this.dir.y*i,-this.dir.z*i),this.rightEyeMatrix.appendTranslation(this.dir.x*i,this.dir.y*i,this.dir.z*i)},e}();t.EyesMatrix=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){}return t.BACK=0,t.FRONT=1,t.IN=0,t.OUT=1,t.INTERSECT=2,t}();t.PlaneClassification=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.quaternion2matrix=function(i,r){void 0===r&&(r=null);var a=i.x,n=i.y,o=i.z,s=i.w,h=a*a,l=a*n,u=a*o,c=a*s,d=n*n,p=n*o,f=n*s,_=o*o,m=o*s,g=e.RAW_DATA_CONTAINER;return g[0]=1-2*(d+_),g[1]=2*(l+m),g[2]=2*(u-f),g[4]=2*(l-m),g[5]=1-2*(h+_),g[6]=2*(p+c),g[8]=2*(u+f),g[9]=2*(p-c),g[10]=1-2*(h+d),g[3]=g[7]=g[11]=g[12]=g[13]=g[14]=0,g[15]=1,r?(r.copyRawDataFrom(g),r):new t.Matrix4_4(new Float32Array(g))},e.getForward=function(e,i){return void 0===i&&(i=null),null===i&&(i=new t.Vector3D(0,0,0)),e.copyRowTo(2,i),i.normalize(),i},e.getUp=function(e,i){return void 0===i&&(i=null),null===i&&(i=new t.Vector3D(0,0,0)),e.copyRowTo(1,i),i.normalize(),i},e.getRight=function(e,i){return void 0===i&&(i=null),null===i&&(i=new t.Vector3D(0,0,0)),e.copyRowTo(0,i),i.normalize(),i},e.compare=function(t,i){var r=e.RAW_DATA_CONTAINER,a=i.rawData;t.copyRawDataTo(r);for(var n=0;16>n;++n)if(r[n]!=a[n])return!1;return!0},e.reflection=function(i,r){void 0===r&&(r=null),null===r&&(r=new t.Matrix4_4);var a=i.a,n=i.b,o=i.c,s=i.d,h=e.RAW_DATA_CONTAINER,l=-2*a*n,u=-2*a*o,c=-2*n*o;return h[0]=1-2*a*a,h[4]=l,h[8]=u,h[12]=-2*a*s,h[1]=l,h[5]=1-2*n*n,h[9]=c,h[13]=-2*n*s,h[2]=u,h[6]=c,h[10]=1-2*o*o,h[14]=-2*o*s,h[3]=0,h[7]=0,h[11]=0,h[15]=1,r.copyRawDataFrom(h),r},e.getTranslation=function(e,i){return void 0===i&&(i=null),i||(i=new t.Vector3D),e.copyRowTo(3,i),i},e.clampf=function(t,e,i){if(e>i){var r=e;e=i,i=r}return e>t?e:i>t?t:i},e.ScreenToPosition=function(t,e,i){return(t+.5*e)/i*2-1},e.PositionToScreen=function(t,e,i){return.5*(t+1)*i-.5*e},e.RADIANS_TO_DEGREES=180/Math.PI,e.DEGREES_TO_RADIANS=Math.PI/180,e.MAX_VALUE=2147483647,e.MIN_VALUE=-2147483647,e.RAW_DATA_CONTAINER=new Float32Array(16),e.CALCULATION_MATRIX=new t.Matrix4_4,e.CALCULATION_QUATERNION=new t.Quaternion,e.CALCULATION_VECTOR3D=new t.Vector3D,e}();t.MathUtil=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e,i){void 0===e&&(e=new t.Vector3D),void 0===i&&(i=new t.Vector3D),this.origin=new t.Vector3D,this.dir=new t.Vector3D,this.invViewMat=new t.Matrix4_4,this.origin.copyFrom(e),this.dir.copyFrom(i)}return e.prototype.IntersectTriangle=function(t,e,i,r){void 0===r&&(r=null);var a,n=e.subtract(t),o=i.subtract(t),s=this.dir.crossProduct(o),h=n.dotProduct(s);if(h>0?a=this.origin.subtract(t):(a=t.subtract(this.origin),h=-h),1e-4>h)return!1;var l=a.dotProduct(s);if(null!=r&&(r[1]=l),0>l||l>h)return!1;var u=a.crossProduct(n),c=this.dir.dotProduct(u);if(null!=r&&(r[2]=c),0>c||l+c>h)return!1;var d=o.dotProduct(u),p=1/h;return d*=p,l*=p,c*=p,null!=r&&(r[0]=d,r[1]=l,r[2]=c),0>d?!1:!0},e.prototype.IntersectMeshEx=function(t,e,i){return this.IntersectMesh(t.geometry.vertexArray,t.geometry.indexArray,t.geometry.vertexAttLength,t.geometry.faceCount,e,t.modelMatrix,i)},e.prototype.IntersectMesh=function(e,i,r,a,n,o,s){var h=new Array;h.push(new t.Vector3D),h.push(new t.Vector3D),h.push(new t.Vector3D);var l=new Array;l.push(new t.Vector3D),l.push(new t.Vector3D),l.push(new t.Vector3D);var u=new Array,c=new t.Vector3D,d=new t.Vector3D,p=new t.Vector3D;u.push(c),u.push(d),u.push(p);var f=new t.Vector3D,_=new t.Point,m=new Array;m.push(0),m.push(0),m.push(0);for(var g=-1,v=t.MathUtil.MAX_VALUE,y=0,x=0,b=0;a>b;++b){for(var D=0;3>D;++D){var T=i[3*b+D];f.setTo(e[r*T+0],e[r*T+1],e[r*T+2]),f.copyFrom(o.transformVector(f)),u[D].x=f.x,u[D].y=f.y,u[D].z=f.z}this.IntersectTriangle(c,d,p,m)&&m[0]<v&&(g=b,v=m[0],y=m[1],x=m[2])}if(a>g&&g>=0){for(var b=0;3>b;++b){var T=i[3*g+b];f.setTo(e[r*T+0],e[r*T+1],e[r*T+2]),h[b].copyFrom(f),n>0&&(_.x=e[r*T+0+n],_.y=e[r*T+1+n],l[b].x=_.x,l[b].y=_.y),f.copyFrom(o.transformVector(f)),u[b].x=f.x,u[b].y=f.y,u[b].z=f.z}s.faceIndex=g,s.v0=i[3*g+0],s.v1=i[3*g+1],s.v2=i[3*g+2];var w=d.subtract(c);w.scaleBy(y);var P=p.subtract(c);return P.scaleBy(x),s.globalPosition.copyFrom(c.add(w.add(P))),w=h[1].subtract(h[0]),w.scaleBy(y),P=h[2].subtract(h[0]),P.scaleBy(x),s.localPosition.copyFrom(h[0].add(w.add(P))),n>0&&(w=l[1].subtract(l[0]),w.scaleBy(y),P=l[2].subtract(l[0]),P.scaleBy(x),s.uv.copyFrom(l[0].add(w.add(P)))),!0}return!1},e.prototype.CalculateAndTransformRay=function(t,e,i,r,a,n){this.reset(),this.dir.x=(2*a/t-1)/r.rawData[0],this.dir.y=(-2*n/e+1)/r.rawData[5],this.dir.z=1,this.invViewMat.copyFrom(i),this.origin.copyFrom(this.invViewMat.transformVector(this.origin)),this.dir.copyFrom(this.invViewMat.deltaTransformVector(this.dir)),this.dir.normalize()},e.prototype.reset=function(){this.origin.setTo(0,0,0),this.dir.setTo(0,0,0)},e}();t.Ray=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=255),this.a=255,this.r=255,this.g=255,this.b=255,this.a=r,this.r=t,this.g=e,this.b=i}return e.white=function(){return new e(255,255,255,255)},e.black=function(){return new e(0,0,0,255)},e.red=function(){return new e(255,0,0,255)},e.green=function(){return new e(0,255,0,255)},e.blue=function(){return new e(0,0,255,255)},e.prototype.getColor=function(e){return void 0===e&&(e=t.ContextConfig.ColorFormat_RGBA8888),e==t.ContextConfig.ColorFormat_RGB565?0:e==t.ContextConfig.ColorFormat_RGBA5551?0:e==t.ContextConfig.ColorFormat_RGBA4444?0:this.r<<24|this.g<<16|this.b<<8|this.a},e.prototype.lerp=function(t,e,i){this.a=i*(e.a-t.a)+t.a,this.r=i*(e.r-t.r)+t.r,this.g=i*(e.g-t.g)+t.g,this.b=i*(e.b-t.b)+t.b,this.a=Math.floor(this.a),this.r=Math.floor(this.r),this.g=Math.floor(this.g),this.b=Math.floor(this.b)},e.prototype.copyFrom=function(t){this.a=t.a,this.r=t.r,this.g=t.g,this.b=t.b},e.prototype.setTo=function(t,e,i,r){void 0===t&&(t=255),void 0===e&&(e=255),void 0===i&&(i=255),void 0===r&&(r=255),this.a=t,this.r=e,this.g=i,this.b=r},e.createColor=function(t){var i=new e;return i.setColorARGB(t),i},e.prototype.setColorARGB=function(t){this.a=t/16777216,this.a>>=0,this.r=16711680&t,this.r>>=16,this.g=65280&t,this.g>>=8,this.b=255&t},e.prototype.setColorRGB=function(t){this.r=16711680&t,this.r>>=16,this.g=65280&t,this.g>>=8,this.b=255&t},e.prototype.randomColor=function(t,e,i){if(void 0===i&&(i=!1),i){var r=Math.random();this.a=t.a+(e.a-t.a)*r,this.r=t.r+(e.r-t.r)*r,this.g=t.g+(e.g-t.g)*r,this.b=t.b+(e.b-t.b)*r}else this.a=t.a+(e.a-t.a)*Math.random(),this.r=t.r+(e.r-t.r)*Math.random(),this.g=t.g+(e.g-t.g)*Math.random(),this.b=t.b+(e.b-t.b)*Math.random();this.a=Math.floor(this.a),this.r=Math.floor(this.r),this.g=Math.floor(this.g),this.b=Math.floor(this.b)},e}();t.Color=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.colors=[],this.times=[]}return e.prototype.lerpColor=function(e,i){void 0===i&&(i=null),0>e?e=0:e>1&&(e=1),null==i&&(i=new t.Color);for(var r=0,a=this.times.length-1;a>r;r++)if(e>=this.times[r]&&e<this.times[r+1]){e=(e-this.times[r])/(this.times[r+1]-this.times[r]),i.lerp(this.colors[r],this.colors[r+1],e);break}return i},e}();t.ColorGradients=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e){this.vexLength=3,this._bound=new t.Wireframe,this.matrix=new t.Matrix4_4,this.temp=new t.Vector3D,this.owner=e,this._bound.material.diffuseColor=16777215,this._bound.name="Bound",this._bound.geometry.vertexCount=8,this._bound.geometry.indexCount=24,this._bound.geometry.setVertexIndices(0,[0,1,1,2,2,3,0,3,4,5,5,6,6,7,4,7,0,4,1,5,3,7,2,6])}return Object.defineProperty(e.prototype,"visible",{get:function(){return this._bound.parent?!0:!1},set:function(t){t?this._bound.parent||this.owner.addChild(this._bound):this._bound.parent&&this._bound.parent.removeChild(this._bound)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transform",{get:function(){return this.owner?this.owner.modelMatrix:this.matrix},enumerable:!0,configurable:!0}),e.prototype.pointIntersect=function(){return!1},e.prototype.intersect=function(t,e){return void 0===e&&(e=null),!0},e.prototype.clone=function(){var t=new e(this.owner);return t.copyVertex(this),t},e.prototype.calculateTransform=function(){for(var t=0;t<this.vexData.length;t+=3)this.temp.setTo(this.vexData[t],this.vexData[t+1],this.vexData[t+2]),this.transform.transformVector(this.temp,this.temp),this.vexData[t+0]=this.temp.x,this.vexData[t+1]=this.temp.y,this.vexData[t+2]=this.temp.z},e.prototype.copyVertex=function(t){for(var e=0;e<t.vexData.length;++e)this.vexData[e]=t.vexData[e];for(var e=0;e<t.indexData.length;++e)this.indexData[e]=t.indexData[e];this.vexLength=t.vexLength},e.prototype.createChild=function(){this.childBound=new e(this.owner)},e.prototype.inBound=function(){return!0},e.prototype.updateAABB=function(){},e}();t.Bound=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(t){void 0===t&&(t=!1),this.data=[],this.list=new Array,t&&(this.list=new Array)}return t.prototype.isHas=function(t){return this.data[t]?!0:!1},t.prototype.getValue=function(t){return this.data[t]},t.prototype.getList=function(){return this.list},t.prototype.add=function(t,e){this.data[t]=e,this.list&&this.list.push(e)},t.prototype.remove=function(t){if(this.list){var e=this.list.indexOf(this.data[t]);-1!=e&&this.list.splice(e)}delete this.data[t]},t.prototype.dispose=function(){delete this.data,delete this.list},t}();t.HashMap=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r,a){void 0===i&&(i=null),void 0===r&&(r=new t.Vector3D),void 0===a&&(a=new t.Vector3D),e.call(this,i),this.min=new t.Vector3D,this.max=new t.Vector3D,this.width=0,this.heigth=0,this.depth=0,this.volume=0,this.center=new t.Vector3D,this.radius=0,this.min.copyFrom(r),this.max.copyFrom(a),this.calculateBox()}return __extends(i,e),i.prototype.copyFrom=function(t){this.min.copyFrom(t.min),this.max.copyFrom(t.max),this.calculateBox()},i.prototype.fillBox=function(t,e){this.min.copyFrom(t),this.max.copyFrom(e),this.calculateBox()},i.prototype.pointIntersect=function(t){return t.x<=this.max.x&&t.x>=this.min.x&&t.y<=this.max.y&&t.y>=this.min.y&&t.z<=this.max.z&&t.z>=this.min.z?!0:!1},i.prototype.intersectAABBs=function(t,e){return void 0===e&&(e=null),this.min.x>t.max.x?!1:this.max.x<t.min.x?!1:this.min.y>t.max.y?!1:this.max.y<t.min.y?!1:this.min.z>t.max.z?!1:this.max.z<t.min.z?!1:(null!=e&&(e.min.x=Math.max(this.min.x,t.min.x),e.max.x=Math.min(this.max.x,t.max.x),e.min.y=Math.max(this.min.y,t.min.y),e.max.y=Math.min(this.max.y,t.max.y),e.min.z=Math.max(this.min.z,t.min.z),e.max.z=Math.min(this.max.z,t.max.z),e.calculateBox()),!0)},i.prototype.intersect=function(t,e){return void 0===e&&(e=null),this._box0?(this._box0.copyVertex(this),this._box0.owner=this.owner):this._box0=this.clone(),this._box0.calculateTransform(),this._box0.updateAABB(),this._box1?(this._box1.copyVertex(this),this._box1.owner=t.owner):this._box1=t.clone(),this._box1.calculateTransform(),this._box1.updateAABB(),this._box0.intersectAABBs(this._box1,e)},i.prototype.toString=function(){return"BoundBox [min:("+this.min.x+", "+this.min.y+", "+this.min.z+") max:("+this.max.x+", "+this.max.y+", "+this.max.z+")]"},i.prototype.calculateBox=function(){var e=this.max.subtract(this.min);this.vexData=this.vexData||new Float32Array(24),this.indexData=this.indexData||new Uint16Array(36),this.vexData[0]=this.min.x,this.vexData[1]=this.min.y,this.vexData[2]=this.min.z,this.vexData[3]=this.min.x,this.vexData[4]=this.min.y,this.vexData[5]=this.min.z+e.z,this.vexData[6]=this.min.x+e.x,this.vexData[7]=this.min.y,this.vexData[8]=this.min.z+e.z,this.vexData[9]=this.min.x+e.x,this.vexData[10]=this.min.y,this.vexData[11]=this.min.z,this.vexData[12]=this.max.x-e.x,this.vexData[13]=this.max.y,this.vexData[14]=this.max.z-e.z,this.vexData[15]=this.max.x-e.x,this.vexData[16]=this.max.y,this.vexData[17]=this.max.z,this.vexData[18]=this.max.x,this.vexData[19]=this.max.y,this.vexData[20]=this.max.z,this.vexData[21]=this.max.x,this.vexData[22]=this.max.y,this.vexData[23]=this.max.z-e.z,this.indexData[0]=0,this.indexData[1]=4,this.indexData[2]=7,this.indexData[3]=0,this.indexData[4]=7,this.indexData[5]=3,this.indexData[6]=2,this.indexData[7]=6,this.indexData[8]=5,this.indexData[9]=2,this.indexData[10]=5,this.indexData[11]=1,this.indexData[12]=4,this.indexData[13]=5,this.indexData[14]=6,this.indexData[15]=4,this.indexData[16]=6,this.indexData[17]=7,this.indexData[18]=0,this.indexData[19]=3,this.indexData[20]=2,this.indexData[21]=0,this.indexData[22]=2,this.indexData[23]=1,this.indexData[24]=0,this.indexData[25]=1,this.indexData[26]=5,this.indexData[27]=0,this.indexData[28]=5,this.indexData[29]=4,this.indexData[30]=3,this.indexData[31]=7,this.indexData[32]=6,this.indexData[33]=3,this.indexData[34]=6,this.indexData[35]=2,this.width=this.max.x-this.min.x,this.heigth=this.max.y-this.min.y,this.depth=this.max.z-this.min.z,this.volume=this.width*this.heigth*this.depth;var i=this.max.subtract(this.min);i.scaleBy(.5),this.radius=i.length,this.center.copyFrom(this.min);var r=this.center.add(i);this.center.copyFrom(r);for(var a=0;8>a;++a)this._bound.geometry.setVerticesForIndex(a,t.VertexFormat.VF_POSITION,[this.vexData[3*a+0],this.vexData[3*a+1],this.vexData[3*a+2]],1)},i.prototype.inBound=function(t){return t.inBox(this)},i.prototype.updateAABB=function(){this.min.copyFrom(new t.Vector3D(t.MathUtil.MAX_VALUE,t.MathUtil.MAX_VALUE,t.MathUtil.MAX_VALUE)),this.max.copyFrom(new t.Vector3D(-t.MathUtil.MAX_VALUE,-t.MathUtil.MAX_VALUE,-t.MathUtil.MAX_VALUE));for(var e=0;e<this.vexData.length;e+=this.vexLength)this.max.x<this.vexData[e]&&(this.max.x=this.vexData[e]),this.max.y<this.vexData[e+1]&&(this.max.y=this.vexData[e+1]),this.max.z<this.vexData[e+2]&&(this.max.z=this.vexData[e+2]),this.min.x>this.vexData[e]&&(this.min.x=this.vexData[e]),this.min.y>this.vexData[e+1]&&(this.min.y=this.vexData[e+1]),this.min.z>this.vexData[e+2]&&(this.min.z=this.vexData[e+2])},i.prototype.createChild=function(){this.childBound=new i(this.owner);var e=new t.Vector3D,r=new t.Vector3D;e.x=this.center.x+this.width/4,e.y=this.center.y+this.heigth/4,e.z=this.center.z+this.depth/4,r.x=this.center.x-this.width/4,r.y=this.center.y-this.heigth/4,r.z=this.center.z-this.depth/4,this.childBound.fillBox(r,e)},i.prototype.clone=function(){var t=new i(this.owner);return t.copyVertex(this),t.width=this.width,t.heigth=this.heigth,t.depth=this.depth,t.min.copyFrom(this.min),t.max.copyFrom(this.max),t.volume=this.volume,t.center.copyFrom(this.center),t.radius=this.radius,t},i}(t.Bound);t.BoundBox=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){}return t.prototype.calcBezierY=function(t,e,i){for(var r,a,n,o,s=0;3>s;s++)if(i>=t[s].x&&i<=t[s+1].x){r=t[s],a=e[s],n=t[s+1],o=e[s+1];break}return r||(r=t[t.length-1]),a||(a=e[e.length-1]),n=n||r,o=o||a,i=(i-r.x)/(n.x-r.x),this.cubic_bezier(r.y,a.y,o.y,n.y,i)},t.prototype.calcBezierX=function(t,e,i){for(var r,a,n,o,s=0;3>s;s++)if(i>=t[s].x&&i<=t[s+1].x){r=t[s],a=e[s],n=t[s+1],o=e[s+1];break}return i=(i-r.x)/(n.x-r.x),this.cubic_bezier(r.x,a.x,o.x,n.x,i)},t.prototype.cubic_bezier=function(t,e,i,r,a){return t=this.mix(t,e,a),e=this.mix(e,i,a),i=this.mix(i,r,a),t=this.mix(t,e,a),e=this.mix(e,i,a),t=this.mix(t,e,a)},t.prototype.mix=function(t,e,i){return t*(1-i)+e*i},t}();t.BezierCurve=e;var i=function(){function i(){this.posPoints=[],this.ctrlPoints=[]}return i.prototype.calc=function(t){var e=i.calc.calcBezierY(this.posPoints,this.ctrlPoints,t);return e},i.prototype.trySampler=function(){for(var t=0,e=this.posPoints.length;e>t;t++)if(0!=this.posPoints[t].y||0!=this.ctrlPoints[t].y)return this.doSampler();return null},i.prototype.sampler=function(){return this.doSampler()},i.prototype.doSampler=function(){var t,e,r,a=[],n=[],o=0,s=0,h=9;for(e=0,r=i.SegCount;r>e;e++){a.push(this.posPoints[2*e].y),o=this.posPoints[2*e].x,s=this.posPoints[2*e+1].x,t=(s-o)/h,n.push(t);for(var l=1;h>l;l++)a.push(this.calc(o+t*l));a.push(this.posPoints[2*e+1].y)}var u=new Float32Array(a.length+n.length);for(e=0,r=a.length;r>e;e++)u[e]=a[e];for(var l=0,r=n.length;r>l;e++,l++)u[e]=n[l];return u},i.prototype.validate=function(){null==this.posPoints&&(this.posPoints=[]),null==this.ctrlPoints&&(this.ctrlPoints=[]);var e=0,r=0;for(e=this.posPoints.length/2,r=i.SegCount;r>e;e++)this.posPoints.push(new t.Point(0,0)),this.posPoints.push(new t.Point(1,0));for(e=this.ctrlPoints.length/2,r=i.SegCount;r>e;e++)this.ctrlPoints.push(new t.Point(0,0)),this.ctrlPoints.push(new t.Point(1,0));this.ctrlPoints.length=2*i.SegCount,this.posPoints.length=2*i.SegCount},i.compressFloats=function(e,r){e.length%2==1&&e.push(0);var a=0;a+=5*i.SegCount,a+=2,a+=1,a+=i.SegCount;var n,o,s=new Float32Array(a),h=4096,l=h-1,u=[];u.length=e.length;var c,d=t.MathUtil.MAX_VALUE,p=-d;for(n=0,o=e.length;o>n;n++)c=u[n]=e[n],p=Math.max(c,p),d=Math.min(c,d);var f=p-d;if(f>0){var _=0;for(n=0,o=u.length;o>n;n++)_=u[n],_-=d,_/=f,_*=l,u[n]=Math.floor(_);var m,g;for(n=0,o=u.length/2;o>n;n++)m=u[2*n],g=u[2*n+1],s[n]=m+g/h;s[n]=d,n++,s[n]=f,n++,s[n]=0,n++}else{for(n=0,o=u.length/2;o>n;n++)s[n]=d;s[n]=d,n++,s[n]=f,n++,s[n]=1,n++}for(var v=0,o=i.SegCount;o>v;n++,v++)s[n]=r[v];return s},i.SegCount=2,i.calc=new e,i}();t.BezierData=i}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.m44=new t.Matrix4_4,this.alpha=1}return e.prototype.scale=function(t,e,i,r){void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=1),void 0===r&&(r=1),this.m44.appendScale(t,e,i),this.alpha*=r},e.prototype.offset=function(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),this.m44.appendTranslation(t,e,i),this.alpha+=r},e.prototype.gray=function(){var t=new Float32Array(16);t[0]=.2126,t[1]=.7152,t[2]=.0722,t[3]=1,t[4]=.2126,t[5]=.7152,t[6]=.0722,t[7]=1,t[8]=.2126,t[9]=.7152,t[10]=.0722,t[11]=1,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this.m44.copyRawDataFrom(t,0,!1)},e.prototype.reset=function(){this.m44.identity(),this.alpha=1},e.prototype.multiply=function(t){this.m44.multiply(t.m44),this.alpha*=t.alpha},e.prototype.copyFrom=function(t){this.m44.copyFrom(t.m44),this.alpha=t.alpha},e.prototype.copyTo=function(t){t.copyFrom(this)},e.prototype.setColorRGB=function(t){var e=16711680&t;e>>=16;var i=65280&t;i>>=8;var r=255&t;e/=255,i/=255,r/=255,this.m44.identity(),this.scale(e,i,r,1)},e}();t.ColorTransform=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.localPosition=new t.Vector3D,this.globalPosition=new t.Vector3D,this.uv=new t.Vector3D}return e}();t.PickResult=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this.time=0,this.delay=0,this.eventType=t,this.data=e}return t.ENTER_FRAME="enter_frame",t.RESIZE="resize",t.CHANGE="change",t}();t.Event3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null),t.call(this,e,i)}return __extends(e,t),e.EVENT_PLAY_COMPLETE="event_play_complete",e}(t.Event3D);t.PropertyAnimEvent3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null),t.call(this,e,i)}return __extends(e,t),e.EVENT_PLAY_COMPLETE="event_play_complete",e.EVENT_FRAME_CHANGE="event_frame_change",e}(t.Event3D);t.SkeletonAnimationEvent3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t.Mouse_Left=0]="Mouse_Left",t[t.Mouse_Mid=1]="Mouse_Mid",t[t.Mouse_Right=2]="Mouse_Right"}(t.MouseCode||(t.MouseCode={}));var e=(t.MouseCode,function(t){function e(){t.apply(this,arguments),this.mouseCode=0}return __extends(e,t),e.MOUSE_CLICK="onMouseClick",e.MOUSE_DOWN="onMouseDown",e.MOUSE_UP="onMouseUp",e.MOUSE_MOVE="onMouseMove",e.MOUSE_OVER="onMouseOver",e.MOUSE_OUT="onMouseOut",e.MOUSE_WHEEL="onMouseWheel",e}(t.Event3D));t.MouseEvent3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.TOUCH_MOVE="onTouchMove",e.TOUCH_START="onTouchStart",e.TOUCH_END="onTouchEnd",e}(t.Event3D);t.TouchEvent3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.PICK_CLICK="onPickClick",e.PICK_DOWN="onPickDown",e.PICK_UP="onPickUp",e.PICK_MOVE="onPickMove",e.PICK_WHEEL="onPickWheel",e}(t.Event3D);t.PickEvent3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t.Key_BackSpace=8]="Key_BackSpace",t[t.Key_Tab=9]="Key_Tab",t[t.Key_Clear=12]="Key_Clear",t[t.Key_Enter=13]="Key_Enter",t[t.Key_Shift_L=16]="Key_Shift_L",t[t.Key_Control_L=17]="Key_Control_L",t[t.Key_Alt_L=18]="Key_Alt_L",t[t.Key_Pause=19]="Key_Pause",t[t.Key_CapsLock=20]="Key_CapsLock",t[t.Key_Escape=21]="Key_Escape",t[t.Key_Space=32]="Key_Space",t[t.Key_Prior=33]="Key_Prior",t[t.Key_Next=34]="Key_Next",t[t.Key_End=35]="Key_End",t[t.Key_Home=36]="Key_Home",t[t.Key_Left=37]="Key_Left",t[t.Key_Up=38]="Key_Up",t[t.Key_Right=39]="Key_Right",t[t.Key_Down=40]="Key_Down",t[t.Key_Select=41]="Key_Select",t[t.Key_Print=42]="Key_Print",t[t.Key_Execute=43]="Key_Execute",t[t.Key_Insert=45]="Key_Insert",t[t.Key_Delete=46]="Key_Delete",t[t.Key_Help=47]="Key_Help",t[t.Key_0=48]="Key_0",t[t.Key_1=49]="Key_1",t[t.Key_2=50]="Key_2",t[t.Key_3=51]="Key_3",t[t.Key_4=52]="Key_4",t[t.Key_5=53]="Key_5",t[t.Key_6=54]="Key_6",t[t.Key_7=55]="Key_7",t[t.Key_8=56]="Key_8",t[t.Key_9=57]="Key_9",t[t.Key_A=65]="Key_A",t[t.Key_B=66]="Key_B",t[t.Key_C=67]="Key_C",t[t.Key_D=68]="Key_D",t[t.Key_E=69]="Key_E",t[t.Key_F=70]="Key_F",t[t.Key_G=71]="Key_G",t[t.Key_H=72]="Key_H",t[t.Key_I=73]="Key_I",t[t.Key_J=74]="Key_J",t[t.Key_K=75]="Key_K",t[t.Key_L=76]="Key_L",t[t.Key_M=77]="Key_M",t[t.Key_N=78]="Key_N",t[t.Key_O=79]="Key_O",t[t.Key_P=80]="Key_P",t[t.Key_Q=81]="Key_Q",t[t.Key_R=82]="Key_R",t[t.Key_S=83]="Key_S",t[t.Key_T=84]="Key_T",t[t.Key_U=85]="Key_U",t[t.Key_V=86]="Key_V",t[t.Key_W=87]="Key_W",t[t.Key_X=88]="Key_X",t[t.Key_Y=89]="Key_Y",t[t.Key_Z=90]="Key_Z",t[t.Key_KP_0=96]="Key_KP_0",t[t.Key_KP_1=97]="Key_KP_1",t[t.Key_KP_2=98]="Key_KP_2",t[t.Key_KP_3=99]="Key_KP_3",t[t.Key_KP_4=100]="Key_KP_4",t[t.Key_KP_5=101]="Key_KP_5",t[t.Key_KP_6=102]="Key_KP_6",t[t.Key_KP_7=103]="Key_KP_7",t[t.Key_KP_8=104]="Key_KP_8",t[t.Key_KP_9=105]="Key_KP_9",t[t.Key_Multiply=106]="Key_Multiply",t[t.Key_Add=107]="Key_Add",t[t.Key_Separator=108]="Key_Separator",t[t.Key_Subtract=109]="Key_Subtract",t[t.Key_Decimal=110]="Key_Decimal",t[t.Key_Divide=111]="Key_Divide",t[t.Key_F1=112]="Key_F1",t[t.Key_F2=113]="Key_F2",t[t.Key_F3=114]="Key_F3",t[t.Key_F4=115]="Key_F4",t[t.Key_F5=116]="Key_F5",t[t.Key_F6=117]="Key_F6",t[t.Key_F7=118]="Key_F7",t[t.Key_F8=119]="Key_F8",t[t.Key_F9=120]="Key_F9",t[t.Key_F10=121]="Key_F10",t[t.Key_F11=122]="Key_F11",t[t.Key_F12=123]="Key_F12",t[t.Key_F13=124]="Key_F13",t[t.Key_F14=125]="Key_F14",t[t.Key_F15=126]="Key_F15",t[t.Key_F16=127]="Key_F16",t[t.Key_F17=128]="Key_F17",t[t.Key_F18=129]="Key_F18",t[t.Key_F19=130]="Key_F19",t[t.Key_F20=131]="Key_F20",t[t.Key_F21=132]="Key_F21",t[t.Key_F22=133]="Key_F22",t[t.Key_F23=134]="Key_F23",t[t.Key_F24=135]="Key_F24",t[t.Key_Num_Lock=136]="Key_Num_Lock",t[t.Key_Scroll_Lock=137]="Key_Scroll_Lock"
}(t.KeyCode||(t.KeyCode={}));var e=(t.KeyCode,function(t){function e(){t.apply(this,arguments),this.keyCode=0}return __extends(e,t),e.KEY_CLICK="onKeyClick",e.KEY_DOWN="onKeyDown",e.KEY_UP="onKeyUp",e}(t.Event3D));t.KeyEvent3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t.Portrait_Primary=0]="Portrait_Primary",t[t.Portrait_Secondary=180]="Portrait_Secondary",t[t.Landscape_Primary=-90]="Landscape_Primary",t[t.Landscape_Secondary=90]="Landscape_Secondary"}(t.Orientation||(t.Orientation={}));var e=(t.Orientation,function(t){function e(){t.apply(this,arguments)}return __extends(e,t),Object.defineProperty(e.prototype,"orientation",{get:function(){var t=window.orientation;return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"acceleration",{get:function(){return this._acceleration},set:function(t){this._acceleration=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"accelerationIncludingGravity",{get:function(){return this._accelerationIncludingGravity},set:function(t){this._accelerationIncludingGravity=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationRate",{get:function(){return this._rotationRate},set:function(t){this._rotationRate=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"absolute",{get:function(){return this._absolute},set:function(t){this._absolute=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"beta",{get:function(){return this._beta},set:function(t){this._beta=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gamma",{get:function(){return this._gamma},set:function(t){this._gamma=t},enumerable:!0,configurable:!0}),e.ORIENTATION_CHANGE="onOrientationChange",e.DEVICE_MOTION="onDeviceMotion",e.DEVICE_ORIENTATION="onDeviceOrientation",e}(t.Event3D));t.OrientationEvent3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.LOADER_COMPLETE="onLoadComplete",e.LOADER_PROGRESS="onLoadProgress",e.LOADER_ERROR="onLoadError",e}(t.Event3D);t.LoaderEvent3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.PARSER_COMPLETE="onParserComplete",e}(t.Event3D);t.ParserEvent3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.EMIT_PARTICLE_BIRTH="EMIT_PARTICLE_BIRTH",e.EMIT_PARTICLE_DEATH="EMIT_PARTICLE_DEATH",e}(t.Event3D);t.ParticleEvent3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){this.listeners={}}return t.prototype.dispatchEvent=function(t){var e=this.listeners[t.eventType];if(null!=e){e=e.slice();for(var i=0;i<e.length;i++){var r=e[i];try{t.param=r.param,r.handler.call(r.thisObject,t)}catch(a){window.console&&console.error(a.stack)}}}},t.prototype.addEventListener=function(t,e,r,a,n){void 0===a&&(a=null),void 0===n&&(n=0),null==this.listeners[t]&&(this.listeners[t]=[]);var o=new i(t,r,e,a,n);return o.id=++i.event_id_count,this.listeners[t].push(o),this.listeners[t].sort(function(t,e){return e.priolity-t.priolity}),o.id},t.prototype.removeEventListener=function(t,e,i){if(this.hasEventListener(t,i,e))for(var r=0;r<this.listeners[t].length;r++){var a=this.listeners[t][r];if(a.equalCurrentListener(t,i,e,a.param))return a.handler=null,a.thisObject=null,void this.listeners[t].splice(r,1)}},t.prototype.removeEventListenerAt=function(t){for(var e in this.listeners)for(var i=0;i<this.listeners[e].length;i++){var r=this.listeners[e][i];if(r.id==t)return r.handler=null,r.thisObject=null,void this.listeners[e].splice(i,1)}},t.prototype.clearEventListener=function(){this.listeners={}},t.prototype.containEventListener=function(t){return null==this.listeners[t]?!1:this.listeners[t].length>0},t.prototype.hasEventListener=function(t,e,i){if(void 0===e&&(e=null),void 0===i&&(i=null),null==this.listeners[t])return!1;if(!e||!i)return!0;for(var r=0;r<this.listeners[t].length;r++){var a=this.listeners[t][r];if(a.equalCurrentListener(t,e,i,a.param))return!0}return!1},t}();t.EventDispatcher=e;var i=function(){function t(t,e,i,r,a){void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=0),this.type=t,this.thisObject=e,this.handler=i,this.param=r,this.priolity=a}return t.prototype.equalCurrentListener=function(t,e,i,r){return this.type==t&&this.thisObject==e&&this.handler==i&&this.param==r?!0:!1},t.event_id_count=0,t}()}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e){this._retRenderList=new Array,this._canvas=e,this._pickEvent3d=new t.PickEvent3D,t.Input.addEventListener(t.MouseEvent3D.MOUSE_CLICK,this.onMouseClick,this),t.Input.addEventListener(t.MouseEvent3D.MOUSE_DOWN,this.onMouseDown,this),t.Input.addEventListener(t.MouseEvent3D.MOUSE_UP,this.onMouseUp,this),t.Input.addEventListener(t.MouseEvent3D.MOUSE_MOVE,this.onMouseMove,this),t.Input.addEventListener(t.TouchEvent3D.TOUCH_START,this.onTouchDown,this),t.Input.addEventListener(t.TouchEvent3D.TOUCH_END,this.onTouchUp,this),t.Input.addEventListener(t.TouchEvent3D.TOUCH_MOVE,this.onTouchMove,this)}return Object.defineProperty(e.prototype,"_view3ds",{get:function(){return this._canvas.view3Ds},enumerable:!0,configurable:!0}),e.prototype.onClear=function(){this._canvas=null},e.prototype.onClearListeners=function(){},e.prototype.sendEvent=function(e,i,r){var a=this._canvas;if(a)for(var n=0;n<this._view3ds.length;n++){var o=this._view3ds[n];if(o.entityCollect&&o.entityCollect.mousePickList){var s=o.entityCollect.mousePickList,h=t.Picker.pickObject3DList(a,o,s,!1,this._retRenderList),l=h.length;if(!(0>=l)){for(var u=null,c=t.MathUtil.MAX_VALUE,d=0,p=null,f=!1,_=0;l>_;_++)p=h[_],d=t.Vector3D.distance(p.globalPosition,o.camera3D.globalPosition),c>d&&(c=d,u=h[_]),p.mouseChildren&&(f=p.mouseChildren);if(h.length>0)if(1==h.length&&u)u.dispatchEvent(r.call(this,i,e,u));else if(f)if(h=t.Picker.pickObject3DList(a,o,h,!0,this._retRenderList),c=t.MathUtil.MAX_VALUE,l=h.length,0>=l)u&&u.dispatchEvent(r.call(this,i,e,u));else{u=null;for(var _=0;l>_;_++)p=h[_],d=t.Vector3D.distance(p.globalPosition,o.camera3D.globalPosition),c>d&&(c=d,u=h[_]);u&&u.dispatchEvent(r.call(this,i,e,u))}else u&&u.dispatchEvent(r.call(this,i,e,u))}}}},e.prototype.initPickEvent3D=function(t,e,i){return this._pickEvent3d.eventType=t,this._pickEvent3d.target=i,this._pickEvent3d.data=e,this._pickEvent3d.pickResult=i.pickResult,this._pickEvent3d},e.prototype.onTouchMove=function(e){this.sendEvent(e,t.PickEvent3D.PICK_MOVE,this.initPickEvent3D)},e.prototype.onTouchUp=function(e){this.sendEvent(e,t.PickEvent3D.PICK_UP,this.initPickEvent3D)},e.prototype.onTouchDown=function(e){this.sendEvent(e,t.PickEvent3D.PICK_DOWN,this.initPickEvent3D)},e.prototype.onMouseClick=function(e){this.sendEvent(e,t.PickEvent3D.PICK_CLICK,this.initPickEvent3D)},e.prototype.onMouseDown=function(e){this.sendEvent(e,t.PickEvent3D.PICK_DOWN,this.initPickEvent3D)},e.prototype.onMouseUp=function(e){this.sendEvent(e,t.PickEvent3D.PICK_UP,this.initPickEvent3D)},e.prototype.onMouseMove=function(e){this.sendEvent(e,t.PickEvent3D.PICK_MOVE,this.initPickEvent3D)},e}();t.EventManager=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(t){this.index=0,this.shadersName=new Array,this.endShadername="",this.stateChange=!1,this.maxBone=0,this.shaderType=-1,this.shaderType=t}return e.prototype.addUseShaderName=function(t){this.shadersName.push(t)},e.prototype.addEndShaderName=function(t){this.endShadername=t},e.prototype.getShader=function(e){if(""!=this.endShadername){var i=this.shadersName.indexOf(this.endShadername);-1==i&&this.shadersName.push(this.endShadername)}return t.ShaderUtil.instance.fillShaderContent(this,this.shadersName,e)},e}();t.ShaderBase=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(){function t(){this.varName="",this.name="",this.key="",this.valueType="",this.value="",this.activeTextureIndex=-1,this.index=-1,this.level="",this.size=0,this.dataType=0,this.normalized=!1,this.stride=0,this.offset=0,this.offsetIndex=0,this.offsetBytes=0}return t.prototype["var"]=function(t){return this.level+" "+this.valueType+" "+name+"."+t},t.prototype.use=function(t){return void 0===t&&(t=""),""!=t?this.name+"."+t:this.name},t.prototype.clone=function(){var e=new t;return e.name=this.name,e.valueType=this.valueType,e.level=this.level,e.varName=this.varName,e.value=this.value,e.key=this.key,e},t.prototype.computeVarName=function(){var t=this.name.indexOf("[");this.varName=t>=0?this.name.substr(0,t):this.name},t}();t.VarRegister=e}(e=t.GLSL||(t.GLSL={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(t){function e(e,i){t.call(this),this.name=e,this.computeVarName(),this.key="attribute",this.valueType=i}return __extends(e,t),e}(t.VarRegister);t.Attribute=e}(e=t.GLSL||(t.GLSL={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(){function t(){}return t["int"]="int",t["float"]="float",t.vec2="vec2",t.vec3="vec3",t.vec4="vec4",t.mat2="mat2",t.mat3="mat3",t.mat4="mat4",t}();t.AttributeType=e}(e=t.GLSL||(t.GLSL={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(t){function e(e,i,r){t.call(this),this.name=e,this.computeVarName(),this.key="const",this.valueType=i,this.value=r}return __extends(e,t),e}(t.VarRegister);t.ConstVar=e}(e=t.GLSL||(t.GLSL={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(t){function e(e){t.call(this),this.name=e,this.computeVarName(),this.key="sampler2D"}return __extends(e,t),e}(t.VarRegister);t.Sampler2D=e}(e=t.GLSL||(t.GLSL={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(t){function e(e){t.call(this),this.name=e,this.computeVarName(),this.key="samplerCube"}return __extends(e,t),e}(t.VarRegister);t.Sampler3D=e}(e=t.GLSL||(t.GLSL={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(t){function e(e,i){t.call(this),this.name=e,this.computeVarName(),this.key="",this.valueType=i}return __extends(e,t),e}(t.VarRegister);t.TmpVar=e}(e=t.GLSL||(t.GLSL={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(t){function e(e,i){t.call(this),this.name=e,this.computeVarName(),this.key="uniform",this.valueType=i}return __extends(e,t),e}(t.VarRegister);t.Uniform=e}(e=t.GLSL||(t.GLSL={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(){function t(){}return t.bool="bool",t["int"]="int",t["float"]="float",t.vec2="vec2",t.vec3="vec3",t.vec4="vec4",t.bvec2="bvec2",t.bvec3="bvec3",t.bvec4="bvec4",t.ivec2="ivec2",t.ivec3="ivec3",t.ivec4="ivec4",t.mat2="mat2",t.mat3="mat3",t.mat4="mat4",t.sampler2D="sampler2D",t.sampleCube="sampleCube",t}();t.UniformType=e}(e=t.GLSL||(t.GLSL={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(){function t(){}return t.attribute_position="attribute_position",t.attribute_normal="attribute_normal",t.attribute_tangent="attribute_tangent",t.attribute_vertexColor="attribute_vertexColor",t.attribute_uv0="attribute_uv0",t.attribute_uv1="attribute_uv1",t.varying_pos="varying_pos",t.varying_normal="varying_normal",t.varying_tangent="varying_tangent",t.varying_color="varying_color",t.varying_uv0="varying_uv0",t.varying_uv1="varying_uv1",t.varying_globalPos="varying_globalPos",t.varying_lightDir="varying_lightDir",t.varying_eye="varying_eye",t.uniform_floatv_0="uniform_floatv_0",t.uniform_floatv_1="uniform_floatv_1",t.uniform_floatv_2="uniform_floatv_2",t.uniform_iv_0="uniform_iv_0",t.uniform_iv_1="uniform_iv_1",t.uniform_iv_2="uniform_iv_2",t.uniform_bv_0="uniform_bv_0",t.uniform_bv_1="uniform_bv_1",t.uniform_bv_2="uniform_bv_2",t.uniform_vec2fv_0="uniform_vec2fv_0",t.uniform_vec2fv_1="uniform_vec2fv_1",t.uniform_vec2fv_2="uniform_vec2fv_2",t.uniform_vec3fv_0="uniform_vec3fv_0",t.uniform_vec3fv_1="uniform_vec3fv_1",t.uniform_vec3fv_2="uniform_vec3fv_2",t.uniform_vec4fv_0="uniform_vec4fv_0",t.uniform_vec4fv_1="uniform_vec4fv_1",t.uniform_vec4fv_2="uniform_vec4fv_2",t.uniform_vec2iv_0="uniform_vec2iv_0",t.uniform_vec2iv_1="uniform_vec2iv_1",t.uniform_vec2iv_2="uniform_vec2iv_2",t.uniform_vec3iv_0="uniform_vec3iv_0",t.uniform_vec3iv_1="uniform_vec3iv_1",t.uniform_vec3iv_2="uniform_vec3iv_2",t.uniform_vec4iv_0="uniform_vec4iv_0",t.uniform_vec4iv_1="uniform_vec4iv_1",t.uniform_vec4iv_2="uniform_vec4iv_2",t.uniform_vec2bv_0="uniform_vec2bv_0",t.uniform_vec2bv_1="uniform_vec2bv_1",t.uniform_vec2bv_2="uniform_vec2bv_2",t.uniform_vec3bv_0="uniform_vec3bv_0",t.uniform_vec3bv_1="uniform_vec3bv_1",t.uniform_vec3bv_2="uniform_vec3bv_2",t.uniform_vec4bv_0="uniform_vec4bv_0",t.uniform_vec4bv_1="uniform_vec4bv_1",t.uniform_vec4bv_2="uniform_vec4bv_2",t.uniform_modelMatrix="uniform_modelMatrix",t.uniform_projectionMatrix="uniform_projectionMatrix",t.uniform_normalMatrix="uniform_normalMatrix",t.uniform_eye="uniform_eye",t.uniform_lightDir="uniform_lightDir",t.texture2D_0="texture2D_0",t.texture2D_1="texture2D_1",t.texture2D_2="texture2D_2",t.texture2D_3="texture2D_3",t.texture2D_4="texture2D_4",t}();t.VarConstName=e}(e=t.GLSL||(t.GLSL={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(t){function e(e,i){t.call(this),this.name=e,this.computeVarName(),this.key="varying",this.valueType=i}return __extends(e,t),e}(t.VarRegister);t.Varying=e}(e=t.GLSL||(t.GLSL={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(t){function e(e){t.call(this),this.name=e,this.computeVarName(),this.key="#extension"}return __extends(e,t),e}(t.VarRegister);t.Extension=e}(e=t.GLSL||(t.GLSL={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(t){function e(e,i){t.call(this),this.name=e,this.computeVarName(),this.key="#define",this.value=i}return __extends(e,t),e}(t.VarRegister);t.DefineVar=e}(e=t.GLSL||(t.GLSL={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(){function t(){}return t.bool="bool",t["int"]="int",t["float"]="float",t.vec2="vec2",t.vec3="vec3",t.vec4="vec4",t.bvec2="bvec2",t.bvec3="bvec3",t.bvec4="bvec4",t.ivec2="ivec2",t.ivec3="ivec3",t.ivec4="ivec4",t.mat2="mat2",t.mat3="mat3",t.mat4="mat4",t.sampler2D="sampler2D",t.sampleCube="sampleCube",t}();t.VaryingType=e}(e=t.GLSL||(t.GLSL={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){}return t.lib={alphaMask_fs:"uniform sampler2D maskTexture ; \nvoid main(void){ \nfloat maskAlpha = texture2D( maskTexture , uv_0 ).x; \nif(maskAlpha * diffuseColor.w < 0.001){ \ndiscard; \n} \nmaterialSource.alpha *= maskAlpha; \n} \n",AOMap_fs:"uniform sampler2D aoTexture ; \nuniform float aoPower ; \nvoid main(void){ \nfloat ao = texture2D( aoTexture , varying_uv1 ).x ; \ndiffuseColor.xyz *= (ao * aoPower) ; \n} \n",baseShadowPass_fs:"varying vec2 varying_uv0; \nvarying vec4 varying_color; \nvec4 outColor ; \nvec2 uv_0; \nvoid main() { \nuv_0 = varying_uv0; \n} \n",baseShadowPass_vs:"attribute vec3 attribute_position; \nattribute vec2 attribute_uv0; \nattribute vec4 attribute_color; \nuniform mat4 uniform_ProjectionMatrix ; \nvarying vec2 varying_uv0; \nvarying vec4 varying_color; \nvec3 e_position = vec3(0.0, 0.0, 0.0); \nvec4 outPosition ; \nvoid main(void){ \ne_position = attribute_position; \nvarying_color = attribute_color; \nvarying_uv0 = attribute_uv0; \n} \n",base_fs:"#extension GL_OES_standard_derivatives : enable \nvarying vec3 varying_eyeNormal  ; \nvarying vec2 varying_uv0; \nvarying vec4 varying_color; \nuniform mat4 uniform_ViewMatrix ; \nvec4 outColor ; \nvec4 diffuseColor ; \nvec4 specularColor ; \nvec4 ambientColor; \nvec4 light ; \nvec3 normal; \nvec2 uv_0; \nvec3 flatNormals(vec3 pos) { \nvec3 fdx = dFdx(pos); \nvec3 fdy = dFdy(pos); \nreturn normalize(cross(fdx, fdy)); \n} \nvoid main() { \ndiffuseColor  = vec4(1.0,1.0,1.0,1.0); \nspecularColor = vec4(0.0,0.0,0.0,0.0); \nambientColor  = vec4(0.0,0.0,0.0,0.0); \nlight         = vec4(1.0,1.0,1.0,1.0); \nnormal = normalize(varying_eyeNormal) ; \nuv_0 = varying_uv0; \n} \n",base_vs:"attribute vec3 attribute_position; \nattribute vec3 attribute_normal; \nattribute vec4 attribute_color; \nattribute vec2 attribute_uv0; \nvec3 e_position = vec3(0.0, 0.0, 0.0); \nuniform mat4 uniform_ModelMatrix ; \nuniform mat4 uniform_ViewMatrix ; \nuniform mat4 uniform_ProjectionMatrix ; \nvarying vec3 varying_eyeNormal  ; \nvarying vec2 varying_uv0; \nvarying vec4 varying_color; \nvec4 outPosition ; \nmat4 transpose(mat4 inMatrix) { \nvec4 i0 = inMatrix[0]; \nvec4 i1 = inMatrix[1]; \nvec4 i2 = inMatrix[2]; \nvec4 i3 = inMatrix[3]; \nmat4 outMatrix = mat4( \nvec4(i0.x, i1.x, i2.x, i3.x), \nvec4(i0.y, i1.y, i2.y, i3.y), \nvec4(i0.z, i1.z, i2.z, i3.z), \nvec4(i0.w, i1.w, i2.w, i3.w) \n); \nreturn outMatrix; \n} \nmat4 inverse(mat4 m) { \nfloat \na00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3], \na10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3], \na20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3], \na30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3], \nb00 = a00 * a11 - a01 * a10, \nb01 = a00 * a12 - a02 * a10, \nb02 = a00 * a13 - a03 * a10, \nb03 = a01 * a12 - a02 * a11, \nb04 = a01 * a13 - a03 * a11, \nb05 = a02 * a13 - a03 * a12, \nb06 = a20 * a31 - a21 * a30, \nb07 = a20 * a32 - a22 * a30, \nb08 = a20 * a33 - a23 * a30, \nb09 = a21 * a32 - a22 * a31, \nb10 = a21 * a33 - a23 * a31, \nb11 = a22 * a33 - a23 * a32, \ndet = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06; \nreturn mat4( \na11 * b11 - a12 * b10 + a13 * b09, \na02 * b10 - a01 * b11 - a03 * b09, \na31 * b05 - a32 * b04 + a33 * b03, \na22 * b04 - a21 * b05 - a23 * b03, \na12 * b08 - a10 * b11 - a13 * b07, \na00 * b11 - a02 * b08 + a03 * b07, \na32 * b02 - a30 * b05 - a33 * b01, \na20 * b05 - a22 * b02 + a23 * b01, \na10 * b10 - a11 * b08 + a13 * b06, \na01 * b08 - a00 * b10 - a03 * b06, \na30 * b04 - a31 * b02 + a33 * b00, \na21 * b02 - a20 * b04 - a23 * b00, \na11 * b07 - a10 * b09 - a12 * b06, \na00 * b09 - a01 * b07 + a02 * b06, \na31 * b01 - a30 * b03 - a32 * b00, \na20 * b03 - a21 * b01 + a22 * b00) / det; \n} \nvoid main(void){ \ne_position = attribute_position; \nvarying_color = attribute_color; \nvarying_uv0 = attribute_uv0; \n} \n",bezier:"vec2 quadratic_bezier(vec2 A, vec2 B, vec2 C, float t) \n{ \nvec2 D = mix(A, B, t); \nvec2 E = mix(B, C, t); \nreturn mix(D, E, t); \n} \nvec2 cubic_bezier(vec2 A, vec2 B, vec2 C, vec2 D, float t) \n{ \nvec2 E = mix(A, B, t); \nvec2 F = mix(B, C, t); \nvec2 G = mix(C, D, t); \nreturn quadratic_bezier(E, F, G, t); \n} \n",bloom_fs:"varying vec2 varying_uv0; \nuniform sampler2D diffuseTexture; \nvoid main() \n{ \nvec2 uv = vec2(varying_uv0.x,1.0-varying_uv0.y); \nfloat dx = 1.0/float(1024.0); \nfloat dy = 1.0/float(1024.0); \nvec4 outColor ; \nvec4 color = outColor = texture2D(diffuseTexture,uv.xy); \ncolor += texture2D(diffuseTexture,uv.xy+vec2(dx*3.0,0.0)); \ncolor += texture2D(diffuseTexture,uv.xy+vec2(0.0,dy)); \ncolor += texture2D(diffuseTexture,uv.xy+vec2(dx*3.0,dy)); \ncolor += texture2D(diffuseTexture,uv.xy+vec2(0.0,dy*2.0)); \ncolor += texture2D(diffuseTexture,uv.xy+vec2(dx*3.0,dy*2.0)); \ncolor += texture2D(diffuseTexture,uv.xy+vec2(0.0,dy*3.0)); \ncolor += texture2D(diffuseTexture,uv.xy+vec2(dx*3.0,dy*3.0)); \ncolor /= 8.0; \nvec4 cout = vec4(0.0,0.0,0.0,0.0); \nfloat lum = color.x * 0.3 + color.y *0.59 + color.z * 0.11; \nvec4 p = color*(lum/0.1); \np /= vec4(vec4(1.0,1.0,1.0,0.0)+p); \nfloat luml = (p.x+p.y+p.z)/3.0; \nif (luml > 0.8) \n{ \ncout = color ; \n} \ngl_FragColor = cout ; \n} \n",colorGradients_fs:"varying vec4 varying_pos; \nuniform float uniform_colorGradientsSource[10] ; \nvoid main(void){ \nvec3 posStart = vec3(uniform_colorGradientsSource[0], uniform_colorGradientsSource[1], uniform_colorGradientsSource[2]); \nvec3 posEnd = vec3(uniform_colorGradientsSource[3], uniform_colorGradientsSource[4], uniform_colorGradientsSource[5]); \nvec4 color = vec4(uniform_colorGradientsSource[6], uniform_colorGradientsSource[7], uniform_colorGradientsSource[8], uniform_colorGradientsSource[9]); \ncolor.w = color.w * clamp((varying_pos.y - posStart.y) / (posEnd.y - posStart.y), 0.0, 1.0); \ndiffuseColor.xyz = clamp(diffuseColor.xyz / diffuseColor.w,0.0,1.0); \ndiffuseColor.xyz = diffuseColor.xyz * (1.0 - color.w) + color.xyz * color.w; \n} \n  \n",colorTransform_fs:"uniform float uniform_colorTransformAlpha ; \nuniform mat4 uniform_colorTransformM44 ; \nvoid main(){ \ndiffuseColor.xyz = (uniform_colorTransformM44 * vec4(diffuseColor.xyz, 1.0)).xyz; \ndiffuseColor.w *= diffuseColor.w * uniform_colorTransformAlpha; \n} \n",color_fragment:"vec4 diffuseColor ; \nvoid main() { \nif( diffuseColor.w == 0.0 ){ \ndiscard; \n} \ndiffuseColor = vec4(1.0, 1.0, 1.0, 1.0); \nif( diffuseColor.w < materialSource.cutAlpha ){ \ndiscard; \n}else \ndiffuseColor.xyz *= diffuseColor.w ; \n} \n",combin_fs:"uniform sampler2D colorTexture; \nvoid main(void){ \n} \n",cube_fragment:"uniform samplerCube diffuseTexture ; \nvarying vec3 varying_pos; \nvec4 diffuseColor ; \nvoid main() { \nif( diffuseColor.w == 0.0 ){ \ndiscard; \n} \nvec3 uvw = normalize(varying_pos.xyz); \ndiffuseColor = vec4(textureCube(diffuseTexture, uvw.xyz)); \nif( diffuseColor.w < materialSource.cutAlpha ){ \ndiscard; \n}else \ndiffuseColor.xyz *= diffuseColor.w ; \n} \n",cube_vertex:"varying vec3 varying_pos; \nvoid main(void){ \nvarying_pos =  e_position; \n}  \n",detail_Bending_vs:"uniform float uniformTime[4] ; \nvoid main(void){ \ne_position = attribute_position; \nvarying_uv0 = attribute_uv0; \nvarying_color = attribute_color; \nvec4 curve = SmoothTriangleWave(vec4(sin(uniformTime[0]*0.001),1.0,1.0,1.0)); \ne_position.xyz += curve.x * vec3(1.0,0.5,0.0) * ( attribute_color.xyz) ; \n} \n",diffuse_fragment:"uniform sampler2D diffuseTexture; \nvec4 diffuseColor ; \nvoid main() { \ndiffuseColor = texture2D(diffuseTexture , uv_0 ); \nif( diffuseColor.w < materialSource.cutAlpha ){ \ndiscard; \n} \n} \n",diffuse_vertex:"attribute vec3 attribute_normal; \nattribute vec4 attribute_color; \nvarying vec4 varying_mvPose; \nvoid main(void){ \nmat4 mvMatrix = mat4(uniform_ViewMatrix * uniform_ModelMatrix); \nvarying_mvPose = mvMatrix * vec4( e_position , 1.0 )  ; \nmat4 normalMatrix = inverse(mvMatrix) ; \nnormalMatrix = transpose(normalMatrix); \nvarying_eyeNormal = mat3(normalMatrix) * -attribute_normal ; \noutPosition = varying_mvPose ; \nvarying_color = attribute_color; \n} \n",directLight_fragment:"const int max_directLight = 0 ; \nuniform float uniform_directLightSource[9*max_directLight] ; \nvarying vec4 varying_mvPose; \nuniform mat4 uniform_ViewMatrix; \nmat4 normalMatrix ; \nstruct DirectLight{ \nvec3 direction; \nvec3 diffuse; \nvec3 ambient; \n}; \nmat4 transpose(mat4 inMatrix) { \nvec4 i0 = inMatrix[0]; \nvec4 i1 = inMatrix[1]; \nvec4 i2 = inMatrix[2]; \nvec4 i3 = inMatrix[3]; \nmat4 outMatrix = mat4( \nvec4(i0.x, i1.x, i2.x, i3.x), \nvec4(i0.y, i1.y, i2.y, i3.y), \nvec4(i0.z, i1.z, i2.z, i3.z), \nvec4(i0.w, i1.w, i2.w, i3.w) \n); \nreturn outMatrix; \n} \nmat4 inverse(mat4 m) { \nfloat \na00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3], \na10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3], \na20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3], \na30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3], \nb00 = a00 * a11 - a01 * a10, \nb01 = a00 * a12 - a02 * a10, \nb02 = a00 * a13 - a03 * a10, \nb03 = a01 * a12 - a02 * a11, \nb04 = a01 * a13 - a03 * a11, \nb05 = a02 * a13 - a03 * a12, \nb06 = a20 * a31 - a21 * a30, \nb07 = a20 * a32 - a22 * a30, \nb08 = a20 * a33 - a23 * a30, \nb09 = a21 * a32 - a22 * a31, \nb10 = a21 * a33 - a23 * a31, \nb11 = a22 * a33 - a23 * a32, \ndet = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06; \nreturn mat4( \na11 * b11 - a12 * b10 + a13 * b09, \na02 * b10 - a01 * b11 - a03 * b09, \na31 * b05 - a32 * b04 + a33 * b03, \na22 * b04 - a21 * b05 - a23 * b03, \na12 * b08 - a10 * b11 - a13 * b07, \na00 * b11 - a02 * b08 + a03 * b07, \na32 * b02 - a30 * b05 - a33 * b01, \na20 * b05 - a22 * b02 + a23 * b01, \na10 * b10 - a11 * b08 + a13 * b06, \na01 * b08 - a00 * b10 - a03 * b06, \na30 * b04 - a31 * b02 + a33 * b00, \na21 * b02 - a20 * b04 - a23 * b00, \na11 * b07 - a10 * b09 - a12 * b06, \na00 * b09 - a01 * b07 + a02 * b06, \na31 * b01 - a30 * b03 - a32 * b00, \na20 * b03 - a21 * b01 + a22 * b00) / det; \n} \nvoid calculateDirectLight( MaterialSource materialSource ){ \nfloat lambertTerm , specular ; \nvec3 dir ,viewDir = normalize(varying_mvPose.xyz/varying_mvPose.w); \nfor(int i = 0 ; i < max_directLight ; i++){ \nDirectLight directLight ; \ndirectLight.direction = (normalMatrix * vec4(uniform_directLightSource[i*9],uniform_directLightSource[i*9+1],uniform_directLightSource[i*9+2],1.0)).xyz; \ndirectLight.diffuse = vec3(uniform_directLightSource[i*9+3],uniform_directLightSource[i*9+4],uniform_directLightSource[i*9+5]); \ndirectLight.ambient = vec3(uniform_directLightSource[i*9+6],uniform_directLightSource[i*9+7],uniform_directLightSource[i*9+8]); \ndir = normalize(directLight.direction) ; \nlight.xyzw += LightingBlinnPhong(dir,directLight.diffuse,directLight.ambient,normal,viewDir,0.5); \n} \n} \nvoid main() { \nnormalMatrix = inverse(uniform_ViewMatrix); \nnormalMatrix = transpose(normalMatrix); \ncalculateDirectLight( materialSource ); \n} \n",endShadowPass_fs:"void main() { \nif(varying_color.w<=0.0){ \ndiscard; \n} \noutColor.x =  outColor.y = outColor.z = varying_ViewPose.z/varying_ViewPose.w  ; \noutColor.w = 1.0 ; \ngl_FragColor = outColor ; \n} \n",endShadowPass_vs:"void main() { \noutPosition = uniform_ProjectionMatrix * outPosition ; \ngl_Position = outPosition ; \n} \n                       \n",end_fs:"vec4 diffuseColor ; \nvec4 specularColor ; \nvec4 ambientColor; \nvec4 light ; \nvoid main() { \noutColor.xyz = (light.xyz+materialSource.ambient) * diffuseColor.xyz * materialSource.diffuse * varying_color.xyz; \noutColor.w = materialSource.alpha * diffuseColor.w * varying_color.w; \noutColor.xyz *= outColor.w; \ngl_FragColor = outColor; \n} \n",end_vs:"vec4 endPosition ; \nuniform float uniform_materialSource[20]; \nvoid main() { \ngl_PointSize = 50.0; \ngl_PointSize = uniform_materialSource[18]; \ngl_Position = uniform_ProjectionMatrix * outPosition ; \n} \n                       \n",environmentDiffuse_vertex:"void main(){ \n} \n",environmentMapping_fragment:"uniform samplerCube environmentMapTex ; \nuniform float reflectValue; \nvoid main(){ \nvec3 r = reflect(-vec3(0.0,0.0,1.0),  normal  ); \nvec4 reflectiveColor = textureCube(environmentMapTex,r.xyz); \ndiffuseColor.xyz = mix( diffuseColor.xyz,reflectiveColor.xyz, specularColor.y + reflectValue ); \n} \n          \n",expFog_fs:"struct Fog{ \nvec3 fogColor  ; \nfloat globalDensity ; \nvec3 distance ; \n}; \nvarying vec4 varying_pos; \nuniform float uniform_globalFog[7]; \nvoid main(void){ \nFog fog; \nfog.fogColor = vec3(uniform_globalFog[0],uniform_globalFog[1],uniform_globalFog[2]); \nfog.globalDensity = uniform_globalFog[3]; \nfog.distance = vec2(uniform_globalFog[4], uniform_globalFog[5]); \nfloat d = distance(uniform_eyepos,varying_pos.xyz); \nfloat distFog = max( 0.0 , d - fog.distance.x )* fog.distance.y; \nfloat fogFactor = (1.0-exp( -distFog * 0.000001 * fog.globalDensity )) ; \ndiffuseColor.xyz = mix( diffuseColor.xyz  , fog.fogColor , min(fogFactor,1.0) ); \n} \n  \n",expHeightFog_fs:"struct Fog{ \nvec3 fogColor  ; \nfloat globalDensity ; \nfloat fogStartDistance ; \nfloat fogHeightStart ; \nfloat fogAlpha ; \n}; \nvarying vec4 varying_pos; \nuniform float uniform_globalFog[7]; \nvec3 applyFog( float yDistance, vec3  vpos , Fog fog ) \n{ \nfloat d = distance(uniform_eyepos,varying_pos.xyz); \nfloat distFog = max( 0.0 , d - fog.fogStartDistance ) ; \nfloat yFog = max(0.0, (vpos.y - fog.fogHeightStart - yDistance) )  ; \nfloat fogAmount =  1.0-(exp(-distFog * fog.globalDensity )) + (exp(-yFog * fog.globalDensity )); \nreturn mix( diffuseColor.xyz,fog.fogColor, clamp(fogAmount,0.0,fog.fogAlpha) ); \n} \nvoid main(void){ \nFog fog; \nfog.fogColor = vec3(uniform_globalFog[0],uniform_globalFog[1],uniform_globalFog[2]); \nfog.globalDensity = uniform_globalFog[3]; \nfog.fogStartDistance = uniform_globalFog[4] ; \nfog.fogHeightStart = uniform_globalFog[5] ; \nfog.fogAlpha = uniform_globalFog[6] ; \nfloat yd = uniform_eyepos.y - varying_pos.y ; \ndiffuseColor.xyz = applyFog( yd , varying_pos.xyz , fog ); \n} \n  \n",FakePBR:"",FakePBR_fs:"#extension GL_OES_standard_derivatives:enable \n#define max_directLight 1 \nstruct DirectLight{ \nvec3 direction; \nvec3 diffuse; \nvec3 ambient; \n}; \nuniform float uniform_directLightSource[9*max_directLight] ; \nvarying vec4 varying_mvPose; \nvarying vec3 varying_eyeNormal; \nvarying vec2 varying_uv0; \nuniform sampler2D albedoTex; \nuniform sampler2D normalTex; \nuniform sampler2D glossTex; \nuniform sampler2D specularTex; \nuniform sampler2D opacityTex; \nuniform mat4 uniform_ViewMatrix; \nmat3 TBN; \nmat4 normalMatrix ; \nvec3 normalDirection; \nvec3 light; \nvec3 normalTexColor ; \nvec4 opacityTexColor ; \nvec4 glossTexColor ; \nvec4 specularTexColor ; \nvec4 albedoTexColor ; \nvec2 uv_0; \nmat4 transpose(mat4 inMatrix) { \nvec4 i0 = inMatrix[0]; \nvec4 i1 = inMatrix[1]; \nvec4 i2 = inMatrix[2]; \nvec4 i3 = inMatrix[3]; \nmat4 outMatrix = mat4( \nvec4(i0.x, i1.x, i2.x, i3.x), \nvec4(i0.y, i1.y, i2.y, i3.y), \nvec4(i0.z, i1.z, i2.z, i3.z), \nvec4(i0.w, i1.w, i2.w, i3.w) \n); \nreturn outMatrix; \n} \nmat4 inverse(mat4 m) { \nfloat \na00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3], \na10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3], \na20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3], \na30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3], \nb00 = a00 * a11 - a01 * a10, \nb01 = a00 * a12 - a02 * a10, \nb02 = a00 * a13 - a03 * a10, \nb03 = a01 * a12 - a02 * a11, \nb04 = a01 * a13 - a03 * a11, \nb05 = a02 * a13 - a03 * a12, \nb06 = a20 * a31 - a21 * a30, \nb07 = a20 * a32 - a22 * a30, \nb08 = a20 * a33 - a23 * a30, \nb09 = a21 * a32 - a22 * a31, \nb10 = a21 * a33 - a23 * a31, \nb11 = a22 * a33 - a23 * a32, \ndet = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06; \nreturn mat4( \na11 * b11 - a12 * b10 + a13 * b09, \na02 * b10 - a01 * b11 - a03 * b09, \na31 * b05 - a32 * b04 + a33 * b03, \na22 * b04 - a21 * b05 - a23 * b03, \na12 * b08 - a10 * b11 - a13 * b07, \na00 * b11 - a02 * b08 + a03 * b07, \na32 * b02 - a30 * b05 - a33 * b01, \na20 * b05 - a22 * b02 + a23 * b01, \na10 * b10 - a11 * b08 + a13 * b06, \na01 * b08 - a00 * b10 - a03 * b06, \na30 * b04 - a31 * b02 + a33 * b00, \na21 * b02 - a20 * b04 - a23 * b00, \na11 * b07 - a10 * b09 - a12 * b06, \na00 * b09 - a01 * b07 + a02 * b06, \na31 * b01 - a30 * b03 - a32 * b00, \na20 * b03 - a21 * b01 + a22 * b00) / det; \n} \nvec3 unpackNormal(vec4 packednormal) \n{ \nreturn packednormal.xyz * 2.0 - 1.0; \n} \nmat3 cotangentFrame(vec3 N, vec3 p, vec2 uv) { \nvec3 dp1 = dFdx(p); \nvec3 dp2 = dFdy(p); \nvec2 duv1 = dFdx(uv); \nvec2 duv2 = dFdy(uv); \nvec3 dp2perp = cross(dp2, N); \nvec3 dp1perp = cross(N, dp1); \nvec3 T = dp2perp * duv1.x + dp1perp * duv2.x; \nvec3 B = dp2perp * duv1.y + dp1perp * duv2.y; \nfloat invmax = 1.0 / sqrt(max(dot(T,T), dot(B,B))); \nreturn mat3(T * invmax, B * invmax, N); \n} \nvec3 fakePBRLight( vec3 lightDir , vec3 viewDir , vec3 lightColor , vec3 ambient ){ \nvec3 lightDirection = mat3(uniform_ViewMatrix) * normalize(lightDir); \nvec3 halfDirection = normalize( lightDirection + viewDir) ; \nfloat attenuation = 1.0 ; \nvec3 attenColor = attenuation * lightColor; \nfloat Pi = 3.141592654; \nfloat InvPi = 0.31830988618; \nfloat gloss = glossTexColor.r; \nfloat specPow = exp2( gloss * 10.0 + 1.0 ); \nfloat NdotL = max(0.0, dot( normalDirection, lightDirection )); \nfloat specularMonochrome = max( max(specularTexColor.r, specularTexColor.g), specularTexColor.b); \nfloat normTerm = (specPow + 8.0 ) / (8.0 * Pi); \nvec3 directSpecular =  (floor(attenuation) * lightColor ) * pow(max(0.0,dot(halfDirection,normalDirection)),normTerm) * specularTexColor.xyz * normTerm ; \nvec3 specular = directSpecular; \nNdotL = max(0.0,dot( normalDirection , normalize(lightDirection) )); \nvec3 directDiffuse = max( 0.0, NdotL) * attenColor; \nvec3 indirectDiffuse = vec3(0.0,0.0,0.0); \nindirectDiffuse +=  ambient ; \nvec3 diffuseColor = albedoTexColor.rgb; \ndiffuseColor *= 1.0-specularMonochrome; \nvec3 diffuse = (directDiffuse + indirectDiffuse) * diffuseColor; \nvec3 finalColor = diffuse + specular ; \nreturn finalColor ; \n} \nvoid calculateDirectLight(  ){ \nfloat lambertTerm , specular ; \nvec3 dir ,viewDir = normalize(varying_mvPose.xyz/varying_mvPose.w); \nfor(int i = 0 ; i < max_directLight ; i++){ \nDirectLight directLight ; \ndirectLight.direction = vec3(uniform_directLightSource[i*9],uniform_directLightSource[i*9+1],uniform_directLightSource[i*9+2]); \ndirectLight.diffuse = vec3(uniform_directLightSource[i*9+3],uniform_directLightSource[i*9+4],uniform_directLightSource[i*9+5]); \ndirectLight.ambient = vec3(uniform_directLightSource[i*9+6],uniform_directLightSource[i*9+7],uniform_directLightSource[i*9+8]); \ndir = normalize(directLight.direction) ; \nlight.xyz += fakePBRLight( dir , viewDir , directLight.diffuse , directLight.ambient); \n} \n} \nvoid main(void){ \nTBN = cotangentFrame(normalize(varying_eyeNormal), normalize(-varying_mvPose.xyz) , uv_0); \nnormalTexColor = unpackNormal(texture2D(normalTex, uv_0 )) ; \nopacityTexColor = texture2D(opacityTex, uv_0 ) ; \nglossTexColor = texture2D(glossTex, uv_0 ); \nspecularTexColor = texture2D(specularTex, uv_0 ); \nalbedoTexColor = texture2D(albedoTex, uv_0 ); \nnormalDirection = TBN * normalTexColor.xyz ; \nif( (step(materialSource.cutAlpha,opacityTexColor.g) - 0.5) < 0.0 ){ \ndiscard; \n} \ncalculateDirectLight(); \nvec4 finalRGBA = vec4(light,1.0) ; \ngl_FragColor = finalRGBA; \n} \n",FakePBR_vs:"attribute vec3 attribute_position; \nattribute vec3 attribute_normal; \nattribute vec2 attribute_uv0; \nuniform mat4 uniform_ModelMatrix ; \nuniform mat4 uniform_ViewMatrix ; \nuniform mat4 uniform_ProjectionMatrix ; \nvarying vec4 varying_mvPose; \nvarying vec3 varying_eyeNormal; \nvarying vec2 varying_uv0; \nvec4 outPosition; \nmat4 transpose(mat4 inMatrix) { \nvec4 i0 = inMatrix[0]; \nvec4 i1 = inMatrix[1]; \nvec4 i2 = inMatrix[2]; \nvec4 i3 = inMatrix[3]; \nmat4 outMatrix = mat4( \nvec4(i0.x, i1.x, i2.x, i3.x), \nvec4(i0.y, i1.y, i2.y, i3.y), \nvec4(i0.z, i1.z, i2.z, i3.z), \nvec4(i0.w, i1.w, i2.w, i3.w) \n); \nreturn outMatrix; \n} \nmat4 inverse(mat4 m) { \nfloat \na00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3], \na10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3], \na20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3], \na30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3], \nb00 = a00 * a11 - a01 * a10, \nb01 = a00 * a12 - a02 * a10, \nb02 = a00 * a13 - a03 * a10, \nb03 = a01 * a12 - a02 * a11, \nb04 = a01 * a13 - a03 * a11, \nb05 = a02 * a13 - a03 * a12, \nb06 = a20 * a31 - a21 * a30, \nb07 = a20 * a32 - a22 * a30, \nb08 = a20 * a33 - a23 * a30, \nb09 = a21 * a32 - a22 * a31, \nb10 = a21 * a33 - a23 * a31, \nb11 = a22 * a33 - a23 * a32, \ndet = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06; \nreturn mat4( \na11 * b11 - a12 * b10 + a13 * b09, \na02 * b10 - a01 * b11 - a03 * b09, \na31 * b05 - a32 * b04 + a33 * b03, \na22 * b04 - a21 * b05 - a23 * b03, \na12 * b08 - a10 * b11 - a13 * b07, \na00 * b11 - a02 * b08 + a03 * b07, \na32 * b02 - a30 * b05 - a33 * b01, \na20 * b05 - a22 * b02 + a23 * b01, \na10 * b10 - a11 * b08 + a13 * b06, \na01 * b08 - a00 * b10 - a03 * b06, \na30 * b04 - a31 * b02 + a33 * b00, \na21 * b02 - a20 * b04 - a23 * b00, \na11 * b07 - a10 * b09 - a12 * b06, \na00 * b09 - a01 * b07 + a02 * b06, \na31 * b01 - a30 * b03 - a32 * b00, \na20 * b03 - a21 * b01 + a22 * b00) / det; \n} \nvoid main(void){ \nmat4 mvMatrix = mat4(uniform_ViewMatrix * uniform_ModelMatrix); \nvarying_mvPose = mvMatrix * vec4( attribute_position , 1.0 )  ; \nmat4 normalMatrix = inverse(mvMatrix) ; \nnormalMatrix = transpose(normalMatrix); \nvarying_eyeNormal = mat3(normalMatrix) * -attribute_normal ; \nvarying_uv0 = attribute_uv0 ; \noutPosition = uniform_ProjectionMatrix * varying_mvPose ; \ngl_Position = outPosition; \n} \n",flatNormal_fs:"#extension GL_OES_standard_derivatives : enable \nvec3 flatNormal(vec3 pos){ \nvec3 fdx = dFdx(pos); \nvec3 fdy = dFdy(pos); \nreturn normalize(cross(fdx, fdy)); \n} \n",gamma_fs:"const float gamma = 2.2; \nfloat toLinear_float_v1(float v) { \nreturn pow(v, gamma); \n} \nvec2 toLinear_vec2_v1(vec2 v) { \nreturn pow(v, vec2(gamma)); \n} \nvec3 toLinear_vec3_v1(vec3 v) { \nreturn pow(v, vec3(gamma)); \n} \nvec4 toLinear_vec4_v1(vec4 v) { \nreturn vec4(toLinear_vec3_v1(v.rgb), v.a); \n} \nfloat toGamma_float_v2(float v) { \nreturn pow(v, 1.0 / gamma); \n} \nvec2 toGamma_vec2_v2(vec2 v) { \nreturn pow(v, vec2(1.0 / gamma)); \n} \nvec3 toGamma_vec3_v2(vec3 v) { \nreturn pow(v, vec3(1.0 / gamma)); \n} \nvec4 toGamma_vec4_v2(vec4 v) { \nreturn vec4(toGamma_vec3_v2(v.rgb), v.a); \n} \nvec4 textureLinear(sampler2D uTex, vec2 uv) { \nreturn toLinear_vec4_v1(texture2D(uTex, uv)); \n} \n",gaussian_H_fs:"varying vec2 varying_uv0; \nuniform sampler2D diffuseTexture; \nvoid main() \n{ \nvec2 uv = vec2(varying_uv0.x,1.0-varying_uv0.y); \nfloat d = 1.0/float(1024.0); \nvec4 color = vec4(0.0,0.0,0.0,0.0); \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(-8.0*d,0.0))* 0.001; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(-7.0*d,0.0))* 0.105; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(-6.0*d,0.0))* 0.217; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(-5.0*d,0.0))* 0.344; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(-4.0*d,0.0))* 0.492; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(-3.0*d,0.0))* 0.55; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(-2.0*d,0.0))* 0.69; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(-1.0*d,0.0))* 0.70; \ncolor +=     texture2D(diffuseTexture,uv.xy) * 1.0; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(1.0*d,0.0)) * 0.70; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(2.0*d,0.0)) * 0.69; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(3.0*d,0.0)) * 0.55; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(4.0*d,0.0)) * 0.492; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(5.0*d,0.0)) * 0.344; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(6.0*d,0.0)) * 0.217; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(7.0*d,0.0)) * 0.105; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(8.0*d,0.0)) * 0.001; \ncolor /= 8.0; \ngl_FragColor = color ; \n} \n",gaussian_V_fs:"varying vec2 varying_uv0; \nuniform sampler2D diffuseTexture; \nuniform sampler2D colorTexture; \nvoid main() \n{ \nvec2 uv = vec2(varying_uv0.x,1.0-varying_uv0.y); \nfloat d = 1.0/float(1024.0); \nvec4 color = vec4(0.0,0.0,0.0,0.0); \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0,-8.0*d)) * 0.001; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0,-7.0*d)) * 0.105; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0,-6.0*d)) * 0.217; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0,-5.0*d)) * 0.344; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0,-4.0*d)) * 0.492; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0,-3.0*d)) * 0.55; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0,-2.0*d)) * 0.69; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0,-1.0*d)) * 0.70; \ncolor +=     texture2D(diffuseTexture,uv.xy) * 1.0; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0, 1.0*d)) * 0.70; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0, 2.0*d)) * 0.69; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0, 3.0*d)) * 0.55; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0, 4.0*d)) * 0.492; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0, 5.0*d)) * 0.344; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0, 6.0*d)) * 0.217; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0, 7.0*d)) * 0.105; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0, 8.0*d)) * 0.001; \ncolor /= 8.0; \ngl_FragColor = color + texture2D(colorTexture,uv.xy); \n} \n",gui_fs:"varying vec4 varying_uv; \nvarying vec4 varying_color; \nvarying vec4 varying_pos; \nvarying float varying_textureIndex; \nvec4 diffuseColor; \nuniform sampler2D uiTexture_0; \nuniform sampler2D uiTexture_1; \nuniform sampler2D uiTexture_2; \nuniform sampler2D uiTexture_3; \nuniform sampler2D uiTexture_4; \nuniform sampler2D uiTexture_5; \nuniform sampler2D uiTexture_6; \nvarying vec4 varying_mask; \nvoid main(){ \nif( varying_color.w == -1.0 ){ \ndiscard; \n} \nif(varying_mask.x>=0.0){ \nvec4 mask = varying_mask; \nif( (2.0*mask.x-1.0) > varying_pos.x){ \ndiscard; \n} \nif( (-2.0*mask.y+1.0) < varying_pos.y){ \ndiscard; \n} \nif( (2.0*mask.z-1.0) < varying_pos.x){ \ndiscard; \n} \nif( (-2.0*mask.w+1.0) > varying_pos.y){ \ndiscard; \n} \n} \nvec2 uv = varying_uv.xy ; \nint index = int(floor(varying_textureIndex)) ; \nif(index < 0){ \nif(index == -1){ \ndiffuseColor = vec4(1.0, 0.0, 0.0, 0.8); \n}else{ \ndiscard; \n} \n} \nelse{ \nif(index==0){ \ndiffuseColor.xyzw = texture2D(uiTexture_0, uv ).xyzw; \n}else if(index==1){ \ndiffuseColor.xyzw = texture2D(uiTexture_1, uv ).xyzw; \n} \nelse if(index==2){ \ndiffuseColor.xyzw = texture2D(uiTexture_2, uv ).xyzw; \n} \nelse if(index==3){ \ndiffuseColor.xyzw = texture2D(uiTexture_3, uv ).xyzw; \n} \nelse if(index==4){ \ndiffuseColor.xyzw = texture2D(uiTexture_4, uv ).xyzw; \n} \nelse if(index==5){ \ndiffuseColor.xyzw = texture2D(uiTexture_5, uv ).xyzw; \n} \nelse if(index==6){ \ndiffuseColor.xyzw = texture2D(uiTexture_6, uv ).xyzw; \n} \n} \nif(varying_pos.w==1.0){ \nint clrChannel = int(uv.x); \nuv.x -= float(clrChannel); \nfloat fontAlpha = 1.0; \nif(clrChannel == 0){ \nfontAlpha = diffuseColor.x; \n}else if(clrChannel == 1){ \nfontAlpha = diffuseColor.y; \n} else if(clrChannel == 2){ \nfontAlpha = diffuseColor.z; \n}else if(clrChannel == 3){ \nfontAlpha = diffuseColor.w; \n} \nif(fontAlpha > 0.9){ \nfontAlpha = 1.0; \n} \ndiffuseColor = vec4(1.0, 1.0, 1.0, fontAlpha); \n} \nif(diffuseColor.w < 0.01 || varying_color.w < 0.01){ \ndiscard; \n} \ndiffuseColor.xyz *= varying_color.xyz; \ndiffuseColor.w *= varying_color.w; \ndiffuseColor.xyz *= diffuseColor.w; \ndiffuseColor = clamp(diffuseColor, 0.0, 1.0); \ngl_FragColor = diffuseColor; \n} \n",gui_vs:"attribute vec4 attribute_position; \nattribute vec3 attribute_shapePosition; \nattribute vec4 attribute_uvRec; \nattribute vec4 attribute_rotate; \nattribute vec4 attribute_maskRectangle; \nattribute vec4 attribute_quad_color; \nvarying vec4 varying_uv; \nvarying vec4 varying_color; \nvarying vec4 varying_pos; \nvarying vec4 varying_mask; \nvarying float varying_textureIndex; \nvec4 outPosition; \nuniform mat4 uniform_ModelMatrix; \nuniform mat4 uniform_ViewMatrix; \nuniform mat4 uniform_ProjectionMatrix; \nuniform mat4 uniform_orthProectMatrix; \nuniform float uniform_materialSource[20]; \nmat4 buildMat4Quat(vec4 quat){ \nfloat xx = quat.x * quat.x; \nfloat xy = quat.x * quat.y; \nfloat xz = quat.x * quat.z; \nfloat xw = quat.x * quat.w; \nfloat yy = quat.y * quat.y; \nfloat yz = quat.y * quat.z; \nfloat yw = quat.y * quat.w; \nfloat zz = quat.z * quat.z; \nfloat zw = quat.z * quat.w; \nreturn mat4( \n1.0 - 2.0 * (yy + zz),		2.0 * (xy + zw),		2.0 * (xz - yw),		0, \n2.0 * (xy - zw),				1.0 - 2.0 * (xx + zz),	2.0 * (yz + xw),		0, \n2.0 * (xz + yw),				2.0 * (yz - xw),		1.0 - 2.0 * (xx + yy),	0, \n0.0,							0.0,					0.0,					1 \n); \n} \nvoid main(void){ \nfloat devicePixelRatio = 1.0; \nmat4 mvMatrix = mat4(uniform_ViewMatrix * uniform_ModelMatrix); \nmat4 po = buildMat4Quat(attribute_rotate.xyzw); \nmat4 oth = uniform_orthProectMatrix; \nfloat px = oth[0].x ; \nfloat py = oth[1].y ; \noth[0].x = oth[0].x / devicePixelRatio ; \noth[1].y = oth[1].y / devicePixelRatio ; \nvec3 pos = mat3(po) * (attribute_position.xyz * vec3(attribute_uvRec.zw,1.0) ) + vec3(attribute_shapePosition.xy,1.0) ; \nvec3 sceneWH = vec3( 1.0/ oth[0].x, -1.0/oth[1].y , 0.0 )  ; \noutPosition = mvMatrix * vec4( pos - sceneWH , 1.0 ) ; \nvarying_color = attribute_quad_color ; \nif( attribute_position.z >= 100000.0 ){ \nvarying_color.w = -1.0 ; \n} \nvarying_pos = outPosition = oth * outPosition ; \nvarying_pos.w = attribute_position.w ; \nvec4 maskk = attribute_maskRectangle; \nsceneWH = vec3(2.0/px*devicePixelRatio,2.0/py*devicePixelRatio,1.0) ; \nvarying_mask = vec4(maskk.xy/sceneWH.xy,(maskk.x+maskk.z)/sceneWH.x ,  (maskk.y+maskk.w)/(sceneWH.y)) ; \nvarying_uv = attribute_uvRec; \nvarying_textureIndex = floor(attribute_shapePosition.z); \nint texIndex = int(attribute_shapePosition.z); \nif(texIndex == -2 || texIndex == -3){ \noutPosition = vec4(0.0,0.0,0.0,0.0); \n}else{ \ngl_Position = outPosition; \n} \ngl_PointSize = uniform_materialSource[18]; \n} \n",hud_cull_fs:"varying vec2 varying_uv0; \nuniform sampler2D diffuseTexture; \nuniform vec2 uv_scale; \nvoid main(void) { \nvec2 uv_0 = varying_uv0; \nuv_0 *= uv_scale; \nvec4 color = texture2D(diffuseTexture, varying_uv0); \nfloat mask = 1.0; \nfloat f = uv_scale.y - varying_uv0.y; \nif (varying_uv0.y < uv_scale.y){ \nif(f < 0.03 && f > 0.0){ \nmask =1.0 - (f / 0.03 * 0.9 + 0.1); \n} \nelse{ \nmask = 0.1; \n} \n} \ncolor.xyz *= mask; \ngl_FragColor  = color; \n} \n",hud_H_fs:"varying vec2 varying_uv0; \nuniform sampler2D diffuseTexture; \nvoid main(void) { \nvec2 uv = vec2(varying_uv0.x ,1.0-varying_uv0.y); \nvec4 color = texture2D(diffuseTexture, uv); \ngl_FragColor  = color; \n} \n",hud_vs:"attribute vec3 attribute_position; \nattribute vec2 attribute_uv0; \nvarying  vec2 varying_uv0; \nuniform  mat4 uniform_ViewProjectionMatrix; \nvoid main(void) { \nvec4 pos = vec4(attribute_position, 1.0); \ngl_Position = uniform_ViewProjectionMatrix * pos; \nvarying_uv0 = attribute_uv0; \n} \n",hud_V_fs:"varying vec2 varying_uv0; \nuniform sampler2D diffuseTexture; \nvoid main(void) { \nvec4 color = texture2D(diffuseTexture, varying_uv0); \ngl_FragColor  = color; \n} \n",lightingBase_fs:"vec4 LightingBlinnPhong(vec3 lightDir, vec3 lightColor , vec3 lightAmbient , vec3 normal , vec3 viewDir, float atten){ \nfloat NdotL = clamp(dot (normal, lightDir),0.0,1.0); \nvec3 diffuse = lightColor.xyz * NdotL ; \nvec3 h = normalize (lightDir + normalize(viewDir)); \nfloat nh = clamp(dot (normal, h),0.0,1.0); \nfloat specPower = pow (nh, materialSource.shininess ) * materialSource.specularScale ; \nvec3 specular = lightColor.xyz * specPower * materialSource.specular ; \nspecularColor.xyz += specular; \nvec4 c; \nc.rgb = (diffuse+specular+lightAmbient) * (atten * 2.0 ); \nc.a = materialSource.alpha + (specPower * atten); \nreturn c; \n} \nvoid main(void) { \nlight.xyzw = vec4(0.0,0.0,0.0,1.0) ; \n} \n",lightMapSpecularPower_fs:"uniform sampler2D lightTexture ; \nvarying vec2 varying_uv1 ; \nvec4 decode_hdr( vec4 data ){ \nvec4 res = data ; \nres.xyz *= pow(2.2,data.w * 256.0 - 128.0); \nreturn res ; \n} \nvoid main(void){ \nvec4 lightmap = texture2D( lightTexture , varying_uv1 ); \nlightmap.xyz = decode_hdr(lightmap).xyz; \nlightmap.xyz = pow( 1.8 * lightmap.xyz, vec3(1.1)) ; \ndiffuseColor.xyz *= lightmap.xyz ; \nspecularColor.xyz *= lightmap.xyz ; \n} \n  \n",lightMap_fs:"uniform sampler2D lightTexture ; \nvarying vec2 varying_uv1 ; \nvec4 decode_hdr( vec4 data ){ \nvec4 res = data ; \nres.xyz *= pow(2.2,data.w * 256.0 - 128.0); \nreturn res ; \n} \nvoid main(void){ \nvec4 lightmap = texture2D( lightTexture , varying_uv1 ); \nlightmap.xyz = decode_hdr(lightmap).xyz; \nlightmap.xyz = pow( 1.8 * lightmap.xyz, vec3(1.1)) ; \ndiffuseColor.xyz *= lightmap.xyz ; \n} \n",lineFog:"struct Fog{ \nvec3 fogColor  ; \nfloat globalDensity ; \nfloat fogStartDistance ; \nfloat fogFarDistance ; \nfloat fogAlpha ; \n}; \nuniform float uniform_globalFog[7]; \nvarying vec4 varying_mvPose; \nvoid main(void){ \nFog fog; \nfog.fogColor = vec3(uniform_globalFog[0],uniform_globalFog[1],uniform_globalFog[2]); \nfog.globalDensity = uniform_globalFog[3]; \nfog.fogStartDistance = uniform_globalFog[4] ; \nfog.fogFarDistance = uniform_globalFog[5] ; \nfog.fogAlpha = uniform_globalFog[6] ; \nfloat d = varying_mvPose.z ; \nfloat distFog = max( 0.0 , d -  fog.fogStartDistance ) ; \ndiffuseColor.xyz = mix( diffuseColor.xyz,fog.fogColor, clamp(distFog/fog.fogFarDistance,0.0,1.0) * fog.fogAlpha ) ; \n} \n",matCapPass_vs:"varying vec2 capCoord ; \nvoid main(void){ \ncapCoord.x = dot(normalMatrix[0].xyz,normal); \ncapCoord.y = dot(normalMatrix[1].xyz,normal); \ncapCoord = capCoord * 0.5 + 0.5; \nambientColor.xyz +=  + capCoord.xyz * 2.0 - 1.0 ; \n} \n",matCap_TextureAdd_fs:"uniform sampler2D matcapTexture; \nvoid main() { \nvec4 capCoord ; \ncapCoord.x = -normal.x; \ncapCoord.y = normal.y; \ncapCoord.xy = capCoord.xy * 0.5 + 0.5; \ncapCoord = texture2D(matcapTexture , capCoord.xy ) * 2.0 - 1.0 ; \nambientColor.xyz += capCoord.xyz ; \n} \n",matCap_TextureMult_fs:"uniform sampler2D matcapTexture; \nvoid main() { \nvec4 capCoord ; \ncapCoord.x = -normal.x; \ncapCoord.y = normal.y; \ncapCoord.xy = capCoord.xy * 0.5 + 0.5; \ncapCoord = texture2D(matcapTexture , capCoord.xy ) ; \ndiffuseColor.xyz *= capCoord.xyz * 2.0 ; \n} \n",materialSource_fs:"struct MaterialSource{ \nvec3 diffuse; \nvec3 ambient; \nvec3 specular; \nfloat alpha; \nfloat cutAlpha; \nfloat shininess; \nfloat roughness; \nfloat albedo; \nvec4 uvRectangle; \nfloat specularScale; \nfloat normalScale; \n}; \nuniform float uniform_materialSource[20] ; \nMaterialSource materialSource ; \nvec2 uv_0 ; \nvoid main(){ \nmaterialSource.diffuse.x = uniform_materialSource[0]; \nmaterialSource.diffuse.y = uniform_materialSource[1]; \nmaterialSource.diffuse.z = uniform_materialSource[2]; \nmaterialSource.ambient.x = uniform_materialSource[3]; \nmaterialSource.ambient.y = uniform_materialSource[4]; \nmaterialSource.ambient.z = uniform_materialSource[5]; \nmaterialSource.specular.x = uniform_materialSource[6]; \nmaterialSource.specular.y = uniform_materialSource[7]; \nmaterialSource.specular.z = uniform_materialSource[8]; \nmaterialSource.alpha = uniform_materialSource[9]; \nmaterialSource.cutAlpha = uniform_materialSource[10]; \nmaterialSource.shininess = uniform_materialSource[11]; \nmaterialSource.specularScale = uniform_materialSource[12]; \nmaterialSource.albedo = uniform_materialSource[13]; \nmaterialSource.uvRectangle.x = uniform_materialSource[14]; \nmaterialSource.uvRectangle.y = uniform_materialSource[15]; \nmaterialSource.uvRectangle.z = uniform_materialSource[16]; \nmaterialSource.uvRectangle.w = uniform_materialSource[17]; \nmaterialSource.normalScale = uniform_materialSource[19]; \nuv_0 = varying_uv0.xy * materialSource.uvRectangle.zw + materialSource.uvRectangle.xy ; \n} \n",mulUvRoll_fs:"uniform float mulUvRoll[4] ; \nuniform sampler2D diffuseTexture; \nuniform sampler2D diffuseTexture1; \nvec4 diffuseColor ; \nvec2 uv_1; \nvoid main() { \nuv_1 = varying_uv0; \nuv_0.xy += vec2(mulUvRoll[0],mulUvRoll[1]); \nuv_1.xy += vec2(mulUvRoll[2],mulUvRoll[3]); \ndiffuseColor = texture2D(diffuseTexture , uv_0 ) * texture2D(diffuseTexture1 , uv_1 ); \ndiffuseColor.xyz = clamp(diffuseColor.xyz / diffuseColor.w,0.0,1.0); \n} \n",normalMap_fragment:"uniform sampler2D normalTexture; \nvarying vec2 varying_uv0        ; \nvarying vec4 varying_mvPose        ; \nmat3 TBN ; \nmat3 cotangentFrame(vec3 N, vec3 p, vec2 uv) { \nvec3 dp1 = dFdx(p); \nvec3 dp2 = dFdy(p); \nvec2 duv1 = dFdx(uv); \nvec2 duv2 = dFdy(uv); \nvec3 dp2perp = cross(dp2, N); \nvec3 dp1perp = cross(N, dp1); \nvec3 T = dp2perp * duv1.x + dp1perp * duv2.x; \nvec3 B = dp2perp * duv1.y + dp1perp * duv2.y; \nfloat invmax = 1.0 / sqrt(max(dot(T,T), dot(B,B))); \nreturn mat3(T * invmax, B * invmax, N); \n} \nvec3 tbn(vec3 map, vec3 N, vec3 V, vec2 texcoord) { \nmat3 TBN = cotangentFrame(N, -V, texcoord); \nreturn normalize(TBN * map); \n} \nvoid main(){ \nvec3 normalTex = texture2D(normalTexture,uv_0).xyz *2.0 - 1.0; \nnormalTex.y *= -1.0; \nnormal.xyz = tbn( normalTex.xyz , normal.xyz , varying_mvPose.xyz , uv_0 ) ; \n} \n",particle_bezier:"vec2 bzData[20]; \nconst float Tiny = 0.0001; \nvoid dcpBezier(float bezierData[22], float tTotal) \n{ \nfloat timeNow = 0.0; \nfloat time1 = bezierData[20] * tTotal; \nfloat time2 = bezierData[21] * tTotal; \nfor(int i = 0; i < 20; i ++){ \nbzData[i].x = timeNow; \nbzData[i].y = bezierData[i]; \nif(i <= 9){ \ntimeNow += time1; \n}else if(i >= 11){ \ntimeNow += time2; \n} \n} \nbzData[10].x = bzData[9].x; \n} \nfloat calcBezierArea(float tCurrent){ \nfloat res = 0.0; \nfloat v0; \nfloat v1; \nfloat t0; \nfloat t1; \nfloat deltaTime = 0.0; \nfloat a_deltaTime; \nfor(int i = 0; i < 19; i ++){ \nv0 = bzData[i].y; \nv1 = bzData[i + 1].y; \nt0 = bzData[i].x; \nt1 = bzData[i + 1].x; \ndeltaTime = t1 - t0; \nif(deltaTime > Tiny) \n{ \na_deltaTime = 0.5 * (v1 - v0); \nif(tCurrent >= t1){ \nres += deltaTime * (v0 + a_deltaTime); \n}else{ \ndeltaTime = tCurrent - t0; \nres += deltaTime * (v0 + a_deltaTime); \nbreak; \n} \n} \n} \nreturn res; \n} \nfloat calcOneBezierArea(float bezierData[22], float tCurrent, float tTotal){ \ndcpBezier(bezierData, tTotal); \nreturn calcBezierArea(tCurrent); \n} \nfloat calcBezierSize(float tCurrent){ \nfloat res = 0.0; \nfloat y0; \nfloat y1; \nfloat t0; \nfloat t1; \nfloat deltaTime = 0.0; \nfloat v; \nfor(int i = 0; i < 19; i ++){ \ny0 = bzData[i].y; \ny1 = bzData[i + 1].y; \nt0 = bzData[i].x; \nt1 = bzData[i + 1].x; \ndeltaTime = t1 - t0; \nif(deltaTime > Tiny) \n{ \nif(tCurrent <= t1){ \nv = (y1 - y0) / deltaTime; \ndeltaTime = tCurrent - t0; \nres = y0 + v * deltaTime; \nbreak; \n} \n} \n} \nreturn res; \n} \nfloat calcOneBezierSize(float bezierData[22], float tCurrent, float tTotal){ \ndcpBezier(bezierData, tTotal); \nreturn calcBezierSize(tCurrent); \n} \n",particle_color_fs:"uniform float uniform_colorTransform[40]; \nvec3 unpack_color(float rgb_data) \n{ \nvec3 res; \nres.z = fract( rgb_data ); \nrgb_data -= res.z; \nrgb_data = rgb_data/256.0; \nres.y = fract( rgb_data ); \nrgb_data -= res.y; \nres.x = rgb_data/256.0; \nreturn res; \n} \nvoid main() { \nfloat startColor ; \nfloat startSegment ; \nfloat nextColor ; \nfloat nextSegment ; \nfloat startAlpha; \nfloat nextAlpha; \nfloat progress = varying_particleData.x/varying_particleData.y; \nconst int maxColorCount = 20; \nfor( int i = 1 ; i < maxColorCount ; i++ ){ \nif( progress >= fract(uniform_colorTransform[i+maxColorCount-1]) ){ \nstartColor = uniform_colorTransform[i-1] ; \nstartSegment = fract(uniform_colorTransform[i+maxColorCount-1]) ; \nnextColor = uniform_colorTransform[i]; \nnextSegment = fract(uniform_colorTransform[i+maxColorCount]) ; \nstartAlpha = uniform_colorTransform[i+maxColorCount-1] - startSegment; \nnextAlpha = uniform_colorTransform[i+maxColorCount] - nextSegment; \n}else{ \nbreak; \n} \n} \nfloat len = nextSegment - startSegment ; \nfloat ws = ( progress - startSegment ) / len ; \nglobalColor = mix(vec4(unpack_color(startColor).xyz,startAlpha / 256.0),vec4(unpack_color(nextColor).xyz, nextAlpha / 256.0),ws) ; \nglobalColor.w = clamp(globalColor.w,0.0,1.0); \n} \n//##FilterEnd## \n",particle_color_vs:"float particle(  ParticleData curParticle ){ \n} \n//##FilterEnd## \n",particle_diffuse_fragment:"uniform sampler2D diffuseTexture; \nvec4 diffuseColor ; \nvec4 globalColor = vec4(1.0, 1.0, 1.0, 1.0); \nvoid calcUVCoord(){ \n} \nvoid main() { \nif( diffuseColor.w == 0.0 ){ \ndiscard; \n} \ncalcUVCoord(); \ndiffuseColor = texture2D(diffuseTexture , uv_0 ); \nif( diffuseColor.w < materialSource.cutAlpha ){ \ndiscard; \n} \n} \n",particle_end:"float particle( ParticleData curParticle ){ \nreturn 1.0 ; \n} \nmat4 buildModelMatrix(vec4 quat, vec3 scale, vec3 position) \n{ \nmat4 ret = mat4( \nvec4(scale.x, 0.0, 0.0, 0.0), \nvec4(0.0, scale.y, 0.0, 0.0), \nvec4(0.0, 0.0, scale.z, 0.0), \nvec4(0.0, 0.0, 0.0, 1.0) \n); \nret = buildMat4Quat(quat) * ret; \nret[3][0] = position.x; \nret[3][1] = position.y; \nret[3][2] = position.z; \nreturn ret; \n} \nvec3 calcParticleMove(vec3 distanceXYZ){ \nif(velocityLimitVec2.y > TrueOrFalse){ \nvec3 temp = distanceXYZ * distanceXYZ; \nfloat distanceCurrent = sqrt(temp.x + temp.y + temp.z); \nfloat distanceLimit = velocityLimitVec2.x; \nif(distanceLimit < 0.0001){ \nreturn vec3(0.0); \n} \nif(distanceCurrent > distanceLimit){ \ndistanceXYZ *= distanceLimit / distanceCurrent; \n} \n} \nreturn distanceXYZ; \n} \nmat4 getRenderModeMatrix(mat4 cameraMatrix, mat4 modelMatrix){ \nreturn cameraMatrix; \n} \nvoid updateStretchedBillBoard(vec4 startPos, vec4 newPos){ \n} \nvoid main(void) { \nif(discard_particle > TrueOrFalse){ \noutPosition = vec4(0.0,0.0,0.0,0.0); \n}else{ \nvec3 position_emitter = attribute_offsetPosition; \nvec3 velocityLocalVec3 = velocityBaseVec3 * currentTime; \nvec3 velocityWorldVec3 = vec3(0.0,0.0,0.0); \nvec3 velocityMultiVec3 = vec3(0.0,0.0,0.0); \nif(particleStateData.velocityOverWorldSpace < TrueOrFalse){ \nvelocityLocalVec3 += velocityOverVec3; \n}else{ \nvelocityWorldVec3 += velocityOverVec3; \n} \nif(particleStateData.velocityForceWorldSpace < TrueOrFalse){ \nvelocityLocalVec3 += velocityForceVec3; \n}else{ \nvelocityWorldVec3 += velocityForceVec3; \n} \nif(particleStateData.worldSpace > TrueOrFalse){ \n}else{ \nfollowTargetPosition.x = particleStateData.positionX; \nfollowTargetPosition.y = particleStateData.positionY; \nfollowTargetPosition.z = particleStateData.positionZ; \nfollowTargetRotation.x = particleStateData.rotationX; \nfollowTargetRotation.y = particleStateData.rotationY; \nfollowTargetRotation.z = particleStateData.rotationZ; \nfollowTargetRotation.w = particleStateData.rotationW; \n} \nmat4 followRotQuat = buildMat4Quat(followTargetRotation); \nvelocityLocalVec3 = (followRotQuat * vec4(velocityLocalVec3, 1.0)).xyz; \nmat4 modelMatrix = buildModelMatrix(followTargetRotation, followTargetScale, followTargetPosition); \nposition_emitter = (modelMatrix * vec4(position_emitter, 1.0)).xyz; \nvelocityMultiVec3 = velocityLocalVec3 + velocityWorldVec3; \nvelocityMultiVec3 = calcParticleMove(velocityMultiVec3); \nvelocityMultiVec3.y -= 4.9 * currentTime * currentTime * particleStateData.gravity; \nvec3 origPosition = position_emitter; \nposition_emitter += velocityMultiVec3; \nupdateStretchedBillBoard(vec4(origPosition, 1.0), vec4(position_emitter, 1.0)); \nmat4 billboardMatrix = getRenderModeMatrix(uniform_cameraMatrix, modelMatrix); \noutPosition = billboardMatrix * localPosition; \noutPosition.xyz += position_emitter.xyz; \noutPosition = uniform_ViewMatrix * outPosition; \n} \nvarying_posZ = outPosition.z; \ngl_Position = uniform_ProjectionMatrix * outPosition ; \n} \n//##FilterEnd## \n",particle_end_fs:"const float TrueOrFalse = 0.5; \nuniform float uniform_particleFsData[3]; \nvoid main() { \nfloat blendMode = uniform_particleFsData[2]; \noutColor.xyz = diffuseColor.xyz * materialSource.diffuse * varying_color.xyz * globalColor.xyz; \noutColor.w = diffuseColor.w * varying_color.w * globalColor.w; \nif(blendMode < TrueOrFalse){ \noutColor.xyz *= outColor.w; \n} \noutColor = clamp(outColor, 0.0, 1.0); \ngl_FragColor = outColor; \n} \n",particle_end_vs:"varying vec4 varying_pos; \nfloat particle( ParticleData curParticle ){ \nreturn 1.0 ; \n} \nmat4 buildModelMatrix(vec4 quat, vec3 scale, vec3 position) \n{ \nmat4 ret = mat4( \nvec4(scale.x, 0.0, 0.0, 0.0), \nvec4(0.0, scale.y, 0.0, 0.0), \nvec4(0.0, 0.0, scale.z, 0.0), \nvec4(0.0, 0.0, 0.0, 1.0) \n); \nret = buildMat4Quat(quat) * ret; \nret[3][0] = position.x; \nret[3][1] = position.y; \nret[3][2] = position.z; \nreturn ret; \n} \nvec3 calcParticleMove(vec3 distanceXYZ){ \nif(velocityLimitVec2.y > TrueOrFalse){ \nvec3 temp = distanceXYZ * distanceXYZ; \nfloat distanceCurrent = sqrt(temp.x + temp.y + temp.z); \nfloat distanceLimit = velocityLimitVec2.x; \nif(distanceLimit < Tiny){ \nreturn vec3(0.0); \n} \nif(distanceCurrent > distanceLimit){ \nfloat nowFrame = currentTime / 0.017; \nfloat dampen = 1.0 - particleStateData.velocityLimitDampen; \nfloat startDistance = (distanceCurrent - distanceLimit) / nowFrame; \nfloat distanceResult = 0.0; \nfloat tempDistance = startDistance; \nfor(int i = 1; i < 600; i++){ \ndistanceResult += tempDistance; \ntempDistance *= dampen; \nif(float(i) > nowFrame) \nbreak; \n} \ndistanceXYZ *= (distanceResult + distanceLimit) / distanceCurrent; \n} \n} \nreturn distanceXYZ; \n} \nmat4 getRenderModeMatrix(mat4 cameraMatrix, mat4 modelMatrix){ \nreturn cameraMatrix; \n} \nfloat updateStretchedBillBoard(vec4 startPos, vec4 newPos){ \nreturn 1.0; \n} \nvoid main(void) { \nif(discard_particle > TrueOrFalse){ \noutPosition = vec4(0.0,0.0,0.0,0.0); \n}else{ \nvec3 position_emitter = attribute_offsetPosition; \nvec3 velocityLocalVec3 = velocityBaseVec3 * currentTime; \nvec3 velocityWorldVec3 = vec3(0.0,0.0,0.0); \nvec3 velocityMultiVec3 = vec3(0.0,0.0,0.0); \nif(particleStateData.velocityOverWorldSpace < TrueOrFalse){ \nvelocityLocalVec3 += velocityOverVec3; \n}else{ \nvelocityWorldVec3 += velocityOverVec3; \n} \nif(particleStateData.velocityForceWorldSpace < TrueOrFalse){ \nvelocityLocalVec3 += velocityForceVec3; \n}else{ \nvelocityWorldVec3 += velocityForceVec3; \n} \nif(particleStateData.worldSpace > TrueOrFalse){ \n}else{ \nfollowTargetPosition.x = particleStateData.positionX; \nfollowTargetPosition.y = particleStateData.positionY; \nfollowTargetPosition.z = particleStateData.positionZ; \nfollowTargetRotation.x = particleStateData.rotationX; \nfollowTargetRotation.y = particleStateData.rotationY; \nfollowTargetRotation.z = particleStateData.rotationZ; \nfollowTargetRotation.w = particleStateData.rotationW; \n} \nmat4 followRotQuat = buildMat4Quat(followTargetRotation); \nvelocityLocalVec3 = (followRotQuat * vec4(velocityLocalVec3, 1.0)).xyz; \nmat4 modelMatrix = buildModelMatrix(followTargetRotation, followTargetScale, followTargetPosition); \nif(particleStateData.renderMode == 4.0){ \nposition_emitter.xyz += localPosition.xyz; \n} \nposition_emitter = (modelMatrix * vec4(position_emitter, 1.0)).xyz; \nvelocityMultiVec3 = velocityLocalVec3 + velocityWorldVec3; \nvelocityMultiVec3 = calcParticleMove(velocityMultiVec3); \nvelocityMultiVec3.y -= 4.9 * currentTime * currentTime * particleStateData.gravity; \nvec3 origPosition = position_emitter; \nposition_emitter += velocityMultiVec3; \nfloat dirEnable = updateStretchedBillBoard(vec4(origPosition, 1.0), vec4(position_emitter, 1.0)); \nif(dirEnable > TrueOrFalse){ \nif(particleStateData.renderMode == 4.0){ \noutPosition.xyz = position_emitter.xyz; \n}else{ \nmat4 billboardMatrix = getRenderModeMatrix(uniform_cameraMatrix, modelMatrix); \noutPosition = billboardMatrix * localPosition; \noutPosition.xyz += position_emitter.xyz; \n} \noutPosition = uniform_ViewMatrix * outPosition; \n}else{ \noutPosition = vec4(0.0,0.0,0.0,0.0); \n} \n} \ngl_Position = uniform_ProjectionMatrix * outPosition ; \nvarying_pos = gl_Position; \n} \n//##FilterEnd## \n",particle_follow_vs:"attribute vec3 attribute_followPosition ; \nattribute vec4 attribute_followRotation ; \nattribute vec3 attribute_followScale; \nfloat particle(  ParticleData curParticle ){ \nfollowTargetPosition = attribute_followPosition; \nfollowTargetRotation = attribute_followRotation; \n} \n//##FilterEnd## \n",particle_fs:"uniform vec2 uniform_fadeOutParticleData; \nvarying float varying_posZ; \nvoid fadeOutParticleByZ(){ \nif(varying_posZ > uniform_fadeOutParticleData.x){ \ndiscard; \n} \nfloat fadeAlpha = (uniform_fadeOutParticleData.x - varying_posZ) / uniform_fadeOutParticleData.x; \nfadeAlpha = clamp(fadeAlpha, 0.0, 1.0); \nfadeAlpha *= fadeAlpha; \noutColor.w *= fadeAlpha; \nif( diffuseColor.w < materialSource.cutAlpha ){ \ndiscard; \n} \n} \n",particle_rm_billboard:"mat4 getRenderModeMatrix(mat4 cameraMatrix, mat4 modelMatrix) { \nmat4 matrix = mat4( \ncameraMatrix[0], \ncameraMatrix[1], \ncameraMatrix[2], \nvec4(0.0, 0.0, 1.0, 1.0)); \nreturn matrix; \n} \n",particle_rm_mesh:"mat4 getRenderModeMatrix(mat4 cameraMatrix, mat4 modelMatrix) { \nreturn mat4( \nvec4(1.0, 0.0, 0.0, 0.0), \nvec4(0.0, 1.0, 0.0, 0.0), \nvec4(0.0, 0.0, 1.0, 0.0), \nvec4(0.0, 0.0, 0.0, 1.0) \n); \n} \n",particle_rm_stretched:"mat4 getRenderModeMatrix(mat4 cameraMatrix, mat4 modelMatrix) { \nmat4 matrix = mat4( \ncameraMatrix[0], \ncameraMatrix[1], \ncameraMatrix[2], \nvec4(0.0, 0.0, 1.0, 1.0)); \nreturn matrix; \n} \nfloat updateStretchedBillBoard(vec4 startPos, vec4 newPos){ \nvec3 dirVector = newPos.xyz - startPos.xyz; \nfloat speedScale = dot(dirVector, dirVector); \nspeedScale = sqrt(speedScale) * 0.01 / currentTime; \nlocalPosition.x *= particleStateData.lengthScale + speedScale * particleStateData.speedScale; \nmat4 temp = uniform_ViewMatrix; \nstartPos = temp * startPos; \nnewPos = temp * newPos; \nfloat scaleBefore = dot(dirVector, dirVector); \nscaleBefore = sqrt(scaleBefore); \nif(scaleBefore < Tiny){ \nreturn 0.0; \n} \ndirVector = newPos.xyz - startPos.xyz; \nfloat scaleAfter = dot(dirVector.xy, dirVector.xy); \nscaleAfter = sqrt(scaleAfter); \nscaleAfter = sqrt(scaleAfter / scaleBefore); \nlocalPosition.x *= scaleAfter; \nstartPos.xyz /= startPos.z; \nnewPos.xyz /= newPos.z; \ndirVector = newPos.xyz - startPos.xyz; \ndirVector = normalize(dirVector); \nvec3 dirStartVector = vec3(0.0, 1.0, 0.0); \nfloat added = -0.5 * PI; \nif(dirVector.x > 0.0){ \ndirVector.xy *= -1.0; \nadded += PI; \n} \nfloat acosValue = dot(dirStartVector, dirVector); \nfloat angle = acos(acosValue) + added; \ntemp = buildRotMat4(vec3(0.0, 0.0, angle)); \nlocalPosition = temp * localPosition; \nreturn 1.0; \n} \n",particle_rotationConst:"attribute float attribute_rotationZ ; \nfloat particle(  ParticleData curParticle ){ \nfloat rot = currentTime * attribute_rotationZ * (PI / 180.0); \nlocalPosition = buildRotMat4(vec3(0.0,0.0,rot)) * localPosition; \n} \n",particle_rotationOneBezier:"uniform float uniform_rotationBezier[22]; \nfloat particle(  ParticleData curParticle ){ \nif(discard_particle < TrueOrFalse){ \nfloat rot = calcOneBezierSize(uniform_rotationBezier, currentTime, curParticle.life); \nrot = currentTime * rot * (PI / 180.0); \nlocalPosition = buildRotMat4(vec3(0.0,0.0,rot)) * localPosition; \n} \n} \n",particle_rotationTwoBezier:"attribute float attribute_rotationRandomSeed; \nuniform float uniform_rotationBezier[22]; \nuniform float uniform_rotationBezier2[22]; \nfloat particle(  ParticleData curParticle ){ \nif(discard_particle < TrueOrFalse){ \nvec2 rotationTwoBezier = vec2(0.0); \nrotationTwoBezier.x = calcOneBezierArea(uniform_rotationBezier, currentTime, curParticle.life); \nrotationTwoBezier.y = calcOneBezierArea(uniform_rotationBezier2, currentTime, curParticle.life); \nfloat rot = mix(rotationTwoBezier.x, rotationTwoBezier.y, attribute_rotationRandomSeed); \nrot = currentTime * rot * (PI / 180.0); \nlocalPosition = buildRotMat4(vec3(0.0,0.0,rot)) * localPosition; \n} \n} \n",particle_size_vs:"uniform float uniform_bezierSize[22]; \nvoid main() { \nfloat bezierSize = calcOneBezierSize(uniform_bezierSize, currentTime, curParticle.life); \nlocalPosition.xyz *= bezierSize; \n} \n",particle_textureSheetConst:"varying vec3 varying_textureSheetData; \nuniform float uniform_textureSheet[5]; \nvec2 getSheetOffset(float frame, float tileX, float tileY) \n{ \nframe = floor(frame); \nvec2 ret = vec2(0.0); \nret.x = (1.0 / tileX) * mod(frame, tileX); \nret.y = frame / tileX; \nret.y = floor(ret.y); \nret.y = (1.0 / tileY) * ret.y; \nreturn ret; \n} \nvoid calcUVCoord() { \nvec2 rectUV = vec2(1.0 / uniform_textureSheet[0], 1.0 / uniform_textureSheet[1]); \nuv_0.xy *= rectUV; \nfloat frame = varying_textureSheetData.x + varying_textureSheetData.y; \nframe = clamp(frame, uniform_textureSheet[3], uniform_textureSheet[4]); \nuv_0.xy += getSheetOffset(frame, uniform_textureSheet[0], uniform_textureSheet[1]); \n} \n",particle_textureSheetOneBezier:"varying vec3 varying_textureSheetData; \nuniform float uniform_textureSheet[5]; \nuniform float uniform_frameBezier[22]; \nvec2 getSheetOffset(float frame, float tileX, float tileY) \n{ \nframe = floor(frame); \nvec2 ret = vec2(0.0); \nret.x = (1.0 / tileX) * mod(frame, tileX); \nret.y = frame / tileX; \nret.y = floor(ret.y); \nret.y = (1.0 / tileY) * ret.y; \nreturn ret; \n} \nvoid calcUVCoord() { \nvec2 rectUV = vec2(1.0 / uniform_textureSheet[0], 1.0 / uniform_textureSheet[1]); \nuv_0.xy *= rectUV; \nfloat frame = varying_textureSheetData.x + varying_textureSheetData.y; \nfloat currentTime = varying_particleData.x * uniform_textureSheet[2]; \ncurrentTime = mod(currentTime, varying_particleData.y); \nfloat bezierFrame = calcOneBezierSize(uniform_frameBezier, currentTime, varying_particleData.y); \nbezierFrame = clamp(bezierFrame, uniform_textureSheet[3], uniform_textureSheet[4]); \nframe += bezierFrame; \nuv_0.xy += getSheetOffset(frame, uniform_textureSheet[0], uniform_textureSheet[1]); \n} \n",particle_textureSheetTwoBezier:"varying vec3 varying_textureSheetData; \nuniform float uniform_textureSheet[5]; \nuniform float uniform_frameBezier1[22]; \nuniform float uniform_frameBezier2[22]; \nvec2 getSheetOffset(float frame, float tileX, float tileY) \n{ \nframe = floor(frame); \nvec2 ret = vec2(0.0); \nret.x = (1.0 / tileX) * mod(frame, tileX); \nret.y = frame / tileX; \nret.y = floor(ret.y); \nret.y = (1.0 / tileY) * ret.y; \nreturn ret; \n} \nvoid calcUVCoord() { \nvec2 rectUV = vec2(1.0 / uniform_textureSheet[0], 1.0 / uniform_textureSheet[1]); \nuv_0.xy *= rectUV; \nfloat frame = varying_textureSheetData.x + varying_textureSheetData.y; \nfloat currentTime = varying_particleData.x * uniform_textureSheet[2]; \ncurrentTime = mod(currentTime, varying_particleData.y); \nfloat b1 = calcOneBezierSize(uniform_frameBezier1, currentTime2, varying_particleData.y); \nfloat b2 = calcOneBezierSize(uniform_frameBezier2, currentTime2, varying_particleData.y); \nfloat bezierFrame = mix(b1, b2, varying_particleData.z); \nbezierFrame = clamp(bezierFrame, uniform_textureSheet[3], uniform_textureSheet[4]); \nframe += bezierFrame; \nuv_0.xy += getSheetOffset(frame, uniform_textureSheet[0], uniform_textureSheet[1]); \n} \n",particle_textureSheet_vs:"attribute vec3 attribute_textureSheetData; \nvarying vec3 varying_textureSheetData; \nfloat particle(  ParticleData curParticle ){ \nvarying_textureSheetData = attribute_textureSheetData; \n} \n",particle_time_fs:"varying vec3 varying_particleData; \nvoid main(void) { \n} \n",particle_time_vs:"attribute vec3 attribute_time ; \nfloat currentTime = 0.0; \nvarying vec3 varying_particleData; \nstruct ParticleData{ \nfloat bornTime; \nfloat life; \nfloat index; \n}; \nfloat particle( ParticleData curParticle ){ \nfloat time = particleStateData.time - particleStateData.delay; \ncurrentTime = time - curParticle.bornTime; \nif(currentTime <= 0.0){ \nreturn currentTime = 0.0; \n} \nif(particleStateData.loop < TrueOrFalse){ \nif(curParticle.bornTime >= particleStateData.duration){ \nreturn currentTime = 0.0; \n} \nif(time >= curParticle.life + curParticle.bornTime){ \nreturn currentTime = 0.0; \n} \n} \ncurrentTime = mod(currentTime, particleStateData.loopTime); \nif(currentTime >= curParticle.life){ \nreturn currentTime = 0.0; \n} \nif( currentTime <= 0.0 ) \nreturn currentTime = 0.0; \n} \nvoid main(void) { \nParticleData curParticle ; \ncurParticle.bornTime = attribute_time.x ; \ncurParticle.life = attribute_time.y ; \ncurParticle.index = attribute_time.z ; \nfloat active = particle( curParticle ) ; \nvarying_particleData.x = currentTime; \nvarying_particleData.y = curParticle.life ; \nvarying_particleData.z = curParticle.index; \nif( active < TrueOrFalse ){ \ne_discard(); \n}else{ \n} \n} \n",particle_uv_roll_fs:"uniform float uniform_particleUVRoll[2]; \nvoid calcUVCoord() { \nuv_0.xy += vec2(varying_particleData.x * uniform_particleUVRoll[0], varying_particleData.x * uniform_particleUVRoll[1]); \n} \n",particle_velocity:"attribute vec3 attribute_velocity; \nfloat particle(  ParticleData curParticle ){ \nvelocityBaseVec3 = attribute_velocity; \n} \n",particle_velocityForceConst:"attribute vec3 attribute_velocityForceConst ; \nfloat particle(   ParticleData curParticle ){ \nvelocityForceVec3 = 0.5 * attribute_velocityForceConst * currentTime * currentTime; \n} \n",particle_velocityForceOneBezier:"vec3 velocityForceOneBezier = vec3(0.0); \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \n} \nvoid main() { \nif(discard_particle < TrueOrFalse){ \nvelocityForceVec3.xyz = velocityForceOneBezier.xyz; \ncalcVelocityForceBezier(currentTime, curParticle.life); \n} \n} \n",particle_velocityForceOneBezierX:"uniform float uniform_velocityForceX[22]; \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \nvelocityForceOneBezier.x = calcOneBezierArea(uniform_velocityForceX, curTime, totalTime); \n} \n",particle_velocityForceOneBezierY:"uniform float uniform_velocityForceY[22]; \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \nvelocityForceOneBezier.y = calcOneBezierArea(uniform_velocityForceY, curTime, totalTime); \n} \n",particle_velocityForceOneBezierZ:"uniform float uniform_velocityForceZ[22]; \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \nvelocityForceOneBezier.z = calcOneBezierArea(uniform_velocityForceZ, curTime, totalTime); \n} \n",particle_velocityForceTwoBezier:"attribute float attribute_velocityForceRandomSeed; \nvec3 velocityForceTwoBezier1 = vec3(0.0); \nvec3 velocityForceTwoBezier2 = vec3(0.0); \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \n} \nvoid main() { \nif(discard_particle < TrueOrFalse){ \ncalcVelocityForceBezier(currentTime, curParticle.life); \nvelocityForceVec3.x = mix(velocityForceTwoBezier1.x, velocityForceTwoBezier2.x, attribute_velocityForceRandomSeed); \nvelocityForceVec3.y = mix(velocityForceTwoBezier1.y, velocityForceTwoBezier2.y, attribute_velocityForceRandomSeed); \nvelocityForceVec3.z = mix(velocityForceTwoBezier1.z, velocityForceTwoBezier2.z, attribute_velocityForceRandomSeed); \n} \n} \n",particle_velocityForceTwoBezierX1:"uniform float uniform_velocityForceX1[22]; \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \nvelocityForceTwoBezier1.x = calcOneBezierArea(uniform_velocityForceX1, curTime, totalTime); \n} \n",particle_velocityForceTwoBezierX2:"uniform float uniform_velocityForceX2[22]; \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \nvelocityForceTwoBezier2.x = calcOneBezierArea(uniform_velocityForceX2, curTime, totalTime); \n} \n",particle_velocityForceTwoBezierY1:"uniform float uniform_velocityForceY1[22]; \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \nvelocityForceTwoBezier1.y = calcOneBezierArea(uniform_velocityForceY1, curTime, totalTime); \n} \n",particle_velocityForceTwoBezierY2:"uniform float uniform_velocityForceY2[22]; \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \nvelocityForceTwoBezier2.y = calcOneBezierArea(uniform_velocityForceY2, curTime, totalTime); \n} \n",particle_velocityForceTwoBezierZ1:"uniform float uniform_velocityForceZ1[22]; \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \nvelocityForceTwoBezier1.z = calcOneBezierArea(uniform_velocityForceZ1, curTime, totalTime); \n} \n",particle_velocityForceTwoBezierZ2:"uniform float uniform_velocityForceZ2[22]; \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \nvelocityForceTwoBezier2.z = calcOneBezierArea(uniform_velocityForceZ2, curTime, totalTime); \n} \n",particle_velocityLimitConst:"attribute float attribute_velocityLimit; \nfloat particle(  ParticleData curParticle ){ \nvelocityLimitVec2.x = attribute_velocityLimit * currentTime; \nif(velocityLimitVec2.x < 0.0){ \nvelocityLimitVec2.x = 0.0; \n} \nvelocityLimitVec2.y = 1.0; \n} \n",particle_velocityLimitOneBezier:"uniform float uniform_velocityLimit[22]; \nvoid main() { \nif(discard_particle < TrueOrFalse){ \nvelocityLimitVec2.x = calcOneBezierArea(uniform_velocityLimit, currentTime, curParticle.life); \nvelocityLimitVec2.y = 1.0; \n} \n} \n",particle_velocityLimitTwoBezier:"uniform float uniform_velocityLimit[22]; \nuniform float uniform_velocityLimit2[22]; \nattribute float attribute_velocityLimitRandomSeed; \nvoid main() { \nif(discard_particle < TrueOrFalse){ \nfloat velocity2Limit1 = calcOneBezierArea(uniform_velocityLimit, currentTime, curParticle.life); \nfloat velocity2Limit2 = calcOneBezierArea(uniform_velocityLimit2, currentTime, curParticle.life); \nvelocityLimitVec2.x = mix(velocity2Limit1, velocity2Limit1, attribute_velocityLimitRandomSeed); \nif(velocityLimitVec2.x < 0.0){ \nvelocityLimitVec2.x = 0.0; \n} \nvelocityLimitVec2.y = 1.0; \n} \n} \n",particle_velocityOverConst:"attribute vec3 attribute_velocityOverConst; \nfloat particle(  ParticleData curParticle ){ \nvelocityOverVec3 = attribute_velocityOverConst * currentTime; \n} \n",particle_velocityOverOneBezier:"vec3 velocityTwoBezier = vec3(0.0); \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \n} \nvoid main() { \nif(discard_particle < TrueOrFalse){ \ncalcVelocityOverBezier(currentTime, curParticle.life); \nvelocityOverVec3.xyz = velocityTwoBezier.xyz; \n} \n} \n",particle_velocityOverOneBezierX:"uniform float uniform_velocityOverX[22]; \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \nvelocityTwoBezier.x = calcOneBezierArea(uniform_velocityOverX, curTime, totalTime); \n} \n",particle_velocityOverOneBezierY:"uniform float uniform_velocityOverY[22]; \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \nvelocityTwoBezier.y = calcOneBezierArea(uniform_velocityOverY, curTime, totalTime); \n} \n",particle_velocityOverOneBezierZ:"uniform float uniform_velocityOverZ[22]; \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \nvelocityTwoBezier.z = calcOneBezierArea(uniform_velocityOverZ, curTime, totalTime); \n} \n",particle_velocityOverTwoBezier:"attribute float attribute_velocityOverRandomSeed; \nvec3 velocityOverTwoBezier1 = vec3(0.0); \nvec3 velocityOverTwoBezier2 = vec3(0.0); \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \n} \nvoid main() { \nif(discard_particle < TrueOrFalse){ \ncalcVelocityOverBezier(currentTime, curParticle.life); \nvelocityOverVec3.x = mix(velocityOverTwoBezier1.x, velocityOverTwoBezier2.x, attribute_velocityOverRandomSeed); \nvelocityOverVec3.y = mix(velocityOverTwoBezier1.y, velocityOverTwoBezier2.y, attribute_velocityOverRandomSeed); \nvelocityOverVec3.z = mix(velocityOverTwoBezier1.z, velocityOverTwoBezier2.z, attribute_velocityOverRandomSeed); \n} \n} \n",particle_velocityOverTwoBezierX1:"uniform float uniform_velocityOverX1[22]; \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \nvelocityOverTwoBezier1.x = calcOneBezierArea(uniform_velocityOverX1, curTime, totalTime); \n} \n",particle_velocityOverTwoBezierX2:"uniform float uniform_velocityOverX2[22]; \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \nvelocityOverTwoBezier2.x = calcOneBezierArea(uniform_velocityOverX2, curTime, totalTime); \n} \n",particle_velocityOverTwoBezierY1:"uniform float uniform_velocityOverY1[22]; \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \nvelocityOverTwoBezier1.y = calcOneBezierArea(uniform_velocityOverY1, curTime, totalTime); \n} \n",particle_velocityOverTwoBezierY2:"uniform float uniform_velocityOverY2[22]; \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \nvelocityOverTwoBezier2.y = calcOneBezierArea(uniform_velocityOverY2, curTime, totalTime); \n} \n",particle_velocityOverTwoBezierZ1:"uniform float uniform_velocityOverZ1[22]; \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \nvelocityOverTwoBezier1.z = calcOneBezierArea(uniform_velocityOverZ1, curTime, totalTime); \n} \n",particle_velocityOverTwoBezierZ2:"uniform float uniform_velocityOverZ2[22]; \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \nvelocityOverTwoBezier2.z = calcOneBezierArea(uniform_velocityOverZ2, curTime, totalTime); \n} \n",particle_vs:"attribute vec4 attribute_color; \nattribute vec3 attribute_offsetPosition; \nuniform mat4 uniform_cameraMatrix; \nuniform float uniform_particleState[24]; \nuniform mat4 uniform_ViewMatrix; \nconst float PI = 3.1415926 ; \nfloat currentTime = 0.0; \nfloat totalTime = 0.0; \nconst float TrueOrFalse = 0.5; \nconst float Tiny = 0.0001; \nvec4 localPosition = vec4(0.0,0.0,0.0,1.0); \nvec3 velocityBaseVec3 = vec3(0.0,0.0,0.0); \nvec3 velocityOverVec3 = vec3(0.0,0.0,0.0); \nvec3 velocityForceVec3 = vec3(0.0,0.0,0.0); \nvec2 velocityBezierWeightVec2 = vec2(1.0, 1.0); \nvec2 velocityLimitVec2 = vec2(0.0,0.0); \nvec3 followTargetPosition = vec3(0.0,0.0,0.0); \nvec3 followTargetScale = vec3(1.0,1.0,1.0); \nvec4 followTargetRotation = vec4(0.0,0.0,0.0,0.0); \nvarying vec3 varyingViewDir ; \nfloat discard_particle = 0.0; \nParticleStateData particleStateData; \nvoid e_discard(){ \ndiscard_particle = 1.0; \n} \nstruct ParticleStateData{ \nfloat time; \nfloat loop; \nfloat worldSpace; \nfloat scaleX; \nfloat scaleY; \nfloat scaleZ; \nfloat rotationX; \nfloat rotationY; \nfloat rotationZ; \nfloat rotationW; \nfloat positionX; \nfloat positionY; \nfloat positionZ; \nfloat loopTime; \nfloat delay; \nfloat duration; \nfloat gravity; \nfloat velocityOverWorldSpace; \nfloat velocityForceWorldSpace; \nfloat velocityLimitDampen; \nfloat cameraScale; \nfloat speedScale; \nfloat lengthScale; \nfloat renderMode; \n}; \nmat4 buildRotMat4(vec3 rot) \n{ \nfloat s; \nfloat c; \ns = sin(rot.x); \nc = cos(rot.x); \nmat4 ret = mat4( \nvec4(1.0, 0.0, 0.0, 0.0), \nvec4(0.0, c, s, 0.0), \nvec4(0.0, -s, c, 0.0), \nvec4(0.0, 0.0, 0.0, 1.0) \n); \ns = sin(rot.y); \nc = cos(rot.y); \nret = mat4( \nvec4(c, 0.0, -s, 0.0), \nvec4(0.0, 1.0, 0.0, 0.0), \nvec4(s, 0.0, c, 0.0), \nvec4(0.0, 0.0, 0.0, 1.0) \n) * ret; \ns = sin(rot.z); \nc = cos(rot.z); \nret = mat4( \nvec4(c, s, 0.0, 0.0), \nvec4(-s, c, 0.0, 0.0), \nvec4(0.0, 0.0, 1.0, 0.0), \nvec4(0.0, 0.0, 0.0, 1.0) \n) * ret; \nreturn ret; \n} \nmat4 buildMat4Quat(vec4 quat){ \nfloat xx = quat.x * quat.x; \nfloat xy = quat.x * quat.y; \nfloat xz = quat.x * quat.z; \nfloat xw = quat.x * quat.w; \nfloat yy = quat.y * quat.y; \nfloat yz = quat.y * quat.z; \nfloat yw = quat.y * quat.w; \nfloat zz = quat.z * quat.z; \nfloat zw = quat.z * quat.w; \nreturn mat4( \n1.0 - 2.0 * (yy + zz),		2.0 * (xy + zw),		2.0 * (xz - yw),		0, \n2.0 * (xy - zw),				1.0 - 2.0 * (xx + zz),	2.0 * (yz + xw),		0, \n2.0 * (xz + yw),				2.0 * (yz - xw),		1.0 - 2.0 * (xx + yy),	0, \n0.0,							0.0,					0.0,					1 \n); \n} \nvoid main(void) { \nparticleStateData.time							= uniform_particleState[0]; \nparticleStateData.loop							= uniform_particleState[1]; \nparticleStateData.worldSpace					= uniform_particleState[2]; \nparticleStateData.scaleX						= uniform_particleState[3]; \nparticleStateData.scaleY						= uniform_particleState[4]; \nparticleStateData.scaleZ						= uniform_particleState[5]; \nparticleStateData.rotationX						= uniform_particleState[6]; \nparticleStateData.rotationY						= uniform_particleState[7]; \nparticleStateData.rotationZ						= uniform_particleState[8]; \nparticleStateData.rotationW						= uniform_particleState[9]; \nparticleStateData.positionX						= uniform_particleState[10]; \nparticleStateData.positionY						= uniform_particleState[11]; \nparticleStateData.positionZ						= uniform_particleState[12]; \nparticleStateData.loopTime						= uniform_particleState[13]; \nparticleStateData.delay							= uniform_particleState[14]; \nparticleStateData.duration						= uniform_particleState[15]; \nparticleStateData.gravity						= uniform_particleState[16]; \nparticleStateData.velocityOverWorldSpace		= uniform_particleState[17]; \nparticleStateData.velocityForceWorldSpace		= uniform_particleState[18]; \nparticleStateData.velocityLimitDampen			= uniform_particleState[19]; \nparticleStateData.cameraScale					= uniform_particleState[20]; \nparticleStateData.speedScale					= uniform_particleState[21]; \nparticleStateData.lengthScale					= uniform_particleState[22]; \nparticleStateData.renderMode					= uniform_particleState[23]; \nmat4 modeViewMatrix = mat4(uniform_ViewMatrix * uniform_ModelMatrix); \noutPosition = localPosition = vec4(e_position, 1.0); \n} \n",pickPass_fs:"void main() { \ngl_FragColor = vec4(1.0, 0.0, 0.0, 1.0); \n} \n",pickPass_skeleton_vs:"attribute vec3 attribute_position; \nattribute vec3 attribute_normal; \nattribute vec4 attribute_color; \nattribute vec2 attribute_uv0; \nattribute vec4 attribute_boneIndex; \nattribute vec4 attribute_boneWeight; \nuniform mat4 uniform_ModelMatrix ; \nuniform mat4 uniform_ViewMatrix ; \nuniform mat4 uniform_ProjectionMatrix ; \nvec3 e_position = vec3(0.0, 0.0, 0.0); \nvec4 e_boneIndex = vec4(0.0, 0.0, 0.0, 0.0); \nvec4 e_boneWeight = vec4(0.0, 0.0, 0.0, 0.0); \nvec4 outPosition = vec4(0.0, 0.0, 0.0, 0.0); \nconst int bonesNumber = 0; \nuniform vec4 uniform_PoseMatrix[bonesNumber]; \nmat4 buildMat4(int index){ \nvec4 quat = uniform_PoseMatrix[index * 2 + 0]; \nvec4 translation = uniform_PoseMatrix[index * 2 + 1]; \nfloat xy2 = 2.0 * quat.x * quat.y; \nfloat xz2 = 2.0 * quat.x * quat.z; \nfloat xw2 = 2.0 * quat.x * quat.w; \nfloat yz2 = 2.0 * quat.y * quat.z; \nfloat yw2 = 2.0 * quat.y * quat.w; \nfloat zw2 = 2.0 * quat.z * quat.w; \nfloat xx = quat.x * quat.x; \nfloat yy = quat.y * quat.y; \nfloat zz = quat.z * quat.z; \nfloat ww = quat.w * quat.w; \nmat4 matrix = mat4( \nxx - yy - zz + ww, xy2 + zw2, xz2 - yw2, 0, \nxy2 - zw2, -xx + yy - zz + ww, yz2 + xw2, 0, \nxz2 + yw2, yz2 - xw2, -xx - yy + zz + ww, 0, \ntranslation.x, translation.y, translation.z, 1 \n); \nreturn matrix; \n} \nvoid main(void){ \ne_boneIndex = attribute_boneIndex; \ne_boneWeight = attribute_boneWeight; \nvec4 temp_position = vec4(attribute_position, 1.0) ; \nmat4 m0 = buildMat4(int(e_boneIndex.x)); \nmat4 m1 = buildMat4(int(e_boneIndex.y)); \nmat4 m2 = buildMat4(int(e_boneIndex.z)); \nmat4 m3 = buildMat4(int(e_boneIndex.w)); \noutPosition = m0 * temp_position * e_boneWeight.x; \noutPosition += m1 * temp_position * e_boneWeight.y; \noutPosition += m2 * temp_position * e_boneWeight.z; \noutPosition += m3 * temp_position * e_boneWeight.w; \ne_position = outPosition.xyz; \ngl_Position = uniform_ProjectionMatrix * uniform_ViewMatrix * uniform_ModelMatrix * vec4(e_position, 1.0); \n} \n",pickPass_vs:"attribute vec3 attribute_position; \nattribute vec4 attribute_color; \nattribute vec2 attribute_uv0; \nuniform mat4 uniform_ModelMatrix ; \nuniform mat4 uniform_ViewMatrix ; \nuniform mat4 uniform_ProjectionMatrix ; \nvoid main(void){ \ngl_Position = uniform_ProjectionMatrix * uniform_ViewMatrix * uniform_ModelMatrix * vec4(attribute_position, 1.0); \n} \n",pointLight_fragment:"const int max_pointLight = 0 ; \nuniform float uniform_pointLightSource[12*max_pointLight] ; \nvarying vec4 varying_mvPose; \nstruct PointLight{ \nvec3 position ; \nvec3 diffuse ; \nvec3 ambient ; \nfloat intensity; \nfloat radius; \nfloat cutoff; \n}; \nvoid calculatePointLight(MaterialSource materialSource){ \nvec3 N = normal; \nvec3 viewDir = normalize(varying_mvPose.xyz/varying_mvPose.w); \nfor(int i = 0 ; i < max_pointLight ; i++){ \nPointLight pointLight; \npointLight.position = vec3(uniform_pointLightSource[i*12],uniform_pointLightSource[i*12+1],uniform_pointLightSource[i*12+2]); \npointLight.diffuse = vec3(uniform_pointLightSource[i*12+3],uniform_pointLightSource[i*12+4],uniform_pointLightSource[i*12+5]); \npointLight.ambient = vec3(uniform_pointLightSource[i*12+6],uniform_pointLightSource[i*12+7],uniform_pointLightSource[i*12+8]); \npointLight.intensity = uniform_pointLightSource[i*12+9]; \npointLight.radius = uniform_pointLightSource[i*12+10]; \npointLight.cutoff = uniform_pointLightSource[i*12+11]; \nvec3 lightCentre = (mat4(uniform_ViewMatrix) * vec4(pointLight.position.xyz,1.0) ).xyz ; \nfloat r = pointLight.radius * 0.5 ; \nvec3 ldir = varying_mvPose.xyz - lightCentre ; \nfloat distance = length(ldir); \nfloat d = max(distance - r, 0.0); \nvec3 L = ldir / distance; \nfloat denom = d/r + 1.0; \nfloat attenuation = 1.0 / (denom*denom); \nfloat cutoff = pointLight.cutoff ; \nattenuation = (attenuation - cutoff) / (1.0 - cutoff); \nattenuation = max(attenuation*pointLight.intensity, 0.0); \nlight.xyzw += LightingBlinnPhong(normalize(ldir),pointLight.diffuse,pointLight.ambient,N,(viewDir),attenuation); \n}; \n} \nvoid main() { \ncalculatePointLight(materialSource); \n} \n",secondaryUV_vs:"attribute vec2 attribute_uv1; \nvarying vec2 varying_uv1 ; \nvoid main(void){ \nvarying_uv1 = attribute_uv1 ; \n} \n",shadowMapping_fs:"uniform sampler2D shadowMapTexture; \nuniform vec4 uniform_ShadowColor; \nvarying vec4 varying_ShadowCoord; \nfloat unpackDepth(vec4 rgbaDepth){ \nvec4 bitShift = vec4( 1.0 , 1.0/256.0 , 1.0/(256.0*256.0) , 1.0/(256.0*256.0*256.0) ); \nfloat depth = dot(rgbaDepth,bitShift); \nreturn depth ; \n} \nvoid main() { \nvec3 shadowColor = vec3(1.0,1.0,1.0); \nfloat offset = uniform_ShadowColor.w; \nvec2 sample = varying_ShadowCoord.xy / varying_ShadowCoord.w * 0.5 + 0.5; \nsample = clamp(sample,0.0,1.0); \nvec4 sampleDepth = texture2D(shadowMapTexture, sample).xyzw; \nfloat depth = varying_ShadowCoord.z; \nif (sampleDepth.z != 0.0) { \nif( sampleDepth.z < depth - offset) { \nshadowColor = uniform_ShadowColor.xyz; \n} \n} \ndiffuseColor.xyz = diffuseColor.xyz * shadowColor; \n} \n",shadowMapping_vs:"uniform mat4 uniform_ShadowMatrix; \nuniform mat4 uniform_ModelMatrix; \nvarying vec4 varying_ShadowCoord; \nvoid main() { \nvarying_ShadowCoord = uniform_ShadowMatrix * uniform_ModelMatrix * vec4(e_position, 1.0); \n} \n",shadowPass_fs:"uniform sampler2D diffuseTexture; \nvec4 diffuseColor ; \nvarying vec2 varying_uv0; \nvarying vec4 varying_color; \nvarying vec4 varying_pos; \nfloat unpackDepth(vec4 rgbaDepth){ \nvec4 bitShift = vec4( 1.0 , 1.0/256.0 , 1.0/(256.0*256.0) , 1.0/(256.0*256.0*256.0) ); \nfloat depth = dot(rgbaDepth,bitShift); \nreturn depth ; \n} \nvoid main() { \ndiffuseColor = varying_color ; \nif( diffuseColor.w == 0.0 ){ \ndiscard; \n} \ndiffuseColor = texture2D(diffuseTexture , varying_uv0 ); \nif( diffuseColor.w <= 0.3 ){ \ndiscard; \n} \ngl_FragColor = vec4(varying_pos.zzz, 1.0); \n} \n",shadowPass_skeleton_vs:"attribute vec3 attribute_position; \nattribute vec3 attribute_normal; \nattribute vec4 attribute_color; \nattribute vec2 attribute_uv0; \nattribute vec4 attribute_boneIndex; \nattribute vec4 attribute_boneWeight; \nuniform mat4 uniform_ModelMatrix ; \nuniform mat4 uniform_ViewMatrix ; \nuniform mat4 uniform_ProjectionMatrix ; \nvec3 e_position = vec3(0.0, 0.0, 0.0); \nvec4 e_boneIndex = vec4(0.0, 0.0, 0.0, 0.0); \nvec4 e_boneWeight = vec4(0.0, 0.0, 0.0, 0.0); \nvec4 outPosition = vec4(0.0, 0.0, 0.0, 0.0); \nconst int bonesNumber = 0; \nuniform vec4 uniform_PoseMatrix[bonesNumber]; \nvarying vec2 varying_uv0; \nvarying vec4 varying_color; \nvarying vec4 varying_pos; \nmat4 buildMat4(int index){ \nvec4 quat = uniform_PoseMatrix[index * 2 + 0]; \nvec4 translation = uniform_PoseMatrix[index * 2 + 1]; \nfloat xy2 = 2.0 * quat.x * quat.y; \nfloat xz2 = 2.0 * quat.x * quat.z; \nfloat xw2 = 2.0 * quat.x * quat.w; \nfloat yz2 = 2.0 * quat.y * quat.z; \nfloat yw2 = 2.0 * quat.y * quat.w; \nfloat zw2 = 2.0 * quat.z * quat.w; \nfloat xx = quat.x * quat.x; \nfloat yy = quat.y * quat.y; \nfloat zz = quat.z * quat.z; \nfloat ww = quat.w * quat.w; \nmat4 matrix = mat4( \nxx - yy - zz + ww, xy2 + zw2, xz2 - yw2, 0, \nxy2 - zw2, -xx + yy - zz + ww, yz2 + xw2, 0, \nxz2 + yw2, yz2 - xw2, -xx - yy + zz + ww, 0, \ntranslation.x, translation.y, translation.z, 1 \n); \nreturn matrix; \n} \nvoid main(void){ \ne_boneIndex = attribute_boneIndex; \ne_boneWeight = attribute_boneWeight; \nvec4 temp_position = vec4(attribute_position, 1.0) ; \nmat4 m0 = buildMat4(int(e_boneIndex.x)); \nmat4 m1 = buildMat4(int(e_boneIndex.y)); \nmat4 m2 = buildMat4(int(e_boneIndex.z)); \nmat4 m3 = buildMat4(int(e_boneIndex.w)); \noutPosition = m0 * temp_position * e_boneWeight.x; \noutPosition += m1 * temp_position * e_boneWeight.y; \noutPosition += m2 * temp_position * e_boneWeight.z; \noutPosition += m3 * temp_position * e_boneWeight.w; \ne_position = outPosition.xyz; \nmat4 mvMatrix = mat4(uniform_ViewMatrix * uniform_ModelMatrix); \nvarying_color = attribute_color; \nvarying_uv0 = attribute_uv0 ; \nvarying_pos = uniform_ProjectionMatrix * uniform_ViewMatrix * uniform_ModelMatrix * vec4(e_position, 1.0); \ngl_Position = varying_pos; \n} \n",shadowPass_vs:"attribute vec3 attribute_position; \nattribute vec4 attribute_color; \nattribute vec2 attribute_uv0; \nuniform mat4 uniform_ModelMatrix ; \nuniform mat4 uniform_ViewMatrix ; \nuniform mat4 uniform_ProjectionMatrix ; \nvarying vec2 varying_uv0; \nvarying vec4 varying_color; \nvarying vec4 varying_pos; \nvoid main(void){ \nmat4 mvMatrix = mat4(uniform_ViewMatrix * uniform_ModelMatrix); \nvarying_color = attribute_color; \nvarying_uv0 = attribute_uv0 ; \nvarying_pos = uniform_ProjectionMatrix * uniform_ViewMatrix * uniform_ModelMatrix * vec4(attribute_position, 1.0); \ngl_Position = varying_pos; \n} \n",skeletonShadowPass_vs:"attribute vec4 attribute_boneIndex; \nattribute vec4 attribute_boneWeight; \nattribute vec4 attribute_color; \nvec4 e_boneIndex = vec4(0.0, 0.0, 0.0, 0.0); \nvec4 e_boneWeight = vec4(0.0, 0.0, 0.0, 0.0); \nconst int bonesNumber = 0; \nuniform vec4 uniform_PoseMatrix[bonesNumber]; \nmat4 buildMat4(int index){ \nvec4 quat = uniform_PoseMatrix[index * 2 + 0]; \nvec4 translation = uniform_PoseMatrix[index * 2 + 1]; \nfloat xx = quat.x * quat.x; \nfloat xy = quat.x * quat.y; \nfloat xz = quat.x * quat.z; \nfloat xw = quat.x * quat.w; \nfloat yy = quat.y * quat.y; \nfloat yz = quat.y * quat.z; \nfloat yw = quat.y * quat.w; \nfloat zz = quat.z * quat.z; \nfloat zw = quat.z * quat.w; \nreturn mat4( \n1.0 - 2.0 * (yy + zz),		2.0 * (xy + zw),		2.0 * (xz - yw),		0, \n2.0 * (xy - zw),				1.0 - 2.0 * (xx + zz),	2.0 * (yz + xw),		0, \n2.0 * (xz + yw),				2.0 * (yz - xw),		1.0 - 2.0 * (xx + yy),	0, \ntranslation.x,				translation.y,			translation.z,			1 \n); \n} \nvoid main(void){ \nvarying_color = attribute_color; \ne_boneIndex = attribute_boneIndex; \ne_boneWeight = attribute_boneWeight; \nvec4 temp_position = vec4(attribute_position, 1.0) ; \nmat4 m0 = buildMat4(int(e_boneIndex.x)); \nmat4 m1 = buildMat4(int(e_boneIndex.y)); \nmat4 m2 = buildMat4(int(e_boneIndex.z)); \nmat4 m3 = buildMat4(int(e_boneIndex.w)); \noutPosition = m0 * temp_position * e_boneWeight.x; \noutPosition += m1 * temp_position * e_boneWeight.y; \noutPosition += m2 * temp_position * e_boneWeight.z; \noutPosition += m3 * temp_position * e_boneWeight.w; \ne_position = outPosition.xyz; \noutPosition = uniform_modelMatrix * uniform_viewMatrix *  outPosition; \n} \n",skeleton_vs:"attribute vec4 attribute_boneIndex; \nattribute vec4 attribute_boneWeight; \nattribute vec3 attribute_normal; \nattribute vec4 attribute_color; \nvec4 e_boneIndex = vec4(0.0, 0.0, 0.0, 0.0); \nvec4 e_boneWeight = vec4(0.0, 0.0, 0.0, 0.0); \nconst int bonesNumber = 0; \nuniform vec4 uniform_PoseMatrix[bonesNumber]; \nvarying vec4 varying_mvPose  ; \nmat4 buildMat4(int index){ \nvec4 quat = uniform_PoseMatrix[index * 2 + 0]; \nvec4 translation = uniform_PoseMatrix[index * 2 + 1]; \nfloat xy2 = 2.0 * quat.x * quat.y; \nfloat xz2 = 2.0 * quat.x * quat.z; \nfloat xw2 = 2.0 * quat.x * quat.w; \nfloat yz2 = 2.0 * quat.y * quat.z; \nfloat yw2 = 2.0 * quat.y * quat.w; \nfloat zw2 = 2.0 * quat.z * quat.w; \nfloat xx = quat.x * quat.x; \nfloat yy = quat.y * quat.y; \nfloat zz = quat.z * quat.z; \nfloat ww = quat.w * quat.w; \nmat4 matrix = mat4( \nxx - yy - zz + ww, xy2 + zw2, xz2 - yw2, 0, \nxy2 - zw2, -xx + yy - zz + ww, yz2 + xw2, 0, \nxz2 + yw2, yz2 - xw2, -xx - yy + zz + ww, 0, \ntranslation.x, translation.y, translation.z, 1 \n); \nreturn matrix; \n} \nvoid main(void){ \ne_boneIndex = attribute_boneIndex; \ne_boneWeight = attribute_boneWeight; \nvec4 temp_position = vec4(attribute_position, 1.0) ; \nvec4 temp_normal = vec4(attribute_normal, 0.0) ; \nmat4 m0 = buildMat4(int(e_boneIndex.x)); \nmat4 m1 = buildMat4(int(e_boneIndex.y)); \nmat4 m2 = buildMat4(int(e_boneIndex.z)); \nmat4 m3 = buildMat4(int(e_boneIndex.w)); \noutPosition = m0 * temp_position * e_boneWeight.x; \noutPosition += m1 * temp_position * e_boneWeight.y; \noutPosition += m2 * temp_position * e_boneWeight.z; \noutPosition += m3 * temp_position * e_boneWeight.w; \ne_position = outPosition.xyz; \nvec4 temp_n ; \ntemp_n = m0 * temp_normal * e_boneWeight.x; \ntemp_n += m1 * temp_normal * e_boneWeight.y; \ntemp_n += m2 * temp_normal * e_boneWeight.z; \ntemp_n += m3 * temp_normal * e_boneWeight.w; \nmat4 mvMatrix = mat4(uniform_ViewMatrix * uniform_ModelMatrix); \nvarying_mvPose = mvMatrix * vec4( e_position , 1.0 ) ; \nmat4 normalMatrix = inverse(mvMatrix) ; \nnormalMatrix = transpose(normalMatrix); \nvarying_eyeNormal = mat3(normalMatrix) * -attribute_normal ; \noutPosition.xyzw = varying_mvPose.xyzw ; \nvarying_color = attribute_color; \n} \n",specularMap_fragment:"uniform sampler2D specularTexture; \nvoid main(void){ \nspecularColor.xyz *= texture2D( specularTexture , uv_0 ).xyz ; \n} \n",tangent_vs:"attribute vec3 attribute_tangent; \nvoid main(void){ \n}  \n",terrainRGBA_fragment:"uniform sampler2D blendMaskTexture ; \nuniform sampler2D splat_0Tex ; \nuniform sampler2D splat_1Tex ; \nuniform sampler2D splat_2Tex ; \nuniform sampler2D splat_3Tex ; \nuniform float uvs[8]; \nvoid main() { \nvec4 splat_control = texture2D ( blendMaskTexture , varying_uv0 ); \nvec4 cc = vec4(0.0,0.0,0.0,1.0); \nvec2 uv = varying_uv0 ; \ncc.xyz = splat_control.x * texture2D (splat_0Tex, uv * vec2(uvs[0],uvs[1])).xyz ; \ncc.xyz += splat_control.y * texture2D (splat_1Tex, uv * vec2(uvs[2],uvs[3]) ).xyz; \ncc.xyz += splat_control.z * vec4(texture2D (splat_2Tex, uv* vec2(uvs[4],uvs[5]))).xyz; \ncc.xyz += (1.0-length(splat_control.xyz)) * vec4(texture2D (splat_3Tex, uv* vec2(uvs[6],uvs[7]))).xyz; \ndiffuseColor.xyz = cc.xyz ; \n} \n",uvRoll_fs:"uniform float uvRoll[2] ; \nuniform sampler2D diffuseTexture; \nvec4 diffuseColor ; \nvoid main() { \nuv_0.xy += vec2(uvRoll[0],uvRoll[1]); \ndiffuseColor = texture2D(diffuseTexture , uv_0 ); \n} \n",uvSpriteSheet_fs:"uniform float uvSpriteSheet[4] ; \nuniform sampler2D diffuseTexture; \nvec4 diffuseColor ; \nvoid main() { \nuv_0.xy *= vec2(uvSpriteSheet[2],uvSpriteSheet[3]); \nuv_0.xy += vec2(uvSpriteSheet[0],uvSpriteSheet[1]); \ndiffuseColor = texture2D(diffuseTexture , uv_0 ); \n} \n",uvStreamerRoll_fs:"uniform float uvRoll[3] ; \nuniform sampler2D diffuseTexture; \nuniform sampler2D streamerTexture; \nvec4 diffuseColor ; \nvoid main() { \ndiffuseColor = texture2D(diffuseTexture , varying_uv0 ); \nvec2 rollUV = varying_uv0 + vec2(uvRoll[0],uvRoll[1]) + vec2(normal.xz) * 0.5 ; \ndiffuseColor.xyz += texture2D(streamerTexture , rollUV ).xyz * uvRoll[2] ; \n} \n",varyingViewDir_vs:"varying vec3 varying_ViewDir; \nuniform vec3 uniform_eyepos; \nvoid main(void){ \nvarying_ViewDir = (uniform_eyepos.xyz - e_position) ; \n} \n",vertexPos_vs:"uniform mat4 uniform_modelMatrix; \nuniform mat4 uniform_viewMatrix; \nvarying vec4 varying_mvPose; \nvoid main() { \nvarying_mvPose = uniform_modelMatrix * uniform_viewMatrix * vec4(e_position, 1.0) ; \n} \n                       \n",waterDiffuse_fs:"uniform sampler2D diffuseTexture; \nvec4 diffuseColor ; \nvoid main() { \ndiffuseColor.xyz *= diffuseColor.w ; \n} \n",waterNormal_fs:"uniform vec2 waterNormalData[4]; \nuniform float time ; \nuniform sampler2D normalTextureA; \nuniform sampler2D normalTextureB; \nvarying vec2 varying_uv0        ; \nmat3 TBN ; \nmat3 cotangentFrame(vec3 N, vec3 p, vec2 uv) { \nvec3 dp1 = dFdx(p); \nvec3 dp2 = dFdy(p); \nvec2 duv1 = dFdx(uv); \nvec2 duv2 = dFdy(uv); \nvec3 dp2perp = cross(dp2, N); \nvec3 dp1perp = cross(N, dp1); \nvec3 T = dp2perp * duv1.x + dp1perp * duv2.x; \nvec3 B = dp2perp * duv1.y + dp1perp * duv2.y; \nfloat invmax = 1.0 / sqrt(max(dot(T,T), dot(B,B))); \nreturn mat3(T * invmax, B * invmax, N); \n} \nvec3 tbn(vec3 map, vec3 N, vec3 V, vec2 texcoord) { \nmat3 TBN = cotangentFrame(N, -V, texcoord); \nreturn normalize(TBN * map); \n} \nvoid main(void){ \nfloat tempTime = mod(time,100000.0); \nvec2 uvA = uv_0 * waterNormalData[3].x + waterNormalData[0] * tempTime ; \nvec2 uvB = uv_0 * waterNormalData[3].y + waterNormalData[1] * tempTime  ; \nnormal = flatNormals(varying_mvPose.xyz) ; \nTBN = cotangentFrame(normal, -varying_mvPose.xyz, uv_0 ); \nvec3 bump1 = texture2D( normalTextureA, uvA ).rgb; \nvec3 bump2 = texture2D( normalTextureB, uvB ).rgb; \nvec3 bump = bump1 + bump2 - 1.0; \nnormal = normalize(TBN * bump) ; \nnormal.y *= -1.0; \n}  \n",wave_fs:"uniform sampler2D diffuseTexture; \nuniform vec3 uniform_eyepos; \nuniform vec4 waveFSData[2]; \nvarying vec4 varying_mvPose; \nvec4 diffuseColor ; \nvoid main(void){ \nvec3 viewDir = normalize(varying_mvPose.xyz/varying_mvPose.w); \ndiffuseColor.xyz = vec3(1.0,1.0,1.0) ; \nvec3 shallowWaterColor = waveFSData[0].xyz * waveFSData[0].w ; \nvec3 deepWaterColor = waveFSData[1].xyz * waveFSData[1].w; \nfloat facing = clamp(dot( -normalize(viewDir),normal),0.0,1.0); \nvec3 waterColor = mix(shallowWaterColor,deepWaterColor,facing); \ndiffuseColor.xyz *= waterColor ; \n}  \n",wave_vs:"#define VERTEX_TEXTURES \nattribute vec3 attribute_normal; \nattribute vec4 attribute_color; \nuniform mat4 uniform_modelMatrix; \nuniform mat4 uniform_viewMatrix; \nvarying vec4 varying_mvPose; \nuniform vec3 waveVSData[4]; \nuniform float time ; \nstruct wave{ \nvec3 wave_xyz_intensity_0 ; \nvec3 wave_xyz_intensity_1 ; \nvec3 wave_xyz_speed_0 ; \nvec3 wave_xyz_speed_1 ; \n}; \nconst float pi = 3.14 ; \nvec3 calcWave2( float t , vec3 x, float amplitude, float waveLength ,float angularVelocity ,  vec3 waveDir ){ \nangularVelocity = angularVelocity * 0.1; \nvec3 waveVector = waveDir ; \nfloat waveNumber = pi / waveLength; \nwaveVector *= waveNumber ; \nvec3 temp ; \nfloat kDotX0SubWt = dot(waveVector , x ) - angularVelocity * t  * 0.001; \nfloat A = amplitude * sin(kDotX0SubWt) ; \ntemp.xz = waveDir.xz * A ; \ntemp.y += amplitude * cos(kDotX0SubWt); \ntemp = x - temp ; \nreturn temp ; \n} \nvoid main(void){ \nwave wa ; \nwa.wave_xyz_intensity_0 = vec3(waveVSData[0]) ; \nwa.wave_xyz_intensity_1 = vec3(waveVSData[1]) ; \nwa.wave_xyz_speed_0 = vec3(waveVSData[2]) ; \nwa.wave_xyz_speed_1 = vec3(waveVSData[3]) ; \nfloat tempTime = mod( time , 1000000.0 ); \nvec3 newPose1 = calcWave2(tempTime,e_position,40.0, 20.0, 10.0,vec3(1.0,0.0,1.0)); \nnewPose1 += calcWave2(tempTime,e_position,20.0, 10.0, 10.0,vec3(1.0,0.0,-0.5)); \nnewPose1 += calcWave2(tempTime,e_position,1.0, 1.0, 10.0,vec3(1.0,0.0,-1.5)); \ne_position = newPose1 ; \nmat4 mvMatrix = mat4(uniform_ViewMatrix * uniform_ModelMatrix); \nvarying_mvPose = mvMatrix * vec4( e_position , 1.0 )  ; \nmat4 normalMatrix = inverse(mvMatrix) ; \nnormalMatrix = transpose(normalMatrix); \nvarying_eyeNormal = mat3(normalMatrix) * -attribute_normal ; \noutPosition = varying_mvPose ; \nvarying_color = attribute_color; \n}  \n"},t
}();t.ShaderLib=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.register=function(t){this.context=t},e.getGPUShader=function(e,i,r){var a=this.vsShaderHashMap.getValue(i);return a||(a=this.fsShaderHashMap.getValue(i)),a||(e==t.Shader.vertex?(a=this.context.creatVertexShader(r),a.id=i,this.vsShaderHashMap.add(i,a)):e==t.Shader.fragment&&(a=this.context.creatFragmentShader(r),a.id=i,this.fsShaderHashMap.add(i,a))),a},e.getProgram=function(t,e){var i,r=this.vsShaderHashMap.getValue(t),a=this.fsShaderHashMap.getValue(e),n=r.id+"_"+a.id;return this.programlib.isHas(n)?i=this.programlib.getValue(n):(i=this.registerProgram(r,a),this.programlib.add(n,i)),this.programlib.getValue(n)},e.unRegisterShader=function(){},e.registerProgram=function(t,e){var i=this.context.creatProgram(t,e);return i},e.unRegisterProgram=function(){},e.programlib=new t.HashMap,e.vsShaderHashMap=new t.HashMap,e.fsShaderHashMap=new t.HashMap,e}();t.ShaderPool=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(){function t(){this.name="",this.source="",this.funcNames=new Array,this.funcDict={},this.structDict={},this.structNames=new Array,this.attributeList=new Array,this.varyingList=new Array,this.uniformList=new Array,this.constList=new Array,this.tempList=new Array,this.sampler2DList=new Array,this.sampler3DList=new Array,this.extensionList=new Array,this.defineList=new Array}return t.prototype.addVar=function(t){"attribute"==t.key?this.attributeList.push(t):"varying"==t.key?this.varyingList.push(t):"uniform"==t.key?this.uniformList.push(t):"const"==t.key?this.constList.push(t):"sampler2D"==t.key?this.sampler2DList.push(t):"samplerCube"==t.key?this.sampler3DList.push(t):"#extension"==t.key?this.extensionList.push(t):"#define"==t.key?this.defineList.push(t):this.tempList.push(t)},t.prototype.addFunc=function(t,e){if(this.funcDict[t]){var i=this.mergeMainFunc(this.funcDict[t],e);this.funcDict[t]=i}else this.funcDict[t]=e,this.funcNames.push(t);if(this.funcDict.main){var r=this.funcNames.indexOf("main");this.funcNames.splice(r,1),this.funcNames.push("main")}},t.prototype.addStruct=function(t,e){this.structDict[t]?console.log("<"+t+">struct"):(this.structDict[t]=e,this.structNames.push(t))},t.prototype.addContent=function(t){for(var e=0;e<t.structNames.length;++e)this.addStruct(t.structNames[e],t.structDict[t.structNames[e]]);for(var e=0;e<t.funcNames.length;++e)this.addFunc(t.funcNames[e],t.funcDict[t.funcNames[e]]);for(var e=0;e<t.attributeList.length;++e){for(var i=!0,r=0;r<this.attributeList.length;++r)if(t.attributeList[e].name==this.attributeList[r].name){t.attributeList[e].valueType!=this.attributeList[r].valueType||t.attributeList[e].key!=this.attributeList[r].key,i=!1;break}i&&this.attributeList.push(t.attributeList[e].clone())}for(var e=0;e<t.varyingList.length;++e){for(var i=!0,r=0;r<this.varyingList.length;++r)if(t.varyingList[e].name==this.varyingList[r].name){t.varyingList[e].valueType!=this.varyingList[r].valueType||t.varyingList[e].key!=this.varyingList[r].key,i=!1;break}i&&this.varyingList.push(t.varyingList[e].clone())}for(var e=0;e<t.uniformList.length;++e){for(var i=!0,r=0;r<this.uniformList.length;++r)if(t.uniformList[e].name==this.uniformList[r].name){t.uniformList[e].valueType!=this.uniformList[r].valueType||t.uniformList[e].key!=this.uniformList[r].key,i=!1;break}i&&this.uniformList.push(t.uniformList[e].clone())}for(var e=0;e<t.constList.length;++e){for(var i=!0,r=0;r<this.constList.length;++r)if(t.constList[e].name==this.constList[r].name){t.constList[e].valueType!=this.constList[r].valueType||t.constList[e].key!=this.constList[r].key,i=!1;break}i&&this.constList.push(t.constList[e].clone())}for(var e=0;e<t.tempList.length;++e){for(var i=!0,r=0;r<this.tempList.length;++r)if(t.tempList[e].name==this.tempList[r].name){t.tempList[e].valueType!=this.tempList[r].valueType||t.tempList[e].key!=this.tempList[r].key,i=!1;break}i&&this.tempList.push(t.tempList[e].clone())}for(var e=0;e<t.sampler2DList.length;++e){for(var i=!0,r=0;r<this.sampler2DList.length;++r)if(t.sampler2DList[e].name==this.sampler2DList[r].name){t.sampler2DList[e].valueType!=this.sampler2DList[r].valueType||t.sampler2DList[e].key!=this.sampler2DList[r].key,i=!1;break}i&&this.sampler2DList.push(t.sampler2DList[e].clone())}for(var e=0;e<t.sampler3DList.length;++e){for(var i=!0,r=0;r<this.sampler3DList.length;++r)if(t.sampler3DList[e].name==this.sampler3DList[r].name){t.sampler2DList[e].valueType!=this.sampler3DList[r].valueType||t.sampler3DList[e].key!=this.sampler3DList[r].key,i=!1;break}i&&this.sampler3DList.push(t.sampler3DList[e].clone())}for(var e=0;e<t.extensionList.length;++e){for(var i=!0,r=0;r<this.extensionList.length;++r)if(t.extensionList[e].name==this.extensionList[r].name){i=!1;break}i&&this.extensionList.push(t.extensionList[e].clone())}for(var e=0;e<t.defineList.length;++e){for(var i=!0,r=0;r<this.defineList.length;++r)if(t.defineList[e].name==this.defineList[r].name){i=!1;break}i&&this.defineList.push(t.defineList[e].clone())}},t.prototype.mergeMainFunc=function(t,e){var i=t,r="",a=e.indexOf("{"),n=e.lastIndexOf("}");a++,r=e.slice(a,n),a=i.lastIndexOf("}");var o=i.substr(0,a),s=i.substr(a,i.length-a);i=o,i+=r;var h="";return i+=h,i+=s},t.prototype.clone=function(){var e=new t;e.name=this.name,e.source=this.source;for(var i=0;i<this.funcNames.length;++i)e.funcNames.push(this.funcNames[i]);for(var r in this.funcDict)e.funcDict[r]=this.funcDict[r];for(var i=0;i<this.structNames.length;++i)e.structNames.push(this.structNames[i]);for(var r in this.structDict)e.structDict[r]=this.structDict[r];for(var i=0;i<this.attributeList.length;++i)e.attributeList.push(this.attributeList[i].clone());for(var i=0;i<this.varyingList.length;++i)e.varyingList.push(this.varyingList[i].clone());for(var i=0;i<this.uniformList.length;++i)e.uniformList.push(this.uniformList[i].clone());for(var i=0;i<this.constList.length;++i)e.constList.push(this.constList[i].clone());for(var i=0;i<this.tempList.length;++i)e.tempList.push(this.tempList[i].clone());for(var i=0;i<this.sampler2DList.length;++i)e.sampler2DList.push(this.sampler2DList[i].clone());for(var i=0;i<this.sampler3DList.length;++i)e.sampler3DList.push(this.sampler3DList[i].clone());for(var i=0;i<this.attributeList.length;++i)e.attributeList.push(this.attributeList[i].clone());for(var i=0;i<this.extensionList.length;++i)e.extensionList.push(this.extensionList[i].clone());for(var i=0;i<this.defineList.length;++i)e.defineList.push(this.defineList[i].clone());return e},t}();t.ShaderContent=e}(e=t.GLSL||(t.GLSL={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this._shaderContentDict=[],this.vs_begin="##define vs begin##",this.vs_end="##define vs end##",this.fs_begin="##define fs begin##",this.fs_end="##define fs end##"}return Object.defineProperty(e,"instance",{get:function(){return this._instance||(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.load=function(){var e=[],i=[];for(var r in t.ShaderLib.lib){var a=t.ShaderLib.lib[r].indexOf(this.vs_begin),n=t.ShaderLib.lib[r].indexOf(this.vs_end),o=!1;-1!=a&&(o=!0,a+=this.vs_begin.length,e.push(r),i[r+"vs"]=t.ShaderLib.lib[r].substr(a,n-a)),a=t.ShaderLib.lib[r].indexOf(this.fs_begin),n=t.ShaderLib.lib[r].indexOf(this.fs_end),-1!=a&&(a+=this.fs_begin.length,o&&e.push(r),i[r+"fs"]=t.ShaderLib.lib[r].substr(a,n-a))}for(var r in e)delete t.ShaderLib.lib[e[r]];for(var r in i)t.ShaderLib.lib[r]=i[r];for(var r in t.ShaderLib.lib){var s=this.readShader(t.ShaderLib.lib[r]);this._shaderContentDict[r]=s,s.name=r}},e.prototype.readShader=function(e){for(var i=new t.GLSL.ShaderContent,r=t.StringUtil.processShaderFile(e),a=t.StringUtil.parseContent(r),n=a.concat();n.length>0;){var o=n[0];n.shift();var s=t.StringUtil.getLineType(o),h=-1;if(h=s.indexOf("struct"),-1==h)if(h=s.indexOf("function"),-1==h)if(h=s.indexOf("unknown"),-1==h);else{var l=t.StringUtil.parseLines(o),u=t.StringUtil.getVarKey(l),c=t.StringUtil.getVarType(l);if("sampler2D"==c){var d=t.StringUtil.getSampler2D(o);d&&i.addVar(d)}else if("samplerCube"==c){var p=t.StringUtil.getSampler3D(o);p&&i.addVar(p)}else if("attribute"==u){var f=t.StringUtil.getAttribute(o);f&&i.addVar(f)}else if("varying"==u){var _=t.StringUtil.getVarying(o);_&&i.addVar(_)}else if("uniform"==u){var m=t.StringUtil.getUniform(o);m&&i.addVar(m)}else if("const"==u){var g=t.StringUtil.getConst(o);g&&i.addVar(g)}else if("#extension"==u){var v=t.StringUtil.getExtension(o);v&&i.addVar(v)}else if("#define"==u){var y=t.StringUtil.getDefine(o);y&&i.addVar(y)}else i.addVar(t.StringUtil.getTemper(o))}else{var l=s.split(" "),x=o;i.addFunc(l[1],x)}else{var l=s.split(" "),b=o;i.addStruct(l[1],b),t.StringUtil.processStruct(l[1],b,i)}}return i},e.prototype.fillShaderContent=function(i,r,a){var n,o=0,s="";for(o=0;o<r.length;++o)""!=s&&(s+="/"),s+=r[o];if(s+="/d"+a.maxDirectLight,s+="/s"+a.maxSpotLight,s+="/p"+a.maxPointLight,s+="/b"+a.maxBone,this._shaderContentDict[s])n=this._shaderContentDict[s].clone();else for(n=new t.GLSL.ShaderContent,n.name=s,o=0;o<r.length;++o){var h=this._shaderContentDict[r[o]];n.addContent(h)}for(o=0;o<n.attributeList.length;o++)s=n.attributeList[o].varName,a[s]=n.attributeList[o];for(o=0;o<n.varyingList.length;o++)s=n.varyingList[o].varName,a[s]||(a[s]=n.varyingList[o]);for(o=0;o<n.tempList.length;o++)s=n.tempList[o].varName,a[s]=n.tempList[o];for(o=0;o<n.uniformList.length;o++)s=n.uniformList[o].varName,a[s]=n.uniformList[o];var l;for(o=0;o<n.constList.length;o++)switch(s=n.constList[o].varName,l=n.constList[o],a[s]=l,s){case"max_directLight":l.value=a.maxDirectLight;break;case"max_spotLight":l.value=a.maxSpotLight;break;case"max_pointLight":l.value=a.maxPointLight;break;case"bonesNumber":i.maxBone=a.maxBone,l.value=a.maxBone}for(o=0;o<n.sampler2DList.length;o++){var u=n.sampler2DList[o];u.index=o,a.sampler2DList.push(u),u.activeTextureIndex=e.getTexture2DIndex(o)}for(o=0;o<n.sampler3DList.length;o++){var c=n.sampler3DList[o];c.activeTextureIndex=e.getTexture2DIndex(n.sampler2DList.length+o),c.index=n.sampler2DList.length+o,a.sampler3DList.push(c)}return this.synthesisShader(n,i),t.ShaderPool.getGPUShader(i.shaderType,n.name,n.source)},e.prototype.synthesisShader=function(t){var i,r="";for(i=0;i<t.extensionList.length;i++)r+=e.connectExtension(t.extensionList[i]);for(r+="precision highp float;            	\n",i=0;i<t.defineList.length;i++)r+=e.connectDefine(t.defineList[i]);for(i=0;i<t.attributeList.length;i++)r+=e.connectAtt(t.attributeList[i]);for(i=0;i<t.structNames.length;i++)r+=e.connectStruct(t.structDict[t.structNames[i]]);for(i=0;i<t.varyingList.length;i++)r+=e.connectVarying(t.varyingList[i]);for(i=0;i<t.tempList.length;i++)r+=e.connectTemp(t.tempList[i]);for(i=0;i<t.constList.length;i++)r+=e.connectConst(t.constList[i]);for(i=0;i<t.uniformList.length;i++)r+=e.connectUniform(t.uniformList[i]);for(i=0;i<t.sampler2DList.length;i++){var a=t.sampler2DList[i];r+=e.connectSampler(a)}for(i=0;i<t.sampler3DList.length;i++){var n=t.sampler3DList[i];r+=e.connectSampler3D(n)}for(i=0;i<t.funcNames.length;i++)r+=t.funcDict[t.funcNames[i]];t.source=r},e.connectAtt=function(t){return"attribute "+t.valueType+" "+t.name+"; \r\n"},e.connectTemp=function(t){return""!=t.value?t.valueType+" "+t.name+" = "+t.value+"; \r\n":t.valueType+" "+t.name+"; \r\n"},e.connectStruct=function(t){return t+" \r\n"},e.connectConst=function(t){return"const "+t.valueType+" "+t.name+" = "+t.value+"; \r\n"},e.connectVarying=function(t){return"varying "+t.valueType+" "+t.name+"; \r\n"},e.connectUniform=function(t){return"uniform "+t.valueType+" "+t.name+"; \r\n"},e.connectSampler=function(t){return"uniform sampler2D "+t.name+"; \r\n"},e.connectSampler3D=function(t){return"uniform samplerCube "+t.name+"; \r\n"},e.connectExtension=function(t){return"#extension "+t.name+":"+t.value+"\r\n"},e.connectDefine=function(t){return t.key+" "+t.name+" "+t.value+"\r\n"},e.getTexture2DIndex=function(e){switch(e){case 0:return t.ContextSamplerType.TEXTURE_0;case 1:return t.ContextSamplerType.TEXTURE_1;case 2:return t.ContextSamplerType.TEXTURE_2;case 3:return t.ContextSamplerType.TEXTURE_3;case 4:return t.ContextSamplerType.TEXTURE_4;case 5:return t.ContextSamplerType.TEXTURE_5;case 6:return t.ContextSamplerType.TEXTURE_6;case 7:return t.ContextSamplerType.TEXTURE_7;case 8:return t.ContextSamplerType.TEXTURE_8}throw new Error("texture not big then 8")},e._shaderLibs={},e._methodLibs={},e}();t.ShaderUtil=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this._boundBox=new t.BoundBox,this.shadowCamera=new t.Camera3D(t.CameraType.orthogonal),this.shadowRender=new t.MultiRender(t.PassType.shadowPass),this.shadowRender.setRenderToTexture(e.textureSizeWidth,e.textureSizeHeight,t.FrameBufferFormat.UNSIGNED_BYTE_RGBA),this.castShadowLight(new t.DirectLight(new t.Vector3D(0,-1,1)));var i=t.MathUtil.CALCULATION_VECTOR3D;i.copyFrom(this.directLight.dir),i.negate(),i.scaleBy(1e3),this.shadowCamera.globalPosition=i}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e.prototype.setTextureSize=function(i,r){e.textureSizeWidth=i,e.textureSizeHeight=r,this.shadowRender.setRenderToTexture(e.textureSizeWidth,e.textureSizeHeight,t.FrameBufferFormat.UNSIGNED_BYTE_RGBA)},e.prototype.castShadowLight=function(t){this.directLight=t,this.shadowCamera.updateViewport(0,0,2048,2048),this.shadowCamera.near=1,this.shadowCamera.far=3e3,t.addChild(this.shadowCamera)},e.prototype.update=function(e,i,r,a,n){this.calculateBoundBox(e),t.Egret3DCanvas.context3DProxy.clearColor(1,1,1,1),t.Egret3DCanvas.context3DProxy.clear(t.Context3DProxy.gl.COLOR_BUFFER_BIT|t.Context3DProxy.gl.DEPTH_BUFFER_BIT),this.shadowRender.draw(r,a,t.Egret3DCanvas.context3DProxy,e,this.shadowCamera,n)},e.prototype.calculateBoundBox=function(e){this._boundBox.min.copyFrom(new t.Vector3D(99999999,99999999,99999999)),this._boundBox.max.copyFrom(new t.Vector3D(-99999999,-99999999,-99999999));for(var i=0;i<e.renderList.length;i++){var r=e.renderList[i];if(r.material&&r.material.castShadow){var a=r.bound;this._boundBox.max.x<a.max.x+r.globalX&&(this._boundBox.max.x=a.max.x+r.globalX),this._boundBox.max.y<a.max.y+r.globalY&&(this._boundBox.max.y=a.max.y+r.globalY),this._boundBox.max.z<a.max.z+r.globalZ&&(this._boundBox.max.z=a.max.z+r.globalZ),this._boundBox.min.x>a.min.x+r.globalX&&(this._boundBox.min.x=a.min.x+r.globalX),this._boundBox.min.y>a.min.y+r.globalY&&(this._boundBox.min.y=a.min.y+r.globalY),this._boundBox.min.z>a.min.z+r.globalZ&&(this._boundBox.min.z=a.min.z+r.globalZ)}}this._boundBox.fillBox(this._boundBox.min,this._boundBox.max);var n=t.MathUtil.CALCULATION_VECTOR3D;n.copyFrom(this.directLight.dir),n.negate(),n.scaleBy(this._boundBox.radius),n.add(this._boundBox.center,n),this.shadowCamera.globalPosition=n,this.shadowCamera.updateViewport(0,0,2*this._boundBox.radius,2*this._boundBox.radius),this.shadowCamera.far=2*this._boundBox.radius},e.enableShadow=!1,e.textureSizeWidth=4096,e.textureSizeHeight=4096,e}();t.ShadowCast=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(t){function e(){t.apply(this,arguments),this.vertex_ShaderName={},this.fragment_ShaderName={},this.attributes=new Array}return __extends(e,t),e.prototype.build=function(){},e.prototype.afterBuild=function(){},e.prototype.initNode=function(){},e.prototype.update=function(){},e.prototype.activeState=function(){},e.prototype.upload=function(){},e.prototype.dispose=function(){},e}(t.EventDispatcher);t.AnimationNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){}return t}();t.AnimationCurve=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this._timeEvent=new t.Event3D,this._times=new Array,this._processTimes=new Array,this._timer=0,this._start=!1}return __extends(i,e),i.prototype.start=function(){this._timer=0,this._start=!0,this._processTimes.length=0;for(var t=0;t<this._times.length;++t)this._processTimes[t]=this._times[t]},i.prototype.addTimerAxis=function(t){this._times.push(t)},i.prototype.clearTimerAxis=function(){this._times.length=0,this._processTimes.length=0},i.prototype.reset=function(){this._processTimes.length=0,this._timer=0,this._start=!1;for(var t=0;t<this._times.length;++t)this._processTimes[t]=this._times[t]},i.prototype.update=function(t){if(this._start){this._timer+=t,console.log(this._timer+"update");for(var e=0;e<this._processTimes.length;++e)if(this._timer>=this._processTimes[e]){this._timeEvent.eventType=i.TIME_EVENT,this._timeEvent.data=this._processTimes[e],this.dispatchEvent(this._timeEvent),this._processTimes.splice(e,1);break}}},i.TIME_EVENT="TimeEvent",i}(t.EventDispatcher);t.TimerAxis=e}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t.Line=0]="Line",t[t.BesselCurve=1]="BesselCurve"}(t.CurveType||(t.CurveType={}));var e=t.CurveType,i=function(){function i(){this.type=e.Line,this.start=new t.Point,this.end=new t.Point,this.c1=new t.Point,this.c2=new t.Point,this.cache=null,this.useCache=!1}return i.prototype.calculateValue=function(t){if(t<this.start.x||t>this.end.x)return 0;if(this.useCache)return this.cache[Math.floor(t-this.start.x)];switch(this.type){case e.Line:return this.valueFromLine(t);case e.BesselCurve:return this.valueFromBesselCurve(t)}return 0},i.prototype.valueFromLine=function(t){var e=(t-this.start.x)/(this.end.x-this.start.x);return this.start.y+e*(this.end.y-this.start.y)},i.prototype.valueFromBesselCurve=function(t){var e=(t-this.start.x)/(this.end.x-this.start.x),i=1-e,r=i*i,a=r*i;return this.start.y*a+3*this.c1.y*e*r+3*this.c2.x*e*e*i+this.end.y*e*e*e},i.prototype.cacheCurveData=function(){this.cache=[];for(var t=this.start.x;t<this.end.x;t++)this.cache.push(this.calculateValue(t));this.useCache=!0},i}();t.AnimCurve=i}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function r(){e.call(this),this.speed=1,this.isLoop=!0,this._propertyArray=[],this._play=!1,this._timePosition=0,this._totalTime=0,this._changeFrameTime=0,this._oldFrameIndex=0,this._event3D=new t.Event3D}return __extends(r,e),r.prototype.IsExist=function(t){for(var e=0;e<this._propertyArray.length;e++)if(this._propertyArray[e].property==t)return!0;return!1},r.prototype.addAnimCurve=function(t,e){if(this.IsExist(t))return!1;if(null==e||e.length<=0)return!1;var r=new i;r.keyFrames=e,r.property=t,r.target=this._target,r.isLoop=!0,r.timePosition=0,this._propertyArray.push(r);for(var a=0;a<e.length;a++)e[a].end.x>this._totalTime&&(this._totalTime=e[a].end.x,e[a].cacheCurveData());this.updateBindData(r)},r.prototype.removeAnimCurve=function(t){for(var e=null,i=0;i<this._propertyArray.length;i++)if(this._propertyArray[i].property==t)return e=this._propertyArray[i],this._propertyArray.splice(i,1),e.keyFrames},r.prototype.setPropertyLoop=function(t,e){for(var i=null,r=0;r<this._propertyArray.length;r++)if(this._propertyArray[r].property==t){i=this._propertyArray[r],i.isLoop=e;break}},r.prototype.bindObject3D=function(t){this._target=t;for(var e=0;e<this._propertyArray.length;e++)this.updateBindData(this._propertyArray[e])},r.prototype.updateBindData=function(t){if(this._target){t.target=this._target;for(var e=t.property.split("."),i=0;i<e.length-1;i++)t.target=t.target[e[i]];t.name=e[e.length-1]}},r.prototype.play=function(){if(!this._play){this._play=!0,this._timePosition=0;for(var t=0;t<this._propertyArray.length;t++)this._propertyArray[t].timePosition=0}},r.prototype.stop=function(){this._play=!1},Object.defineProperty(r.prototype,"timePosition",{get:function(){return this._timePosition},set:function(e){if(e!=this._timePosition){var i=e-this._timePosition;if(this._timePosition=e,this.isLoop?(this._timePosition=e%this._totalTime,this._timePosition<0&&(this._timePosition+=this._totalTime)):this._timePosition<0?(this._timePosition=0,this._event3D.eventType=t.PropertyAnimEvent3D.EVENT_PLAY_COMPLETE,this._event3D.target=this,this.dispatchEvent(this._event3D),this.stop()):this._timePosition>this._totalTime&&(this._timePosition=this._totalTime,this._event3D.eventType=t.PropertyAnimEvent3D.EVENT_PLAY_COMPLETE,this._event3D.target=this,this.dispatchEvent(this._event3D),this.stop()),this._target)for(var r,a,n=0;n<this._propertyArray.length;n++){r=this._propertyArray[n],a=r.keyFrames;var o=r.timePosition+i;if(o!=r.timePosition){var s=a[a.length-1].end.x;if(r.timePosition=o,r.isLoop)r.timePosition=e%s,r.timePosition<0&&(r.timePosition+=s);else{if(r.timePosition<0){r.timePosition=0;continue}if(r.timePosition>s){r.timePosition=s;continue}}for(var h=0;h<a.length-1;h++)if(a[h].start.x<=r.timePosition&&a[h].end.x>r.timePosition){r.target[r.name]=a[h].calculateValue(r.timePosition);break}}}}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"totalTime",{get:function(){return this._totalTime},enumerable:!0,configurable:!0}),r.prototype.update=function(e){if(this._play){var i=this.timePosition;this.timePosition+=e*this.speed,this.timePosition<i&&(this._event3D.eventType=t.PropertyAnimEvent3D.EVENT_PLAY_COMPLETE,this._event3D.target=this,this.dispatchEvent(this._event3D))}},r.prototype.clone=function(){var t=new r;return t._propertyArray=this._propertyArray,t._totalTime=this._totalTime,t},r}(t.EventDispatcher);t.PropertyAnim=e;var i=function(){function t(){}return t}()}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e){this.parent=null,this.name=e,this.parentIndex=-1,this.scale=new t.Vector3D(1,1,1),this.orientation=new t.Quaternion,this.translation=new t.Vector3D,this.localMatrix=new t.Matrix4_4,this.worldMatrix=new t.Matrix4_4,this.worldMatrixValid=!1}return e.prototype.clone=function(){var t=new e(this.name);return t.parent=this.parent,t.parentIndex=this.parentIndex,t.scale.copyFrom(this.scale),t.orientation.copyFrom(this.orientation),t.translation.copyFrom(this.translation),t.localMatrix.copyFrom(this.localMatrix),t.worldMatrix.copyFrom(this.worldMatrix),t.worldMatrixValid=this.worldMatrixValid,t},e.prototype.buildLocalMatrix=function(e,i,r){this.scale.copyFrom(e),this.translation.copyFrom(r),i instanceof t.Vector3D?this.orientation.fromEulerAngles(i.x,i.y,i.z):this.orientation.copyFrom(i),this.localMatrix.makeTransform(this.translation,this.scale,this.orientation),this.worldMatrixValid=!1},e.prototype.buildInverseMatrix=function(e,i,r){this.inverseMatrix||(this.inverseMatrix=new t.Matrix4_4),i instanceof t.Vector3D?this.inverseMatrix.recompose([r,i,e]):this.inverseMatrix.makeTransform(r,e,i)},e}();t.Joint=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){this.joints=[]}return t.prototype.clone=function(){for(var e=new t,i=0;i<this.joints.length;i++)e.joints.push(this.joints[i].clone());return e},Object.defineProperty(t.prototype,"jointNum",{get:function(){return this.joints.length},enumerable:!0,configurable:!0}),t.prototype.findJoint=function(t){for(var e=0;e<this.joints.length;e++)if(this.joints[e].name==t)return this.joints[e];return null},t.prototype.findJointIndex=function(t){for(var e=0;e<this.joints.length;e++)if(this.joints[e].name==t)return e;return-1},t}();t.Skeleton=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.joints=[]}return e.prototype.clone=function(){var t=new e;t.frameTime=this.frameTime;for(var i=0;i<this.joints.length;i++)t.joints.push(this.joints[i].clone());return t},e.prototype.lerp=function(i,r,a){if(i.joints.length!=r.joints.length)throw Error("Bone number does not match!");if(this.joints.length<i.joints.length)for(var n=this.joints.length;n<=i.joints.length;++n)this.joints.push(new t.Joint(""));this.frameTime=(r.frameTime-i.frameTime)*a+i.frameTime;for(var n=0;n<i.joints.length;++n){var o=i.joints[n],s=r.joints[n],h=this.joints[n];if(h.name=o.name,h.parent=o.parent,h.parentIndex=o.parentIndex,h.scale.lerp(o.scale,s.scale,a),h.orientation.slerp(o.orientation,s.orientation,a),h.translation.slerp(o.translation,s.translation,a),h.buildLocalMatrix(h.scale,h.orientation,h.translation),h.worldMatrixValid=o.worldMatrixValid,h.worldMatrixValid){var l=o.worldMatrix.decompose(t.Orientation3D.QUATERNION,e._temp_matrixDecomposeA),u=s.worldMatrix.decompose(t.Orientation3D.QUATERNION,e._temp_matrixDecomposeB);e._temp_v0.slerp(l[0],u[0],a),e._temp_q1.x=l[1].x,e._temp_q1.y=l[1].y,e._temp_q1.z=l[1].z,e._temp_q1.w=l[1].w,e._temp_q2.x=u[1].x,e._temp_q2.y=u[1].y,e._temp_q2.z=u[1].z,e._temp_q2.w=u[1].w,e._temp_q0.slerp(e._temp_q1,e._temp_q2,a),e._temp_v1.lerp(l[2],u[2],a),h.worldMatrix.makeTransform(e._temp_v0,e._temp_v1,e._temp_q0)}}return this},e.prototype.calculateJointWorldMatrix=function(){for(var t=0;t<this.joints.length;++t)this.calculateAbsoluteMatrix(t)},e.prototype.calculateAbsoluteMatrix=function(t){var e=this.joints[t];e.parentIndex>=0&&this.calculateAbsoluteMatrix(e.parentIndex),e.worldMatrixValid||(e.worldMatrix.copyFrom(e.localMatrix),e.parentIndex>=0&&e.worldMatrix.append(this.joints[e.parentIndex].worldMatrix),e.worldMatrixValid=!0)},e.prototype.updateGPUCacheData=function(i,r,a){for(var n=0;n<i.joints.length;++n)for(var o=0;o<this.joints.length;++o)if(i.joints[n].name==this.joints[o].name){e._temp_jointMatrix.copyFrom(i.joints[n].inverseMatrix),e._temp_jointMatrix.append(this.joints[o].worldMatrix);var s=e._temp_jointMatrix.decompose(t.Orientation3D.QUATERNION,e._temp_matrixDecomposeA);r[8*n+0]=s[1].x,r[8*n+1]=s[1].y,r[8*n+2]=s[1].z,r[8*n+3]=s[1].w,r[8*n+4]=s[0].x-a.x,r[8*n+5]=s[0].y-a.y,r[8*n+6]=s[0].z-a.z,r[8*n+7]=1;break}return r},e.prototype.findJoint=function(t){for(var e=0;e<this.joints.length;e++)if(this.joints[e].name==t)return this.joints[e];return null},e.prototype.findJointIndex=function(t){if(""==t)return-1;for(var e=0;e<this.joints.length;e++)if(this.joints[e].name==t)return e;return-1},e.prototype.resetWorldMatrix=function(){for(var t=0;t<this.joints.length;t++)this.joints[t].worldMatrixValid=!1},e._temp_v0=new t.Vector3D,e._temp_v1=new t.Vector3D,e._temp_v2=new t.Vector3D,e._temp_q0=new t.Quaternion,e._temp_q1=new t.Quaternion,e._temp_q2=new t.Quaternion,e._temp_jointMatrix=new t.Matrix4_4,e._temp_matrixDecomposeA=[new t.Vector3D,new t.Vector3D,new t.Vector3D],e._temp_matrixDecomposeB=[new t.Vector3D,new t.Vector3D,new t.Vector3D],e}();t.SkeletonPose=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.poseArray=[],this.animationName="",this.sampling=0,this.boneCount=0,this.frameDataOffset=0,this.sourceData=null,this._frameCount=0,this._timeLength=0,this._skeletonPose=null,this._temp_scale=new t.Vector3D,this._temp_translation=new t.Vector3D,this._temp_orientation=new t.Quaternion}return Object.defineProperty(e.prototype,"currentSkeletonPose",{get:function(){return this._skeletonPose},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameCount",{get:function(){return this.poseArray.length>0?this.poseArray.length:this._frameCount},enumerable:!0,configurable:!0}),e.prototype.findJointIndex=function(t){return this._skeletonPose?this._skeletonPose.findJointIndex(t):this.poseArray.length<=0?-1:this.poseArray[0].findJointIndex(t)},e.prototype.addSkeletonPose=function(t){this.poseArray.push(t)},e.prototype.buildInitialSkeleton=function(e,i,r){if(!this._skeletonPose){this._frameCount=r,this._skeletonPose=new t.SkeletonPose;for(var a=0;a<this.boneCount;a++){var n=new t.Joint(e[a]);n.parent=i[a],n.parentIndex=this._skeletonPose.findJointIndex(n.parent),this._skeletonPose.joints.push(n)}this.sourceData.position=this.frameDataOffset+(40*this.boneCount+4)*(this.frameCount-1),this._timeLength=this.sourceData.readInt()/60/80*1e3}},e.prototype.getSkeletonPose=function(t){return this.poseArray.length>0?this.poseArray[t]:0>t||t>=2*this.frameCount?null:(t=Math.floor(t/2),this.readSkeletonPose(t,this._skeletonPose))},e.prototype.readSkeletonPose=function(t,e){this.sourceData.position=this.frameDataOffset+(40*this.boneCount+4)*t,e.frameTime=this.sourceData.readInt()/60/80*1e3;for(var i=0;i<this.boneCount;i++)this._temp_orientation.x=this.sourceData.readFloat(),this._temp_orientation.y=this.sourceData.readFloat(),this._temp_orientation.z=this.sourceData.readFloat(),this._temp_orientation.w=this.sourceData.readFloat(),this._temp_scale.x=this.sourceData.readFloat(),this._temp_scale.y=this.sourceData.readFloat(),this._temp_scale.z=this.sourceData.readFloat(),this._temp_translation.x=this.sourceData.readFloat(),this._temp_translation.y=this.sourceData.readFloat(),this._temp_translation.z=this.sourceData.readFloat(),e.joints[i].worldMatrixValid=!1,e.joints[i].buildLocalMatrix(this._temp_scale,this._temp_orientation,this._temp_translation);return e.calculateJointWorldMatrix(),e},Object.defineProperty(e.prototype,"timeLength",{get:function(){return this.poseArray.length>0?this.poseArray[this.poseArray.length-1].frameTime:this._timeLength},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"jointNum",{get:function(){return this.poseArray.length>0?this.poseArray[0].joints.length:this.boneCount},enumerable:!0,configurable:!0}),e.prototype.clone=function(){var t=new e;return t.animationName=this.animationName,t.poseArray=this.poseArray,t.sampling=this.sampling,t.boneCount=this.boneCount,t._frameCount=this._frameCount,t.frameDataOffset=this.frameDataOffset,t.sourceData=this.sourceData,t._timeLength=this._timeLength,t._skeletonPose=this._skeletonPose,this._skeletonPose&&(t._skeletonPose=this._skeletonPose.clone()),t},e}();t.SkeletonAnimationClip=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(t){this.name="",this.weight=1,this._timeLength=0,this._timePosition=0,this._skeletonAnimation=null,this._skeletonAnimationClip=null,this.name=t}return Object.defineProperty(e.prototype,"skeletonAnimation",{get:function(){return this._skeletonAnimation},set:function(t){this._skeletonAnimation=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skeletonAnimationClip",{get:function(){return this._skeletonAnimationClip},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeLength",{get:function(){return this._timeLength},enumerable:!0,configurable:!0}),e.prototype.addAnimationClip=function(e){if(e.sourceData)this._skeletonAnimationClip=e,this._timeLength=this._skeletonAnimationClip.timeLength;else{if(this._skeletonAnimationClip?this._skeletonAnimationClip.poseArray=[]:this._skeletonAnimationClip=new t.SkeletonAnimationClip,e.poseArray.length<2)this._skeletonAnimationClip.poseArray=e.poseArray;else{var i=e.poseArray[0],r=e.poseArray[1],a=Math.round((r.frameTime-i.frameTime)/t.SkeletonAnimation.fps);if(1>=a)this._skeletonAnimationClip.poseArray=e.poseArray;else{for(var n=1;n<e.poseArray.length;++n){i=e.poseArray[n-1],r=e.poseArray[n];for(var o=0;a>o;o++){var s=new t.SkeletonPose;s.lerp(i,r,o/a),this._skeletonAnimationClip.poseArray.push(s)}}this._skeletonAnimationClip.poseArray.push(e.poseArray[e.poseArray.length-1].clone())}}this._timeLength=this._skeletonAnimationClip.poseArray[this._skeletonAnimationClip.poseArray.length-1].frameTime}},Object.defineProperty(e.prototype,"timePosition",{get:function(){return this._timePosition},set:function(e){e!=this._timePosition&&(this._timePosition=e,this._skeletonAnimation.isLoop?(this._timePosition=e%this._timeLength,this._timePosition<0&&(this._timePosition+=this._timeLength)):this._timePosition<0?(this._timePosition=0,this.name==this._skeletonAnimation.currentAnimName&&(this._skeletonAnimation.stop(),this._skeletonAnimation.event3D.target=this._skeletonAnimation,this._skeletonAnimation.event3D.eventType=t.SkeletonAnimationEvent3D.EVENT_PLAY_COMPLETE,this._skeletonAnimation.dispatchEvent(this._skeletonAnimation.event3D))):this._timePosition>this._timeLength&&(this._timePosition=this._timeLength,this.name==this._skeletonAnimation.currentAnimName&&(this._skeletonAnimation.stop(),this._skeletonAnimation.event3D.target=this._skeletonAnimation,this._skeletonAnimation.event3D.eventType=t.SkeletonAnimationEvent3D.EVENT_PLAY_COMPLETE,this._skeletonAnimation.dispatchEvent(this._skeletonAnimation.event3D))))
},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentSkeletonPose",{get:function(){return this._skeletonAnimationClip.getSkeletonPose(this.currentFrameIndex)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"previousSkeletonPose",{get:function(){var t=this.currentFrameIndex;return this._skeletonAnimation.speed>0?(t--,0>t&&(t=this.frameNum-t)):t=(t+1)%this.frameNum,this._skeletonAnimationClip.getSkeletonPose(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentFrameIndex",{get:function(){return Math.floor(this._timePosition/t.SkeletonAnimation.fps)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameNum",{get:function(){return this._skeletonAnimationClip?this._skeletonAnimationClip.frameCount:0},enumerable:!0,configurable:!0}),e.prototype.getSkeletonPose=function(t){return this._skeletonAnimationClip.getSkeletonPose(t)},e.prototype.clone=function(){var t=new e(this.name);return t._timeLength=this._timeLength,t._skeletonAnimation=this._skeletonAnimation,t._skeletonAnimationClip=this._skeletonAnimationClip,t},e}();t.SkeletonAnimationState=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.speed=1,this.event3D=new t.Event3D,this.isLoop=!0,this._isPlay=!1,this._animTime=0,this._animStateNames=[],this._animStates=[],this._blendSpeed=0,this._blendSkeleton=null,this._blendList=[],this._bindList={},this._temp_quat=new t.Quaternion,this._temp_vec3=new t.Vector3D,this._currentFrame=0,this._changeFrameTime=0,this._oldFrameIndex=0,this._movePosIndex=-1,this._movePosObject3D=null,this._movePosition=new t.Vector3D,this._resetMovePos=!0,this._currentSkeletonPose=null,this._oldTime=0,this._isPlay=!1}return __extends(i,e),i.prototype.addSkeletonAnimationClip=function(e){var i=new t.SkeletonAnimationState(e.animationName);i.skeletonAnimation=this,i.addAnimationClip(e),this.addAnimState(i)},Object.defineProperty(i.prototype,"skeletonAnimationController",{get:function(){return this},enumerable:!0,configurable:!0}),i.prototype.addAnimState=function(t){for(var e=0;e<this._animStates.length;e++)if(this._animStates[e].name==t.name)return;this._animStates.push(t),this._animStateNames.push(t.name)},i.prototype.removeAnimState=function(t){for(var e=0;e<this._animStates.length;e++)if(this._animStates[e].name==t.name)return this._animStates.slice(e,1),void this._animStateNames.slice(e,1)},i.prototype.play=function(t,e,r,a){if(void 0===e&&(e=1),void 0===r&&(r=!0),void 0===a&&(a=!0),!(this._animStates.length<=0)){t||(t=this._animStates[0].name);for(var n=null,o=0;o<this._animStates.length;o++)if(this._animStates[o].name==t){n=this._animStates[o];break}n&&(this._currentAnimName=t,this._blendList.push(n),this._blendSpeed<=0&&this._blendList.length>1&&this._blendList.splice(0,this._blendList.length-1),n.weight=this._blendList.length>1?0:1,r&&(this._animTime=n.timePosition=0),this._changeFrameTime=n.timePosition,this._oldFrameIndex=Math.floor(this._changeFrameTime/i.fps),this.speed=e,this._isPlay=!0,this._resetMovePos=!0,-1!=this._movePosIndex&&this._movePosition.copyFrom(n.getSkeletonPose(0).joints[this._movePosIndex].worldMatrix.position))}},i.prototype.pause=function(){this._isPlay=!1},i.prototype.stop=function(){this._isPlay=!1},i.prototype.update=function(e,r){if(this._oldTime!=e&&(this._oldTime=e,this._isPlay&&!(this._blendList.length<=0))){var a=this._blendList[this._blendList.length-1],n=r*this.speed;this._changeFrameTime+=n;for(var o=Math.floor(Math.abs(this._changeFrameTime/i.fps)),s=this.currentAnimName,h=0;o>h;++h){if(this.event3D.eventType=t.SkeletonAnimationEvent3D.EVENT_FRAME_CHANGE,this.event3D.target=this,0>n?(this.event3D.data=(this._oldFrameIndex-1-h)%a.frameNum,this.event3D.data<0&&(this.event3D.data+=a.frameNum)):this.event3D.data=(this._oldFrameIndex+1+h)%a.frameNum,this.dispatchEvent(this.event3D),this.currentAnimName!=s){this.event3D.data=Math.floor(this._changeFrameTime/i.fps);break}this._changeFrameTime+=n>0?-i.fps:i.fps}this._oldFrameIndex=this.event3D.data,this.animTime+=r*this.speed}},i.prototype.activeState=function(t,e,i,r,a){this._currentSkeletonPose&&this._currentSkeletonPose.updateGPUCacheData(r.geometry.skeleton,r.geometry.skeletonGPUData,this._movePosition),i.uniform_time&&a.uniform1f(i.uniform_time.uniformIndex,this.animTime),a.uniform4fv(i.uniform_PoseMatrix.uniformIndex,r.geometry.skeletonGPUData)},i.prototype.clone=function(){var t=new i;t._blendSpeed=this._blendSpeed,t.isLoop=this.isLoop,t._animStateNames=this._animStateNames.concat([]);for(var e=0;e<this._animStates.length;e++)t._animStates.push(this._animStates[e].clone());return t},Object.defineProperty(i.prototype,"jointNum",{get:function(){return 48},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animStateNames",{get:function(){return this._animStateNames},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animStates",{get:function(){return this._animStates},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animTime",{get:function(){return this._animTime},set:function(t){if(!(this._blendList.length<=0)&&this._blendList[this._blendList.length-1].timePosition!=t){var e=t-this._animTime;if(this._blendSpeed<=0)this._blendList.length>1&&this._blendList.splice(0,this._blendList.length-1),this._blendList[0].weight=1,this._blendList[0].timePosition+=e;else{for(var i=Math.abs(e/this._blendSpeed),r=0;r<this._blendList.length;++r){var a=this._blendList[r];if(r!=this._blendList.length-1){if(a.weight=Math.max(0,a.weight-i),a.weight<=0){this._blendList.splice(r,1),--r;continue}}else a.weight=Math.min(1,a.weight+i)}this._blendList[this._blendList.length-1].timePosition+=e}this._animTime=this._blendList[this._blendList.length-1].timePosition;var n=this._blendList[0],o=n.currentSkeletonPose;if(this._blendList.length<=1)this._blendSkeleton||(this._blendSkeleton=o.clone()),this.updateBindList(o),this.updateMovePos(o),this._currentSkeletonPose=o;else{var s=this._blendList[1],h=s.currentSkeletonPose;this._blendSkeleton||(this._blendSkeleton=o.clone()),this._blendSkeleton.lerp(o,h,s.weight),this._blendSkeleton.resetWorldMatrix(),this._blendSkeleton.calculateJointWorldMatrix(),this.updateBindList(this._blendSkeleton),this.updateMovePos(this._blendSkeleton),this._currentSkeletonPose=this._blendSkeleton}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"timeLength",{get:function(){return this._blendList.length<=0?0:this._blendList[this._blendList.length-1].timeLength},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"frameIndex",{get:function(){return this.animTime/i.fps},set:function(t){this.animTime=t*i.fps},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"blendSpeed",{get:function(){return this._blendSpeed},set:function(t){this._blendSpeed=Math.max(t,0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentAnimName",{get:function(){return this._currentAnimName},enumerable:!0,configurable:!0}),i.prototype.isPlay=function(){return this._isPlay},i.prototype.bindToJointPose=function(t,e){var i=this._animStates[0].skeletonAnimationClip.findJointIndex(t);if(0>i)return!1;var r=null;return this._bindList[i]?r=this._bindList[i]:(r=new Array,this._bindList[i]=r),r.push(e),!0},i.prototype.setMovePosJointName=function(t,e){var i=this._animStates[0].skeletonAnimationClip.findJointIndex(t);return 0>i?!1:(this._movePosIndex=i,this._movePosObject3D=e,this._resetMovePos=!0,!0)},i.prototype.updateBindList=function(t){var e=null,i=null,r=null;for(var a in this._bindList)if(e=this._bindList[a],!(e.length<=0)&&(i=t.joints[a]))for(var n=0;n<e.length;n++)r=e[n],this._temp_quat.fromMatrix(i.worldMatrix),r.orientation=this._temp_quat,r.x=i.worldMatrix.position.x-this._movePosition.x,r.y=i.worldMatrix.position.y-this._movePosition.y,r.z=i.worldMatrix.position.z-this._movePosition.z},i.prototype.updateMovePos=function(t){var e=null;-1!=this._movePosIndex&&(e=t.joints[this._movePosIndex],this._movePosObject3D&&(this._movePosition.x=e.worldMatrix.position.x-this._movePosition.x,this._movePosition.y=e.worldMatrix.position.y-this._movePosition.y,this._movePosition.z=e.worldMatrix.position.z-this._movePosition.z,this._movePosObject3D.orientation.transformVector(this._movePosition,this._movePosition),this._movePosObject3D.x+=this._movePosition.x,this._movePosObject3D.y+=this._movePosition.y,this._movePosObject3D.z+=this._movePosition.z,this._resetMovePos&&(this._resetMovePos=!1,this._movePosObject3D.x-=this._movePosition.x,this._movePosObject3D.y+=this._movePosition.y,this._movePosObject3D.z-=this._movePosition.z)),this._movePosition.copyFrom(e.worldMatrix.position))},i.fps=1e3/60,i}(t.EventDispatcher);t.SkeletonAnimation=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e,i){this.volume=1,this.loop=!1,this.pitch=1,i=i||{},i.volume&&(this.volume=i.volume),i.loop&&(this.loop=i.loop),i.pitch&&(this.pitch=i.pitch),this.sound=e,this.paused=!1,t.AudioManager.instance.hasAudioContext()?(this.context=t.AudioManager.instance.context,this.startTime=0,this.startOffset=0,this.source=null,this.gain=this.context.createGain()):t.AudioManager.instance.hasAudio()&&this.sound.audio&&(this.source=this.sound.audio.cloneNode(!1),this.source.pause())}return e.prototype.play=function(){if(t.AudioManager.instance.hasAudioContext()){if(this.source)throw new Error("Call stop() before calling play()");if(this.createSource(),!this.source)return;this.startTime=this.context.currentTime,this.source.start(0,this.startOffset%this.source.buffer.duration)}else t.AudioManager.instance.hasAudio&&(this.paused=!1,this.source.play());this.setVolume(this.volume),this.setLoop(this.loop),this.setPitch(this.pitch)},e.prototype.pause=function(){t.AudioManager.instance.hasAudioContext()?this.source&&(this.startOffset+=this.context.currentTime-this.startTime,this.source.stop(0),this.source=null):t.AudioManager.instance.hasAudio()&&this.source&&this.source.pause(),this.paused=!0},e.prototype.unpause=function(){if(t.AudioManager.instance.hasAudioContext()){if(this.source||!this.paused)throw new Error("Call pause() before unpausing.");if(this.createSource(),!this.source)return;this.startTime=this.context.currentTime,this.source.start(0,this.startOffset%this.source.buffer.duration),this.setVolume(this.volume),this.setLoop(this.loop),this.setPitch(this.pitch)}else t.AudioManager.instance.hasAudio()&&this.source.play();this.paused=!1},e.prototype.stop=function(){t.AudioManager.instance.hasAudioContext()?this.source&&(this.source.stop(0),this.startOffset=0,this.source=null):t.AudioManager.instance.hasAudio()&&this.source&&(this.source.pause(),this.source.currentTime=0)},e.prototype.setLoop=function(t){this.source&&(this.source.loop=t)},e.prototype.setVolume=function(e){this.gain?this.gain.gain.value=e*t.AudioManager.instance.volume:this.source&&(this.source.volume=e*t.AudioManager.instance.volume)},e.prototype.setPitch=function(e){t.AudioManager.instance.hasAudioContext()?this.source&&(this.source.playbackRate.value=e):t.AudioManager.instance.hasAudio()&&this.source&&(this.source.playbackRate=e)},e.prototype.isPlaying=function(){return t.AudioManager.instance.hasAudioContext()?!this.paused:t.AudioManager.instance.hasAudio()?!this.source.paused:void 0},e.prototype.getDuration=function(){if(t.AudioManager.instance.hasAudioContext()){if(this.source)return this.source.buffer.duration}else if(t.AudioManager.instance.hasAudio()&&this.source){var e=this.source.duration;if(e===e)return e}return 0},e.prototype.createSource=function(){var t=this;this.sound.buffer&&(this.source=this.context.createBufferSource(),this.source.buffer=this.sound.buffer,this.source.connect(this.gain),this.gain.connect(this.context.destination),this.loop&&(this.source.onended=function(){return t.play()}))},e}();t.Channel=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r){e.call(this,i,r),this._position=new t.Vector3D,this._velocity=new t.Vector3D,t.AudioManager.instance.hasAudioContext()&&(this._panner=this.context.createPanner()),this._maxDistance=1e4,this._minDistance=1,this._rollOffFactor=1,this._listener=new t.Vector3D}return __extends(i,e),Object.defineProperty(i.prototype,"listener",{get:function(){return this._listener},set:function(e){if(this._listener.copyFrom(e),t.AudioManager.instance.hasAudio()&&this.source){var i=this.fallOff(this._listener,this.position,this.minDistance,this.maxDistance,this.rollOffFactor);this.source.volume=this.volume*i}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return this._position},set:function(e){if(this._position.copyFrom(e),t.AudioManager.instance.hasAudioContext()&&this._panner.setPosition(e.x,e.y,e.z),t.AudioManager.instance.hasAudio()&&this.source){var i=this.fallOff(this._listener,this.position,this.minDistance,this.maxDistance,this.rollOffFactor);this.source.volume=this.volume*i}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"velocity",{get:function(){return this._velocity},set:function(e){this._velocity.copyFrom(e),t.AudioManager.instance.hasAudioContext()&&this._panner.setVelocity(e.x,e.y,e.z)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maxDistance",{get:function(){return this._maxDistance},set:function(e){this._maxDistance=e,t.AudioManager.instance.hasAudioContext()&&(this._panner.maxDistance=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"minDistance",{get:function(){return this._minDistance},set:function(e){this._minDistance=e,t.AudioManager.instance.hasAudioContext()&&(this._panner.refDistance=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rollOffFactor",{get:function(){return this._rollOffFactor},set:function(t){this._rollOffFactor=t,this._panner&&(this._panner.rolloffFactor=t)},enumerable:!0,configurable:!0}),i.prototype.createSource=function(){this.sound.buffer&&(this.source=this.context.createBufferSource(),this.source.buffer=this.sound.buffer,this.source.connect(this._panner),this._panner.connect(this.gain),this.gain.connect(this.context.destination))},i.prototype.fallOff=function(e,i,r,a){var n=t.Vector3D.distance(e,i);return r>n?1:n>a?0:1-n/(a-r)},i}(t.Channel);t.Channel3d=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(r,a,n){var o=this;if(void 0===a&&(a=null),void 0===n&&(n=null),e.call(this),this.audio=null,this._event=new t.Event3D,this._success=a,this._error=n,this.isLoaded=!1,t.AudioManager.instance.hasAudioContext())t.AudioManager.instance.isSupported(r,this.audio)?(console.warn("Audio format not supported"),this._event.eventType=i.SOUND_ERROR,this._event.target=this,this.dispatchEvent(this._event),n(this)):t.AudioManager.instance.context&&this.loadAudioFile(r);else if(t.AudioManager.instance.hasAudio()){try{this.audio=new Audio}catch(s){return console.warn("No support for Audio element"),this._event.eventType=i.SOUND_ERROR,this._event.target=this,this.dispatchEvent(this._event),void(n&&n(this))}t.AudioManager.instance.isSupported(r,this.audio)?(console.warn("Audio format not supported"),this._event.eventType=i.SOUND_ERROR,this._event.target=this,this.dispatchEvent(this._event),n&&n(this)):(this.audio.src=r,this.audio.addEventListener("canplaythrough",function(t){return o.oncanplaythrough(t)}),this.audio.addEventListener("ended",function(t){return o.onended(t)}),this.audio.load())}}return __extends(i,e),Object.defineProperty(i.prototype,"buffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0}),i.prototype.loadAudioFile=function(t){var e=this;null==this.xhr&&(this.xhr=new XMLHttpRequest),this.xhr.open("GET",t,!0),this.xhr.responseType="arraybuffer",this.xhr.onload=function(t){return e.audioLoadend(t)},this.xhr.send()},i.prototype.audioLoadend=function(){var e=this;t.AudioManager.instance.context.decodeAudioData(this.xhr.response,function(t){return e.decodeSuccessCallback(t)})},i.prototype.decodeSuccessCallback=function(t){this._buffer=t,this._event.eventType=i.SOUND_SUCCESS,this._event.target=this,this._event.data=t,this.dispatchEvent(this._event),this._success&&this._success(this)},i.prototype.onended=function(){},i.prototype.oncanplaythrough=function(t){this.isLoaded||(this.isLoaded=!0,this._event.eventType=i.SOUND_SUCCESS,this._event.target=this,this._event.data=t,this.dispatchEvent(this._event),this._success&&this._success(this))},i.SOUND_SUCCESS="SoundSuccess",i.SOUND_ERROR="SoundError",i}(t.EventDispatcher);t.Sound=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.volume=1,this.codecs={},this.hasAudioContext()&&"undefined"!=typeof AudioContext&&(this.context=new AudioContext)}return e.prototype.hasAudio=function(){return"undefined"!=typeof Audio},e.prototype.hasAudioContext=function(){return!("undefined"==typeof AudioContext)},e.prototype.isSupported=function(t,e){null==this.codecs&&(null==e&&(e=new Audio),this.codecs={mp3:!!e.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!e.canPlayType("audio/aac;").replace(/^no$/,""),m4a:!!(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(e.canPlayType("audio/x-mp4;")||e.canPlayType("audio/mp4;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")});var i=t.match(/^data:audio\/([^;,]+);/i);return i||(i=t.split("?",1)[0].match(/\.([^.]+)$/)),i&&(i=i[1].toLowerCase()),this.codecs[i]},e.prototype.createSound=function(e,i,r){return void 0===i&&(i=null),void 0===r&&(r=null),new t.Sound(e,i,r)},e.prototype.playSound=function(e,i){i=i||{};var r=new t.Channel(e,i);return r.play(),r},e.prototype.playSound3d=function(e,i,r){r=r||{};var a=new t.Channel3d(e,r);return a.position=i,r.volume&&(a.volume=r.volume),r.loop&&(a.loop=r.loop),r.maxDistance&&(a.maxDistance=r.maxDistance),r.minDistance&&(a.minDistance=r.minDistance),r.rollOffFactor&&(a.rollOffFactor=r.rollOffFactor),a.play(),a},Object.defineProperty(e,"instance",{get:function(){return null==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e}();t.AudioManager=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null),this._autoUpdate=!0,this._origin=new t.Vector3D(0,0,0),this._target=e,this._lookAtObject=i}return Object.defineProperty(e.prototype,"target",{get:function(){return this._target},set:function(t){this._target!=t&&(this._target=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){this._autoUpdate!=t&&(this._autoUpdate=t)},enumerable:!0,configurable:!0}),e.prototype.notifyUpdate=function(){},e.prototype.update=function(){},e}();t.ControllerBase=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r,a,n){void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=!1),void 0===n&&(n=!1),e.call(this,i),this._origin=new t.Vector3D(0,0,0),this._lookAtPosition=new t.Vector3D,this._eyesPos=new t.Vector3D,this._up=t.Vector3D.Y_AXIS,this._eyesLength=0,this._rotaEyesLine=new t.Vector3D(0,0,1),this._rotaAngle=new t.Vector3D,this._matRot=new t.Matrix4_4,this._quaRot=new t.Quaternion,this._tempVec=new t.Vector3D,this._matTemp=new t.Matrix4_4,this._mouseDown=!1,this._mouseRightDown=!1,this._screenMoveStartDetail=new t.Point,this._screenMoveDelay=new t.Point,this._isUpdate=!1,this._elapsed=0,this._speed=3,this._xAngle=0,this._ctl=!1,this._alt=!1,this._shift=!1,this._needctl=!1,this._needalt=!1,this._needshift=!1,this._keyArray=new Array,this.lookAtOffset=new t.Vector3D(0,0,0),this.firstCamera=!1,this._needctl=a,this._needalt=n,this._keyArray.push(!1),this._keyArray.push(!1),this._keyArray.push(!1),this._keyArray.push(!1),r?this.lookAtObject=r:this.lookAtPosition=new t.Vector3D,this._eyesPos.copyFrom(i.position),this._lookAtPosition.copyFrom(r.position.add(this.lookAtOffset)),this._target.lookAt(this._eyesPos,this._lookAtPosition),t.Input.addEventListener(t.MouseEvent3D.MOUSE_MOVE,this.mouseMove,this),t.Input.addEventListener(t.MouseEvent3D.MOUSE_WHEEL,this.mouseWheel,this),t.Input.addEventListener(t.MouseEvent3D.MOUSE_UP,this.mouseUp,this),t.Input.addEventListener(t.MouseEvent3D.MOUSE_DOWN,this.mouseDown,this),t.Input.addEventListener(t.KeyEvent3D.KEY_UP,this.keyUp,this),t.Input.addEventListener(t.KeyEvent3D.KEY_DOWN,this.keyDown,this),t.Input.addEventListener(t.TouchEvent3D.TOUCH_END,this.touchUp,this),t.Input.addEventListener(t.TouchEvent3D.TOUCH_START,this.touchDown,this),t.Input.addEventListener(t.TouchEvent3D.TOUCH_MOVE,this.touchMove,this)}return __extends(i,e),i.prototype.scaleSpeed=function(t){this._speed*=t},i.prototype.mouseMove=function(){this._mouseDown&&(this._needctl?this._ctl:!0)&&(this._rotaAngle.y+=t.Input.mouseOffsetX,this._rotaAngle.x+=t.Input.mouseOffsetY,this._rotaAngle.y%=360,this._rotaAngle.x%=360)},i.prototype.mouseWheel=function(){if(this._target){var e=this._target;if(e){var i=.1*t.Input.wheelDelta,r=e.viewPort;switch(e.cameraType){case t.CameraType.orthogonal:var a=r.width-i,n=r.height-i;e.updateViewport(0,0,a,n);break;case t.CameraType.orthogonalToCenter:var o=r.x-i,s=r.y-i,a=r.width-i,n=r.height-i;e.updateViewport(o,s,a,n);break;case t.CameraType.perspective:this.distance=this._eyesLength-i}}}},i.prototype.mouseUp=function(e){switch(e.mouseCode){case t.MouseCode.Mouse_Left:this._mouseDown=!1;break;case t.MouseCode.Mouse_Right:this._mouseRightDown=!1}},i.prototype.mouseDown=function(e){switch(e.mouseCode){case t.MouseCode.Mouse_Left:this._mouseDown=!0;break;case t.MouseCode.Mouse_Right:this._mouseRightDown=!0}},i.prototype.touchMove=function(t){1==t.targetTouches.length?this.mouseMove(null):this.mouseWheel(null)},i.prototype.touchUp=function(){this._mouseDown=!1},i.prototype.touchDown=function(){this._mouseDown=!0},i.prototype.keyDown=function(e){switch(e.keyCode){case t.KeyCode.Key_W:this._keyArray[0]=!0;break;case t.KeyCode.Key_A:this._keyArray[1]=!0;break;case t.KeyCode.Key_S:this._keyArray[2]=!0;break;case t.KeyCode.Key_D:this._keyArray[3]=!0;break;case t.KeyCode.Key_Q:this._keyArray[4]=!0;break;case t.KeyCode.Key_E:this._keyArray[5]=!0;break;case t.KeyCode.Key_Control_L:this._ctl=!0;break;case t.KeyCode.Key_Alt_L:this._alt=!0}},i.prototype.keyUp=function(e){switch(e.keyCode){case t.KeyCode.Key_W:this._keyArray[0]=!1;break;case t.KeyCode.Key_A:this._keyArray[1]=!1;break;case t.KeyCode.Key_S:this._keyArray[2]=!1;break;case t.KeyCode.Key_D:this._keyArray[3]=!1;break;case t.KeyCode.Key_Q:this._keyArray[4]=!1;break;case t.KeyCode.Key_E:this._keyArray[5]=!1;break;case t.KeyCode.Key_Control_L:this._ctl=!1;break;case t.KeyCode.Key_Alt_L:this._alt=!1}},Object.defineProperty(i.prototype,"lookAtPosition",{get:function(){return this._lookAtPosition},set:function(t){this._lookAtObject&&(this._lookAtObject=null),this._lookAtPosition.copyFrom(t.add(this.lookAtOffset)),this.notifyUpdate()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lookAtObject",{get:function(){return this._lookAtObject},set:function(t){this._lookAtObject!=t&&(this._lookAtObject=t,this._lookAtPosition.copyFrom(this._lookAtObject.position.add(this.lookAtOffset)),this.notifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"distance",{get:function(){return this._eyesLength},set:function(t){this._eyesLength=t,this._eyesLength<1&&(this._eyesLength=1)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotationX",{get:function(){return this._rotaAngle.x},set:function(t){this._rotaAngle.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotationY",{get:function(){return this._rotaAngle.y},set:function(t){this._rotaAngle.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotationZ",{get:function(){return this._rotaAngle.z},set:function(t){this._rotaAngle.z=t},enumerable:!0,configurable:!0}),i.prototype.update=function(){if(this._target){if(0==this._target.isController)return;this._quaRot.fromEulerAngles(this._rotaAngle.x,this._rotaAngle.y,0),this._rotaEyesLine.copyFrom(this._quaRot.transformVector(t.Vector3D.Z_AXIS)),this._rotaEyesLine.normalize(),this._keyArray[0]&&(this._tempVec.copyFrom(this._rotaEyesLine),this._tempVec.y=0,this._tempVec.normalize(),this._tempVec.scaleBy(this._speed),this._tempVec.copyFrom(this._lookAtObject.position.add(this._tempVec)),this._lookAtObject.position=this._tempVec),this._keyArray[1]&&(this._tempVec.copyFrom(this._rotaEyesLine),this._matTemp.identity(),this._matTemp.appendRotation(90,t.Vector3D.Y_AXIS),this._tempVec.copyFrom(this._matTemp.transformVector(this._tempVec)),this._tempVec.y=0,this._tempVec.normalize(),this._tempVec.scaleBy(this._speed),this._tempVec.copyFrom(this._lookAtObject.position.subtract(this._tempVec)),this._lookAtObject.position=this._tempVec),this._keyArray[2]&&(this._tempVec.copyFrom(this._rotaEyesLine),this._tempVec.y=0,this._tempVec.normalize(),this._tempVec.scaleBy(this._speed),this._tempVec.copyFrom(this._lookAtObject.position.subtract(this._tempVec)),this._lookAtObject.position=this._tempVec),this._keyArray[3]&&(this._tempVec.copyFrom(this._rotaEyesLine),this._matTemp.identity(),this._matTemp.appendRotation(90,t.Vector3D.Y_AXIS),this._tempVec.copyFrom(this._matTemp.transformVector(this._tempVec)),this._tempVec.y=0,this._tempVec.normalize(),this._tempVec.scaleBy(this._speed),this._tempVec.copyFrom(this._lookAtObject.position.add(this._tempVec)),this._lookAtObject.position=this._tempVec),this._keyArray[4]&&(this._quaRot.fromEulerAngles(this._rotaAngle.x,this._rotaAngle.y,0),this._tempVec.copyFrom(this._quaRot.transformVector(t.Vector3D.Y_AXIS)),this._tempVec.normalize(),this._tempVec.scaleBy(this._speed),this._tempVec.copyFrom(this._lookAtObject.position.add(this._tempVec)),this._lookAtObject.position=this._tempVec),this._keyArray[5]&&(this._quaRot.fromEulerAngles(this._rotaAngle.x,this._rotaAngle.y,0),this._tempVec.copyFrom(this._quaRot.transformVector(t.Vector3D.Y_AXIS)),this._tempVec.normalize(),this._tempVec.scaleBy(this._speed),this._tempVec.copyFrom(this._lookAtObject.position.subtract(this._tempVec)),this._lookAtObject.position=this._tempVec),this._lookAtPosition.copyFrom(this._lookAtObject.position),this._tempVec.copyFrom(this._rotaEyesLine),this._tempVec.scaleBy(this._eyesLength),this._eyesPos.copyFrom(this._lookAtPosition.subtract(this._tempVec)),this._lookAtObject&&this._lookAtPosition.copyFrom(this._lookAtObject.position.add(this.lookAtOffset)),this._quaRot.fromEulerAngles(this._rotaAngle.x,this._rotaAngle.y,this._rotaAngle.z),this._tempVec.copyFrom(this._up),this._tempVec.copyFrom(this._quaRot.transformVector(this._tempVec)),this._tempVec.normalize(),this.firstCamera&&(this._lookAtObject.rotationY=this._rotaAngle.y,this._lookAtObject.rotationX=this._rotaAngle.x),this._target.lookAt(this._eyesPos,this._lookAtPosition,this._tempVec)}},i}(t.ControllerBase);t.LookAtController=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r,a,n,o,s,h,l,u,c,d,p){void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=0),void 0===n&&(n=90),void 0===o&&(o=100),void 0===s&&(s=-90),void 0===h&&(h=90),void 0===l&&(l=0/0),void 0===u&&(u=0/0),void 0===c&&(c=8),void 0===d&&(d=2),void 0===p&&(p=!1),e.call(this,i,r),this._currentPanAngle=0,this._currentTiltAngle=90,this._panAngle=0,this._tiltAngle=90,this._distance=1e3,this._minPanAngle=-(1/0),this._maxPanAngle=1/0,this._minTiltAngle=-90,this._maxTiltAngle=90,this._maxDistance=5e3,this._minDistance=-5e3,this._steps=8,this._yFactor=2,this._wrapPanAngle=!1,this._lookAtPosition=new t.Vector3D(0,0,0),this._mouseDown=!1,this._mouseRightDown=!1,this._keyArray=new Array,this.distance=o,this.panAngle=a,this.tiltAngle=n,this.minPanAngle=l||-(1/0),this.maxPanAngle=u||1/0,this.minTiltAngle=s,this.maxTiltAngle=h,this.steps=c,this.yFactor=d,this.wrapPanAngle=p,this._currentPanAngle=this._panAngle,this._currentTiltAngle=this._tiltAngle,t.Input.addEventListener(t.MouseEvent3D.MOUSE_MOVE,this.mouseMove,this),t.Input.addEventListener(t.MouseEvent3D.MOUSE_WHEEL,this.mouseWheel,this),t.Input.addEventListener(t.MouseEvent3D.MOUSE_UP,this.mouseUp,this),t.Input.addEventListener(t.MouseEvent3D.MOUSE_DOWN,this.mouseDown,this),t.Input.addEventListener(t.KeyEvent3D.KEY_UP,this.keyUp,this),t.Input.addEventListener(t.KeyEvent3D.KEY_DOWN,this.keyDown,this),t.Input.addEventListener(t.TouchEvent3D.TOUCH_END,this.touchUp,this),t.Input.addEventListener(t.TouchEvent3D.TOUCH_START,this.touchDown,this),t.Input.addEventListener(t.TouchEvent3D.TOUCH_MOVE,this.touchMove,this)}return __extends(i,e),i.prototype.mouseMove=function(){this._mouseDown&&(this._tiltAngle+=.1*t.Input.mouseOffsetY,this._tiltAngle=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,this._tiltAngle)),this._panAngle+=.1*t.Input.mouseOffsetX,this._panAngle=Math.max(this._minPanAngle,Math.min(this._maxPanAngle,this._panAngle)))},i.prototype.mouseWheel=function(){var e=this._target;if(e){var i=.1*t.Input.wheelDelta,r=e.viewPort;switch(e.cameraType){case t.CameraType.orthogonal:var a=r.width-i,n=r.height-i;e.updateViewport(0,0,a,n);break;case t.CameraType.orthogonalToCenter:var o=r.x-i,s=r.y-i,a=r.width-i,n=r.height-i;e.updateViewport(o,s,a,n);break;case t.CameraType.perspective:this._distance-=i,this._distance=Math.max(this._minDistance,Math.min(this._maxDistance,this._distance))}}},i.prototype.mouseUp=function(e){switch(e.mouseCode){case t.MouseCode.Mouse_Left:this._mouseDown=!1;break;case t.MouseCode.Mouse_Right:this._mouseRightDown=!1}},i.prototype.mouseDown=function(e){switch(e.mouseCode){case t.MouseCode.Mouse_Left:this._mouseDown=!0;break;case t.MouseCode.Mouse_Right:this._mouseRightDown=!0}},i.prototype.touchMove=function(t){1==t.targetTouches.length?this.mouseMove(null):this.mouseWheel(null)},i.prototype.touchUp=function(){this._mouseDown=!1},i.prototype.touchDown=function(){this._mouseDown=!0},i.prototype.keyDown=function(e){switch(e.keyCode){case t.KeyCode.Key_W:this._keyArray[0]=!0;break;case t.KeyCode.Key_A:this._keyArray[1]=!0;break;case t.KeyCode.Key_S:this._keyArray[2]=!0;break;case t.KeyCode.Key_D:this._keyArray[3]=!0}},i.prototype.keyUp=function(e){switch(e.keyCode){case t.KeyCode.Key_W:this._keyArray[0]=!1;break;case t.KeyCode.Key_A:this._keyArray[1]=!1;break;case t.KeyCode.Key_S:this._keyArray[2]=!1;break;case t.KeyCode.Key_D:this._keyArray[3]=!1}},Object.defineProperty(i.prototype,"lookAtPosition",{get:function(){return this._lookAtPosition},set:function(t){this._lookAtPosition=t,this.notifyUpdate()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"steps",{get:function(){return this._steps},set:function(t){t=1>t?1:t,this._steps!=t&&(this._steps=t,this.notifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"panAngle",{get:function(){return this._panAngle},set:function(t){t=Math.max(this._minPanAngle,Math.min(this._maxPanAngle,t)),this._panAngle!=t&&(this._panAngle=t,this.notifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tiltAngle",{get:function(){return this._tiltAngle},set:function(t){t=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,t)),this._tiltAngle!=t&&(this._tiltAngle=t,this.notifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"distance",{get:function(){return this._distance},set:function(t){this._distance!=t&&(this._distance=this._distance=Math.max(this._minDistance,Math.min(this._maxDistance,t)),this.notifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"minPanAngle",{get:function(){return this._minPanAngle},set:function(t){this._minPanAngle!=t&&(this._minPanAngle=t,this.panAngle=Math.max(this._minPanAngle,Math.min(this._maxPanAngle,this._panAngle)))
},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maxPanAngle",{get:function(){return this._maxPanAngle},set:function(t){this._maxPanAngle!=t&&(this._maxPanAngle=t,this.panAngle=Math.max(this._minPanAngle,Math.min(this._maxPanAngle,this._panAngle)))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"minTiltAngle",{get:function(){return this._minTiltAngle},set:function(t){this._minTiltAngle!=t&&(this._minTiltAngle=t,this.tiltAngle=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,this._tiltAngle)))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maxTiltAngle",{get:function(){return this._maxTiltAngle},set:function(t){this._maxTiltAngle!=t&&(this._maxTiltAngle=t,this.tiltAngle=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,this._tiltAngle)))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maxDistance",{get:function(){return this._maxDistance},set:function(t){this._maxDistance!=t&&(this._maxDistance=t,this._distance=Math.max(this._minDistance,Math.min(this._maxDistance,this._distance)))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"minDistance",{get:function(){return this._maxDistance},set:function(t){this._minDistance!=t&&(this._minDistance=t,this._distance=Math.max(this._minDistance,Math.min(this._maxDistance,this._distance)))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"yFactor",{get:function(){return this._yFactor},set:function(t){this._yFactor!=t&&(this._yFactor=t,this.notifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"wrapPanAngle",{get:function(){return this._wrapPanAngle},set:function(t){this._wrapPanAngle!=t&&(this._wrapPanAngle=t,this.notifyUpdate())},enumerable:!0,configurable:!0}),i.prototype.update=function(e){void 0===e&&(e=!0),(this._tiltAngle!=this._currentTiltAngle||this._panAngle!=this._currentPanAngle)&&(this.notifyUpdate(),this._wrapPanAngle&&(this._panAngle=this._panAngle<0?this._panAngle%360+360:this._panAngle%360,this._panAngle-this._currentPanAngle<-180?this._currentPanAngle-=360:this._panAngle-this._currentPanAngle>180&&(this._currentPanAngle+=360)),e?(this._currentTiltAngle+=(this._tiltAngle-this._currentTiltAngle)/(this.steps+1),this._currentPanAngle+=(this._panAngle-this._currentPanAngle)/(this.steps+1)):(this._currentPanAngle=this._panAngle,this._currentTiltAngle=this._tiltAngle),Math.abs(this._tiltAngle-this._currentTiltAngle)<.01&&Math.abs(this._panAngle-this._currentPanAngle)<.01&&(this._currentTiltAngle=this._tiltAngle,this._currentPanAngle=this._panAngle));var i=this._lookAtObject?this._lookAtObject.position:this._lookAtPosition?this._lookAtPosition:this._origin,r=new t.Vector3D;r.x=i.x+this.distance*Math.sin(this._currentPanAngle*t.MathUtil.DEGREES_TO_RADIANS)*Math.cos(this._currentTiltAngle*t.MathUtil.DEGREES_TO_RADIANS),r.z=i.z+this.distance*Math.cos(this._currentPanAngle*t.MathUtil.DEGREES_TO_RADIANS)*Math.cos(this._currentTiltAngle*t.MathUtil.DEGREES_TO_RADIANS),r.y=i.y+this.distance*Math.sin(this._currentTiltAngle*t.MathUtil.DEGREES_TO_RADIANS)*this.yFactor,this._target&&this._lookAtPosition&&this._target.lookAt(r,this._lookAtPosition)},i}(t.ControllerBase);t.HoverController=e}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t.PixelArray=0]="PixelArray",t[t.CompressData=1]="CompressData",t[t.ImageData=2]="ImageData"}(t.InternalFormat||(t.InternalFormat={})),t.InternalFormat,!function(t){t[t.shadowFrameBufrfer=0]="shadowFrameBufrfer",t[t.defaultFrameBuffer=1]="defaultFrameBuffer",t[t.positionFrameBuffer=2]="positionFrameBuffer",t[t.normalFrameBuffer=3]="normalFrameBuffer",t[t.specularFrameBuffer=4]="specularFrameBuffer",t[t.leftEyeFrameBuffer=5]="leftEyeFrameBuffer",t[t.rightEyeFrameBuffer=6]="rightEyeFrameBuffer",t[t.nextFrameBuffer=7]="nextFrameBuffer"}(t.FrameBufferType||(t.FrameBufferType={})),t.FrameBufferType,!function(t){t[t.FLOAT_RGB=0]="FLOAT_RGB",t[t.FLOAT_RGBA=1]="FLOAT_RGBA",t[t.UNSIGNED_BYTE_RGB=2]="UNSIGNED_BYTE_RGB",t[t.UNSIGNED_BYTE_RGBA=3]="UNSIGNED_BYTE_RGBA"}(t.FrameBufferFormat||(t.FrameBufferFormat={})),t.FrameBufferFormat,!function(t){t[t.ALPHA=0]="ALPHA",t[t.LAYER=1]="LAYER",t[t.NORMAL=2]="NORMAL",t[t.MULTIPLY=3]="MULTIPLY",t[t.ADD=4]="ADD",t[t.SUB=5]="SUB",t[t.DIV=6]="DIV",t[t.SCREEN=7]="SCREEN",t[t.SOFT_ADD=8]="SOFT_ADD"}(t.BlendMode||(t.BlendMode={}));var e=(t.BlendMode,function(){function t(){}return t}());t.ContextSamplerType=e;var i=function(){function t(){}return t}();t.DrawMode=i;var r=function(){function t(){}return t.Direct3D_Opengl_Auto="Direct3D_Opengl_Auto",t.Direct3D_9_0="Direct3D_9_0",t.Direct3D_10_0="Direct3D_10_0",t.Direct3D_11_0="Direct3D_11_0",t.OpenGLES_2_0="OpenGLES_2_0",t.OpenGLES_3_0="OpenGLES_3_0",t.OpenGL="OpenGL",t.ColorFormat_DXT1_RGB=0,t.ColorFormat_DXT1_RGBA=0,t.ColorFormat_DXT3_RGBA=0,t.ColorFormat_DXT5_RGBA=0,t}();t.ContextConfig=r}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.isLost=!1,this.DEPTH_TEST=!1,this.CULL_FACE=!1,this.BLEND=!1,this.blend_Factors_src=-1,this.blend_Factors_dst=-1,this.cullingMode=-1,this.depthCompareMode=-1,this.cacheVertexPoint=[],this.cacheVertexFormat=0}return e.prototype.register=function(){var i;e.gl.getExtension("WEBGL_depth_texture")||e.gl.getExtension("MOZ_WEBGL_depth_texture")||e.gl.getExtension("WEBKIT_WEBGL_depth_texture"),e.gl.getExtension("EXT_texture_filter_anisotropic")||e.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),e.gl.getExtension("WEBGL_compressed_texture_pvrtc")||e.gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),e.gl.getExtension("WEBGL_compressed_texture_etc1"),e.gl.getExtension("OES_element_index_uint"),e.gl.getExtension("OES_texture_float_linear"),e.gl.getExtension("OES_texture_float"),e.gl.getExtension("OES_texture_half_float"),e.gl.getExtension("OES_texture_half_float_linear"),e.gl.getExtension("OES_standard_derivatives"),e.gl.getExtension("GL_OES_standard_derivatives"),e.gl.getExtension("WEBGL_draw_buffers"),e.gl.getExtension("WEBGL_depth_texture"),e.gl.getExtension("WEBGL_lose_context"),i=e.gl.getExtension("WEBGL_compressed_texture_s3tc")||e.gl.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),i&&(t.ContextConfig.ColorFormat_DXT1_RGB=i.COMPRESSED_RGB_S3TC_DXT1_EXT,t.ContextConfig.ColorFormat_DXT1_RGBA=i.COMPRESSED_RGBA_S3TC_DXT1_EXT,t.ContextConfig.ColorFormat_DXT3_RGBA=i.COMPRESSED_RGBA_S3TC_DXT3_EXT,t.ContextConfig.ColorFormat_DXT5_RGBA=i.COMPRESSED_RGBA_S3TC_DXT5_EXT),t.ContextConfig.BLEND=e.gl.BLEND,t.DrawMode.TRIANGLES=e.gl.TRIANGLES,t.DrawMode.POINTS=e.gl.POINTS,t.DrawMode.LINES=e.gl.LINES,t.DrawMode.LINE_STRIP=e.gl.LINE_STRIP,t.ContextConfig.FLOAT=e.gl.FLOAT,t.ContextConfig.VERTEX_SHADER=e.gl.VERTEX_SHADER,t.ContextConfig.FRAGMENT_SHADER=e.gl.FRAGMENT_SHADER,t.ContextConfig.FRONT=e.gl.FRONT,t.ContextConfig.BACK=e.gl.BACK,t.ContextConfig.FRONT_AND_BACK=e.gl.FRONT_AND_BACK,t.ContextConfig.DEPTH_BUFFER_BIT=e.gl.DEPTH_BUFFER_BIT,t.ContextConfig.ELEMENT_ARRAY_BUFFER=e.gl.ELEMENT_ARRAY_BUFFER,t.ContextConfig.UNSIGNED_SHORT=e.gl.UNSIGNED_SHORT,t.ContextConfig.NEAREST=e.gl.NEAREST,t.ContextConfig.REPEAT=e.gl.REPEAT,t.ContextConfig.ONE=e.gl.ONE,t.ContextConfig.ZERO=e.gl.ZERO,t.ContextConfig.SRC_ALPHA=e.gl.SRC_ALPHA,t.ContextConfig.ONE_MINUS_SRC_ALPHA=e.gl.ONE_MINUS_SRC_ALPHA,t.ContextConfig.SRC_COLOR=e.gl.SRC_COLOR,t.ContextConfig.ONE_MINUS_SRC_COLOR=e.gl.ONE_MINUS_SRC_COLOR,t.ContextConfig.ColorFormat_RGB565=e.gl.RGB565,t.ContextConfig.ColorFormat_RGBA5551=e.gl.RGB5_A1,t.ContextConfig.ColorFormat_RGBA4444=e.gl.RGBA4,t.ContextConfig.ColorFormat_RGBA8888=e.gl.RGBA,t.ContextConfig.DEPTH_TEST=e.gl.DEPTH_TEST,t.ContextConfig.CULL_FACE=e.gl.CULL_FACE,t.ContextConfig.BLEND=e.gl.BLEND,t.ContextConfig.LEQUAL=e.gl.LEQUAL,t.ContextSamplerType.TEXTURE_0=e.gl.TEXTURE0,t.ContextSamplerType.TEXTURE_1=e.gl.TEXTURE1,t.ContextSamplerType.TEXTURE_2=e.gl.TEXTURE2,t.ContextSamplerType.TEXTURE_3=e.gl.TEXTURE3,t.ContextSamplerType.TEXTURE_4=e.gl.TEXTURE4,t.ContextSamplerType.TEXTURE_5=e.gl.TEXTURE5,t.ContextSamplerType.TEXTURE_6=e.gl.TEXTURE6,t.ContextSamplerType.TEXTURE_7=e.gl.TEXTURE7,t.ContextSamplerType.TEXTURE_8=e.gl.TEXTURE8,console.log("requst GPU Config",e.gl),t.ShaderPool.register(this)},e.prototype.viewPort=function(i,r,a,n){e.gl.viewport(i,t.ContextConfig.canvasRectangle.height-n-r,a,n)},e.prototype.creatProgram=function(i,r){var a=e.gl.createProgram();e.gl.attachShader(a,i.shader),e.gl.attachShader(a,r.shader),e.gl.linkProgram(a);var n=e.gl.getProgramParameter(a,e.gl.LINK_STATUS);n||(alert("vsShader error"+e.gl.getShaderInfoLog(i.shader)),alert("fsShader error"+e.gl.getShaderInfoLog(r.shader)));var o=new t.Program3D(a);return o},e.prototype.creatIndexBuffer=function(i){var r=e.gl.createBuffer();e.gl.bindBuffer(e.gl.ELEMENT_ARRAY_BUFFER,r),e.gl.bufferData(e.gl.ELEMENT_ARRAY_BUFFER,i,e.gl.STATIC_DRAW);var a=new t.IndexBuffer3D(r);return a.arrayBuffer=i,a},e.prototype.uploadIndexBuffer=function(t){e.gl.bindBuffer(e.gl.ELEMENT_ARRAY_BUFFER,t.buffer),e.gl.bufferData(e.gl.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,e.gl.DYNAMIC_DRAW)},e.prototype.creatVertexBuffer=function(i,r){void 0===r&&(r=e.gl.STATIC_DRAW);var a=e.gl.createBuffer();e.gl.bindBuffer(e.gl.ARRAY_BUFFER,a),e.gl.bufferData(e.gl.ARRAY_BUFFER,i,r);var n=new t.VertexBuffer3D(a);return n.arrayBuffer=i,n},e.prototype.uploadVertexBuffer=function(t){e.gl.bindBuffer(e.gl.ARRAY_BUFFER,t.buffer),e.gl.bufferData(e.gl.ARRAY_BUFFER,t.arrayBuffer,e.gl.DYNAMIC_DRAW)},e.prototype.texParameteri=function(t,i,r){e.gl.texParameteri(t,i,r)},e.prototype.upLoadTextureData=function(i,r){e.gl.bindTexture(e.gl.TEXTURE_2D,r.texture2D.textureBuffer),r.texture2D.internalFormat==t.InternalFormat.ImageData?e.gl.texImage2D(e.gl.TEXTURE_2D,0,e.gl.RGBA,e.gl.RGBA,r.texture2D.dataFormat,r.texture2D.imageData):r.texture2D.internalFormat==t.InternalFormat.CompressData?this.upLoadCompressedTexture2D(i,r.texture2D):r.texture2D.internalFormat==t.InternalFormat.PixelArray&&e.gl.texImage2D(e.gl.TEXTURE_2D,i,r.texture2D.colorFormat,r.texture2D.mimapData[i].width,r.texture2D.mimapData[i].height,r.texture2D.border,r.texture2D.colorFormat,r.texture2D.dataFormat,r.texture2D.mimapData[i].data),r.useMipmap&&e.gl.generateMipmap(e.gl.TEXTURE_2D)},e.prototype.upLoadCompressedTexture2D=function(t,i){e.gl.compressedTexImage2D(e.gl.TEXTURE_2D,t,i.colorFormat,i.mimapData[t].width,i.mimapData[t].height,i.border,i.mimapData[t].data)},e.prototype.creatTexture=function(){return e.gl.createTexture()},e.prototype.uploadCubetexture=function(t){e.gl.bindTexture(e.gl.TEXTURE_CUBE_MAP,t.texture),t.image_right.mimapData&&t.image_right.mimapData.length>0?e.gl.texImage2D(e.gl.TEXTURE_CUBE_MAP_POSITIVE_X,0,e.gl.RGB,t.image_right.mimapData[0].width,t.image_right.mimapData[0].height,0,e.gl.RGB,e.gl.UNSIGNED_BYTE,t.image_right.mimapData[0].data):e.gl.texImage2D(e.gl.TEXTURE_CUBE_MAP_POSITIVE_X,0,e.gl.RGB,e.gl.RGB,e.gl.UNSIGNED_BYTE,t.image_right.imageData),t.image_left.mimapData&&t.image_left.mimapData.length>0?e.gl.texImage2D(e.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,0,e.gl.RGB,t.image_right.mimapData[0].width,t.image_right.mimapData[0].height,0,e.gl.RGB,e.gl.UNSIGNED_BYTE,t.image_right.mimapData[0].data):e.gl.texImage2D(e.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,0,e.gl.RGB,e.gl.RGB,e.gl.UNSIGNED_BYTE,t.image_left.imageData),t.image_left.mimapData&&t.image_left.mimapData.length>0?e.gl.texImage2D(e.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,0,e.gl.RGB,t.image_up.mimapData[0].width,t.image_up.mimapData[0].height,0,e.gl.RGB,e.gl.UNSIGNED_BYTE,t.image_up.mimapData[0].data):e.gl.texImage2D(e.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,0,e.gl.RGB,e.gl.RGB,e.gl.UNSIGNED_BYTE,t.image_up.imageData),t.image_left.mimapData&&t.image_left.mimapData.length>0?e.gl.texImage2D(e.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,e.gl.RGB,t.image_down.mimapData[0].width,t.image_down.mimapData[0].height,0,e.gl.RGB,e.gl.UNSIGNED_BYTE,t.image_down.mimapData[0].data):e.gl.texImage2D(e.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,e.gl.RGB,e.gl.RGB,e.gl.UNSIGNED_BYTE,t.image_down.imageData),t.image_left.mimapData&&t.image_left.mimapData.length>0?e.gl.texImage2D(e.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,0,e.gl.RGB,t.image_back.mimapData[0].width,t.image_back.mimapData[0].height,0,e.gl.RGB,e.gl.UNSIGNED_BYTE,t.image_back.mimapData[0].data):e.gl.texImage2D(e.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,0,e.gl.RGB,e.gl.RGB,e.gl.UNSIGNED_BYTE,t.image_back.imageData),t.image_left.mimapData&&t.image_left.mimapData.length>0?e.gl.texImage2D(e.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,e.gl.RGB,t.image_front.mimapData[0].width,t.image_front.mimapData[0].height,0,e.gl.RGB,e.gl.UNSIGNED_BYTE,t.image_front.mimapData[0].data):e.gl.texImage2D(e.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,e.gl.RGB,e.gl.RGB,e.gl.UNSIGNED_BYTE,t.image_front.imageData),e.gl.texParameteri(e.gl.TEXTURE_CUBE_MAP,e.gl.TEXTURE_MAG_FILTER,e.gl.LINEAR),e.gl.texParameteri(e.gl.TEXTURE_CUBE_MAP,e.gl.TEXTURE_MIN_FILTER,e.gl.LINEAR),e.gl.texParameteri(e.gl.TEXTURE_CUBE_MAP,e.gl.TEXTURE_WRAP_S,e.gl.CLAMP_TO_EDGE),e.gl.texParameteri(e.gl.TEXTURE_CUBE_MAP,e.gl.TEXTURE_WRAP_T,e.gl.CLAMP_TO_EDGE)},e.prototype.createFramebuffer=function(i,r,a){var n=e.gl.createFramebuffer(),o=new t.ContextTexture2D,s=e.gl.createRenderbuffer();switch(o.textureBuffer=o.textureBuffer||e.gl.createTexture(),e.gl.bindTexture(e.gl.TEXTURE_2D,o.textureBuffer),a){case t.FrameBufferFormat.UNSIGNED_BYTE_RGB:e.gl.texImage2D(e.gl.TEXTURE_2D,0,e.gl.RGB,i,r,0,e.gl.RGB,e.gl.UNSIGNED_BYTE,null);break;case t.FrameBufferFormat.UNSIGNED_BYTE_RGBA:e.gl.texImage2D(e.gl.TEXTURE_2D,0,e.gl.RGBA,i,r,0,e.gl.RGBA,e.gl.UNSIGNED_BYTE,null);break;case t.FrameBufferFormat.FLOAT_RGB:for(var h=new Float32Array(i*r*4),l=0;i*r>l;l++)h[l]=Math.random(),h[l+1]=Math.random(),h[l+2]=Math.random();e.gl.texImage2D(e.gl.TEXTURE_2D,0,e.gl.RGB,i,r,0,e.gl.RGB,e.gl.FLOAT,h);break;case t.FrameBufferFormat.FLOAT_RGBA:for(var h=new Float32Array(i*r*4),l=0;i*r>l;l++)h[l]=Math.random(),h[l+1]=Math.random(),h[l+2]=Math.random(),h[l+3]=Math.random();e.gl.texImage2D(e.gl.TEXTURE_2D,0,e.gl.RGBA,i,r,0,e.gl.RGBA,e.gl.FLOAT,h)}return e.gl.texParameteri(e.gl.TEXTURE_2D,e.gl.TEXTURE_MAG_FILTER,e.gl.NEAREST),e.gl.texParameteri(e.gl.TEXTURE_2D,e.gl.TEXTURE_MIN_FILTER,e.gl.NEAREST),e.gl.texParameteri(e.gl.TEXTURE_2D,e.gl.TEXTURE_WRAP_S,e.gl.CLAMP_TO_EDGE),e.gl.texParameteri(e.gl.TEXTURE_2D,e.gl.TEXTURE_WRAP_T,e.gl.CLAMP_TO_EDGE),e.gl.bindFramebuffer(e.gl.FRAMEBUFFER,n),e.gl.framebufferTexture2D(e.gl.FRAMEBUFFER,e.gl.COLOR_ATTACHMENT0,e.gl.TEXTURE_2D,o.textureBuffer,0),e.gl.bindRenderbuffer(e.gl.RENDERBUFFER,s),e.gl.renderbufferStorage(e.gl.RENDERBUFFER,e.gl.DEPTH_COMPONENT16,i,r),o.width=i,o.height=r,o.frameBuffer=n,o.renderbuffer=s,e.gl.bindFramebuffer(e.gl.FRAMEBUFFER,null),e.gl.bindTexture(e.gl.TEXTURE_2D,null),e.gl.bindRenderbuffer(e.gl.RENDERBUFFER,null),o},e.prototype.setRenderToTexture=function(t,i,r){void 0===i&&(i=!1),void 0===r&&(r=0),e.gl.viewport(0,0,t.width,t.height),e.gl.scissor(0,0,t.width,t.height),e.gl.bindFramebuffer(e.gl.FRAMEBUFFER,t.frameBuffer),e.gl.clearColor(0,0,0,1),e.gl.clear(e.gl.COLOR_BUFFER_BIT|e.gl.DEPTH_BUFFER_BIT),e.gl.framebufferTexture2D(e.gl.FRAMEBUFFER,e.gl.COLOR_ATTACHMENT0,e.gl.TEXTURE_2D,t.textureBuffer,0),e.gl.framebufferRenderbuffer(e.gl.FRAMEBUFFER,e.gl.DEPTH_ATTACHMENT,e.gl.RENDERBUFFER,t.renderbuffer)},e.prototype.setRenderToBackBuffer=function(){e.gl.bindTexture(e.gl.TEXTURE_2D,null),e.gl.bindFramebuffer(e.gl.FRAMEBUFFER,null),e.gl.bindRenderbuffer(e.gl.RENDERBUFFER,null)},e.prototype.creatVertexShader=function(i){var r=e.gl.createShader(e.gl.VERTEX_SHADER);e.gl.shaderSource(r,i),e.gl.compileShader(r);var a=new t.Shader(r);return a.id=(t.Shader.ID_COUNT++).toString(),a},e.prototype.creatFragmentShader=function(i){var r=e.gl.createShader(e.gl.FRAGMENT_SHADER);e.gl.shaderSource(r,i),e.gl.compileShader(r);var a=new t.Shader(r);return a.id=(t.Shader.ID_COUNT++).toString(),a},e.prototype.clear=function(t){e.gl.clear(t)},e.prototype.clearColor=function(t,i,r,a){e.gl.clearColor(t,i,r,a)},e.prototype.clearStencil=function(t){e.gl.clearStencil(t)},e.prototype.setProgram=function(t){this.programChange=!1,this.program!=t&&(this.programChange=!0,this.program=t,e.gl.useProgram(t.program))},e.prototype.getUniformLocation=function(t,i){return e.gl.getUniformLocation(t.program,i)},e.prototype.uniform1f=function(t,i){e.gl.uniform1f(t,i)},e.prototype.uniform1fv=function(t,i){e.gl.uniform1fv(t,i)},e.prototype.uniform1i=function(t,i){e.gl.uniform1i(t,i)},e.prototype.uniform1iv=function(t,i){e.gl.uniform1iv(t,i)},e.prototype.uniform2f=function(t,i,r){e.gl.uniform2f(t,i,r)},e.prototype.uniform2fv=function(t,i){e.gl.uniform2fv(t,i)},e.prototype.uniform2i=function(t,i,r){e.gl.uniform2i(t,i,r)},e.prototype.uniform2iv=function(t,i){e.gl.uniform2iv(t,i)},e.prototype.uniform3f=function(t,i,r,a){e.gl.uniform3f(t,i,r,a)},e.prototype.uniform3fv=function(t,i){e.gl.uniform3fv(t,i)},e.prototype.uniform3i=function(t,i,r,a){e.gl.uniform3i(t,i,r,a)},e.prototype.uniform3iv=function(t,i){e.gl.uniform3iv(t,i)},e.prototype.uniform4f=function(t,i,r,a,n){e.gl.uniform4f(t,i,r,a,n)},e.prototype.uniform4fv=function(t,i){e.gl.uniform4fv(t,i)},e.prototype.uniform4i=function(t,i,r,a,n){e.gl.uniform4i(t,i,r,a,n)},e.prototype.uniform4iv=function(t,i){e.gl.uniform4iv(t,i)},e.prototype.uniformMatrix2fv=function(t,i,r){e.gl.uniformMatrix2fv(t,i,r)},e.prototype.uniformMatrix3fv=function(t,i,r){e.gl.uniformMatrix3fv(t,i,r)},e.prototype.uniformMatrix4fv=function(t,i,r){e.gl.uniformMatrix4fv(t,i,r)},e.prototype.setBlendFactors=function(t,i){(this.blend_Factors_src!=t||this.blend_Factors_dst!=i)&&(this.blend_Factors_src=t,this.blend_Factors_dst=i,e.gl.blendFunc(t,i))},e.prototype.setCulling=function(t){this.cullingMode!=t&&(this.cullingMode=t,e.gl.cullFace(t))},e.prototype.enableDepth=function(){this.DEPTH_TEST||(this.DEPTH_TEST=!0,e.gl.enable(t.ContextConfig.DEPTH_TEST))},e.prototype.disableDepth=function(){this.DEPTH_TEST&&(this.DEPTH_TEST=!1,e.gl.disable(t.ContextConfig.DEPTH_TEST))},e.prototype.enableCullFace=function(){this.CULL_FACE||(this.CULL_FACE=!0,e.gl.enable(t.ContextConfig.CULL_FACE))},e.prototype.disableCullFace=function(){this.CULL_FACE&&(this.CULL_FACE=!1,e.gl.disable(t.ContextConfig.CULL_FACE))},e.prototype.enableBlend=function(){e.gl.enable(t.ContextConfig.BLEND)},e.prototype.disableBlend=function(){e.gl.disable(t.ContextConfig.BLEND)},e.prototype.depthFunc=function(t){void 0===t&&(t=0),this.depthCompareMode!=t&&(this.depthCompareMode=t,e.gl.depthFunc(t))},e.prototype.enableDepthTest=function(t,i){void 0===i&&(i=0),t&&e.gl.enable(e.gl.DEPTH_TEST)},e.prototype.getShaderAttribLocation=function(t,i){return e.gl.getAttribLocation(t.program,i)},e.prototype.vertexAttribPointer=function(t,i,r,a,n,o){e.gl.vertexAttribPointer(t,i,r,a,n,o),e.gl.enableVertexAttribArray(t)},e.prototype.activeAttribPointer=function(t){for(var i=0;8>i;i++)e.gl.disableVertexAttribArray(i);return this.cacheVertexFormat=t,this.cacheVertexFormat==t},e.prototype.setVertexShaderConstData=function(t,i,r){e.gl.vertexAttrib4fv(i,t.subarray(i,r))},e.prototype.setFragmentShaderConstData=function(){},e.prototype.setTexture2DAt=function(t,i,r,a){e.gl.activeTexture(t),e.gl.bindTexture(e.gl.TEXTURE_2D,a.textureBuffer),e.gl.uniform1i(i,r)},e.prototype.disableTexture2DAt=function(){},e.prototype.setCubeTextureAt=function(t,i,r,a){a&&(e.gl.activeTexture(t),e.gl.bindTexture(e.gl.TEXTURE_CUBE_MAP,a.texture),e.gl.uniform1i(i,r))},e.prototype.setScissorRectangle=function(i,r,a,n){e.gl.scissor(i,t.ContextConfig.canvasRectangle.height-n-r,a,n)},e.prototype.setStencilReferenceValue=function(){},e.prototype.setStencilActions=function(){},e.prototype.bindVertexBuffer=function(t){e.gl.bindBuffer(e.gl.ARRAY_BUFFER,t.buffer)},e.prototype.bindIndexBuffer=function(t){e.gl.bindBuffer(e.gl.ELEMENT_ARRAY_BUFFER,t.buffer)},e.prototype.drawArrays=function(t,i,r){e.gl.drawArrays(t,i,r)},e.prototype.drawElement=function(t,i,r){e.gl.drawElements(t,r,e.gl.UNSIGNED_SHORT,i)},e.prototype.flush=function(){e.gl.flush()},e}();t.Context3DProxy=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){}return t}();t.FrameBuffer=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(t){this.buffer=t}return e.prototype.dispose=function(){this.buffer&&(t.Context3DProxy.gl.deleteBuffer(this.buffer),this.buffer=null),this.arrayBuffer&&(this.arrayBuffer.length=0)},e}();t.IndexBuffer3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(t){this.buffer=t}return e.prototype.dispose=function(){this.buffer&&(t.Context3DProxy.gl.deleteBuffer(this.buffer),this.buffer=null),this.arrayBuffer&&(this.arrayBuffer.length=0)},e}();t.VertexBuffer3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(t,e,i){this.data=t,this.width=e,this.height=i}return t}();t.MipmapData=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(t){this.program=t}return t}();t.Program3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(t){this._shader=t}return Object.defineProperty(t.prototype,"shader",{get:function(){return this._shader},enumerable:!0,configurable:!0}),t.vertex=0,t.fragment=1,t.ID_COUNT=0,t}();t.Shader=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.border=0,this.imageData=null}return e.prototype.dispose=function(){this.textureBuffer&&(t.Context3DProxy.gl.deleteTexture(this.textureBuffer),this.textureBuffer=null),this.frameBuffer&&(t.Context3DProxy.gl.deleteFramebuffer(this.frameBuffer),this.frameBuffer=null),this.renderbuffer&&(t.Context3DProxy.gl.deleteRenderbuffer(this.renderbuffer),this.renderbuffer=null)},e}();t.ContextTexture2D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.border=0,this.useMipmap=!0,this.colorformat=t.ContextConfig.ColorFormat_RGBA8888,this.internalformat=t.InternalFormat.PixelArray,this.mimapData=new Array}return e.prototype.dispose=function(){this.texture&&(t.Context3DProxy.gl.deleteTexture(this.texture),this.texture=null),this.image_front&&(this.image_front.dispose(),this.image_front=null),this.image_back&&(this.image_back.dispose(),this.image_back=null),this.image_left&&(this.image_left.dispose(),this.image_left=null),this.image_right&&(this.image_right.dispose(),this.image_right=null),this.image_up&&(this.image_up.dispose(),this.image_up=null),this.image_down&&(this.image_down.dispose(),this.image_down=null)},e}();t.ContextTexture3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t.BoundPick=0]="BoundPick",t[t.PositionPick=1]="PositionPick",t[t.UVPick=2]="UVPick"}(t.PickType||(t.PickType={}));var e=t.PickType,i=function(i){function r(){i.call(this),this._modelMatrix3D=new t.Matrix4_4,this._transformChange=!0,this._pos=new t.Vector3D,this._rot=new t.Vector3D,this._sca=new t.Vector3D(1,1,1),this._orientation=new t.Quaternion,this._axis=new t.Vector3D,this._angle=0,this._globalPos=new t.Vector3D,this._globalRot=new t.Vector3D,this._globalSca=new t.Vector3D(1,1,1),this._globalOrientation=new t.Quaternion,this._qut=new t.Quaternion,this._vec=new t.Vector3D,this._active=!1,this._isRoot=!0,this.canPick=!1,this.renderLayer=0,this.name="",this.id=0,this.layer=0,this.tag=new t.Tag,this.parent=null,this.childs=new Array,this.isController=!0,this.visible=!0,this.pickType=e.BoundPick,this.pickResult=new t.PickResult,this.enablePick=!1,this.mouseChildren=!1,this.enableCulling=!0,this.id=++r.s_id}return __extends(r,i),Object.defineProperty(r.prototype,"bound",{get:function(){return this._bound},set:function(t){this._bound=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"currentBound",{get:function(){return this.mouseChildren?this.bound.childBound:this.bound},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"position",{get:function(){return this._pos},set:function(t){(this._pos.x!=t.x||this._pos.y!=t.y||this._pos.z!=t.z)&&(this.updateTransformChange(!0),this._pos.copyFrom(t))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rotation",{get:function(){return this._rot},set:function(t){(this._rot.x!=t.x||this._rot.y!=t.y||this._rot.z!=t.z)&&(this._rot.x=t.x,this._rot.y=t.y,this._rot.z=t.z,this._orientation.fromEulerAngles(this._rot.x,this._rot.y,this._rot.z),this._angle=this._orientation.toAxisAngle(this._axis),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"orientation",{get:function(){return this._orientation},set:function(t){(this._orientation.x!=t.x||this._orientation.y!=t.y||this._orientation.z!=t.z||this._orientation.w!=t.w)&&(this._orientation.copyFrom(t),this._orientation.toEulerAngles(this._rot),this._angle=this._orientation.toAxisAngle(this._axis),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"orientationX",{set:function(t){this._orientation.x!=t&&(this._orientation.x=t,this._orientation.toEulerAngles(this._rot),this._angle=this._orientation.toAxisAngle(this._axis),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"orientationY",{set:function(t){this._orientation.y!=t&&(this._orientation.y=t,this._orientation.toEulerAngles(this._rot),this._angle=this._orientation.toAxisAngle(this._axis),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"orientationZ",{set:function(t){this._orientation.z!=t&&(this._orientation.z=t,this._orientation.toEulerAngles(this._rot),this._angle=this._orientation.toAxisAngle(this._axis),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"orientationW",{set:function(t){this._orientation.w!=t&&(this._orientation.w=t,this._orientation.toEulerAngles(this._rot),this._angle=this._orientation.toAxisAngle(this._axis),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scale",{get:function(){return this._sca},set:function(t){(this._sca.x!=t.x||this._sca.y!=t.y||this._sca.z!=t.z)&&(this.updateTransformChange(!0),this._sca=t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"x",{get:function(){return this._pos.x},set:function(t){this._pos.x!=t&&(this._pos.x=t,this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._pos.y},set:function(t){this._pos.y!=t&&(this._pos.y=t,this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"z",{get:function(){return this._pos.z},set:function(t){this._pos.z!=t&&(this._pos.z=t,this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rotationX",{get:function(){return this._rot.x},set:function(t){this._rot.x!=t&&(this._rot.x=t,this._orientation.fromEulerAngles(this._rot.x,this._rot.y,this._rot.z),this._angle=this._orientation.toAxisAngle(this._axis),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rotationY",{get:function(){return this._rot.y},set:function(t){this._rot.y!=t&&(this._rot.y=t,this._orientation.fromEulerAngles(this._rot.x,this._rot.y,this._rot.z),this._angle=this._orientation.toAxisAngle(this._axis),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rotationZ",{get:function(){return this._rot.z},set:function(t){this._rot.z!=t&&(this._rot.z=t,this._orientation.fromEulerAngles(this._rot.x,this._rot.y,this._rot.z),this._angle=this._orientation.toAxisAngle(this._axis),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleX",{get:function(){return this._sca.x},set:function(t){this._sca.x!=t&&(this._sca.x=t,this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleY",{get:function(){return this._sca.y},set:function(t){this._sca.y!=t&&(this._sca.y=t,this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleZ",{get:function(){return this._sca.z},set:function(t){this._sca.z!=t&&(this._sca.z=t,this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),r.prototype.setRotationFromAxisAngle=function(t,e){t.normalize(),this.updateTransformChange(!0),this._orientation.fromAxisAngle(t,e),this._orientation.toEulerAngles(this._rot),this._axis.copyFrom(t),this._angle=e},Object.defineProperty(r.prototype,"modelMatrix",{get:function(){return this._transformChange&&this.updateModelMatrix(),this._modelMatrix3D},set:function(e){var i=e.decompose(t.Orientation3D.QUATERNION);this.globalPosition=i[0],t.MathUtil.CALCULATION_QUATERNION.x=i[1].x,t.MathUtil.CALCULATION_QUATERNION.y=i[1].y,t.MathUtil.CALCULATION_QUATERNION.z=i[1].z,t.MathUtil.CALCULATION_QUATERNION.w=i[1].w,this.globalOrientation=t.MathUtil.CALCULATION_QUATERNION,this.globalScale=i[2]},enumerable:!0,configurable:!0}),r.prototype.updateModelMatrix=function(){if(null!=this.parent){var t=this.parent.globalOrientation;this._globalOrientation.multiply(t,this._orientation),this._globalOrientation.toEulerAngles(this._globalRot);var e=this.parent.globalScale;this._globalSca.copyFrom(e.multiply(this._sca)),t.transformVector(e.multiply(this._pos),this._globalPos),this._globalPos.copyFrom(this._globalPos.add(this.parent.globalPosition))}else this._globalOrientation.copyFrom(this._orientation),this._globalPos.copyFrom(this._pos),this._globalSca.copyFrom(this._sca),this._globalRot.copyFrom(this._rot);this.onMakeTransform(),this._transformChange=!1,this.onUpdateTransform()},r.prototype.onUpdateTransform=function(){},r.prototype.onMakeTransform=function(){this._modelMatrix3D.makeTransform(this._globalPos,this._globalSca,this._globalOrientation)},Object.defineProperty(r.prototype,"globalX",{get:function(){return this.globalPosition.x},set:function(t){this._vec.copyFrom(this.globalPosition),this._vec.x=t,this.globalPosition=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"globalY",{get:function(){return this.globalPosition.y},set:function(t){this._vec.copyFrom(this.globalPosition),this._vec.y=t,this.globalPosition=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"globalZ",{get:function(){return this.globalPosition.z},set:function(t){this._vec.copyFrom(this.globalPosition),this._vec.z=t,this.globalPosition=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"globalPosition",{get:function(){return this._transformChange&&this.modelMatrix,this._globalPos},set:function(t){this.parent?(this.parent.globalOrientation.inverse(this._qut),t.subtract(this.parent.globalPosition,this._vec),this._qut.transformVector(this._vec,this._vec),this._vec.divided(this.parent.globalScale,this._vec),this.position=this._vec):this.position=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"globalRotationX",{get:function(){return this.globalRotation.x},set:function(t){this._vec.copyFrom(this.globalRotation),this._vec.x=t,this.globalRotation=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"globalRotationY",{get:function(){return this.globalRotation.y},set:function(t){this._vec.copyFrom(this.globalRotation),this._vec.y=t,this.globalRotation=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"globalRotationZ",{get:function(){return this.globalRotation.z},set:function(t){this._vec.copyFrom(this.globalRotation),this._vec.z=t,this.globalRotation=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"globalRotation",{get:function(){return this._transformChange&&this.modelMatrix,this._globalRot},set:function(t){this._qut.fromEulerAngles(t.x,t.y,t.z),this.globalOrientation=this._qut},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"globalScale",{get:function(){return this._transformChange&&this.modelMatrix,this._globalSca},set:function(t){this.parent?(t.divided(this.parent.globalScale,this._vec),this.scale=this._vec):this.scale=t
},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"globalScaleX",{get:function(){return this.globalScale.x},set:function(t){this._vec.copyFrom(this.globalScale),this._vec.x=t,this.globalScale=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"globalScaleY",{get:function(){return this.globalScale.y},set:function(t){this._vec.copyFrom(this.globalScale),this._vec.y=t,this.globalScale=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"globalScaleZ",{get:function(){return this.globalScale.z},set:function(t){this._vec.copyFrom(this.globalScale),this._vec.z=t,this.globalScale=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"globalOrientation",{get:function(){return this._transformChange&&this.modelMatrix,this._globalOrientation},set:function(t){this.parent?(this.parent.globalOrientation.inverse(this._qut),this._qut.multiply(this._qut,t),this.orientation=this._qut):this.orientation=t},enumerable:!0,configurable:!0}),r.prototype.addChild=function(t){return t.parent&&t.parent.removeChild(t),this.childs.indexOf(t)>=0&&this.removeChild(t),this.childs.push(t),t.parent=this,t._isRoot=!1,t.updateTransformChange(!0),t},r.prototype.addChildAt=function(t,e){return 0>e?this.childs.splice(0,0,t):e>=this.childs.length?this.childs.push(t):this.childs.splice(e,0,t),t.parent=this,t.updateTransformChange(!0),t},r.prototype.getChildAt=function(t){return 0>t||t>=this.childs.length?null:this.childs[t]},r.prototype.getChildIndex=function(t){for(var e=0;e<this.childs.length;++e)if(this.childs[e]==t)return e;return-1},r.prototype.removeChild=function(t){var e=this.childs.indexOf(t);return 0>e?null:(t.parent=null,this.childs.splice(e,1),t.updateTransformChange(!0),t)},r.prototype.removeChildAt=function(t){if(0>t||t>=this.childs.length)return null;var e=this.childs[t];return e.parent=null,this.childs.splice(t,1),e.updateTransformChange(!0),e},r.prototype.setChildIndex=function(t,e){for(var i=0;i<this.childs.length;++i)if(this.childs[i]==t){if(i==e)return;if(e>i)for(var r=i;r>e;--r)this.childs[r]=this.childs[r-1];else if(i>e)for(var r=i;e>r;++r)this.childs[r]=this.childs[r+1];return void(this.childs[e]=t)}},r.prototype.swapObject=function(t){for(var e=t.parent,i=new Array,r=0;r<t.childs.length;++r)i[r]=t.childs[r];if(this.parent){var a=this.parent.getChildIndex(this);this.parent.childs[a]=t}if(t.parent){var a=t.parent.getChildIndex(t);t.parent.childs[a]=this}t.parent=this.parent,this.parent=e,t.childs.length=0;for(var r=0;r<this.childs.length;++r)t.childs[r]=this.childs[r],t.childs[r].parent=t;this.childs.length=0;for(var r=0;r<i.length;++r)this.childs[r]=i[r],this.childs[r].parent=this;this.updateTransformChange(!0),t.updateTransformChange(!0)},r.prototype.swapChildren=function(t,e){for(var i=0,r=0;i<this.childs.length;++i)if(this.childs[i]==t){for(;r<this.childs.length;++r)if(this.childs[r]==e){var a=this.childs[i];this.childs[i]=this.childs[r],this.childs[r]=a;break}return}},r.prototype.swapChildrenAt=function(t,e){if(!(0>t||t>=this.childs.length||0>e||e>=this.childs.length)){var i=this.childs[t];this.childs[t]=this.childs[e],this.childs[e]=i}},r.prototype.lookAt=function(e,i,r){void 0===r&&(r=t.Vector3D.Y_AXIS)},Object.defineProperty(r.prototype,"lookAtPosition",{get:function(){return new t.Vector3D},enumerable:!0,configurable:!0}),r.prototype.findObject3D=function(t){for(var e=null,i=0;i<this.childs.length;++i){if(this.childs[i].name==t)return e=this.childs[i];if(e=this.childs[i].findObject3D(t))return e}return e},r.prototype.findObject3DToID=function(t){for(var e=null,i=0;i<this.childs.length;++i){if(this.childs[i].id==t)return e=this.childs[i];if(e=this.childs[i].findObject3DToID(t))return e}return e},r.prototype.updateTransformChange=function(t){this._transformChange=t;for(var e=0;e<this.childs.length;++e)this.childs[e].updateTransformChange(t)},r.prototype.bindAnimation=function(t){this.proAnimation=t,this.proAnimation.bindObject3D(this)},r.prototype.update=function(t,e){this.proAnimation&&this.proAnimation.update(e)},r.prototype.dispose=function(){this.parent&&this.parent.removeChild(this);for(var t=0;t<this.childs.length;t++)this.childs[t].dispose();this.childs.length=0},Object.defineProperty(r.prototype,"root",{get:function(){return this.parent?this.parent.root:this},enumerable:!0,configurable:!0}),r.s_id=0,r}(t.EventDispatcher);t.Object3D=i}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(t){function e(){t.call(this),this.type="",this.multiMaterial={},this._materialCount=0,this.animation=null}return __extends(e,t),Object.defineProperty(e.prototype,"drawOrder",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lightGroup",{get:function(){return this._lightGroup},set:function(t){this._lightGroup=t;for(var e in this.multiMaterial)this.multiMaterial[e].lightGroup=this._lightGroup},enumerable:!0,configurable:!0}),e.prototype.addSubMaterial=function(t,e){this.multiMaterial[t]||this._materialCount++,this.multiMaterial[t]=e,e.lightGroup=this._lightGroup},e.prototype.removeSubMaterial=function(t){this.multiMaterial[t]&&(delete this.multiMaterial[t],this._materialCount--)},e.prototype.getMaterial=function(t){return this.multiMaterial[t]},e.prototype.materialCount=function(){return this._materialCount},e.prototype.update=function(e,i,r){t.prototype.update.call(this,e,i,r),this.animation&&this.animation.update(e,i,this.geometry),this.geometry.subGeometrys.length<=0&&this.geometry.buildDefaultSubGeometry()},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.geometry&&(this.geometry.dispose(),this.geometry=null)},e}(t.Object3D);t.IRender=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e}(t.Object3D);t.Entity=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r,a){void 0===r&&(r=null),void 0===a&&(a=null),e.call(this),this.type="mesh",this.geometry=i,a?this.animation=a:i&&this.geometry.vertexFormat&t.VertexFormat.VF_SKIN&&(this.animation=new t.SkeletonAnimation),this.material=r?r:new t.TextureMaterial,this.addSubMaterial(0,this.material),this.bound=this.buildBoundBox()}return __extends(i,e),Object.defineProperty(i.prototype,"aabb",{get:function(){return this._aabbBox},enumerable:!0,configurable:!0}),i.prototype.initAABB=function(){this._aabbBox=new t.QuadAABB,this.calcGlobalQuadAABB()},i.prototype.calcGlobalQuadAABB=function(){var t=this.bound,e=this.modelMatrix;i.AABB_BL_2.setTo(t.min.x,t.min.y,t.min.z),i.AABB_BR_2.setTo(t.max.x,t.min.y,t.min.z),i.AABB_TL_2.setTo(t.min.x,t.max.y,t.min.z),i.AABB_TR_2.setTo(t.max.x,t.max.y,t.min.z),i.AABB_BL_1.setTo(t.min.x,t.min.y,t.max.z),i.AABB_BR_1.setTo(t.max.x,t.min.y,t.max.z),i.AABB_TL_1.setTo(t.min.x,t.max.y,t.max.z),i.AABB_TR_1.setTo(t.max.x,t.max.y,t.max.z),e.transformVector(i.AABB_BL_2,i.AABB_BL_2),e.transformVector(i.AABB_BR_2,i.AABB_BR_2),e.transformVector(i.AABB_TL_2,i.AABB_TL_2),e.transformVector(i.AABB_TR_2,i.AABB_TR_2),e.transformVector(i.AABB_BL_1,i.AABB_BL_1),e.transformVector(i.AABB_BR_1,i.AABB_BR_1),e.transformVector(i.AABB_TL_1,i.AABB_TL_1),e.transformVector(i.AABB_TR_1,i.AABB_TR_1),this._aabbBox.maxPosX=Math.max(i.AABB_TL_2.x,i.AABB_TR_2.x,i.AABB_BL_2.x,i.AABB_BR_2.x,i.AABB_TL_1.x,i.AABB_TR_1.x,i.AABB_BL_1.x,i.AABB_BR_1.x),this._aabbBox.maxPosY=Math.max(i.AABB_TL_2.y,i.AABB_TR_2.y,i.AABB_BL_2.y,i.AABB_BR_2.y,i.AABB_TL_1.y,i.AABB_TR_1.y,i.AABB_BL_1.y,i.AABB_BR_1.y),this._aabbBox.minPosX=Math.min(i.AABB_TL_2.x,i.AABB_TR_2.x,i.AABB_BL_2.x,i.AABB_BR_2.x,i.AABB_TL_1.x,i.AABB_TR_1.x,i.AABB_BL_1.x,i.AABB_BR_1.x),this._aabbBox.minPosY=Math.min(i.AABB_TL_2.y,i.AABB_TR_2.y,i.AABB_BL_2.y,i.AABB_BR_2.y,i.AABB_TL_1.y,i.AABB_TR_1.y,i.AABB_BL_1.y,i.AABB_BR_1.y)},Object.defineProperty(i.prototype,"isTriangle",{get:function(){return!1},enumerable:!0,configurable:!0}),i.prototype.onUpdateTransform=function(){this._aabbBox.setOffset(this._pos)},i.prototype.clone=function(){var t=null;this.animation&&(t=this.animation.clone());var e=new i(this.geometry,this.material,t);return e.multiMaterial=this.multiMaterial,e},i.prototype.buildBoundBox=function(){var e=new t.BoundBox(this);if(this.geometry&&this.geometry.vertexArray){e.min.copyFrom(new t.Vector3D(t.MathUtil.MAX_VALUE,t.MathUtil.MAX_VALUE,t.MathUtil.MAX_VALUE)),e.max.copyFrom(new t.Vector3D(-t.MathUtil.MAX_VALUE,-t.MathUtil.MAX_VALUE,-t.MathUtil.MAX_VALUE));for(var i=0;i<this.geometry.vertexArray.length;i+=this.geometry.vertexAttLength)e.max.x<this.geometry.vertexArray[i]&&(e.max.x=this.geometry.vertexArray[i]),e.max.y<this.geometry.vertexArray[i+1]&&(e.max.y=this.geometry.vertexArray[i+1]),e.max.z<this.geometry.vertexArray[i+2]&&(e.max.z=this.geometry.vertexArray[i+2]),e.min.x>this.geometry.vertexArray[i]&&(e.min.x=this.geometry.vertexArray[i]),e.min.y>this.geometry.vertexArray[i+1]&&(e.min.y=this.geometry.vertexArray[i+1]),e.min.z>this.geometry.vertexArray[i+2]&&(e.min.z=this.geometry.vertexArray[i+2])}return e.fillBox(e.min,e.max),e.createChild(),this.bound=e,this.initAABB(),e},i.AABB_TL_1=new t.Vector3D,i.AABB_TR_1=new t.Vector3D,i.AABB_BL_1=new t.Vector3D,i.AABB_BR_1=new t.Vector3D,i.AABB_TL_2=new t.Vector3D,i.AABB_TR_2=new t.Vector3D,i.AABB_BL_2=new t.Vector3D,i.AABB_BR_2=new t.Vector3D,i}(t.IRender);t.Mesh=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r,a,n){void 0===r&&(r=null),void 0===a&&(a=100),void 0===n&&(n=100),null==r&&(r=new t.PlaneGeometry(a,n,1,1,1,1,t.Vector3D.Z_AXIS)),e.call(this,r,i),this.bound||(this.bound=this.buildBoundBox())}return __extends(i,e),i.prototype.update=function(t,e,i){this.globalOrientation=i.globalOrientation},i}(t.Mesh);t.Billboard=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r,a){void 0===a&&(a=null),e.call(this,i,r),this.camera=a,r.cullMode=t.ContextConfig.FRONT,this.bound||(this.bound=this.buildBoundBox())}return __extends(i,e),i.prototype.update=function(t,i,r){e.prototype.update.call(this,t,i,r),this.camera&&(this.position=this.camera.globalPosition)},i}(t.Mesh);t.Sky=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.type="wireframe",this.geometry=new t.Geometry,this.material=new t.ColorMaterial(16711680),this.addSubMaterial(0,this.material),this.material.drawMode=t.DrawMode.LINES,this.geometry.vertexFormat=t.VertexFormat.VF_POSITION|t.VertexFormat.VF_NORMAL|t.VertexFormat.VF_COLOR|t.VertexFormat.VF_UV0}return __extends(i,e),i}(t.IRender);t.Wireframe=e}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t.LT=0]="LT",t[t.RT=1]="RT",t[t.LB=2]="LB",t[t.RB=3]="RB",t[t.TC=4]="TC",t[t.BC=5]="BC",t[t.LC=6]="LC",t[t.RC=7]="RC",t[t.OC=8]="OC"}(t.NP||(t.NP={}));var e=t.NP,i=function(){function t(){this.c1=100,this.c2=20}return t}();t.LODTree=i;var r=function(){function i(e,i,r,a){void 0===e&&(e=null),void 0===i&&(i=null),void 0===r&&(r=0),void 0===a&&(a=0),this.content=[],this.chlids=[],this.level=0,this.center=new t.Vector3D,this.radius=0,this.parent=e,this.vertexDatas=i,this.parent&&(this.level=this.parent.level+1),0!=r&&0!=a&&this.createNode(0,r,(a+1)*r,(a+1)*(r+1)-1),this.parent||this.findNeighbour(this,r,a)}return i.prototype.createNode=function(t,r,a,n){if(this.content[e.LT]=t,this.content[e.RT]=r,this.content[e.LB]=a,this.content[e.RB]=n,this.vertexDatas&&this.processSphere(),this.content[e.RT]-this.content[e.LT]>1){var o=null,s=Math.floor((this.content[e.LT]+this.content[e.RT])/2),h=Math.floor((this.content[e.LB]+this.content[e.RB])/2),l=Math.floor((this.content[e.LT]+this.content[e.LB])/2),u=Math.floor((this.content[e.RT]+this.content[e.RB])/2),c=Math.floor((this.content[e.LT]+this.content[e.RB])/2);this.content[e.TC]=s,this.content[e.BC]=h,this.content[e.LC]=l,this.content[e.RC]=u,this.content[e.OC]=c,o=new i(this,this.vertexDatas),this.chlids[e.LT]=o,o.createNode(t,s,l,c),o=new i(this,this.vertexDatas),this.chlids[e.RT]=o,o.createNode(s,r,c,u),o=new i(this,this.vertexDatas),this.chlids[e.LB]=o,o.createNode(l,c,a,h),o=new i(this,this.vertexDatas),this.chlids[e.RB]=o,o.createNode(c,u,h,n)}},i.prototype.createIndex=function(t,i,r,a){if(void 0===a&&(a=10),!this.isVisable(r.frustum))return t;if(this.content[e.RT]-this.content[e.LT]<=1)return i[t++]=this.content[e.LT],i[t++]=this.content[e.RB],i[t++]=this.content[e.LB],i[t++]=this.content[e.LT],i[t++]=this.content[e.RT],i[t++]=this.content[e.RB],t;if(!this.isDivide(r,a)){var n=!1,o=!1,s=!1,h=!1,l=0;return this.chlids[4]&&(n=this.chlids[4].isDivide(r,a)),this.chlids[5]&&(o=this.chlids[5].isDivide(r,a)),this.chlids[6]&&(s=this.chlids[6].isDivide(r,a)),this.chlids[7]&&(h=this.chlids[7].isDivide(r,a)),i[t++]=this.content[e.LT],i[t++]=this.content[e.RB],i[t++]=this.content[e.LB],i[t++]=this.content[e.LT],i[t++]=this.content[e.RT],i[t++]=this.content[e.RB],n||o||s||h?(n&&(l=(this.content[e.LT]+this.content[e.RT])/2,i[t++]=this.content[e.LT],i[t++]=l,i[t++]=this.content[e.RT]),o&&(l=(this.content[e.LB]+this.content[e.RB])/2,i[t++]=l,i[t++]=this.content[e.LB],i[t++]=this.content[e.RB]),s&&(l=(this.content[e.LT]+this.content[e.LB])/2,i[t++]=this.content[e.LB],i[t++]=l,i[t++]=this.content[e.LT]),h&&(l=(this.content[e.RT]+this.content[e.RB])/2,i[t++]=this.content[e.RT],i[t++]=l,i[t++]=this.content[e.RB]),t):t}return this.chlids[0]&&(t=this.chlids[e.LT].createIndex(t,i,r,a),t=this.chlids[e.RT].createIndex(t,i,r,a),t=this.chlids[e.LB].createIndex(t,i,r,a),t=this.chlids[e.RB].createIndex(t,i,r,a)),t},i.prototype.isVisable=function(t){return t.inSphere(this.center,this.radius)},i.prototype.getVertex=function(t,e){e[0]=this.vertexDatas[3*t+0],e[1]=this.vertexDatas[3*t+1],e[2]=this.vertexDatas[3*t+2]},i.prototype.processSphere=function(){i.v0.length=0,i.v1.length=0,i.v2.length=0,i.v3.length=0,this.getVertex(this.content[e.LT],i.v0),this.getVertex(this.content[e.RT],i.v1),this.getVertex(this.content[e.LB],i.v2),this.getVertex(this.content[e.RB],i.v3),i.v4[0]=Math.min(i.v0[0],i.v1[0]),i.v4[0]=Math.min(i.v4[0],i.v2[0]),i.v4[0]=Math.min(i.v4[0],i.v3[0]),i.v4[1]=Math.min(i.v0[1],i.v1[1]),i.v4[1]=Math.min(i.v4[1],i.v2[1]),i.v4[1]=Math.min(i.v4[1],i.v3[1]),i.v4[2]=Math.min(i.v0[2],i.v1[2]),i.v4[2]=Math.min(i.v4[2],i.v2[2]),i.v4[2]=Math.min(i.v4[2],i.v3[2]),i.v5[0]=Math.max(i.v0[0],i.v1[0]),i.v5[0]=Math.max(i.v5[0],i.v2[0]),i.v5[0]=Math.max(i.v5[0],i.v3[0]),i.v5[1]=Math.max(i.v0[1],i.v1[1]),i.v5[1]=Math.max(i.v5[1],i.v2[1]),i.v5[1]=Math.max(i.v5[1],i.v3[1]),i.v5[2]=Math.max(i.v0[2],i.v1[2]),i.v5[2]=Math.max(i.v5[2],i.v2[2]),i.v5[2]=Math.max(i.v5[2],i.v3[2]);var t=i.v5[0]-i.v4[0],r=i.v5[1]-i.v4[1],a=i.v5[2]-i.v4[2];this.radius=Math.sqrt(t*t+r*r+a*a)/2,this.center.x=i.v4[0]+t/2,this.center.y=i.v4[1]+r/2,this.center.z=i.v4[2]+a/2},i.prototype.findNeighbour=function(t,i,r){var a=this.content[e.RT]-this.content[e.LT];if(!(1>=a)){18==this.content[0]&&20==this.content[1]&&148==this.content[2]&&150==this.content[3];for(var n=this.content[e.RT]-this.content[e.LT],o=0,s=0,h=0,l=0,u=0,c=0;4>c;++c){switch(c){case 0:o=this.content[e.LT]-n*(i+1),s=this.content[e.RT]-n*(i+1),h=this.content[e.LT],l=this.content[e.RT];break;case 1:o=this.content[e.LB],s=this.content[e.RB],h=this.content[e.LB]+n*(i+1),l=this.content[e.RB]+n*(i+1);break;case 2:o=this.content[e.LT]-n,s=this.content[e.LT],h=this.content[e.LB]-n,l=this.content[e.LB];break;case 3:o=this.content[e.RT],s=this.content[e.RT]+n,h=this.content[e.RB],l=this.content[e.RB]+n}u=(o+s+h+l)/4,u>=0&&i*r-1>=u&&(this.chlids[c+4]=t.isNeighbour(o,s,h,l))}this.chlids[0]&&(this.chlids[e.LT].findNeighbour(t,i,r),this.chlids[e.RT].findNeighbour(t,i,r),this.chlids[e.LB].findNeighbour(t,i,r),this.chlids[e.RB].findNeighbour(t,i,r))}},i.prototype.isNeighbour=function(r,a,n,o){if(this.content[e.LT]==r&&this.content[e.RT]==a&&this.content[e.LB]==n&&this.content[e.RB]==o)return this;if(this.chlids[0]){var s=(r+a+n+o)/4;if(i.v0.length=0,this.getVertex(s,i.v0),i.v1.length=0,i.v2.length=0,this.getVertex(this.chlids[e.LT].content[e.LT],i.v1),this.getVertex(this.chlids[e.LT].content[e.RB],i.v2),t.Rectangle.pointInRect(i.v0[0],i.v0[2],i.v1[0],i.v1[2],i.v2[0],i.v2[2]))return this.chlids[e.LT].isNeighbour(r,a,n,o);if(i.v1.length=0,i.v2.length=0,this.getVertex(this.chlids[e.RT].content[e.LT],i.v1),this.getVertex(this.chlids[e.RT].content[e.RB],i.v2),t.Rectangle.pointInRect(i.v0[0],i.v0[2],i.v1[0],i.v1[2],i.v2[0],i.v2[2]))return this.chlids[e.RT].isNeighbour(r,a,n,o);if(i.v1.length=0,i.v2.length=0,this.getVertex(this.chlids[e.LB].content[e.LT],i.v1),this.getVertex(this.chlids[e.LB].content[e.RB],i.v2),t.Rectangle.pointInRect(i.v0[0],i.v0[2],i.v1[0],i.v1[2],i.v2[0],i.v2[2]))return this.chlids[e.LB].isNeighbour(r,a,n,o);if(i.v1.length=0,i.v2.length=0,this.getVertex(this.chlids[e.RB].content[e.LT],i.v1),this.getVertex(this.chlids[e.RB].content[e.RB],i.v2),t.Rectangle.pointInRect(i.v0[0],i.v0[2],i.v1[0],i.v1[2],i.v2[0],i.v2[2]))return this.chlids[e.RB].isNeighbour(r,a,n,o)}return null},i.prototype.isDivide=function(t,r){i.v0.length=0,i.v1.length=0,i.v2.length=0,i.v3.length=0,i.v4.length=0,i.v5.length=0,i.v6.length=0,i.v7.length=0,i.v8.length=0,this.getVertex(this.content[e.LT],i.v0),this.getVertex(this.content[e.RT],i.v1),this.getVertex(this.content[e.LB],i.v2),this.getVertex(this.content[e.RB],i.v3);var a=(this.content[e.LT]+this.content[e.RT])/2,n=(this.content[e.LB]+this.content[e.RB])/2,o=(this.content[e.LT]+this.content[e.LB])/2,s=(this.content[e.RT]+this.content[e.RB])/2,h=(this.content[e.LT]+this.content[e.RB])/2;this.getVertex(a,i.v4),this.getVertex(n,i.v5),this.getVertex(o,i.v6),this.getVertex(s,i.v7),this.getVertex(h,i.v8);var l=(i.v0[2]+i.v1[2])/2-i.v4[2],u=(i.v2[2]+i.v3[2])/2-i.v5[2],c=(i.v0[2]+i.v2[2])/2-i.v6[2],d=(i.v1[2]+i.v3[2])/2-i.v7[2],p=(i.v0[2]+i.v3[2])/2-i.v8[2],f=(i.v1[2]+i.v2[2])/2-i.v8[2],_=l;_=Math.max(_,u),_=Math.max(_,c),_=Math.max(_,d),_=Math.max(_,p),_=Math.max(_,f),_=Math.max(_,1);var m=t.globalX-i.v8[0],g=t.globalY-i.v8[1],v=t.globalZ-i.v8[2],y=Math.sqrt(m*m+g*g+v*v);m=i.v1[0]-i.v0[0],g=i.v1[1]-i.v0[1],v=i.v1[2]-i.v0[2];var x=Math.sqrt(m*m+g*g+v*v);return 1>y/(x*r*_)?!0:!1},i.nodeCount=0,i.v0=[],i.v1=[],i.v2=[],i.v3=[],i.v4=[],i.v5=[],i.v6=[],i.v7=[],i.v8=[],i}();t.LODQuad=r}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r){void 0===r&&(r=null),e.call(this,i,r),this.wireframe=new t.Wireframe,this.bbb=!0,this.vertex=i.getVertexForIndex(0,t.VertexFormat.VF_POSITION,null,i.vertexCount),this.lodQuad=new t.LODQuad(null,this.vertex,i.segmentsW,i.segmentsH),this.wireframe.geometry.setVerticesForIndex(0,t.VertexFormat.VF_POSITION,this.vertex,i.vertexCount),this.wireframe.geometry.indexCount=6*i.faceCount,this.addChild(this.wireframe)}return __extends(i,e),i.prototype.update=function(t,i,r){e.prototype.update.call(this,t,i,r);var a=0;if(this.bbb,!0){a=this.lodQuad.createIndex(a,this.geometry.indexArray,this.camera,20),this.bbb=!1,this.geometry.indexCount=a,this.geometry.bufferDiry=!0,this.geometry.subGeometrys[0].count=this.geometry.indexCount;for(var n=0;n<this.geometry.faceCount;++n)this.wireframe.geometry.indexArray[6*n+0]=this.geometry.indexArray[3*n+0],this.wireframe.geometry.indexArray[6*n+1]=this.geometry.indexArray[3*n+1],this.wireframe.geometry.indexArray[6*n+2]=this.geometry.indexArray[3*n+1],this.wireframe.geometry.indexArray[6*n+3]=this.geometry.indexArray[3*n+2],this.wireframe.geometry.indexArray[6*n+4]=this.geometry.indexArray[3*n+2],this.wireframe.geometry.indexArray[6*n+5]=this.geometry.indexArray[3*n+0];this.wireframe.geometry.indexCount=6*this.geometry.faceCount,this.wireframe.geometry.bufferDiry=!0,this.wireframe.geometry.subGeometrys[0]&&(this.wireframe.geometry.subGeometrys[0].count=this.wireframe.geometry.indexCount)}},i}(t.Mesh);t.Terrain=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(){function t(){}return t.load=function(t){this._fontTextures=t},t.getTexture=function(t){var e=this._fontTextures[t];return e},t}();t.BitmapFont=e}(e=t.gui||(t.gui={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.aabb=new t.Rectangle,this.mouseEnable=!0,this.mouseChildern=!0,this.hasMouseMove=!1,this.hasMouseDown=!1,this.hasMouseUp=!1,this.hasMouseClick=!1,this.hasMouseOut=!1,this.mouseInState=!1,this._renderType=0,this._childs=[],this._rgbNumber=16777215,this._alphaNumber=1,this._color=new t.ColorTransform,this._pivot=new t.Vector3D,this._pos=new t.Vector3D,this._rot=new t.Vector3D,this._sca=new t.Vector3D(1,1,100,100),this._globalColor=new t.ColorTransform,this._globalPos=new t.Vector3D,this._globalRot=new t.Vector3D,this._globalSca=new t.Vector3D(1,1,100,100),this._orientation=new t.Quaternion,this._globalOrientation=new t.Quaternion,this._localVisible=!0,this._globalVisible=!0,this._visibleChange=!0,this._colorChange=!0,this._transformChange=!0,this._maskRectChange=!0,this._transformInvalid=!0,this._renderTypeInvalid=!0,this._maskRectInvalid=!0,this._colorInvalid=!0,this._textureInvalid=!0,this._visibleInvalid=!0,this._qut=new t.Quaternion,this._vec=new t.Vector3D}return __extends(i,e),Object.defineProperty(i.prototype,"stage",{get:function(){return this._stage},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"childs",{get:function(){return this._childs},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"renderType",{set:function(t){t!=this._renderType&&(this._renderTypeInvalid=!0,this._renderType=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this._sca.z},set:function(t){t!=this._sca.z&&(this._sca.z=t,this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._sca.w},set:function(t){t!=this._sca.w&&(this._sca.w=t,this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pivotX",{get:function(){return this._pivot.x},set:function(t){t!=this._pivot.x&&(this._pivot.x=t,this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pivotY",{get:function(){return this._pivot.y},set:function(t){t!=this._pivot.y&&(this._pivot.y=t,this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pivotZ",{get:function(){return this._pivot.z},set:function(t){t!=this._pivot.z&&(this._pivot.z=t,this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mask",{get:function(){return this._localMaskRect},set:function(e){(null!=e||null!=this._localMaskRect)&&(this._localMaskRect=this._localMaskRect||new t.Rectangle,this._localMaskRect.copyFrom(e),this.updateMaskChange(!0))},enumerable:!0,configurable:!0}),i.prototype.calculateTransform=function(){if(this._transformChange){if(null!=this._parent){var t=this._parent.globalOrientation;this._globalOrientation.multiply(t,this._orientation),this._globalOrientation.toEulerAngles(this._globalRot);var e=this._parent.globalScale;this._globalSca.copyFrom(e.multiply(this._sca)),t.transformVector(e.multiply(this._pos),this._globalPos),this._globalPos.copyFrom(this._globalPos.add(this._parent.globalPosition))}else this._globalOrientation.copyFrom(this._orientation),this._globalPos.copyFrom(this._pos),this._globalSca.copyFrom(this._sca),this._globalRot.copyFrom(this._rot);this._transformChange=!1,this.calculateMask(),this.onUpdateTransform()}},i.prototype.calculateMask=function(){this.calculateTransform(),this._maskRectChange&&(this._parent?this._localMaskRect?(this._globalMaskRect=this._globalMaskRect||new t.Rectangle,this._globalMaskRect.x=this._localMaskRect.x*this._globalSca.x+this._globalPos.x,this._globalMaskRect.y=this._localMaskRect.y*this._globalSca.y+this._globalPos.y,this._globalMaskRect.width=this._localMaskRect.width*this._globalSca.x,this._globalMaskRect.height=this._localMaskRect.height*this._globalSca.y,this._parent.globalMask&&this._globalMaskRect.innerArea(this._parent.globalMask,this._globalMaskRect)):this._parent.globalMask?(this._globalMaskRect=this._globalMaskRect||new t.Rectangle,this._globalMaskRect.copyFrom(this._parent.globalMask)):this._globalMaskRect=null:this._localMaskRect?(this._globalMaskRect=this._globalMaskRect||new t.Rectangle,this._globalMaskRect.x=this._localMaskRect.x*this._globalSca.x+this._globalPos.x,this._globalMaskRect.y=this._localMaskRect.y*this._globalSca.y+this._globalPos.y,this._globalMaskRect.width=this._localMaskRect.width*this._globalSca.x,this._globalMaskRect.height=this._localMaskRect.height*this._globalSca.y):this._globalMaskRect=null,this._maskRectChange=!1)},i.prototype.onUpdateTransform=function(){},i.prototype.dispatchMuseDown=function(){if(this.hasEventListener(t.MouseEvent3D.MOUSE_DOWN)){var e=new t.MouseEvent3D(t.MouseEvent3D.MOUSE_DOWN);e.target=this,this.dispatchEvent(e)}},i.prototype.dispatchMuseUp=function(){if(this.hasEventListener(t.MouseEvent3D.MOUSE_UP)){var e=new t.MouseEvent3D(t.MouseEvent3D.MOUSE_UP);e.target=this,this.dispatchEvent(e)}},i.prototype.dispatchMuseClick=function(){if(this.hasEventListener(t.MouseEvent3D.MOUSE_CLICK)){var e=new t.MouseEvent3D(t.MouseEvent3D.MOUSE_CLICK);e.target=this,this.dispatchEvent(e)}},i.prototype.dispatchMuseMove=function(){if(this.hasEventListener(t.MouseEvent3D.MOUSE_MOVE)){var e=new t.MouseEvent3D(t.MouseEvent3D.MOUSE_MOVE);e.target=this,this.dispatchEvent(e)}},i.prototype.dispatchMuseOut=function(){if(this.hasEventListener(t.MouseEvent3D.MOUSE_OUT)){var e=new t.MouseEvent3D(t.MouseEvent3D.MOUSE_OUT);e.target=this,this.dispatchEvent(e)}},i.prototype.addChild=function(e){return this.doAddChildAt(e,t.MathUtil.MAX_VALUE)},i.prototype.addChildAt=function(t,e){return this.doAddChildAt(t,e)},i.prototype.doAddChildAt=function(t,e){if(null==t)return null;if(t.parent)throw Error("This object is already the other child object.");if(this._childs.indexOf(t)>=0)throw Error("The same child object has been added.");if(0>e)throw Error("Child index can not be small than 0 !");return e>=this._childs.length?this._childs.push(t):this._childs.splice(e,0,t),t._parent=this,this._stage&&this._stage.setRenderListInvalid(),t.activeStage(this._stage),t},i.prototype.removeChild=function(t){return this.doRemoveChild(t)},i.prototype.removeChildAt=function(t){return this.doRemoveChild(this._childs[t])},i.prototype.doRemoveChild=function(t){if(null==t)return null;var e=this._childs.indexOf(t);if(-1==e)throw Error("The display isn't a child of this container!");return this._childs.splice(e,1),t._parent=null,this._stage&&this._stage.setRenderListInvalid(),t.activeStage(null),t},i.prototype.swapChildIndex=function(){},i.prototype.activeStage=function(t){if(this._stage!=t){this._stage=t,this.updateMaskChange(!0),this.updateTransformChange(!0),this.updateColorChange(!0),this.updateVisibleChange(!0);for(var e=0,i=this._childs.length;i>e;e++)this._childs[e].activeStage(t)}},i.prototype.hasChild=function(){return-1},i.prototype.getChildByIndex=function(){return null},i.prototype.getChildByName=function(){return null},i.prototype.update=function(){this.globalPosition,this.globalRotation,this.globalScale,this.globalColor,this.globalVisible,this.globalMask,this.updateMouseAABB()},i.prototype.updateMouseAABB=function(){if(this.mouseEnable){var t=this.globalPosition,e=this.globalScale;(this._maskRectInvalid||this._transformInvalid)&&(this.aabb.x=t.x,this.aabb.y=t.y,this.aabb.width=this.width*e.x,this.aabb.height=this.height*e.y,this.globalMask&&this.aabb.innerArea(this.globalMask,this.aabb))}else this.aabb.setTo(0,0,0,0)},i.prototype.updateMaskChange=function(t){if(this._maskRectChange!=t){this._maskRectChange=t,this._maskRectInvalid=t;for(var e=0;e<this._childs.length;++e)this._childs[e].updateMaskChange(t)}},i.prototype.updateTransformChange=function(t){if(this._transformChange!=t){this._transformChange=t,this._transformInvalid=t;for(var e=0;e<this._childs.length;++e)this._childs[e].updateTransformChange(t);this.updateMaskChange(t)}},i.prototype.updateVisibleChange=function(t){if(this._visibleChange!=t){this._visibleChange=t,this._visibleInvalid=t;for(var e=0;e<this._childs.length;++e)this._childs[e].updateVisibleChange(t)}},Object.defineProperty(i.prototype,"globalVisible",{get:function(){return this._visibleChange&&(this._globalVisible=this._parent?this._localVisible&&this._parent.globalVisible:this._localVisible,this._visibleChange=!1),this._globalVisible},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visible",{get:function(){return this._localVisible},set:function(t){this._localVisible!=t&&(this._localVisible=t,this.updateVisibleChange(!0))},enumerable:!0,configurable:!0}),i.prototype.updateColorChange=function(t){if(this._colorChange!=t){this._colorChange=t,this._colorInvalid=t;for(var e=0;e<this._childs.length;++e)this._childs[e].updateColorChange(t)}},Object.defineProperty(i.prototype,"globalX",{get:function(){return this.globalPosition.x},set:function(t){this._vec.copyFrom(this.globalPosition),this._vec.x=t,this.globalPosition=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalY",{get:function(){return this.globalPosition.y},set:function(t){this._vec.copyFrom(this.globalPosition),this._vec.y=t,this.globalPosition=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalZ",{get:function(){return this.globalPosition.z},set:function(t){this._vec.copyFrom(this.globalPosition),this._vec.z=t,this.globalPosition=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalPosition",{get:function(){return this._transformChange&&this.calculateTransform(),this._globalPos},set:function(t){this._parent?(this._parent.globalOrientation.inverse(this._qut),t.subtract(this._parent.globalPosition,this._vec),this._qut.transformVector(this._vec,this._vec),this._vec.divided(this._parent.globalScale,this._vec),this.position=this._vec):this.position=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalRotationX",{get:function(){return this.globalRotation.x},set:function(t){this._vec.copyFrom(this.globalRotation),this._vec.x=t,this.globalRotation=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalRotationY",{get:function(){return this.globalRotation.y},set:function(t){this._vec.copyFrom(this.globalRotation),this._vec.y=t,this.globalRotation=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalRotationZ",{get:function(){return this.globalRotation.z},set:function(t){this._vec.copyFrom(this.globalRotation),this._vec.z=t,this.globalRotation=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalRotation",{get:function(){return this._transformChange&&this.calculateTransform(),this._globalRot},set:function(t){this._qut.fromEulerAngles(t.x,t.y,t.z),this.globalOrientation=this._qut},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalScale",{get:function(){return this._transformChange&&this.calculateTransform(),this._globalSca},set:function(t){this._parent?(t.divided(this._parent.globalScale,this._vec),this.scale=this._vec):this.scale=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalScaleX",{get:function(){return this.globalScale.x},set:function(t){this._vec.copyFrom(this.globalScale),this._vec.x=t,this.globalScale=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalScaleY",{get:function(){return this.globalScale.y},set:function(t){this._vec.copyFrom(this.globalScale),this._vec.y=t,this.globalScale=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalScaleZ",{get:function(){return this.globalScale.z},set:function(t){this._vec.copyFrom(this.globalScale),this._vec.z=t,this.globalScale=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalOrientation",{get:function(){return this._transformChange&&this.calculateTransform(),this._globalOrientation
},set:function(t){this._parent?(this._parent.globalOrientation.inverse(this._qut),this._qut.multiply(this._qut,t),this.orientation=this._qut):this.orientation=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalMask",{get:function(){return this._maskRectChange&&this.calculateMask(),this._globalMaskRect},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return this._pos},set:function(t){this._pos.copyFrom(t),this.updateTransformChange(!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this._rot},set:function(t){this._rot.x=t.x,this._rot.y=t.y,this._rot.z=t.z,this._orientation.fromEulerAngles(this._rot.x,this._rot.y,this._rot.z),this.updateTransformChange(!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"orientation",{get:function(){return this._orientation},set:function(t){this._orientation.copyFrom(t),this._orientation.toEulerAngles(this._rot),this.updateTransformChange(!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"orientationX",{set:function(t){this._orientation.x!=t&&(this._orientation.x=t,this._orientation.toEulerAngles(this._rot),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"orientationY",{set:function(t){this._orientation.y!=t&&(this._orientation.y=t,this._orientation.toEulerAngles(this._rot),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"orientationZ",{set:function(t){this._orientation.z!=t&&(this._orientation.z=t,this._orientation.toEulerAngles(this._rot),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"orientationW",{set:function(t){this._orientation.w!=t&&(this._orientation.w=t,this._orientation.toEulerAngles(this._rot),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scale",{get:function(){return this._sca},set:function(t){this._sca=t,this.updateTransformChange(!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"x",{get:function(){return this._pos.x},set:function(t){this._pos.x!=t&&(this._pos.x=t,this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this._pos.y},set:function(t){this._pos.y!=t&&(this.updateTransformChange(!0),this._pos.y=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"z",{get:function(){return this._pos.z},set:function(t){this._pos.z!=t&&(this._pos.z=t,this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotationX",{get:function(){return this._rot.x},set:function(t){this._rot.x!=t&&(this._rot.x=t,this._orientation.fromEulerAngles(this._rot.x,this._rot.y,this._rot.z),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotationY",{get:function(){return this._rot.y},set:function(t){this._rot.y!=t&&(this._rot.y=t,this._orientation.fromEulerAngles(this._rot.x,this._rot.y,this._rot.z),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotationZ",{get:function(){return this._rot.z},set:function(t){this._rot.z!=t&&(this._rot.z=t,this._orientation.fromEulerAngles(this._rot.x,this._rot.y,this._rot.z),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleX",{get:function(){return this._sca.x},set:function(t){this._sca.x!=t&&(this._sca.x=t,this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleY",{get:function(){return this._sca.y},set:function(t){this._sca.y!=t&&(this.updateTransformChange(!0),this._sca.y=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleZ",{get:function(){return this._sca.z},set:function(t){this._sca.z!=t&&(this._sca.z=t,this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalColor",{get:function(){return this._colorChange&&(this._color.alpha=this._alphaNumber,this._color.setColorRGB(this._rgbNumber),this._parent?this._globalColor.multiply(this._parent.globalColor):this._globalColor.copyFrom(this._color),this._colorChange=!1),this._color},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"color",{get:function(){return this._rgbNumber},set:function(t){this._rgbNumber!=t&&(this._rgbNumber=t,this.updateColorChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"alpha",{get:function(){return this._alphaNumber},set:function(t){this._alphaNumber=t,this._alphaNumber!=t&&(this._alphaNumber=t,this.updateColorChange(!0))},enumerable:!0,configurable:!0}),i}(t.EventDispatcher);t.DisplayObject=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.buildGeometry=function(i,r,a){var i=i;i.vertexFormat=t.VertexFormat.VF_QUADPOS|t.VertexFormat.VF_QUADOFFSET|t.VertexFormat.VF_UVREC|t.VertexFormat.VF_ROTATION|t.VertexFormat.VF_SCALE|t.VertexFormat.VF_QUAD_COLOR;var n=new t.SubGeometry;i.vertexCount=4*a,i.indexCount=e.singleQuadIndex.length*a;for(var o=0,s=0,h=0;a>h;h++){o=h+r,e.singleQuadData[0*e.vertexLen+2]=o,e.singleQuadData[1*e.vertexLen+2]=o,e.singleQuadData[2*e.vertexLen+2]=o,e.singleQuadData[3*e.vertexLen+2]=o,s=4*h*i.vertexAttLength;for(var l=0;l<e.singleQuadData.length;l++)i.vertexArray[s+l]=e.singleQuadData[l];for(var u=0;u<e.singleQuadIndex.length;u++)i.indexArray[h*e.singleQuadIndex.length+u]=e.singleQuadIndex[u]+4*h}n.geometry=i,n.start=0,n.count=i.indexCount,i.subGeometrys.push(n),i.vertexAttLength=e.vertexLen},e.singleQuadData=[0,0,1e5,0,0,0,0,0,0,1,1,0,0,0,1,-1,0,1,1,0,0,1,1,0,0,1e5,0,0,0,0,1,0,1,1,0,0,0,1,-1,0,1,1,0,0,1,1,0,0,1e5,0,0,0,0,1,1,1,1,0,0,0,1,-1,0,1,1,0,0,1,1,0,0,1e5,0,0,0,0,0,1,1,1,0,0,0,1,-1,0,1,1,0,0,1,1],e.vertexLen=23,e.posOffest=0,e.posSize=4,e.offsetOffest=4,e.offsetSize=3,e.uvRectangleOffest=7,e.uvRectangleSize=4,e.rotationOffest=11,e.rotationSize=4,e.scaleOffest=15,e.scaleSize=4,e.colorOffest=19,e.colorSize=4,e.singleQuadIndex=[0,2,1,0,3,2],e.vertexBytes=4*e.vertexLen,e.quadVertexLen=4*e.vertexLen,e}();t.QuadData=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){}return t.NULL_TEXTURE=-1,t.NULL_QUAD=-2,t.NULL_INVISIBLE=-3,t}();t.QuadNullType=e;var i=function(i){function r(){i.call(this),this._globalIndex=-1}return __extends(r,i),Object.defineProperty(r.prototype,"texture",{set:function(t){t!=this._texture&&(this._texture=t,this._textureInvalid=!0)},enumerable:!0,configurable:!0}),r.prototype.updateVertices=function(i,a,n){if(a.sharedVertexBuffer&&a.sharedVertexBuffer.arrayBuffer){var o=this.globalPosition,s=(this.globalRotation,this.globalScale);this._globalIndex!=n&&(this._globalIndex=n,this._colorInvalid=this._transformInvalid=this._renderTypeInvalid=this._textureInvalid=this._visibleInvalid=this._maskRectInvalid=!0);var h,l=0,u=a.vertexAttLength,c=a.sharedVertexBuffer.arrayBuffer;if(this._transformInvalid){this._transformInvalid=!1,h=i*t.QuadData.quadVertexLen+t.QuadData.offsetOffest;for(var d=0;4>d;d++)l=h+d*u,c[l]=o.x,c[l+1]=-o.y;h=i*t.QuadData.quadVertexLen+t.QuadData.posOffest,l=h+0*u,c[l]=0,c[l+1]=0,l=h+1*u,c[l]=this.width,c[l+1]=0,l=h+2*u,c[l]=this.width,c[l+1]=-this.height,l=h+3*u,c[l]=0,c[l+1]=-this.height,h=i*t.QuadData.quadVertexLen+t.QuadData.uvRectangleOffest;for(var d=0;4>d;d++)l=h+d*u,c[l+2]=s.x,c[l+3]=s.y;var p=t.Quaternion.HELP_0;p.fromEulerAngles(this._globalRot.x,this._globalRot.y,this._globalRot.z),h=i*t.QuadData.quadVertexLen+t.QuadData.rotationOffest;for(var d=0;4>d;d++)l=h+d*u,c[l]=p.x,c[l+1]=p.y,c[l+2]=p.z,c[l+3]=p.w}if(this._renderTypeInvalid){this._renderTypeInvalid=!1,h=i*t.QuadData.quadVertexLen+t.QuadData.posOffest;for(var d=0;4>d;d++)l=h+d*u,c[l+3]=this._renderType}if(this._textureInvalid||this._visibleInvalid){this._textureInvalid=!1,this._visibleInvalid=!1;var f,_=e.NULL_TEXTURE;this._texture?(f=this._texture.uvRectangle,_=this._texture.guiIndex):(_=e.NULL_TEXTURE,f=r.DefaultUVRect),0==this.visible&&(_=e.NULL_INVISIBLE),h=i*t.QuadData.quadVertexLen+t.QuadData.uvRectangleOffest,l=h+0*u,c[l]=f.x,c[l+1]=f.y,l=h+1*u,c[l]=f.x+f.width,c[l+1]=f.y,l=h+2*u,c[l]=f.x+f.width,c[l+1]=f.y+f.height,l=h+3*u,c[l]=f.x,c[l+1]=f.y+f.height,h=i*t.QuadData.quadVertexLen+t.QuadData.offsetOffest;for(var d=0;4>d;d++)l=h+d*u,c[l+2]=_}if(this._maskRectInvalid){this._maskRectInvalid=!1;var m=this.globalMask;if(m){var g,v,y,x;g=m.x,v=m.y,y=m.width,x=m.height,h=i*t.QuadData.quadVertexLen+t.QuadData.scaleOffest;for(var d=0;4>d;d++)l=h+d*u,c[l+0]=g,c[l+1]=v,c[l+2]=y,c[l+3]=x}}if(this._colorInvalid){var b=this.globalColor.alpha,D=r.TempVector;this.globalColor.m44.transformVector(r.IdentityVector,D),h=i*t.QuadData.quadVertexLen+t.QuadData.colorOffest;for(var d=0;4>d;d++)l=h+d*u,c[l]=D.x,c[l+1]=D.y,c[l+2]=D.z,c[l+3]=b;this._colorInvalid=!1}}},r.clear=function(i,r){if(r.sharedVertexBuffer&&r.sharedVertexBuffer.arrayBuffer)for(var a,n=r.sharedVertexBuffer.arrayBuffer,o=i*t.QuadData.quadVertexLen+t.QuadData.offsetOffest,s=0;4>s;s++)a=o+s*r.vertexAttLength,n[a+2]=e.NULL_QUAD},r.IdentityVector=new t.Vector3D(1,1,1,1),r.TempVector=new t.Vector3D,r.DefaultUVRect=new t.Rectangle(0,0,1,1),r}(t.DisplayObject);t.Quad=i}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e){this._mouseList=[],this._quadStage=e,t.Input.addEventListener(t.MouseEvent3D.MOUSE_DOWN,this.mouseDown,this),t.Input.addEventListener(t.MouseEvent3D.MOUSE_UP,this.mouseUp,this),t.Input.addEventListener(t.MouseEvent3D.MOUSE_OVER,this.mouseOver,this),t.Input.addEventListener(t.MouseEvent3D.MOUSE_CLICK,this.mouseClick,this),t.Input.addEventListener(t.MouseEvent3D.MOUSE_MOVE,this.mouseMove,this),t.Input.addEventListener(t.MouseEvent3D.MOUSE_OUT,this.mouseOut,this),t.Input.addEventListener(t.TouchEvent3D.TOUCH_START,this.mouseDown,this),t.Input.addEventListener(t.TouchEvent3D.TOUCH_END,this.mouseUp,this),t.Input.addEventListener(t.TouchEvent3D.TOUCH_MOVE,this.mouseMove,this)}return e.prototype.mouseOut=function(){var e=this.getMousePickList();if(e.length>0){var i=e[0];i.pickResult=i.pickResult||new t.PickResult,i.pickResult.pickList=e,i.dispatchMuseOut()}this._quadStage.dispatchMouseOut()},e.prototype.mouseDown=function(){var e=this.getMousePickList();if(e.length>0){var i=e[0];i.pickResult=i.pickResult||new t.PickResult,i.pickResult.pickList=e,i.dispatchMuseDown()}this._quadStage.dispatchMuseDown()},e.prototype.mouseUp=function(){var e=this.getMousePickList();if(e.length>0){var i=e[0];i.pickResult=i.pickResult||new t.PickResult,i.pickResult.pickList=e,i.dispatchMuseUp()}this._quadStage.dispatchMuseUp()},e.prototype.mouseOver=function(){var e=this.getMousePickList();if(e.length>0){var i=e[0];i.mouseInState=!0,i.pickResult=i.pickResult||new t.PickResult,i.pickResult.pickList=e,i.dispatchMuseUp()}this._quadStage.dispatchMouseOver()},e.prototype.mouseMove=function(){var e=this.getMousePickList();if(e.length>0){var i=e[0];i.mouseInState=!0,i.pickResult=i.pickResult||new t.PickResult,i.pickResult.pickList=e,i.dispatchMuseMove()}this._quadStage.dispatchMuseMove()},e.prototype.mouseClick=function(){var e=this.getMousePickList();if(e.length>0){var i=e[0];i.mouseInState=!0,i.pickResult=i.pickResult||new t.PickResult,i.pickResult.pickList=e,i.dispatchMuseClick()}this._quadStage.dispatchMuseClick()},e.prototype.fire=function(){this._finalist=this._quadStage.quadList},e.prototype.getMousePickList=function(){var e;this._mouseList.length=0;var i;if(this._finalist)for(e=0;e<this._finalist.length;e++)i=this._finalist[e],i.globalVisible&&i.mouseEnable&&i.aabb.inner(t.Input.mouseX,t.Input.mouseY)&&this._mouseList.push(i);return this._mouseList.reverse(),this._mouseList},e}();t.GUIEventFire=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){}return t.sortZindex=function(t,e){return e.z-t.z},t.sortAB=function(e){return e.sort(function(e,i){return t.sortZindex(e,i)})},t.sortBA=function(e){return e.sort(function(e,i){return t.sortZindex(i,e)})},t}();t.SortUtil=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this,new t.Geometry,new t.TextureMaterial),this.startQuad=0,this.numberQuad=0,this.quadList=[],this.startQuad=i,this.numberQuad=t.QuadStage.moreQuad,this.geometry.drawType=t.Context3DProxy.gl.DYNAMIC_DRAW,t.QuadData.buildGeometry(this.geometry,i,t.QuadStage.moreQuad),this.guiMethod=new t.GUIMethod,this.enableCulling=!1,this.uiMaterial=this.material,this.uiMaterial.blendMode=t.BlendMode.ALPHA,this.uiMaterial.repeat=!0,this.uiMaterial.diffusePass.addMethod(this.guiMethod),this.canPick=!1,this.tag.name="gui"}return __extends(i,e),i.prototype.setTexture=function(t,e){this.guiMethod.setTextures(t,e)},i}(t.Mesh);t.QuadMesh=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this._nextIndex=0,this._textures=[];for(var i=0;i<e.MAX_COUNT;i++)this._textures[i]=t.CheckerboardTexture.texture}return e.prototype.register=function(t){return this._nextIndex>=e.MAX_COUNT?!1:this._textures.indexOf(t)>=0?!1:(this._textures[this._nextIndex]=t,t.guiIndex=this._nextIndex,this._nextIndex++,!0)},e.prototype.replace=function(t,i){if(0>i||i>=e.MAX_COUNT)throw new Error("index error");var r=this._textures[i];return this._textures[i]=t,r},e.prototype.activeTexture=function(t){for(var i=0;i<e.MAX_COUNT;i++)t.setTexture(i,this._textures[i])},e.MAX_COUNT=7,e}();t.GUITextureGroup=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this),this._childList=[],this._quadMeshs=[],this._quadCurHistory=[],this._quadLastHistory=[],this._renderListInvalid=!1,this.quadList=[],this._view3D=i,this._guiEventFire=new t.GUIEventFire(this),this._textureGroup=new t.GUITextureGroup,this._guiContainer=new t.Object3D,this.changeCamera()}return __extends(i,e),i.prototype.registerTexture=function(t){return this._textureGroup.register(t)},i.prototype.changeCamera=function(){this._guiContainer.parent&&this._guiContainer.parent.removeChild(this._guiContainer),this._view3D.camera3D.addChild(this._guiContainer)},i.prototype.creatQuadMesh=function(){var e=new t.QuadMesh(this._quadMeshs.length*i.moreQuad);this._quadMeshs.push(e),this._guiContainer.addChild(e)},i.prototype.getChildQuads=function(e,i){var r,a,n=0;for(e instanceof t.Quad&&(a=e,i.push(a));n<e.childs.length;)r=e.childs[n++],this.getChildQuads(r,i)},i.prototype.addChild=function(t){if(!t)throw Error("This object is null");if(t.parent)throw Error("parent isn't null");this._childList.push(t),t.activeStage(this),this.setRenderListInvalid()},i.prototype.setRenderListInvalid=function(){this._renderListInvalid=!0},i.prototype.updateRenderList=function(){this.quadList.length=0;for(var t=0;t<this._childList.length;t++)this.getChildQuads(this._childList[t],this.quadList);if(this.quadList.length>this._quadMeshs.length*i.moreQuad)for(var e=Math.ceil(this.quadList.length/i.moreQuad)-this._quadMeshs.length,t=0;e>t;t++)this.creatQuadMesh()},i.prototype.removeChild=function(t){var e=this._childList.indexOf(t);-1!=e&&this._childList.splice(e,1),t.activeStage(null),this.setRenderListInvalid()},i.prototype.update=function(e,r,a){this._renderListInvalid&&(this._renderListInvalid=!1,this.updateRenderList()),t.Context3DProxy.gl.disable(t.Context3DProxy.gl.DEPTH_TEST);var n,o=this.quadList.length;for(n=0;o>n;n++)this.quadList[n].update(e,r);this._guiEventFire.fire();var s;for(n=0;o>n;n++)s=Math.floor(n/i.moreQuad),this.quadList[n].updateVertices(n%i.moreQuad,this._quadMeshs[s].geometry,n);this.clearInvalidVertices(o);var h;for(n=0;n<this._quadMeshs.length;n++)h=this._quadMeshs[n],h.geometry.upload(a,t.Context3DProxy.gl.DYNAMIC_DRAW),this._textureGroup.activeTexture(h);t.Context3DProxy.gl.enable(t.Context3DProxy.gl.DEPTH_TEST)},i.prototype.clearInvalidVertices=function(e){this._quadCurHistory.length=0;for(var r=0;e>=i.moreQuad;)this._quadCurHistory[r]=i.moreQuad,e-=i.moreQuad,r++;e>0&&(this._quadCurHistory[r]=e),e=this._quadMeshs.length;var a=0,n=0;for(r=0;e>r;r++)if(a=this._quadLastHistory[r]||0,n=this._quadCurHistory[r]||0,a>n)for(var o=n;a>o;o++)t.Quad.clear(o,this._quadMeshs[r].geometry);var s=this._quadCurHistory;this._quadCurHistory=this._quadLastHistory,this._quadLastHistory=s},i.prototype.dispatchMuseDown=function(){if(this.hasEventListener(t.MouseEvent3D.MOUSE_DOWN)){var e=new t.MouseEvent3D(t.MouseEvent3D.MOUSE_DOWN);e.target=this,this.dispatchEvent(e)}},i.prototype.dispatchMuseUp=function(){if(this.hasEventListener(t.MouseEvent3D.MOUSE_UP)){var e=new t.MouseEvent3D(t.MouseEvent3D.MOUSE_UP);e.target=this,this.dispatchEvent(e)}},i.prototype.dispatchMuseClick=function(){if(this.hasEventListener(t.MouseEvent3D.MOUSE_CLICK)){var e=new t.MouseEvent3D(t.MouseEvent3D.MOUSE_CLICK);e.target=this,this.dispatchEvent(e)}},i.prototype.dispatchMuseMove=function(){if(this.hasEventListener(t.MouseEvent3D.MOUSE_MOVE)){var e=new t.MouseEvent3D(t.MouseEvent3D.MOUSE_MOVE);e.target=this,this.dispatchEvent(e)}},i.prototype.dispatchMouseOut=function(){if(this.hasEventListener(t.MouseEvent3D.MOUSE_OUT)){var e=new t.MouseEvent3D(t.MouseEvent3D.MOUSE_OUT);e.target=this,this.dispatchEvent(e)}},i.prototype.dispatchMouseOver=function(){if(this.hasEventListener(t.MouseEvent3D.MOUSE_OVER)){var e=new t.MouseEvent3D(t.MouseEvent3D.MOUSE_OVER);e.target=this,this.dispatchEvent(e)}},i.moreQuad=500,i}(t.EventDispatcher);t.QuadStage=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var i=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.onRender=function(){},e.prototype.onUpdate=function(){},e.prototype.onEvent=function(){},e}(t.DisplayObject);e.UILayout=i}(e=t.gui||(t.gui={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this),this.instanceStyles={}}return __extends(e,t),e.prototype.onRender=function(){},e.prototype.onUpdate=function(){},e.prototype.onEvent=function(){},e.prototype.setStyle=function(t,e){this.instanceStyles[t]!==e&&(this.instanceStyles[t]=e)},e.prototype.getStyle=function(t){return this.instanceStyles[t]},e.getStyleDefinition=function(){return this.defaultStyles},e.mergeStyles=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];for(var i={},r=t.length,a=0;r>a;a++){var n=t[a];for(var o in n)null==i[o]&&(i[o]=t[a][o])}return i},e.defaultStyles={},e}(t.UILayout);t.UIElement=e}(e=t.gui||(t.gui={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this),this._skin=new t.Quad,this.addChild(this._skin),this._state=i.STATE_UP,this._enable=!0,this._isDowning=!1,this._skin.addEventListener(t.MouseEvent3D.MOUSE_DOWN,this.mouseEventHandler,this),this._skin.addEventListener(t.MouseEvent3D.MOUSE_OUT,this.mouseEventHandler,this),this._skin.addEventListener(t.MouseEvent3D.MOUSE_OVER,this.mouseEventHandler,this)}return __extends(i,e),Object.defineProperty(i.prototype,"width",{get:function(){return this._skin.width},set:function(t){this._skin.width=t,this.onRender()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._skin.height},set:function(t){this._skin.height=t,this.onRender()},enumerable:!0,configurable:!0}),i.prototype.setStyle=function(t,i){e.prototype.setStyle.call(this,t,i),this.onRender()},i.prototype.mouseEventHandler=function(e){this._enable&&(e.eventType===t.MouseEvent3D.MOUSE_DOWN?this.startPress():e.eventType===t.MouseEvent3D.MOUSE_UP?this.endPress():e.eventType===t.MouseEvent3D.MOUSE_OUT?this.mouseOut():e.eventType===t.MouseEvent3D.MOUSE_OVER&&this.mouseOver())},i.prototype.mouseOut=function(){this.setMouseState(i.STATE_UP)},i.prototype.mouseOver=function(){this._isDowning&&this.setMouseState(i.STATE_DOWN)},i.prototype.startPress=function(){this._skin.addEventListener(t.MouseEvent3D.MOUSE_UP,this.mouseEventHandler,this),this.stage.addEventListener(t.MouseEvent3D.MOUSE_UP,this.onStageEnd,this),this._isDowning=!0,this.setMouseState(i.STATE_DOWN),this.dispatchEvent(new t.MouseEvent3D(t.MouseEvent3D.MOUSE_DOWN,this))},i.prototype.onStageEnd=function(){console.log("stage up"),this.stage.removeEventListener(t.MouseEvent3D.MOUSE_UP,this.onStageEnd,this),this._skin.removeEventListener(t.MouseEvent3D.MOUSE_UP,this.mouseEventHandler,this),this.setMouseState(i.STATE_UP),this._isDowning=!1},i.prototype.endPress=function(){this.dispatchEvent(new t.MouseEvent3D(t.MouseEvent3D.MOUSE_UP,this)),this.dispatchEvent(new t.MouseEvent3D(t.MouseEvent3D.MOUSE_CLICK,this)),this.setMouseState(i.STATE_UP),this._isDowning=!1,this.stage.removeEventListener(t.MouseEvent3D.MOUSE_UP,this.onStageEnd,this),this._skin.removeEventListener(t.MouseEvent3D.MOUSE_UP,this.mouseEventHandler,this),console.log("btn up")},Object.defineProperty(i.prototype,"enable",{get:function(){return this._enable},set:function(t){this._enable=t,this.mouseEnable=t},enumerable:!0,configurable:!0}),i.prototype.setMouseState=function(t){this._state!==t&&(this._state=t,this.onRender())},i.prototype.onRender=function(){this.drawBackground()},i.prototype.drawBackground=function(){var t=this.getStyle(this.enable?this._state:i.STATE_DISABLE);this._skin.texture=t},i.STATE_DOWN="down",i.STATE_UP="up",i.STATE_DISABLE="disable",i}(e.UIElement);e.UIButton=i;var r=function(){function t(){}return t.BOTTOM="bottom",t.TOP="top",t.LEFT="left",t.RIGHT="right",t}();e.ButtonLabelPlacement=r}(e=t.gui||(t.gui={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){!function(t){t[t.NONE=0]="NONE",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.CENTER=3]="CENTER"}(e.UITextFieldAutoSize||(e.UITextFieldAutoSize={}));var i=e.UITextFieldAutoSize;!function(t){t[t.DYNAMIC=0]="DYNAMIC",t[t.INPUT=1]="INPUT"}(e.UITextFieldType||(e.UITextFieldType={}));var r=e.UITextFieldType,a=function(){function t(){}return t}();!function(t){t[t.CENTER=0]="CENTER",t[t.JUSTIFY=1]="JUSTIFY",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT"}(e.UITextFormatAlign||(e.UITextFormatAlign={}));var n=(e.UITextFormatAlign,function(){function t(){}return t}());e.UITextFormat=n;var o=function(n){function o(e){void 0===e&&(e=r.DYNAMIC),n.call(this),this._textLineInfo=[],this._text="",this._maxChars=0,this._restrict="",this._textWidth=0,this._textLine=[],this._quadPool=[],this._textHeight=0,this._fontQuadLine=[],this._multiline=!1,this._selectable=!1,this._type=e,this._textColor=52224,this._selectionEndIndex=-1,this._selectionBeginIndex=-1,this._displayAsPassword=!1,this._autoSize=i.LEFT,this._fontQuadPanel=new t.DisplayObject,this._blankQuad=this.createFontQuad("b".charCodeAt(0),!1),o.sharedHTMLInputElement||(o.sharedHTMLInputElement=document.createElement("input"),o.sharedHTMLInputElement.style.width=this.width+"px",o.sharedHTMLInputElement.style.height=this.height+"px",o.sharedHTMLInputElement.hidden=!0,o.sharedHTMLInputElement.style.color="#00ff00",o.sharedHTMLInputElement.style.border="0px",o.sharedHTMLInputElement.style.backgroundColor="transparent",document.getElementById("egret3D").parentElement.appendChild(o.sharedHTMLInputElement)),o.sharedHTMLTextAreaElement||(o.sharedHTMLTextAreaElement=document.createElement("textarea"),o.sharedHTMLTextAreaElement.style.width=this.width+"px",o.sharedHTMLTextAreaElement.style.height=this.height+"px",o.sharedHTMLTextAreaElement.hidden=!0,o.sharedHTMLTextAreaElement.style.color="#00ff00",o.sharedHTMLTextAreaElement.style.paddingLeft="0px",o.sharedHTMLTextAreaElement.style.paddingTop="0px",o.sharedHTMLTextAreaElement.style.margin="0px",o.sharedHTMLTextAreaElement.style.backgroundColor="transparent",document.getElementById("egret3D").parentElement.appendChild(o.sharedHTMLTextAreaElement)),this._bgQuad=new t.Quad,r.INPUT==this._type&&(this._bgQuad.mouseEnable=!0,this._bgQuad.width=this.width,this._bgQuad.height=this.height,this.addChild(this._bgQuad),this._bgQuad.addEventListener(t.TouchEvent3D.TOUCH_START,this.onShowInputAgent,this),this._bgQuad.addEventListener(t.MouseEvent3D.MOUSE_CLICK,this.onShowInputAgent,this)),this.width=100,this.height=20,this.addChild(this._fontQuadPanel)}return __extends(o,n),o.prototype.onShowInputAgent=function(){var t=this;this._multiline?(o.sharedHTMLTextAreaElement.hidden=!1,o.sharedHTMLTextAreaElement.style.position="absolute",o.sharedHTMLTextAreaElement.style.left=this.x+"px",o.sharedHTMLTextAreaElement.style.top=this.y+"px",o.sharedHTMLTextAreaElement.style.width=this.width+"px",o.sharedHTMLTextAreaElement.style.height=this.height+"px",o.sharedHTMLTextAreaElement.value=this._text,o.sharedHTMLTextAreaElement.focus(),o.sharedHTMLTextAreaElement.onblur=function(e){return t.onSharedHTMLTextLoseFocus(e)}):(o.sharedHTMLInputElement.hidden=!1,o.sharedHTMLInputElement.style.position="absolute",o.sharedHTMLInputElement.style.left=this.x+"px",o.sharedHTMLInputElement.style.top=this.y+"px",o.sharedHTMLInputElement.style.width=this.width+"px",o.sharedHTMLInputElement.style.height=this.height+"px",o.sharedHTMLInputElement.value=this._text,o.sharedHTMLInputElement.focus(),o.sharedHTMLInputElement.onblur=function(e){return t.onSharedHTMLTextLoseFocus(e)}),this._fontQuadPanel.visible=!1},o.prototype.onSharedHTMLTextLoseFocus=function(){this.text=this._multiline?o.sharedHTMLTextAreaElement.value:o.sharedHTMLInputElement.value,o.sharedHTMLInputElement.onblur=o.sharedHTMLTextAreaElement.onblur=null,o.sharedHTMLInputElement.hidden=o.sharedHTMLTextAreaElement.hidden=!0,this._fontQuadPanel.visible=!0},Object.defineProperty(o.prototype,"width",{get:function(){return this._sca.z},set:function(t){t!=this._sca.z&&(this._fontQuadPanel.width=t,this._sca.z=t,this._transformChange=!0,this._bgQuad.width=t,this.refreshAlign())},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"height",{get:function(){return this._sca.w},set:function(t){t!=this._sca.w&&(this._fontQuadPanel.height=t,this._sca.w=t,this._transformChange=!0,this._bgQuad.height=t,this.refreshAlign())},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"displayAsPassword",{get:function(){return this._displayAsPassword},set:function(t){this._displayAsPassword=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"length",{get:function(){return this._text.length},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"maxChars",{get:function(){return this._maxChars},set:function(t){this._maxChars=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"multiline",{get:function(){return this._multiline},set:function(t){this._multiline=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"restrict",{get:function(){return this._restrict},set:function(t){this._restrict=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"selectable",{get:function(){return this._selectable},set:function(t){this._selectable=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"selectionBeginIndex",{get:function(){return this._selectionBeginIndex},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"selectionEndIndex",{get:function(){return this._selectionEndIndex},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"textColor",{get:function(){return this._textColor},set:function(t){this._textColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"textWidth",{get:function(){return this._textWidth},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"textHeight",{get:function(){return this._textHeight},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"text",{get:function(){return this._text},set:function(t){this.clearText(),this._text=t,this._textLine=t.split("\n"),this._multiline||(this._textLine[0]=this._textLine.join(""),this._textLine.length=1);for(var e=null,i=0;i<this._textLine.length;++i){var r=this._textLine[i];e=this.buildTextLineInfo(r),this._textLineInfo.push(e)}this.refreshAlign()},enumerable:!0,configurable:!0}),o.prototype.clearText=function(){for(var t=null,e=0;e<this._textLineInfo.length;++e){t=this._textLineInfo[e];for(var i=0;i<t.lineQuads.length;++i)this.deleteFontQuad(t.lineQuads[i]);t.lineQuads=null}this._textLineInfo=[]},Object.defineProperty(o.prototype,"autoSize",{get:function(){return this._autoSize},set:function(t){this._autoSize=t},enumerable:!0,configurable:!0}),o.prototype.refreshAlign=function(){var t,e,r=null,a=null;if(this._autoSize==i.LEFT){e=0,!this.multiline&&this._textLineInfo.length>=1&&(e=this.height/2-this._textLineInfo[0].lineHeight/2);for(var n=0;n<this._textLineInfo.length;++n){a=this._textLineInfo[n],t=0;for(var o=0;o<a.lineQuads.length;++o)r=a.lineQuads[o],r.x=t,r.y=e,t+=r.width,r.visible=r.x+r.width<=this.width;e+=a.lineHeight}}else if(this._autoSize==i.RIGHT){e=0,!this.multiline&&this._textLineInfo.length>=1&&(e=this.height/2-this._textLineInfo[0].lineHeight/2);for(var n=0;n<this._textLineInfo.length;++n){a=this._textLineInfo[n],t=this.width;for(var o=a.lineQuads.length-1;o>=0;--o)r=a.lineQuads[o],r.x=t-=r.width,r.y=e,r.visible=r.x+r.width>0;e+=a.lineHeight}}else if(this._autoSize==i.CENTER){e=0,!this.multiline&&this._textLineInfo.length>=1&&(e=this.height/2-this._textLineInfo[0].lineHeight/2);for(var n=0;n<this._textLineInfo.length;++n){a=this._textLineInfo[n],t=.5*this.width-.5*a.lineWidth;for(var o=0;o<a.lineQuads.length;++o)r=a.lineQuads[o],r.x=t,r.y=e,t+=r.width,r.visible=r.x+r.width<=this.width&&r.x+r.width>0;e+=a.lineHeight}}},o.prototype.buildTextLineInfo=function(t){var e=new a;e.lineText=t,e.lineWidth=0,e.lineHeight=0,e.lineQuads=[];for(var i=0;i<t.length;++i){var r=null,n=t.charCodeAt(i);r=32!=n?this.createFontQuad(n):this._blankQuad,e.lineQuads.push(r),e.lineWidth+=r.width,e.lineHeight<r.height&&(e.lineHeight=r.height)}return e},o.prototype.appendText=function(){},o.prototype.getCharBoundaries=function(){return null},o.prototype.getCharIndexAtPoint=function(){return 0},o.prototype.replaceSelectedText=function(){},o.prototype.replaceText=function(){},o.prototype.setSelection=function(){},o.prototype.onUpdate=function(){this.x+=1},o.prototype.createFontQuad=function(i,r){void 0===r&&(r=!0);var a;this._quadPool.length>0?(a=this._quadPool[this._quadPool.length-1],this._quadPool.splice(this._quadPool.length-1,1)):(a=new t.Quad,a.renderType=1);var n=e.BitmapFont.getTexture(i);return n||(n=e.BitmapFont.getTexture("?".charCodeAt(0))),a.width=n.width,a.height=n.height,a.texture=n,a.color=this._textColor,r&&this._fontQuadPanel.addChild(a),a},o.prototype.deleteFontQuad=function(t){this._blankQuad!=t&&(this._fontQuadPanel.removeChild(t),this._quadPool.push(t))},o}(t.DisplayObject);e.UITextField=o}(e=t.gui||(t.gui={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(e){function i(){e.call(this),this._label="",this._textField=new t.UITextField,this._textField.autoSize=t.UITextFieldAutoSize.CENTER,this.addChild(this._textField),this.onRender(),this._textHeight=-1,this._textWidth=-1}return __extends(i,e),Object.defineProperty(i.prototype,"textHeight",{get:function(){return this._textHeight},set:function(t){this._textHeight=t,this.onRender()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"textWidth",{get:function(){return this._textWidth},set:function(t){this._textWidth=t,this.onRender()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"textField",{get:function(){return this._textField},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"label",{get:function(){return this._label},set:function(t){this._label=t,this._textField.text=this._label},enumerable:!0,configurable:!0}),i.prototype.onRender=function(){e.prototype.onRender.call(this),this._textHeight>0?this.textField.textHeight=this._textHeight:this._textField.height=this._skin.height,this._textWidth>0?this.textField.textWidth=this._textWidth:this._textField.width=this._skin.width
},i}(t.UIButton);t.UILabelButton=e}(e=t.gui||(t.gui={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var i=function(i){function r(){i.call(this),this._selected=!1,this._textPadding=5,this.textField.autoSize=e.UITextFieldAutoSize.LEFT,this.textWidth=45,this.onRender()}return __extends(r,i),Object.defineProperty(r.prototype,"buttonAndLabelWidth",{get:function(){return this._skin.width+this.textPadding+this.textWidth},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"textPadding",{get:function(){return this._textPadding},set:function(t){this._textPadding=t,this.onRender()},enumerable:!0,configurable:!0}),r.prototype.onRender=function(){i.prototype.onRender.call(this),this.textField.x=this._skin.width+this._textPadding},Object.defineProperty(r.prototype,"selected",{get:function(){return this._selected},set:function(i){if(this._selected!==i){this._selected=i,this.setMouseState(this._selected?r.STATE_UP_AND_SELECTED:e.UIButton.STATE_UP);var a=new t.Event3D(t.Event3D.CHANGE);a.target=this,this.dispatchEvent(a)}},enumerable:!0,configurable:!0}),r.prototype.setMouseState=function(t){t===e.UIButton.STATE_DOWN?this._selected?i.prototype.setMouseState.call(this,r.STATE_DOWN_AND_SELECTED):i.prototype.setMouseState.call(this,e.UIButton.STATE_DOWN):t===e.UIButton.STATE_UP?this._selected?i.prototype.setMouseState.call(this,r.STATE_UP_AND_SELECTED):i.prototype.setMouseState.call(this,e.UIButton.STATE_UP):i.prototype.setMouseState.call(this,t)},r.prototype.startPress=function(){i.prototype.startPress.call(this),this.setMouseState(this._selected?r.STATE_DOWN_AND_SELECTED:e.UIButton.STATE_DOWN)},r.prototype.endPress=function(){i.prototype.endPress.call(this),this.selected=!this.selected,this.setMouseState(this._selected?r.STATE_UP_AND_SELECTED:e.UIButton.STATE_UP)},r.STATE_DOWN_AND_SELECTED="downAndSelected",r.STATE_UP_AND_SELECTED="upAndSelected",r}(e.UILabelButton);e.UIToggleButtonBase=i}(e=t.gui||(t.gui={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var i=function(i){function r(){i.call(this),this._background=new t.Quad,this._container=new e.UIElement,i.prototype.addChild.call(this,this._background),i.prototype.addChild.call(this,this._container),this._w=100,this._h=100,this.updateMask()}return __extends(r,i),r.prototype.updateMask=function(){this.mask=new t.Rectangle(0,0,this._w,this._h)},Object.defineProperty(r.prototype,"background",{get:function(){return this._background},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"width",{get:function(){return this._w},set:function(t){this._w=t,this._background.width=t,this.updateMask()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._h},set:function(t){this._h=t,this._background.height=t,this.updateMask()},enumerable:!0,configurable:!0}),r.prototype.onRender=function(){i.prototype.onRender.call(this),this.drawBackground(),this.updateMask()},r.prototype.drawBackground=function(){var t=this.getStyle("background");this._background.texture=t},r.prototype.setStyle=function(t,e){i.prototype.setStyle.call(this,t,e),this.onRender()},r.prototype.addChild=function(t){return this._container.addChild(t)},r.prototype.addChildAt=function(t,e){return this._container.addChildAt(t,e)},r.prototype.removeChild=function(t){return this._container.removeChild(t)},r.prototype.removeChildAt=function(t){return this._container.removeChildAt(t)},r.prototype.swapChildIndex=function(t,e){this._container.swapChildIndex(t,e)},r.prototype.hasChild=function(t){return this._container.hasChild(t)},r.prototype.getChildByIndex=function(t){return this._container.getChildByIndex(t)},r.prototype.getChildByName=function(t){return this._container.getChildByName(t)},r}(e.UIElement);e.UIPanel=i}(e=t.gui||(t.gui={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this),this._items=[],this._gap=5,this._selectedIndex=-1,this._selectedItem=null,this._background.addEventListener(t.MouseEvent3D.MOUSE_DOWN,this.onMouseDown,this),this._background.addEventListener(t.MouseEvent3D.MOUSE_UP,this.onMouseUp,this),this._background.addEventListener(t.MouseEvent3D.MOUSE_MOVE,this.onMouseMove,this),this._startDrag=!1,this._container.height=0}return __extends(i,e),i.prototype.onMouseDown=function(){this._startDrag=!0,console.log("mousedown")},i.prototype.onMouseUp=function(){this._startDrag=!1,console.log("mouseup")},i.prototype.onMouseMove=function(){this._startDrag&&(this._container.y+=t.Input.mouseOffsetY,this._container.y>0?this._container.y=0:this._containerHeight<this.height?this._container.y=0:this._container.y<this.height-this._containerHeight&&(this._container.y=this.height-this._containerHeight))},i.prototype.updateView=function(){for(var t=0,e=0;e<this._items.length;e++){var i=this._items[e];i.y=t,t=i.y+i.height+this._gap}this._containerHeight=t},Object.defineProperty(i.prototype,"gap",{get:function(){return this._gap},set:function(t){this._gap=t,this.updateView()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"selectedIndex",{get:function(){return this._selectedIndex},set:function(t){this._selectedIndex=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"selectedItem",{get:function(){return this._selectedItem},set:function(t){this._selectedItem=t},enumerable:!0,configurable:!0}),i.prototype.addItem=function(e){this._items.push(e),this.addChildAt(e,this._container.childs.length),e.addEventListener(t.MouseEvent3D.MOUSE_DOWN,function(){console.log("aaaaaa")},this),e.addEventListener(t.MouseEvent3D.MOUSE_DOWN,this.onMouseDown,this),e.addEventListener(t.MouseEvent3D.MOUSE_UP,this.onMouseUp,this),e.addEventListener(t.MouseEvent3D.MOUSE_MOVE,this.onMouseMove,this),this.updateView()},i.prototype.removeItem=function(e){this.removeChild(e),this._items.splice(this._items.indexOf(e),1),e.removeEventListener(t.MouseEvent3D.MOUSE_DOWN,this.onMouseDown,this),e.removeEventListener(t.MouseEvent3D.MOUSE_UP,this.onMouseUp,this),e.removeEventListener(t.MouseEvent3D.MOUSE_MOVE,this.onMouseMove,this),this.updateView()},i}(t.gui.UIPanel);e.UIList=i}(e=t.gui||(t.gui={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var i=function(t){function e(){t.call(this)}return __extends(e,t),e}(t.gui.UILabelButton);e.UIToggleButton=i}(e=t.gui||(t.gui={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e}(t.UIToggleButtonBase);t.UICheckBox=e}(e=t.gui||(t.gui={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),Object.defineProperty(e.prototype,"group",{set:function(t){this._group=t},enumerable:!0,configurable:!0}),e}(t.UIToggleButtonBase);t.UIRadioButton=e}(e=t.gui||(t.gui={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this),this._items=[],this._enable=!0}return __extends(i,e),Object.defineProperty(i.prototype,"enable",{get:function(){return this._enable},set:function(t){if(this._enable!==t){this._enable=t;for(var e=0;e<this._items.length;e++){var i=this._items[e];i.enable=t}}},enumerable:!0,configurable:!0}),i.prototype.addItem=function(e){this._items.push(e),e.enable=this._enable,e.addEventListener(t.Event3D.CHANGE,this.onItemChange,this)},i.prototype.removeItem=function(e){var i=this._items.indexOf(e);-1!==i&&(e.removeEventListener(t.Event3D.CHANGE,this.onItemChange,this),this._items.splice(i,1))},i.prototype.getRadioButtonAt=function(t){return this._items[t]},i.prototype.onItemChange=function(e){var i=e.target;if(i.selected!==!1&&this._selection!==i){this._selection&&(this._selection.selected=!1),this._selection=i;var r=new t.Event3D(t.Event3D.CHANGE);r.target=this,this.dispatchEvent(r)}},i}(t.EventDispatcher);e.UIRadioButtonGroup=i}(e=t.gui||(t.gui={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this),this._mask=new t.Rectangle,this._background=new t.Quad,this.addChild(this._background),this._bar=new t.Quad,this.addChild(this._bar),this._ratio=.5}return __extends(i,e),Object.defineProperty(i.prototype,"ratio",{get:function(){return this._ratio},set:function(t){t>1?t=1:0>t&&(t=0),this._ratio=t,this.updateBar()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{set:function(t){this._background.width=this._bar.width=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{set:function(t){this._background.height=this._bar.height=t},enumerable:!0,configurable:!0}),i.prototype.setBarRect=function(t,e,i,r){this._bar.x=t,this._bar.y=e,this._bar.width=i,this._bar.height=r},Object.defineProperty(i.prototype,"bar",{get:function(){return this._bar},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"background",{get:function(){return this._background},enumerable:!0,configurable:!0}),i.prototype.updateBar=function(){this._mask.width=this._ratio*this._bar.width,this._mask.height=this._bar.height,this._bar.mask=this._mask},i.prototype.setStyle=function(t,i){e.prototype.setStyle.call(this,t,i),this.updateStyle(),this.updateBar()},i.prototype.updateStyle=function(){this._background.texture=this.getStyle("background"),this._bar.texture=this.getStyle("bar")},i}(e.UIElement);e.UIProgressBar=i}(e=t.gui||(t.gui={}))}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t.pointlight=0]="pointlight",t[t.directlight=1]="directlight",t[t.spotLightlight=2]="spotLightlight"}(t.LightType||(t.LightType={}));var e=(t.LightType,function(e){function i(){e.call(this),this.lightId=-1,this.lightType=-1,this._ambient=new t.Vector3D(0,0,0),this._diffuse=new t.Vector3D(1,1,1),this._specular=new t.Vector3D(1,1,1),this._halfVector=new t.Vector3D(1,1,1),this._intensity=1,this._radius=100,this._cutoff=.01,this._halfIntensity=0,this._spotExponent=1.1,this._spotCutoff=.7,this._spotCosCutoff=.1,this._constantAttenuation=.1,this._linearAttenuation=.1,this._quadraticAttenuation=.1,this._lightIndex=-1,this.len=25,this._change=!0,this.lightViewPos=new t.Vector3D}return __extends(i,e),Object.defineProperty(i.prototype,"intensity",{get:function(){return this._intensity},set:function(t){this._intensity!=t&&(this._intensity=t,this._change=!1)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"halfIntensity",{get:function(){return this._halfIntensity},set:function(t){this._halfIntensity!=t&&(this._halfIntensity=t,this._change=!1)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"ambient",{get:function(){return 0},set:function(t){this._ambient.w=(t>>24&255)/255,this._ambient.x=(t>>16&255)/255,this._ambient.y=(t>>8&255)/255,this._ambient.z=(255&t)/255,this._change=!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"diffuse",{get:function(){return 0},set:function(t){this._diffuse.w=(t>>24&255)/255,this._diffuse.x=(t>>16&255)/255,this._diffuse.y=(t>>8&255)/255,this._diffuse.z=(255&t)/255,this._change=!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"specular",{get:function(){return 0},set:function(t){this._specular.w=(t>>24&255)/255,this._specular.x=(t>>16&255)/255,this._specular.y=(t>>8&255)/255,this._specular.z=(255&t)/255,this._change=!1},enumerable:!0,configurable:!0}),i.prototype.init=function(){},i.prototype.updateLightData=function(){},i}(t.Object3D));t.LightBase=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this),this.scenePosMat=new t.Matrix4_4,this.lightType=t.LightType.pointlight,this.diffuse=i}return __extends(i,e),Object.defineProperty(i.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cutoff",{get:function(){return this._cutoff},set:function(t){this._cutoff=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"ambient",{set:function(t){this._ambient.w=(t>>24&255)/255,this._ambient.x=(t>>16&255)/255,this._ambient.y=(t>>8&255)/255,this._ambient.z=(255&t)/255,this._change=!1},enumerable:!0,configurable:!0}),i.prototype.updateLightData=function(t,e,r){r[e*i.stride]=this.globalPosition.x,r[e*i.stride+1]=this.globalPosition.y,r[e*i.stride+2]=this.globalPosition.z,r[e*i.stride+3]=this._diffuse.x*this._intensity,r[e*i.stride+4]=this._diffuse.y*this._intensity,r[e*i.stride+5]=this._diffuse.z*this._intensity,r[e*i.stride+6]=this._ambient.x,r[e*i.stride+7]=this._ambient.y,r[e*i.stride+8]=this._ambient.z,r[e*i.stride+9]=this._intensity,r[e*i.stride+10]=this._radius,r[e*i.stride+11]=this._cutoff},i.scenePos=new t.Vector3D,i.stride=12,i}(t.LightBase);t.PointLight=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this),this.diffuse=i,this.lightType=t.LightType.spotLightlight}return __extends(i,e),Object.defineProperty(i.prototype,"spotCosCutoff",{get:function(){return this._spotCosCutoff},set:function(t){this._spotCosCutoff=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"spotExponent",{get:function(){return this._spotExponent},set:function(t){this._spotExponent=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"constantAttenuation",{get:function(){return this._constantAttenuation},set:function(t){this._constantAttenuation=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"linearAttenuation",{get:function(){return this._linearAttenuation},set:function(t){this._linearAttenuation=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"quadraticAttenuation",{get:function(){return this._quadraticAttenuation},set:function(t){this._quadraticAttenuation=t},enumerable:!0,configurable:!0}),i.prototype.updateLightData=function(e,r,a){a[r*i.stride]=this.globalPosition.x,a[r*i.stride+1]=this.globalPosition.y,a[r*i.stride+2]=this.globalPosition.z,a[r*i.stride+3]=this.globalRotation.x*t.MathUtil.DEGREES_TO_RADIANS,a[r*i.stride+4]=this.globalRotation.y*t.MathUtil.DEGREES_TO_RADIANS,a[r*i.stride+5]=this.globalRotation.z*t.MathUtil.DEGREES_TO_RADIANS,a[r*i.stride+6]=this._diffuse.x,a[r*i.stride+7]=this._diffuse.y,a[r*i.stride+8]=this._diffuse.z,a[r*i.stride+9]=this._spotExponent,a[r*i.stride+10]=this._spotCosCutoff,a[r*i.stride+11]=this._constantAttenuation,a[r*i.stride+12]=this._linearAttenuation,a[r*i.stride+13]=this._quadraticAttenuation},i.stride=14,i}(t.LightBase);t.SpotLight=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this),this._dir=new t.Vector3D(0,0,1),this._dir.copyFrom(i),this._dir.normalize(),t.Quaternion.fromToRotation(t.Vector3D.Z_AXIS,this._dir,t.Quaternion.HELP_0),this.orientation=t.Quaternion.HELP_0;var r=new t.Vector3D;this.orientation.transformVector(t.Vector3D.Z_AXIS,r),this.lightType=t.LightType.directlight}return __extends(i,e),Object.defineProperty(i.prototype,"ambient",{set:function(t){this._ambient.w=(t>>24&255)/255,this._ambient.x=(t>>16&255)/255,this._ambient.y=(t>>8&255)/255,this._ambient.z=(255&t)/255,this._change=!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"dir",{get:function(){return this._transformChange&&this.modelMatrix,this._dir},set:function(e){this._dir.copyFrom(e),this._dir.normalize(),t.Quaternion.fromToRotation(t.Vector3D.Z_AXIS,this._dir,t.Quaternion.HELP_0),this.orientation=t.Quaternion.HELP_0},enumerable:!0,configurable:!0}),i.prototype.onUpdateTransform=function(){e.prototype.onUpdateTransform.call(this),this.orientation.transformVector(t.Vector3D.Z_AXIS,this._dir),this._dir.normalize(),this.parent&&(this.parent.globalOrientation.transformVector(this._dir,this._dir),this._dir.normalize())},i.prototype.updateLightData=function(t,e,r){r[e*i.stride+0]=this._dir.x,r[e*i.stride+1]=this._dir.y,r[e*i.stride+2]=this._dir.z,r[e*i.stride+3]=this._diffuse.x*this._intensity,r[e*i.stride+4]=this._diffuse.y*this._intensity,r[e*i.stride+5]=this._diffuse.z*this._intensity,r[e*i.stride+6]=this._ambient.x,r[e*i.stride+7]=this._ambient.y,r[e*i.stride+8]=this._ambient.z},i.stride=9,i}(t.LightBase);t.DirectLight=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.lightNum=0,this.directLightList=new Array,this.spotLightList=new Array,this.pointLightList=new Array}return e.prototype.addLight=function(e){switch(e.lightType){case t.LightType.directlight:this.directLightList.push(e),this.lightNum++;break;case t.LightType.pointlight:this.pointLightList.push(e),this.lightNum++;break;case t.LightType.spotLightlight:this.spotLightList.push(e),this.lightNum++}},e.prototype.removeLight=function(e){switch(e.lightType){case t.LightType.directlight:var i=this.directLightList.indexOf(e);i>=0&&i<this.directLightList.length&&(this.directLightList.splice(i,1),this.lightNum--);break;case t.LightType.pointlight:var i=this.pointLightList.indexOf(e);i>=0&&i<this.pointLightList.length&&(this.pointLightList.splice(i,1),this.lightNum--);break;case t.LightType.spotLightlight:var i=this.spotLightList.indexOf(e);i>=0&&i<this.spotLightList.length&&(this.spotLightList.splice(i,1),this.lightNum--)}},e}();t.LightGroup=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){this._num=0,this._objDict={},this.renderList=new Array,this.mousePickList=new Array,this._nodes=new Array}return Object.defineProperty(t.prototype,"root",{get:function(){return this.rootScene},set:function(t){this.rootScene=t},enumerable:!0,configurable:!0}),t.prototype.update=function(t){t.modelMatrix,this.renderList=this._nodes,this.renderList.length=0},t.prototype.findRenderObject=function(t){for(var e=0;e<this.renderList.length;++e)if(this.renderList[e]===t)return e;return-1},t}();t.CollectBase=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.softRenderItems={},this.numberVertex=0,this.numberFace=0,this.numberDraw=0,this.numberSkin=0,this.numberAnimation=0,this.numberParticle=0}return __extends(i,e),i.prototype.applyRender=function(t,e){if(t.visible){t.material&&this.addRenderList(t,e);for(var i=0;i<t.childs.length;i++)this.applyRender(t.childs[i],e)}},i.prototype.addRenderList=function(e,i,r){if(void 0===r&&(r=!0),!e.enableCulling||!r||i.isVisibleToCamera(e)){if(e.material){if("normalObject"==e.tag.name&&e.material.materialData.alphaBlending)this.softRenderItems.alphaObject.push(e);else for(var a=0;a<t.Layer.layerType.length;a++)e.tag.name==t.Layer.layerType[a]&&this.softRenderItems[t.Layer.layerType[a]].push(e);t.Egret3DEngine.instance.debug&&(this.numberFace+=e.geometry.faceCount,this.numberVertex+=e.geometry.vertexCount,this.numberDraw+=1,e.animation&&(this.numberSkin+=1),e.proAnimation&&(this.numberAnimation+=1),"particleEmit"==e.type&&(this.numberParticle+=1))}e.enablePick&&this.mousePickList.push(e)}},i.prototype.update=function(i){if(e.prototype.update.call(this,i),this.numberFace=0,this.numberVertex=0,this.numberDraw=0,this.numberSkin=0,this.numberAnimation=0,this.numberParticle=0,this.clearLayerList(),this.renderList.length=0,this.mousePickList.length=0,this.rootScene.quad){var r=i.frustum.box,a=this.rootScene.quad.getNodesByAABB(r.min.x,r.min.y,r.max.x,r.max.y);this.appendQuadList(a,i)}else this.applyRender(this.rootScene.root,i);for(var n,o=0;o<t.Layer.layerType.length;o++){n=this.softRenderItems[t.Layer.layerType[o]].length,this.softRenderItems[t.Layer.layerType[o]].sort(this.sortByOrder);for(var s=0;n>s;s++)this.renderList.push(this.softRenderItems[t.Layer.layerType[o]][s])}},i.prototype.appendQuadList=function(e,i){for(var r,a,n=0,o=e;n<o.length;n++)a=o[n],a instanceof t.Mesh&&(r=a,r&&r.visible&&r.material&&this.addRenderList(r,i,!1))},i.prototype.clearLayerList=function(){for(var e=0;e<t.Layer.layerType.length;e++)this.softRenderItems[t.Layer.layerType[e]]?this.softRenderItems[t.Layer.layerType[e]].length=0:this.softRenderItems[t.Layer.layerType[e]]=[]},i.prototype.sort=function(e,i,r){var a=t.Vector3D.distance(e.globalPosition,r.position),n=t.Vector3D.distance(i.globalPosition,r.position);return a>n?-1:n>a?1:0},i.prototype.sortByOrder=function(t,e){return e.drawOrder-t.drawOrder},i}(t.CollectBase);t.EntityCollect=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e){void 0===e&&(e=null),this._vtxNum=8,this._planeNum=6,this._frustum=new t.Wireframe,this.nearCenter=new t.Vector3D,this.farCenter=new t.Vector3D,this._tempVector=new t.Vector3D,this.camera=e,this._vertex=new Array;for(var i=0;i<this._vtxNum;++i)this._vertex.push(new t.Vector3D);this._tempVertices=new Array;for(var i=0;i<this._vtxNum;++i)this._tempVertices.push(new t.Vector3D);this._pos=new t.Vector3D,this._plane=new Array;for(var i=0;6>i;++i)this._plane.push(new t.Plane3D);this.box=new t.BoundBox(null,new t.Vector3D,new t.Vector3D),this.center=new t.Vector3D,this._frustum.material.diffuseColor=16777215,this._frustum.name="CameraFrustum",this._frustum.geometry.vertexCount=8,this._frustum.geometry.indexCount=24,this._frustum.geometry.setVertexIndices(0,[0,1,1,2,2,3,0,3,4,5,5,6,6,7,4,7,0,4,1,5,3,7,2,6])}return Object.defineProperty(e.prototype,"vertices",{get:function(){return this._vertex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wireframe",{get:function(){return this._frustum},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return this._frustum.parent?!0:!1},set:function(t){t?this._frustum.parent||this.camera.addChild(this._frustum):this._frustum.parent&&this._frustum.parent.removeChild(this._frustum)},enumerable:!0,configurable:!0}),e.prototype.makeFrustum=function(t,e,i,r){var a=Math.tan(t/2*(Math.PI/180)),n=i*a,o=n*e,s=r*a,h=s*e;this._vertex[0].x=o,this._vertex[0].y=n,this._vertex[0].z=i,this._vertex[1].x=-o,this._vertex[1].y=n,this._vertex[1].z=i,this._vertex[2].x=-o,this._vertex[2].y=-n,this._vertex[2].z=i,this._vertex[3].x=o,this._vertex[3].y=-n,this._vertex[3].z=i,this._vertex[4].x=h,this._vertex[4].y=s,this._vertex[4].z=r,this._vertex[5].x=-h,this._vertex[5].y=s,this._vertex[5].z=r,this._vertex[6].x=-h,this._vertex[6].y=-s,this._vertex[6].z=r,this._vertex[7].x=h,this._vertex[7].y=-s,this._vertex[7].z=r},e.prototype.makeOrthoFrustum=function(t,e,i,r){this._vertex[0].x=t/2,this._vertex[0].y=e/2,this._vertex[0].z=i,this._vertex[1].x=-t/2,this._vertex[1].y=e/2,this._vertex[1].z=i,this._vertex[2].x=-t/2,this._vertex[2].y=-e/2,this._vertex[2].z=i,this._vertex[3].x=t/2,this._vertex[3].y=-e/2,this._vertex[3].z=i,this._vertex[4].x=t/2,this._vertex[4].y=e/2,this._vertex[4].z=r,this._vertex[5].x=-t/2,this._vertex[5].y=e/2,this._vertex[5].z=r,this._vertex[6].x=-t/2,this._vertex[6].y=-e/2,this._vertex[6].z=r,this._vertex[7].x=t/2,this._vertex[7].y=-e/2,this._vertex[7].z=r},e.prototype.makeOrthoToCenterFrustum=function(t,e,i,r,a,n){this._vertex[0].x=e,this._vertex[0].y=r,this._vertex[0].z=a,this._vertex[1].x=t,this._vertex[1].y=r,this._vertex[1].z=a,this._vertex[2].x=t,this._vertex[2].y=i,this._vertex[2].z=a,this._vertex[3].x=e,this._vertex[3].y=i,this._vertex[3].z=a,this._vertex[4].x=e,this._vertex[4].y=r,this._vertex[4].z=n,this._vertex[5].x=t,this._vertex[5].y=r,this._vertex[5].z=n,this._vertex[6].x=t,this._vertex[6].y=i,this._vertex[6].z=n,this._vertex[7].x=e,this._vertex[7].y=i,this._vertex[7].z=n},e.prototype.updateFrustum=function(){switch(this.camera.cameraType){case t.CameraType.perspective:this.makeFrustum(this.camera.fieldOfView,this.camera.aspectRatio,this.camera.near,this.camera.far);break;case t.CameraType.orthogonal:this.makeOrthoFrustum(this.camera.viewPort.width,this.camera.viewPort.height,this.camera.near,this.camera.far);break;case t.CameraType.orthogonalToCenter:this.makeOrthoToCenterFrustum(this.camera.viewPort.x,this.camera.viewPort.y,this.camera.viewPort.width,this.camera.viewPort.height,this.camera.near,this.camera.far)}for(var e=0;e<this.vertices.length;++e)this._frustum.geometry.setVerticesForIndex(e,t.VertexFormat.VF_POSITION,[this.vertices[e].x,this.vertices[e].y,this.vertices[e].z],1)},e.prototype.update=function(){var e=t.Matrix4_4.helpMatrix;e.copyFrom(this.camera.modelMatrix);for(var i=0;i<this._vtxNum;++i)e.transformVector(this._vertex[i],this._tempVertices[i]);this.box.max.x=this.box.max.y=this.box.max.z=-t.MathUtil.MAX_VALUE,this.box.min.x=this.box.min.y=this.box.min.z=t.MathUtil.MAX_VALUE;for(var i=0;i<this._tempVertices.length;++i)this.box.max.x<this._tempVertices[i].x&&(this.box.max.x=this._tempVertices[i].x),this.box.max.y<this._tempVertices[i].y&&(this.box.max.y=this._tempVertices[i].y),this.box.max.z<this._tempVertices[i].z&&(this.box.max.z=this._tempVertices[i].z),this.box.min.x>this._tempVertices[i].x&&(this.box.min.x=this._tempVertices[i].x),this.box.min.y>this._tempVertices[i].y&&(this.box.min.y=this._tempVertices[i].y),this.box.min.z>this._tempVertices[i].z&&(this.box.min.z=this._tempVertices[i].z);this.box.calculateBox(),this._plane[0].fromPoints(this._tempVertices[4],this._tempVertices[5],this._tempVertices[6]),this._plane[1].fromPoints(this._tempVertices[1],this._tempVertices[6],this._tempVertices[5]),this._plane[2].fromPoints(this._tempVertices[0],this._tempVertices[4],this._tempVertices[7]),this._plane[3].fromPoints(this._tempVertices[1],this._tempVertices[0],this._tempVertices[3]),this._plane[4].fromPoints(this._tempVertices[1],this._tempVertices[5],this._tempVertices[4]),this._plane[5].fromPoints(this._tempVertices[3],this._tempVertices[7],this._tempVertices[6]);for(var i=0;i<this._planeNum;i++)this._plane[i].normalize();this.nearCenter.copyFrom(this._tempVertices[0].subtract(this._tempVertices[2])),this.nearCenter.scaleBy(.5),this.nearCenter.copyFrom(this._tempVertices[2].add(this.nearCenter)),this.farCenter.copyFrom(this._tempVertices[4].subtract(this._tempVertices[6])),this.farCenter.scaleBy(.5),this.farCenter.copyFrom(this._tempVertices[6].add(this.farCenter)),this.center.copyFrom(this.farCenter.subtract(this.nearCenter)),this.center.scaleBy(.5),this.center.copyFrom(this.nearCenter.add(this.center))},e.prototype.inPoint=function(t){for(var e=0,i=0;i<this._plane.length;++i)if(e=this._plane[i].distance(t),e>0)return!1;return!0},e.prototype.inSphere=function(t,e){for(var i=0,r=0;r<this._plane.length;++r)if(i=this._plane[r].distance(t),i>e)return!1;return!0},e.prototype.inBox=function(t){for(var e=0,i=this._plane.length,r=0;i>r;++r){for(var a=t.vexData.length/3,n=t.vexData.length,o=0;n>o;o+=3)this._tempVector.setTo(t.vexData[o],t.vexData[o+1],t.vexData[o+2]),this._tempVector.copyFrom(t.transform.transformVector(this._tempVector)),e=this._plane[r].distance(this._tempVector),e>0&&a--;if(0>=a)return!1}return!0},e}();t.Frustum=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){}return t.layerType=["normalObject","normalAlphaObject","alphaObject","decal","effect","gui"],t.layerTypeThan=[3,2,1,0],t.layerNumber=5,t}();t.Layer=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){this.name="normalObject",this.clearDepth=!1}return t}();t.Tag=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.pickObject3DList=function(e,i,r,a,n){void 0===a&&(a=!1),void 0===n&&(n=null),n||(n=new Array),n.length=0;var o=this.ray;if(t.Input.mouseX<i.x||t.Input.mouseX>s+i.width||t.Input.mouseY<i.y||t.Input.mouseY>h+i.height)return n;var s=t.Input.mouseX-i.x,h=t.Input.mouseY-i.y;o.CalculateAndTransformRay(i.width,i.height,i.camera3D.modelMatrix,i.camera3D.projectMatrix,s,h);for(var l=0;l<r.length;++l){var u=r[l];switch(new t.Vector3D,u.pickType){case t.PickType.BoundPick:if(null!=u.bound){var c=u.bound;a?(c=u.currentBound,c&&o.IntersectMesh(c.vexData,c.indexData,c.vexLength,c.indexData.length/3,0,u.modelMatrix,u.pickResult)&&n.push(r[l])):o.IntersectMesh(c.vexData,c.indexData,c.vexLength,c.indexData.length/3,0,u.modelMatrix,u.pickResult)&&n.push(r[l])}break;case t.PickType.PositionPick:var d=0;u.geometry.vertexFormat&t.VertexFormat.VF_POSITION&&(d+=t.Geometry.positionSize),u.geometry.vertexFormat&t.VertexFormat.VF_NORMAL&&(d+=t.Geometry.normalSize),u.geometry.vertexFormat&t.VertexFormat.VF_TANGENT&&(d+=t.Geometry.tangentSize),u.geometry.vertexFormat&t.VertexFormat.VF_COLOR&&(d+=t.Geometry.colorSize),o.IntersectMeshEx(u,d,u.pickResult)&&n.push(r[l]);break;case t.PickType.UVPick:var d=0;u.geometry.vertexFormat&t.VertexFormat.VF_POSITION&&(d+=t.Geometry.positionSize),u.geometry.vertexFormat&t.VertexFormat.VF_NORMAL&&(d+=t.Geometry.normalSize),u.geometry.vertexFormat&t.VertexFormat.VF_TANGENT&&(d+=t.Geometry.tangentSize),u.geometry.vertexFormat&t.VertexFormat.VF_COLOR&&(d+=t.Geometry.colorSize),o.IntersectMeshEx(u,d,u.pickResult)&&n.push(r[l])}}return n},e.ray=new t.Ray,e}();t.Picker=e}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t.normal_geometry=0]="normal_geometry",t[t.skin_geometry=1]="skin_geometry",t[t.particle_geometry=2]="particle_geometry"}(t.GeometryType||(t.GeometryType={})),t.GeometryType,!function(t){t[t.VF_POSITION=1]="VF_POSITION",t[t.VF_NORMAL=2]="VF_NORMAL",t[t.VF_TANGENT=4]="VF_TANGENT",t[t.VF_COLOR=8]="VF_COLOR",t[t.VF_UV0=16]="VF_UV0",t[t.VF_UV1=32]="VF_UV1",t[t.VF_SKIN=64]="VF_SKIN",t[t.VF_UVREC=128]="VF_UVREC",t[t.VF_ROTATION=256]="VF_ROTATION",t[t.VF_SIZE=512]="VF_SIZE",t[t.VF_SCALE=1024]="VF_SCALE",t[t.VF_QUADPOS=2048]="VF_QUADPOS",t[t.VF_QUADOFFSET=4096]="VF_QUADOFFSET",t[t.VF_QUAD_COLOR=8192]="VF_QUAD_COLOR"}(t.VertexFormat||(t.VertexFormat={}));var e=t.VertexFormat,i=function(){function i(){this.geomtryType=-1,this.drawType=t.Context3DProxy.gl.STATIC_DRAW,this._vertexFormat=0,this.vertexAttLength=0,this.faceOrBack=!1,this.subGeometrys=new Array,this._bufferDiry=!0,this._vertexCount=0,this._indexCount=0,this._totalIndexCount=0,this._faceCount=0}return Object.defineProperty(i.prototype,"bufferDiry",{get:function(){return this._bufferDiry},set:function(t){this._bufferDiry=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"skeleton",{get:function(){return this._skeleton},set:function(t){if(t){this._skeleton=t,this.skeletonGPUData=new Float32Array(8*t.jointNum);for(var e=0;e<t.jointNum;++e)this.skeletonGPUData[8*e+3]=1,this.skeletonGPUData[8*e+7]=1}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vertexCount",{get:function(){return this._vertexCount},set:function(t){if(this._vertexCount!=t){var e=t*this.vertexAttLength,i=null;this.vertexArray?this.vertexCount<t?(i=new Float32Array(e),i.set(this.vertexArray),delete this.vertexArray):i=this.vertexArray:i=new Float32Array(e),this.vertexArray=i,this._vertexCount=t}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"indexCount",{get:function(){return this._indexCount},set:function(t){if(this._indexCount=t,this._faceCount=t/3,!(this._totalIndexCount>=t)){var e=new Uint16Array(t);this.indexArray&&(e.set(this.indexArray),delete this.indexArray),this.indexArray=e,this._totalIndexCount=t}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"faceCount",{get:function(){return this._faceCount},set:function(t){this._faceCount!=t&&(this.indexCount=3*t,this._faceCount=t)},enumerable:!0,configurable:!0}),i.prototype.buildDefaultSubGeometry=function(){var e=new t.SubGeometry;e.matID=0,e.geometry=this,e.start=0,e.count=this.indexCount,this.subGeometrys.push(e)},Object.defineProperty(i.prototype,"vertexFormat",{get:function(){return this._vertexFormat},set:function(r){this._vertexFormat=r,this.vertexFormat&e.VF_POSITION&&(this.vertexAttLength+=i.positionSize),this.vertexFormat&e.VF_NORMAL&&(this.vertexAttLength+=i.normalSize),this.vertexFormat&e.VF_TANGENT&&(this.vertexAttLength+=i.tangentSize),this.vertexFormat&e.VF_COLOR&&(this.vertexAttLength+=i.colorSize),this.vertexFormat&e.VF_UV0&&(this.vertexAttLength+=i.uvSize),this.vertexFormat&e.VF_UV1&&(this.vertexAttLength+=i.uv2Size),this.vertexFormat&e.VF_SKIN&&(this.vertexAttLength+=i.skinSize),this.vertexFormat&e.VF_UVREC&&(this.vertexAttLength+=t.QuadData.uvRectangleSize),this.vertexFormat&e.VF_ROTATION&&(this.vertexAttLength+=t.QuadData.rotationSize),this.vertexFormat&e.VF_SIZE&&(this.vertexAttLength+=t.QuadData.offsetSize),this.vertexFormat&e.VF_SCALE&&(this.vertexAttLength+=t.QuadData.scaleSize),this.vertexFormat&e.VF_QUADPOS&&(this.vertexAttLength+=t.QuadData.posSize),this.vertexFormat&e.VF_QUADOFFSET&&(this.vertexAttLength+=t.QuadData.offsetSize),this.vertexFormat&e.VF_QUAD_COLOR&&(this.vertexAttLength+=t.QuadData.colorSize),this.vertexSizeInBytes=4*this.vertexAttLength
},enumerable:!0,configurable:!0}),i.prototype.activeState=function(t,e,i){this._bufferDiry&&(this._bufferDiry=!1,this.upload(i,this.drawType)),i.bindVertexBuffer(this.sharedVertexBuffer),i.bindIndexBuffer(this.sharedIndexBuffer)},i.prototype.upload=function(e,i){void 0===i&&(i=t.Context3DProxy.gl.STATIC_DRAW),this.sharedIndexBuffer||this.sharedVertexBuffer?(e.uploadVertexBuffer(this.sharedVertexBuffer),e.uploadIndexBuffer(this.sharedIndexBuffer)):(this.sharedIndexBuffer=e.creatIndexBuffer(this.indexArray),this.sharedVertexBuffer=e.creatVertexBuffer(this.vertexArray,i))},i.prototype.getVertexForIndex=function(t,r,a,n){if(void 0===a&&(a=null),void 0===n&&(n=1),a||(a=new Array),0>t||t>=this.vertexCount)return a;for(var o=0;n>o;++o){var s=0;if(r&e.VF_POSITION&&(this.vertexFormat&e.VF_POSITION?(a.push(this.vertexArray[t*this.vertexAttLength+s+0]),a.push(this.vertexArray[t*this.vertexAttLength+s+1]),a.push(this.vertexArray[t*this.vertexAttLength+s+2])):a.push(0,0,0)),this.vertexFormat&e.VF_POSITION&&(s+=i.positionSize),r&e.VF_NORMAL&&(this.vertexFormat&e.VF_NORMAL?(a.push(this.vertexArray[t*this.vertexAttLength+s+0]),a.push(this.vertexArray[t*this.vertexAttLength+s+1]),a.push(this.vertexArray[t*this.vertexAttLength+s+2])):a.push(0,0,0)),this.vertexFormat&e.VF_NORMAL&&(s+=i.normalSize),r&e.VF_TANGENT&&(this.vertexFormat&e.VF_TANGENT?(a.push(this.vertexArray[t*this.vertexAttLength+s+0]),a.push(this.vertexArray[t*this.vertexAttLength+s+1]),a.push(this.vertexArray[t*this.vertexAttLength+s+2])):a.push(0,0,0)),this.vertexFormat&e.VF_TANGENT&&(s+=i.tangentSize),r&e.VF_COLOR&&(this.vertexFormat&e.VF_COLOR?(a.push(this.vertexArray[t*this.vertexAttLength+s+0]),a.push(this.vertexArray[t*this.vertexAttLength+s+1]),a.push(this.vertexArray[t*this.vertexAttLength+s+2]),a.push(this.vertexArray[t*this.vertexAttLength+s+3])):a.push(0,0,0,0)),this.vertexFormat&e.VF_COLOR&&(s+=i.colorSize),r&e.VF_UV0&&(this.vertexFormat&e.VF_UV0?(a.push(this.vertexArray[t*this.vertexAttLength+s+0]),a.push(this.vertexArray[t*this.vertexAttLength+s+1])):a.push(0,0)),this.vertexFormat&e.VF_UV0&&(s+=i.uvSize),r&e.VF_UV1&&(this.vertexFormat&e.VF_UV1?(a.push(this.vertexArray[t*this.vertexAttLength+s+0]),a.push(this.vertexArray[t*this.vertexAttLength+s+1])):a.push(0,0)),this.vertexFormat&e.VF_UV1&&(s+=i.uv2Size),r&e.VF_SKIN)if(this.vertexFormat&e.VF_SKIN)for(var h=0;h<i.skinSize;++h)a.push(this.vertexArray[t*this.vertexAttLength+s+h]);else a.push(0,0,0,0,0,0,0,0);this.vertexFormat&e.VF_SKIN&&(s+=i.skinSize),t++}return a},i.prototype.setVerticesForIndex=function(t,r,a,n){void 0===n&&(n=1),t+n>this.vertexCount&&(this.vertexCount=t+n),this._bufferDiry=!0;for(var o=0,s=0,h=0;n>h;++h){if(o=0,this.vertexFormat&e.VF_POSITION&&(r&e.VF_POSITION?(this.vertexArray[t*this.vertexAttLength+o+0]=a[s+0],this.vertexArray[t*this.vertexAttLength+o+1]=a[s+1],this.vertexArray[t*this.vertexAttLength+o+2]=a[s+2]):(this.vertexArray[t*this.vertexAttLength+o+0]=0,this.vertexArray[t*this.vertexAttLength+o+1]=0,this.vertexArray[t*this.vertexAttLength+o+2]=0),o+=i.positionSize),r&e.VF_POSITION&&(s+=i.positionSize),this.vertexFormat&e.VF_NORMAL&&(r&e.VF_NORMAL?(this.vertexArray[t*this.vertexAttLength+o+0]=a[s+0],this.vertexArray[t*this.vertexAttLength+o+1]=a[s+1],this.vertexArray[t*this.vertexAttLength+o+2]=a[s+2]):(this.vertexArray[t*this.vertexAttLength+o+0]=0,this.vertexArray[t*this.vertexAttLength+o+1]=0,this.vertexArray[t*this.vertexAttLength+o+2]=0),o+=i.normalSize),r&e.VF_NORMAL&&(s+=i.normalSize),this.vertexFormat&e.VF_TANGENT&&(r&e.VF_TANGENT?(this.vertexArray[t*this.vertexAttLength+o+0]=a[s+0],this.vertexArray[t*this.vertexAttLength+o+1]=a[s+1],this.vertexArray[t*this.vertexAttLength+o+2]=a[s+2]):(this.vertexArray[t*this.vertexAttLength+o+0]=0,this.vertexArray[t*this.vertexAttLength+o+1]=0,this.vertexArray[t*this.vertexAttLength+o+2]=0),o+=i.tangentSize),r&e.VF_TANGENT&&(s+=i.tangentSize),this.vertexFormat&e.VF_COLOR&&(r&e.VF_COLOR?(this.vertexArray[t*this.vertexAttLength+o+0]=a[s+0],this.vertexArray[t*this.vertexAttLength+o+1]=a[s+1],this.vertexArray[t*this.vertexAttLength+o+2]=a[s+2],this.vertexArray[t*this.vertexAttLength+o+3]=a[s+3]):(this.vertexArray[t*this.vertexAttLength+o+0]=1,this.vertexArray[t*this.vertexAttLength+o+1]=1,this.vertexArray[t*this.vertexAttLength+o+2]=1,this.vertexArray[t*this.vertexAttLength+o+3]=1),o+=i.colorSize),r&e.VF_COLOR&&(s+=i.colorSize),this.vertexFormat&e.VF_UV0&&(r&e.VF_UV0?(this.vertexArray[t*this.vertexAttLength+o+0]=a[s+0],this.vertexArray[t*this.vertexAttLength+o+1]=a[s+1]):(this.vertexArray[t*this.vertexAttLength+o+0]=0,this.vertexArray[t*this.vertexAttLength+o+1]=0),o+=i.uvSize),r&e.VF_UV0&&(s+=i.uvSize),this.vertexFormat&e.VF_UV1&&(r&e.VF_UV1?(this.vertexArray[t*this.vertexAttLength+o+0]=a[s+0],this.vertexArray[t*this.vertexAttLength+o+1]=a[s+1]):(this.vertexArray[t*this.vertexAttLength+o+0]=0,this.vertexArray[t*this.vertexAttLength+o+1]=0),o+=i.uv2Size),r&e.VF_UV1&&(s+=i.uv2Size),this.vertexFormat&e.VF_SKIN){if(r&e.VF_SKIN)for(var l=0;l<i.skinSize;++l)this.vertexArray[t*this.vertexAttLength+o+l]=a[s+l];else for(var l=0;l<i.skinSize;++l)this.vertexArray[t*this.vertexAttLength+o+l]=0;o+=i.skinSize}r&e.VF_SKIN&&(s+=i.skinSize),t++}},i.prototype.getVertexIndices=function(t,e,i){if(void 0===e&&(e=-1),void 0===i&&(i=null),i||(i=new Array),t>=this.indexCount)return i;-1==e?e=this.indexCount:e,t+e>this.indexCount&&(e=this.indexCount-t);for(var r=0;e-t>r;++r)i[r]=this.indexArray[r+t];return i},i.prototype.setVertexIndices=function(t,e){t+e.length>this.indexCount&&(this.indexCount=t+e.length);for(var i=0;i<e.length;++i)this.indexArray[t+i]=e[i]},i.prototype.dispose=function(){this.sharedIndexBuffer&&(this.sharedIndexBuffer.dispose(),this.sharedIndexBuffer=null),this.sharedVertexBuffer&&(this.sharedVertexBuffer.dispose(),this.sharedVertexBuffer=null)},i.positionSize=3,i.normalSize=3,i.tangentSize=3,i.colorSize=4,i.uvSize=2,i.uv2Size=2,i.skinSize=8,i}();t.Geometry=i}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.vertexAttLength=17,this.vertLen=0,this.faces=0,this.source_indexData=new Array,this.source_vertexData=new Array,this.source_vertexColorData=new Array,this.source_normalData=new Array,this.source_tangtData=new Array,this.source_uvData=new Array,this.source_uv2Data=new Array,this.source_skinData=new Array,this.vertexIndex=0,this.indices=new Array,this.vertices=new Array,this.normals=new Array,this.tangts=new Array,this.verticesColor=new Array,this.uvs=new Array,this.uv2s=new Array,this.skinMesh=new Array,this.faceNormals=new Array,this.faceWeights=new Array,this.vertexIndices=new Array,this.uvIndices=new Array,this.uv2Indices=new Array,this.normalIndices=new Array,this.colorIndices=new Array,this.indexIds=new Array,this.matCount=0,this.material={}}return e.buildGeomtry=function(e,i){var r=new t.Geometry;r.vertexFormat=i,r.vertexCount=3*e.faces,r.indexCount=3*e.faces,r.faceCount=e.faces,r.skeleton=e.skeleton;for(var a=new t.Vector3D,n=new t.Vector3D(1,1,1),o=new t.Vector3D(1,1,1,1),s=new t.UV(1,0),h=new t.UV(1,0),l=0,u=0,c=0,d=0;d<e.faces;d++){r.indexArray[3*d+0]=3*d+0,r.indexArray[3*d+1]=3*d+2,r.indexArray[3*d+2]=3*d+1;for(var p=0;3>p;p++)u=3*d+p,u*=r.vertexAttLength,c=0,l=e.vertexIndices[3*d+p]*t.Geometry.positionSize,i&t.VertexFormat.VF_POSITION&&(a.x=e.source_vertexData[l+0],a.y=e.source_vertexData[l+1],a.z=e.source_vertexData[l+2],r.vertexArray[u+c+0]=a.x,r.vertexArray[u+c+1]=a.y,r.vertexArray[u+c+2]=a.z,c+=t.Geometry.positionSize),i&t.VertexFormat.VF_NORMAL&&(e.normalIndices&&e.source_normalData&&e.source_normalData.length>0&&(l=e.normalIndices[3*d+p]*t.Geometry.normalSize,n.x=e.source_normalData[l+0],n.y=e.source_normalData[l+1],n.z=e.source_normalData[l+2]),r.vertexArray[u+c+0]=n.x,r.vertexArray[u+c+1]=n.y,r.vertexArray[u+c+2]=n.z,c+=t.Geometry.normalSize),i&t.VertexFormat.VF_TANGENT&&(r.vertexArray[u+c+0]=0,r.vertexArray[u+c+1]=0,r.vertexArray[u+c+2]=0,c+=t.Geometry.tangentSize),i&t.VertexFormat.VF_COLOR&&(e.colorIndices&&e.source_vertexColorData&&e.source_vertexColorData.length>0&&(l=e.colorIndices[3*d+p]*t.Geometry.colorSize,o.x=e.source_vertexColorData[l+0],o.y=e.source_vertexColorData[l+1],o.z=e.source_vertexColorData[l+2],o.w=e.source_vertexColorData[l+3]),r.vertexArray[u+c+0]=o.x,r.vertexArray[u+c+1]=o.y,r.vertexArray[u+c+2]=o.z,r.vertexArray[u+c+3]=o.w,c+=t.Geometry.colorSize),i&t.VertexFormat.VF_UV0&&(e.uvIndices&&e.source_uvData&&e.source_uvData.length>0&&(l=e.uvIndices[3*d+p]*t.Geometry.uvSize,s.u=e.source_uvData[l+0],s.v=e.source_uvData[l+1]),r.vertexArray[u+c+0]=s.u,r.vertexArray[u+c+1]=s.v,c+=t.Geometry.uvSize),i&t.VertexFormat.VF_UV1&&(e.uv2Indices&&e.source_uv2Data&&e.source_uv2Data.length>0&&(l=e.uv2Indices[3*d+p]*t.Geometry.uv2Size,h.u=e.source_uv2Data[l+0],h.v=e.source_uv2Data[l+1]),r.vertexArray[u+c+0]=h.u,r.vertexArray[u+c+1]=h.v,c+=t.Geometry.uv2Size),i&t.VertexFormat.VF_SKIN&&(null!=e.source_skinData&&e.source_skinData.length>0?(l=e.vertexIndices[3*d+p]*t.Geometry.skinSize,r.vertexArray[u+c+0]=e.source_skinData[l+0],r.vertexArray[u+c+1]=e.source_skinData[l+2],r.vertexArray[u+c+2]=e.source_skinData[l+4],r.vertexArray[u+c+3]=e.source_skinData[l+6],r.vertexArray[u+c+4]=e.source_skinData[l+1],r.vertexArray[u+c+5]=e.source_skinData[l+3],r.vertexArray[u+c+6]=e.source_skinData[l+5],r.vertexArray[u+c+7]=e.source_skinData[l+7]):(r.vertexArray[u+c+0]=0,r.vertexArray[u+c+1]=0,r.vertexArray[u+c+2]=0,r.vertexArray[u+c+3]=0,r.vertexArray[u+c+4]=0,r.vertexArray[u+c+5]=0,r.vertexArray[u+c+6]=0,r.vertexArray[u+c+7]=0))}for(var p=0;p<e.matCount;++p){var f=new t.SubGeometry;f.matID=p,f.geometry=r,f.start=3*e.material[p].start*Uint16Array.BYTES_PER_ELEMENT,f.count=3*e.material[p].count,f.textureDiffuse=e.material[p].textureDiffuse,f.textureNormal=e.material[p].textureNormal,f.textureSpecular=e.material[p].textureSpecular,r.subGeometrys.push(f)}return r},e.combinGeomtryData=function(t,e){void 0===e&&(e=!0);for(var i=0,r=0,a=0,n=0,o=0,s=0,h=0,l=t.vertexDatas;i<t.vertLen;)l[i++]=t.vertices[r++],l[i++]=t.vertices[r++],l[i++]=t.vertices[r++],t.normals&&t.normals.length?(l[i++]=t.normals[a++],l[i++]=t.normals[a++],l[i++]=t.normals[a++]):(l[i++]=0,l[i++]=0,l[i++]=0),t.tangts?(i++,i++,i++):(l[i++]=0,l[i++]=0,l[i++]=0),t.source_vertexColorData&&t.source_vertexColorData.length?(l[i++]=t.verticesColor[s++],l[i++]=t.verticesColor[s++],l[i++]=t.verticesColor[s++],l[i++]=t.verticesColor[s++]):(l[i++]=1,l[i++]=1,l[i++]=1,l[i++]=1),t.uvs&&t.uvs.length?(l[i++]=t.uvs[n++],l[i++]=t.uvs[n++],t.uv2s&&t.uv2s.length?(l[i++]=t.uv2s[o++],l[i++]=t.uv2s[o++]):(l[i++]=t.uvs[o++],l[i++]=t.uvs[o++])):(l[i++]=0,l[i++]=0,l[i++]=0,l[i++]=0),t.skinMesh&&t.skinMesh.length&&(l[i++]=t.skinMesh[h++],l[i++]=t.skinMesh[h++],l[i++]=t.skinMesh[h++],l[i++]=t.skinMesh[h++],l[i++]=t.skinMesh[h++],l[i++]=t.skinMesh[h++],l[i++]=t.skinMesh[h++],l[i++]=t.skinMesh[h++])},e.updateFaceNormals=function(t){for(var e,i,r,a,n,o,s,h,l,u,c,d,p,f,_,m,g,v,y,x,b=0,D=0,T=0,w=t.indices.length,P=t.vertexDatas,S=17,A=3;w>b;){e=A+t.indices[b++]*S,i=P[e],n=P[e+1],h=P[e+2],e=A+t.indices[b++]*S,r=P[e],o=P[e+1],l=P[e+2],e=A+t.indices[b++]*S,a=P[e],s=P[e+1],u=P[e+2],c=a-i,d=s-n,p=u-h,f=r-i,_=o-n,m=l-h,g=p*_-d*m,v=c*m-p*f,y=d*f-c*_,x=Math.sqrt(g*g+v*v+y*y);var C=1e4*x;1>C&&(C=1),t.faceWeights[T++]=C,x=1/x,t.faceNormals[D++]=g*x,t.faceNormals[D++]=v*x,t.faceNormals[D++]=y*x}},e.updateVertexNormals=function(t){this.updateFaceNormals(t);for(var e,i,r=0,a=1,n=2,o=(t.vertexDatas.length,17),s=3,h=0,l=0,u=t.indices.length;u>h;)i=t.faceWeights[l++],e=s+t.indices[h++]*o,t.vertexDatas[e]+=t.faceNormals[r]*i,t.vertexDatas[e++]+=t.faceNormals[a]*i,t.vertexDatas[e++]+=t.faceNormals[n]*i,e=s+t.indices[h++]*o,t.vertexDatas[e]+=t.faceNormals[r]*i,t.vertexDatas[e++]+=t.faceNormals[a]*i,t.vertexDatas[e++]+=t.faceNormals[n]*i,e=s+t.indices[h++]*o,t.vertexDatas[e]+=t.faceNormals[r]*i,t.vertexDatas[e++]+=t.faceNormals[a]*i,t.vertexDatas[e++]+=t.faceNormals[n]*i,r+=3,a+=3,n+=3},e}();t.GeometryData=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.useVertexAttributeList=[],this.start=0,this.count=0,this.matID=0,this.preAttList=new Array,this.localActive=!1}return e.prototype.upload=function(e,i){e.attributeDiry=!1;var r=0;e.attributeList=[],this.geometry.vertexFormat&t.VertexFormat.VF_POSITION&&(e.attribute_position&&(e.attribute_position.uniformIndex||(e.attribute_position.uniformIndex=i.getShaderAttribLocation(e.program3D,e.attribute_position.varName)),e.attribute_position.size=t.Geometry.positionSize,e.attribute_position.dataType=t.ContextConfig.FLOAT,e.attribute_position.normalized=!1,e.attribute_position.stride=this.geometry.vertexSizeInBytes,e.attribute_position.offsetBytes=r,e.attributeList.push(e.attribute_position),this.useVertexAttributeList[e.attribute_position.uniformIndex]=e.attribute_position.uniformIndex),r+=t.Geometry.positionSize*Float32Array.BYTES_PER_ELEMENT),this.geometry.vertexFormat&t.VertexFormat.VF_NORMAL&&(e.attribute_normal&&(e.attribute_normal.uniformIndex||(e.attribute_normal.uniformIndex=i.getShaderAttribLocation(e.program3D,e.attribute_normal.varName)),e.attribute_normal.size=t.Geometry.normalSize,e.attribute_normal.dataType=t.ContextConfig.FLOAT,e.attribute_normal.normalized=!1,e.attribute_normal.stride=this.geometry.vertexSizeInBytes,e.attribute_normal.offsetBytes=r,e.attributeList.push(e.attribute_normal),this.useVertexAttributeList[e.attribute_normal.uniformIndex]=e.attribute_normal.uniformIndex),r+=t.Geometry.normalSize*Float32Array.BYTES_PER_ELEMENT),this.geometry.vertexFormat&t.VertexFormat.VF_TANGENT&&(e.attribute_tangent&&(e.attribute_tangent.uniformIndex||(e.attribute_tangent.uniformIndex=i.getShaderAttribLocation(e.program3D,e.attribute_tangent.varName)),e.attribute_tangent.size=t.Geometry.tangentSize,e.attribute_tangent.dataType=t.ContextConfig.FLOAT,e.attribute_tangent.normalized=!1,e.attribute_tangent.stride=this.geometry.vertexSizeInBytes,e.attribute_tangent.offsetBytes=r,e.attributeList.push(e.attribute_tangent),this.useVertexAttributeList[e.attribute_tangent.uniformIndex]=e.attribute_tangent.uniformIndex),r+=t.Geometry.tangentSize*Float32Array.BYTES_PER_ELEMENT),this.geometry.vertexFormat&t.VertexFormat.VF_COLOR&&(e.attribute_color&&(e.attribute_color.uniformIndex||(e.attribute_color.uniformIndex=i.getShaderAttribLocation(e.program3D,e.attribute_color.varName)),e.attribute_color.size=t.Geometry.colorSize,e.attribute_color.dataType=t.ContextConfig.FLOAT,e.attribute_color.normalized=!1,e.attribute_color.stride=this.geometry.vertexSizeInBytes,e.attribute_color.offsetBytes=r,e.attributeList.push(e.attribute_color),this.useVertexAttributeList[e.attribute_color.uniformIndex]=e.attribute_color.uniformIndex),r+=t.Geometry.colorSize*Float32Array.BYTES_PER_ELEMENT),this.geometry.vertexFormat&t.VertexFormat.VF_UV0&&(e.attribute_uv0&&(e.attribute_uv0.uniformIndex||(e.attribute_uv0.uniformIndex=i.getShaderAttribLocation(e.program3D,e.attribute_uv0.varName)),e.attribute_uv0.size=t.Geometry.uvSize,e.attribute_uv0.dataType=t.ContextConfig.FLOAT,e.attribute_uv0.normalized=!1,e.attribute_uv0.stride=this.geometry.vertexSizeInBytes,e.attribute_uv0.offsetBytes=r,e.attributeList.push(e.attribute_uv0),this.useVertexAttributeList[e.attribute_uv0.uniformIndex]=e.attribute_uv0.uniformIndex),r+=t.Geometry.uvSize*Float32Array.BYTES_PER_ELEMENT),this.geometry.vertexFormat&t.VertexFormat.VF_UV1&&(e.attribute_uv1&&(e.attribute_uv1.uniformIndex||(e.attribute_uv1.uniformIndex=i.getShaderAttribLocation(e.program3D,e.attribute_uv1.varName)),e.attribute_uv1.size=t.Geometry.uv2Size,e.attribute_uv1.dataType=t.ContextConfig.FLOAT,e.attribute_uv1.normalized=!1,e.attribute_uv1.stride=this.geometry.vertexSizeInBytes,e.attribute_uv1.offsetBytes=r,e.attributeList.push(e.attribute_uv1),this.useVertexAttributeList[e.attribute_uv1.uniformIndex]=e.attribute_uv1.uniformIndex),r+=t.Geometry.uv2Size*Float32Array.BYTES_PER_ELEMENT),this.geometry.vertexFormat&t.VertexFormat.VF_SKIN&&(e.attribute_boneIndex&&(e.attribute_boneIndex.uniformIndex||(e.attribute_boneIndex.uniformIndex=i.getShaderAttribLocation(e.program3D,e.attribute_boneIndex.varName)),e.attribute_boneIndex.size=t.Geometry.skinSize/2,e.attribute_boneIndex.dataType=t.ContextConfig.FLOAT,e.attribute_boneIndex.normalized=!1,e.attribute_boneIndex.stride=this.geometry.vertexSizeInBytes,e.attribute_boneIndex.offsetBytes=r,e.attributeList.push(e.attribute_boneIndex),this.useVertexAttributeList[e.attribute_boneIndex.uniformIndex]=e.attribute_boneIndex.uniformIndex),r+=t.Geometry.skinSize/2*Float32Array.BYTES_PER_ELEMENT,e.attribute_boneWeight&&(e.attribute_boneWeight.uniformIndex||(e.attribute_boneWeight.uniformIndex=i.getShaderAttribLocation(e.program3D,e.attribute_boneWeight.varName)),e.attribute_boneWeight.size=t.Geometry.skinSize/2,e.attribute_boneWeight.dataType=t.ContextConfig.FLOAT,e.attribute_boneWeight.normalized=!1,e.attribute_boneWeight.stride=this.geometry.vertexSizeInBytes,e.attribute_boneWeight.offsetBytes=r,e.attributeList.push(e.attribute_boneWeight),this.useVertexAttributeList[e.attribute_boneWeight.uniformIndex]=e.attribute_boneWeight.uniformIndex),r+=t.Geometry.skinSize/2*Float32Array.BYTES_PER_ELEMENT),this.geometry.vertexFormat&t.VertexFormat.VF_QUADPOS&&(e.attribute_position&&(e.attribute_position.uniformIndex||(e.attribute_position.uniformIndex=i.getShaderAttribLocation(e.program3D,e.attribute_position.varName)),e.attribute_position.size=t.QuadData.posSize,e.attribute_position.dataType=t.ContextConfig.FLOAT,e.attribute_position.normalized=!1,e.attribute_position.stride=t.QuadData.vertexBytes,e.attribute_position.offsetBytes=r,e.attributeList.push(e.attribute_position),this.useVertexAttributeList[e.attribute_position.uniformIndex]=e.attribute_position.uniformIndex),r+=t.QuadData.posSize*Float32Array.BYTES_PER_ELEMENT),this.geometry.vertexFormat&t.VertexFormat.VF_QUADOFFSET&&(e.attribute_shapePosition&&(e.attribute_shapePosition.uniformIndex||(e.attribute_shapePosition.uniformIndex=i.getShaderAttribLocation(e.program3D,e.attribute_shapePosition.varName)),e.attribute_shapePosition.size=t.QuadData.offsetSize,e.attribute_shapePosition.dataType=t.ContextConfig.FLOAT,e.attribute_shapePosition.normalized=!1,e.attribute_shapePosition.stride=t.QuadData.vertexBytes,e.attribute_shapePosition.offsetBytes=r,e.attributeList.push(e.attribute_shapePosition),this.useVertexAttributeList[e.attribute_shapePosition.uniformIndex]=e.attribute_shapePosition.uniformIndex),r+=t.QuadData.offsetSize*Float32Array.BYTES_PER_ELEMENT),this.geometry.vertexFormat&t.VertexFormat.VF_UVREC&&(e.attribute_uvRec&&(e.attribute_uvRec.uniformIndex||(e.attribute_uvRec.uniformIndex=i.getShaderAttribLocation(e.program3D,e.attribute_uvRec.varName)),e.attribute_uvRec.size=t.QuadData.uvRectangleSize,e.attribute_uvRec.dataType=t.ContextConfig.FLOAT,e.attribute_uvRec.normalized=!1,e.attribute_uvRec.stride=t.QuadData.vertexBytes,e.attribute_uvRec.offsetBytes=r,e.attributeList.push(e.attribute_uvRec),this.useVertexAttributeList[e.attribute_uvRec.uniformIndex]=e.attribute_uvRec.uniformIndex),r+=t.QuadData.uvRectangleSize*Float32Array.BYTES_PER_ELEMENT),this.geometry.vertexFormat&t.VertexFormat.VF_ROTATION&&(e.attribute_rotate&&(e.attribute_rotate.uniformIndex||(e.attribute_rotate.uniformIndex=i.getShaderAttribLocation(e.program3D,e.attribute_rotate.varName)),e.attribute_rotate.size=t.QuadData.rotationSize,e.attribute_rotate.dataType=t.ContextConfig.FLOAT,e.attribute_rotate.normalized=!1,e.attribute_rotate.stride=t.QuadData.vertexBytes,e.attribute_rotate.offsetBytes=r,e.attributeList.push(e.attribute_rotate),this.useVertexAttributeList[e.attribute_rotate.uniformIndex]=e.attribute_rotate.uniformIndex),r+=t.QuadData.rotationSize*Float32Array.BYTES_PER_ELEMENT),this.geometry.vertexFormat&t.VertexFormat.VF_SCALE&&(e.attribute_maskRectangle&&(e.attribute_maskRectangle.uniformIndex||(e.attribute_maskRectangle.uniformIndex=i.getShaderAttribLocation(e.program3D,e.attribute_maskRectangle.varName)),e.attribute_maskRectangle.size=t.QuadData.scaleSize,e.attribute_maskRectangle.dataType=t.ContextConfig.FLOAT,e.attribute_maskRectangle.normalized=!1,e.attribute_maskRectangle.stride=t.QuadData.vertexBytes,e.attribute_maskRectangle.offsetBytes=r,e.attributeList.push(e.attribute_maskRectangle),this.useVertexAttributeList[e.attribute_maskRectangle.uniformIndex]=e.attribute_maskRectangle.uniformIndex),r+=t.QuadData.scaleSize*Float32Array.BYTES_PER_ELEMENT),this.geometry.vertexFormat&t.VertexFormat.VF_QUAD_COLOR&&(e.attribute_quad_color&&(e.attribute_quad_color.uniformIndex||(e.attribute_quad_color.uniformIndex=i.getShaderAttribLocation(e.program3D,e.attribute_quad_color.varName)),e.attribute_quad_color.size=t.QuadData.colorSize,e.attribute_quad_color.dataType=t.ContextConfig.FLOAT,e.attribute_quad_color.normalized=!1,e.attribute_quad_color.stride=t.QuadData.vertexBytes,e.attribute_quad_color.offsetBytes=r,e.attributeList.push(e.attribute_quad_color),this.useVertexAttributeList[e.attribute_quad_color.uniformIndex]=e.attribute_quad_color.uniformIndex),r+=t.QuadData.colorSize*Float32Array.BYTES_PER_ELEMENT);for(var a=0;a<this.preAttList.length;++a){var n=this.preAttList[a],o=e[n.name];o&&(o.uniformIndex||(o.uniformIndex=i.getShaderAttribLocation(e.program3D,o.varName),o.size=n.size,o.dataType=t.ContextConfig.FLOAT,o.normalized=!1,o.stride=this.geometry.vertexSizeInBytes,o.offsetBytes=r,e.attributeList.push(o),this.useVertexAttributeList[o.uniformIndex]=o.uniformIndex)),r+=n.size*Float32Array.BYTES_PER_ELEMENT}},e.prototype.activeState=function(t,e,i,r){i.attributeDiry&&this.upload(i,r);for(var a=(r.activeAttribPointer(this.geometry.vertexFormat,i.attributeList.length),0);a<i.attributeList.length;a++){var n=i.attributeList[a];n.uniformIndex>=0&&r.vertexAttribPointer(n.uniformIndex,n.size,n.dataType,n.normalized,n.stride,n.offsetBytes)}},e.use=!1,e}();t.SubGeometry=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(t,i,r){void 0===t&&(t=80),void 0===i&&(i=80),void 0===r&&(r=80),e.call(this),this._width=80,this._height=80,this._depth=80,this._width=t,this._height=i,this._depth=r,this.buildGeomtry(!0)}return __extends(i,e),Object.defineProperty(i.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"depth",{get:function(){return this._depth},enumerable:!0,configurable:!0}),i.prototype.buildGeomtry=function(e){this.vertexFormat=t.VertexFormat.VF_POSITION|t.VertexFormat.VF_NORMAL|t.VertexFormat.VF_TANGENT|t.VertexFormat.VF_COLOR|t.VertexFormat.VF_UV0|t.VertexFormat.VF_UV1,this.vertexCount=36,this.indexCount=36,this.vertexArray.set([.5*-this._width,.5*-this._height,.5*-this._depth,0,0,-10,1,0,0,1,1,1,1,1,0,0,0,.5*-this._width,.5*this._height,.5*-this._depth,0,0,-10,1,0,0,1,1,1,1,1,1,0,0,.5*this._width,.5*this._height,.5*-this._depth,0,0,-10,1,0,0,1,1,1,1,0,1,0,0,.5*this._width,.5*this._height,.5*-this._depth,0,0,-10,1,0,0,1,1,1,1,0,1,0,0,.5*this._width,.5*-this._height,.5*-this._depth,0,0,-10,1,0,0,1,1,1,1,0,0,0,0,.5*-this._width,.5*-this._height,.5*-this._depth,0,0,-10,1,0,0,1,1,1,1,1,0,0,0,.5*-this._width,.5*-this._height,.5*this._depth,0,0,10,1,0,0,1,1,1,1,0,0,0,0,.5*this._width,.5*-this._height,.5*this._depth,0,0,10,1,0,0,1,1,1,1,1,0,0,0,.5*this._width,.5*this._height,.5*this._depth,0,0,10,1,0,0,1,1,1,1,1,1,0,0,.5*this._width,.5*this._height,.5*this._depth,0,0,10,1,0,0,1,1,1,1,1,1,0,0,.5*-this._width,.5*this._height,.5*this._depth,0,0,10,1,0,0,1,1,1,1,0,1,0,0,.5*-this._width,.5*-this._height,.5*this._depth,0,0,10,1,0,0,1,1,1,1,0,0,0,0,.5*-this._width,.5*-this._height,.5*-this._depth,0,-10,0,1,0,0,1,1,1,1,0,0,0,0,.5*this._width,.5*-this._height,.5*-this._depth,0,-10,0,1,0,0,1,1,1,1,1,0,0,0,.5*this._width,.5*-this._height,.5*this._depth,0,-10,0,1,0,0,1,1,1,1,1,1,0,0,.5*this._width,.5*-this._height,.5*this._depth,0,-10,0,1,0,0,1,1,1,1,1,1,0,0,.5*-this._width,.5*-this._height,.5*this._depth,0,-10,0,1,0,0,1,1,1,1,0,1,0,0,.5*-this._width,.5*-this._height,.5*-this._depth,0,-10,0,1,0,0,1,1,1,1,0,0,0,0,.5*this._width,.5*-this._height,.5*-this._depth,10,0,0,1,0,0,1,1,1,1,0,0,0,0,.5*this._width,.5*this._height,.5*-this._depth,10,0,0,1,0,0,1,1,1,1,1,0,0,0,.5*this._width,.5*this._height,.5*this._depth,10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*this._width,.5*this._height,.5*this._depth,10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*this._width,.5*-this._height,.5*this._depth,10,0,0,1,0,0,1,1,1,1,0,1,0,0,.5*this._width,.5*-this._height,.5*-this._depth,10,0,0,1,0,0,1,1,1,1,0,0,0,0,.5*this._width,.5*this._height,.5*-this._depth,0,10,0,1,0,0,1,1,1,1,0,0,0,0,.5*-this._width,.5*this._height,.5*-this._depth,0,10,0,1,0,0,1,1,1,1,1,0,0,0,.5*-this._width,.5*this._height,.5*this._depth,0,10,0,1,0,0,1,1,1,1,1,1,0,0,.5*-this._width,.5*this._height,.5*this._depth,0,10,0,1,0,0,1,1,1,1,1,1,0,0,.5*this._width,.5*this._height,.5*this._depth,0,10,0,1,0,0,1,1,1,1,0,1,0,0,.5*this._width,.5*this._height,.5*-this._depth,0,10,0,1,0,0,1,1,1,1,0,0,0,0,.5*-this._width,.5*this._height,.5*-this._depth,-10,0,0,1,0,0,1,1,1,1,0,0,0,0,.5*-this._width,.5*-this._height,.5*-this._depth,-10,0,0,1,0,0,1,1,1,1,1,0,0,0,.5*-this._width,.5*-this._height,.5*this._depth,-10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*-this._width,.5*-this._height,.5*this._depth,-10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*-this._width,.5*this._height,.5*this._depth,-10,0,0,1,0,0,1,1,1,1,0,1,0,0,.5*-this._width,.5*this._height,.5*-this._depth,-10,0,0,1,0,0,1,1,1,1,0,0,0,0]),this.indexArray.set(e?[0,2,1,3,5,4,6,8,7,9,11,10,12,14,13,15,17,16,18,20,19,21,23,22,24,26,25,27,29,28,30,32,31,33,35,34]:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35]),this.buildDefaultSubGeometry()},i}(t.Geometry);t.CubeGeometry=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(t,i){void 0===t&&(t=100),void 0===i&&(i=200),e.call(this),this._height=t,this._radius=i,this.buildGeomtry()}return __extends(i,e),Object.defineProperty(i.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"radius",{get:function(){return this._radius},enumerable:!0,configurable:!0}),i.prototype.buildGeomtry=function(){this.vertexFormat=t.VertexFormat.VF_POSITION|t.VertexFormat.VF_NORMAL|t.VertexFormat.VF_TANGENT|t.VertexFormat.VF_COLOR|t.VertexFormat.VF_UV0|t.VertexFormat.VF_UV1;var e=[],i=[],r=20,a=20,n=2*Math.PI/r;for(a=0;r>a;a++){var o=this._radius*Math.sin(a*n),s=this._radius*Math.cos(a*n);e.push(o,0+this._height/2,s,o,0,s,1,0,0,1,1,1,1,1,0,0,0,o,0-this._height/2,s,o,0,s,1,0,0,1,1,1,1,1,0,0,0)}var h=e.length/this.vertexAttLength,l=h;e.push(0,0-this._height/2,0,0,-1,0,1,0,0,1,1,1,1,1,0,0,0);var u=h+1;e.push(0,0+this._height/2,0,0,1,0,1,0,0,1,1,1,1,1,0,0,0);for(var c=0;h>c;c++)0!=(1&c)?i.push(c,c+1>=h?c+1-h:c+1,c+2>=h?c+2-h:c+2,l,c,c+2>=h?c+2-h:c+2):i.push(c+1>=h?c+1-h:c+1,c,c+2>=h?c+2-h:c+2,c,u,c+2>=h?c+2-h:c+2);this.setVerticesForIndex(0,this.vertexFormat,e,e.length/this.vertexAttLength),this.setVertexIndices(0,i);var d=new t.SubGeometry;d.geometry=this,d.start=0,d.count=this.indexCount,this.subGeometrys.push(d)},i}(t.Geometry);t.CylinderGeometry=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r,a,n,o,s,h,l,u){void 0===i&&(i=500),void 0===r&&(r=500),void 0===a&&(a=1),void 0===n&&(n=1),void 0===o&&(o=1),void 0===s&&(s=1),void 0===h&&(h=t.Vector3D.Y_AXIS),void 0===l&&(l=!0),void 0===u&&(u=!0),e.call(this),this._segmentsW=1,this._segmentsH=1,this._width=500,this._height=500,this._scaleU=1,this._scaleV=1,this._width=i,this._height=r,this._segmentsW=a,this._segmentsH=n,this._scaleU=o,this._scaleV=s,this._wCenter=l,this._hCenter=u,this.buildGeometry(h)}return __extends(i,e),Object.defineProperty(i.prototype,"segmentsW",{get:function(){return this._segmentsW},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"segmentsH",{get:function(){return this._segmentsH},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleU",{get:function(){return this._scaleU},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleV",{get:function(){return this._scaleV},enumerable:!0,configurable:!0}),i.prototype.buildGeometry=function(e){this.vertexFormat=t.VertexFormat.VF_POSITION|t.VertexFormat.VF_NORMAL|t.VertexFormat.VF_TANGENT|t.VertexFormat.VF_COLOR|t.VertexFormat.VF_UV0;var i,r,a,n,o=this._segmentsW+1,s=(this._segmentsH+1)*o,h=this.vertexAttLength,l=h-15;a=this._segmentsH*this._segmentsW*6,this.vertexCount=s,this.indexCount=a,a=0;for(var u=(new t.Vector3D,0),c=0;c<=this._segmentsH;++c)for(var d=0;d<=this._segmentsW;++d){switch(i=(d/this._segmentsW-.5)*this._width,r=(c/this._segmentsH-.5)*this._height,0==this._wCenter&&(i+=this._width/2),0==this._hCenter&&(r+=this._height/2),e){case t.Vector3D.Y_AXIS:this.vertexArray[u++]=i,this.vertexArray[u++]=0,this.vertexArray[u++]=r,this.vertexArray[u++]=0,this.vertexArray[u++]=1,this.vertexArray[u++]=0;break;case t.Vector3D.Z_AXIS:this.vertexArray[u++]=i,this.vertexArray[u++]=r,this.vertexArray[u++]=0,this.vertexArray[u++]=0,this.vertexArray[u++]=0,this.vertexArray[u++]=-1;break;case t.Vector3D.X_AXIS:this.vertexArray[u++]=0,this.vertexArray[u++]=i,this.vertexArray[u++]=r,this.vertexArray[u++]=1,this.vertexArray[u++]=0,this.vertexArray[u++]=0;break;default:this.vertexArray[u++]=i,this.vertexArray[u++]=0,this.vertexArray[u++]=r,this.vertexArray[u++]=0,this.vertexArray[u++]=1,this.vertexArray[u++]=0}if(this.vertexArray[u++]=1,this.vertexArray[u++]=0,this.vertexArray[u++]=0,this.vertexArray[u++]=1,this.vertexArray[u++]=1,this.vertexArray[u++]=1,this.vertexArray[u++]=1,this.vertexArray[u++]=d/this._segmentsW*this._scaleU,this.vertexArray[u++]=(1-c/this._segmentsH)*this._scaleV,u+=l,d!=this._segmentsW&&c!=this._segmentsH){n=d+c*o;var p=1;this.indexArray[a++]=n*p,this.indexArray[a++]=(n+o+1)*p,this.indexArray[a++]=(n+o)*p,this.indexArray[a++]=n*p,this.indexArray[a++]=(n+1)*p,this.indexArray[a++]=(n+o+1)*p}}var f=new t.SubGeometry;f.geometry=this,f.start=0,f.count=this.indexCount,this.subGeometrys.push(f)},i}(t.Geometry);t.PlaneGeometry=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(t,i,r){void 0===t&&(t=100),void 0===i&&(i=15),void 0===r&&(r=15),e.call(this),this._segmentsW=50,this._segmentsH=50,this._radius=100,this._radius=t,this._segmentsW=i,this._segmentsH=r,this.buildSphere(!0)}return __extends(i,e),Object.defineProperty(i.prototype,"segmentsW",{get:function(){return this._segmentsW},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"segmentsH",{get:function(){return this._segmentsH},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"radius",{get:function(){return this._radius},enumerable:!0,configurable:!0}),i.prototype.buildSphere=function(e){void 0===e&&(e=!0),this.vertexFormat=t.VertexFormat.VF_POSITION|t.VertexFormat.VF_NORMAL|t.VertexFormat.VF_TANGENT|t.VertexFormat.VF_COLOR|t.VertexFormat.VF_UV0|t.VertexFormat.VF_UV1;var i=0,r=0,a=0,n=(this._segmentsH+1)*(this._segmentsW+1),o=this.vertexAttLength,s=o-9;this.vertexCount=n,this.indexCount=(this._segmentsH-1)*this._segmentsW*6;var h=0,l=0,u=0,c=0,d=0,p=0;for(r=0;r<=this._segmentsH;++r){h=l;var f=Math.PI*r/this._segmentsH,_=-this._radius*Math.cos(f),m=this._radius*Math.sin(f);for(i=0;i<=this._segmentsW;++i){var g=2*Math.PI*i/this._segmentsW,v=m*Math.cos(g),y=m*Math.sin(g),x=1/Math.sqrt(v*v+y*y+_*_),b=Math.sqrt(y*y+v*v);if(d=0,p=b>.007?v/b:0,u=-_,c=y,i==this._segmentsW?(this.vertexArray[l++]=this.vertexArray[h],this.vertexArray[l++]=this.vertexArray[h+1],this.vertexArray[l++]=this.vertexArray[h+2],this.vertexArray[l++]=v*x,this.vertexArray[l++]=u*x,this.vertexArray[l++]=c*x,this.vertexArray[l++]=b>.007?-y/b:1,this.vertexArray[l++]=d,this.vertexArray[l++]=p,this.vertexArray[l+0]=1,this.vertexArray[l+1]=1,this.vertexArray[l+2]=1,this.vertexArray[l+3]=1):(this.vertexArray[l++]=v,this.vertexArray[l++]=u,this.vertexArray[l++]=c,this.vertexArray[l++]=v*x,this.vertexArray[l++]=u*x,this.vertexArray[l++]=c*x,this.vertexArray[l++]=b>.007?-y/b:1,this.vertexArray[l++]=d,this.vertexArray[l++]=p,this.vertexArray[l]=1,this.vertexArray[l+1]=1,this.vertexArray[l+2]=1,this.vertexArray[l+3]=1),i>0&&r>0){var D=(this._segmentsW+1)*r+i,T=(this._segmentsW+1)*r+i-1,w=(this._segmentsW+1)*(r-1)+i-1,P=(this._segmentsW+1)*(r-1)+i;
r==this._segmentsH?(this.vertexArray[l-9]=this.vertexArray[h],this.vertexArray[l-8]=this.vertexArray[h+1],this.vertexArray[l-7]=this.vertexArray[h+2],e?(this.indexArray[a++]=D,this.indexArray[a++]=P,this.indexArray[a++]=w):(this.indexArray[a++]=D,this.indexArray[a++]=w,this.indexArray[a++]=P)):1==r?e?(this.indexArray[a++]=D,this.indexArray[a++]=w,this.indexArray[a++]=T):(this.indexArray[a++]=D,this.indexArray[a++]=T,this.indexArray[a++]=w):e?(this.indexArray[a++]=D,this.indexArray[a++]=P,this.indexArray[a++]=w,this.indexArray[a++]=D,this.indexArray[a++]=w,this.indexArray[a++]=T):(this.indexArray[a++]=D,this.indexArray[a++]=w,this.indexArray[a++]=P,this.indexArray[a++]=D,this.indexArray[a++]=T,this.indexArray[a++]=w)}l+=s}}var o=17,s=((this._segmentsH+1)*(this._segmentsW+1)*o,o-2),l=13;for(r=0;r<=this._segmentsH;++r)for(i=0;i<=this._segmentsW;++i)this.vertexArray[l++]=i/this._segmentsW,this.vertexArray[l++]=r/this._segmentsH,l+=s;var S=new t.SubGeometry;S.geometry=this,S.start=0,S.count=this.indexCount,this.subGeometrys.push(S)},i}(t.Geometry);t.SphereGeometry=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.createGeometry=function(e){void 0===e&&(e=t.VertexFormat.VF_POSITION|t.VertexFormat.VF_NORMAL|t.VertexFormat.VF_TANGENT|t.VertexFormat.VF_COLOR|t.VertexFormat.VF_UV0|t.VertexFormat.VF_UV1);var i=new t.Geometry;return i.vertexFormat=e,i},e.createGemetryForType=function(e,i){switch(e){case"CubeGeometry":return new t.CubeGeometry(i.width,i.height,i.depth);case"CylinderGeometry":return new t.CylinderGeometry(i.height,i.radius);case"ElevationGeometry":return new t.ElevationGeometry(i.heightmap,i.width,i.height,i.depth,i.segmentsW,i.segmentsH);case"PlaneGeometry":return new t.PlaneGeometry(i.width,i.height,i.segmentsW,i.segmentsH,i.uScale,i.vScale);case"SphereGeometry":return new t.SphereGeometry(i.r,i.segmentsW,i.segmentsH)}return null},e}();t.GeometryUtil=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(t,i,r,a,n,o,s,h){void 0===i&&(i=1e3),void 0===r&&(r=100),void 0===a&&(a=1e3),void 0===n&&(n=30),void 0===o&&(o=30),void 0===s&&(s=255),void 0===h&&(h=0),e.call(this),this._width=100,this._height=100,this._segmentsW=100,this._segmentsH=100,this._depth=100,this._minElevation=100,this._maxElevation=100,this._scaleU=1,this._scaleV=1,this._segmentsW=n,this._segmentsH=o,this._width=i,this._height=r,this._depth=a,this._minElevation=h,this._maxElevation=s,this._heightmap=t,this._canvas=document.createElement("canvas");var l=this._canvas.getContext("2d");this._canvas.width=t.imageData.width,this._canvas.height=t.imageData.height,l.drawImage(t.imageData,0,0,t.width,t.height),document.body.appendChild(this._canvas),this._canvas.hidden=!0,this.imageData=l.getImageData(0,0,this._heightmap.imageData.width,this._heightmap.imageData.height),document.body.removeChild(this._canvas),this.buildGeomtry(!0)}return __extends(i,e),Object.defineProperty(i.prototype,"segmentsW",{get:function(){return this._segmentsW},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"segmentsH",{get:function(){return this._segmentsH},enumerable:!0,configurable:!0}),i.prototype.buildGeomtry=function(){this.vertexFormat=t.VertexFormat.VF_POSITION|t.VertexFormat.VF_NORMAL|t.VertexFormat.VF_TANGENT|t.VertexFormat.VF_COLOR|t.VertexFormat.VF_UV0|t.VertexFormat.VF_UV1;var e,i,r,a,n,o,s,h=this._segmentsW+1,l=(this._segmentsH+1)*h,u=(this._heightmap.width-1)/this._segmentsW,c=(this._heightmap.height-1)/this._segmentsH;this.vertexCount=l,this.indexCount=this._segmentsH*this._segmentsW*6,l=0,r=0;for(var d=0;d<=this._segmentsH;++d)for(var p=0;p<=this._segmentsW;++p)e=(p/this._segmentsW-.5)*this._width,i=(d/this._segmentsH-.5)*this._depth,n=Math.floor(p*u),o=Math.floor((this._segmentsH-d)*c),s=this.getHeightBypos(n,o),this.vertexArray[l++]=e,this.vertexArray[l++]=s,this.vertexArray[l++]=i,this.vertexArray[l++]=1,this.vertexArray[l++]=1,this.vertexArray[l++]=1,this.vertexArray[l++]=-1,this.vertexArray[l++]=0,this.vertexArray[l++]=0,this.vertexArray[l++]=1,this.vertexArray[l++]=1,this.vertexArray[l++]=1,this.vertexArray[l++]=1,this.vertexArray[l++]=p/this._segmentsW*this._scaleU,this.vertexArray[l++]=1-d/this._segmentsH*this._scaleV,this.vertexArray[l++]=p/this._segmentsW,this.vertexArray[l++]=1-d/this._segmentsH,p!=this._segmentsW&&d!=this._segmentsH&&(a=p+d*h,this.indexArray[r++]=a,this.indexArray[r++]=a+h+1,this.indexArray[r++]=a+h,this.indexArray[r++]=a,this.indexArray[r++]=a+1,this.indexArray[r++]=a+h+1);this.updateFaceNormals(),this.buildDefaultSubGeometry()},i.prototype.getPixel=function(t,e){var i=4*(e*this._heightmap.imageData.width+t),r=this.imageData.data[i+3]<<24|this.imageData.data[i+0]<<16|this.imageData.data[i+1]<<8|this.imageData.data[i+2];return r},i.prototype.getHeightBypos=function(t,e){var i=255&this.getPixel(t,e);return i>this._maxElevation?this._maxElevation/255*this._height:i<this._minElevation?this._minElevation/255*this._height:i/255*this._height},i.prototype.updateFaceNormals=function(){for(var t,e,i,r,a,n,o,s,h,l,u,c,d,p,f,_,m,g,v,y,x=0,b=0,D=this.indexCount,T=17,w=0,P=[];D>x;)t=w+this.indexArray[x+0]*T,e=this.vertexArray[t],a=this.vertexArray[t+1],s=this.vertexArray[t+2],t=w+this.indexArray[x+1]*T,i=this.vertexArray[t],n=this.vertexArray[t+1],h=this.vertexArray[t+2],t=w+this.indexArray[x+2]*T,r=this.vertexArray[t],o=this.vertexArray[t+1],l=this.vertexArray[t+2],u=i-e,c=n-a,d=h-s,p=r-e,f=o-a,_=l-s,m=d*f-c*_,g=u*_-d*p,v=c*p-u*f,y=Math.sqrt(m*m+g*g+v*v),P[b++]=v*y,P[b++]=g*y,P[b++]=m*y,x+=3;x=0;for(var S=0,A=1,C=2,E=this.vertexAttLength,M=3;D>x;)t=M+this.indexArray[x++]*E,this.vertexArray[t++]=P[S],this.vertexArray[t++]=P[A],this.vertexArray[t++]=P[C],t=M+this.indexArray[x++]*E,this.vertexArray[t++]=P[S],this.vertexArray[t++]=P[A],this.vertexArray[t++]=P[C],t=M+this.indexArray[x++]*E,this.vertexArray[t++]=P[S],this.vertexArray[t++]=P[A],this.vertexArray[t++]=P[C],S+=3,A+=3,C+=3},i}(t.Geometry);t.ElevationGeometry=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){var i=this;e.call(this),this._time=0,this._keyStatus={},this._mouseStatus={},this._isTouchStart=!1,this._mouseEvent3d=new t.MouseEvent3D,this._keyEvent3d=new t.KeyEvent3D,this._touchEvent3d=new t.TouchEvent3D,this._windowsEvent3d=new t.Event3D,this._orientationEvent3d=new t.OrientationEvent3D,this.onGamepadStick1=null,this.onGamepadStick2=null,this._gp=!1,this._oldPosition1=null,this._oldPosition2=null,window.addEventListener("click",function(t){return i.mouseClick(t)},!0),window.addEventListener("mousedown",function(t){return i.mouseStart(t)},!0),window.addEventListener("mouseup",function(t){return i.mouseEnd(t)},!0),window.addEventListener("mousewheel",function(t){return i.mouseWheel(t)},!0),window.addEventListener("mousemove",function(t){return i.mouseMove(t)},!0),window.addEventListener("mouseover",function(t){return i.mouseOver(t)},!0),window.addEventListener("keydown",function(t){return i.keyDown(t)},!0),window.addEventListener("keyup",function(t){return i.keyUp(t)},!0),this.canGame()&&(window.addEventListener("gamepadconnected",function(t){return i.ongamepadconnected(t)},!0),window.addEventListener("gamepaddisconnected",function(t){return i.ongamepaddisconnected(t)},!0)),window.addEventListener("touchstart",function(t){return i.touchStart(t)},!0),window.addEventListener("touchend",function(t){return i.touchEnd(t)},!0),window.addEventListener("touchmove",function(t){return i.touchMove(t)},!0),window.addEventListener("touchcancel",function(t){return i.touchEnd(t)},!0),window.addEventListener("resize",function(t){return i.onWindowsResize(t)},!0),window.addEventListener("orientationchange",function(t){return i.onOrientationChange(t)},!0),window.addEventListener("devicemotion",function(t){return i.onDeviceMotion(t)},!0),window.addEventListener("deviceorientation",function(t){return i.onDeviceOrientation(t)},!0)}return __extends(i,e),Object.defineProperty(i,"instance",{get:function(){return null==this._instance&&(this._instance=new i),this._instance},enumerable:!0,configurable:!0}),i.addEventListener=function(t,e,r){return i.instance.addEventListener(t,e,r)},i.removeEventListener=function(t,e,r){i.instance.removeEventListener(t,e,r)},i.removeEventListenerAt=function(t){i.instance.removeEventListenerAt(t)},i.prototype.ongamepaddisconnected=function(){this._gp=!1},i.prototype.ongamepadconnected=function(){this._gp=!0},i.prototype.getGamepadButtonState=function(t){return navigator.getGamepads()[0].buttons[t].pressed},i.prototype.getGamepadStick1=function(){return new t.Vector3D(navigator.getGamepads()[0].axes[0],navigator.getGamepads()[0].axes[1],0)},i.prototype.getGamepadStick2=function(){return new t.Vector3D(navigator.getGamepads()[0].axes[2],navigator.getGamepads()[0].axes[3],0)},i.prototype.canGame=function(){return"getGamepads"in navigator},i.reportOnGamepad=function(){i.instance.canGame()&&i.instance._gp&&(null!=i.instance.onGamepadStick1&&i.instance.onGamepadStick1(i.instance.getGamepadStick1()),null!=i.instance.onGamepadStick2&&i.instance.onGamepadStick2(i.instance.getGamepadStick2()))},i.prototype.printout=function(){var t="";t+="id: "+navigator.getGamepads()[0].id+"<br/>";for(var e=navigator.getGamepads()[0].buttons.length,i=0;e>i;i++)t+="Button "+(i+1)+": ",this.getGamepadButtonState(i)&&(t+=" pressed"),t+="<br/>";var r=this.getGamepadStick1();t+="Stick 1: "+r.x+","+r.y+"<br/>",r=this.getGamepadStick2(),t+="Stick 2: "+r.x+","+r.y+"<br/>"},i.prototype.onPinch=function(e,i,r,a){this._oldPosition1=new t.Point(e,i),this._oldPosition2=new t.Point(r,a)},i.prototype.onSwipe=function(t,e){i.mouseX=t,i.mouseY=e,this._oldPosition1=null,this._oldPosition2=null,this._time=(new Date).getTime()},i.prototype.touchStart=function(e){if(this.deliverMessage()){e.preventDefault();var r=e.targetTouches[0].clientX-i.canvas.x+i.canvas.offsetX,a=e.targetTouches[0].clientY-i.canvas.y+i.canvas.offsetY;if(2==e.targetTouches.length){var n=e.targetTouches[1].clientX-i.canvas.x+i.canvas.offsetX,o=e.targetTouches[1].clientY-i.canvas.y+i.canvas.offsetY;this.onPinch(r,a,n,o)}else 1==e.targetTouches.length&&this.onSwipe(r,a);this._touchEvent3d.targetTouches=e.targetTouches,this._touchEvent3d.target=this,this._isTouchStart||(this._isTouchStart=!0,this._touchEvent3d.eventType=t.TouchEvent3D.TOUCH_START,this.dispatchEvent(this._touchEvent3d))}},i.prototype.touchEnd=function(e){if(e.targetTouches.length>1){var r=e.targetTouches[0].clientX-i.canvas.x+i.canvas.offsetX,a=e.targetTouches[0].clientY-i.canvas.y+i.canvas.offsetY,n=e.targetTouches[1].clientX-i.canvas.x+i.canvas.offsetX,o=e.targetTouches[1].clientY-i.canvas.y+i.canvas.offsetY;this.onPinch(r,a,n,o)}else 1==e.targetTouches.length?this.onSwipe(e.targetTouches[0].clientX-i.canvas.x+i.canvas.offsetX,e.targetTouches[0].clientY-i.canvas.y+i.canvas.offsetY):(this._oldPosition1=null,this._oldPosition2=null,this._time=0);this._isTouchStart=!1,this._touchEvent3d.targetTouches=e.targetTouches,this._touchEvent3d.target=this,this._touchEvent3d.eventType=t.TouchEvent3D.TOUCH_END,this.dispatchEvent(this._touchEvent3d)},i.prototype.touchMove=function(e){if(i.mouseLastX=i.mouseX,i.mouseLastY=i.mouseY,i.mouseX=e.targetTouches[0].clientX-i.canvas.x+i.canvas.offsetX,i.mouseY=e.targetTouches[0].clientY-i.canvas.y+i.canvas.offsetY,i.mouseOffsetX=i.mouseX-i.mouseLastX,i.mouseOffsetY=i.mouseY-i.mouseLastY,e.preventDefault(),e.targetTouches.length>1){var r=new t.Point(i.mouseX,i.mouseY),a=new t.Point(e.targetTouches[1].clientX-i.canvas.x+i.canvas.offsetX,e.targetTouches[1].clientY-i.canvas.y+i.canvas.offsetY);null==this._oldPosition1&&(this._oldPosition1=r),null==this._oldPosition2&&(this._oldPosition2=a),i.wheelDelta=this.isEnlarge(this._oldPosition1,this._oldPosition2,r,a)?120:-120,this._oldPosition1=r,this._oldPosition2=a}this._touchEvent3d.targetTouches=e.targetTouches,this._touchEvent3d.target=this,this._touchEvent3d.eventType=t.TouchEvent3D.TOUCH_MOVE,this.dispatchEvent(this._touchEvent3d)},i.prototype.mouseClick=function(e){this.deliverMessage()&&(this._mouseEvent3d.mouseCode=e.button,this._mouseEvent3d.target=this,this._mouseEvent3d.eventType=t.MouseEvent3D.MOUSE_CLICK,this.dispatchEvent(this._mouseEvent3d))},i.prototype.mouseEnd=function(e){this._mouseEvent3d.mouseCode=e.button,this._mouseEvent3d.target=this,this._mouseStatus[this._mouseEvent3d.mouseCode]=!1,this._mouseEvent3d.eventType=t.MouseEvent3D.MOUSE_UP,this.dispatchEvent(this._mouseEvent3d)},i.prototype.deliverMessage=function(){for(var t=i.canvas.view3Ds,e=0;e<t.length;++e)if(t[e].inView3D(i.mouseX,i.mouseY))return!0;return!1},i.prototype.mouseStart=function(e){this.deliverMessage()&&(this._mouseEvent3d.mouseCode=e.button,this._mouseEvent3d.target=this,this._mouseStatus[this._mouseEvent3d.mouseCode]||(this._mouseStatus[this._mouseEvent3d.mouseCode]=!0,this._mouseEvent3d.eventType=t.MouseEvent3D.MOUSE_DOWN,this.dispatchEvent(this._mouseEvent3d)))},i.prototype.mouseMove=function(e){i.mouseLastX=i.mouseX,i.mouseLastY=i.mouseY,i.mouseX=e.clientX-i.canvas.x+i.canvas.offsetX,i.mouseY=e.clientY-i.canvas.y+i.canvas.offsetY,i.mouseOffsetX=i.mouseX-i.mouseLastX,i.mouseOffsetY=i.mouseY-i.mouseLastY,this._mouseEvent3d.target=this,this._mouseEvent3d.eventType=t.MouseEvent3D.MOUSE_MOVE,this.dispatchEvent(this._mouseEvent3d)},i.prototype.mouseOver=function(){this._mouseEvent3d.target=this,this._mouseEvent3d.eventType=t.MouseEvent3D.MOUSE_OVER,this.dispatchEvent(this._mouseEvent3d)},i.prototype.mouseWheel=function(e){i.wheelDelta=e.wheelDelta,this._mouseEvent3d.target=this,this._mouseEvent3d.eventType=t.MouseEvent3D.MOUSE_WHEEL,this.dispatchEvent(this._mouseEvent3d)},i.prototype.keyDown=function(e){this._keyEvent3d.keyCode=e.keyCode,this._keyEvent3d.target=this,this._keyStatus[e.keyCode]||(this._keyStatus[e.keyCode]=!0,this._keyEvent3d.eventType=t.KeyEvent3D.KEY_CLICK,this.dispatchEvent(this._keyEvent3d),this._keyEvent3d.eventType=t.KeyEvent3D.KEY_DOWN,this.dispatchEvent(this._keyEvent3d))},i.prototype.keyUp=function(e){this._keyEvent3d.keyCode=e.keyCode,this._keyEvent3d.target=this,this._keyStatus[e.keyCode]&&(this._keyEvent3d.eventType=t.KeyEvent3D.KEY_CLICK,this.dispatchEvent(this._keyEvent3d)),this._keyStatus[e.keyCode]=!1,this._keyEvent3d.eventType=t.KeyEvent3D.KEY_UP,this.dispatchEvent(this._keyEvent3d)},i.prototype.onWindowsResize=function(){this._windowsEvent3d.target=this,this._windowsEvent3d.eventType=t.Event3D.RESIZE,this.dispatchEvent(this._windowsEvent3d)},i.prototype.onOrientationChange=function(){this._orientationEvent3d.target=this,this._orientationEvent3d.eventType=t.OrientationEvent3D.ORIENTATION_CHANGE,this.dispatchEvent(this._orientationEvent3d)},i.prototype.onDeviceMotion=function(e){this._orientationEvent3d.target=this,this._orientationEvent3d.eventType=t.OrientationEvent3D.DEVICE_MOTION,this._orientationEvent3d.acceleration=e.acceleration,this._orientationEvent3d.accelerationIncludingGravity=e.accelerationIncludingGravity,this._orientationEvent3d.rotationRate=e.rotationRate,this.dispatchEvent(this._orientationEvent3d)},i.prototype.onDeviceOrientation=function(e){this._orientationEvent3d.target=this,this._orientationEvent3d.eventType=t.OrientationEvent3D.DEVICE_ORIENTATION,this._orientationEvent3d.absolute=e.absolute,this._orientationEvent3d.alpha=e.alpha,this._orientationEvent3d.beta=e.beta,this._orientationEvent3d.gamma=e.gamma,this.dispatchEvent(this._orientationEvent3d)},i.prototype.GetSlideAngle=function(t,e){return 180*Math.atan2(e,t)/Math.PI},i.prototype.GetSlideDirection=function(t,e,i,r){var a=e-r,n=i-t,o=0;if(Math.abs(n)<2&&Math.abs(a)<2)return o;var s=this.GetSlideAngle(n,a);return s>=-45&&45>s?o=4:s>=45&&135>s?o=1:s>=-135&&-45>s?o=2:(s>=135&&180>=s||s>=-180&&-135>s)&&(o=3),o},i.prototype.isEnlarge=function(t,e,i,r){var a=Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)),n=Math.sqrt((i.x-r.x)*(i.x-r.x)+(i.y-r.y)*(i.y-r.y));return n>a?!0:!1},i.mouseX=0,i.mouseY=0,i.wheelDelta=0,i.mouseOffsetX=0,i.mouseOffsetY=0,i.mouseLastX=0,i.mouseLastY=0,i._instance=null,i}(t.EventDispatcher);t.Input=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.orientation=new t.Vector3D,this.screenOrientation=0,this.openDebug=!1,this.offsetRotation=new t.Vector3D,this.fixOritation=new t.Vector3D,this.state=-1,this.degtorad=Math.PI/180,this.q=new t.Quaternion,this.q1=new t.Quaternion,this.outQ=new t.Quaternion,this.fix=new t.Vector3D,this.fixinterpolate=new t.Vector3D,this.fixAxis=new t.Vector3D,this.caheFixAxis=new t.Vector3D,this.steps=1,this.interpolate=!0,this.openDebug&&(this.accDiv=document.createElement("div"),this.accGravityDiv=document.createElement("div"),this.rotationRateDiv=document.createElement("div"),this.orientationRateDiv=document.createElement("div"),this.stateDiv=document.createElement("div"),this.accDiv.style.color="red",this.accGravityDiv.style.color="red",this.rotationRateDiv.style.color="red",this.orientationRateDiv.style.color="red",this.stateDiv.style.color="red",this.stateDiv.style.fontSize="52",document.body.appendChild(this.accDiv),document.body.appendChild(this.accGravityDiv),document.body.appendChild(this.rotationRateDiv),document.body.appendChild(this.orientationRateDiv),document.body.appendChild(this.stateDiv))}return e.prototype.start=function(){var t=this;this.orientationchangeHandler(),window.addEventListener("orientationchange",function(){return t.orientationchangeHandler()}),window.addEventListener("devicemotion",function(e){return t.motionHandler(e)}),window.addEventListener("deviceorientation",function(e){return t.orientationHandler(e)})},e.prototype.stop=function(){var t=this;window.removeEventListener("orientationchange",function(){return t.orientationchangeHandler()}),window.removeEventListener("devicemotion",function(e){return t.motionHandler(e)}),window.removeEventListener("deviceorientation",function(e){return t.orientationHandler(e)})},e.prototype.orientationchangeHandler=function(){void 0!=window.orientation&&(this.screenOrientation=window.orientation)},e.prototype.motionHandler=function(t){this.acc=t.acceleration,this.accGravity=t.accelerationIncludingGravity,this.rotationRate=t.rotationRate},e.prototype.orientationHandler=function(t){this.orientation.x=t.alpha,this.orientation.y=t.beta,this.orientation.z=t.gamma,this.openDebug&&this.debug()},e.prototype.debug=function(){this.accGravityDiv.innerHTML="<br><br> Gravity-x:"+this.orientation.x*t.MathUtil.RADIANS_TO_DEGREES+"<br>Gravity-y:"+this.orientation.y+"<br>Gravity-z:"+this.orientation.z,this.orientationRateDiv.innerHTML="<br> orientation-x:"+this.fixOritation.x+"<br>orientation-y:"+this.fixOritation.y+"<br>orientation-z:"+this.fixOritation.z,this.stateDiv.innerHTML="<br> state: "+this.state},e.prototype.getOrientation=function(){switch(window.screen.msOrientation){case"landscape-primary":return-90;case"landscape-secondary":return 90;case"portrait-secondary":return 180;case"portrait-primary":return 0}return window.orientation||0},e.prototype.getQuaternion=function(e,i,r){var a=i?i*this.degtorad:0,n=r?r*this.degtorad:0,o=e?e*this.degtorad:0;a=Math.floor(100*a)/100,n=Math.floor(100*n)/100;var s=-this.getOrientation()*this.degtorad;this.state=this.getOrientation();var h=Math.cos(a/2),l=Math.cos(n/2),u=Math.cos(o/2),c=Math.sin(a/2),d=Math.sin(n/2),p=Math.sin(o/2);this.q.w=h*l*u-c*d*p,this.q.x=c*l*u-h*d*p,this.q.y=h*d*u+c*l*p,this.q.z=h*l*p+c*d*u;var f=new t.Vector3D(0,0,1),_=new t.Quaternion;return _.fromAxisAngle(f,s),this.q.multiply(this.q,_),f.setTo(-1,0,0),_.fromAxisAngle(f,90*this.degtorad),this.q.multiply(this.q,_),this.q},e.prototype.update=function(t){this.getBaseQuaternion(this.orientation.x,this.orientation.y,this.orientation.z),this.q.toEulerAngles(this.fixOritation),this.interpolate?(this.fixinterpolate.x=this.fixOritation.x-this.fix.x,this.fixinterpolate.y=this.fixOritation.y-this.fix.y,this.fixinterpolate.z=this.fixOritation.z-this.fix.z,this.caheFixAxis.x=this.fixOritation.x/Math.abs(this.fixOritation.x),this.caheFixAxis.y=this.fixOritation.y/Math.abs(this.fixOritation.y),this.caheFixAxis.z=this.fixOritation.z/Math.abs(this.fixOritation.z),this.fixAxis.x==this.caheFixAxis.x&&this.fixAxis.y==this.caheFixAxis.y&&this.fixAxis.z==this.caheFixAxis.z?(this.fix.x+=this.fixinterpolate.x/(this.steps+.01),this.fix.y+=this.fixinterpolate.y/(this.steps+.01),this.fix.z+=this.fixinterpolate.z/(this.steps+.01)):(this.fix.x=this.fixOritation.x,this.fix.y=this.fixOritation.y,this.fix.z=this.fixOritation.z,this.fixAxis.x=this.caheFixAxis.x,this.fixAxis.y=this.caheFixAxis.y,this.fixAxis.z=this.caheFixAxis.z),t.camera3D.rotationX=-this.fix.x,t.camera3D.rotationY=-this.fix.y,t.camera3D.rotationZ=this.fix.z):(t.camera3D.rotationX=-this.fixOritation.x,t.camera3D.rotationY=-this.fixOritation.y,t.camera3D.rotationZ=this.fixOritation.z)},e.prototype.getBaseQuaternion=function(t,e,i){var r=e?e*this.degtorad:0,a=i?i*this.degtorad:0,n=t?t*this.degtorad:0,o=Math.cos(r/2),s=Math.cos(a/2),h=Math.cos(n/2),l=Math.sin(r/2),u=Math.sin(a/2),c=Math.sin(n/2),d=o*s*h-l*u*c,p=l*s*h-o*u*c,f=o*u*h+l*s*c,_=o*s*c+l*u*h;return this.q.w=d,this.q.x=p,this.q.y=f,this.q.z=_,this.q},e}();t.OrientationController=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r){void 0===i&&(i=null),void 0===r&&(r=null),e.call(this),this._event=new t.LoaderEvent3D,this._dataformat=null,this.url="",this.parentUrl="",this.resourceName="",this.data=null,i&&(r&&(this.dataformat=r),this.load(i))}return __extends(i,e),i.prototype.load=function(t){var e=this;if(this.data=null,this.url=t,null==this._dataformat&&(this._dataformat=i.DATAFORMAT_TEXT,this.url.lastIndexOf("."),this.url.lastIndexOf("/"),this.url.length>=4))switch(this.url.substr(this.url.length-4,4).toLowerCase()){case".dds":this._dataformat=i.DATAFORMAT_DDS;break;case".tga":this._dataformat=i.DATAFORMAT_TGA;break;case".bmp":this._dataformat=i.DATAFORMAT_BITMAP;break;case".png":this._dataformat=i.DATAFORMAT_BITMAP;break;case".jpg":this._dataformat=i.DATAFORMAT_BITMAP;break;case".hdr":this._dataformat=i.DATAFORMAT_HDR;break;case"glsl":this._dataformat=i.DATAFORMAT_TEXT;break;case".pvr":this._dataformat=i.DATAFORMAT_PVR;break;case".esm":this._dataformat=i.DATAFORMAT_ESM;break;case".eam":this._dataformat=i.DATAFORMAT_EAM;break;case".eca":this._dataformat=i.DATAFORMAT_ECA;break;case".epa":this._dataformat=i.DATAFORMAT_EPA}return null==this._xhr&&(this._xhr=this.getXHR()),null==this._xhr?void alert("Your browser does not support XMLHTTP."):(this._xhr.readyState>0&&this._xhr.abort(),this._xhr.open("GET",this.url,!0),this._xhr.addEventListener("progress",function(t){return e.onProgress(t)},!1),this._xhr.addEventListener("readystatechange",function(t){return e.onReadyStateChange(t)},!1),this._xhr.addEventListener("error",function(t){return e.onError(t)},!1),this.dataformat==i.DATAFORMAT_BITMAP?this._xhr.responseType="blob":this.dataformat!=i.DATAFORMAT_TEXT&&(this._xhr.responseType="arraybuffer"),void this._xhr.send())},Object.defineProperty(i.prototype,"dataformat",{get:function(){return this._dataformat},set:function(t){this._dataformat=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bytesLoaded",{get:function(){return this._progressEvent?this._progressEvent.loaded:0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bytesTotal",{get:function(){return this._progressEvent?this._progressEvent.total:0},enumerable:!0,configurable:!0}),i.prototype.onReadyStateChange=function(){4==this._xhr.readyState&&(this._xhr.status>=400?console.log(this.url,"load fail"):this.loadComplete())},i.prototype.loadComplete=function(){var e=this;switch(this.dataformat){case i.DATAFORMAT_BINARY:this.data=new t.ByteArray(this._xhr.response);break;case i.DATAFORMAT_SOUND:this.data=this._xhr.responseBody;break;case i.DATAFORMAT_TEXT:this.data=this._xhr.responseText;break;case i.DATAFORMAT_BITMAP:var r=document.createElement("img");return void 0!=window.createObjectURL?r.src=window.createObjectURL(this._xhr.response):void 0!=window.URL?r.src=window.URL.createObjectURL(this._xhr.response):void 0!=window.webkitURL&&(r.src=window.webkitURL.createObjectURL(this._xhr.response)),void(r.onload=function(){return e.onLoad(r)});case i.DATAFORMAT_DDS:this.data=t.DDSParser.parse(this._xhr.response),this.checkTexture(this.data);break;case i.DATAFORMAT_TGA:this.data=t.TGAParser.parse(this._xhr.response),this.checkTexture(this.data);break;case i.DATAFORMAT_HDR:this.data=t.HDRParser.parse(this._xhr.response),this.checkTexture(this.data);break;case i.DATAFORMAT_ESM:this.data=t.ESMParser.parse(this._xhr.response);break;case i.DATAFORMAT_EAM:this.data=t.EAMParser.parse(this._xhr.response);break;case i.DATAFORMAT_ECA:this.data=t.ECAParser.parse(this._xhr.response);break;case i.DATAFORMAT_EPA:this.data=t.EPAParser.parse(this._xhr.response);break;default:this.data=this._xhr.responseText}this.doLoadComplete()},i.prototype.onProgress=function(e){this._event.eventType=t.LoaderEvent3D.LOADER_PROGRESS,this._event.target=this,this._event.loader=this,this._progressEvent=e,this.dispatchEvent(this._event)},i.prototype.onError=function(e){this._event.eventType=t.LoaderEvent3D.LOADER_ERROR,this._event.target=this,this._event.loader=this,this.dispatchEvent(this._event),console.log("load error",e)},i.prototype.getXHR=function(){var t=null;return t=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")},i.prototype.onLoad=function(e){this.data=new t.ImageTexture(e),this.checkTexture(this.data),this.doLoadComplete()},i.prototype.checkTexture=function(e){(0!=(e.width&e.width-1)||0!=(e.height&e.height-1))&&t.Egret3DLog.outError("<"+this.url+"><2N>")},i.prototype.doLoadComplete=function(){this.resourceName=t.StringUtil.getURLName(this.url),this._event.eventType=t.LoaderEvent3D.LOADER_COMPLETE,this._event.target=this,this._event.loader=this,this._event.data=this.data,this.dispatchEvent(this._event)},i.DATAFORMAT_BINARY="binary",i.DATAFORMAT_TEXT="text",i.DATAFORMAT_SOUND="sound",i.DATAFORMAT_BITMAP="bitmap",i.DATAFORMAT_DDS="dds",i.DATAFORMAT_TGA="tga",i.DATAFORMAT_ESM="esm",i.DATAFORMAT_EAM="eam",i.DATAFORMAT_ECA="eca",i.DATAFORMAT_EPA="epa",i.DATAFORMAT_PVR="pvr",i.DATAFORMAT_HDR="hdr",i}(t.EventDispatcher);t.URLLoader=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this._loaderDict={},this._loaderEvent=new t.LoaderEvent3D}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e.prototype.loadAsset=function(e,i,r,a){void 0===a&&(a=null);var n=this._loaderDict[e];return n?n.data?(this._loaderEvent.eventType=t.LoaderEvent3D.LOADER_COMPLETE,this._loaderEvent.loader=n,this._loaderEvent.data=n.data,this._loaderEvent.param=a,i.call(r,this._loaderEvent)):n.addEventListener(t.LoaderEvent3D.LOADER_COMPLETE,i,r,a):(n=new t.URLLoader(e),this._loaderDict[e]=n,n.addEventListener(t.LoaderEvent3D.LOADER_COMPLETE,i,r,a)),this._loaderDict[e]},e.prototype.findAsset=function(t){return this._loaderDict[t]},e}();t.AssetManager=e}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t.RGB_S3TC_DXT1_FORMAT=2001]="RGB_S3TC_DXT1_FORMAT",t[t.RGBA_S3TC_DXT1_FORMAT=2002]="RGBA_S3TC_DXT1_FORMAT",t[t.RGBA_S3TC_DXT3_FORMAT=2003]="RGBA_S3TC_DXT3_FORMAT",t[t.RGBA_S3TC_DXT5_FORMAT=2003]="RGBA_S3TC_DXT5_FORMAT"}(t.DDSFormat||(t.DDSFormat={}));var e=t.DDSFormat,i=function(){function i(){}return i.parse=function(r,a){void 0===a&&(a=!0);var n=31,o=0,s=542327876,h=131072,l=512,u=4,c=i.fourCCToInt32("DXT1"),d=i.fourCCToInt32("DXT3"),p=i.fourCCToInt32("DXT5"),f=1021,o=0,_=1,m=2,g=3,v=4,y=7,x=20,b=21,D=22,T=23,w=24,P=25,S=26,A=28,C=new Int32Array(r,0,n);if(C[o]!==s)return console.error("DDSParser.parse: Invalid magic number in DDS header."),null;if(!(C[x]&u))return console.error("DDSParser.parse: Unsupported format, must contain a FourCC code."),null;var E,M,L,z,F,B=C[b],R=!1,O=1;switch(B){case c:E=8,M=e.RGB_S3TC_DXT1_FORMAT;break;case d:E=16,M=e.RGBA_S3TC_DXT3_FORMAT;break;case p:E=16,M=e.RGBA_S3TC_DXT5_FORMAT;break;default:if(!(32==C[D]&&16711680&C[T]&&65280&C[w]&&255&C[P]&&4278190080&C[S]))return console.error("DDSParser.parse: Unsupported FourCC code ",i.int32ToFourCC(B)),null;R=!0,E=64,M=f}C[m]&h&&a!==!1&&(O=Math.max(1,C[y])),L=C[A]&l?!0:!1,z=C[v],F=C[g];var V=C[_]+4,N=L?6:1,I=new Array,U=!1;M==e.RGB_S3TC_DXT1_FORMAT&&0==t.ContextConfig.ColorFormat_DXT1_RGB?U=!0:M==e.RGBA_S3TC_DXT3_FORMAT&&0==t.ContextConfig.ColorFormat_DXT3_RGBA?U=!0:M==e.RGBA_S3TC_DXT5_FORMAT&&0==t.ContextConfig.ColorFormat_DXT5_RGBA&&(U=!0);var k=new t.Texture;k.width=z,k.height=F;for(var G=0;N>G;G++){for(var j=0;O>j;j++){var X;if(R){X=i.loadARGBMip(r,V,z,F);var H=X.length}else{var H=Math.max(4,z)/4*Math.max(4,F)/4*E;X=new Uint8Array(r,V,H),U&&(X=i.softSolutionDXT(z,F,M,X))}var Y=new t.MipmapData(X,z,F);I.push(Y),V+=H,z=Math.max(.5*z,1),F=Math.max(.5*F,1)}z=z,F=F}return U?(k.internalFormat=t.InternalFormat.PixelArray,k.colorFormat=t.ContextConfig.ColorFormat_RGBA8888):(k.internalFormat=t.InternalFormat.CompressData,c==B?k.colorFormat=t.ContextConfig.ColorFormat_DXT1_RGB:d==B?k.colorFormat=t.ContextConfig.ColorFormat_DXT3_RGBA:p==B&&(k.colorFormat=t.ContextConfig.ColorFormat_DXT5_RGBA)),k.mimapData=I,k},i.loadARGBMip=function(t,e,i,r){for(var a=i*r*4,n=new Uint8Array(t,e,a),o=new Uint8Array(a),s=0,h=0,l=0;r>l;l++)for(var u=0;i>u;u++){var c=n[h];h++;var d=n[h];h++;var p=n[h];h++;var f=n[h];h++,o[s]=p,s++,o[s]=d,s++,o[s]=c,s++,o[s]=f,s++}return o},i.fourCCToInt32=function(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)},i.int32ToFourCC=function(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&65385)},i.softSolutionDXT=function(i,r,a,n){var o,s=new Uint8Array(i*r*4),h=[new t.Color,new t.Color,new t.Color,new t.Color],l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];switch(a){case e.RGB_S3TC_DXT1_FORMAT:case e.RGBA_S3TC_DXT1_FORMAT:o=n.length/8;for(var u=0;o>u;u++){var c=n[8*u+0]|n[8*u+1]<<8,d=n[8*u+2]|n[8*u+3]<<8;h[0].r=c>>11&31,h[0].g=c>>5&63,h[0].b=31&c,h[0].a=255,h[1].r=d>>11&31,h[1].g=d>>5&63,h[1].b=31&d,h[1].a=255,c>d?(h[2].lerp(h[0],h[1],.33),h[3].lerp(h[0],h[1],.66)):h[2].lerp(h[0],h[1],.5);for(var p=0;4>p;p++)l[4*p+0]=3&n[8*u+4+p],l[4*p+1]=n[8*u+4+p]>>2&3,l[4*p+2]=n[8*u+4+p]>>4&3,l[4*p+3]=n[8*u+4+p]>>6&3;for(var f=0;f<h.length;f++)h[f].r=8*h[f].r,h[f].g=4*h[f].g,h[f].b=8*h[f].b;var _=u%(i/4)*4,m=4*Math.floor(u/(i/4));r>m+0&&(i>_+0&&(s[4*(m+0)*i+4*(_+0)+0]=h[l[0]].r,s[4*(m+0)*i+4*(_+0)+1]=h[l[0]].g,s[4*(m+0)*i+4*(_+0)+2]=h[l[0]].b,s[4*(m+0)*i+4*(_+0)+3]=h[l[0]].a),i>_+1&&(s[4*(m+0)*i+4*(_+1)+0]=h[l[1]].r,s[4*(m+0)*i+4*(_+1)+1]=h[l[1]].g,s[4*(m+0)*i+4*(_+1)+2]=h[l[1]].b,s[4*(m+0)*i+4*(_+1)+3]=h[l[1]].a),i>_+2&&(s[4*(m+0)*i+4*(_+2)+0]=h[l[2]].r,s[4*(m+0)*i+4*(_+2)+1]=h[l[2]].g,s[4*(m+0)*i+4*(_+2)+2]=h[l[2]].b,s[4*(m+0)*i+4*(_+2)+3]=h[l[2]].a),i>_+3&&(s[4*(m+0)*i+4*(_+3)+0]=h[l[3]].r,s[4*(m+0)*i+4*(_+3)+1]=h[l[3]].g,s[4*(m+0)*i+4*(_+3)+2]=h[l[3]].b,s[4*(m+0)*i+4*(_+3)+3]=h[l[3]].a)),r>m+1&&(i>_+0&&(s[4*(m+1)*i+4*(_+0)+0]=h[l[4]].r,s[4*(m+1)*i+4*(_+0)+1]=h[l[4]].g,s[4*(m+1)*i+4*(_+0)+2]=h[l[4]].b,s[4*(m+1)*i+4*(_+0)+3]=h[l[4]].a),i>_+1&&(s[4*(m+1)*i+4*(_+1)+0]=h[l[5]].r,s[4*(m+1)*i+4*(_+1)+1]=h[l[5]].g,s[4*(m+1)*i+4*(_+1)+2]=h[l[5]].b,s[4*(m+1)*i+4*(_+1)+3]=h[l[5]].a),i>_+2&&(s[4*(m+1)*i+4*(_+2)+0]=h[l[6]].r,s[4*(m+1)*i+4*(_+2)+1]=h[l[6]].g,s[4*(m+1)*i+4*(_+2)+2]=h[l[6]].b,s[4*(m+1)*i+4*(_+2)+3]=h[l[6]].a),i>_+3&&(s[4*(m+1)*i+4*(_+3)+0]=h[l[7]].r,s[4*(m+1)*i+4*(_+3)+1]=h[l[7]].g,s[4*(m+1)*i+4*(_+3)+2]=h[l[7]].b,s[4*(m+1)*i+4*(_+3)+3]=h[l[7]].a)),r>m+2&&(i>_+0&&(s[4*(m+2)*i+4*(_+0)+0]=h[l[8]].r,s[4*(m+2)*i+4*(_+0)+1]=h[l[8]].g,s[4*(m+2)*i+4*(_+0)+2]=h[l[8]].b,s[4*(m+2)*i+4*(_+0)+3]=h[l[8]].a),i>_+1&&(s[4*(m+2)*i+4*(_+1)+0]=h[l[9]].r,s[4*(m+2)*i+4*(_+1)+1]=h[l[9]].g,s[4*(m+2)*i+4*(_+1)+2]=h[l[9]].b,s[4*(m+2)*i+4*(_+1)+3]=h[l[9]].a),i>_+2&&(s[4*(m+2)*i+4*(_+2)+0]=h[l[10]].r,s[4*(m+2)*i+4*(_+2)+1]=h[l[10]].g,s[4*(m+2)*i+4*(_+2)+2]=h[l[10]].b,s[4*(m+2)*i+4*(_+2)+3]=h[l[10]].a),i>_+3&&(s[4*(m+2)*i+4*(_+3)+0]=h[l[11]].r,s[4*(m+2)*i+4*(_+3)+1]=h[l[11]].g,s[4*(m+2)*i+4*(_+3)+2]=h[l[11]].b,s[4*(m+2)*i+4*(_+3)+3]=h[l[11]].a)),r>m+3&&(i>_+0&&(s[4*(m+3)*i+4*(_+0)+0]=h[l[12]].r,s[4*(m+3)*i+4*(_+0)+1]=h[l[12]].g,s[4*(m+3)*i+4*(_+0)+2]=h[l[12]].b,s[4*(m+3)*i+4*(_+0)+3]=h[l[12]].a),i>_+1&&(s[4*(m+3)*i+4*(_+1)+0]=h[l[13]].r,s[4*(m+3)*i+4*(_+1)+1]=h[l[13]].g,s[4*(m+3)*i+4*(_+1)+2]=h[l[13]].b,s[4*(m+3)*i+4*(_+1)+3]=h[l[13]].a),i>_+2&&(s[4*(m+3)*i+4*(_+2)+0]=h[l[14]].r,s[4*(m+3)*i+4*(_+2)+1]=h[l[14]].g,s[4*(m+3)*i+4*(_+2)+2]=h[l[14]].b,s[4*(m+3)*i+4*(_+2)+3]=h[l[14]].a),i>_+3&&(s[4*(m+3)*i+4*(_+3)+0]=h[l[15]].r,s[4*(m+3)*i+4*(_+3)+1]=h[l[15]].g,s[4*(m+3)*i+4*(_+3)+2]=h[l[15]].b,s[4*(m+3)*i+4*(_+3)+3]=h[l[15]].a))
}break;case e.RGBA_S3TC_DXT3_FORMAT:o=n.length/16;for(var u=0;o>u;u++){var c=n[16*u+8]|n[16*u+9]<<8,d=n[16*u+10]|n[16*u+11]<<8;h[0].r=c>>11&31,h[0].g=c>>5&63,h[0].b=31&c,h[0].a=255,h[1].r=d>>11&31,h[1].g=d>>5&63,h[1].b=31&d,h[1].a=255,c>d?(h[2].lerp(h[0],h[1],.33),h[3].lerp(h[0],h[1],.66)):(h[2].lerp(h[0],h[1],.5),h[3].a=0);for(var p=0;4>p;p++)l[4*p+0]=3&n[16*u+12+p],l[4*p+1]=n[16*u+12+p]>>2&3,l[4*p+2]=n[16*u+12+p]>>4&3,l[4*p+3]=n[16*u+12+p]>>6&3;for(var f=0;f<h.length;f++)h[f].r=8*h[f].r,h[f].g=4*h[f].g,h[f].b=8*h[f].b;var _=u%(i/4)*4,m=4*Math.floor(u/(i/4));r>m+0&&(i>_+0&&(s[4*(m+0)*i+4*(_+0)+0]=h[l[0]].r,s[4*(m+0)*i+4*(_+0)+1]=h[l[0]].g,s[4*(m+0)*i+4*(_+0)+2]=h[l[0]].b,s[4*(m+0)*i+4*(_+0)+3]=17*(15&n[16*u+0])),i>_+1&&(s[4*(m+0)*i+4*(_+1)+0]=h[l[1]].r,s[4*(m+0)*i+4*(_+1)+1]=h[l[1]].g,s[4*(m+0)*i+4*(_+1)+2]=h[l[1]].b,s[4*(m+0)*i+4*(_+1)+3]=17*(n[16*u+0]>>4&15)),i>_+2&&(s[4*(m+0)*i+4*(_+2)+0]=h[l[2]].r,s[4*(m+0)*i+4*(_+2)+1]=h[l[2]].g,s[4*(m+0)*i+4*(_+2)+2]=h[l[2]].b,s[4*(m+0)*i+4*(_+2)+3]=17*(15&n[16*u+1])),i>_+3&&(s[4*(m+0)*i+4*(_+3)+0]=h[l[3]].r,s[4*(m+0)*i+4*(_+3)+1]=h[l[3]].g,s[4*(m+0)*i+4*(_+3)+2]=h[l[3]].b,s[4*(m+0)*i+4*(_+3)+3]=17*(n[16*u+1]>>4&15))),r>m+1&&(i>_+0&&(s[4*(m+1)*i+4*(_+0)+0]=h[l[4]].r,s[4*(m+1)*i+4*(_+0)+1]=h[l[4]].g,s[4*(m+1)*i+4*(_+0)+2]=h[l[4]].b,s[4*(m+1)*i+4*(_+0)+3]=17*(15&n[16*u+2])),i>_+1&&(s[4*(m+1)*i+4*(_+1)+0]=h[l[5]].r,s[4*(m+1)*i+4*(_+1)+1]=h[l[5]].g,s[4*(m+1)*i+4*(_+1)+2]=h[l[5]].b,s[4*(m+1)*i+4*(_+1)+3]=17*(n[16*u+2]>>4&15)),i>_+2&&(s[4*(m+1)*i+4*(_+2)+0]=h[l[6]].r,s[4*(m+1)*i+4*(_+2)+1]=h[l[6]].g,s[4*(m+1)*i+4*(_+2)+2]=h[l[6]].b,s[4*(m+1)*i+4*(_+2)+3]=17*(15&n[16*u+3])),i>_+3&&(s[4*(m+1)*i+4*(_+3)+0]=h[l[7]].r,s[4*(m+1)*i+4*(_+3)+1]=h[l[7]].g,s[4*(m+1)*i+4*(_+3)+2]=h[l[7]].b,s[4*(m+1)*i+4*(_+3)+3]=17*(n[16*u+3]>>4&15))),r>m+2&&(i>_+0&&(s[4*(m+2)*i+4*(_+0)+0]=h[l[8]].r,s[4*(m+2)*i+4*(_+0)+1]=h[l[8]].g,s[4*(m+2)*i+4*(_+0)+2]=h[l[8]].b,s[4*(m+2)*i+4*(_+0)+3]=17*(15&n[16*u+4])),i>_+1&&(s[4*(m+2)*i+4*(_+1)+0]=h[l[9]].r,s[4*(m+2)*i+4*(_+1)+1]=h[l[9]].g,s[4*(m+2)*i+4*(_+1)+2]=h[l[9]].b,s[4*(m+2)*i+4*(_+1)+3]=17*(n[16*u+4]>>4&15)),i>_+2&&(s[4*(m+2)*i+4*(_+2)+0]=h[l[10]].r,s[4*(m+2)*i+4*(_+2)+1]=h[l[10]].g,s[4*(m+2)*i+4*(_+2)+2]=h[l[10]].b,s[4*(m+2)*i+4*(_+2)+3]=17*(15&n[16*u+5])),i>_+3&&(s[4*(m+2)*i+4*(_+3)+0]=h[l[11]].r,s[4*(m+2)*i+4*(_+3)+1]=h[l[11]].g,s[4*(m+2)*i+4*(_+3)+2]=h[l[11]].b,s[4*(m+2)*i+4*(_+3)+3]=17*(n[16*u+5]>>4&15))),r>m+3&&(i>_+0&&(s[4*(m+3)*i+4*(_+0)+0]=h[l[12]].r,s[4*(m+3)*i+4*(_+0)+1]=h[l[12]].g,s[4*(m+3)*i+4*(_+0)+2]=h[l[12]].b,s[4*(m+3)*i+4*(_+0)+3]=17*(15&n[16*u+6])),i>_+1&&(s[4*(m+3)*i+4*(_+1)+0]=h[l[13]].r,s[4*(m+3)*i+4*(_+1)+1]=h[l[13]].g,s[4*(m+3)*i+4*(_+1)+2]=h[l[13]].b,s[4*(m+3)*i+4*(_+1)+3]=17*(n[16*u+6]>>4&15)),i>_+2&&(s[4*(m+3)*i+4*(_+2)+0]=h[l[14]].r,s[4*(m+3)*i+4*(_+2)+1]=h[l[14]].g,s[4*(m+3)*i+4*(_+2)+2]=h[l[14]].b,s[4*(m+3)*i+4*(_+2)+3]=17*(15&n[16*u+7])),i>_+3&&(s[4*(m+3)*i+4*(_+3)+0]=h[l[15]].r,s[4*(m+3)*i+4*(_+3)+1]=h[l[15]].g,s[4*(m+3)*i+4*(_+3)+2]=h[l[15]].b,s[4*(m+3)*i+4*(_+3)+3]=17*(n[16*u+7]>>4&15)))}break;case e.RGBA_S3TC_DXT5_FORMAT:}return s},i}();t.DDSParser=i}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t.RGB_PVRTC_4BPPV1_Format=2100]="RGB_PVRTC_4BPPV1_Format",t[t.RGB_PVRTC_2BPPV1_Format=2101]="RGB_PVRTC_2BPPV1_Format",t[t.RGBA_PVRTC_4BPPV1_Format=2102]="RGBA_PVRTC_4BPPV1_Format",t[t.RGBA_PVRTC_2BPPV1_Format=2103]="RGBA_PVRTC_2BPPV1_Format"}(t.PVRFormat||(t.PVRFormat={}));var e=t.PVRFormat,i=function(){function i(){}return i.parse=function(e){var r,a=13,n=new Uint32Array(e,0,a),o={buffer:e,header:n};if(55727696===n[0])r=i._parseV3(o);else{if(559044176!==n[11])return console.log("PVRParser unknow pvr format. PVRParser::parse"),r;r=i._parseV2(o)}return r.internalFormat=t.InternalFormat.PixelArray,r.colorFormat=t.ContextConfig.ColorFormat_RGBA8888,r.useMipmap=!1,r},i._parseV2=function(t){var r,a,n=t.header,o=n[0],s=n[1],h=n[2],l=n[3],u=n[4],r=(n[5],n[6]),c=(n[7],n[8],n[9],n[10]),d=(n[11],n[12]),p=255,f=24,_=25,m=u&p,g=c>0;if(m===_)a=g?e.RGBA_PVRTC_4BPPV1_Format:e.RGB_PVRTC_4BPPV1_Format,r=4;else{if(m!==f)throw new Error("pvrtc - unknown format "+m);a=g?e.RGBA_PVRTC_2BPPV1_Format:e.RGB_PVRTC_2BPPV1_Format,r=2}return t.dataPtr=o,t.bpp=r,t.format=a,t.width=h,t.height=s,t.numSurfaces=d,t.numMipmaps=l+1,t.isCubemap=6===d,i._extract(t)},i._parseV3=function(t){var r,a,n=t.header,o=n[12],s=n[2],h=n[6],l=n[7],u=(n[9],n[10]),c=n[11];switch(s){case 0:r=2,a=e.RGB_PVRTC_2BPPV1_Format;break;case 1:r=2,a=e.RGBA_PVRTC_2BPPV1_Format;break;case 2:r=4,a=e.RGB_PVRTC_4BPPV1_Format;break;case 3:r=4,a=e.RGBA_PVRTC_4BPPV1_Format;break;default:throw new Error("pvrtc - unsupported PVR format "+s)}return t.dataPtr=52+o,t.bpp=r,t.format=a,t.width=l,t.height=h,t.numSurfaces=u,t.numMipmaps=c,t.isCubemap=6===u,i._extract(t)},i._extract=function(e){var i=new t.Texture;i.width=e.width,i.height=e.height;var r=e.buffer,a=e.dataPtr,n=e.bpp,o=e.numSurfaces,s=0,h=0,l=0,u=0,c=0,d=0;2===n?(l=8,u=4):(l=4,u=4),h=l*u*n/8,i.mimapData=[];for(var p=0;p<e.numMipmaps;){var f=e.width>>p,_=e.height>>p;c=f/l,d=_/u,2>c&&(c=2),2>d&&(d=2),s=c*d*h;for(var m=0;o>m;m++){var g=new Uint8Array(r,a,s),v={data:g,width:f,height:_};i.mimapData[m*e.numMipmaps+p]=v,a+=s}p++}return i},i}();t.PVRParser=i}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.parse=function(e){function i(t){switch(t.image_type){case d:case _:(t.colormap_length>256||24!==t.colormap_size||1!==t.colormap_type)&&console.error("TGAParser.parse.tgaCheckHeader: Invalid type colormap data for indexed type");break;case p:case f:case m:case g:t.colormap_type&&console.error("TGAParser.parse.tgaCheckHeader: Invalid type colormap data for colormap type");break;case c:console.error("TGAParser.parse.tgaCheckHeader: No data");break;default:console.error('TGAParser.parse.tgaCheckHeader: Invalid type " '+t.image_type+'"')}(t.width<=0||t.height<=0)&&console.error("TGAParser.parse.tgaCheckHeader: Invalid image size"),8!==t.pixel_size&&16!==t.pixel_size&&24!==t.pixel_size&&32!==t.pixel_size&&console.error('TGAParser.parse.tgaCheckHeader: Invalid pixel size "'+t.pixel_size+'"')}function r(t,e,i,r,a){var n,o,s,h;if(o=i.pixel_size>>3,s=i.width*i.height*o,e&&(h=a.subarray(r,r+=i.colormap_length*(i.colormap_size>>3))),t){n=new Uint8Array(s);for(var l,u,c,d=0,p=new Uint8Array(o);s>d;)if(l=a[r++],u=(127&l)+1,128&l){for(c=0;o>c;++c)p[c]=a[r++];for(c=0;u>c;++c)n.set(p,d+c*o);d+=o*u}else{for(u*=o,c=0;u>c;++c)n[d+c]=a[r++];d+=u}}else n=a.subarray(r,r+=e?i.width*i.height:s);return{pixel_data:n,palettes:h}}function a(t,e,i,r,a,n,o,s,h){var l,u,c,d=h,p=0,f=S.width;for(c=e;c!==r;c+=i)for(u=a;u!==o;u+=n,p++)l=s[p],t[4*(u+f*c)+3]=255,t[4*(u+f*c)+2]=d[3*l+0],t[4*(u+f*c)+1]=d[3*l+1],t[4*(u+f*c)+0]=d[3*l+2];return t}function n(t,e,i,r,a,n,o,s){var h,l,u,c=0,d=S.width;for(u=e;u!==r;u+=i)for(l=a;l!==o;l+=n,c+=2)h=s[c+0]+(s[c+1]<<8),t[4*(l+d*u)+0]=(31744&h)>>7,t[4*(l+d*u)+1]=(992&h)>>2,t[4*(l+d*u)+2]=(31&h)>>3,t[4*(l+d*u)+3]=32768&h?0:255;return t}function o(t,e,i,r,a,n,o,s){var h,l,u=0,c=S.width;for(l=e;l!==r;l+=i)for(h=a;h!==o;h+=n,u+=3)t[4*(h+c*l)+3]=255,t[4*(h+c*l)+2]=s[u+0],t[4*(h+c*l)+1]=s[u+1],t[4*(h+c*l)+0]=s[u+2];return t}function s(t,e,i,r,a,n,o,s){var h,l,u=0,c=S.width;for(l=e;l!==r;l+=i)for(h=a;h!==o;h+=n,u+=4)t[4*(h+c*l)+2]=s[u+0],t[4*(h+c*l)+1]=s[u+1],t[4*(h+c*l)+0]=s[u+2],t[4*(h+c*l)+3]=s[u+3];return t}function h(t,e,i,r,a,n,o,s){var h,l,u,c=0,d=S.width;for(u=e;u!==r;u+=i)for(l=a;l!==o;l+=n,c++)h=s[c],t[4*(l+d*u)+0]=h,t[4*(l+d*u)+1]=h,t[4*(l+d*u)+2]=h,t[4*(l+d*u)+3]=255;return t}function l(t,e,i,r,a,n,o,s){var h,l,u=0,c=S.width;for(l=e;l!==r;l+=i)for(h=a;h!==o;h+=n,u+=2)t[4*(h+c*l)+0]=s[u+0],t[4*(h+c*l)+1]=s[u+0],t[4*(h+c*l)+2]=s[u+0],t[4*(h+c*l)+3]=s[u+1];return t}function u(t,e,i,r){var u,c,d,p,f,_,m=new Uint8Array(t*e*4);switch((S.flags&v)>>y){default:case D:u=0,d=1,f=t,c=0,p=1,_=e;break;case x:u=0,d=1,f=t,c=e-1,p=-1,_=-1;break;case T:u=t-1,d=-1,f=-1,c=0,p=1,_=e;break;case b:u=t-1,d=-1,f=-1,c=e-1,p=-1,_=-1}if(E)switch(S.pixel_size){case 8:h(m,c,p,_,u,d,f,i);break;case 16:l(m,c,p,_,u,d,f,i);break;default:console.error("TGAParser.parse.getTgaRGBA: not support this format")}else switch(S.pixel_size){case 8:a(m,c,p,_,u,d,f,i,r);break;case 16:n(m,c,p,_,u,d,f,i);break;case 24:o(m,c,p,_,u,d,f,i);break;case 32:s(m,c,p,_,u,d,f,i);break;default:console.error("TGAParser.parse.getTgaRGBA: not support this format")}return m}var c=0,d=1,p=2,f=3,_=9,m=10,g=11,v=48,y=4,x=0,b=1,D=2,T=3;e.byteLength<19&&console.error("TGAParser.parse: Not enough data to contain header.");var w=new Uint8Array(e),P=0,S={id_length:w[P++],colormap_type:w[P++],image_type:w[P++],colormap_index:w[P++]|w[P++]<<8,colormap_length:w[P++]|w[P++]<<8,colormap_size:w[P++],origin:[w[P++]|w[P++]<<8,w[P++]|w[P++]<<8],width:w[P++]|w[P++]<<8,height:w[P++]|w[P++]<<8,pixel_size:w[P++],flags:w[P++]};i(S),S.id_length+P>e.byteLength&&console.error("TGAParser.parse: No data"),P+=S.id_length;var A=!1,C=!1,E=!1;switch(S.image_type){case _:A=!0,C=!0;break;case d:C=!0;break;case m:A=!0;break;case p:break;case g:A=!0,E=!0;break;case f:E=!0}var M=r(A,C,S,P,w),L=u(S.width,S.height,M.pixel_data,M.palettes),z=new t.Texture;return z.width=S.width,z.height=S.height,z.internalFormat=t.InternalFormat.PixelArray,z.colorFormat=t.ContextConfig.ColorFormat_RGBA8888,z.mimapData=[new t.MipmapData(L,S.width,S.height)],z},e}();t.TGAParser=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.ldexp=function(t,e){return e>1023?t*Math.pow(2,1023)*Math.pow(2,e-1023):-1074>e?t*Math.pow(2,-1074)*Math.pow(2,e+1074):t*Math.pow(2,e)},e.readPixelsRawRLE=function(t,e,i,r,a,n){function o(e){var i=0;do e[i++]=t[r];while(++r<_&&i<e.length);return i}function s(e,i,a){var n=0;do e[i+n++]=t[r];while(++r<_&&a>n);return n}function h(t,e,i,r){var a=4*r,n=s(e,i,a);if(a>n)throw new Error("Error reading raw pixels: got "+n+" bytes, expected "+a)}for(var l,u,c,d=new Array(4),p=null,f=new Array(2),_=t.length;n>0;){if(o(d)<d.length)throw new Error("Error reading bytes: expected "+d.length);if(2!=d[0]||2!=d[1]||0!=(128&d[2]))return e[i++]=d[0],e[i++]=d[1],e[i++]=d[2],e[i++]=d[3],void h(t,e,i,a*n-1);if(((255&d[2])<<8|255&d[3])!=a)throw new Error("Wrong scanline width "+((255&d[2])<<8|255&d[3])+", expected "+a);null==p&&(p=new Array(4*a)),l=0;for(var m=0;4>m;m++)for(u=(m+1)*a;u>l;){if(o(f)<f.length)throw new Error("Error reading 2-byte buffer");if((255&f[0])>128){if(c=(255&f[0])-128,0==c||c>u-l)throw new Error("Bad scanline data");for(;c-->0;)p[l++]=f[1]}else{if(c=255&f[0],0==c||c>u-l)throw new Error("Bad scanline data");if(p[l++]=f[1],--c>0){if(s(p,l,c)<c)throw new Error("Error reading non-run data");l+=c}}}for(var m=0;a>m;m++)e[i+0]=p[m],e[i+1]=p[m+a],e[i+2]=p[m+2*a],e[i+3]=p[m+3*a],i+=4;n--}},e.parse=function(i){function r(){var t="";do{var e=i[a];if(e==o){++a;break}t+=String.fromCharCode(e)}while(++a<n);return t}i instanceof ArrayBuffer&&(i=new Uint8Array(i));for(var a=0,n=i.length,o=10,s=0,h=0,l=1,u=!1,c=0;20>c;c++){var d,p=r();if(d=p.match(e.radiancePattern));else if(d=p.match(e.formatPattern))u=!0;else if(d=p.match(e.exposurePattern))l=Number(d[1]);else if(d=p.match(e.commentPattern));else if(d=p.match(e.widthHeightPattern)){h=Number(d[1]),s=Number(d[2]);break}}if(!u)throw new Error("File is not run length encoded!");var f=new Uint8Array(s*h*4),_=s,m=h;this.readPixelsRawRLE(i,f,0,a,_,m);var g=new t.MipmapData(f,s,h),v=new t.Texture;return v.internalFormat=t.InternalFormat.PixelArray,v.colorFormat=t.ContextConfig.ColorFormat_RGBA8888,v.mimapData=[g],v.useMipmap=!1,v.width=s,v.height=h,v},e.radiancePattern="#\\?RADIANCE",e.commentPattern="#.*",e.gammaPattern="GAMMA=",e.exposurePattern="EXPOSURE=\\s*([0-9]*[.][0-9]*)",e.formatPattern="FORMAT=32-bit_rle_rgbe",e.widthHeightPattern="-Y ([0-9]+) \\+X ([0-9]+)",e}();t.HDRParser=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.parse=function(e){var i=new t.ByteArray(e),r=new t.ByteArray;i.readBytes(r,0,3);var a=i.readUnsignedInt();return t.EAMVersion.versionDictionary[a]?t.EAMVersion.versionDictionary[a](i):(console.log("egret3d engine not found "+a+" version"),null)},e}();t.EAMParser=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.parserVersion_1=function(e){var i=e.readUnsignedByte();if(e.readUnsignedByte(),0>=i)return null;for(var r=new t.SkeletonAnimationClip,a=new Array,n=new Array,o=0;i>o;o++)a.push(e.readUTF()),n.push(e.readUTF());for(var s=(e.readInt(),e.readInt()),h=new t.Quaternion,l=new t.Vector3D,u=new t.Vector3D,o=0;s>o;o++){var c=new t.SkeletonPose;c.frameTime=e.readInt()/60/80*1e3;for(var d=0;i>d;d++){var p=new t.Joint(a[d]);p.parent=n[d],p.parentIndex=c.findJointIndex(p.parent),h.fromEulerAngles(e.readFloat()*t.MathUtil.RADIANS_TO_DEGREES,e.readFloat()*t.MathUtil.RADIANS_TO_DEGREES,e.readFloat()*t.MathUtil.RADIANS_TO_DEGREES),l.x=e.readFloat(),l.y=e.readFloat(),l.z=e.readFloat(),u.x=e.readFloat(),u.y=e.readFloat(),u.z=e.readFloat(),p.buildLocalMatrix(l,h,u),c.joints.push(p)}c.calculateJointWorldMatrix(),r.addSkeletonPose(c)}return r},e.parserVersion_2=function(e){var i=e.readUnsignedByte();if(e.readUnsignedByte(),0>=i)return null;for(var r=new t.SkeletonAnimationClip,a=new Array,n=new Array,o=0;i>o;o++)a.push(e.readUTF()),n.push(e.readUTF());for(var s=(e.readInt(),e.readInt()),h=new t.Quaternion,l=new t.Vector3D,u=new t.Vector3D,o=0;s>o;o++){var c=new t.SkeletonPose;c.frameTime=e.readInt()/60/80*1e3;for(var d=0;i>d;d++){var p=new t.Joint(a[d]);p.parent=n[d],p.parentIndex=c.findJointIndex(p.parent),h.x=e.readFloat(),h.y=e.readFloat(),h.z=e.readFloat(),h.w=e.readFloat(),l.x=e.readFloat(),l.y=e.readFloat(),l.z=e.readFloat(),u.x=e.readFloat(),u.y=e.readFloat(),u.z=e.readFloat(),p.buildLocalMatrix(l,h,u),c.joints.push(p)}c.calculateJointWorldMatrix(),r.addSkeletonPose(c)}return r},e.parserVersion_3=function(){return null},e.versionDictionary={1:function(t){return e.parserVersion_1(t)},2:function(t){return e.parserVersion_2(t)},3:function(t){return e.parserVersion_3(t)}},e}();t.EAMVersion=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.parse=function(e){var i=new t.ByteArray(e),r=new t.ByteArray;i.readBytes(r,0,3);var a=i.readUnsignedInt();return t.ECAVersion.versionDictionary[a]?t.ECAVersion.versionDictionary[a](i):(console.log("egret3d engine not found "+a+" version"),null)},e}();t.ECAParser=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.parserVersion_1=function(e){for(var i=new t.CameraAnimationController,r=e.readUnsignedInt(),a=null,n=new t.Vector3D(1,1,1,1);r--;)a=new t.CameraAnimationFrame,a.time=e.readInt(),a.fov=e.readFloat(),a.rotation=new t.Vector3D(e.readFloat()*t.MathUtil.RADIANS_TO_DEGREES+90,e.readFloat()*t.MathUtil.RADIANS_TO_DEGREES,e.readFloat()*t.MathUtil.RADIANS_TO_DEGREES),a.translation=new t.Vector3D(e.readFloat(),e.readFloat(),e.readFloat()),a.matrix=new t.Matrix4_4,a.matrix.recompose([a.translation,a.rotation,n]),i.cameraAnimationFrames.push(a);return i},e.versionDictionary={1:function(t){return e.parserVersion_1(t)}},e}();t.ECAVersion=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.parse=function(e){var i=new t.ByteArray(e),r=new t.ByteArray;i.readBytes(r,0,3);var a=i.readUnsignedInt();if(!t.ESMVersion.versionDictionary[a])return console.log("egret3d engine not found "+a+" version"),null;var n=new t.GeometryData;t.ESMVersion.versionDictionary[a](i,n);var o,s=0;return n.source_skinData.length>0?(s=t.VertexFormat.VF_POSITION|t.VertexFormat.VF_NORMAL|t.VertexFormat.VF_TANGENT|t.VertexFormat.VF_COLOR|t.VertexFormat.VF_UV0|t.VertexFormat.VF_SKIN,o=t.GeometryData.buildGeomtry(n,s)):(s=t.VertexFormat.VF_POSITION|t.VertexFormat.VF_NORMAL|t.VertexFormat.VF_TANGENT|t.VertexFormat.VF_COLOR|t.VertexFormat.VF_UV0|t.VertexFormat.VF_UV1,o=t.GeometryData.buildGeomtry(n,s)),o},e}();t.ESMParser=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.parserVersion_1=function(e,i){var r=e.readInt();i.matCount=e.readInt();for(var a=0;a<i.matCount;++a)i.material[a]={},i.material[a].matID=e.readInt(),i.material[a].start=e.readInt(),i.material[a].count=e.readInt(),i.material[a].textureDiffuse=e.readUTF(),i.material[a].textureNormal=e.readUTF(),i.material[a].textureSpecular=e.readUTF();if(r&t.VertexFormat.VF_POSITION)for(var n=e.readInt(),a=0;n>a;a++)i.source_vertexData.push(e.readFloat()),i.source_vertexData.push(e.readFloat()),i.source_vertexData.push(e.readFloat());if(r&t.VertexFormat.VF_NORMAL)for(var o=e.readInt(),a=0;o>a;a++)i.source_normalData.push(e.readFloat()),i.source_normalData.push(e.readFloat()),i.source_normalData.push(e.readFloat());if(r&t.VertexFormat.VF_COLOR)for(var s=e.readInt(),a=0;s>a;a++)i.source_vertexColorData.push(e.readFloat()),i.source_vertexColorData.push(e.readFloat()),i.source_vertexColorData.push(e.readFloat()),i.source_vertexColorData.push(e.readFloat());if(r&t.VertexFormat.VF_UV0)for(var h=e.readInt(),a=0;h>a;a++)i.source_uvData.push(e.readFloat()),i.source_uvData.push(e.readFloat());if(r&t.VertexFormat.VF_UV1)for(var h=e.readInt(),a=0;h>a;a++)i.source_uv2Data.push(e.readFloat()),i.source_uv2Data.push(e.readFloat());i.faces=e.readInt();for(var a=0;a<i.faces;a++)i.vertexIndices.push(e.readUnsignedInt()),i.vertexIndices.push(e.readUnsignedInt()),i.vertexIndices.push(e.readUnsignedInt()),r&t.VertexFormat.VF_NORMAL&&(i.normalIndices.push(e.readUnsignedInt()),i.normalIndices.push(e.readUnsignedInt()),i.normalIndices.push(e.readUnsignedInt())),r&t.VertexFormat.VF_COLOR&&(i.colorIndices.push(e.readUnsignedInt()),i.colorIndices.push(e.readUnsignedInt()),i.colorIndices.push(e.readUnsignedInt())),r&t.VertexFormat.VF_UV0&&(i.uvIndices.push(e.readUnsignedInt()),i.uvIndices.push(e.readUnsignedInt()),i.uvIndices.push(e.readUnsignedInt())),r&t.VertexFormat.VF_UV1&&(i.uv2Indices.push(e.readUnsignedInt()),i.uv2Indices.push(e.readUnsignedInt()),i.uv2Indices.push(e.readUnsignedInt()));var l=e.readUnsignedByte();l>0&&(i.skeleton=new t.Skeleton);for(var u=(new t.Quaternion,new t.Vector3D),c=new t.Vector3D,d=new t.Vector3D,a=0;l>a;++a){var p=new t.Joint(null);e.readInt(),p.parentIndex=e.readInt(),p.name=e.readUTF(),u.x=e.readFloat()*t.MathUtil.RADIANS_TO_DEGREES,u.y=e.readFloat()*t.MathUtil.RADIANS_TO_DEGREES,u.z=e.readFloat()*t.MathUtil.RADIANS_TO_DEGREES,c.x=e.readFloat(),c.y=e.readFloat(),c.z=e.readFloat(),d.x=e.readFloat(),d.y=e.readFloat(),d.z=e.readFloat(),p.buildInverseMatrix(c,u,d),i.skeleton.joints.push(p)}for(var f=e.readInt(),a=0;f>a;a++){for(var _=e.readUnsignedByte(),m=0;_>m;m++)i.source_skinData.push(e.readUnsignedByte()),i.source_skinData.push(e.readFloat());for(var m=_;4>m;m++)i.source_skinData.push(0),i.source_skinData.push(0)}},e.parserVersion_2=function(e,i){var r=e.readInt();i.matCount=e.readInt();for(var a=0;a<i.matCount;++a)i.material[a]={},i.material[a].matID=e.readInt(),i.material[a].start=e.readInt(),i.material[a].count=e.readInt(),i.material[a].textureDiffuse=e.readUTF(),i.material[a].textureNormal=e.readUTF(),i.material[a].textureSpecular=e.readUTF();if(r&t.VertexFormat.VF_POSITION)for(var n=e.readInt(),a=0;n>a;a++)i.source_vertexData.push(e.readFloat()),i.source_vertexData.push(e.readFloat()),i.source_vertexData.push(e.readFloat());if(r&t.VertexFormat.VF_NORMAL)for(var o=e.readInt(),a=0;o>a;a++)i.source_normalData.push(e.readFloat()),i.source_normalData.push(e.readFloat()),i.source_normalData.push(e.readFloat());if(r&t.VertexFormat.VF_COLOR)for(var s=e.readInt(),a=0;s>a;a++)i.source_vertexColorData.push(e.readUnsignedByte()/255),i.source_vertexColorData.push(e.readUnsignedByte()/255),i.source_vertexColorData.push(e.readUnsignedByte()/255),i.source_vertexColorData.push(e.readUnsignedByte()/255);if(r&t.VertexFormat.VF_UV0)for(var h=e.readInt(),a=0;h>a;a++)i.source_uvData.push(e.readFloat()),i.source_uvData.push(e.readFloat());if(r&t.VertexFormat.VF_UV1)for(var h=e.readInt(),a=0;h>a;a++)i.source_uv2Data.push(e.readFloat()),i.source_uv2Data.push(e.readFloat());i.faces=e.readInt();for(var a=0;a<i.faces;a++)i.vertexIndices.push(e.readUnsignedShort()),i.vertexIndices.push(e.readUnsignedShort()),i.vertexIndices.push(e.readUnsignedShort()),r&t.VertexFormat.VF_NORMAL&&(i.normalIndices.push(e.readUnsignedShort()),i.normalIndices.push(e.readUnsignedShort()),i.normalIndices.push(e.readUnsignedShort())),r&t.VertexFormat.VF_COLOR&&(i.colorIndices.push(e.readUnsignedShort()),i.colorIndices.push(e.readUnsignedShort()),i.colorIndices.push(e.readUnsignedShort())),r&t.VertexFormat.VF_UV0&&(i.uvIndices.push(e.readUnsignedShort()),i.uvIndices.push(e.readUnsignedShort()),i.uvIndices.push(e.readUnsignedShort())),r&t.VertexFormat.VF_UV1&&(i.uv2Indices.push(e.readUnsignedShort()),i.uv2Indices.push(e.readUnsignedShort()),i.uv2Indices.push(e.readUnsignedShort()));var l=e.readUnsignedByte();l>0&&(i.skeleton=new t.Skeleton);for(var u=(new t.Quaternion,new t.Vector3D),c=new t.Vector3D,d=new t.Vector3D,a=0;l>a;++a){var p=new t.Joint(null);e.readInt(),p.parentIndex=e.readInt(),p.name=e.readUTF(),u.x=e.readFloat()*t.MathUtil.RADIANS_TO_DEGREES,u.y=e.readFloat()*t.MathUtil.RADIANS_TO_DEGREES,u.z=e.readFloat()*t.MathUtil.RADIANS_TO_DEGREES,c.x=e.readFloat(),c.y=e.readFloat(),c.z=e.readFloat(),d.x=e.readFloat(),d.y=e.readFloat(),d.z=e.readFloat(),p.buildInverseMatrix(c,u,d),i.skeleton.joints.push(p)}for(var f=e.readInt(),a=0;f>a;a++){for(var _=e.readUnsignedByte(),m=0;_>m;m++)i.source_skinData.push(e.readUnsignedByte()),i.source_skinData.push(e.readFloat());for(var m=_;4>m;m++)i.source_skinData.push(0),i.source_skinData.push(0)}},e.parserVersion_3=function(e,i){var r=e.readInt();i.matCount=e.readInt();for(var a=0;a<i.matCount;++a)i.material[a]={},i.material[a].matID=e.readInt(),i.material[a].start=e.readInt(),i.material[a].count=e.readInt(),i.material[a].textureDiffuse=e.readUTF(),i.material[a].textureNormal=e.readUTF(),i.material[a].textureSpecular=e.readUTF();if(r&t.VertexFormat.VF_POSITION)for(var n=e.readInt(),a=0;n>a;a++)i.source_vertexData.push(e.readFloat()),i.source_vertexData.push(e.readFloat()),i.source_vertexData.push(e.readFloat());if(r&t.VertexFormat.VF_NORMAL)for(var o=e.readInt(),a=0;o>a;a++)i.source_normalData.push(e.readFloat()),i.source_normalData.push(e.readFloat()),i.source_normalData.push(e.readFloat());if(r&t.VertexFormat.VF_COLOR)for(var s=e.readInt(),a=0;s>a;a++)i.source_vertexColorData.push(e.readUnsignedByte()/255),i.source_vertexColorData.push(e.readUnsignedByte()/255),i.source_vertexColorData.push(e.readUnsignedByte()/255),i.source_vertexColorData.push(e.readUnsignedByte()/255);if(r&t.VertexFormat.VF_UV0)for(var h=e.readInt(),a=0;h>a;a++)i.source_uvData.push(e.readFloat()),i.source_uvData.push(e.readFloat());if(r&t.VertexFormat.VF_UV1)for(var h=e.readInt(),a=0;h>a;a++)i.source_uv2Data.push(e.readFloat()),i.source_uv2Data.push(e.readFloat());i.faces=e.readInt();for(var a=0;a<i.faces;a++)i.vertexIndices.push(e.readUnsignedShort()),i.vertexIndices.push(e.readUnsignedShort()),i.vertexIndices.push(e.readUnsignedShort()),r&t.VertexFormat.VF_NORMAL&&(i.normalIndices.push(e.readUnsignedShort()),i.normalIndices.push(e.readUnsignedShort()),i.normalIndices.push(e.readUnsignedShort())),r&t.VertexFormat.VF_COLOR&&(i.colorIndices.push(e.readUnsignedShort()),i.colorIndices.push(e.readUnsignedShort()),i.colorIndices.push(e.readUnsignedShort())),r&t.VertexFormat.VF_UV0&&(i.uvIndices.push(e.readUnsignedShort()),i.uvIndices.push(e.readUnsignedShort()),i.uvIndices.push(e.readUnsignedShort())),r&t.VertexFormat.VF_UV1&&(i.uv2Indices.push(e.readUnsignedShort()),i.uv2Indices.push(e.readUnsignedShort()),i.uv2Indices.push(e.readUnsignedShort()));var l=e.readUnsignedByte();l>0&&(i.skeleton=new t.Skeleton);for(var u=new t.Quaternion,c=(new t.Vector3D,new t.Vector3D),d=new t.Vector3D,a=0;l>a;++a){var p=new t.Joint(null);e.readInt(),p.parentIndex=e.readInt(),p.name=e.readUTF(),u.x=e.readFloat(),u.y=e.readFloat(),u.z=e.readFloat(),u.w=e.readFloat(),c.x=e.readFloat(),c.y=e.readFloat(),c.z=e.readFloat(),d.x=e.readFloat(),d.y=e.readFloat(),d.z=e.readFloat(),p.buildInverseMatrix(c,u,d),i.skeleton.joints.push(p)}for(var f=e.readInt(),a=0;f>a;a++){for(var _=e.readUnsignedByte(),m=0;_>m;m++)i.source_skinData.push(e.readUnsignedByte()),i.source_skinData.push(e.readFloat());for(var m=_;4>m;m++)i.source_skinData.push(0),i.source_skinData.push(0)}},e.versionDictionary={1:function(t,i){return e.parserVersion_1(t,i)},2:function(t,i){return e.parserVersion_2(t,i)},3:function(t,i){return e.parserVersion_3(t,i)}},e}();t.ESMVersion=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.parse=function(e){var i=new t.ByteArray(e);if(1701863680!=i.readUnsignedInt())return null;var r=i.readUnsignedInt();return t.EPAVersion.versionDictionary[r]?t.EPAVersion.versionDictionary[r](i):(console.log("egret3d engine not found "+r+" version"),null)},e}();t.EPAParser=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.parserVersion_1=function(e){for(var i=new t.PropertyAnim,r=e.readUnsignedShort(),a=0;r>a;a++){for(var n=e.readUTF(),o=[],s=e.readUnsignedShort(),h=0;s>h;h++){var l=new t.AnimCurve;l.type=e.readUnsignedInt(),l.start.x=e.readFloat(),l.start.y=e.readFloat(),l.end.x=e.readFloat(),l.end.y=e.readFloat(),l.c1.x=e.readFloat(),l.c1.y=e.readFloat(),l.c2.x=e.readFloat(),l.c2.y=e.readFloat(),o.push(l)}i.addAnimCurve(n,o)}return i},e.versionDictionary={1:function(t){return e.parserVersion_1(t)}},e}();t.EPAVersion=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){}return t.parse=function(t){var e=null;if(!window.DOMParser&&window.ActiveXObject)for(var i=["MSXML.2.DOMDocument.6.0","MSXML.2.DOMDocument.3.0","Microsoft.XMLDOM"],r=0;r<i.length;r++)try{e=new ActiveXObject(i[r]),e.async=!1,e.loadXML(t);break}catch(a){}else{if(!(window.DOMParser&&document.implementation&&document.implementation.createDocument))return null;try{var n=new DOMParser;e=n.parseFromString(t,"text/xml")}catch(a){}}return e},t.eachXmlAttr=function(t,e){if(null!=t&&null!=e)for(var i,r=0,a=t.attributes.length;a>r;r++)i=t.attributes[r],e(i.name,i.value)},t}();t.XMLParser=e}(egret3d||(egret3d={}));var egret3d;!function(egret3d){var MapParserUtils=function(){function MapParserUtils(){}return MapParserUtils.parserConfig=function(dataConfig,type){var config=null;switch(type){case"xml":config=egret3d.XMLParser.parse(dataConfig);break;case"json":config=eval("("+dataConfig+")")}return new egret3d.MapConfigParser(config,type)},MapParserUtils.mapParser=function(t,e,i){var r;switch(t){case"xml":r=new egret3d.MapXmlParser(e,i);break;case"json":r=new egret3d.MapJsonParser(e,i)}r&&r.parser()},MapParserUtils.particleParser=function(t,e){var i;switch(t){case"xml":i=(new egret3d.ParticleParser).parseXml(e);break;case"json":i=(new egret3d.ParticleParser).parseJson(e)}return i},MapParserUtils.jsonVersion=function(t,e,i){var r;switch(t){case 1:r=new egret3d.MapJsonParser_1(e,i)}return r},MapParserUtils.xmlVersion=function(t,e,i){var r;switch(t){case 1:r=new egret3d.MapXmlParser_1(e,i)}return r},MapParserUtils.binVersion=function(){return null},MapParserUtils}();egret3d.MapParserUtils=MapParserUtils}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(t,e){this._data=t,this._mapConfigParser=e,this._versionParser=null}return t.prototype.parser=function(){},t.prototype.parseTexture=function(){},t.prototype.parseMethod=function(){return null},t.prototype.parseMat=function(){return null},t.prototype.parseNode=function(){return null},t.prototype.parseEnvironment=function(){},t.prototype.parseHud=function(){return null},t}();t.MapParser=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(t){function e(e,i){t.call(this,e,i)}return __extends(e,t),e}(t.MapParser);t.MapBinParser=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(t,i){e.call(this,t,i),this._mapConfigParser.version=Number(t.version)}return __extends(i,e),i.prototype.parser=function(){if(this._versionParser=t.MapParserUtils.jsonVersion(this._mapConfigParser.version,this._data,this._mapConfigParser),this.parseEnvironment(this._data.env),this._data.skeletonAnimations)for(var e=0;e<this._data.skeletonAnimations.length;e++){var i=this._data.skeletonAnimations[e],r=Number(i.id);i&&(this._mapConfigParser.skeletonAnimationDict[r]=i,this._mapConfigParser.calculateSkeletonAnimationTask(i))}if(this._data.mats)for(var e=0;e<this._data.mats.length;e++){var a=this._versionParser.parseMat(this._data.mats[e]);a&&(this._mapConfigParser.matDict[a.id]=a,this._mapConfigParser.calculateMatTask(a))}if(this._data.nodes)for(var e=0;e<this._data.nodes.length;e++){var n=this._versionParser.parseNode(this._data.nodes[e]);n&&(this._mapConfigParser.nodeList.push(n),this._mapConfigParser.calculateNodeTask(n))}if(this._data.textures)for(var e=0;e<this._data.textures.length;e++)this._versionParser.parseTexture(this._data.textures[e]);if(this._data.huds)for(var e=0;e<this._data.huds.length;e++){var o=this._versionParser.parseHud(this._data.huds[e]);o&&(this._mapConfigParser.hudList.push(o),this._mapConfigParser.calculateHudTask(o))}this._mapConfigParser.processNode()},i}(t.MapParser);t.MapJsonParser=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.apply(this,arguments)}return __extends(i,e),i.prototype.parseMethod=function(e){var i,r=[];for(var a in e){i=new t.MatMethodData,i.type=a;var n=e[a];for(var o in n)if("textures"==o)for(var s in n.textures){var h={};for(var l in n.textures[s])h[l]=n.textures[s][l];i.texturesData.push(h)}else{var u=typeof i[o];i[o]="string"==u?n[o]:"number"==u?Number(n[o]):"boolean"==u?"true"==n[o]?!0:!1:n[o]}r.push(i)}return r},i.prototype.parseMat=function(e){var i=new t.MatSphereData;for(var r in e)switch(r){case"uvRectangle":i.uvRectangle.x=Number(e.uvRectangle.x),i.uvRectangle.y=Number(e.uvRectangle.y),i.uvRectangle.width=Number(e.uvRectangle.width),i.uvRectangle.height=Number(e.uvRectangle.height);break;case"methods":i.methods=this.parseMethod(e.methods);break;case"blendMode":i[r]=t.BlendMode[e[r]];break;case"lightIds":for(var a=e[r].split(","),n=0;n<a.length;++n)i.lightIds.push(Number(a[n]));break;default:var o=typeof i[r];"number"==o?i[r]=Number(e[r]):"boolean"==o?i[r]="true"==e[r]:"string"==o&&(i[r]=e[r])}return i},i.prototype.parseNode=function(e){var i=new t.MapNodeData;for(var r in e)if("pos"==r||"rot"==r||"scale"==r)for(var a in e[r])i[a]=Number(e[r][a]);else if("geometry"==r)for(var n in e[r])i.geometry[n]="type"==n?e[r][n]:Number(e[r][n]);else if("skinClips"==r)for(var o=0;o<e.skinClips.length;++o)i.skinClips.push(e.skinClips[o]);else if("propertyAnims"==r)for(var o=0;o<e.propertyAnims.length;++o)i.propertyAnims.push(e.propertyAnims[o]);else if("mats"==r)i.materialIDs=(e[r]+"").split(",");else if("subs"==r)for(var o=0;o<e.subs.length;++o)i.childs.push(e.subs[o]);else if("boneBind"==r)i.boneBind=e.boneBind;else{var s=typeof i[r];i[r]="number"==s?Number(e[r]):"boolean"==s?"true"==e[r]?!0:!1:e[r]}return i},i.prototype.parseEnvironment=function(e){if(this._mapConfigParser.directLight="open"==e.directLight,this._mapConfigParser.pointLight="open"==e.pointLight,e.lights)for(var i=0;i<e.lights.length;++i){var r=new t.MapLightData,a=e.lights[i];for(var n in a)switch(n){case"id":case"diffuseColor":case"ambientColor":case"intensity":case"halfIntensity":case"falloff":case"radius":r[n]=Number(a[n]);break;case"type":r[n]=a.type;break;case"direction":r.direction.x=Number(a[n].x),r.direction.y=Number(a[n].y),r.direction.z=Number(a[n].z);break;case"position":r.position.x=Number(a[n].x),r.position.y=Number(a[n].y),r.position.z=Number(a[n].z)}this._mapConfigParser.lightDict[r.id]=r}},i.prototype.parseHud=function(e){var i=new t.HUDData;for(var r in e)if("pos"==r||"rot"==r||"size"==r)for(var a in e[r])i[a]=Number(e[r][a]);else i[r]="bothside"==r?"true"==e[r]:e[r];return i},i.prototype.parseTexture=function(t){this._mapConfigParser.textures.push(t),this._mapConfigParser.calculateTextureTask(t)
},i}(t.MapJsonParser);t.MapJsonParser_1=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(t,i){e.call(this,t,i);var r=t.getElementsByTagName("version");this._mapConfigParser.version=Number(r[0].textContent)}return __extends(i,e),i.prototype.parser=function(){this._versionParser=t.MapParserUtils.xmlVersion(this._mapConfigParser.version,this._data,this._mapConfigParser);var e=this._data.getElementsByTagName("mat"),i=this._data.getElementsByTagName("node"),r=this._data.getElementsByTagName("env"),a=(this._data.getElementsByTagName("cameraAnims"),this._data.getElementsByTagName("hud")),n=this._data.getElementsByTagName("texture");this.parseEnvironment(r);for(var o=0;o<e.length;o++){var s=this._versionParser.parseMat(e[o]);s&&(this._mapConfigParser.matDict[s.id]=s,this._mapConfigParser.calculateMatTask(s))}for(var o=0;o<i.length;o++){var h=this._versionParser.parseNode(i[o]);h&&(this._mapConfigParser.nodeList.push(h),this._mapConfigParser.calculateNodeTask(h))}for(var o=0;o<n.length;o++)this.parseTexture(n[o]);for(var o=0;o<a.length;o++){var l=this._versionParser.parseHud(a[o]);l&&(this._mapConfigParser.hudList.push(l),this._mapConfigParser.calculateHudTask(l))}this._mapConfigParser.processNode()},i.prototype.nodeFilter=function(t){return"#text"==t.nodeName||"#comment"==t.nodeName},i}(t.MapParser);t.MapXmlParser=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.apply(this,arguments)}return __extends(i,e),i.prototype.parseTexture=function(t){if(1==t.childNodes.length)return null;var e,i=null,r=0,a=0;for(r=0,a=t.childNodes.length;a>r;r++)if(e=t.childNodes[r],!this.nodeFilter(e)){for(var n={},o=0;o<e.attributes.length;++o)i=e.attributes[o],n[i.name]=i.value;this._mapConfigParser.textures.push(n),this._mapConfigParser.calculateTextureTask(n)}},i.prototype.parseMethod=function(e){if(e.childNodes.length<=1)return null;for(var i,r,a,n=[],o=0,s=null,h=0,o=e.childNodes.length;o>h;h++)if(i=e.childNodes[h],r=i.nodeName,!this.nodeFilter(i)){a=new t.MatMethodData,a.type=r;for(var l=0;l<i.attributes.length;++l){s=i.attributes[l];var u=typeof a[s.name];a[s.name]="string"==u?s.value:"number"==u?Number(s.value):"boolean"==u?"true"==s.value?!0:!1:s.value}for(var l=0;l<i.childNodes.length;++l){var c=i.childNodes[l];if(!this.nodeFilter(c)){for(var d={},p=0;p<c.attributes.length;++p)s=c.attributes[p],d[s.name]=s.value;a.texturesData.push(d)}}n.push(a)}return n},i.prototype.parseMat=function(e){if(0==e.childNodes.length)return null;for(var i=new t.MatSphereData,r=null,a=0;a<e.attributes.length;++a)r=e.attributes[a],i[r.name]=r.value;for(var n,o,s=0,a=0,s=e.childNodes.length;s>a;a++)if(n=e.childNodes[a],o=n.nodeName,!this.nodeFilter(n))if("methods"==o)i.methods=this.parseMethod(n);else if("uvRectangle"==o)for(var h=0;h<n.attributes.length;++h)i.uvRectangle[n.attributes[h].name]=Number(n.attributes[h].value);else if("blendMode"==o)i[n.nodeName]=t.BlendMode[n.textContent];else if("lightIds"==o){if(n.textContent)for(var l=n.textContent.split(","),h=0;h<l.length;++h)i.lightIds.push(Number(l[h]))}else{var u=typeof i[n.nodeName];"string"==u?i[n.nodeName]=n.textContent:"number"==u?i[n.nodeName]=Number(n.textContent):"boolean"==u&&(i[n.nodeName]="true"==n.textContent?!0:!1)}return i},i.prototype.parseNode=function(e){if(1==e.childNodes.length)return null;for(var i=null,r=new t.MapNodeData,a=0;a<e.attributes.length;++a){i=e.attributes[a];var n=typeof r[i.name];r[i.name]="number"==n?Number(i.value):"boolean"==n?"true"==i.value?!0:!1:i.value}var o,s,a=0,h=0;for(a=0,h=e.childNodes.length;h>a;a++)if(o=e.childNodes[a],s=o.nodeName,!this.nodeFilter(o))if("pos"==s)for(var l=0;l<o.attributes.length;++l)i=o.attributes[l],r[i.nodeName]=Number(i.value);else if("rot"==s)for(var l=0;l<o.attributes.length;++l)i=o.attributes[l],r[i.nodeName]=Number(i.value);else if("scale"==s)for(var l=0;l<o.attributes.length;++l)i=o.attributes[l],r[i.nodeName]=Number(i.value);else if("mat"==s)for(var l=0;l<o.attributes.length;++l)i=o.attributes[l],"id"==i.nodeName&&(r.materialIDs=(i.value+"").split(","));else if("skinClip"==s){var u={};r.skinClips.push(u);for(var l=0;l<o.attributes.length;++l)i=o.attributes[l],u[i.nodeName]=i.value}else if("propertyAnim"==s){var c={};r.propertyAnims.push(c);for(var l=0;l<o.attributes.length;++l)i=o.attributes[l],c[i.nodeName]=i.value}else if("geometry"==s){for(var d={},l=0;l<o.attributes.length;++l)i=o.attributes[l],d[i.name]="type"==i.name?i.value:Number(i.value);r.geometry=d}else if("sub"==s){for(var p={},l=0;l<o.attributes.length;++l)i=o.attributes[l],p[i.name]=i.value;r.childs.push(p)}return r},i.prototype.parseEnvironment=function(e){if(!(e.length<=0)){for(var i,r,a,n=null,o=0;o<e[0].attributes.length;++o)n=e[0].attributes[o],this._mapConfigParser[n.name]="open"==n.value;for(var s=0,h=e.length;h>s;s++){i=e[s];for(var l=0;l<i.childNodes.length;++l)if(r=i.childNodes[l],!this.nodeFilter(r))if("light"==r.nodeName){for(var u=new t.MapLightData,o=0;o<r.attributes.length;++o)n=r.attributes[o],u[n.name]="id"==n.name?Number(n.value):n.value;this._mapConfigParser.lightDict[u.id]=u;for(var o=0;o<r.childNodes.length;++o)if(a=r.childNodes[o],!this.nodeFilter(a))if("direction"==a.nodeName)for(var c=0;c<a.attributes.length;++c)n=a.attributes[c],u.direction[n.name]=Number(n.value);else if("position"==a.nodeName)for(var c=0;c<a.attributes.length;++c)n=a.attributes[c],u.position[n.name]=Number(n.value);else"type"==a.nodeName?u.type=t.LightType[a.textContent]:u[a.nodeName]=Number(a.textContent)}else"fog"==r.nodeName}}},i.prototype.parseHud=function(e){if(1==e.childNodes.length)return null;for(var i=null,r=new t.HUDData,a=0;a<e.attributes.length;++a)i=e.attributes[a],r[i.nodeName]="bothside"==i.nodeName?"true"==i.value:i.value;var n,o,a=0,s=0;for(a=0,s=e.childNodes.length;s>a;a++)if(n=e.childNodes[a],o=n.nodeName,!this.nodeFilter(n))for(var h=0;h<n.attributes.length;++h)i=n.attributes[h],r[i.nodeName]="shader"==o?i.value:Number(i.value);return r},i}(t.MapXmlParser);t.MapXmlParser_1=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){void 0===i&&(i=null),e.call(this),this.container=null,this.autoPlayAnimation=!1,this._pathRoot="",this._path="",this._mapParser=null,this._textures={},this._taskCount=0,this._event=new t.LoaderEvent3D,this._type="",this.huds=new Array,this.skinClipDict={},this.taskTotal=0,this.taskCurrent=0,this.lightDict={},this._taskDict={},this.container=new t.Object3D,i&&this.load(i)}return __extends(i,e),Object.defineProperty(i.prototype,"mapParser",{get:function(){return this._mapParser},enumerable:!0,configurable:!0}),i.prototype.findTexture=function(t){return this._textures[t]},i.prototype.load=function(e){var i=e.lastIndexOf("/");i++,this._pathRoot=e.substr(0,i),this._path=e,i=e.lastIndexOf("."),i++,this._type=e.substr(i,e.length-i),this.taskTotal++,this._taskDict[this._path]=1,this.addTask(),t.AssetManager.instance.loadAsset(this._path,this.onConfigLoad,this)},i.prototype.parseConfig=function(e,i){this._mapParser=t.MapParserUtils.parserConfig(e,i);for(var r in this._mapParser.taskDict)this.taskTotal++,this._taskDict[this._pathRoot+r]=1;this.processSkinClip(),this.createLight();for(var a=0;a<this._mapParser.nodeList.length;a++){var n=this._mapParser.nodeList[a];switch(n.object3d.parent||this.container.addChild(n.object3d),("Object3D"==n.type||"Camera3D"==n.type)&&this.doLoadEpa(n),n.type){case"Mesh":if(n.path){var o=this._pathRoot+n.path;this.addTask(),t.AssetManager.instance.loadAsset(o,this.onEsmLoad,this,n)}else n.geometry&&this.processMesh(n,t.GeometryUtil.createGemetryForType(n.geometry.type,n.geometry));break;case"Terrain":if(n.path){var o=this._pathRoot+n.path;this.addTask(),t.AssetManager.instance.loadAsset(o,this.onHeightImg,this,n)}break;case"ParticleEmitter":if(n.path){var o=this._pathRoot+n.path;this.addTask(),t.AssetManager.instance.loadAsset(o,this.onParticleXML,this,n)}}}for(var a=0;a<this._mapParser.textures.length;++a){var s=this._mapParser.textures[a],o=this._pathRoot+s.path;this.addTask(),t.AssetManager.instance.loadAsset(o,this.onTexture,this,s.name)}for(var a=0;a<this._mapParser.hudList.length;++a){var h=this._mapParser.hudList[a],l=new t.HUD;if(l.name=h.name,l.bothside=h.bothside,l.x=h.x,l.y=h.y,l.rotationX=h.rx,l.rotationY=h.ry,l.rotationZ=h.rz,l.width=h.width,l.height=h.height,h.vs&&(l.vsShader=h.vs),h.fs&&(l.fsShader=h.fs),this.huds.push(l),h.hud=l,h.texture){var o=this._pathRoot+h.texture;t.AssetManager.instance.loadAsset(o,this.onHudTexture,this,h)}}},i.prototype.onParticleXML=function(e){var i=e.loader,r=e.param,a=i.ParticleData;a||(a=t.MapParserUtils.particleParser(this._type,i.data),i.ParticleData=a,a.fileUrl=i.url,a.fileName=i.fileName),this.processParticle(a,r),this.processTask(i)},i.prototype.processParticle=function(e,i){if(e.shape.meshFile||e.property.meshFile){if(e.shape.meshFile){var r=this._pathRoot+e.shape.meshFile;this.addTask();var a={};a.particle=e,a.nodeData=i,a.type="shape",t.AssetManager.instance.loadAsset(r,this.onParticleEsmLoad,this,a)}if(e.property.meshFile){var r=this._pathRoot+e.property.meshFile;this.addTask();var a={};a.particle=e,a.nodeData=i,a.type="property",t.AssetManager.instance.loadAsset(r,this.onParticleEsmLoad,this,a)}}else this.processParticleGeometry(e,i);return null},i.prototype.processParticleGeometry=function(e,i){e.materialData=this._mapParser.matDict[i.materialIDs[0]];var r=new t.ParticleEmitter(e,new t.TextureMaterial);this.processObject3d(i,r),r.play(),this.processMat(i)},i.prototype.processObject3d=function(t,e){e.name=t.object3d.name,e.visible=t.object3d.visible,e.position=t.object3d.position,e.orientation=t.object3d.orientation,e.scale=t.object3d.scale,e.tag=t.object3d.tag,t.object3d.swapObject(e),t.object3d=e},i.prototype.onConfigLoad=function(t){var e=t.loader;this.parseConfig(e.data,this._type),this.processTask(e)},i.prototype.onHeightImg=function(e){var i=e.loader,r=e.param,a=r.geometry,n=new t.ElevationGeometry(i.data,a.width,a.height,a.depth,a.segmentsW,a.segmentsH),o=new t.Mesh(n,new t.TextureMaterial(i.data));this.processHeightMesh(r,o),this.doLoadEpa(r),this.processTask(i)},i.prototype.onTexture=function(t){var e=t.loader,i=t.param;this._textures[i]=e.data,this.processTask(e)},i.prototype.onHudTexture=function(t){var e=t.loader,i=t.param;i.hud.diffuseTexture=e.data,this.processTask(e)},i.prototype.onMaterialTexture=function(t){var e=t.loader,i=t.param,r=null,a=null,n=i.mapNodeData;r=n.object3d,a=r.getMaterial(i.matID),a[i.type]=e.data,this.processTask(e)},i.prototype.onMethodTexture=function(t){var e=t.loader,i=t.param;i.method[i.textureName]=e.data,this.processTask(e)},i.prototype.doLoadEpa=function(e){if(e.propertyAnims)for(var i=0;i<e.propertyAnims.length;++i){var r=e.propertyAnims[i],a=this._pathRoot+r.path;this.addTask(),t.AssetManager.instance.loadAsset(a,this.onEpaLoad,this,e)}},i.prototype.processEpa=function(t,e){t.object3d.bindAnimation(e),this.autoPlayAnimation&&t.object3d.proAnimation&&t.object3d.proAnimation.play()},i.prototype.processHeightMesh=function(t,e){this.processObject3d(t,e),this.processMat(t)},i.prototype.processMesh=function(e,i){var r=this.skinClipDict[e.skeletonAnimation],a=new t.Mesh(i,new t.TextureMaterial,r);this.processObject3d(e,a),this.processMat(e);for(var n=0;n<e.skinClips.length;n++){var o=e.skinClips[n],s=this._pathRoot+o.path,h={};h.eamData=o,h.mapNodeData=e,this.addTask(),t.AssetManager.instance.loadAsset(s,this.onEamLoad,this,h)}},i.prototype.onEsmLoad=function(t){var e=t.loader,i=t.param;i&&(this.processMesh(i,e.data),this.doLoadEpa(i)),this.processTask(e)},i.prototype.onParticleEsmLoad=function(t){var e=t.loader,i=t.param,r=i.particle,a=i.nodeData;switch(i.type){case"shape":r.shape.geometry=e.data;break;case"property":r.property.geometry=e.data}var n=0,o=0;r.shape.meshFile&&n++,r.property.meshFile&&n++,r.shape.geometry&&o++,r.property.geometry&&o++,o==n&&this.processParticleGeometry(r,a),this.processTask(e)},i.prototype.onEamLoad=function(t){var e=t.loader,i=t.param,r=e.data;r.animationName=i.eamData.name;var a=i.mapNodeData.object3d;a.animation.skeletonAnimationController.addSkeletonAnimationClip(r.clone()),this.autoPlayAnimation&&a.animation.play(r.animationName,1,!1,!1),this.processTask(e)},i.prototype.onSkinClip=function(t){var e=t.loader,i=t.param,r=i.skinClip,a=e.data;a.animationName=i.name,a=a.clone(),r.addSkeletonAnimationClip(a),this.autoPlayAnimation&&r.play(a.animationName,1,!1,!1),this.processTask(e)},i.prototype.onEpaLoad=function(t){var e=t.loader,i=t.param,r=e.data,a=r.clone();this.processEpa(i,a),this.processTask(e)},i.prototype.addTask=function(){this._taskCount++},i.prototype.processTaskCurrent=function(e){this._taskDict[e.url]&&(this.taskCurrent++,delete this._taskDict[e.url]),this._event.eventType=t.LoaderEvent3D.LOADER_PROGRESS,this._event.target=this,this._event.loader=e,this._event.data=e,this.dispatchEvent(this._event)},i.prototype.processTask=function(e){if(this.processTaskCurrent(e),this._taskCount--,this._taskCount<=0){for(var i=[],r=0;r<this._mapParser.nodeList.length;r++){var a=this._mapParser.nodeList[r];if(a.object3d instanceof t.ParticleEmitter)for(var n=a.object3d,o=0;o<a.childs.length;++o){var s=a.childs[o],h=this.container.findObject3D(s.name);i.push(h),h instanceof t.ParticleEmitter&&n.addSubEmitter(Number(t.ParticleDataSubEmitterPhase[s.phase]),h)}if(a.boneBind.skeletonAnimation){var l=Number(a.boneBind.skeletonAnimation),u=this.skinClipDict[l];u.bindToJointPose(a.boneBind.boneName,a.object3d)}}for(var c,r=0;r<i.length;r++)c=i[r],c&&c.parent&&c.parent.removeChild(c);if(this._event.eventType=t.LoaderEvent3D.LOADER_COMPLETE,this._event.target=this,this.view3d)for(var r=0;r<this.huds.length;++r)this.view3d.addHUD(this.huds[r]);this.dispatchEvent(this._event)}},i.prototype.addImaTask=function(e,i,r,a){var n=null,o=this._pathRoot+e,s={};return s.type=i,s.matID=r,s.mapNodeData=a,this.addTask(),t.AssetManager.instance.loadAsset(o,this.onMaterialTexture,this,s),n},i.prototype.addMethodImgTask=function(e,i,r){var a=this._pathRoot+e,n={};n.method=i,n.textureName=r,this.addTask();var o=t.AssetManager.instance.loadAsset(a,this.onMethodTexture,this,n);return o},i.prototype.processMat=function(e){for(var i=e.object3d,r=0;r<e.materialIDs.length;++r){var a=this._mapParser.matDict[e.materialIDs[r]];if(a){var n=i.getMaterial(r);n||(n=new t.TextureMaterial,i.addSubMaterial(r,n));var o=null;""!=a.diffuseTextureName&&(o=this.addImaTask(a.diffuseTextureName,"diffuseTexture",r,e,n)),""!=a.normalTextureName&&(o=this.addImaTask(a.normalTextureName,"normalTexture",r,e,n)),""!=a.specularTextureName&&(o=this.addImaTask(a.specularTextureName,"specularTexture",r,e,n)),""!=a.matcapTextureName&&(o=this.addImaTask(a.matcapTextureName,"matcapTexture",r,e,n)),n.diffuseColor=a.diffuseColor,n.ambientColor=a.ambientColor,n.specularColor=a.specularColor,n.tintColor=a.tintColor,n.alpha=a.alpha,n.specularLevel=a.specularLevel,n.gloss=a.gloss,n.castShadow=a.castShadow,n.acceptShadow=a.acceptShadow,n.repeat=a.repeat,n.bothside=a.bothside,n.drawMode=a.drawMode,n.cullMode=a.cullMode,n.blendMode=a.blendMode,n.cutAlpha=a.cutAlpha,n.uvRectangle.copyFrom(a.uvRectangle);for(var s=new t.LightGroup,h=0;h<a.lightIds.length;++h){var l=this.lightDict[a.lightIds[h]];l&&s.addLight(l)}s.lightNum>0&&(n.lightGroup=s),this.processMethod(n,a)}}},i.prototype.processMethod=function(e,i){for(var r=null,a=null,n=0,o=i.methods;n<o.length;n++){a=o[n];var s=t.CheckerboardTexture.texture;if(a.type==t.MatMethodData.methodType.lightmapMethod){var h=new t.LightmapMethod(a.usePower);e.diffusePass.addMethod(h),h.lightTexture=s;var l=a.texturesData[0];r=this.addMethodImgTask(l.path,h,l.attributeName)}else if(a.type==t.MatMethodData.methodType.uvRollMethod){var u=new t.UVRollMethod;e.diffusePass.addMethod(u),u.speedU=a.uSpeed,u.speedV=a.vSpeed,e.repeat=!0,u.start(!0)}else if(a.type==t.MatMethodData.methodType.mulUvRollMethod){var c=new t.MulUVRollMethod;e.diffusePass.addMethod(c),c.diffuseTexture1=s,c.setSpeedU(0,a.uSpeed),c.setSpeedV(0,a.vSpeed);var l=a.texturesData[0];c.setSpeedU(1,l.uSpeed),c.setSpeedV(1,l.vSpeed),r=this.addMethodImgTask(l.path,c,l.attributeName),e.repeat=!0,c.start(!0)}else if(a.type==t.MatMethodData.methodType.alphaMaskMethod){var d=new t.AlphaMaskMethod;e.diffusePass.addMethod(d),d.maskTexture=s;var l=a.texturesData[0];r=this.addMethodImgTask(l.path,d,l.attributeName)}else if(a.type==t.MatMethodData.methodType.streamerMethod){var p=new t.StreamerMethod;e.diffusePass.addMethod(p),p.steamerTexture=s;var l=a.texturesData[0];r=this.addMethodImgTask(l.path,p,l.attributeName),p.speedU=a.uSpeed,p.speedV=a.vSpeed,p.start(!0)}else if(a.type==t.MatMethodData.methodType.terrainARGBMethod){var f=new t.TerrainARGBMethod(s,s,s,s,s);e.diffusePass.addMethod(f);for(var l=null,_=0;_<a.texturesData.length;++_)l=a.texturesData[_],r=this.addMethodImgTask(l.path,f,l.attributeName),0!=_&&f.setUVTitling(_-1,Number(l.uvTitlingX),Number(l.uvTitlingY))}else if(a.type==t.MatMethodData.methodType.waterWaveMethod){var m=new t.WaterWaveMethod;e.diffusePass.addMethod(m),a.deepWaterColor&&(m.deepWaterColor=Number(a.deepWaterColor)),a.shallowWaterColor&&(m.shallowWaterColor=Number(a.shallowWaterColor)),e.repeat=!0}else if(a.type==t.MatMethodData.methodType.waterNormalMethod){var g=new t.WaterNormalMethod;e.diffusePass.addMethod(g),g.normalTextureA=s,g.normalTextureB=s,a.uScale&&a.vScale&&g.setUvScale(Number(a.uScale),Number(a.vScale));for(var l=null,_=0;_<a.texturesData.length;++_)l=a.texturesData[_],g.setUvSpeed(_,Number(l.uSpeed),Number(l.vSpeed)),r=this.addMethodImgTask(l.path,g,l.attributeName)}}},i.prototype.processSkinClip=function(){for(var e in this._mapParser.skeletonAnimationDict){var i=this._mapParser.skeletonAnimationDict[e],r=Number(e),a=new t.SkeletonAnimation;this.skinClipDict[r]=a;for(var n=0;n<i.clips.length;++n){var o=i.clips[n],s=this._pathRoot+o.path;o.skinClip=a,this.addTask(),t.AssetManager.instance.loadAsset(s,this.onSkinClip,this,o)}}},i.prototype.createLight=function(){var e=null;for(var i in this._mapParser.lightDict)if(e=this._mapParser.lightDict[i],e.type==t.LightType.directlight&&this._mapParser.directLight){var r=new t.DirectLight(e.direction);r.lightId=e.id,r.diffuse=e.diffuseColor,r.ambient=e.ambientColor,r.halfIntensity=e.halfIntensity,r.intensity=e.intensity,this.lightDict[e.id]=r}else if(e.type==t.LightType.pointlight&&this._mapParser.pointLight){var a=new t.PointLight(0);a.lightId=e.id,a.position=e.position,a.ambient=e.ambientColor,a.diffuse=e.diffuseColor,a.radius=e.radius,a.cutoff=e.falloff,a.intensity=e.intensity,this.lightDict[e.id]=a}},i}(t.EventDispatcher);t.MapLoader=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){this.type="",this.insID=0,this.parent=0,this.name="",this.path="",this.fov=0,this.clipNear=0,this.clipFar=0,this.tagName="",this.materialIDs=[],this.skinClips=[],this.propertyAnims=[],this.billboard=!1,this.visible=!0,this.x=0,this.y=0,this.z=0,this.rx=0,this.ry=0,this.rz=0,this.rw=0,this.sx=1,this.sy=1,this.sz=1,this.skeletonAnimation=0,this.geometry={},this.childs=[],this.boneBind={}}return t}();t.MapNodeData=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e,i){this.version=1,this.nodeList=new Array,this.hudList=new Array,this.matDict={},this.lightDict={},this.skeletonAnimationDict={},this.directLight=!1,this.pointLight=!1,this.textures=[],this.taskDict={},t.MapParserUtils.mapParser(i,e,this)}return e.prototype.calculateSkeletonAnimationTask=function(t){for(var e=0;e<t.clips;++e){var i=t.clips[e];i.path&&(this.taskDict[t.path]=0)}},e.prototype.calculateMatTask=function(t){""!=t.diffuseTextureName&&(this.taskDict[t.diffuseTextureName]=0),""!=t.normalTextureName&&(this.taskDict[t.normalTextureName]=0),""!=t.specularTextureName&&(this.taskDict[t.specularTextureName]=0);for(var e=0;e<t.methods.length;++e)for(var i=t.methods[e],r=0;r<i.texturesData.length;++r){var a=i.texturesData[r];a.path&&(this.taskDict[a.path]=0)}},e.prototype.calculateNodeTask=function(t){t.path&&(this.taskDict[t.path]=0);for(var e=0;e<t.skinClips.length;e++){var i=t.skinClips[e];i.path&&(this.taskDict[i.path]=0)}for(var e=0;e<t.propertyAnims.length;++e){var r=t.propertyAnims[e];r.path&&(this.taskDict[r.path]=0)}},e.prototype.calculateHudTask=function(t){t.texture&&(this.taskDict[t.texture]=0)},e.prototype.calculateTextureTask=function(t){t.path&&(this.taskDict[t.path]=0)},e.prototype.processNode=function(){for(var e=0;e<this.nodeList.length;e++){var i=this.nodeList[e];if("Camera3D"==i.type){var r=new t.Camera3D;r.fieldOfView=i.fov,r.near=i.clipNear,r.far=i.clipFar,i.object3d=r}else i.object3d="Billboard"==i.type?new t.Billboard(new t.TextureMaterial(t.CheckerboardTexture.texture)):("Terrain"==i.type,new t.Object3D);i.object3d.name=i.name,i.object3d.visible=i.visible,i.object3d.position=new t.Vector3D(i.x,i.y,i.z),i.object3d.orientation=new t.Quaternion(i.rx,i.ry,i.rz,i.rw),i.object3d.scale=new t.Vector3D(i.sx,i.sy,i.sz),""!=i.tagName&&(i.object3d.tag.name=i.tagName)}for(var e=0;e<this.nodeList.length;e++)for(var a=this.nodeList[e],n=0;n<this.nodeList.length;n++){var o=this.nodeList[n];if(a.parent==o.insID){o.object3d.addChild(a.object3d);break}}},e}();t.MapConfigParser=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){this.type="",this.usePower=!1,this.texturesData=[],this.uSpeed=0,this.vSpeed=0}return t.methodType={lightmapMethod:"lightmapMethod",uvRollMethod:"uvRollMethod",mulUvRollMethod:"mulUvRollMethod",alphaMaskMethod:"alphaMaskMethod",streamerMethod:"streamerMethod",terrainARGBMethod:"terrainARGBMethod",waterWaveMethod:"waterWaveMethod",waterNormalMethod:"waterNormalMethod",particleUVRoll:"particleUVRoll"},t}();t.MatMethodData=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.id=0,this.diffuseTextureName="",this.normalTextureName="",this.specularTextureName="",this.matcapTextureName="",this.diffuseColor=0,this.ambientColor=0,this.specularColor=0,this.tintColor=2155905152,this.alpha=0,this.specularLevel=0,this.gloss=0,this.ambientPower=0,this.diffusePower=0,this.normalPower=0,this.castShadow=!1,this.acceptShadow=!1,this.smooth=!1,this.repeat=!1,this.bothside=!1,this.drawMode=0,this.cullMode=0,this.blendMode=0,this.cutAlpha=.7,this.methods=[],this.lightIds=[],this.uvRectangle=new t.Rectangle(0,0,1,1)}return e}();t.MatSphereData=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.id=0,this.type=0,this.diffuseColor=16777215,this.ambientColor=16777215,this.intensity=1,this.halfIntensity=0,this.direction=new t.Vector3D(-.5,-.6,.2),this.position=new t.Vector3D,this.falloff=0,this.radius=100}return e}();t.MapLightData=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){this.bothside=!1}return t}();t.HUDData=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.apply(this,arguments),this._event=new t.ParserEvent3D}return __extends(i,e),i.prototype.parser=function(e){var i=this,r=new t.ByteArray(e),a=new t.ByteArray;r.readBytes(a,0,3),r.position=0;var n=0;switch(n|=a.readUnsignedByte()<<16,n|=a.readUnsignedByte()<<8,n|=a.readUnsignedByte()){case 4473939:this.datas=t.DDSParser.parse(e),this.dataFormat=".dds",this.doLoadComplete();break;case 2:case 16:this.datas=t.TGAParser.parse(e),this.dataFormat=".tga",this.doLoadComplete();break;case 16767231:var o=new Blob([e]);this.dataFormat=".jpg";var s=document.createElement("img");void 0!=window.createObjectURL?s.src=window.createObjectURL(o):void 0!=window.URL?s.src=window.URL.createObjectURL(o):void 0!=window.webkitURL&&(s.src=window.webkitURL.createObjectURL(o)),s.onload=function(){return i.onLoad(s)};break;case 8998990:var o=new Blob([e]);this.dataFormat=".png";var s=document.createElement("img");void 0!=window.createObjectURL?s.src=window.createObjectURL(o):void 0!=window.URL?s.src=window.URL.createObjectURL(o):void 0!=window.webkitURL&&(s.src=window.webkitURL.createObjectURL(o)),s.onload=function(){return i.onLoad(s)};break;case 6648685:this.dataFormat=".esm",this.datas=t.ESMParser.parse(e),this.doLoadComplete();break;case 6644077:this.dataFormat=".eam",this.datas=t.EAMParser.parse(e),this.doLoadComplete();break;case 6644577:this.dataFormat=".eca",this.datas=t.ECAParser.parse(e),this.doLoadComplete();break;default:return!1}return!0},i.prototype.onLoad=function(e){this.datas=new t.ImageTexture(e),this.doLoadComplete()},i.prototype.doLoadComplete=function(){this._event.eventType=t.ParserEvent3D.PARSER_COMPLETE,this._event.data=this,this._event.parser=this,this.dispatchEvent(this._event)},i}(t.EventDispatcher);t.ParserUtils=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e}(t.Object3D);t.Role=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){void 0===i&&(i=null),e.call(this),this.addEventListener(t.LoaderEvent3D.LOADER_COMPLETE,this.onLoaderComplete,this),i&&this.load(i)}return __extends(i,e),i.prototype.onLoaderComplete=function(){this.role=new t.Role;for(var e in this.skinClipDict){this.role.skeletonAnimation=this.skinClipDict[e];break}for(var i=this.container.childs,r=0;r<i.length;){var a=i[r];this.container.removeChild(a),this.role.addChild(a)}},i}(t.MapLoader);t.RoleLoader=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){this.vsShaderList=[],this.fsShaderList=[]}return t.prototype.upload=function(){},t.prototype.activeState=function(){},t.prototype.dispose=function(){},t}();t.MethodBase=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.vsShaderList[t.ShaderPhaseType.base_vertex]=this.vsShaderList[t.ShaderPhaseType.base_vertex]||[],this.vsShaderList[t.ShaderPhaseType.base_vertex].push("gui_vs"),this.fsShaderList[t.ShaderPhaseType.base_fragment]=this.fsShaderList[t.ShaderPhaseType.base_fragment]||[],this.fsShaderList[t.ShaderPhaseType.base_fragment].push("gui_fs")}return __extends(i,e),i.prototype.setTextures=function(t,e){var i="uiTexture_"+t.toString();this.materialData[i]=e,this.materialData[i].useMipmap=!1},i.prototype.upload=function(){},i.prototype.activeState=function(){},i}(t.MethodBase);t.GUIMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r,a,n,o){e.call(this),this.uvs=new Float32Array(8),this.fsShaderList[t.ShaderPhaseType.diffuse_fragment]=this.fsShaderList[t.ShaderPhaseType.diffuse_fragment]||[],this.fsShaderList[t.ShaderPhaseType.diffuse_fragment].push("terrainRGBA_fragment"),this.controlTex=i,this.splat_0=r,this.splat_1=a,this.splat_2=n,this.splat_3=o,this.uvs[0]=1,this.uvs[1]=1,this.uvs[2]=1,this.uvs[3]=1,this.uvs[4]=1,this.uvs[5]=1,this.uvs[6]=1,this.uvs[7]=1}return __extends(i,e),i.prototype.setUVTitling=function(t,e,i){this.uvs[2*t]=e,this.uvs[2*t+1]=i},Object.defineProperty(i.prototype,"splat_0_Texture",{set:function(t){this.splat_0=t,this.materialData.splat_0Tex=t,this.materialData.textureChange=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"splat_1_Texture",{set:function(t){this.splat_1=t,this.materialData.splat_1Tex=t,this.materialData.textureChange=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"splat_2_Texture",{set:function(t){this.splat_2=t,this.materialData.splat_2Tex=t,this.materialData.textureChange=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"splat_3_Texture",{set:function(t){this.splat_3=t,this.materialData.splat_3Tex=t,this.materialData.textureChange=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"controlTexture",{set:function(t){this.controlTex=t,this.materialData.blendMaskTexture=t,this.materialData.textureChange=!0},enumerable:!0,configurable:!0}),i.prototype.upload=function(t,e,i,r,a){i.uvs=a.getUniformLocation(i.program3D,"uvs")},i.prototype.activeState=function(t,e,i,r,a){a.uniform1fv(i.uvs,this.uvs)},i.prototype.dispose=function(){},i}(t.MethodBase);t.TerrainARGBMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){void 0===i&&(i="expHeightFog_fs"),e.call(this),this.uniform_globalFog=new Float32Array(7),this._fogColor=204,this._globalDensity=1,this._fogStartDistance=1e3,this._fogDistanceScale=.5,this._height=500,this._fogAlpha=1,this.vsShaderList[t.ShaderPhaseType.local_vertex]=this.vsShaderList[t.ShaderPhaseType.local_vertex]||[],this.vsShaderList[t.ShaderPhaseType.local_vertex].push("vertexPos_vs"),"line"==i?this.fsShaderList[t.ShaderPhaseType.lighting_fragment].push("lineFog"):"exp"==i?this.fsShaderList[t.ShaderPhaseType.lighting_fragment].push("expFog_fs"):"expHeightFog_fs"==i&&(this.fsShaderList[t.ShaderPhaseType.lighting_fragment]=this.fsShaderList[t.ShaderPhaseType.lighting_fragment]||[],this.fsShaderList[t.ShaderPhaseType.lighting_fragment].push("expHeightFog_fs")),this.uniform_globalFog[0]=.5,this.uniform_globalFog[1]=.6,this.uniform_globalFog[2]=.7,this.uniform_globalFog[3]=this._globalDensity,this.uniform_globalFog[4]=this._fogStartDistance,this.uniform_globalFog[5]=this._height,this.uniform_globalFog[6]=this._fogAlpha}return __extends(i,e),Object.defineProperty(i.prototype,"fogColor",{get:function(){return this.fogColor},set:function(t){this._fogColor=t,this.uniform_globalFog[0]=(this._fogColor>>16&255)/255,this.uniform_globalFog[1]=(this._fogColor>>8&255)/255,this.uniform_globalFog[2]=(255&this._fogColor)/255},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalDensity",{get:function(){return this._globalDensity},set:function(t){this._globalDensity=t,this.uniform_globalFog[3]=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fogStartDistance",{get:function(){return this._fogStartDistance},set:function(t){this._fogStartDistance=t,this.uniform_globalFog[4]=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fogHeight",{get:function(){return this._height},set:function(t){this._height=t,this.uniform_globalFog[5]=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fogAlpha",{get:function(){return this._height},set:function(t){this._height=t,this.uniform_globalFog[6]=t},enumerable:!0,configurable:!0}),i.prototype.upload=function(t,e,i,r,a){i.uniform_globalFog=a.getUniformLocation(i.program3D,"uniform_globalFog")},i.prototype.activeState=function(t,e,i,r,a){a.uniform1fv(i.uniform_globalFog,this.uniform_globalFog)},i.prototype.dispose=function(){},i}(t.MethodBase);t.FogMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.uniform_globalFog=new Float32Array(7),this._fogColor=204,this._fogStartDistance=1e3,this._fogFarDistance=4e4,this._fogAlpha=.6,this.vsShaderList[t.ShaderPhaseType.local_vertex]=this.vsShaderList[t.ShaderPhaseType.local_vertex]||[],this.vsShaderList[t.ShaderPhaseType.local_vertex].push("vertexPos_vs"),this.fsShaderList[t.ShaderPhaseType.multi_end_fragment]=this.fsShaderList[t.ShaderPhaseType.multi_end_fragment]||[],this.fsShaderList[t.ShaderPhaseType.multi_end_fragment].push("lineFog"),this.uniform_globalFog[0]=.5,this.uniform_globalFog[1]=.6,this.uniform_globalFog[2]=.7,this.uniform_globalFog[3]=1,this.uniform_globalFog[4]=this._fogStartDistance,this.uniform_globalFog[5]=this._fogFarDistance,this.uniform_globalFog[6]=this._fogAlpha}return __extends(i,e),Object.defineProperty(i.prototype,"fogColor",{get:function(){return this.fogColor},set:function(t){this._fogColor=t,this.uniform_globalFog[0]=(this._fogColor>>16&255)/255,this.uniform_globalFog[1]=(this._fogColor>>8&255)/255,this.uniform_globalFog[2]=(255&this._fogColor)/255},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fogStartDistance",{get:function(){return this._fogStartDistance},set:function(t){this._fogStartDistance=t,this.uniform_globalFog[4]=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fogFarDistance",{get:function(){return this._fogFarDistance},set:function(t){this._fogFarDistance=t,this.uniform_globalFog[5]=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fogAlpha",{get:function(){return this._fogAlpha
},set:function(t){this._fogAlpha=t,this.uniform_globalFog[6]=t},enumerable:!0,configurable:!0}),i.prototype.upload=function(t,e,i,r,a){i.uniform_globalFog=a.getUniformLocation(i.program3D,"uniform_globalFog")},i.prototype.activeState=function(t,e,i,r,a){a.uniform1fv(i.uniform_globalFog,this.uniform_globalFog)},i.prototype.dispose=function(){},i}(t.MethodBase);t.LineFogMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this._uvRoll=new Float32Array(2),this._speedU=5e-5,this._speedV=0,this._time=0,this._start=!1,this.fsShaderList[t.ShaderPhaseType.diffuse_fragment]=this.fsShaderList[t.ShaderPhaseType.diffuse_fragment]||[],this.fsShaderList[t.ShaderPhaseType.diffuse_fragment].push("uvRoll_fs")}return __extends(i,e),Object.defineProperty(i.prototype,"speedU",{get:function(){return this._speedU},set:function(t){this._speedU=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"speedV",{get:function(){return this._speedV},set:function(t){this._speedV=t},enumerable:!0,configurable:!0}),i.prototype.start=function(t){void 0===t&&(t=!1),t&&(this._time=0),this._start=!0},i.prototype.stop=function(){this._start=!1},i.prototype.upload=function(t,e,i,r,a){i.uvRoll=a.getUniformLocation(i.program3D,"uvRoll")},i.prototype.activeState=function(t,e,i,r,a){this._start&&(this._time+=e),this._uvRoll[0]=this._time*this._speedU,this._uvRoll[1]=this._time*this._speedV,a.uniform1fv(i.uvRoll,this._uvRoll)},i}(t.MethodBase);t.UVRollMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this._uvRoll=new Float32Array(4),this._uvSpeed=new Float32Array(4),this._time=0,this._start=!1,this.fsShaderList[t.ShaderPhaseType.diffuse_fragment]=this.fsShaderList[t.ShaderPhaseType.diffuse_fragment]||[],this.fsShaderList[t.ShaderPhaseType.diffuse_fragment].push("mulUvRoll_fs"),this._uvSpeed[0]=5e-5,this._uvSpeed[1]=0,this._uvSpeed[2]=5e-5,this._uvSpeed[3]=0}return __extends(i,e),i.prototype.setSpeedU=function(t,e){this._uvSpeed[2*t+0]=e},i.prototype.getSpeedU=function(t){return this._uvSpeed[2*t+0]},i.prototype.setSpeedV=function(t,e){this._uvSpeed[2*t+1]=e},i.prototype.getSpeedV=function(t){return this._uvSpeed[2*t+1]},i.prototype.start=function(t){void 0===t&&(t=!1),t&&(this._time=0),this._start=!0},i.prototype.stop=function(){this._start=!1},Object.defineProperty(i.prototype,"diffuseTexture1",{get:function(){return this._diffuseTexture1},set:function(t){this._diffuseTexture1=t,this.materialData.diffuseTexture1=t,this.materialData.textureChange=!0},enumerable:!0,configurable:!0}),i.prototype.upload=function(t,e,i,r,a){i.mulUvRoll=a.getUniformLocation(i.program3D,"mulUvRoll")},i.prototype.activeState=function(t,e,i,r,a){this._start&&(this._time+=e);for(var n=0;4>n;++n)this._uvRoll[n]=this._time*this._uvSpeed[n];a.uniform1fv(i.mulUvRoll,this._uvRoll)},i}(t.MethodBase);t.MulUVRollMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r,a,n){e.call(this),this._uvSpriteSheet=new Float32Array(4),this._uvRectangle=new t.Rectangle,this._speed=0,this._time=0,this._numTime=.4,this._start=!1,this._frameNum=12,this._row=4,this._column=4,this._currentFrame=0,this.frameList=[],this._change=!0,this.fsShaderList[t.ShaderPhaseType.diffuse_fragment]=this.fsShaderList[t.ShaderPhaseType.diffuse_fragment]||[],this.fsShaderList[t.ShaderPhaseType.diffuse_fragment].push("uvSpriteSheet_fs"),this.frameNum=i,this.row=r,this.column=a,this.numTime=n}return __extends(i,e),i.prototype.caculate=function(){this._change=!1,this._speed=1e3*this._numTime/this._frameNum,this._uvRectangle.x=0,this._uvRectangle.y=0,this._uvRectangle.width=1/this._row,this._uvRectangle.height=1/this._column,this.frameList.length=this._frameNum;for(var e=0,i=0,r=0;r<this._frameNum;r++){e=r%this._row,i=Math.floor(r/this._column);var a=new t.Rectangle;a.x=e*this._uvRectangle.width+this._uvRectangle.x,a.y=i*this._uvRectangle.height+this._uvRectangle.y,a.width=this._uvRectangle.width,a.height=this._uvRectangle.height,this.frameList[r]=a}},Object.defineProperty(i.prototype,"numTime",{get:function(){return this._numTime},set:function(t){this._numTime!=t&&(this._change=!0,this._numTime=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"frameNum",{get:function(){return this._frameNum},set:function(t){this._frameNum!=t&&(this._change=!0,this._frameNum=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"row",{get:function(){return this._row},set:function(t){this._row!=t&&(this._change=!0,this._row=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"column",{get:function(){return this._column},set:function(t){this._column!=t&&(this._change=!0,this._column=t)},enumerable:!0,configurable:!0}),i.prototype.start=function(t){void 0===t&&(t=!1),t&&(this._time=0),this._start=!0},i.prototype.stop=function(){this._start=!1},i.prototype.upload=function(t,e,i,r,a){i.uvSpriteSheet=a.getUniformLocation(i.program3D,"uvSpriteSheet")},i.prototype.activeState=function(t,e,i,r,a){this._change&&this.caculate(),this._start&&(this._time+=e,this._time/this._speed>1&&(this._currentFrame++,this._time=0)),this._currentFrame=this._currentFrame%this._frameNum,this._uvSpriteSheet[0]=this.frameList[this._currentFrame].x,this._uvSpriteSheet[1]=this.frameList[this._currentFrame].y,this._uvSpriteSheet[2]=this.frameList[this._currentFrame].width,this._uvSpriteSheet[3]=this.frameList[this._currentFrame].height,a.uniform1fv(i.uvSpriteSheet,this._uvSpriteSheet)},i}(t.MethodBase);t.UVSpriteSheetMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){void 0===i&&(i=!0),e.call(this),this.vsShaderList[t.ShaderPhaseType.local_vertex]=this.vsShaderList[t.ShaderPhaseType.local_vertex]||[],this.vsShaderList[t.ShaderPhaseType.local_vertex].push("secondaryUV_vs"),i?(this.fsShaderList[t.ShaderPhaseType.shadow_fragment]=this.fsShaderList[t.ShaderPhaseType.shadow_fragment]||[],this.fsShaderList[t.ShaderPhaseType.shadow_fragment].push("lightMapSpecularPower_fs")):(this.fsShaderList[t.ShaderPhaseType.shadow_fragment]=this.fsShaderList[t.ShaderPhaseType.shadow_fragment]||[],this.fsShaderList[t.ShaderPhaseType.shadow_fragment].push("lightMap_fs"))}return __extends(i,e),Object.defineProperty(i.prototype,"lightTexture",{set:function(t){this.texture=t,this.materialData.lightTexture!=this.texture&&(this.materialData.lightTexture=this.texture,this.materialData.lightTexture.useMipmap=!1,this.materialData.textureChange=!0)},enumerable:!0,configurable:!0}),i.prototype.upload=function(){},i.prototype.activeState=function(){},i}(t.MethodBase);t.LightmapMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this._speed=new t.Vector3D,this._time=0,this._windData=new Float32Array(4),this.vsShaderList[t.ShaderPhaseType.local_vertex]=this.vsShaderList[t.ShaderPhaseType.local_vertex]||[],this.vsShaderList[t.ShaderPhaseType.local_vertex].push("detail_Bending_vs")}return __extends(i,e),Object.defineProperty(i.prototype,"windDirAndSpeed",{get:function(){return this._speed},set:function(t){this._speed=t,this._windData[1]=t.x,this._windData[2]=t.y,this._windData[3]=t.z},enumerable:!0,configurable:!0}),i.prototype.upload=function(t,e,i,r,a){i.uniformTime=a.getUniformLocation(i.program3D,"uniformTime")},i.prototype.activeState=function(t,e,i,r,a){this._time+=e,this._windData[0]=this._time,a.uniform1fv(i.uniformTime,this._windData)},i}(t.MethodBase);t.PlantDistortedMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.fsShaderList[t.ShaderPhaseType.shadow_fragment]=this.fsShaderList[t.ShaderPhaseType.shadow_fragment]||[],this.fsShaderList[t.ShaderPhaseType.shadow_fragment].push("alphaMask_fs")}return __extends(i,e),Object.defineProperty(i.prototype,"maskTexture",{set:function(t){this.texture=t,this.materialData.maskTexture=this.texture,this.materialData.textureChange=!0},enumerable:!0,configurable:!0}),i.prototype.upload=function(){},i.prototype.activeState=function(){},i}(t.MethodBase);t.AlphaMaskMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this),this.aoPower=1,this.fsShaderList[t.ShaderPhaseType.shadow_fragment]=this.fsShaderList[t.ShaderPhaseType.shadow_fragment]||[],this.fsShaderList[t.ShaderPhaseType.shadow_fragment].push("AOMap_fs"),this.lightTexture=i}return __extends(i,e),Object.defineProperty(i.prototype,"lightTexture",{set:function(t){this.texture=t,this.materialData.aoTexture=this.texture,this.materialData.textureChange=!0},enumerable:!0,configurable:!0}),i.prototype.upload=function(t,e,i,r,a){i.aoPower=a.getUniformLocation(i.program3D,"aoPower")},i.prototype.activeState=function(t,e,i,r,a){a.uniform1f(i.aoPower,this.aoPower)},i.prototype.dispose=function(){},i}(t.MethodBase);t.AOMapMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.fsShaderList[t.ShaderPhaseType.multi_end_fragment]=this.fsShaderList[t.ShaderPhaseType.multi_end_fragment]||[],this.fsShaderList[t.ShaderPhaseType.multi_end_fragment].push("colorTransform_fs")}return __extends(i,e),Object.defineProperty(i.prototype,"colorTransform",{get:function(){return this.materialData.colorTransform},set:function(t){this.materialData.colorTransform=t},enumerable:!0,configurable:!0}),i.prototype.upload=function(t,e,i,r,a){i.uniform_colorTransformAlpha=a.getUniformLocation(i.program3D,"uniform_colorTransformAlpha"),i.uniform_colorTransformM44=a.getUniformLocation(i.program3D,"uniform_colorTransformM44")},i.prototype.activeState=function(t,e,i,r,a){a.uniform1f(i.uniform_colorTransformAlpha,this.colorTransform.alpha),a.uniformMatrix4fv(i.uniform_colorTransformM44,!1,this.colorTransform.m44.rawData)},i}(t.MethodBase);t.ColorTransformMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this._posStart=new t.Vector3D,this._posEnd=new t.Vector3D,this._color=new t.Color,this._zeroVector=new t.Vector3D,this._helpVector=new t.Vector3D,this._helpMatrix=new t.Matrix4_4,this.fsShaderList[t.ShaderPhaseType.multi_end_fragment]=this.fsShaderList[t.ShaderPhaseType.multi_end_fragment]||[],this.fsShaderList[t.ShaderPhaseType.multi_end_fragment].push("colorGradients_fs"),this.vsShaderList[t.ShaderPhaseType.local_vertex]=this.vsShaderList[t.ShaderPhaseType.local_vertex]||[],this.vsShaderList[t.ShaderPhaseType.local_vertex].push("vertexPos_vs")}return __extends(i,e),i.prototype.setStartData=function(t,e,i){this._color.copyFrom(i),this._posStart.copyFrom(t),this._posEnd.copyFrom(e),this._posStart.w=0,this._posEnd.w=0},i.prototype.upload=function(t,e,i,r,a){i.uniform_colorGradientsSource=a.getUniformLocation(i.program3D,"uniform_colorGradientsSource")},i.prototype.activeState=function(t,e,i,r,a,n,o){this._helpMatrix.identity(),this._helpMatrix.copyFrom(o.viewMatrix),this._helpMatrix.transformVector(this._posStart,this._helpVector),this.materialData.colorGradientsSource[0]=this._helpVector.x,this.materialData.colorGradientsSource[1]=this._helpVector.y,this.materialData.colorGradientsSource[2]=this._helpVector.z,this._helpMatrix.transformVector(this._posEnd,this._helpVector),this.materialData.colorGradientsSource[3]=this._helpVector.x,this.materialData.colorGradientsSource[4]=this._helpVector.y,this.materialData.colorGradientsSource[5]=this._helpVector.z,this.materialData.colorGradientsSource[6]=this._color.r,this.materialData.colorGradientsSource[7]=this._color.g,this.materialData.colorGradientsSource[8]=this._color.b,this.materialData.colorGradientsSource[9]=this._color.a,a.uniform1fv(i.uniform_colorGradientsSource,this.materialData.colorGradientsSource)},i}(t.MethodBase);t.ColorGradientsMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this._uvRoll=new Float32Array(3),this._speedU=1e-4,this._speedV=1e-4,this._intensity=.9,this._time=0,this._start=!1,this.fsShaderList[t.ShaderPhaseType.diffuse_fragment]=this.fsShaderList[t.ShaderPhaseType.diffuse_fragment]||[],this.fsShaderList[t.ShaderPhaseType.diffuse_fragment].push("uvStreamerRoll_fs"),this.start()}return __extends(i,e),Object.defineProperty(i.prototype,"speedU",{get:function(){return this._speedU},set:function(t){this._speedU=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"speedV",{get:function(){return this._speedV},set:function(t){this._speedV=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"steamerTexture",{get:function(){return this._steamerTexture},set:function(t){this._steamerTexture=t,this.materialData.streamerTexture=t,this.materialData.textureChange=!0},enumerable:!0,configurable:!0}),i.prototype.start=function(t){void 0===t&&(t=!1),t&&(this._time=0),this._start=!0},i.prototype.stop=function(){this._start=!1},i.prototype.upload=function(t,e,i,r,a){i.uvRoll=a.getUniformLocation(i.program3D,"uvRoll")},i.prototype.activeState=function(t,e,i,r,a){this._start&&(this._time+=e),this._uvRoll[0]=this._time*this._speedU,this._uvRoll[1]=this._time*this._speedV,this._uvRoll[2]=this._intensity,a.uniform1fv(i.uvRoll,this._uvRoll)},i}(t.MethodBase);t.StreamerMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this),this.materialData=i.materialData,this.vsShaderList[t.ShaderPhaseType.local_vertex]=this.vsShaderList[t.ShaderPhaseType.local_vertex]||[],this.vsShaderList[t.ShaderPhaseType.local_vertex].push("shadowMapping_vs"),this.fsShaderList[t.ShaderPhaseType.shadow_fragment]=this.fsShaderList[t.ShaderPhaseType.shadow_fragment]||[],this.fsShaderList[t.ShaderPhaseType.shadow_fragment].push("shadowMapping_fs")}return __extends(i,e),Object.defineProperty(i.prototype,"shadowMapTexture",{get:function(){return this.materialData.shadowMapTexture},set:function(t){this.materialData.shadowMapTexture!=t&&(this.materialData.shadowMapTexture=t,this.materialData.textureChange=!0)},enumerable:!0,configurable:!0}),i.prototype.upload=function(t,e,i,r,a){i.uniform_ShadowMatrix&&(i.uniform_ShadowMatrix.uniformIndex=a.getUniformLocation(i.program3D,"uniform_ShadowMatrix"))},i.prototype.activeState=function(e,i,r,a,n){var o=t.ShadowCast.instance.shadowCamera;o&&r.uniform_ShadowMatrix&&r.uniform_ShadowMatrix.uniformIndex&&n.uniformMatrix4fv(r.uniform_ShadowMatrix.uniformIndex,!1,o.viewProjectionMatrix.rawData),n.uniform4fv(r.uniform_ShadowColor.uniformIndex,this.materialData.shadowColor)},i}(t.MethodBase);t.ShadowMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.vsShaderList[t.ShaderPhaseType.global_vertex]=this.fsShaderList[t.ShaderPhaseType.global_vertex]||[],this.vsShaderList[t.ShaderPhaseType.global_vertex].push("cube_vertex"),this.fsShaderList[t.ShaderPhaseType.diffuse_fragment]=this.fsShaderList[t.ShaderPhaseType.diffuse_fragment]||[],this.fsShaderList[t.ShaderPhaseType.diffuse_fragment].push("cube_fragment")}return __extends(i,e),i.prototype.upload=function(){},i.prototype.activeState=function(){},i}(t.MethodBase);t.CubeMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.fsShaderList[t.ShaderPhaseType.diffuse_fragment]=this.fsShaderList[t.ShaderPhaseType.diffuse_fragment]||[],this.fsShaderList[t.ShaderPhaseType.diffuse_fragment].push("color_fragment")}return __extends(i,e),i.prototype.upload=function(){},i.prototype.activeState=function(){},i}(t.MethodBase);t.ColorMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this._waveVSData=new Float32Array(12),this._waveFSData=new Float32Array(8),this._time=0,this._start=!1,this._wave_xyz_intensity_0=new t.Vector3D(120,50,70),this._wave_xyz_intensity_1=new t.Vector3D(80,40,80),this._wave_xyz_speed_0=new t.Vector3D(.001,.001,-.001),this._wave_xyz_speed_1=new t.Vector3D(.001,.001,.001),this.vsShaderList[t.ShaderPhaseType.start_vertex]=this.vsShaderList[t.ShaderPhaseType.start_vertex]||[],this.vsShaderList[t.ShaderPhaseType.start_vertex].push("wave_vs"),this.fsShaderList[t.ShaderPhaseType.multi_end_fragment]=this.fsShaderList[t.ShaderPhaseType.multi_end_fragment]||[],this.fsShaderList[t.ShaderPhaseType.multi_end_fragment].push("wave_fs"),this.start(),this._waveVSData[0]=this._wave_xyz_intensity_0.x,this._waveVSData[1]=this._wave_xyz_intensity_0.y,this._waveVSData[2]=this._wave_xyz_intensity_0.z,this._waveVSData[3]=this._wave_xyz_intensity_1.x,this._waveVSData[4]=this._wave_xyz_intensity_1.y,this._waveVSData[5]=this._wave_xyz_intensity_1.z,this._waveVSData[6]=this._wave_xyz_speed_0.x,this._waveVSData[7]=this._wave_xyz_speed_0.y,this._waveVSData[8]=this._wave_xyz_speed_0.z,this._waveVSData[9]=this._wave_xyz_speed_1.x,this._waveVSData[10]=this._wave_xyz_speed_1.y,this._waveVSData[11]=this._wave_xyz_speed_1.z,this._waveFSData[0]=0,this._waveFSData[1]=63/255,this._waveFSData[2]=77/255,this._waveFSData[3]=1,this._waveFSData[4]=71/255,this._waveFSData[5]=118/255,this._waveFSData[6]=138/255,this._waveFSData[7]=1}return __extends(i,e),Object.defineProperty(i.prototype,"deepWaterColor",{get:function(){var t=255*this._waveFSData[0],e=255*this._waveFSData[1],i=255*this._waveFSData[2],r=255*this._waveFSData[3];return r<<24|t<<16|e<<8|i},set:function(t){var e=t>>24&255,i=t>>16&255,r=t>>8&255,a=255&t;this._waveFSData[0]=i/255,this._waveFSData[1]=r/255,this._waveFSData[2]=a/255,this._waveFSData[3]=e/255},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shallowWaterColor",{get:function(){var t=255*this._waveFSData[4],e=255*this._waveFSData[5],i=255*this._waveFSData[6],r=255*this._waveFSData[7];return r<<24|t<<16|e<<8|i},set:function(t){var e=t>>24&255,i=t>>16&255,r=t>>8&255,a=255&t;this._waveFSData[4]=i/255,this._waveFSData[5]=r/255,this._waveFSData[6]=a/255,this._waveFSData[7]=e/255},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"waveTexture",{set:function(t){this._waveTexture=t,t&&this.materialData.waveTexture!=this._waveTexture&&(this.materialData.waveTexture=t,this.materialData.textureChange=!0)},enumerable:!0,configurable:!0}),i.prototype.start=function(t){void 0===t&&(t=!1),t&&(this._time=0),this._start=!0},i.prototype.stop=function(){this._start=!1},i.prototype.upload=function(t,e,i,r,a){i.waveVSData=a.getUniformLocation(i.program3D,"waveVSData"),i.waveFSData=a.getUniformLocation(i.program3D,"waveFSData"),i.time=a.getUniformLocation(i.program3D,"time")},i.prototype.activeState=function(t,e,i,r,a){this._start&&(this._time+=e),a.uniform3fv(i.waveVSData,this._waveVSData),a.uniform4fv(i.waveFSData,this._waveFSData),a.uniform1f(i.time,this._time)},i}(t.MethodBase);t.WaterWaveMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this._uvData=new Float32Array(8),this._time=0,this._start=!1,this._speedU_0=new t.Point(-9e-6,0),this._speedU_1=new t.Point(3e-5,0),this._distion_intensity=new t.Point(.05,.05),this._normal_0_UVScale=4,this._normal_1_UVScale=4,this.fsShaderList[t.ShaderPhaseType.normal_fragment]=this.fsShaderList[t.ShaderPhaseType.normal_fragment]||[],this.fsShaderList[t.ShaderPhaseType.normal_fragment].push("waterNormal_fs"),this.start(),this._uvData[0]=2.5*this._speedU_0.x,this._uvData[1]=2.5*this._speedU_0.y,this._uvData[2]=2.5*this._speedU_1.x,this._uvData[3]=2.5*this._speedU_1.y,this._uvData[4]=this._distion_intensity.x,this._uvData[5]=this._distion_intensity.y,this._uvData[6]=this._normal_0_UVScale,this._uvData[7]=this._normal_1_UVScale}return __extends(i,e),i.prototype.start=function(t){void 0===t&&(t=!1),t&&(this._time=0),this._start=!0},i.prototype.stop=function(){this._start=!1},i.prototype.setUvSpeed=function(t,e,i){switch(t){case 0:this._speedU_0.x=e,this._speedU_0.y=i,this._uvData[0]=2.5*this._speedU_0.x,this._uvData[1]=2.5*this._speedU_0.y;break;case 1:this._speedU_1.x=e,this._speedU_1.y=i,this._uvData[2]=2.5*this._speedU_1.x,this._uvData[3]=2.5*this._speedU_1.y}},i.prototype.setUvScale=function(t,e){this._normal_0_UVScale=t,this._normal_1_UVScale=e,this._uvData[6]=this._normal_0_UVScale,this._uvData[7]=this._normal_1_UVScale},Object.defineProperty(i.prototype,"normalTextureA",{set:function(t){this._normalTexture_0=t,this.materialData.normalTextureA!=this._normalTexture_0&&(this.materialData.normalTextureA=this._normalTexture_0,this.materialData.textureChange=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"normalTextureB",{set:function(t){this._normalTexture_1=t,this.materialData.normalTextureB!=this._normalTexture_1&&(this.materialData.normalTextureB=this._normalTexture_1,this.materialData.textureChange=!0)},enumerable:!0,configurable:!0}),i.prototype.upload=function(t,e,i,r,a){i.waterNormalData=a.getUniformLocation(i.program3D,"waterNormalData"),i.time=a.getUniformLocation(i.program3D,"time")},i.prototype.activeState=function(t,e,i,r,a){this._start&&(this._time+=e),a.uniform2fv(i.waterNormalData,this._uvData),a.uniform1f(i.time,this._time)},i}(t.MethodBase);t.WaterNormalMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.reflectValue=.3,this.fsShaderList[t.ShaderPhaseType.multi_end_fragment]=this.fsShaderList[t.ShaderPhaseType.multi_end_fragment]||[],this.fsShaderList[t.ShaderPhaseType.multi_end_fragment].push("environmentMapping_fragment")}return __extends(i,e),Object.defineProperty(i.prototype,"reflect",{get:function(){return this.reflectValue},set:function(t){this.reflectValue=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"environmentTexture",{set:function(t){this.texture=t,t&&this.materialData.environmentMapTex!=this.texture&&(this.materialData.environmentMapTex=t,this.materialData.textureChange=!0)},enumerable:!0,configurable:!0}),i.prototype.upload=function(t,e,i,r,a){i.reflectValue=a.getUniformLocation(i.program3D,"reflectValue")},i.prototype.activeState=function(t,e,i,r,a){a.uniform1f(i.reflectValue,this.reflectValue)},i}(t.MethodBase);t.EnvironmentMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.sampler2DList=new Array,this.sampler3DList=new Array,this.vertexShader=new t.ShaderBase(t.Shader.vertex),this.fragmentShader=new t.ShaderBase(t.Shader.fragment),this.maxDirectLight=0,this.maxSpotLight=0,this.maxPointLight=0,this.maxBone=0,this.attributeDiry=!0}return e.prototype.dispose=function(){},e}();t.PassUsage=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.apply(this,arguments),this.shaderPhaseTypes={},this.matID=0,this.drawMode=t.DrawMode.TRIANGLES,this.useMipmap=!0,this.normalTexture=t.CheckerboardTexture.texture,this.matcapTexture=t.CheckerboardTexture.texture,this.specularTexture=t.CheckerboardTexture.texture,this.lightTexture=t.CheckerboardTexture.texture,this.maskTexture=t.CheckerboardTexture.texture,this.aoTexture=t.CheckerboardTexture.texture,this.environmentTexture=t.CheckerboardTexture.texture,this.blendMaskTexture=t.CheckerboardTexture.texture,this.splat_0Tex=t.CheckerboardTexture.texture,this.splat_1Tex=t.CheckerboardTexture.texture,this.splat_2Tex=t.CheckerboardTexture.texture,this.splat_3Tex=t.CheckerboardTexture.texture,this.layer=0,this.castShadow=!1,this.acceptShadow=!1,this.shadowColor=new Float32Array([.2,.2,.2,.003]),this.depthTest=!0,this.depthMode=0,this.blendMode=t.BlendMode.NORMAL,this.alphaBlending=!1,this.ambientColor=3355443,this.diffuseColor=16777215,this.specularColor=16777215,this.tintColor=2155905152,this.specularLevel=4,this.gloss=20,this.cutAlpha=0,this.repeat=!1,this.bothside=!1,this.alpha=1,this.albedo=.95,this.specularScale=1,this.normalScale=1,this.uvRectangle=new t.Rectangle(0,0,1,1),this.materialDataNeedChange=!0,this.textureChange=!1,this.textureStateChage=!0,this.cullFrontOrBack=t.ContextConfig.BACK,this.materialSourceData=new Float32Array(20),this.materialSourceData2=new Float32Array(20),this.colorGradientsSource=new Float32Array(10)}return __extends(i,e),i.prototype.clone=function(){var t=new i;t.drawMode=this.drawMode,t.diffuseTexture=this.diffuseTexture,t.shadowMapTexture=this.shadowMapTexture;for(var e=0;4>e;++e)t.shadowColor[e]=this.shadowColor[e];return t.layer=this.layer,t.castShadow=this.castShadow,t.acceptShadow=this.acceptShadow,t.depthTest=this.depthTest,t.blendMode=this.blendMode,t.blend_src=this.blend_src,t.blend_dest=this.blend_dest,t.ambientColor=this.ambientColor,t.diffuseColor=this.diffuseColor,t.specularColor=this.specularColor,t.cutAlpha=this.cutAlpha,t.alpha=this.alpha,t.specularLevel=this.specularLevel,t.gloss=this.gloss,t.albedo=this.albedo,t.specularScale=this.specularScale,t.materialDataNeedChange=this.materialDataNeedChange,t.textureChange=!0,t.cullFrontOrBack=this.cullFrontOrBack,t.colorTransform=this.colorTransform,t},i.prototype.dispose=function(){},i}(Object);t.MaterialData=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e){this._passChange=!0,this._vs_shader_methods={},this._fs_shader_methods={},this.methodList=new Array,this.methodDatas=new Array,this.vsShaderNames=new Array,this.fsShaderNames=new Array,this._helpMatrix=new t.Matrix4_4,this._materialData=e}return e.prototype.addMethod=function(t){var e=this.methodList.indexOf(t);-1==e&&(this.methodList.push(t),t.materialData=this._materialData,this._passChange=!0)},e.prototype.removeMethod=function(t){var e=this.methodList.indexOf(t);-1!=e&&(this.methodList.slice(e),this._passChange=!0)},e.prototype.materialDataChange=function(){this._materialData.materialDataNeedChange=!0},e.prototype.passInvalid=function(){this._passChange=!0},e.prototype.resetTexture=function(){var t;for(var e in this._passUsage.sampler2DList)t=this._passUsage.sampler2DList[e],this._materialData[t.varName]&&(t.texture=this._materialData[t.varName]);var i;for(var e in this._passUsage.sampler3DList)i=this._passUsage.sampler3DList[e],this._materialData[i.varName]&&(i.texture=this._materialData[i.varName]);this._materialData.textureChange=!1},e.prototype.addMethodShaders=function(t,e){for(var i=0;i<e.length;i++)t.addUseShaderName(e[i])},e.prototype.addShaderPhase=function(e,i,r){var a,n,o;for(n in i){a=i[n];for(var s=0;s<a.length;s++){r[n]=r[n]||[],r[n].push(a[s]),o=t.ShaderPhaseType[n];var h=this._materialData.shaderPhaseTypes[e].indexOf(t.ShaderPhaseType[o]);-1!=h&&this._materialData.shaderPhaseTypes[e].splice(h,1)}}},e.prototype.initOthreMethods=function(){for(var t,e,i=0;i<this.methodList.length;i++){var r=this.methodList[i];for(t in r.vsShaderList){e=r.vsShaderList[t];for(var a=0;a<e.length;a++)this._vs_shader_methods[t]=this._vs_shader_methods[t]||[],this._vs_shader_methods[t].push(e[a])}for(t in r.fsShaderList){e=r.fsShaderList[t];for(var a=0;a<e.length;a++)this._fs_shader_methods[t]=this._fs_shader_methods[t]||[],this._fs_shader_methods[t].push(e[a])}}},e.prototype.initUseMethod=function(e){this._passChange=!1,this._passUsage=new t.PassUsage,this._vs_shader_methods={},this._fs_shader_methods={},e&&(e.skeletonAnimationController?(this._passUsage.maxBone=2*e.skeletonAnimationController.jointNum,this._vs_shader_methods[t.ShaderPhaseType.start_vertex]=[],this._vs_shader_methods[t.ShaderPhaseType.start_vertex].push("skeleton_vs")):e.particleAnimationController&&(this._vs_shader_methods[t.ShaderPhaseType.start_vertex]=[],this._vs_shader_methods[t.ShaderPhaseType.start_vertex].push("particle_vs"),this.addShaderPhase(this._passID,e.particleAnimationController.particleAnimationState.vertex_shaders,this._vs_shader_methods),this.addShaderPhase(this._passID,e.particleAnimationController.particleAnimationState.fragment_shaders,this._fs_shader_methods))),this._materialData.acceptShadow&&(this._vs_shader_methods[t.ShaderPhaseType.global_vertex]=this._vs_shader_methods[t.ShaderPhaseType.global_vertex]||[],this._fs_shader_methods[t.ShaderPhaseType.shadow_fragment]=this._fs_shader_methods[t.ShaderPhaseType.shadow_fragment]||[]),-1!=this._materialData.shaderPhaseTypes[t.PassType.diffusePass].indexOf(t.ShaderPhaseType.diffuse_fragment)&&(this._fs_shader_methods[t.ShaderPhaseType.diffuse_fragment]=[],this._fs_shader_methods[t.ShaderPhaseType.diffuse_fragment].push("diffuse_fragment")),-1!=this._materialData.shaderPhaseTypes[t.PassType.diffusePass].indexOf(t.ShaderPhaseType.normal_fragment)&&(this._fs_shader_methods[t.ShaderPhaseType.normal_fragment]=[],this._fs_shader_methods[t.ShaderPhaseType.normal_fragment].push("normalMap_fragment")),-1!=this._materialData.shaderPhaseTypes[t.PassType.diffusePass].indexOf(t.ShaderPhaseType.specular_fragment)&&(this._fs_shader_methods[t.ShaderPhaseType.specular_fragment]=[],this._fs_shader_methods[t.ShaderPhaseType.specular_fragment].push("specularMap_fragment")),-1!=this._materialData.shaderPhaseTypes[t.PassType.diffusePass].indexOf(t.ShaderPhaseType.matCap_fragment)&&(this._fs_shader_methods[t.ShaderPhaseType.matCap_fragment]=[],this._fs_shader_methods[t.ShaderPhaseType.matCap_fragment].push("matCap_TextureMult_fs")),this.lightGroup&&(this._passUsage.maxDirectLight=this.lightGroup.directLightList.length,this._passUsage.maxSpotLight=this.lightGroup.spotLightList.length,this._passUsage.maxPointLight=this.lightGroup.pointLightList.length,this._vs_shader_methods[t.ShaderPhaseType.local_vertex]=this._vs_shader_methods[t.ShaderPhaseType.local_vertex]||[],this._fs_shader_methods[t.ShaderPhaseType.lighting_fragment]=[],this._fs_shader_methods[t.ShaderPhaseType.lighting_fragment].push("lightingBase_fs"),this.lightGroup.directLightList.length&&(this._passUsage.directLightData=new Float32Array(t.DirectLight.stride*this.lightGroup.directLightList.length),this._vs_shader_methods[t.ShaderPhaseType.local_vertex].push("varyingViewDir_vs"),this._fs_shader_methods[t.ShaderPhaseType.lighting_fragment].push("directLight_fragment")),this.lightGroup.spotLightList.length&&(this._passUsage.spotLightData=new Float32Array(t.SpotLight.stride*this.lightGroup.spotLightList.length),this._fs_shader_methods[t.ShaderPhaseType.lighting_fragment].push("spotLight_fragment")),this.lightGroup.pointLightList.length&&(this._passUsage.pointLightData=new Float32Array(t.PointLight.stride*this.lightGroup.pointLightList.length),this._fs_shader_methods[t.ShaderPhaseType.lighting_fragment].push("pointLight_fragment"))),this.initOthreMethods(),this.phaseEnd(e)},e.prototype.phaseEnd=function(e){var i;i=this._vs_shader_methods[t.ShaderPhaseType.base_vertex],i&&i.length>0?this.addMethodShaders(this._passUsage.vertexShader,i):(this.addMethodShaders(this._passUsage.vertexShader,["base_vs"]),i=this._vs_shader_methods[t.ShaderPhaseType.start_vertex],i&&i.length>0?this.addMethodShaders(this._passUsage.vertexShader,i):this.addMethodShaders(this._passUsage.vertexShader,["diffuse_vertex"]),i=this._vs_shader_methods[t.ShaderPhaseType.local_vertex],i&&i.length>0&&this.addMethodShaders(this._passUsage.vertexShader,i),i=this._vs_shader_methods[t.ShaderPhaseType.global_vertex],i&&i.length>0&&this.addMethodShaders(this._passUsage.vertexShader,i),i=this._vs_shader_methods[t.ShaderPhaseType.end_vertex],i&&i.length>0?this.addMethodShaders(this._passUsage.vertexShader,i):this.addMethodShaders(this._passUsage.vertexShader,["end_vs"])),i=this._fs_shader_methods[t.ShaderPhaseType.base_fragment],i&&i.length>0?this.addMethodShaders(this._passUsage.fragmentShader,i):(this.addMethodShaders(this._passUsage.fragmentShader,["base_fs"]),i=this._fs_shader_methods[t.ShaderPhaseType.start_fragment],i&&i.length>0&&this.addMethodShaders(this._passUsage.fragmentShader,i),i=this._fs_shader_methods[t.ShaderPhaseType.materialsource_fragment],i&&i.length>0?this.addMethodShaders(this._passUsage.fragmentShader,i):this.addMethodShaders(this._passUsage.fragmentShader,["materialSource_fs"]),i=this._fs_shader_methods[t.ShaderPhaseType.diffuse_fragment],i&&i.length>0?this.addMethodShaders(this._passUsage.fragmentShader,i):this.addMethodShaders(this._passUsage.fragmentShader,["diffuse_fragment"]),i=this._fs_shader_methods[t.ShaderPhaseType.normal_fragment],i&&i.length>0&&this.addMethodShaders(this._passUsage.fragmentShader,i),i=this._fs_shader_methods[t.ShaderPhaseType.shadow_fragment],i&&i.length>0&&this.addMethodShaders(this._passUsage.fragmentShader,i),i=this._fs_shader_methods[t.ShaderPhaseType.lighting_fragment],i&&i.length>0&&this.addMethodShaders(this._passUsage.fragmentShader,i),i=this._fs_shader_methods[t.ShaderPhaseType.specular_fragment],i&&i.length>0&&this.addMethodShaders(this._passUsage.fragmentShader,i),i=this._fs_shader_methods[t.ShaderPhaseType.matCap_fragment],i&&i.length>0&&this.addMethodShaders(this._passUsage.fragmentShader,i),i=this._fs_shader_methods[t.ShaderPhaseType.multi_end_fragment],i&&i.length>0&&this.addMethodShaders(this._passUsage.fragmentShader,i),i=this._fs_shader_methods[t.ShaderPhaseType.end_fragment],i&&i.length>0?this.addMethodShaders(this._passUsage.fragmentShader,i):e&&e.particleAnimationController?this.addMethodShaders(this._passUsage.fragmentShader,["particle_end_fs"]):this.addMethodShaders(this._passUsage.fragmentShader,["end_fs"]))
},e.prototype.upload=function(e,i,r,a,n,o,s){this._passChange=!1,this.initUseMethod(o,s),this._passUsage.vertexShader.shader=this._passUsage.vertexShader.getShader(this._passUsage),this._passUsage.fragmentShader.shader=this._passUsage.fragmentShader.getShader(this._passUsage),this._passUsage.program3D=t.ShaderPool.getProgram(this._passUsage.vertexShader.shader.id,this._passUsage.fragmentShader.shader.id);for(var h in this._passUsage)-1!=h.indexOf("uniform")&&this._passUsage[h]&&(this._passUsage[h].uniformIndex=r.getUniformLocation(this._passUsage.program3D,h));var l;for(var u in this._passUsage.sampler2DList)l=this._passUsage.sampler2DList[u],l.uniformIndex=r.getUniformLocation(this._passUsage.program3D,l.varName),l.texture=this._materialData[l.varName];var c;for(var u in this._passUsage.sampler3DList)c=this._passUsage.sampler3DList[u],c.uniformIndex=r.getUniformLocation(this._passUsage.program3D,c.varName);if(this.methodList)for(var d=0;d<this.methodList.length;d++)this.methodList[d].upload(e,i,this._passUsage,null,r,a,n)},e.prototype.draw=function(e,i,r,a,n,o,s){if(this._materialData.materialDataNeedChange){var h=this._materialData.tintColor,l=Math.floor(h/16777216),u=(16711680&h)/65536,c=(65280&h)/256,d=255&h;l/=128,u/=128,c/=128,d/=128,this._materialData.materialSourceData[0]=u*(this._materialData.diffuseColor>>16&255)/255,this._materialData.materialSourceData[1]=c*(this._materialData.diffuseColor>>8&255)/255,this._materialData.materialSourceData[2]=d*(255&this._materialData.diffuseColor)/255,this._materialData.materialSourceData[3]=(this._materialData.ambientColor>>16&255)/255,this._materialData.materialSourceData[4]=(this._materialData.ambientColor>>8&255)/255,this._materialData.materialSourceData[5]=(255&this._materialData.ambientColor)/255,this._materialData.materialSourceData[6]=(this._materialData.specularColor>>16&255)/255,this._materialData.materialSourceData[7]=(this._materialData.specularColor>>8&255)/255,this._materialData.materialSourceData[8]=(255&this._materialData.specularColor)/255,this._materialData.materialSourceData[9]=l*this._materialData.alpha,this._materialData.materialSourceData[10]=this._materialData.cutAlpha,this._materialData.materialSourceData[11]=this._materialData.gloss,this._materialData.materialSourceData[12]=this._materialData.specularLevel,this._materialData.materialSourceData[13]=this._materialData.albedo,this._materialData.materialSourceData[14]=this._materialData.uvRectangle.x,this._materialData.materialSourceData[15]=this._materialData.uvRectangle.y,this._materialData.materialSourceData[16]=this._materialData.uvRectangle.width,this._materialData.materialSourceData[17]=this._materialData.uvRectangle.height,this._materialData.materialSourceData[18]=this._materialData.specularLevel,this._materialData.materialSourceData[19]=window.devicePixelRatio}this._passChange&&this.upload(e,i,r,a,n,s,o.geometry),r.setProgram(this._passUsage.program3D),o.activeState(e,i,this._passUsage,r),this._materialData.depthTest?(r.enableDepth(),r.depthFunc(t.ContextConfig.LEQUAL)):(r.disableDepth(),r.depthFunc(t.ContextConfig.LEQUAL)),r.setCulling(this._materialData.cullFrontOrBack),this._materialData.bothside?r.disableCullFace():r.enableCullFace(),this._passID==t.PassType.shadowPass?(r.disableBlend(),r.setBlendFactors(t.ContextConfig.ONE,t.ContextConfig.ZERO)):(this._materialData.alphaBlending&&t.Context3DProxy.gl.depthMask(!1),r.enableBlend(),r.setBlendFactors(this._materialData.blend_src,this._materialData.blend_dest)),this._passUsage.uniform_materialSource&&r.uniform1fv(this._passUsage.uniform_materialSource.uniformIndex,this._materialData.materialSourceData),this._materialData.textureChange&&this.resetTexture(r);var p;for(var f in this._passUsage.sampler2DList)p=this._passUsage.sampler2DList[f],p.texture=this._materialData[p.varName],p.texture&&(p.texture.upload(r),r.setTexture2DAt(p.activeTextureIndex,p.uniformIndex,p.index,p.texture.texture2D),p.texture.useMipmap&&(p.texture.useMipmap=this._materialData.useMipmap),p.texture.repeat=this._materialData.repeat,p.texture.activeState(r),this._materialData.textureStateChage=!1);var _;for(var f in this._passUsage.sampler3DList)_=this._passUsage.sampler3DList[f],_.texture=this._materialData[_.varName],_.texture&&(_.texture.upload(r),r.setCubeTextureAt(_.activeTextureIndex,_.uniformIndex,_.index,_.texture.texture3D));var m=0;if(this.lightGroup){for(m=0;m<this._passUsage.maxDirectLight;m++)this.lightGroup.directLightList[m].updateLightData(n,m,this._passUsage.directLightData);for(m=0;m<this._passUsage.maxSpotLight;m++)this.lightGroup.spotLightList[m].updateLightData(n,m,this._passUsage.spotLightData);for(m=0;m<this._passUsage.maxPointLight;m++)this.lightGroup.pointLightList[m].updateLightData(n,m,this._passUsage.pointLightData);this._passUsage.uniform_directLightSource&&r.uniform1fv(this._passUsage.uniform_directLightSource.uniformIndex,this._passUsage.directLightData),this._passUsage.uniform_sportLightSource&&r.uniform1fv(this._passUsage.uniform_sportLightSource.uniformIndex,this._passUsage.spotLightData),this._passUsage.uniform_pointLightSource&&r.uniform1fv(this._passUsage.uniform_pointLightSource.uniformIndex,this._passUsage.pointLightData)}if(this._passUsage.uniform_ModelMatrix&&r.uniformMatrix4fv(this._passUsage.uniform_ModelMatrix.uniformIndex,!1,a.rawData),this._passUsage.uniform_ViewMatrix&&r.uniformMatrix4fv(this._passUsage.uniform_ViewMatrix.uniformIndex,!1,n.viewMatrix.rawData),this._passUsage.uniform_ProjectionMatrix&&r.uniformMatrix4fv(this._passUsage.uniform_ProjectionMatrix.uniformIndex,!1,n.projectMatrix.rawData),this._passUsage.uniform_ViewProjectionMatrix&&r.uniformMatrix4fv(this._passUsage.uniform_ViewProjectionMatrix.uniformIndex,!1,n.viewProjectionMatrix.rawData),this._passUsage.uniform_orthProectMatrix&&r.uniformMatrix4fv(this._passUsage.uniform_orthProectMatrix.uniformIndex,!1,n.orthProjectionMatrix.rawData),s&&s.activeState(e,i,this._passUsage,o,r,a,n),this.methodList)for(var m=0;m<this.methodList.length;m++)this.methodList[m].activeState(e,i,this._passUsage,null,r,a,n);this._passUsage.uniform_eyepos&&r.uniform3f(this._passUsage.uniform_eyepos.uniformIndex,n.x,n.y,n.z),this._passUsage.uniform_cameraMatrix&&r.uniformMatrix4fv(this._passUsage.uniform_cameraMatrix.uniformIndex,!1,n.modelMatrix.rawData),r.drawElement(this._materialData.drawMode,o.start,o.count),this._materialData.alphaBlending&&t.Context3DProxy.gl.depthMask(!0)},e.prototype.deactiveState=function(t,e){var i;for(var r in t.sampler2DList)i=this._passUsage.sampler2DList[r],i.texture&&e.disableTexture2DAt(i.activeTextureIndex,i.uniformIndex,i.index)},e.prototype.dispose=function(){},e}();t.MaterialPass=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this,i),this._passID=t.PassType.colorPass}return __extends(i,e),i.prototype.initUseMethod=function(e){this._passChange=!1,this._passUsage=new t.PassUsage,this._passUsage.vertexShader.shaderType=t.Shader.vertex,this._passUsage.fragmentShader.shaderType=t.Shader.fragment,e&&(e.skeletonAnimationController?(this._passUsage.maxBone=2*e.skeletonAnimationController.jointNum,this._vs_shader_methods[t.ShaderPhaseType.start_vertex]=[],this._vs_shader_methods[t.ShaderPhaseType.start_vertex].push("skeleton_vs")):e.particleAnimationController&&(this._vs_shader_methods[t.ShaderPhaseType.start_vertex]=[],this._vs_shader_methods[t.ShaderPhaseType.start_vertex].push("particle_vs"),this.addShaderPhase(this._passID,e.particleAnimationController.particleAnimationState.vertex_shaders,this._vs_shader_methods),this.addShaderPhase(this._passID,e.particleAnimationController.particleAnimationState.fragment_shaders,this._fs_shader_methods))),-1!=this._materialData.shaderPhaseTypes[t.PassType.diffusePass].indexOf(t.ShaderPhaseType.diffuse_fragment)&&(this._fs_shader_methods[t.ShaderPhaseType.diffuse_fragment]=[],this._fs_shader_methods[t.ShaderPhaseType.diffuse_fragment].push("diffuse_fragment")),this._fs_shader_methods[t.ShaderPhaseType.end_fragment]=this._fs_shader_methods[t.ShaderPhaseType.end_fragment]||[],this._fs_shader_methods[t.ShaderPhaseType.end_fragment].push("colorPassEnd_fs"),this.phaseEnd(e)},i}(t.MaterialPass);t.ColorPass=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this,i),this._passID=t.PassType.diffusePass}return __extends(i,e),i.prototype.initUseMethod=function(t,i){e.prototype.initUseMethod.call(this,t,i)},i}(t.MaterialPass);t.DiffusePass=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this,i),this._passID=t.PassType.diffusePass}return __extends(i,e),i.prototype.setTexture=function(t,e){this._materialData[t]=e},i.prototype.initUseMethod=function(){this._passChange=!1,this._passUsage=new t.PassUsage,this._vs_shader_methods={},this._fs_shader_methods={},this.lightGroup&&(this._passUsage.maxDirectLight=this.lightGroup.directLightList.length,this._passUsage.maxSpotLight=this.lightGroup.spotLightList.length,this._passUsage.maxPointLight=this.lightGroup.pointLightList.length,this.lightGroup.directLightList.length&&(this._passUsage.directLightData=new Float32Array(t.DirectLight.stride*this.lightGroup.directLightList.length))),this.addMethodShaders(this._passUsage.vertexShader,["FakePBR_vs"]),this.addMethodShaders(this._passUsage.fragmentShader,["materialSource_fs"]),this.addMethodShaders(this._passUsage.fragmentShader,["FakePBR_fs"])},i}(t.MaterialPass);t.FakePBRPass=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this,i),this._passID=t.PassType.shadowPass}return __extends(i,e),i.prototype.initUseMethod=function(e){if(this._passChange=!1,this._passUsage=new t.PassUsage,this._vs_shader_methods={},this._fs_shader_methods={},e){if(e.skeletonAnimationController)this._passUsage.maxBone=2*e.skeletonAnimationController.jointNum,this.addMethodShaders(this._passUsage.vertexShader,["shadowPass_skeleton_vs"]);else if(e.particleAnimationController){this._vs_shader_methods[t.ShaderPhaseType.start_vertex]=[],this._vs_shader_methods[t.ShaderPhaseType.start_vertex].push("particle_vs"),this.addShaderPhase(this._passID,e.particleAnimationController.particleAnimationState.vertex_shaders,this._vs_shader_methods),this.addMethodShaders(this._passUsage.vertexShader,["base_vs"]);var i;i=this._vs_shader_methods[t.ShaderPhaseType.start_vertex],i&&i.length>0&&this.addMethodShaders(this._passUsage.vertexShader,i),i=this._vs_shader_methods[t.ShaderPhaseType.local_vertex],i&&i.length>0&&this.addMethodShaders(this._passUsage.vertexShader,i),i=this._vs_shader_methods[t.ShaderPhaseType.global_vertex],i&&i.length>0&&this.addMethodShaders(this._passUsage.vertexShader,i),i=this._vs_shader_methods[t.ShaderPhaseType.end_vertex],i&&i.length>0&&this.addMethodShaders(this._passUsage.vertexShader,i)}}else this.addMethodShaders(this._passUsage.vertexShader,["shadowPass_vs"]);this.addMethodShaders(this._passUsage.fragmentShader,["shadowPass_fs"])},i}(t.MaterialPass);t.ShadowPass=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this,i),this._passID=t.PassType.CubePass}return __extends(i,e),i.prototype.initUseMethod=function(e){this._passChange=!1,this._passUsage=new t.PassUsage,this._passUsage.vertexShader.shaderType=t.Shader.vertex,this._passUsage.fragmentShader.shaderType=t.Shader.fragment,e&&(e.skeletonAnimationController?(this._passUsage.maxBone=2*e.skeletonAnimationController.jointNum,this._vs_shader_methods[t.ShaderPhaseType.start_vertex]=[],this._vs_shader_methods[t.ShaderPhaseType.start_vertex].push("skeleton_vs")):e.particleAnimationController&&(this._vs_shader_methods[t.ShaderPhaseType.start_vertex]=[],this._vs_shader_methods[t.ShaderPhaseType.start_vertex].push("particle_vs"),this.addShaderPhase(this._passID,e.particleAnimationController.particleAnimationState.vertex_shaders,this._vs_shader_methods),this.addShaderPhase(this._passID,e.particleAnimationController.particleAnimationState.fragment_shaders,this._fs_shader_methods))),-1!=this._materialData.shaderPhaseTypes[t.PassType.diffusePass].indexOf(t.ShaderPhaseType.normal_fragment)&&(this._fs_shader_methods[t.ShaderPhaseType.normal_fragment]=[],this._fs_shader_methods[t.ShaderPhaseType.normal_fragment].push("normalMap_fragment")),this._fs_shader_methods[t.ShaderPhaseType.end_fragment]=this._fs_shader_methods[t.ShaderPhaseType.end_fragment]||[],this._fs_shader_methods[t.ShaderPhaseType.end_fragment].push("normalPassEnd_fs"),this.phaseEnd(e)},i}(t.MaterialPass);t.NormalPass=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this,i),this._passID=t.PassType.CubePass}return __extends(i,e),i.prototype.initUseMethod=function(e){this._passChange=!1,this._passUsage=new t.PassUsage,this._passUsage.vertexShader.shaderType=t.Shader.vertex,this._passUsage.fragmentShader.shaderType=t.Shader.fragment,e&&(e.skeletonAnimationController?(this._passUsage.maxBone=2*e.skeletonAnimationController.jointNum,this._vs_shader_methods[t.ShaderPhaseType.start_vertex]=[],this._vs_shader_methods[t.ShaderPhaseType.start_vertex].push("skeleton_vs")):e.particleAnimationController&&(this._vs_shader_methods[t.ShaderPhaseType.start_vertex]=[],this._vs_shader_methods[t.ShaderPhaseType.start_vertex].push("particle_vs"),this.addShaderPhase(this._passID,e.particleAnimationController.particleAnimationState.vertex_shaders,this._vs_shader_methods),this.addShaderPhase(this._passID,e.particleAnimationController.particleAnimationState.fragment_shaders,this._fs_shader_methods))),this._vs_shader_methods[t.ShaderPhaseType.end_vertex]=this._vs_shader_methods[t.ShaderPhaseType.end_vertex]||[],this._vs_shader_methods[t.ShaderPhaseType.end_vertex].push("positionEndPass_vs"),this._fs_shader_methods[t.ShaderPhaseType.end_fragment]=this._fs_shader_methods[t.ShaderPhaseType.end_fragment]||[],this._fs_shader_methods[t.ShaderPhaseType.end_fragment].push("positionEndPass_fs"),this.phaseEnd(e)},i}(t.MaterialPass);t.PositionPass=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this,i),this._passID=t.PassType.PickPass}return __extends(i,e),i.prototype.initUseMethod=function(e){this._passChange=!1,this._passUsage=new t.PassUsage,this._vs_shader_methods={},this._fs_shader_methods={},e?e.skeletonAnimationController&&(this._passUsage.maxBone=2*e.skeletonAnimationController.jointNum,this.addMethodShaders(this._passUsage.vertexShader,["pickPass_skeleton_vs"])):this.addMethodShaders(this._passUsage.vertexShader,["pickPass_vs"]),this.addMethodShaders(this._passUsage.fragmentShader,["pickPass_fs"])},i}(t.MaterialPass);t.PickPass=e}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t.diffusePass=0]="diffusePass",t[t.colorPass=1]="colorPass",t[t.normalPass=2]="normalPass",t[t.shadowPass=3]="shadowPass",t[t.lightPass=4]="lightPass",t[t.matCapPass=5]="matCapPass",t[t.depthPass_8=6]="depthPass_8",t[t.depthPass_32=7]="depthPass_32",t[t.CubePass=8]="CubePass",t[t.PickPass=9]="PickPass"}(t.PassType||(t.PassType={}));var e=t.PassType,i=function(){function i(){}return i.CreatPass=function(i,r){switch(i){case e.colorPass:return r.shaderPhaseTypes[e.colorPass]=[],[new t.ColorPass(r)];case e.diffusePass:return r.shaderPhaseTypes[e.diffusePass]=[],[new t.DiffusePass(r)];case e.shadowPass:return r.shaderPhaseTypes[e.shadowPass]=[],[new t.ShadowPass(r)];case e.depthPass_8:return r.shaderPhaseTypes[e.depthPass_8]=[],[new t.PositionPass(r)];case e.normalPass:return r.shaderPhaseTypes[e.normalPass]=[],[new t.NormalPass(r)];case e.PickPass:return r.shaderPhaseTypes[e.PickPass]=[],[new t.PickPass(r)]}return null},i.PassAuto=[!0,!0,!0,!1,!1,!0,!0,!0],i}();t.PassUtil=i}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e){void 0===e&&(e=null),this.passes=[],this.setData(null==e?new t.MaterialData:e)}return e.prototype.setData=function(e){this.materialData=e,this.initPass(),this.blendMode=t.BlendMode.NORMAL},e.prototype.getData=function(){return this.materialData},e.prototype.initPass=function(){this.addPass(t.PassType.colorPass)},Object.defineProperty(e.prototype,"lightGroup",{get:function(){return this._lightGroup},set:function(e){if(this._lightGroup=e,this.passes[t.PassType.diffusePass]&&this.passes[t.PassType.diffusePass].length>0)for(var i=0;i<this.passes[t.PassType.diffusePass].length;i++)this.passes[t.PassType.diffusePass][i].lightGroup=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depth",{get:function(){return this.materialData.depthTest},set:function(t){this.materialData.depthTest=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthMode",{get:function(){return this.materialData.depthMode},set:function(t){this.materialData.depthMode=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"diffuseTexture",{get:function(){return this.materialData.diffuseTexture},set:function(e){e&&(this.materialData.diffuseTexture=e,this.materialData.textureChange=!0,this.materialData.shaderPhaseTypes[t.PassType.diffusePass]&&-1==this.materialData.shaderPhaseTypes[t.PassType.diffusePass].indexOf(t.ShaderPhaseType.diffuse_fragment)&&this.materialData.shaderPhaseTypes[t.PassType.diffusePass].push(t.ShaderPhaseType.diffuse_fragment),this.materialData.shaderPhaseTypes[t.PassType.shadowPass]&&-1==this.materialData.shaderPhaseTypes[t.PassType.shadowPass].indexOf(t.ShaderPhaseType.diffuse_fragment)&&this.materialData.shaderPhaseTypes[t.PassType.shadowPass].push(t.ShaderPhaseType.diffuse_fragment))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"normalTexture",{get:function(){return this.materialData.normalTexture},set:function(e){e&&(this.materialData.normalTexture=e,this.materialData.textureChange=!0,this.materialData.shaderPhaseTypes[t.PassType.diffusePass]&&-1==this.materialData.shaderPhaseTypes[t.PassType.diffusePass].indexOf(t.ShaderPhaseType.normal_fragment)&&(this.materialData.shaderPhaseTypes[t.PassType.diffusePass].push(t.ShaderPhaseType.normal_fragment),this.passInvalid(t.PassType.diffusePass)),this.materialData.shaderPhaseTypes[t.PassType.matCapPass]&&-1==this.materialData.shaderPhaseTypes[t.PassType.matCapPass].indexOf(t.ShaderPhaseType.normal_fragment)&&this.materialData.shaderPhaseTypes[t.PassType.matCapPass].push(t.ShaderPhaseType.normal_fragment))},enumerable:!0,configurable:!0}),e.prototype.passInvalid=function(t){if(this.passes[t]&&this.passes[t].length>0)for(var e=0;e<this.passes[t].length;e++)this.passes[t][e].passInvalid()},Object.defineProperty(e.prototype,"matcapTexture",{get:function(){return this.materialData.normalTexture},set:function(e){e&&(this.materialData.matcapTexture=e,this.materialData.textureChange=!0,this.materialData.shaderPhaseTypes[t.PassType.diffusePass]&&-1==this.materialData.shaderPhaseTypes[t.PassType.diffusePass].indexOf(t.ShaderPhaseType.matCap_fragment)&&(this.materialData.shaderPhaseTypes[t.PassType.diffusePass].push(t.ShaderPhaseType.matCap_fragment),this.passInvalid(t.PassType.diffusePass)),this.materialData.shaderPhaseTypes[t.PassType.matCapPass]&&-1==this.materialData.shaderPhaseTypes[t.PassType.matCapPass].indexOf(t.ShaderPhaseType.matCap_fragment)&&this.materialData.shaderPhaseTypes[t.PassType.matCapPass].push(t.ShaderPhaseType.matCap_fragment))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"specularTexture",{get:function(){return this.materialData.specularTexture},set:function(e){e&&(this.materialData.specularTexture=e,this.materialData.textureChange=!0,this.materialData.shaderPhaseTypes[t.PassType.diffusePass]&&-1==this.materialData.shaderPhaseTypes[t.PassType.diffusePass].indexOf(t.ShaderPhaseType.specular_fragment)&&this.materialData.shaderPhaseTypes[t.PassType.diffusePass].push(t.ShaderPhaseType.specular_fragment))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"drawMode",{get:function(){return this.materialData.drawMode},set:function(t){this.materialData.drawMode=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cutAlpha",{get:function(){return this.materialData.cutAlpha},set:function(t){this.materialData.cutAlpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"diffuseColor",{get:function(){return this.materialData.diffuseColor},set:function(t){this.materialData.materialDataNeedChange=!0,this.materialData.diffuseColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ambientColor",{get:function(){return this.materialData.ambientColor},set:function(t){this.materialData.materialDataNeedChange=!0,this.materialData.ambientColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"specularColor",{get:function(){return this.materialData.specularColor},set:function(t){this.materialData.materialDataNeedChange=!0,this.materialData.specularColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tintColor",{get:function(){return this.materialData.tintColor},set:function(t){this.materialData.materialDataNeedChange=!0,this.materialData.tintColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this.materialData.alpha},set:function(t){this.materialData.alpha!=t&&(this.materialData.alpha=t,this.materialData.materialDataNeedChange=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphaBlending",{get:function(){return this.materialData.alphaBlending},set:function(t){this.materialData.alphaBlending!=t&&(this.materialData.alphaBlending=t,this.materialData.materialDataNeedChange=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"specularLevel",{get:function(){return this.materialData.specularLevel},set:function(t){this.materialData.specularLevel!=t&&(this.materialData.specularLevel=t,this.materialData.materialDataNeedChange=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gloss",{get:function(){return this.materialData.gloss},set:function(t){this.materialData.gloss!=t&&(this.materialData.gloss=t,this.materialData.materialDataNeedChange=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uvRectangle",{get:function(){return this.materialData.uvRectangle},set:function(t){this.materialData.uvRectangle.x=t.x,this.materialData.uvRectangle.y=t.y,this.materialData.uvRectangle.width=t.width,this.materialData.uvRectangle.height=t.height,this.materialData.materialDataNeedChange=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"diffusePass",{get:function(){return this.passes[t.PassType.diffusePass][0]},enumerable:!0,configurable:!0}),e.prototype.addPass=function(e){this.passes[e]=t.PassUtil.CreatPass(e,this.materialData)},Object.defineProperty(e.prototype,"castShadow",{get:function(){return this.materialData.castShadow},set:function(e){this.materialData.castShadow=e,e?(t.ShadowCast.enableShadow=!0,this.addPass(t.PassType.shadowPass)):this.passes[t.PassType.shadowPass]&&(this.disposePass(t.PassType.shadowPass),this.passes[t.PassType.shadowPass]=null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"castPick",{set:function(e){e?(t.PickSystem.instance.enablePick=!0,this.addPass(t.PassType.PickPass)):this.passes[t.PassType.PickPass]&&(this.disposePass(t.PassType.PickPass),this.passes[t.PassType.PickPass]=null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"acceptShadow",{get:function(){return this.materialData.acceptShadow},set:function(e){this.materialData.acceptShadow!=e&&(this.materialData.acceptShadow=e,this.materialData.acceptShadow?(this._shadowMethod=new t.ShadowMethod(this),this._shadowMethod.shadowMapTexture=t.ShadowCast.instance.shadowRender.renderTexture,this.diffusePass.addMethod(this._shadowMethod)):this._shadowMethod&&this.diffusePass.removeMethod(this._shadowMethod))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowColor",{get:function(){var t=0;return t|=255*this.materialData.shadowColor[0]<<16,t|=255*this.materialData.shadowColor[1]<<8,t|=255*this.materialData.shadowColor[2]},set:function(t){this.materialData.shadowColor[0]=t>>16&1,this.materialData.shadowColor[1]=t>>8&1,this.materialData.shadowColor[2]=1&t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowOffset",{get:function(){return this.materialData.shadowColor[3]},set:function(t){this.materialData.shadowColor[3]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"repeat",{get:function(){return this.materialData.repeat},set:function(t){this.materialData.repeat=t,this.materialData.textureStateChage=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bothside",{get:function(){return this.materialData.bothside},set:function(t){this.materialData.textureStateChage=!0,this.materialData.bothside=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cullMode",{get:function(){return this.materialData.cullFrontOrBack},set:function(t){this.materialData.textureStateChage=!0,this.materialData.cullFrontOrBack=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{set:function(e){switch(this.materialData.textureStateChage=!0,this.materialData.blendMode=e,e){case t.BlendMode.NORMAL:this.materialData.blend_src=t.ContextConfig.ONE,this.materialData.blend_dest=t.ContextConfig.ONE_MINUS_SRC_ALPHA,this.materialData.alphaBlending=!1;break;case t.BlendMode.LAYER:this.materialData.blend_src=t.ContextConfig.SRC_ALPHA,this.materialData.blend_dest=t.ContextConfig.ZERO,this.materialData.alphaBlending=!0;break;case t.BlendMode.MULTIPLY:this.materialData.blend_src=t.ContextConfig.ZERO,this.materialData.blend_dest=t.ContextConfig.SRC_COLOR,this.materialData.alphaBlending=!0;break;case t.BlendMode.ADD:this.materialData.blend_src=t.ContextConfig.SRC_ALPHA,this.materialData.blend_dest=t.ContextConfig.ONE,this.materialData.alphaBlending=!0;break;case t.BlendMode.SOFT_ADD:this.materialData.blend_src=t.ContextConfig.SRC_COLOR,this.materialData.blend_dest=t.ContextConfig.ONE,this.materialData.alphaBlending=!0;break;case t.BlendMode.ALPHA:this.materialData.blend_src=t.ContextConfig.ONE,this.materialData.blend_dest=t.ContextConfig.ONE_MINUS_SRC_ALPHA,this.materialData.alphaBlending=!0;break;case t.BlendMode.SCREEN:this.materialData.blend_src=t.ContextConfig.ONE,this.materialData.blend_dest=t.ContextConfig.ONE_MINUS_SRC_COLOR}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pointSize",{get:function(){return this.materialData.specularLevel},set:function(t){t!=this.materialData.specularLevel&&(this.materialData.specularLevel=t,this.materialData.textureStateChage=!0)},enumerable:!0,configurable:!0}),e.prototype.disposePass=function(t){for(var e=0;e<this.passes[t].length;e++)this.passes[t][e].dispose()},e.prototype.renderXRayPass=function(){},e.prototype.renderOutlinePass=function(){},e.prototype.renderNormalPass=function(){},e.prototype.renderDepthPass=function(){},e.prototype.renderPositionPass=function(){},e.prototype.renderUVPass=function(){},e.prototype.renderScendUVPass=function(){},e.prototype.renderVertexColorPass=function(){},e.prototype.renderLightingPass=function(){},e}();t.MaterialBase=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){void 0===i&&(i=13421772),e.call(this),this.color=i,this.diffuseTexture=t.CheckerboardTexture.texture,this.initMatPass()}return __extends(i,e),i.prototype.initMatPass=function(){this.addPass(t.PassType.diffusePass),this.diffusePass.addMethod(new t.ColorMethod)},Object.defineProperty(i.prototype,"color",{get:function(){return this.materialData.diffuseColor},set:function(t){this.materialData.diffuseColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"alpha",{get:function(){return this.materialData.alpha},set:function(t){this.materialData.alpha=t},enumerable:!0,configurable:!0}),i}(t.MaterialBase);t.ColorMaterial=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r){void 0===i&&(i=null),void 0===r&&(r=null),e.call(this,r),this.diffuseTexture=i?i:t.CheckerboardTexture.texture,this.initMatPass()}return __extends(i,e),i.prototype.initMatPass=function(){this.addPass(t.PassType.diffusePass)},i.prototype.clone=function(){var t=new i(this.diffuseTexture,this.materialData.clone());return t},i}(t.MaterialBase);t.TextureMaterial=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r){void 0===i&&(i=null),void 0===r&&(r=null),e.call(this,r),this.diffuseTexture=i?i:t.CheckerboardTexture.texture,this.initMatPass()}return __extends(i,e),i.prototype.initMatPass=function(){this._fakePBR=new t.FakePBRPass(this.materialData),this.materialData.shaderPhaseTypes[t.PassType.diffusePass]=[],this.passes[t.PassType.diffusePass]=[this._fakePBR]},Object.defineProperty(i.prototype,"albedoTexture",{set:function(t){this._fakePBR.setTexture("albedoTex",t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"normalTexture",{set:function(t){this._fakePBR.setTexture("normalTex",t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"glossTexture",{set:function(t){this._fakePBR.setTexture("glossTex",t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"specularTexture",{set:function(t){this._fakePBR.setTexture("specularTex",t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"opacityTexture",{set:function(t){this._fakePBR.setTexture("opacityTex ",t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"reflectionTexture",{set:function(t){this._fakePBR.setTexture("reflectionMap",t)},enumerable:!0,configurable:!0}),i.prototype.clone=function(){var e=new t.TextureMaterial(this.diffuseTexture,this.materialData.clone());return e},i}(t.MaterialBase);t.FakePBRMaterial=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(t,i){void 0===t&&(t=null),void 0===i&&(i=null),e.call(this,i),this.diffuseTexture=t,this.initMatPass()}return __extends(i,e),i.prototype.initMatPass=function(){this.addPass(t.PassType.diffusePass),this.diffusePass.addMethod(new t.CubeMethod)},i.prototype.clone=function(){var t=new i(this.diffuseTexture,this.materialData.clone());return t},i}(t.MaterialBase);t.CubeTextureMaterial=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this._renderIndex=0,this.numEntity=0}return e.prototype.setRenderToTexture=function(e,i,r){void 0===r&&(r=t.FrameBufferFormat.UNSIGNED_BYTE_RGB),this.renderTexture=new t.RenderTexture(e,i,r)},e.prototype.draw=function(t,e,i,r,a,n,o){void 0===n&&(n=null),void 0===o&&(o=!1)},e}();t.RenderBase=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){void 0===i&&(i=t.PassType.diffusePass),e.call(this),this._i=0,this._j=0,this.pass=i}return __extends(i,e),Object.defineProperty(i.prototype,"pass",{get:function(){return this._pass},set:function(t){this._pass=t},enumerable:!0,configurable:!0}),i.prototype.draw=function(e,i,r,a,n,o,s){void 0===o&&(o=null),void 0===s&&(s=!1),this.numEntity=a.renderList.length,this.renderTexture&&(this.renderTexture.upload(r),r.setRenderToTexture(this.renderTexture.texture2D,!0,0));var h;for(this._renderIndex=0;this._renderIndex<this.numEntity;this._renderIndex++)for(this._renderItem=a.renderList[this._renderIndex],this._renderItem.geometry.activeState(e,i,t.Egret3DCanvas.context3DProxy,n),this._i=0;this._i<this._renderItem.geometry.subGeometrys.length;this._i++){var l=this._renderItem.geometry.subGeometrys[this._i],u=l.matID;if(h=this._renderItem.multiMaterial[u],null!=h)if(h.passes[this._pass])for(this._j=h.passes[this._pass].length-1;this._j>=0;this._j--)h.passes[this._pass][this._j].draw(e,i,r,this._renderItem.modelMatrix,n,l,this._renderItem.animation);else if(t.PassUtil.PassAuto[this._pass])for(h.passes[this._pass]||h.addPass(this._pass),this._j=h.passes[this._pass].length-1;this._j>=0;this._j--)h.passes[this._pass]=t.PassUtil.CreatPass(this._pass,h.materialData),h.passes[this._pass][this._j].draw(e,i,r,this._renderItem.modelMatrix,n,l,this._renderItem.animation)
}this.renderTexture&&(r.setRenderToBackBuffer(),o&&(r.viewPort(o.x,o.y,o.width,o.height),r.setScissorRectangle(o.x,o.y,o.width,o.height)))},i}(t.RenderBase);t.MultiRender=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r){e.call(this),this.hud=new t.HUD,this.hud.vsShader=i,this.hud.fsShader=r}return __extends(i,e),i.prototype.setRenderToTexture=function(e,i,r){void 0===r&&(r=t.FrameBufferFormat.UNSIGNED_BYTE_RGB),this.renderTexture=new t.RenderTexture(e,i,t.FrameBufferFormat.UNSIGNED_BYTE_RGB)},i.prototype.draw=function(t,e,i,r,a,n,o){void 0===n&&(n=null),this.numEntity=r.renderList.length,this.renderTexture&&(this.renderTexture.upload(i),i.setRenderToTexture(this.renderTexture.texture2D,!0,0)),this.hud.viewPort=a.viewPort,this.hud.x=a.viewPort.x,this.hud.y=a.viewPort.y,this.hud.width=a.viewPort.width,this.hud.height=a.viewPort.height,this.hud.diffuseTexture=o.end,this.hud.colorTexture=o.colorTexture,this.hud.draw(i,a),this.renderTexture&&i.setRenderToBackBuffer(),n&&(i.viewPort(n.x,n.y,n.width,n.height),i.setScissorRectangle(n.x,n.y,n.width,n.height))},i}(t.RenderBase);t.PostRender=e}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t["float"]=0]="float",t[t.vec2=1]="vec2",t[t.vec3=2]="vec3",t[t.vec4=3]="vec4"}(t.ValueType||(t.ValueType={}));var e=t.ValueType,i=function(){function t(){}return t.prototype.calculate=function(t,e){return void 0===e&&(e=null),new Error("asd"),null},t.prototype.dispose=function(){},t}();t.ValueShape=i;var r=function(t){function i(){t.apply(this,arguments),this.valueType=e["float"],this.value=5}return __extends(i,t),i.prototype.calculate=function(t){for(var e=[],i=0;t>i;i++)e.push(this.value);return e},i}(i);t.ConstValueShape=r;var a=function(t){function i(){t.apply(this,arguments),this.valueType=e["float"],this.min=0,this.max=100}return __extends(i,t),i.prototype.calculate=function(t){for(var e=[],i=0;t>i;i++)e.push(this.min+Math.random()*(this.max-this.min));return e},i}(i);t.ConstRandomValueShape=a;var n=function(i){function r(){i.apply(this,arguments),this.valueType=e.vec2,this.minX=0,this.minY=0}return __extends(r,i),r.prototype.calculate=function(e){for(var i=[],r=0;e>r;r++){var a=new t.Point;a.x=this.minX,a.y=this.minY,i.push(a)}return i},r}(i);t.Vec2ConstValueShape=n;var o=function(i){function r(){i.apply(this,arguments),this.valueType=e.vec2,this.minX=0,this.minY=0,this.maxX=100,this.maxY=100}return __extends(r,i),r.prototype.calculate=function(e){for(var i=[],r=0;e>r;r++){var a=new t.Point;a.x=this.minX+Math.random()*(this.maxX-this.minX),a.y=this.minY+Math.random()*(this.maxY-this.minY),i.push(a)}return i},r}(i);t.Vec2ConstRandomValueShape=o;var s=function(i){function r(){i.apply(this,arguments),this.valueType=e.vec3,this.minX=0,this.minY=0,this.minZ=0}return __extends(r,i),r.prototype.calculate=function(e){for(var i=[],r=0;e>r;r++){var a=new t.Vector3D;a.x=this.minX,a.y=this.minY,a.z=this.minZ,i.push(a)}return i},r}(i);t.Vec3ConstValueShape=s;var h=function(i){function r(){i.apply(this,arguments),this.valueType=e.vec3,this.minX=-50,this.minY=-50,this.minZ=-50,this.maxX=50,this.maxY=50,this.maxZ=50}return __extends(r,i),r.prototype.calculate=function(e){for(var i=[],r=0;e>r;r++){var a=new t.Vector3D;a.x=this.minX+Math.random()*(this.maxX-this.minX),a.y=this.minY+Math.random()*(this.maxY-this.minY),a.z=this.minZ+Math.random()*(this.maxZ-this.minZ),i.push(a)}return i},r}(i);t.Vec3ConstRandomValueShape=h;var l=function(i){function r(){i.apply(this,arguments),this.valueType=e.vec3,this.width=100,this.height=100,this.depth=100}return __extends(r,i),r.prototype.calculate=function(e){for(var i,r=[],a=0;e>a;a++)i=new t.Vector3D,i.x=Math.random()*this.width-.5*this.width,i.y=Math.random()*this.height-.5*this.height,i.z=Math.random()*this.depth-.5*this.depth,r.push(i);return r},r}(i);t.CubeVector3DValueShape=l;var u=function(i){function r(){i.apply(this,arguments),this.valueType=e.vec3,this.width=100,this.height=100}return __extends(r,i),r.prototype.calculate=function(e){for(var i,r=[],a=0;e>a;a++)i=new t.Vector3D,i.x=Math.random()*this.width-.5*this.width,i.y=0,i.z=Math.random()*this.height-.5*this.height,r.push(i);return r},r}(i);t.PlaneValueShape=u;var c=function(i){function r(){i.apply(this,arguments),this.valueType=e.vec3,this.radius=20,this.angle=20,this.length=20,this.coneType=t.ParticleConeShapeType.Volume}return __extends(r,i),r.prototype.dispose=function(){this.directions&&(this.directions.length=0),this.origPoint=null,this.directions=null},r.prototype.calculate=function(e){this.angle>90&&(this.angle=90),this.radius<=0&&(this.radius=.01),90==this.angle?this.origPoint=new t.Vector3D:0==this.angle?this.origPoint=null:(this.origPoint=new t.Vector3D,this.origPoint.z=-this.radius/Math.tan(this.angle*Math.PI/180));var i;return this.directions=[],this.coneType==t.ParticleConeShapeType.Volume?i=90==this.angle?this.calculateBase(e):this.calculateVolume(e):this.coneType==t.ParticleConeShapeType.VolumeShell?i=90==this.angle?this.calculateBaseShell(e):this.calculateVolumeShell(e):this.coneType==t.ParticleConeShapeType.Base?i=this.calculateBase(e):this.coneType==t.ParticleConeShapeType.BaseShell&&(i=this.calculateBaseShell(e)),i},r.prototype.calculateBase=function(e){for(var i,r,a,n,o=[],s=0;e>s;s++)a=Math.random()*Math.PI*2,i=new t.Vector3D,i.z=0,n=Math.random()*this.radius,i.x=Math.sin(a)*n,i.y=Math.cos(a)*n,this.origPoint?(r=i.subtract(this.origPoint),r.normalize()):r=new t.Vector3D(0,0,1),o.push(i),this.directions.push(r);return o},r.prototype.calculateBaseShell=function(e){for(var i,r,a,n,o=[],s=0;e>s;s++)a=Math.random()*Math.PI*2,i=new t.Vector3D,i.z=0,n=this.radius,i.x=Math.sin(a)*n,i.y=Math.cos(a)*n,this.origPoint?(r=i.subtract(this.origPoint),r.normalize()):r=new t.Vector3D(0,0,1),o.push(i),this.directions.push(r);return o},r.prototype.calculateVolume=function(e){for(var i,r,a,n,o=[],s=0;e>s;s++)a=Math.random()*Math.PI*2,i=new t.Vector3D,i.z=this.length*Math.random(),n=this.radius*Math.random(),this.origPoint&&(n*=(i.z-this.origPoint.z)/-this.origPoint.z),i.x=Math.sin(a)*n,i.y=Math.cos(a)*n,this.origPoint?(r=i.subtract(this.origPoint),r.normalize()):r=new t.Vector3D(0,0,1),o.push(i),this.directions.push(r);return o},r.prototype.calculateVolumeShell=function(e){for(var i,r,a,n,o=[],s=0;e>s;s++)a=Math.random()*Math.PI*2,i=new t.Vector3D,i.z=this.length*Math.random(),n=this.radius,this.origPoint&&(n*=(i.z-this.origPoint.z)/-this.origPoint.z),i.x=Math.sin(a)*n,i.y=Math.cos(a)*n,this.origPoint?(r=i.subtract(this.origPoint),r.normalize()):r=new t.Vector3D(0,0,1),o.push(i),this.directions.push(r);return o},r}(i);t.ConeValueShape=c;var d=(function(i){function r(){i.apply(this,arguments),this.valueType=e.vec3,this.points=[new t.Vector3D,new t.Vector3D(100,0,0),new t.Vector3D(100,200,0)]}return __extends(r,i),r.prototype.calculate=function(e){if(1==this.points.length)return this.points;for(var i=[],r=0,a=0,n=1;n<this.points.length;n++)r+=t.Vector3D.distance(this.points[n-1],this.points[n]);a=r/e;for(var o=new t.Vector3D,s=0,h=0,l=0,n=1;n<this.points.length;n++)o.x=this.points[n].x-this.points[n-1].x,o.y=this.points[n].y-this.points[n-1].y,o.z=this.points[n].z-this.points[n-1].z,o.normalize(),o.scaleBy(a+l),s=t.Vector3D.distance(this.points[n-1],this.points[n]),h=t.Vector3D.distance(o,this.points[n]),h>s&&(l+=h);return i},r}(i),function(i){function r(){i.apply(this,arguments),this.valueType=e.vec3,this.r=10,this.fromShell=!1}return __extends(r,i),r.prototype.calculate=function(t){var e=[];return e=this.getPoints1(t,this.r)},r.prototype.getPoints1=function(e,i){for(var r,a,n,o,s=[],h=new t.Vector3D(0,0,0),l=0;e>l;l++)r=2*Math.random()*i-i,a=2*Math.random()*i-i,n=2*Math.random()*i-i,o=new t.Vector3D(r,a,n),this.fromShell&&o.normalize(this.r),t.Vector3D.distance(h,o)>i?l--:s.push(o);return s},r}(i));t.BallValueShape=d;var p=function(i){function r(){i.apply(this,arguments),this.valueType=e.vec3,this.r=10,this.fromShell=!1}return __extends(r,i),r.prototype.calculate=function(t){var e=[];return e=this.getPoints(t,this.r)},r.prototype.getPoints=function(e,i){for(var r,a,n,o,s=[],h=new t.Vector3D(0,0,0),l=0;e>l;l++)r=2*Math.random()*i-i,a=2*Math.random()*i-i,n=Math.abs(2*Math.random()*i-i),o=new t.Vector3D(r,a,n),this.fromShell&&o.normalize(this.r),t.Vector3D.distance(h,o)>i?l--:s.push(o);return s},r}(i);t.HemiBallValueShape=p;var f=(function(i){function r(){i.apply(this,arguments),this.valueType=e.vec3}return __extends(r,i),r.prototype.calculate=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var r,a=e[0],n=a[0];return r=this.createRandomPoint1(t,n)},r.prototype.createRandomPoint1=function(e,i){for(var r=[],a=2*i,n=0;e>n;n++){var o=Math.random()*a-i,s=Math.random()*a-i;o*o+s*s>i*i?n--:r.push(new t.Vector3D(o,0,s))}return r},r.prototype.createRandomPoint2=function(e,i){for(var r,a,n,o=[],s=0;e>s;s++)r=new t.Vector3D,a=Math.sqrt(Math.random())*i,n=360*Math.random(),r.x=a*Math.sin(n),r.z=a*Math.cos(n),r.y=0,o.push(r);return o},r}(i),function(i){function r(){i.apply(this,arguments),this.valueType=e.vec3,this.normalList=[],this.type=t.ParticleMeshShapeType.Edge}return __extends(r,i),r.prototype.calculate=function(e){var i=[];return this.type==t.ParticleMeshShapeType.Edge?this.edgePosition(i,e):this.type==t.ParticleMeshShapeType.Triangle?this.trianglePosition(i,e):this.type==t.ParticleMeshShapeType.Vertex&&this.vertexPosition(i,e),i},r.prototype.edgePosition=function(e,i){for(var a,n,o,s,h,l=this.geometry.faceCount,u=[],c=0;i>c;c++){a=new t.Vector3D,e.push(a);var d=3*Math.floor(l*Math.random());u.length=0,this.geometry.getVertexForIndex(d+0,t.VertexFormat.VF_POSITION,u),r.vct1.setTo(u[0],u[1],u[2]),u.length=0,this.geometry.getVertexForIndex(d+1,t.VertexFormat.VF_POSITION,u),r.vct2.setTo(u[0],u[1],u[2]),u.length=0,this.geometry.getVertexForIndex(d+2,t.VertexFormat.VF_POSITION,u),r.vct3.setTo(u[0],u[1],u[2]),n=this.calcNormal(r.vct1,r.vct2,r.vct3),this.normalList.push(n),h=Math.random(),.333>h?(o=r.vct1,s=r.vct2):.666>h?(o=r.vct2,s=r.vct3):(o=r.vct3,s=r.vct1),o.lerp(o,s,Math.random()),a.copyFrom(o)}},r.prototype.trianglePosition=function(e,i){for(var a,n,o=this.geometry.faceCount,s=new t.Vector3D,h=new t.Vector3D,l=[],u=0;i>u;u++){a=new t.Vector3D,e.push(a);var c=3*Math.floor(o*Math.random());l.length=0,this.geometry.getVertexForIndex(c+0,t.VertexFormat.VF_POSITION,l),r.vct1.setTo(l[0],l[1],l[2]),l.length=0,this.geometry.getVertexForIndex(c+1,t.VertexFormat.VF_POSITION,l),r.vct2.setTo(l[0],l[1],l[2]),l.length=0,this.geometry.getVertexForIndex(c+2,t.VertexFormat.VF_POSITION,l),r.vct3.setTo(l[0],l[1],l[2]),n=this.calcNormal(r.vct1,r.vct2,r.vct3),this.normalList.push(n),s.lerp(r.vct1,r.vct2,Math.random()),h.lerp(r.vct2,r.vct3,Math.random()),a.lerp(s,h,Math.random())}},r.prototype.vertexPosition=function(e,i){for(var a,n,o,s=this.geometry.faceCount,h=[],l=0;i>l;l++){a=new t.Vector3D,e.push(a);var u=3*Math.floor(s*Math.random());h.length=0,this.geometry.getVertexForIndex(u+0,t.VertexFormat.VF_POSITION,h),r.vct1.setTo(h[0],h[1],h[2]),h.length=0,this.geometry.getVertexForIndex(u+1,t.VertexFormat.VF_POSITION,h),r.vct2.setTo(h[0],h[1],h[2]),h.length=0,this.geometry.getVertexForIndex(u+2,t.VertexFormat.VF_POSITION,h),r.vct3.setTo(h[0],h[1],h[2]),n=this.calcNormal(r.vct1,r.vct2,r.vct3),this.normalList.push(n),o=Math.random(),a.copyFrom(.333>o?r.vct1:.666>o?r.vct2:r.vct3)}},r.prototype.calcNormal=function(t,e,i){return r.crsVector1.setTo(e.x-t.x,e.y-t.y,e.z-t.z),r.crsVector2.setTo(i.x-t.x,i.y-t.y,i.z-t.z),this.normal=r.crsVector1.crossProduct(r.crsVector2),this.normal.normalize(),this.normal},r.vct1=new t.Vector3D,r.vct2=new t.Vector3D,r.vct3=new t.Vector3D,r.crsVector1=new t.Vector3D,r.crsVector2=new t.Vector3D,r}(i));t.Mesh3DValueShape=f;var _=(function(i){function r(){i.apply(this,arguments),this.valueType=e.vec3}return __extends(r,i),r.prototype.calculate=function(e){for(var i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];var a=[],n=[];n.push(new t.Vector3D(0,0,0)),n.push(new t.Vector3D(-200,1e3,700)),n.push(new t.Vector3D(200,-50,300)),n.push(new t.Vector3D(-300,-220,500));for(var o,s,h,l,u,c=n[0],d=n[1],p=n[2],f=n[3],_=0;e>_;_++)o=Math.random(),s=1-o,h=c.x*s*s*s+3*d.x*s*s*o+3*p.x*s*o*o+f.x*o*o*o,l=c.y*s*s*s+3*d.y*s*s*o+3*p.y*s*o*o+f.y*o*o*o,u=c.z*s*s*s+3*d.z*s*s*o+3*p.z*s*o*o+f.z*o*o*o,a.push(new t.Vector3D(h,l,u));return a},r}(i),function(){function t(){this.emitter={}}return t.calculate=function(t,e){return e.calculate(t,e)},t.getValues=function(){},t._instance=new t,t}());t.Value=_}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleEndNode",this.vertex_ShaderName[t.ShaderPhaseType.end_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.end_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.end_vertex].push("particle_end_vs")}return __extends(i,e),i.prototype.build=function(){},i}(t.AnimationNode);t.ParticleEndNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this._tiny=.001}return e.prototype.generator=function(e){this._inputCount=2e3,this._data=e,this._node=e.life,this._burstsClone=e.emission.bursts,this._burstsClone&&(this._burstsClone=this._burstsClone.slice()),this.planes=[],this.loopTime=this.circleTime=0,this._data.emission.type==t.ParticleValueType.Const?this.generatorConst():this.generatorBezier(),this.planes.sort(function(t,e){return t.x-e.x});for(var i,r=0,a=0,n=this.planes;a<n.length;a++)i=n[a],this.circleTime=Math.max(this.circleTime,i.x+i.y),this.loopTime=Math.max(this.loopTime,i.y),r=i.x;r>this.loopTime&&(this.loopTime=r),this.circleTime+=this._data.life.delay},e.prototype.burstPlanes=function(t,e){for(var i,r,a,n,o=0,s=this._burstsClone.length;s>o;o++){if(i=this._burstsClone[o],r=i.x,n=!1,r>=t&&e>=r){a=Math.min(i.y,this._data.property.particleCount);for(var h=0;a>h;h++)this.tryCreatePlane(r);n=!0}else r>=this._data.life.duration&&(n=!0);n&&(this._burstsClone.splice(o,1),o--,s--)}},e.prototype.generatorConst=function(){var e=this._data.emission.rate;if(0!=e)for(var i=Math.max(1/e,this._tiny),r=(this._data.life.duration,i),a=r+i;r<=this._data.life.duration&&this.planes.length<this._inputCount;)this.tryCreatePlane(r),a=r+i,this._burstsClone&&this._burstsClone.length>0&&this.burstPlanes(r,a),r=a;else for(;this._burstsClone&&this._burstsClone.length>0&&this.planes.length<this._inputCount;)this.burstPlanes(0,t.MathUtil.MAX_VALUE)},e.prototype.generatorBezier=function(){for(var t=.05,e=this._data.life.duration,i=t,r=i,a=0,n=0,o=0;e>i&&this.planes.length<this._inputCount;)if(a+=this._data.emission.bezier.calc(i/e)*t,n=Math.floor(a),a-=n,n>0)for(o=t/n;n>0;)r+=o,this.tryCreatePlane(i),this._burstsClone&&this._burstsClone.length>0&&this.burstPlanes(i,r),i=r,n--;else r=i+t,this._burstsClone&&this._burstsClone.length>0&&this.burstPlanes(i,r),i=r},e.prototype.tryCreatePlane=function(e){for(var i,r,a=0,n=this._data.property.particleCount,o=0,s=this.planes.length;s>o;o++)r=this.planes[o],i=r.x,r.x+r.y>e&&a++;n>a&&(r=new t.Point(e,this.getLifeTime(e)),this.planes.push(r))},e.prototype.getLifeTime=function(e){var i,r,a=(this._data.life.type,this._data.life);return a.type==t.ParticleValueType.Const?i=r=a.max:a.type==t.ParticleValueType.RandomConst?(i=a.max,r=a.min):a.type==t.ParticleValueType.OneBezier?i=r=a.bezier1.calc(e/a.duration):(i=a.bezier1.calc(e/a.duration),r=a.bezier2.calc(e/a.duration)),Math.random()*(i-r)+r},e.prototype.dispose=function(){this._data=null,this._node=null,this._burstsClone=null,this.planes=null},e}();t.ParticleLifeGenerator=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleSpeedNode",this.vertex_ShaderName[t.ShaderPhaseType.local_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.local_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.local_vertex].push("particle_bezier"),this.vertex_ShaderName[t.ShaderPhaseType.local_vertex].push("particle_time_vs"),this.fragment_ShaderName[t.ShaderPhaseType.start_fragment]=this.fragment_ShaderName[t.ShaderPhaseType.start_fragment]||[],this.fragment_ShaderName[t.ShaderPhaseType.start_fragment].push("particle_time_fs"),this.fragment_ShaderName[t.ShaderPhaseType.diffuse_fragment]=this.fragment_ShaderName[t.ShaderPhaseType.diffuse_fragment]||[],this.fragment_ShaderName[t.ShaderPhaseType.diffuse_fragment].push("particle_diffuse_fragment"),this.attribute_time=new t.GLSL.VarRegister,this.attribute_time.name="attribute_time",this.attribute_time.size=3,this.attributes.push(this.attribute_time)}return __extends(i,e),i.prototype.initNode=function(){},i.prototype.build=function(t,e){this._animationState=this.state;for(var i,r=this._animationState.emitter.generator,a=t.vertexCount/e,n=0,o=r.planes,s=0;e>s;++s){i=o[s];for(var h=0;a>h;++h)n=s*a+h,n=n*t.vertexAttLength+this.attribute_time.offsetIndex,t.vertexArray[n+0]=i.x,t.vertexArray[n+1]=i.y,t.vertexArray[n+2]=s}this._animationState.loopTime=r.loopTime,this._animationState.circleTime=r.circleTime},i.prototype.afterBuild=function(){},Object.defineProperty(i.prototype,"offsetIndex",{get:function(){return this.attribute_time.offsetIndex},enumerable:!0,configurable:!0}),i.prototype.dispose=function(){e.prototype.dispose.call(this),this._animationState=null},i}(t.AnimationNode);t.ParticleTime=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticlePosition",this.attribute_offsetPosition=new t.GLSL.VarRegister,this.attribute_offsetPosition.name="attribute_offsetPosition",this.attribute_offsetPosition.size=3,this.attributes.push(this.attribute_offsetPosition)}return __extends(i,e),i.prototype.initNode=function(e,i){var r,a=i.renderMode;r=a==t.ParticleRenderModeType.Billboard?"particle_rm_billboard":a==t.ParticleRenderModeType.StretchedBillboard?"particle_rm_stretched":"particle_rm_mesh",this.vertex_ShaderName[t.ShaderPhaseType.local_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.local_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.local_vertex].push(r);var n=this._node=e;if(n.type==t.ParticleDataShapeType.Point){var o=new t.Vec3ConstValueShape;o.minX=0,o.minY=0,o.minZ=0,this._positions=o}else if(n.type==t.ParticleDataShapeType.Cube){var s=new t.CubeVector3DValueShape;s.width=n.cubeW,s.height=n.cubeH,s.depth=n.cubeD,this._positions=s}else if(n.type==t.ParticleDataShapeType.Sphere){var h=new t.BallValueShape;h.r=n.sphereRadius,h.fromShell=n.emitFromShell,this._positions=h}else if(n.type==t.ParticleDataShapeType.HemiSphere){var l=new t.HemiBallValueShape;l.r=n.hemiSphereRadius,l.fromShell=n.emitFromShell,this._positions=l}else if(n.type==t.ParticleDataShapeType.Cone){var u=new t.ConeValueShape;u.angle=n.coneAngle,u.length=n.coneLength,u.radius=n.coneRadius,u.coneType=n.coneType,this._positions=u}else if(n.type==t.ParticleDataShapeType.Mesh){var c=new t.Mesh3DValueShape;c.geometry=n.geometry,c.type=n.meshType,this._positions=c}},Object.defineProperty(i.prototype,"offsetIndex",{get:function(){return this.attribute_offsetPosition.offsetIndex},enumerable:!0,configurable:!0}),i.prototype.build=function(e,i){this._animationState=this.state;var r,a=this._positions.calculate(i),n=this._animationState.directionArray=[];this._node.type==t.ParticleDataShapeType.Mesh&&(r=this._positions.normalList);for(var o=e.vertexCount/i,s=0,h=this._animationState.emitter.data,l=new t.Vector3D,u=this._positions,c=0;i>c;++c){var d=a[c];l.copyFrom(d),d.multiply(h.property.scale,d);var p=new t.Vector3D;h.shape.randomDirection?p.setTo(Math.random()-.5,Math.random()-.5,Math.random()-.5):this._node.type==t.ParticleDataShapeType.Point?p.setTo(Math.random()-.5,Math.random()-.5,Math.random()-.5):this._node.type==t.ParticleDataShapeType.Cube?p.setTo(0,0,1,1):this._node.type==t.ParticleDataShapeType.Sphere?p.copyFrom(l):this._node.type==t.ParticleDataShapeType.HemiSphere?p.copyFrom(l):this._node.type==t.ParticleDataShapeType.Cone?p=u.directions[c]:this._node.type==t.ParticleDataShapeType.Mesh&&p.copyFrom(r[c]),p.normalize(),n.push(p);for(var f=0;o>f;++f)s=c*o+f,s=s*e.vertexAttLength+this.attribute_offsetPosition.offsetIndex,e.vertexArray[s+0]=d.x,e.vertexArray[s+1]=d.y,e.vertexArray[s+2]=d.z}},i.prototype.afterBuild=function(){this._positions.dispose(),this._positions=null,this._animationState.directionArray.length=0,this._animationState.directionArray=null},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._positions=null,this._animationState=null,this._node=null},i}(t.AnimationNode);t.ParticlePosition=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.rotationMat=new t.Matrix4_4,this.name="ParticleRotation"}return __extends(i,e),i.prototype.initNode=function(e){var i=this._node=e;this._rotations=new t.ConstRandomValueShape,this._rotations.max=i.max,this._rotations.min=i.min},i.prototype.build=function(e,i){this._animationState=this.state;var r=this._animationState.emitter.data.property.renderMode;if(r!=t.ParticleRenderModeType.StretchedBillboard)for(var a,n,o,s=this._rotations.calculate(i),h=e.vertexCount/i,l=0,u=new t.Vector3D,c=0,d=this._animationState.emitter.data.life.duration,p=this._animationState.emitter.timeNode.offsetIndex,f=0,_=0;i>_;++_){if(this._node.type==t.ParticleValueType.OneBezier||this._node.type==t.ParticleValueType.TwoBezier){if(n=f*e.vertexAttLength+p,o=e.vertexArray[n+0],c=o/d,c-=Math.floor(c),a=this._node.bezier1.calc(c),this._node.type==t.ParticleValueType.TwoBezier){var m=Math.random();a*=m,a+=this._node.bezier2.calc(c)*(1-m)}}else a=s[_];this.rotationMat.identity(),r==t.ParticleRenderModeType.VerticalBillboard||r==t.ParticleRenderModeType.HorizontalBillboard?this.rotationMat.rotation(0,a,0):this.rotationMat.rotation(0,0,a);for(var g=0;h>g;++g)l=_*h+g,l*=e.vertexAttLength,u.x=e.vertexArray[l+0],u.y=e.vertexArray[l+1],u.z=e.vertexArray[l+2],this.rotationMat.transformVector4(u,u),e.vertexArray[l+0]=u.x,e.vertexArray[l+1]=u.y,e.vertexArray[l+2]=u.z}},i.prototype.afterBuild=function(){this._rotations.dispose(),this._rotations=null},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._animationState=null,this._node=null,this._rotations=null},i}(t.AnimationNode);t.ParticleRotation=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleScale"}return __extends(i,e),i.prototype.initNode=function(e){var i=this._node=e;this._scaleValue=new t.ConstRandomValueShape,this._scaleValue.max=i.max,this._scaleValue.min=i.min},i.prototype.build=function(e,i){this._animationState=this.state;for(var r,a,n=this._scaleValue.calculate(i),o=e.vertexCount/i,s=0,h=0,l=this._animationState.emitter.data.life.duration,u=this._animationState.emitter.timeNode.offsetIndex,c=0,d=0,p=0;i>p;++p){if(this._node.type==t.ParticleValueType.OneBezier||this._node.type==t.ParticleValueType.TwoBezier){if(r=c*e.vertexAttLength+u,a=e.vertexArray[r+0],h=a/l,h-=Math.floor(h),d=this._node.bezier1.calc(h),this._node.type==t.ParticleValueType.TwoBezier){var f=Math.random();d*=f,d+=this._node.bezier2.calc(h)*(1-f)}}else d=n[p];for(var _=0;o>_;++_)s=p*o+_,s*=e.vertexAttLength,e.vertexArray[s+0]*=d,e.vertexArray[s+1]*=d,e.vertexArray[s+2]*=d}},i.prototype.afterBuild=function(){this._scaleValue.dispose(),this._scaleValue=null},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._animationState=null,this._node=null,this._scaleValue=null},i}(t.AnimationNode);t.ParticleScale=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.bornTime=0,this.life=0,this.id=0,this.timeIndex=0,this.name="ParticleStartColor"}return __extends(i,e),i.prototype.initNode=function(t){this._node=t},i.prototype.build=function(e,i){this.particleAnimationState=this.state;for(var r=3,a=e.vertexCount/i,n=0,o=this.particleAnimationState.emitter.timeNode.offsetIndex,s=0,h=new t.Color,l=new t.Color,u=0,c=this.particleAnimationState.emitter.data.life.duration,d=0;i>d;++d){s=d*a,this.timeIndex=s*e.vertexAttLength+o,this.bornTime=e.vertexArray[this.timeIndex+0],u=this.bornTime/c,u-=Math.floor(u),this.lerpBirthColor(h,l,u),h.a/=256,h.r/=256,h.g/=256,h.b/=256;for(var p=0;a>p;++p)n=d*a+p,n=n*e.vertexAttLength+r,e.vertexArray[n+0]=h.r,e.vertexArray[n+1]=h.g,e.vertexArray[n+2]=h.b,e.vertexArray[n+3]=h.a}},i.prototype.lerpBirthColor=function(e,i,r){this._node.colorType==t.ParticleBirthColorType.Const?e.copyFrom(this._node.colorConst1):this._node.colorType==t.ParticleBirthColorType.RandomConst?e.randomColor(this._node.colorConst1,this._node.colorConst2,!0):this._node.colorType==t.ParticleBirthColorType.OneGradients?this._node.colorGradients1.lerpColor(r,e):this._node.colorType==t.ParticleBirthColorType.TwoGradients&&(this._node.colorGradients1.lerpColor(r,e),this._node.colorGradients2.lerpColor(r,i),e.lerp(e,i,.5))},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._node=null},i}(t.AnimationNode);t.ParticleStartColor=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this._count=0,this._followRotation=!1,this._followScale=!1,this.bornTime=0,this.life=0,this.id=0,this.timeIndex=0,this.geometryDirty=!1,this.name="ParticleFollowNode",this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_follow_vs"),this.attribute_followPosition=new t.GLSL.VarRegister,this.attribute_followPosition.name="attribute_followPosition",this.attribute_followPosition.size=3,this.attributes.push(this.attribute_followPosition),this.attribute_followRotation=new t.GLSL.VarRegister,this.attribute_followRotation.name="attribute_followRotation",this.attribute_followRotation.size=4,this.attributes.push(this.attribute_followRotation),this.attribute_followScale=new t.GLSL.VarRegister,this.attribute_followScale.name="attribute_followScale",this.attribute_followScale.size=3,this.attributes.push(this.attribute_followScale)}return __extends(i,e),i.prototype.initNode=function(t){var e=t;this._followScale=e.followScale,this._followRotation=e.followRotation},i.prototype.build=function(t,e){this._count=e,this._animationState=this.state,this._lifeCircles=[];for(var i=0;i<this._count;i++)this._lifeCircles[i]=-1},i.prototype.update=function(t,e,i){this.geometryDirty=this.geometryDirty;var r=this._animationState.emitter.data,a=r.life.loop,n=this._animationState.loopTime+r.life.duration+r.life.delay;if(a||!(.001*t>=n)){for(var o=0,s=i.vertexCount/this._count,h=0,l=!1,u=this._animationState.emitter.timeNode.offsetIndex,c=.001*t-r.life.delay,d=i.sharedVertexBuffer?i.sharedVertexBuffer.arrayBuffer:i.vertexArray,p=this._animationState.followTarget||this._animationState.emitter,f=0;f<this._count;++f){h=f*s,this.timeIndex=h*i.vertexAttLength+u,this.bornTime=d[this.timeIndex+0],this.life=d[this.timeIndex+1];var _=-1;if(c>=this.bornTime){if(c>this.bornTime+this.life&&!a)continue;if(_=Math.floor((c-this.bornTime)/this._animationState.loopTime),_!=this._lifeCircles[f]){this._lifeCircles[f]=_,l=!0;for(var m=0;s>m;++m)o=h+m,o=o*i.vertexAttLength+this.attribute_followPosition.offsetIndex,d[o+0]=p.globalPosition.x,d[o+1]=p.globalPosition.y,d[o+2]=p.globalPosition.z,o=h+m,o=o*i.vertexAttLength+this.attribute_followRotation.offsetIndex,this._followRotation?(d[o+0]=p.globalOrientation.x,d[o+1]=p.globalOrientation.y,d[o+2]=p.globalOrientation.z,d[o+3]=p.globalOrientation.w):(d[o+0]=0,d[o+1]=0,d[o+2]=0,d[o+3]=0),o=h+m,o=o*i.vertexAttLength+this.attribute_followScale.offsetIndex,this._followScale?(d[o+0]=p.globalScaleX,d[o+1]=p.globalScaleY,d[o+2]=p.globalScaleZ):(d[o+0]=0,d[o+1]=0,d[o+2]=0)}}}this.geometryDirty=l}},i.prototype.activeState=function(t,e,i,r,a,n,o){this.geometryDirty&&(n.geometry.upload(o),this.geometryDirty=!1)},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._animationState=null,this._lifeCircles=null},i}(t.AnimationNode);t.ParticleFollowNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleVelocityNode",this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocity"),this.attribute_velocity=new t.GLSL.VarRegister,this.attribute_velocity.name="attribute_velocity",this.attribute_velocity.size=3,this.attributes.push(this.attribute_velocity)}return __extends(i,e),i.prototype.initNode=function(e){var i=this._node=e;(i.type==t.ParticleValueType.Const||i.type==t.ParticleValueType.RandomConst)&&(this._constValue=new t.ConstRandomValueShape,this._constValue.max=i.max,this._constValue.min=i.min)},i.prototype.build=function(e,i){this._animationState=this.state;var r,a=e.vertexCount/i,n=0;this._constValue&&(r=this._constValue.calculate(i));for(var o,s,h,l=this._animationState.directionArray,u=new t.Vector3D,c=0,d=this._animationState.emitter.data.life.duration,p=this._animationState.emitter.timeNode.offsetIndex,f=0,_=0;i>_;++_){if(f=_*a,this._node.type==t.ParticleValueType.OneBezier||this._node.type==t.ParticleValueType.TwoBezier){if(o=f*e.vertexAttLength+p,s=e.vertexArray[o+0],c=s/d,c-=Math.floor(c),h=this._node.bezier1.calc(c),this._node.type==t.ParticleValueType.TwoBezier){var m=Math.random();h*=m,h+=this._node.bezier2.calc(c)*(1-m)}}else h=r[_];u.copyFrom(l[_]),u.scaleBy(h);for(var g=0;a>g;++g)n=_*a+g,n=n*e.vertexAttLength+this.attribute_velocity.offsetIndex,e.vertexArray[n+0]=u.x,e.vertexArray[n+1]=u.y,e.vertexArray[n+2]=u.z}},i.prototype.afterBuild=function(){this._constValue&&this._constValue.dispose(),this._constValue=null},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._constValue=null,this._animationState=null,this._node=null},i}(t.AnimationNode);t.ParticleVelocityNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this._colorSegment=new Float32Array(2*i.MaxColor),this.name="ParticleColorGlobalNode",this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_color_vs"),this.fragment_ShaderName[t.ShaderPhaseType.multi_end_fragment]=this.fragment_ShaderName[t.ShaderPhaseType.multi_end_fragment]||[],this.fragment_ShaderName[t.ShaderPhaseType.multi_end_fragment].push("particle_color_fs")}return __extends(i,e),i.prototype.initNode=function(t){var e=t,r=i.MaxColor,a=e.data;a.colors.length=a.times.length=r;for(var n,o=0;r>o;o++)n=a.colors[o],n?(this._colorSegment[o]=this.getGpuColor(n.r,n.g,n.b),this._colorSegment[o+r]=this.getTimeAndAlpha(a.times[o],n.a)):(this._colorSegment[o]=0,this._colorSegment[o+r]=0)},i.prototype.build=function(){},i.prototype.activeState=function(t,e,i,r,a,n,o){a.uniform_colorTransform&&o.uniform1fv(a.uniform_colorTransform.uniformIndex,this._colorSegment)},i.prototype.getGpuColor=function(t,e,i){var r;return t=this.normalizeChannel(t),e=this.normalizeChannel(e),i=this.normalizeChannel(i),r=256*t+e+i/256},i.prototype.normalizeChannel=function(t){return t>255?t=255:0>t&&(t=0),t=Math.floor(t)},i.prototype.normalizeTime=function(t){return t>=1?t=.9999:0>t&&(t=0),t},i.prototype.getTimeAndAlpha=function(t,e){return e=this.normalizeChannel(e),t=this.normalizeTime(t),e+t},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._colorSegment=null},i.MaxColor=20,i}(t.AnimationNode);t.ParticleColorGlobalNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleSizeGlobalNode",this.vertex_ShaderName[t.ShaderPhaseType.local_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.local_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.local_vertex].push("particle_size_vs")}return __extends(i,e),i.prototype.initNode=function(t){this._node=t,this._floatCompressData=this._node.data.sampler()},i.prototype.build=function(){},i.prototype.activeState=function(t,e,i,r,a,n,o){o.uniform1fv(a.uniform_bezierSize.uniformIndex,this._floatCompressData)
},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._floatCompressData=null,this._node=null},i}(t.AnimationNode);t.ParticleSizeGlobalNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleVelocityOverConstNode",this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityOverConst"),this.attribute_velocityOver=new t.GLSL.VarRegister,this.attribute_velocityOver.name="attribute_velocityOverConst",this.attribute_velocityOver.size=3,this.attributes.push(this.attribute_velocityOver)}return __extends(i,e),i.prototype.initNode=function(e){var i=e;this._overValue=new t.Vec3ConstRandomValueShape,this._overValue.maxX=i.velocityOver.max.x,this._overValue.maxY=i.velocityOver.max.y,this._overValue.maxZ=i.velocityOver.max.z,this._overValue.minX=i.velocityOver.min.x,this._overValue.minY=i.velocityOver.min.y,this._overValue.minZ=i.velocityOver.min.z},i.prototype.build=function(t,e){this._animationState=this.state;for(var i=t.vertexCount/e,r=0,a=this._overValue.calculate(e),n=0;e>n;++n)for(var o=a[n],s=0;i>s;++s)r=n*i+s,r=r*t.vertexAttLength+this.attribute_velocityOver.offsetIndex,t.vertexArray[r+0]=o.x,t.vertexArray[r+1]=o.y,t.vertexArray[r+2]=o.z},i.prototype.afterBuild=function(){this._overValue.dispose(),this._overValue=null},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._overValue=null,this._animationState=null},i}(t.AnimationNode);t.ParticleVelocityOverConstNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleVelocityOverOneBezierNode"}return __extends(i,e),i.prototype.initNode=function(e){this._node=e,this._floatCompressDataX=this._node.velocityOver.xBezier1.trySampler(),this._floatCompressDataY=this._node.velocityOver.yBezier1.trySampler(),this._floatCompressDataZ=this._node.velocityOver.zBezier1.trySampler(),this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityOverOneBezier"),this._floatCompressDataX&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityOverOneBezierX"),this._floatCompressDataY&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityOverOneBezierY"),this._floatCompressDataZ&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityOverOneBezierZ")},i.prototype.build=function(){},i.prototype.activeState=function(t,e,i,r,a,n,o){this._floatCompressDataX&&o.uniform1fv(a.uniform_velocityOverX.uniformIndex,this._floatCompressDataX),this._floatCompressDataY&&o.uniform1fv(a.uniform_velocityOverY.uniformIndex,this._floatCompressDataY),this._floatCompressDataZ&&o.uniform1fv(a.uniform_velocityOverZ.uniformIndex,this._floatCompressDataZ)},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._floatCompressDataX=this._floatCompressDataY=this._floatCompressDataZ=null,this._node=null},i}(t.AnimationNode);t.ParticleVelocityOverOneBezierNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleVelocityOverTwoBezierNode",this.attribute_randomSeed=new t.GLSL.VarRegister,this.attribute_randomSeed.name="attribute_velocityOverRandomSeed",this.attribute_randomSeed.size=1,this.attributes.push(this.attribute_randomSeed)}return __extends(i,e),i.prototype.initNode=function(e){this._node=e,this._floatCompressDataX1=this._node.velocityOver.xBezier1.trySampler(),this._floatCompressDataY1=this._node.velocityOver.yBezier1.trySampler(),this._floatCompressDataZ1=this._node.velocityOver.zBezier1.trySampler(),this._floatCompressDataX2=this._node.velocityOver.xBezier2.trySampler(),this._floatCompressDataY2=this._node.velocityOver.yBezier2.trySampler(),this._floatCompressDataZ2=this._node.velocityOver.zBezier2.trySampler(),this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityOverTwoBezier"),this._floatCompressDataX1&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityOverTwoBezierX1"),this._floatCompressDataX2&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityOverTwoBezierX2"),this._floatCompressDataY1&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityOverTwoBezierY1"),this._floatCompressDataY2&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityOverTwoBezierY2"),this._floatCompressDataZ1&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityOverTwoBezierZ1"),this._floatCompressDataZ2&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityOverTwoBezierZ2")},i.prototype.build=function(t,e){this._animationState=this.state;for(var i=t.vertexCount/e,r=0,a=0;e>a;++a)for(var n=Math.random(),o=0;i>o;++o)r=a*i+o,r=r*t.vertexAttLength+this.attribute_randomSeed.offsetIndex,t.vertexArray[r+0]=n},i.prototype.activeState=function(t,e,i,r,a,n,o){this._floatCompressDataX1&&o.uniform1fv(a.uniform_velocityOverX1.uniformIndex,this._floatCompressDataX1),this._floatCompressDataX2&&o.uniform1fv(a.uniform_velocityOverX2.uniformIndex,this._floatCompressDataX2),this._floatCompressDataY1&&o.uniform1fv(a.uniform_velocityOverY1.uniformIndex,this._floatCompressDataY1),this._floatCompressDataY2&&o.uniform1fv(a.uniform_velocityOverY2.uniformIndex,this._floatCompressDataY2),this._floatCompressDataZ1&&o.uniform1fv(a.uniform_velocityOverZ1.uniformIndex,this._floatCompressDataZ1),this._floatCompressDataZ2&&o.uniform1fv(a.uniform_velocityOverZ2.uniformIndex,this._floatCompressDataZ2)},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._floatCompressDataX1=this._floatCompressDataY1=this._floatCompressDataZ1=null,this._floatCompressDataX2=this._floatCompressDataY2=this._floatCompressDataZ2=null,this._node=null,this._animationState=null},i}(t.AnimationNode);t.ParticleVelocityOverTwoBezierNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleVelocityForceConstNode",this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityForceConst"),this.attribute_accelerationSpeed=new t.GLSL.VarRegister,this.attribute_accelerationSpeed.name="attribute_velocityForceConst",this.attribute_accelerationSpeed.size=3,this.attributes.push(this.attribute_accelerationSpeed)}return __extends(i,e),i.prototype.initNode=function(e){this._node=e;var i=this._node.velocityForce;this._forceValue=new t.Vec3ConstRandomValueShape,this._forceValue.maxX=i.max.x,this._forceValue.maxY=i.max.y,this._forceValue.maxZ=i.max.z,this._forceValue.minX=i.min.x,this._forceValue.minY=i.min.y,this._forceValue.minZ=i.min.z},i.prototype.build=function(t,e){for(var i=t.vertexCount/e,r=0,a=this._forceValue.calculate(e),n=0;e>n;++n)for(var o=a[n],s=0;i>s;++s)r=n*i+s,r=r*t.vertexAttLength+this.attribute_accelerationSpeed.offsetIndex,t.vertexArray[r+0]=o.x,t.vertexArray[r+1]=o.y,t.vertexArray[r+2]=o.z},i.prototype.afterBuild=function(){this._forceValue.dispose(),this._forceValue=null},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._forceValue=null,this._node=null},i}(t.AnimationNode);t.ParticleVelocityForceConstNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleVelocityForceOneBezierNode"}return __extends(i,e),i.prototype.initNode=function(e){this._node=e,this._floatCompressDataX=this._node.velocityForce.xBezier1.trySampler(),this._floatCompressDataY=this._node.velocityForce.yBezier1.trySampler(),this._floatCompressDataZ=this._node.velocityForce.zBezier1.trySampler(),this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityForceOneBezier"),this._floatCompressDataX&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityForceOneBezierX"),this._floatCompressDataY&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityForceOneBezierY"),this._floatCompressDataZ&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityForceOneBezierZ")},i.prototype.build=function(){},i.prototype.activeState=function(t,e,i,r,a,n,o){this._floatCompressDataX&&o.uniform1fv(a.uniform_velocityForceX.uniformIndex,this._floatCompressDataX),this._floatCompressDataY&&o.uniform1fv(a.uniform_velocityForceY.uniformIndex,this._floatCompressDataY),this._floatCompressDataZ&&o.uniform1fv(a.uniform_velocityForceZ.uniformIndex,this._floatCompressDataZ)},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._floatCompressDataX=this._floatCompressDataY=this._floatCompressDataZ=null,this._node=null},i}(t.AnimationNode);t.ParticleVelocityForceOneBezierNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleVelocityForceTwoBezierNode",this.attribute_randomSeed=new t.GLSL.VarRegister,this.attribute_randomSeed.name="attribute_velocityForceRandomSeed",this.attribute_randomSeed.size=1,this.attributes.push(this.attribute_randomSeed)}return __extends(i,e),i.prototype.initNode=function(e){this._node=e,this._floatCompressDataX1=this._node.velocityForce.xBezier1.trySampler(),this._floatCompressDataY1=this._node.velocityForce.yBezier1.trySampler(),this._floatCompressDataZ1=this._node.velocityForce.zBezier1.trySampler(),this._floatCompressDataX2=this._node.velocityForce.xBezier2.trySampler(),this._floatCompressDataY2=this._node.velocityForce.yBezier2.trySampler(),this._floatCompressDataZ2=this._node.velocityForce.zBezier2.trySampler(),this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityForceTwoBezier"),this._floatCompressDataX1&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityForceTwoBezierX1"),this._floatCompressDataX2&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityForceTwoBezierX2"),this._floatCompressDataY1&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityForceTwoBezierY1"),this._floatCompressDataY2&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityForceTwoBezierY2"),this._floatCompressDataZ1&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityForceTwoBezierZ1"),this._floatCompressDataZ2&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityForceTwoBezierZ2")},i.prototype.build=function(t,e){this._animationState=this.state;for(var i=t.vertexCount/e,r=0,a=0;e>a;++a)for(var n=Math.random(),o=0;i>o;++o)r=a*i+o,r=r*t.vertexAttLength+this.attribute_randomSeed.offsetIndex,t.vertexArray[r+0]=n},i.prototype.activeState=function(t,e,i,r,a,n,o){this._floatCompressDataX1&&o.uniform1fv(a.uniform_velocityForceX1.uniformIndex,this._floatCompressDataX1),this._floatCompressDataX2&&o.uniform1fv(a.uniform_velocityForceX2.uniformIndex,this._floatCompressDataX2),this._floatCompressDataY1&&o.uniform1fv(a.uniform_velocityForceY1.uniformIndex,this._floatCompressDataY1),this._floatCompressDataY2&&o.uniform1fv(a.uniform_velocityForceY2.uniformIndex,this._floatCompressDataY2),this._floatCompressDataZ1&&o.uniform1fv(a.uniform_velocityForceZ1.uniformIndex,this._floatCompressDataZ1),this._floatCompressDataZ2&&o.uniform1fv(a.uniform_velocityForceZ2.uniformIndex,this._floatCompressDataZ2)},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._floatCompressDataX1=this._floatCompressDataY1=this._floatCompressDataZ1=null,this._floatCompressDataX2=this._floatCompressDataY2=this._floatCompressDataZ2=null,this._node=null,this._animationState=null},i}(t.AnimationNode);t.ParticleVelocityForceTwoBezierNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleVelocityLimitConstNode",this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityLimitConst"),this.attribute_velocityLimit=new t.GLSL.VarRegister,this.attribute_velocityLimit.name="attribute_velocityLimit",this.attribute_velocityLimit.size=1,this.attributes.push(this.attribute_velocityLimit)}return __extends(i,e),i.prototype.initNode=function(e){var i=e;this._limitValue=new t.ConstRandomValueShape,this._limitValue.max=i.velocityLimit.max,this._limitValue.min=i.velocityLimit.min},i.prototype.build=function(t,e){this._animationState=this.state;for(var i=t.vertexCount/e,r=0,a=this._limitValue.calculate(e),n=0;e>n;++n)for(var o=a[n],s=0;i>s;++s)r=n*i+s,r=r*t.vertexAttLength+this.attribute_velocityLimit.offsetIndex,t.vertexArray[r+0]=o},i.prototype.afterBuild=function(){this._limitValue.dispose(),this._limitValue=null},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._animationState=null,this._limitValue=null},i}(t.AnimationNode);t.ParticleVelocityLimitConstNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleVelocityLimitOneBezierNode",this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityLimitOneBezier")}return __extends(i,e),i.prototype.initNode=function(t){this._node=t,this._floatCompressData=this._node.velocityLimit.bezier1.sampler()},i.prototype.build=function(){},i.prototype.activeState=function(t,e,i,r,a,n,o){o.uniform1fv(a.uniform_velocityLimit.uniformIndex,this._floatCompressData)},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._floatCompressData=null,this._node=null},i}(t.AnimationNode);t.ParticleVelocityLimitOneBezierNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleVelocityLimitTwoBezierNode",this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityLimitTwoBezier"),this.attribute_randomSeed=new t.GLSL.VarRegister,this.attribute_randomSeed.name="attribute_velocityLimitRandomSeed",this.attribute_randomSeed.size=1,this.attributes.push(this.attribute_randomSeed)}return __extends(i,e),i.prototype.initNode=function(t){this._node=t,this._floatCompressData=this._node.velocityLimit.bezier1.sampler(),this._floatCompressData2=this._node.velocityLimit.bezier2.sampler()},i.prototype.build=function(t,e){this._animationState=this.state;for(var i=t.vertexCount/e,r=0,a=0;e>a;++a)for(var n=Math.random(),o=0;i>o;++o)r=a*i+o,r=r*t.vertexAttLength+this.attribute_randomSeed.offsetIndex,t.vertexArray[r+0]=n},i.prototype.activeState=function(t,e,i,r,a,n,o){o.uniform1fv(a.uniform_velocityLimit.uniformIndex,this._floatCompressData),o.uniform1fv(a.uniform_velocityLimit2.uniformIndex,this._floatCompressData2)},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._floatCompressData=null,this._floatCompressData2=null,this._animationState=null,this._node=null},i}(t.AnimationNode);t.ParticleVelocityLimitTwoBezierNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleRotationConstNode",this.vertex_ShaderName[t.ShaderPhaseType.local_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.local_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.local_vertex].push("particle_rotationConst"),this.attribute_Rotation=new t.GLSL.VarRegister,this.attribute_Rotation.name="attribute_rotationZ",this.attribute_Rotation.size=1,this.attributes.push(this.attribute_Rotation)}return __extends(i,e),i.prototype.initNode=function(e){var i=e;this._rotation=new t.ConstRandomValueShape,this._rotation.max=i.max.z,this._rotation.min=i.min.z},i.prototype.build=function(t,e){for(var i=0,r=t.vertexCount/e,a=this._rotation.calculate(e),n=0;e>n;++n)for(var o=a[n],s=0;r>s;++s)i=n*r+s,i=i*t.vertexAttLength+this.attribute_Rotation.offsetIndex,t.vertexArray[i+0]=o},i.prototype.afterBuild=function(){this._rotation.dispose(),this._rotation=null},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._rotation=null},i}(t.AnimationNode);t.ParticleRotationConstNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleRotationOneBezierNode",this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_rotationOneBezier")}return __extends(i,e),i.prototype.initNode=function(t){this._node=t,this._floatCompressData=this._node.bezier1.sampler()},i.prototype.build=function(){},i.prototype.activeState=function(t,e,i,r,a,n,o){o.uniform1fv(a.uniform_rotationBezier.uniformIndex,this._floatCompressData)},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._floatCompressData=null,this._node=null},i}(t.AnimationNode);t.ParticleRotationOneBezierNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleRotationTwoBezierNode",this.attribute_randomSeed=new t.GLSL.VarRegister,this.attribute_randomSeed.name="attribute_rotationRandomSeed",this.attribute_randomSeed.size=1,this.attributes.push(this.attribute_randomSeed)}return __extends(i,e),i.prototype.initNode=function(e){this._node=e,this._floatCompressData=this._node.bezier1.sampler(),this._floatCompressData2=this._node.bezier2.sampler(),this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_rotationTwoBezier")},i.prototype.build=function(t,e){this._animationState=this.state;for(var i=t.vertexCount/e,r=0,a=0;e>a;++a)for(var n=Math.random(),o=0;i>o;++o)r=a*i+o,r=r*t.vertexAttLength+this.attribute_randomSeed.offsetIndex,t.vertexArray[r+0]=n},i.prototype.activeState=function(t,e,i,r,a,n,o){o.uniform1fv(a.uniform_rotationBezier.uniformIndex,this._floatCompressData),o.uniform1fv(a.uniform_rotationBezier2.uniformIndex,this._floatCompressData2)},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._floatCompressData=null,this._floatCompressData2=null,this._animationState=null,this._node=null},i}(t.AnimationNode);t.ParticleRotationTwoBezierNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this._sheetFloatData=new Float32Array(5),this.name="ParticleTextureSheetNode",this.attribute_textureSheetData=new t.GLSL.VarRegister,this.attribute_textureSheetData.name="attribute_textureSheetData",this.attribute_textureSheetData.size=3,this.attributes.push(this.attribute_textureSheetData),this.vertex_ShaderName[t.ShaderPhaseType.local_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.local_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.local_vertex].push("particle_textureSheet_vs")}return __extends(i,e),i.prototype.initNode=function(e,i){this._sheetData=i,this._sheetFloatData[0]=this._sheetData.tileX,this._sheetFloatData[1]=this._sheetData.tileY,this._sheetFloatData[2]=this._sheetData.circles,this._sheetData.whole?(this._sheetFloatData[3]=0,this._sheetFloatData[4]=this._sheetData.tileX*this._sheetData.tileY-1):(this._sheetFloatData[3]=0,this._sheetFloatData[4]=this._sheetData.tileY-1),this._sheetData.frameType==t.ParticleValueType.Const||this._sheetData.frameType==t.ParticleValueType.RandomConst?(this.fragment_ShaderName[t.ShaderPhaseType.start_fragment]=this.fragment_ShaderName[t.ShaderPhaseType.start_fragment]||[],this.fragment_ShaderName[t.ShaderPhaseType.start_fragment].push("particle_textureSheetConst")):this._sheetData.frameType==t.ParticleValueType.OneBezier?(this.fragment_ShaderName[t.ShaderPhaseType.start_fragment]=this.fragment_ShaderName[t.ShaderPhaseType.start_fragment]||[],this.fragment_ShaderName[t.ShaderPhaseType.start_fragment].push("particle_bezier"),this.fragment_ShaderName[t.ShaderPhaseType.start_fragment].push("particle_textureSheetOneBezier"),this._floatCompressData1=this._sheetData.bezier1.sampler()):this._sheetData.frameType==t.ParticleValueType.TwoBezier&&(this.fragment_ShaderName[t.ShaderPhaseType.start_fragment]=this.fragment_ShaderName[t.ShaderPhaseType.start_fragment]||[],this.fragment_ShaderName[t.ShaderPhaseType.start_fragment].push("particle_bezier"),this.fragment_ShaderName[t.ShaderPhaseType.start_fragment].push("particle_textureSheetTwoBezier"),this._floatCompressData1=this._sheetData.bezier1.sampler(),this._floatCompressData2=this._sheetData.bezier2.sampler())},i.prototype.build=function(e,i){for(var r=0,a=0,n=0,o=0,s=e.vertexCount/i,h=0;i>h;++h){r=this._sheetData.whole?0:this._sheetData.randomRow?Math.floor(this._sheetData.tileY*Math.random())*this._sheetData.tileX:this._sheetData.row*this._sheetData.tileX,this._sheetData.frameType==t.ParticleValueType.Const||this._sheetData.frameType==t.ParticleValueType.RandomConst?(a=(this._sheetData.max-this._sheetData.min)*Math.random()+this._sheetData.min,a=Math.floor(a)):a=0,n=this._sheetData.frameType==t.ParticleValueType.TwoBezier?Math.random():1;for(var l=0;s>l;++l)o=h*s+l,o=o*e.vertexAttLength+this.attribute_textureSheetData.offsetIndex,e.vertexArray[o+0]=r+.001,e.vertexArray[o+1]=a,e.vertexArray[o+2]=n}},i.prototype.activeState=function(e,i,r,a,n,o,s){s.uniform1fv(n.uniform_textureSheet.uniformIndex,this._sheetFloatData),this._sheetData.frameType==t.ParticleValueType.OneBezier?s.uniform1fv(n.uniform_frameBezier.uniformIndex,this._floatCompressData1):this._sheetData.frameType==t.ParticleValueType.TwoBezier&&(s.uniform1fv(n.uniform_frameBezier1.uniformIndex,this._floatCompressData1),s.uniform1fv(n.uniform_frameBezier2.uniformIndex,this._floatCompressData2))},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._animationState=null,this._floatCompressData1=this._floatCompressData2=null,this._sheetData=null,this._sheetFloatData=null},i}(t.AnimationNode);t.ParticleTextureSheetNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this._uvRollData=new Float32Array(2),this.name="ParticleUVRollNode",this.fragment_ShaderName[t.ShaderPhaseType.start_fragment]=this.fragment_ShaderName[t.ShaderPhaseType.start_fragment]||[],this.fragment_ShaderName[t.ShaderPhaseType.start_fragment].push("particle_uv_roll_fs")}return __extends(i,e),i.prototype.initNode=function(t,e){this._methodData=e,this._uvRollData[0]=this._methodData.uSpeed,this._uvRollData[1]=this._methodData.vSpeed},i.prototype.build=function(){},i.prototype.activeState=function(t,e,i,r,a,n,o){o.uniform1fv(a.uniform_particleUVRoll.uniformIndex,this._uvRollData)},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._animationState=null,this._methodData=null,this._uvRollData=null},i}(t.AnimationNode);t.ParticleUVRollNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function r(){e.call(this),this._empty=!0,this.bornTime=0,this.life=0,this.id=0,this.timeIndex=0,this.count=0,this.position=new t.Vector3D,this._added=!1,this._orientation=new t.Quaternion,this._birthPhase=new i(t.ParticleDataSubEmitterPhase.BIRTH),this._collisionPhase=new i(t.ParticleDataSubEmitterPhase.COLLISION),this._deathPhase=new i(t.ParticleDataSubEmitterPhase.DEATH),this.name="ParticleSubEmitterNode"}return __extends(r,e),r.prototype.initNode=function(t,e){void 0===e&&(e=null),this._parent=e},r.prototype.importSubEmitter=function(e,i){var r;e==t.ParticleDataSubEmitterPhase.BIRTH?r=this._birthPhase:e==t.ParticleDataSubEmitterPhase.COLLISION?r=this._collisionPhase:e==t.ParticleDataSubEmitterPhase.DEATH&&(r=this._deathPhase),r&&(this._empty=!1,r.importSubEmitter(i))},r.prototype.getSubEmitters=function(e){return e==t.ParticleDataSubEmitterPhase.BIRTH?this._birthPhase.playing.getKeys():e==t.ParticleDataSubEmitterPhase.COLLISION?this._collisionPhase.playing.getKeys():e==t.ParticleDataSubEmitterPhase.DEATH?this._deathPhase.playing.getKeys():null},r.prototype.build=function(t,e){this.count=e,this._animationState=this.state,this._lifeCircles=[];for(var i=0;i<this.count;i++)this._lifeCircles[i]=-1},r.prototype.update=function(t,e,i){if(!this._empty){this.recycleParticle(),this.ignoreEmit=e>25;var r=this._animationState.emitter.data,a=r.life.loop,n=this._animationState.loopTime+r.life.duration+r.life.delay;if(a||!(.001*t>=n))for(var o=0,s=i.vertexCount/this.count,h=0,l=this._animationState.emitter.positionNode.offsetIndex,u=this._animationState.emitter.timeNode.offsetIndex,c=.001*t-r.life.delay,d=i.sharedVertexBuffer?i.sharedVertexBuffer.arrayBuffer:i.vertexArray,p=(this._animationState.followTarget||this._animationState.emitter,0);p<this.count;++p){h=p*s,this.timeIndex=h*i.vertexAttLength+u,this.bornTime=d[this.timeIndex+0],this.life=d[this.timeIndex+1];var f=-1;if(c>=this.bornTime){if(c>this.bornTime+this.life&&!a)continue;if(f=Math.floor((c-this.bornTime)/this._animationState.loopTime),f!=this._lifeCircles[p]){if(this._lifeCircles[p]=f,this.ignoreEmit)continue;o=h*i.vertexAttLength+l,this.position.x=d[o+0],this.position.y=d[o+1],this.position.z=d[o+2],this.emitParticleAtPhase(this._birthPhase,this.position)}}}}},r.prototype.emitParticleAtPhase=function(e,i){var r,a,n,o,s=e.playing.getKeys();this._orientation.copyFrom(this._parent.orientation),this._orientation.w*=-1;for(var h=0,l=s.length;l>h;h++)r=s[h],n=e.recycle.getValueByKey(r),a=e.playing.getValueByKey(r),o=n.shift(),null==o&&(o=new t.ParticleEmitter(r.data,r.material)),a.push(o),o.play(),o.position=i,o.orientation=this._orientation,this._parent.addChild(o)},r.prototype.recycleParticle=function(){this.recycleParticleAtPhase(this._birthPhase),this.recycleParticleAtPhase(this._collisionPhase),this.recycleParticleAtPhase(this._deathPhase)},r.prototype.recycleParticleAtPhase=function(t){for(var e,i,r,a,n,o=t.playing.getKeys(),s=0,h=o.length;h>s;s++)for(e=o[s],i=t.playing.getValueByKey(e),r=t.recycle.getValueByKey(e),n=i.length-1;n>=0;n--)a=i[n],a.loopProgress>1&&(i.splice(n,1),a.stop(),this._parent.removeChild(a),r.push(a))},r.prototype.activeState=function(){},r.prototype.dispose=function(){e.prototype.dispose.call(this),this._animationState=null,this._birthPhase&&this._birthPhase.dispose(),this._birthPhase=null,this._collisionPhase&&this._collisionPhase.dispose(),this._collisionPhase=null,this._deathPhase&&this._deathPhase.dispose(),this._deathPhase=null,this._lifeCircles=null,this._orientation=null,this._parent=null},r}(t.AnimationNode);t.ParticleSubEmitterNode=e;var i=function(){function e(e){this.playing=new t.DoubleArray,this.recycle=new t.DoubleArray,this._phase=e}return e.prototype.importSubEmitter=function(t){this.playing.getKeys().indexOf(t)>=0||(this.playing.put(t,[]),this.recycle.put(t,[]))},e.prototype.dispose=function(){for(var t,e=0,i=this.playing.getValues();e<i.length;e++)t=i[e],t.dispose();for(var r=0,a=this.recycle.getValues();r<a.length;r++)t=a[r],t.dispose();this.playing.clear(),this.recycle.clear(),this.playing=this.recycle=null},e}();t.ParticleSubEmitterNodePhase=i}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(t,e){this.numberOfVertices=0,this.vertexSizeInBytes=0,this.vertex_shaders={},this.fragment_shaders={},this.loopTime=0,this.circleTime=0,this.reverse=1,this.followTarget=null,this._particleProperty=new Float32Array(24),this._particleFsData=new Float32Array(3),this._emitter=e,this.name=t,this.animNodes=[],this.keyFrames=[]}return Object.defineProperty(t.prototype,"emitter",{get:function(){return this._emitter},enumerable:!0,configurable:!0}),t.prototype.addNode=function(t){t.state=this,this.animNodes.push(t)},t.prototype.removeNode=function(t){var e=this.animNodes.indexOf(t);-1!=e&&this.animNodes.splice(e,1)},t.prototype.clean=function(){this.animNodes.length=0},t.prototype.addShaderPhase=function(t,e){var i,r;for(r in t){i=t[r];for(var a=0;a<i.length;a++)e[r]=e[r]||[],e[r].push(i[a])}},t.prototype.calculate=function(t){for(var e=0;e<this.animNodes.length;e++){this.addShaderPhase(this.animNodes[e].vertex_ShaderName,this.vertex_shaders),this.addShaderPhase(this.animNodes[e].fragment_ShaderName,this.fragment_shaders);for(var i=t.vertexAttLength,r=0;r<this.animNodes[e].attributes.length;++r)this.animNodes[e].attributes[r].size>0&&(this.animNodes[e].attributes[r].offsetIndex=i,t.vertexAttLength+=this.animNodes[e].attributes[r].size,t.vertexSizeInBytes+=4*this.animNodes[e].attributes[r].size,t.subGeometrys[0].preAttList.push(this.animNodes[e].attributes[r])),i=t.vertexAttLength}},t.prototype.fill=function(t,e){for(var i=0;i<this.animNodes.length;i++)this.animNodes[i].build(t,e);for(var i=0;i<this.animNodes.length;i++)this.animNodes[i].afterBuild()},t.prototype.update=function(t,e,i){for(var r=0;r<this.animNodes.length;r++)this.animNodes[r].update(t,e,i)},t.prototype.activeState=function(t,e,i,r,a,n,o,s){var h,l,u=this._emitter.data;u.followTarget&&this._emitter.followTarget?(h=this._emitter.followTarget.globalOrientation,l=this._emitter.followTarget.globalPosition):(h=this._emitter.globalOrientation,l=this._emitter.globalPosition),this._particleProperty[0]=.001*e,this._particleProperty[1]=u.life.loop?1:0,this._particleProperty[2]=u.followTarget?1:0,this._particleProperty[3]=1,this._particleProperty[4]=1,this._particleProperty[5]=1,this._particleProperty[6]=h.x,this._particleProperty[7]=h.y,this._particleProperty[8]=h.z,this._particleProperty[9]=h.w,this._particleProperty[10]=l.x,this._particleProperty[11]=l.y,this._particleProperty[12]=l.z,this._particleProperty[13]=this.loopTime,this._particleProperty[14]=u.life.delay,this._particleProperty[15]=u.life.duration,this._particleProperty[16]=u.property.gravity,this._particleProperty[17]=u.moveSpeed.velocityOver&&u.moveSpeed.velocityOver.worldSpace?1:0,this._particleProperty[18]=u.moveSpeed.velocityForce&&u.moveSpeed.velocityForce.worldSpace?1:0,this._particleProperty[19]=u.moveSpeed.velocityLimit?u.moveSpeed.velocityLimit.dampen:0,this._particleProperty[20]=u.property.cameraScale,this._particleProperty[21]=u.property.speedScale,this._particleProperty[22]=u.property.lengthScale,this._particleProperty[23]=u.property.renderMode,o.uniform1fv(a.uniform_particleState.uniformIndex,this._particleProperty),a.uniform_particleFsData&&(this._particleFsData[0]=s.far,this._particleFsData[1]=s.near,this._particleFsData[2]=this._emitter.material.materialData.blendMode,o.uniform1fv(a.uniform_particleFsData.uniformIndex,this._particleFsData));for(var c=0;c<this.animNodes.length;c++)this.animNodes[c].activeState(t,e,i,r,a,n,o)},t.prototype.dispose=function(){for(var t,e=0,i=this.animNodes;e<i.length;e++)t=i[e],t.dispose();this.animNodes.length=0,this.animNodes=null,this.keyFrames.length=0,this.keyFrames=null},t}();t.ParticleAnimationState=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this),this.animTime=0,this.delay=0,this.speed=1,this._play=!1,this.animStates=[],this.particleAnimationState=new t.ParticleAnimationState("particle",i),this.addAnimState(this.particleAnimationState)}return __extends(i,e),i.prototype.update=function(t,e,r){this._play&&(i.Reset&&(this.animTime=0),this.delay=e,this.animTime+=this.delay,this.particleAnimationState&&this.particleAnimationState.update(this.animTime,this.delay,r))},i.prototype.activeState=function(t,e,i,r,a,n,o){this.particleAnimationState&&this.particleAnimationState.activeState(t,this.animTime,e,this.delay,i,r,a,o)
},i.prototype.play=function(t,e,i,r){void 0===e&&(e=1),void 0===i&&(i=!0),void 0===r&&(r=!0),this._play=!0,i&&(this.animTime=0),r&&(this.animTime=this.particleAnimationState.loopTime),this.delay=0},i.prototype.stop=function(){this._play=!1},i.prototype.isPlay=function(){return this._play},i.prototype.addAnimState=function(t){var e=this.animStates.indexOf(t);-1==e&&this.animStates.push(t)},i.prototype.removeAnimState=function(t){var e=this.animStates.indexOf(t);-1!=e&&this.animStates.splice(e,1)},i.prototype.getAnimList=function(){return[]},i.prototype.getAnimNode=function(){return[]},i.prototype.clone=function(){return null},i}(t.EventDispatcher);t.ParticleAnimation=e}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t.Property=0]="Property",t[t.Emission=1]="Emission",t[t.Life=2]="Life",t[t.Shape=3]="Shape",t[t.RotationBirth=4]="RotationBirth",t[t.ScaleBirth=5]="ScaleBirth",t[t.Geometry=6]="Geometry",t[t.MoveSpeed=7]="MoveSpeed",t[t.FollowTarget=8]="FollowTarget",t[t.ScaleBezier=9]="ScaleBezier",t[t.RotationSpeed=10]="RotationSpeed",t[t.ColorOffset=11]="ColorOffset",t[t.TextureSheet=12]="TextureSheet"}(t.ParticleDataNodeType||(t.ParticleDataNodeType={}));var e=t.ParticleDataNodeType;!function(t){t[t.BIRTH=0]="BIRTH",t[t.COLLISION=1]="COLLISION",t[t.DEATH=2]="DEATH"}(t.ParticleDataSubEmitterPhase||(t.ParticleDataSubEmitterPhase={})),t.ParticleDataSubEmitterPhase,!function(t){t[t.Const=0]="Const",t[t.RandomConst=1]="RandomConst",t[t.OneBezier=2]="OneBezier",t[t.TwoBezier=3]="TwoBezier"}(t.ParticleValueType||(t.ParticleValueType={}));var i=t.ParticleValueType;!function(t){t[t.Billboard=0]="Billboard",t[t.StretchedBillboard=1]="StretchedBillboard",t[t.HorizontalBillboard=2]="HorizontalBillboard",t[t.VerticalBillboard=3]="VerticalBillboard",t[t.Mesh=4]="Mesh"}(t.ParticleRenderModeType||(t.ParticleRenderModeType={}));var r=t.ParticleRenderModeType;!function(t){t[t.Const=0]="Const",t[t.RandomConst=1]="RandomConst",t[t.OneGradients=2]="OneGradients",t[t.TwoGradients=3]="TwoGradients"}(t.ParticleBirthColorType||(t.ParticleBirthColorType={}));var a=t.ParticleBirthColorType;!function(t){t[t.Point=0]="Point",t[t.Cube=1]="Cube",t[t.Sphere=2]="Sphere",t[t.HemiSphere=3]="HemiSphere",t[t.Cone=4]="Cone",t[t.Mesh=5]="Mesh"}(t.ParticleDataShapeType||(t.ParticleDataShapeType={}));var n=t.ParticleDataShapeType;!function(t){t[t.Vertex=0]="Vertex",t[t.Triangle=1]="Triangle",t[t.Edge=2]="Edge"}(t.ParticleMeshShapeType||(t.ParticleMeshShapeType={}));var o=t.ParticleMeshShapeType;!function(t){t[t.Base=0]="Base",t[t.BaseShell=1]="BaseShell",t[t.Volume=2]="Volume",t[t.VolumeShell=3]="VolumeShell"}(t.ParticleConeShapeType||(t.ParticleConeShapeType={}));var s=t.ParticleConeShapeType,h=function(){function t(){this.property=new u,this.emission=new c,this.life=new d,this.shape=new p,this.rotationBirth=new f,this.scaleBirth=new _,this.geometry=new m,this.moveSpeed=new g}return t.prototype.validate=function(){this.property.validate(),this.emission.validate(),this.life.validate(),this.shape.validate(),this.rotationBirth.validate(),this.scaleBirth.validate(),this.geometry.validate(),this.moveSpeed.validate(),this.scaleBezier&&this.scaleBezier.validate(),this.rotationSpeed&&this.rotationSpeed.validate(),this.colorOffset&&this.colorOffset.validate(),this.followTarget&&this.followTarget.validate(),this.textureSheet&&this.textureSheet.validate()},t}();t.ParticleData=h;var l=function(){function t(t){this._nodeType=t}return Object.defineProperty(t.prototype,"nodeType",{get:function(){return this._nodeType},enumerable:!0,configurable:!0}),t}();t.ParticleDataNode=l;var u=function(i){function n(){i.call(this,e.Property),this.particleCount=10,this.bounds=new t.Vector3D(10,10,10),this.colorType=a.Const,this.colorConst1=new t.Color(255,255,255,255),this.colorConst2=new t.Color(255,255,255,255),this.gravity=0,this.prewarm=!1,this.rotation=new t.Vector3D(0,0,0,1),this.scale=new t.Vector3D(1,1,1,1),this.position=new t.Vector3D(0,0,0,1),this.sortingFudge=0,this.renderMode=r.Billboard,this.cameraScale=0,this.speedScale=0,this.lengthScale=1}return __extends(n,i),n.prototype.validate=function(){null==this.bounds&&(this.bounds=new t.Vector3D(10,10,10)),this.bounds.x<0&&(this.bounds.x=1),this.bounds.y<0&&(this.bounds.y=1),this.bounds.z<0&&(this.bounds.z=1),this.particleCount<0&&(this.particleCount=10),null==this.colorConst1&&(this.colorConst1=new t.Color(255,255,255,255)),null==this.colorConst2&&(this.colorConst2=new t.Color(255,255,255,255)),(this.colorType==a.OneGradients||this.colorType==a.TwoGradients)&&null==this.colorGradients1&&(this.colorGradients1=new t.ColorGradients),this.colorType==a.TwoGradients&&null==this.colorGradients2&&(this.colorGradients2=new t.ColorGradients),null==this.rotation&&(this.rotation=new t.Vector3D(0,0,0,1)),null==this.scale&&(this.scale=new t.Vector3D(1,1,1,1)),null==this.position&&(this.rotation=new t.Vector3D(0,0,0,1))},n}(l);t.ParticleDataProperty=u;var c=function(r){function a(){r.call(this,e.Emission),this.rate=10,this.type=i.Const,this.bezier=new t.BezierData}return __extends(a,r),a.prototype.validate=function(){this.rate<0&&(this.rate=1e-5),this.type==i.OneBezier&&(null==this.bezier&&(this.bezier=new t.BezierData),this.bezier.validate())},a}(l);t.ParticleDataEmission=c;var d=function(r){function a(){r.call(this,e.Life),this.type=i.Const,this.max=0,this.min=0,this.duration=5,this.delay=0,this.loop=!0}return __extends(a,r),a.prototype.validate=function(){this.max<=0&&(this.max=1e-6),this.min<=0&&(this.min=1e-6),this.type==i.Const&&(this.min=this.max),this.type==i.RandomConst,(this.type==i.OneBezier||this.type==i.TwoBezier)&&(null==this.bezier1&&(this.bezier1=new t.BezierData),this.bezier1.validate()),this.type==i.TwoBezier&&(null==this.bezier2&&(this.bezier2=new t.BezierData),this.bezier2.validate()),this.delay<0&&(this.delay=0),this.duration<0&&(this.duration=5)},a}(l);t.ParticleDataLife=d;var p=function(t){function i(){t.call(this,e.Shape),this.type=n.Cube,this.randomDirection=!1,this.emitFromShell=!1,this.cubeW=0,this.cubeH=0,this.cubeD=0,this.sphereRadius=10,this.hemiSphereRadius=10,this.coneType=s.Volume,this.coneLength=10,this.coneRadius=10,this.coneAngle=30,this.meshType=o.Vertex}return __extends(i,t),i.prototype.validate=function(){this.type==n.Cube?(this.cubeW<0&&(this.cubeW=0),this.cubeH<0&&(this.cubeH=0),this.cubeD<0&&(this.cubeD=0)):this.type==n.Sphere&&this.sphereRadius<0&&(this.sphereRadius=10)},i}(l);t.ParticleDataShape=p;var f=function(r){function a(){r.call(this,e.RotationBirth),this.type=i.Const,this.max=0,this.min=0}return __extends(a,r),a.prototype.validate=function(){this.type==i.Const&&(this.min=this.max),this.type==i.RandomConst,(this.type==i.OneBezier||this.type==i.TwoBezier)&&(null==this.bezier1&&(this.bezier1=new t.BezierData),this.bezier1.validate()),this.type==i.TwoBezier&&(null==this.bezier2&&(this.bezier2=new t.BezierData),this.bezier2.validate())},a}(l);t.ParticleDataRotationBirth=f;var _=function(r){function a(){r.call(this,e.ScaleBirth),this.type=i.Const,this.max=1,this.min=1}return __extends(a,r),a.prototype.validate=function(){this.type==i.Const&&(this.min=this.max),this.type==i.RandomConst,(this.type==i.OneBezier||this.type==i.TwoBezier)&&(null==this.bezier1&&(this.bezier1=new t.BezierData),this.bezier1.validate()),this.type==i.TwoBezier&&(null==this.bezier2&&(this.bezier2=new t.BezierData),this.bezier2.validate())},a}(l);t.ParticleDataScaleBirth=_;var m=function(t){function i(){t.call(this,e.Geometry),this.planeW=10,this.planeH=10}return __extends(i,t),i.prototype.validate=function(){this.planeW<0&&(this.planeW=10),this.planeH<0&&(this.planeH=10)},i}(l);t.ParticleDataGeometry=m;var g=function(r){function a(){r.call(this,e.MoveSpeed),this.type=i.Const,this.max=0,this.min=0}return __extends(a,r),a.prototype.validate=function(){this.velocityOver&&this.velocityOver.validate(),this.velocityLimit&&this.velocityLimit.validate(),this.velocityForce&&this.velocityForce.validate(),this.type==i.Const&&(this.min=this.max),(this.type==i.OneBezier||this.type==i.TwoBezier)&&(null==this.bezier1&&(this.bezier1=new t.BezierData),this.bezier1.validate()),this.type==i.TwoBezier&&(null==this.bezier2&&(this.bezier2=new t.BezierData),this.bezier2.validate())},a}(l);t.ParticleDataMoveSpeed=g;var v=function(){function e(){this.type=i.Const,this.max=0,this.min=0,this.dampen=0,this.bezier1=new t.BezierData,this.bezier2=new t.BezierData}return e.prototype.validate=function(){this.max<0&&(this.max=0),this.min<0&&(this.min=0),this.dampen=this.dampen||0,this.type==i.Const&&(this.min=this.max),(this.type==i.OneBezier||this.type==i.TwoBezier)&&(null==this.bezier1&&(this.bezier1=new t.BezierData),this.bezier1.validate()),this.type==i.TwoBezier&&(null==this.bezier2&&(this.bezier2=new t.BezierData),this.bezier2.validate())},e}();t.VelocityLimitLifeTimeData=v;var y=function(){function e(){this.type=i.Const,this.max=new t.Vector3D,this.min=new t.Vector3D,this.worldSpace=!1,this.xBezier1=new t.BezierData,this.yBezier1=new t.BezierData,this.zBezier1=new t.BezierData,this.xBezier2=new t.BezierData,this.yBezier2=new t.BezierData,this.zBezier2=new t.BezierData}return e.prototype.validate=function(){null==this.max&&(this.max=new t.Vector3D),null==this.min&&(this.min=this.max.clone()),(this.type==i.OneBezier||this.type==i.TwoBezier)&&(null==this.xBezier1&&(this.xBezier1=new t.BezierData),null==this.yBezier1&&(this.yBezier1=new t.BezierData),null==this.zBezier1&&(this.zBezier1=new t.BezierData),this.xBezier1.validate(),this.yBezier1.validate(),this.zBezier1.validate()),this.type==i.TwoBezier&&(null==this.xBezier2&&(this.xBezier2=new t.BezierData),null==this.yBezier2&&(this.yBezier2=new t.BezierData),null==this.zBezier2&&(this.zBezier2=new t.BezierData),this.xBezier2.validate(),this.yBezier2.validate(),this.zBezier2.validate())},e}();t.VelocityOverLifeTimeData=y;var x=function(){function e(){this.type=i.Const,this.max=new t.Vector3D,this.min=new t.Vector3D,this.worldSpace=!1,this.xBezier1=new t.BezierData,this.yBezier1=new t.BezierData,this.zBezier1=new t.BezierData,this.xBezier2=new t.BezierData,this.yBezier2=new t.BezierData,this.zBezier2=new t.BezierData}return e.prototype.validate=function(){null==this.max&&(this.max=new t.Vector3D),null==this.min&&(this.min=this.max.clone()),(this.type==i.OneBezier||this.type==i.TwoBezier)&&(null==this.xBezier1&&(this.xBezier1=new t.BezierData),null==this.yBezier1&&(this.yBezier1=new t.BezierData),null==this.zBezier1&&(this.zBezier1=new t.BezierData),this.xBezier1.validate(),this.yBezier1.validate(),this.zBezier1.validate()),this.type==i.TwoBezier&&(null==this.xBezier2&&(this.xBezier2=new t.BezierData),null==this.yBezier2&&(this.yBezier2=new t.BezierData),null==this.zBezier2&&(this.zBezier2=new t.BezierData),this.xBezier2.validate(),this.yBezier2.validate(),this.zBezier2.validate())},e}();t.VelocityForceLifeTimeData=x;var b=function(i){function r(){i.call(this,e.ScaleBezier),this.data=new t.BezierData}return __extends(r,i),r.prototype.validate=function(){null==this.data&&(this.data=new t.BezierData),this.data.validate()},r}(l);t.ParticleDataScaleBezier=b;var D=function(r){function a(){r.call(this,e.RotationSpeed),this.max=new t.Vector3D,this.min=new t.Vector3D,this.type=i.Const,this.bezier1=new t.BezierData,this.bezier2=new t.BezierData}return __extends(a,r),a.prototype.validate=function(){null==this.max&&(this.max=new t.Vector3D),null==this.min&&(this.min=this.max.clone()),(this.type==i.OneBezier||this.type==i.TwoBezier)&&(null==this.bezier1&&(this.bezier1=new t.BezierData),this.bezier1.validate()),this.type==i.TwoBezier&&(null==this.bezier2&&(this.bezier2=new t.BezierData),this.bezier2.validate())},a}(l);t.ParticleDataRotationSpeed=D;var T=function(i){function r(){i.call(this,e.ColorOffset),this.data=new t.ColorGradients}return __extends(r,i),r.prototype.validate=function(){null==this.data.colors&&(this.data.colors=[]),null==this.data.times&&(this.data.times=[])},r}(l);t.ParticleDataColorOffset=T;var w=function(t){function i(){t.call(this,e.FollowTarget),this.followRotation=!0,this.followScale=!0}return __extends(i,t),i.prototype.validate=function(){},i}(l);t.ParticleDataFollowTarget=w;var P=function(r){function a(){r.call(this,e.TextureSheet),this.tileX=1,this.tileY=1,this.whole=!0,this.frameType=i.Const,this.randomRow=!1,this.row=0,this.min=0,this.max=0,this.circles=1,this.bezier1=new t.BezierData,this.bezier2=new t.BezierData}return __extends(a,r),a.prototype.validate=function(){this.tileX<0&&(this.tileX=1),this.tileX=Math.floor(this.tileX),this.tileY<0&&(this.tileY=1),this.tileY=Math.floor(this.tileY),this.max<0&&(this.max=0),this.min>this.max&&(this.min=this.max),(this.frameType==i.OneBezier||this.frameType==i.TwoBezier)&&(null==this.bezier1&&(this.bezier1=new t.BezierData),this.bezier1.validate()),this.frameType==i.TwoBezier&&(null==this.bezier2&&(this.bezier2=new t.BezierData),this.bezier2.validate()),this.circles<1&&(this.circles=1)},a}(l);t.ParticleDataTextureSheet=P}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.prototype.parse=function(t,e){this._particleData=e,this.version=this.getNode(t,"version").textContent;var i=this.getNode(t,"property");this.parseProperty(i);var r=this.getNode(t,"emission");this.parseEmission(r);var a=this.getNode(t,"life");this.parseLife(a);var n=this.getNode(t,"shape");this.parseShape(n);var o=this.getNode(t,"rotationBirth");this.parseRotationBirth(o);var s=this.getNode(t,"scaleBirth");this.parseScaleBirth(s);var h=this.getNode(t,"geometry");this.parseGeometry(h);var l=this.getNode(t,"moveSpeed");this.parseMoveSpeed(l);var u=this.getNode(t,"followTarget");this.parseFollowTarget(u);var c=this.getNode(t,"scaleBezier");this.parseScaleBeizer(c);var d=this.getNode(t,"rotationSpeed");this.parseRotationSpeed(d);var p=this.getNode(t,"colorOffset");this.parseColorOffset(p);var f=(this.getNode(t,"mat"),this.getNode(t,"textureSheet"));this.parseTextureSheet(f)},e.prototype.parseProperty=function(e){var i=this._particleData.property;i.particleCount=Number(this.getNode(e,"particleCount").textContent),i.prewarm="true"==this.getNode(e,"prewarm").textContent;var r=this.getNode(e,"bounds");i.bounds=this.parseVector3D(r,i.bounds),i.colorType=t.ParticleBirthColorType[this.getNode(e,"colorType").textContent];var a=this.getNode(e,"colorConst1"),n=this.getNode(e,"colorConst2"),o=this.getNode(e,"colorGradients1"),s=this.getNode(e,"colorGradients2");this.parseColorProperty(i,a,n,o,s),i.gravity=Number(this.getNode(e,"gravity").textContent);var h=this.getNode(e,"transform"),l=this.getNode(h,"rotation"),u=this.getNode(h,"scale"),c=this.getNode(h,"position");i.rotation=this.parseVector3D(l,i.rotation),i.scale=this.parseVector3D(u,i.scale),i.position=this.parseVector3D(c,i.position);var d=this.getNode(e,"render"),p=this.getNode(d,"renderMode");p&&(i.renderMode=t.ParticleRenderModeType[p.textContent]);var f=this.getNode(d,"lengthScale");f&&(i.lengthScale=Number(f.textContent));var _=this.getNode(d,"cameraScale");_&&(i.cameraScale=Number(_.textContent));var m=this.getNode(d,"speedScale");m&&(i.speedScale=Number(m.textContent));var g=this.getNode(d,"meshFile");g&&""!=g.textContent&&(i.meshFile=g.textContent);var v=this.getNode(e,"sortingFudge");v&&(i.sortingFudge=Number(v.textContent))},e.prototype.parseColorProperty=function(e,i,r,a,n){if(i&&(e.colorConst1=t.Color.createColor(Number(i.textContent))),r&&(e.colorConst2=t.Color.createColor(Number(r.textContent))),a){var o=this.getNodeList(a,"item");e.colorGradients1=this.parseGradientsColor(o,e.colorGradients1)}if(n){var o=this.getNodeList(n,"item");e.colorGradients2=this.parseGradientsColor(o,e.colorGradients2)}},e.prototype.parseEmission=function(e){var i=this._particleData.emission;i.type=t.ParticleValueType[this.getNode(e,"type").textContent],i.rate=Number(this.getNode(e,"rate").textContent);var r,a,n=this.getNode(e,"bursts"),o=0,s=0;if(n){i.bursts=[];var h=this.getNodeList(n,"item");for(o=0,s=h?h.length:0;s>o;o++)r=h[o],a=new t.Point,i.bursts.push(a),this.eachAttr(r,function(t,e){"time"==t?a.x=Number(e):"count"==t&&(a.y=Number(e))})}var l=this.getNode(e,"bezier");i.type==t.ParticleValueType.OneBezier&&(i.bezier=this.parseBezierData(l))},e.prototype.parseLife=function(e){var i=this._particleData.life;i.type=t.ParticleValueType[this.getNode(e,"type").textContent],i.min=Number(this.getNode(e,"min").textContent),i.max=Number(this.getNode(e,"max").textContent),i.bezier1=this.parseBezierData(this.getNode(e,"bezier1")),i.bezier2=this.parseBezierData(this.getNode(e,"bezier2")),i.duration=Number(this.getNode(e,"duration").textContent),i.delay=Number(this.getNode(e,"delay").textContent),i.loop="true"==this.getNode(e,"loop").textContent},e.prototype.parseShape=function(e){if(null!=e){var i=this._particleData.shape;i.type=t.ParticleDataShapeType[this.getNode(e,"type").textContent],i.randomDirection="true"==this.getNode(e,"randomDirection").textContent;var r=this.getNode(e,"emitFromShell");i.emitFromShell=r&&"true"==r.textContent;var a=this.getNode(e,"cube");this.eachAttr(a,function(t,e){"width"==t?i.cubeW=Number(e):"height"==t?i.cubeH=Number(e):"depth"==t&&(i.cubeD=Number(e))});var n=this.getNode(e,"sphereRadius");n&&(i.sphereRadius=Number(n.textContent));var o=this.getNode(e,"hemiSphereRadius");o&&(i.hemiSphereRadius=Number(o.textContent));var s=this.getNode(e,"cone");this.eachAttr(s,function(e,r){"type"==e?i.coneType=t.ParticleConeShapeType[r]:"length"==e?i.coneLength=Number(r):"radius"==e?i.coneRadius=Number(r):"angle"==e&&(i.coneAngle=Number(r))});var h=this.getNode(e,"meshType");h&&(i.meshType=t.ParticleMeshShapeType[h.textContent]);var l=this.getNode(e,"meshFile");l&&""!=l.textContent&&(i.meshFile=l.textContent)}},e.prototype.parseRotationBirth=function(e){var i=this._particleData.rotationBirth;i.type=t.ParticleValueType[this.getNode(e,"type").textContent],i.min=Number(this.getNode(e,"min").textContent),i.max=Number(this.getNode(e,"max").textContent),i.bezier1=this.parseBezierData(this.getNode(e,"bezier1")),i.bezier2=this.parseBezierData(this.getNode(e,"bezier2"))},e.prototype.parseScaleBirth=function(e){var i=this._particleData.scaleBirth;i.type=t.ParticleValueType[this.getNode(e,"type").textContent],i.min=Number(this.getNode(e,"min").textContent),i.max=Number(this.getNode(e,"max").textContent),i.bezier1=this.parseBezierData(this.getNode(e,"bezier1")),i.bezier2=this.parseBezierData(this.getNode(e,"bezier2"))},e.prototype.parseGeometry=function(t){var e=this._particleData.geometry,i=this.getNode(t,"plane");this.eachAttr(i,function(t,i){"width"==t?e.planeW=Number(i):"height"==t&&(e.planeH=Number(i))})},e.prototype.parseMoveSpeed=function(e){var i=this._particleData.moveSpeed;i.type=t.ParticleValueType[this.getNode(e,"type").textContent],i.min=Number(this.getNode(e,"min").textContent),i.max=Number(this.getNode(e,"max").textContent),i.bezier1=this.parseBezierData(this.getNode(e,"bezier1")),i.bezier2=this.parseBezierData(this.getNode(e,"bezier2"));var r=this.getNode(e,"velocityOver");if(r){var a=new t.VelocityOverLifeTimeData;a.type=t.ParticleValueType[this.getNode(r,"type").textContent];var n=this.getNode(r,"min"),o=this.getNode(r,"max");a.min=this.parseVector3D(n,a.min),a.max=this.parseVector3D(o,a.max),a.worldSpace="true"==this.getNode(r,"worldSpace").textContent,a.xBezier1=this.parseBezierData(this.getNode(r,"xBezier1")),a.yBezier1=this.parseBezierData(this.getNode(r,"yBezier1")),a.zBezier1=this.parseBezierData(this.getNode(r,"zBezier1")),a.xBezier2=this.parseBezierData(this.getNode(r,"xBezier2")),a.yBezier2=this.parseBezierData(this.getNode(r,"yBezier2")),a.zBezier2=this.parseBezierData(this.getNode(r,"zBezier2")),i.velocityOver=a}var s=this.getNode(e,"velocityForce");if(s){var h=new t.VelocityForceLifeTimeData;h.type=t.ParticleValueType[this.getNode(s,"type").textContent];var n=this.getNode(s,"min"),o=this.getNode(s,"max");h.min=this.parseVector3D(n,h.min),h.max=this.parseVector3D(o,h.max),h.worldSpace="true"==this.getNode(s,"worldSpace").textContent,h.xBezier1=this.parseBezierData(this.getNode(s,"xBezier1")),h.yBezier1=this.parseBezierData(this.getNode(s,"yBezier1")),h.zBezier1=this.parseBezierData(this.getNode(s,"zBezier1")),h.xBezier2=this.parseBezierData(this.getNode(s,"xBezier2")),h.yBezier2=this.parseBezierData(this.getNode(s,"yBezier2")),h.zBezier2=this.parseBezierData(this.getNode(s,"zBezier2")),i.velocityForce=h}var l=this.getNode(e,"velocityLimit");if(l){var u=new t.VelocityLimitLifeTimeData;u.type=t.ParticleValueType[this.getNode(l,"type").textContent];var n=this.getNode(l,"min"),o=this.getNode(l,"max"),c=this.getNode(l,"dampen");u.min=Number(n.textContent),u.max=Number(o.textContent),u.dampen=c?Number(c.textContent):0,u.bezier1=this.parseBezierData(this.getNode(l,"bezier1")),u.bezier2=this.parseBezierData(this.getNode(l,"bezier2")),i.velocityLimit=u}},e.prototype.parseFollowTarget=function(e){if(null!=e){var i=this._particleData.followTarget=new t.ParticleDataFollowTarget;i.followRotation="true"==this.getNode(e,"followRotation").textContent,i.followScale="true"==this.getNode(e,"followScale").textContent}},e.prototype.parseScaleBeizer=function(e){if(null!=e){var i=this._particleData.scaleBezier=new t.ParticleDataScaleBezier;i.data=this.parseBezierData(this.getNode(e,"bezier"))}},e.prototype.parseRotationSpeed=function(e){if(null!=e){var i=this._particleData.rotationSpeed=new t.ParticleDataRotationSpeed;i.type=t.ParticleValueType[this.getNode(e,"type").textContent];var r=this.getNode(e,"min"),a=this.getNode(e,"max");i.min=this.parseVector3D(r,i.min),i.max=this.parseVector3D(a,i.max),i.bezier1=this.parseBezierData(this.getNode(e,"bezier1")),i.bezier2=this.parseBezierData(this.getNode(e,"bezier2"))}},e.prototype.parseColorOffset=function(e){if(null!=e){var i=this._particleData.colorOffset=new t.ParticleDataColorOffset,r=this.getNodeList(e,"item");i.data=this.parseGradientsColor(r,i.data)}},e.prototype.parseTextureSheet=function(e){if(null==e)return null;var i=this._particleData.textureSheet=new t.ParticleDataTextureSheet;return i.frameType=t.ParticleValueType[this.getNode(e,"frameType").textContent],i.tileX=Number(this.getNode(e,"tileX").textContent),i.tileY=Number(this.getNode(e,"tileY").textContent),i.whole="true"==this.getNode(e,"whole").textContent,i.row=Number(this.getNode(e,"row").textContent),i.min=Number(this.getNode(e,"min").textContent),i.max=Number(this.getNode(e,"max").textContent),i.circles=Number(this.getNode(e,"circles").textContent),i.bezier1=this.parseBezierData(this.getNode(e,"bezier1")),i.bezier2=this.parseBezierData(this.getNode(e,"bezier2")),i},e.prototype.parseGradientsColor=function(e,i){i||(i=new t.ColorGradients);var r,a,n=0,o=0;for(n=0,o=e?e.length:0;o>n;n++)r=e[n],this.eachAttr(r,function(e,r){"time"==e?i.times.push(Number(r)):"color"==e&&(a=t.Color.createColor(Number(r)),i.colors.push(a))});var s=i.times.slice(),h=i.colors.slice();for(s.sort(function(t,e){return t-e}),n=0,o=i?i.times.length:0;o>n;n++){var l=s.indexOf(i.times[n]);i.colors[n]=h[l]}return i.times=s,i},e.prototype.parseBezierData=function(e){var i=new t.BezierData;if(null==e)return i;var r,a,n=this.getNodeList(e,"pos"),o=this.getNodeList(e,"ctrl"),s=0,h=0;for(s=0,h=n?n.length:0;h>s;s++)r=n[s],a=new t.Point,i.posPoints.push(a),this.eachAttr(r,function(t,e){"x"==t?a.x=Number(e):"y"==t&&(a.y=Number(e))});for(s=0,h=o?o.length:0;h>s;s++)r=o[s],a=new t.Point,i.ctrlPoints.push(a),this.eachAttr(r,function(t,e){"x"==t?a.x=Number(e):"y"==t&&(a.y=Number(e))});return i},e.prototype.parseVector3D=function(e,i){return null==i&&(i=new t.Vector3D),this.eachAttr(e,function(t,e){"x"==t?i.x=Number(e):"y"==t?i.y=Number(e):"z"==t&&(i.z=Number(e))}),i},e.prototype.getNode=function(t,e){if(null==t)return null;var i=t.getElementsByTagName(e);return null==i||0==i.length?null:i[0]},e.prototype.getNodeList=function(t,e){if(null==t)return null;var i=t.getElementsByTagName(e);return null==i||0==i.length?null:i},e.prototype.eachAttr=function(e,i){t.XMLParser.eachXmlAttr(e,i)},e}();t.ParticleXmlParser=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.prototype.parse=function(t,e){this._particleData=e,this.version=t.version+"";var i=t.property;this.parseProperty(i);var r=t.emission;this.parseEmission(r);var a=t.life;this.parseLife(a);var n=t.shape;this.parseShape(n);var o=t.rotationBirth;this.parseRotationBirth(o);var s=t.scaleBirth;this.parseScaleBirth(s);var h=t.geometry;this.parseGeometry(h);var l=t.moveSpeed;this.parseMoveSpeed(l);var u=t.followTarget;this.parseFollowTarget(u);var c=t.scaleBezier;this.parseScaleBeizer(c);var d=t.rotationSpeed;this.parseRotationSpeed(d);var p=t.colorOffset;this.parseColorOffset(p);var f=(t.mat,t.textureSheet);this.parseTextureSheet(f)},e.prototype.parseProperty=function(e){var i=this._particleData.property;i.particleCount=Number(e.particleCount),i.prewarm=e.prewarm,i.bounds=this.parseVector3D(e.bounds,i.bounds),i.colorType=t.ParticleBirthColorType[e.colorType+""];var r=e.colorConst1,a=e.colorConst2,n=e.colorGradients1,o=e.colorGradients2;this.parseColorProperty(i,r,a,n,o),i.gravity=Number(e.gravity);var s=e.transform,h=s.rotation,l=s.scale,u=s.position;i.rotation=this.parseVector3D(h,i.rotation),i.scale=this.parseVector3D(l,i.scale),i.position=this.parseVector3D(u,i.position);var c=e.render;i.renderMode=t.ParticleRenderModeType[c.renderMode+""],i.lengthScale=Number(c.lengthScale),i.cameraScale=Number(c.cameraScale),i.speedScale=Number(c.speedScale),i.meshFile=c.meshFile,""==i.meshFile&&(i.meshFile=null),i.sortingFudge=Number(e.sortingFudge)},e.prototype.parseColorProperty=function(e,i,r,a,n){i&&(e.colorConst1=t.Color.createColor(Number(i))),r&&(e.colorConst2=t.Color.createColor(Number(r))),a&&(e.colorGradients1=this.parseGradientsColor(a,e.colorGradients1)),n&&(e.colorGradients2=this.parseGradientsColor(n,e.colorGradients2))},e.prototype.parseEmission=function(e){var i=this._particleData.emission;i.type=t.ParticleValueType[e.type+""],i.rate=Number(e.rate);var r,a,n=e.bursts,o=0,s=0;if(n)for(i.bursts=[],o=0,s=n?n.length:0;s>o;o++)a=n[o],r=new t.Point,r.x=Number(a[0]),r.y=Number(a[1]),i.bursts.push(r);var h=e.bezier;i.type==t.ParticleValueType.OneBezier&&(i.bezier=this.parseBezierData(h))},e.prototype.parseLife=function(e){var i=this._particleData.life;i.type=t.ParticleValueType[e.type+""],i.min=Number(e.min),i.max=Number(e.max),i.bezier1=this.parseBezierData(e.bezier1),i.bezier2=this.parseBezierData(e.bezier2),i.duration=Number(e.duration),i.delay=Number(e.delay),i.loop=e.loop},e.prototype.parseShape=function(e){if(null!=e){var i=this._particleData.shape;i.type=t.ParticleDataShapeType[e.type+""],i.randomDirection=e.randomDirection,i.emitFromShell=e.emitFromShell;var r=e.cube;if(r&&(i.cubeW=Number(r[0]),i.cubeH=Number(r[1]),i.cubeD=Number(r[2])),i.sphereRadius=Number(e.sphereRadius),i.hemiSphereRadius=Number(e.hemiSphereRadius),i.type==t.ParticleDataShapeType.Cone){var a=e.cone;i.coneType=t.ParticleConeShapeType[a.type+""],i.coneLength=Number(a.length),i.coneRadius=Number(a.radius),i.coneAngle=Number(a.angle)}i.meshType=t.ParticleMeshShapeType[e.meshType+""],i.meshFile=e.meshFile,""==i.meshFile&&(i.meshFile=null)}},e.prototype.parseRotationBirth=function(e){var i=this._particleData.rotationBirth;i.type=t.ParticleValueType[e.type+""],i.min=Number(e.min),i.max=Number(e.max),i.bezier1=this.parseBezierData(e.bezier1),i.bezier2=this.parseBezierData(e.bezier2)},e.prototype.parseScaleBirth=function(e){var i=this._particleData.scaleBirth;i.type=t.ParticleValueType[e.type+""],i.min=Number(e.min),i.max=Number(e.max),i.bezier1=this.parseBezierData(e.bezier1),i.bezier2=this.parseBezierData(e.bezier2)},e.prototype.parseGeometry=function(t){var e=this._particleData.geometry,i=t.plane;e.planeW=Number(i[0]),e.planeH=Number(i[1])},e.prototype.parseMoveSpeed=function(e){var i=this._particleData.moveSpeed;i.type=t.ParticleValueType[e.type+""],i.min=Number(e.min),i.max=Number(e.max),i.bezier1=this.parseBezierData(e.bezier1),i.bezier2=this.parseBezierData(e.bezier2);var r=e.velocityOver;if(r){var a=new t.VelocityOverLifeTimeData;a.type=t.ParticleValueType[r.type+""],a.min=this.parseVector3D(r.min,a.min),a.max=this.parseVector3D(r.max,a.max),a.worldSpace=r.worldSpace,a.xBezier1=this.parseBezierData(r.xBezier1),a.yBezier1=this.parseBezierData(r.yBezier1),a.zBezier1=this.parseBezierData(r.zBezier1),a.xBezier2=this.parseBezierData(r.xBezier2),a.yBezier2=this.parseBezierData(r.yBezier2),a.zBezier2=this.parseBezierData(r.zBezier2),i.velocityOver=a}var n=e.velocityForce;if(n){var o=new t.VelocityForceLifeTimeData;o.type=t.ParticleValueType[n.type+""],o.min=this.parseVector3D(n.min,o.min),o.max=this.parseVector3D(n.max,o.max),o.worldSpace=n.worldSpace,o.xBezier1=this.parseBezierData(n.xBezier1),o.yBezier1=this.parseBezierData(n.yBezier1),o.zBezier1=this.parseBezierData(n.zBezier1),o.xBezier2=this.parseBezierData(n.xBezier2),o.yBezier2=this.parseBezierData(n.yBezier2),o.zBezier2=this.parseBezierData(n.zBezier2),i.velocityForce=o}var s=e.velocityLimit;if(s){var h=new t.VelocityLimitLifeTimeData;h.type=t.ParticleValueType[s.type+""],h.min=Number(s.min),h.max=Number(s.max),h.dampen=Number(s.dampen),h.bezier1=this.parseBezierData(s.bezier1),h.bezier2=this.parseBezierData(s.bezier2),i.velocityLimit=h}},e.prototype.parseFollowTarget=function(e){if(null!=e){var i=this._particleData.followTarget=new t.ParticleDataFollowTarget;i.followRotation=e.followRotation,i.followScale=e.followScale}},e.prototype.parseScaleBeizer=function(e){if(null!=e){var i=this._particleData.scaleBezier=new t.ParticleDataScaleBezier;i.data=this.parseBezierData(e.bezier)}},e.prototype.parseRotationSpeed=function(e){if(null!=e){var i=this._particleData.rotationSpeed=new t.ParticleDataRotationSpeed;i.type=t.ParticleValueType[e.type+""],i.min=this.parseVector3D(e.min,i.min),i.max=this.parseVector3D(e.max,i.max),i.bezier1=this.parseBezierData(e.bezier1),i.bezier2=this.parseBezierData(e.bezier2)}},e.prototype.parseColorOffset=function(e){if(null!=e){var i=this._particleData.colorOffset=new t.ParticleDataColorOffset;i.data=this.parseGradientsColor(e.item,i.data)}},e.prototype.parseTextureSheet=function(e){if(null==e)return null;var i=this._particleData.textureSheet=new t.ParticleDataTextureSheet;return i.frameType=t.ParticleValueType[e.frameType+""],i.tileX=Number(e.tileX),i.tileY=Number(e.tileY),i.whole=e.whole,i.row=Number(e.row),i.min=Number(e.min),i.max=Number(e.max),i.circles=Number(e.circles),i.bezier1=this.parseBezierData(e.bezier1),i.bezier2=this.parseBezierData(e.bezier2),i},e.prototype.parseGradientsColor=function(e,i){i||(i=new t.ColorGradients);var r,a,n=0,o=0;for(n=0,o=e?e.length:0;o>n;n++)r=e[n],i.times.push(Number(r[0])),a=t.Color.createColor(Number(r[1])),i.colors.push(a);var s=i.times.slice(),h=i.colors.slice();for(s.sort(function(t,e){return t-e}),n=0,o=i?i.times.length:0;o>n;n++){var l=s.indexOf(i.times[n]);i.colors[n]=h[l]}return i.times=s,i},e.prototype.parseBezierData=function(e){var i=new t.BezierData;if(null==e)return i;var r,a,n=0,o=0;for(n=0,o=e?e.length:0;o>n;n++)r=e[n],a=new t.Point,a.x=Number(r[1]),a.y=Number(r[2]),"pos"==r[0]?i.posPoints.push(a):i.ctrlPoints.push(a);return i},e.prototype.parseVector3D=function(e,i){return null==i&&(i=new t.Vector3D),e&&(i.x=Number(e[0]),i.y=Number(e[1]),i.z=Number(e[2])),i},e}();t.ParticleJsonParser=e}(egret3d||(egret3d={}));var egret3d;!function(egret3d){var ParticleParser=function(){function ParticleParser(){}return ParticleParser.prototype.parseJson=function(text){this.data=new egret3d.ParticleData;var parser=new egret3d.ParticleJsonParser;return parser.parse(eval("("+text+")"),this.data),this.version=parser.version,this.data.validate(),this.data},ParticleParser.prototype.parseXml=function(t){this.data=new egret3d.ParticleData;var e=new egret3d.ParticleXmlParser;return e.parse(egret3d.XMLParser.parse(t),this.data),this.version=e.version,this.data.validate(),this.data},ParticleParser}();egret3d.ParticleParser=ParticleParser}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r){void 0===r&&(r=null),e.call(this,null,r),this._isEmitterDirty=!0,this._userNodes=[],this.tag.name="effect",this.type="particleEmit",this._data=i,this._externalGeometry=i.property.geometry,this.animation=this._particleAnimation=new t.ParticleAnimation(this),this.animation.particleAnimationController=this._particleAnimation,this._particleState=this._particleAnimation.particleAnimationState,this._generator=new t.ParticleLifeGenerator,this._particleAnimation.emit=this,this.buildParticle()
}return __extends(i,e),Object.defineProperty(i.prototype,"generator",{get:function(){return this._generator},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"drawOrder",{get:function(){return this._data.property.sortingFudge},enumerable:!0,configurable:!0}),i.prototype.addSubEmitter=function(t,e){e.animation.stop(),this._subEmitterNode.importSubEmitter(t,e)},i.prototype.buildParticle=function(){this._geometryShape=null==this._externalGeometry?this.createPlane():this._externalGeometry,this.initialize(),this.initBoudBox(this._data.property.bounds),this._isEmitterDirty=!1},i.prototype.createPlane=function(){var e,i=this._data.geometry,r=t.Vector3D.Z_AXIS;r=this._data.property.renderMode==t.ParticleRenderModeType.VerticalBillboard?t.Vector3D.Y_AXIS:this._data.property.renderMode==t.ParticleRenderModeType.HorizontalBillboard?t.Vector3D.Y_AXIS:t.Vector3D.Z_AXIS;var a=!0,n=!0;return this._data.property.renderMode==t.ParticleRenderModeType.StretchedBillboard&&(a=!1,n=!0),e=new t.PlaneGeometry(i.planeW,i.planeH,1,1,1,1,r,a,n)},Object.defineProperty(i.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"timeNode",{get:function(){return this._timeNode},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"positionNode",{get:function(){return this._positionNode},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"followTarget",{get:function(){return this._particleState.followTarget},set:function(t){this._particleState.followTarget=t},enumerable:!0,configurable:!0}),i.prototype.addAnimNode=function(t){var e=this._userNodes.indexOf(t);-1==e&&(this._userNodes.push(t),this._isEmitterDirty=!0)},i.prototype.removeAnimNode=function(t){var e=this._userNodes.indexOf(t);-1!=e&&(this._userNodes.slice(e),this._isEmitterDirty=!0)},i.prototype.play=function(t){void 0===t&&(t=!1),t?this.animation.play("",1,!1,!0):this.animation.play("",1,!0,!1)},i.prototype.stop=function(){this.animation.stop()},i.prototype.initialize=function(){this._particleAnimation.particleAnimationState.clean(),this._generator.generator(this._data);var e=this._generator.planes.length;this.geometry=new t.Geometry,this.geometry.buildDefaultSubGeometry(),this.geometry.subGeometrys[0].count=e*this._geometryShape.indexCount;var i=0,r=new Array,a=t.VertexFormat.VF_POSITION|t.VertexFormat.VF_UV0|t.VertexFormat.VF_COLOR;this.geometry.vertexFormat=a,this.initMainAnimNode(),this.initUserAnimNode(),this.initEndNode(),this.geometry.vertexCount=e*this._geometryShape.vertexCount,this.geometry.indexCount=e*this._geometryShape.indexCount,this._geometryShape.getVertexForIndex(0,a,r,this._geometryShape.vertexCount);for(var n=0;e>n;++n)i=n*this._geometryShape.vertexCount,this.geometry.setVerticesForIndex(i,a,r,this._geometryShape.vertexCount);for(var n=0;e>n;++n)for(var o=0;o<this._geometryShape.indexArray.length;++o)this.geometry.indexArray[n*this._geometryShape.indexArray.length+o]=this._geometryShape.indexArray[o]+n*this._geometryShape.vertexCount;this._particleAnimation.particleAnimationState.fill(this.geometry,e)},i.prototype.initMainAnimNode=function(){var e=[];this._timeNode=new t.ParticleTime,this._timeNode.initNode(this._data.life),e.push(this._timeNode),this._positionNode=new t.ParticlePosition,this._positionNode.initNode(this._data.shape,this._data.property),e.push(this._positionNode);var i=new t.ParticleVelocityNode;i.initNode(this._data.moveSpeed),e.push(i),this._subEmitterNode=new t.ParticleSubEmitterNode,this._subEmitterNode.initNode(null,this),this._particleAnimation.particleAnimationState.addNode(this._subEmitterNode);var r=this._data.moveSpeed.velocityOver;if(r)if(r.type==t.ParticleValueType.Const||r.type==t.ParticleValueType.RandomConst){var a=new t.ParticleVelocityOverConstNode;a.initNode(this._data.moveSpeed),e.push(a)}else if(r.type==t.ParticleValueType.OneBezier){var n=new t.ParticleVelocityOverOneBezierNode;n.initNode(this._data.moveSpeed),e.push(n)}else if(r.type==t.ParticleValueType.TwoBezier){var o=new t.ParticleVelocityOverTwoBezierNode;o.initNode(this._data.moveSpeed),e.push(o)}var s=this._data.moveSpeed.velocityLimit;if(s)if(s.type==t.ParticleValueType.Const||s.type==t.ParticleValueType.RandomConst){var h=new t.ParticleVelocityLimitConstNode;h.initNode(this._data.moveSpeed),e.push(h)}else if(s.type==t.ParticleValueType.OneBezier){var l=new t.ParticleVelocityLimitOneBezierNode;l.initNode(this._data.moveSpeed),e.push(l)}else if(s.type==t.ParticleValueType.TwoBezier){var u=new t.ParticleVelocityLimitTwoBezierNode;u.initNode(this._data.moveSpeed),e.push(u)}var c=this._data.moveSpeed.velocityForce;if(c)if(c.type==t.ParticleValueType.Const||c.type==t.ParticleValueType.RandomConst){var d=new t.ParticleVelocityForceConstNode;d.initNode(this._data.moveSpeed),e.push(d)}else if(c.type==t.ParticleValueType.OneBezier){var p=new t.ParticleVelocityForceOneBezierNode;p.initNode(this._data.moveSpeed),e.push(p)}else if(c.type==t.ParticleValueType.TwoBezier){var f=new t.ParticleVelocityForceTwoBezierNode;f.initNode(this._data.moveSpeed),e.push(f)}var _=new t.ParticleRotation;_.initNode(this._data.rotationBirth),e.push(_);var m=new t.ParticleScale;m.initNode(this._data.scaleBirth),e.push(m);var g=new t.ParticleStartColor;if(g.initNode(this._data.property),e.push(g),this._data.followTarget){var v=new t.ParticleFollowNode;v.initNode(this._data.followTarget),e.push(v)}if(this._data.scaleBezier){var y=new t.ParticleSizeGlobalNode;y.initNode(this._data.scaleBezier),e.push(y)}if(this._data.rotationSpeed)if(this._data.rotationSpeed.type==t.ParticleValueType.Const||this._data.rotationSpeed.type==t.ParticleValueType.RandomConst){var x=new t.ParticleRotationConstNode;x.initNode(this._data.rotationSpeed),e.push(x)}else if(this._data.rotationSpeed.type==t.ParticleValueType.OneBezier){var b=new t.ParticleRotationOneBezierNode;b.initNode(this._data.rotationSpeed),e.push(b)}else if(this._data.rotationSpeed.type==t.ParticleValueType.TwoBezier){var D=new t.ParticleRotationTwoBezierNode;D.initNode(this._data.rotationSpeed),e.push(D)}if(this._data.colorOffset){var T=new t.ParticleColorGlobalNode;T.initNode(this._data.colorOffset),e.push(T)}if(this._data.materialData)for(var w,P=0,S=this._data.materialData.methods;P<S.length;P++)if(w=S[P],w.type==t.MatMethodData.methodType.lightmapMethod);else if(w.type==t.MatMethodData.methodType.uvRollMethod){var A=new t.ParticleUVRollNode;A.initNode(null,w),e.push(A)}else w.type==t.MatMethodData.methodType.alphaMaskMethod||w.type==t.MatMethodData.methodType.streamerMethod;if(this._data.textureSheet){var C=new t.ParticleTextureSheetNode;C.initNode(null,this._data.textureSheet),e.push(C)}for(var E=0,M=e.length;M>E;E++)this._particleAnimation.particleAnimationState.addNode(e[E])},i.prototype.initUserAnimNode=function(){for(var t=0;t<this._userNodes.length;t++)this._particleAnimation.particleAnimationState.addNode(this._userNodes[t])},i.prototype.initEndNode=function(){var e=new t.ParticleEndNode;this._particleAnimation.particleAnimationState.addNode(e),this._particleAnimation.particleAnimationState.calculate(this.geometry)},i.prototype.initBoudBox=function(e){var i=new t.BoundBox(this);i.fillBox(new t.Vector3D(-e.x/2,-e.y/2,-e.z/2),new t.Vector3D(e.x/2,e.y/2,e.z/2)),this.bound=i,this.initAABB()},Object.defineProperty(i.prototype,"loopProgress",{get:function(){var t;return t=this.animation.animTime/(1e3*this._particleState.circleTime)},enumerable:!0,configurable:!0}),i.prototype.update=function(t,i,r){this._isEmitterDirty&&this.buildParticle(),e.prototype.update.call(this,t,i,r)},i.prototype.clone=function(){var e;e=new i(this.data,this.material),e.position=this.position,e.orientation=this.orientation,e.scale=this.scale;var r=[t.ParticleDataSubEmitterPhase.BIRTH,t.ParticleDataSubEmitterPhase.COLLISION,t.ParticleDataSubEmitterPhase.DEATH];if(this._subEmitterNode)for(var a=0;a<r.length;a++){var n=r[a],o=this._subEmitterNode.getSubEmitters(n);if(o&&o.length>0)for(var s=0;s<o.length;s++)e.addSubEmitter(n,o[s])}return e},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._generator&&(this._generator.dispose(),this._generator=null),this._timeNode=null,this._positionNode=null,this._geometryShape=null,this._externalGeometry=null,this._particleAnimation=null,this._particleState&&(this._particleState.dispose(),this._particleState=null),this._subEmitterNode=null,this._userNodes=null,this._data=null},i}(t.Mesh);t.ParticleEmitter=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(t){this._animations=[],this._animCount=0,this._animations=[],this.collectAnimations(t,this._animations),this._timeOffset=[],this._animCount=this._timeOffset.length=this._animations.length;for(var e=0;e<this._animCount;e++)this._timeOffset[e]=0}return e.prototype.collectAnimations=function(e,i){var r,a;e instanceof t.Mesh&&(r=e,a=r.animation,a&&i.push(a));for(var n=e.childs.length,o=0;n>o;o++)this.collectAnimations(e.childs[o],i)},e.prototype.play=function(t,e,i,r){for(var a;a<this._animCount;a++){var n=this._animations[a];n.play(t,e,i,r)}this._isPlay=!0},e.prototype.resetTime=function(t){void 0===t&&(t=0);for(var e;e<this._animCount;e++){var i=this._animations[e];i.animTime=this._timeOffset[e]+t}},e.prototype.stop=function(){for(var t;t<this._animCount;t++)this._animations[t].stop();this._isPlay=!1},e.prototype.isPlay=function(){return this._isPlay},e.prototype.dispose=function(){this.stop(),this._animations.length=0,this._animations=null},e}();t.EffectGroup=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){void 0===i&&(i=null),e.call(this,i),this.addEventListener(t.LoaderEvent3D.LOADER_COMPLETE,this.onResourceLoaded,this)}return __extends(i,e),i.prototype.onResourceLoaded=function(){this.removeEventListener(t.LoaderEvent3D.LOADER_COMPLETE,this.onResourceLoaded,this),this._effectGroup=new t.EffectGroup(this.container)},Object.defineProperty(i.prototype,"effectGroup",{get:function(){return this._effectGroup},enumerable:!0,configurable:!0}),i}(t.MapLoader);t.EffectGroupLoader=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.enablePick=!1,this.pickRender=new t.MultiRender(t.PassType.PickPass),this.pickRender.setRenderToTexture(128,128,t.FrameBufferFormat.UNSIGNED_BYTE_RGBA)}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e.prototype.update=function(e,i,r,a,n){t.Egret3DCanvas.context3DProxy.clearColor(1,1,1,1),t.Egret3DCanvas.context3DProxy.clear(t.Context3DProxy.gl.COLOR_BUFFER_BIT|t.Context3DProxy.gl.DEPTH_BUFFER_BIT),this.pickRender.draw(r,a,t.Egret3DCanvas.context3DProxy,e,i,n)},e}();t.PickSystem=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this._root=new t.Object3D,this._tree=new t.TreeBase(this._root)}return Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"quad",{get:function(){return this._quad},enumerable:!0,configurable:!0}),e.prototype.addChild3D=function(t){this._root.addChild(t)},e.prototype.removeChild3D=function(t){this._root.removeChild(t)},e.prototype.update=function(){},e.prototype.infrustumList=function(t){return this._tree.infrustumList(t)},e.prototype.createQuadTree=function(){this._quad=new t.QuadRoot(16,2500);var e=new Array;this.collectQuadList(e,this.root),this._quad.createQuadTree(e)},e.prototype.collectQuadList=function(e,i){e=e||new Array;var r;i instanceof t.Mesh&&(r=i,r.aabb&&e.push(r));var a;if(i.childs&&i.childs.length>0)for(var n=0,o=i.childs;n<o.length;n++)a=o[n],this.collectQuadList(e,a);return e},e}();t.Scene3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(t){this._searchList=new Array,this._root=t}return t.prototype.infrustumList=function(){return this._searchList.length=0,this._searchList},t}();t.TreeBase=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.useMipmap=!0,this.smooth=!0,this.repeat=!1,this.premultiply_alpha=0,this.filp_y=0,this.hasMipmap=!1,this.ready=!1}return e.prototype.copyFromTexture=function(e,i,r,a,n){this.parentTexture=e,e.width=a,e.height=n,this.guiIndex=e.guiIndex,this.texture2D=e.texture2D,this.uvRectangle=this.uvRectangle||new t.Rectangle,this.uvRectangle.x=i,this.uvRectangle.y=r,this.uvRectangle.width=a,this.uvRectangle.height=n},e.prototype.upload=function(){},e.prototype.uploadForcing=function(){},e.prototype.activeState=function(e){this.ready||(this.ready=!0,this.premultiply_alpha||t.Context3DProxy.gl.pixelStorei(t.Context3DProxy.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this.useMipmap&&!this.hasMipmap&&(t.Context3DProxy.gl.generateMipmap(t.Context3DProxy.gl.TEXTURE_2D),this.hasMipmap=!0),this.smooth?this.hasMipmap?(e.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_MIN_FILTER,t.Context3DProxy.gl.LINEAR_MIPMAP_LINEAR),e.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_MAG_FILTER,t.Context3DProxy.gl.LINEAR)):(e.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_MIN_FILTER,t.Context3DProxy.gl.LINEAR),e.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_MAG_FILTER,t.Context3DProxy.gl.LINEAR)):(e.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_MIN_FILTER,t.Context3DProxy.gl.NEAREST),e.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_MAG_FILTER,t.Context3DProxy.gl.NEAREST)),this.repeat?(e.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_WRAP_S,t.Context3DProxy.gl.REPEAT),e.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_WRAP_T,t.Context3DProxy.gl.REPEAT)):(e.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_WRAP_S,t.Context3DProxy.gl.CLAMP_TO_EDGE),e.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_WRAP_T,t.Context3DProxy.gl.CLAMP_TO_EDGE)),this.filp_y&&t.Context3DProxy.gl.pixelStorei(t.Context3DProxy.gl.UNPACK_FLIP_Y_WEBGL,this.filp_y))},e.prototype.dispose=function(){this.texture2D&&this.texture2D.dispose(),this.texture3D&&this.texture3D.dispose()},e}();t.ITexture=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this),this.imageData=i,this.texture2D=new t.ContextTexture2D,this.texture2D.imageData=i}return __extends(i,e),Object.defineProperty(i.prototype,"width",{get:function(){return this.imageData.width},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this.imageData.height},enumerable:!0,configurable:!0}),i.prototype.upload=function(e){this.texture2D.textureBuffer||(this.texture2D.textureBuffer=this.texture2D.textureBuffer||e.creatTexture(),this.texture2D.internalFormat=t.InternalFormat.ImageData,this.texture2D.imageData=this.imageData,this.texture2D.dataFormat=t.Context3DProxy.gl.UNSIGNED_BYTE,this.texture2D.colorFormat=t.ContextConfig.ColorFormat_RGBA8888,e.upLoadTextureData(0,this))},i.prototype.uploadForcing=function(t){t.upLoadTextureData(0,this)},i}(t.ITexture);t.ImageTexture=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.smooth=!0,this.texture2D=new t.ContextTexture2D}return __extends(i,e),i.prototype.upload=function(e){if(!this.texture2D.textureBuffer){if(this.texture2D.textureBuffer=this.texture2D.textureBuffer||e.creatTexture(),this.texture2D.internalFormat=this.internalFormat,this.texture2D.colorFormat=this.colorFormat,this.texture2D.mimapData=this.mimapData,this.texture2D.dataFormat=t.Context3DProxy.gl.UNSIGNED_BYTE,this.mimapData&&this.mimapData.length>0)for(var i=0;i<this.mimapData.length;i++)e.upLoadTextureData(i,this);else e.upLoadTextureData(0,this);this.parentTexture&&(this.parentTexture.texture2D||this.parentTexture.upload(e),this.texture2D=this.parentTexture.texture2D,this.texture2D.internalFormat=this.parentTexture.internalFormat,this.texture2D.colorFormat=this.parentTexture.colorFormat,this.texture2D.mimapData=this.parentTexture.mimapData)}},i.prototype.uploadForcing=function(t){t.upLoadTextureData(0,this)},i}(t.ITexture);t.Texture=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r,a,n,o,s){void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===s&&(s=null),e.call(this),this.image_front=i,this.image_back=r,this.image_left=a,this.image_right=n,this.image_up=o,this.image_down=s,this.texture3D=new t.ContextTexture3D}return __extends(i,e),i.createCubeTexture=function(e,r,a,n,o,s){var h=new t.ContextTexture2D;h.imageData=e;var l=new t.ContextTexture2D;l.imageData=r;var u=new t.ContextTexture2D;u.imageData=a;var c=new t.ContextTexture2D;c.imageData=n;var d=new t.ContextTexture2D;d.imageData=o;var p=new t.ContextTexture2D;p.imageData=s;var f=new i(h,l,u,c,d,p);return f},i.createCubeTextureByImageTexture=function(t,e,r,a,n,o){return new i(t.texture2D,e.texture2D,r.texture2D,a.texture2D,n.texture2D,o.texture2D)},i.setCubeTexture=function(t,e,i,r,a,n,o){t.image_front=e.texture2D,t.image_back=i.texture2D,t.image_left=r.texture2D,t.image_right=a.texture2D,t.image_up=n.texture2D,t.image_down=o.texture2D},i.prototype.upload=function(t){this.image_front&&this.image_back&&this.image_left&&this.image_right&&this.image_up&&this.image_down&&(this.texture3D.texture||(this.texture3D.texture=this.texture3D.texture||t.creatTexture(),this.texture3D.border=0,this.texture3D.image_front=this.image_front,this.texture3D.image_back=this.image_back,this.texture3D.image_left=this.image_left,this.texture3D.image_right=this.image_right,this.texture3D.image_up=this.image_up,this.texture3D.image_down=this.image_down,t.uploadCubetexture(this.texture3D)))},i.prototype.uploadForcing=function(){},i}(t.ITexture);t.CubeTexture=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.width=32,this.height=32,this.uvRectangle=new t.Rectangle(0,0,1,1),this.buildCheckerboard(),this.texture2D=new t.ContextTexture2D}return __extends(i,e),i.prototype.upload=function(e){this.texture2D.textureBuffer||(this.texture2D.textureBuffer=this.texture2D.textureBuffer||e.creatTexture(),this.texture2D.border=0,this.texture2D.internalFormat=t.InternalFormat.PixelArray,this.texture2D.colorFormat=t.Context3DProxy.gl.RGBA,this.texture2D.mimapData=new Array,this.texture2D.mimapData.push(new t.MipmapData(this._pixelArray,this.width,this.height)),this.texture2D.width=this.width,this.texture2D.height=this.height,this.useMipmap=!1,this.texture2D.dataFormat=t.Context3DProxy.gl.UNSIGNED_BYTE,e.upLoadTextureData(0,this))},i.prototype.buildCheckerboard=function(){if(!this._pixelArray){this._pixelArray=new Uint8Array(this.width*this.height*4);for(var e=[t.Color.white(),t.Color.black()],i=0,r=4,a=0;a<this.height;a++)for(var n=0;n<this.width;n++){if(n%r==0&&(i=(i+1)%2),a%r==0&&0==n){var o=e[0];e[0]=e[1],e[1]=o,i=0}this._pixelArray[4*a*this.width+4*n+0]=e[i].r,this._pixelArray[4*a*this.width+4*n+1]=e[i].g,this._pixelArray[4*a*this.width+4*n+2]=e[i].b,this._pixelArray[4*a*this.width+4*n+3]=e[i].a}}},i.prototype.uploadForcing=function(){},i.texture=new i,i}(t.ITexture);t.CheckerboardTexture=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r){var a=this;void 0===i&&(i=256),void 0===r&&(r=256),e.call(this),this.canUpdataTexture=!1,this.width=i,this.height=r,this.texture2D=new t.ContextTexture2D,this.tmpCanvas=document.createElement("canvas"),this.tmpCanvas.width=i,this.tmpCanvas.height=r,this.context=this.tmpCanvas.getContext("2d"),this.video=document.createElement("video"),this.video.msZoom=!0,this.video.width=i,this.video.height=r,this.video.videoWidth=i,this.video.videoHeight=r,this.video.controls=!1,this.video.autoplay=!0,this.video.addEventListener("canplaythrough",function(){return a.loadReady()},!0),this.tmpCanvas.hidden=!0}return __extends(i,e),i.prototype.loadReady=function(){this.canUpdataTexture=!0},Object.defineProperty(i.prototype,"source",{get:function(){return this.video.src},set:function(t){this.video.src=t},enumerable:!0,configurable:!0}),i.prototype.play=function(){this.video.play()},i.prototype.pause=function(){this.video.pause()},i.prototype.upload=function(e){this.texture2D.textureBuffer||(this.texture2D.textureBuffer=this.texture2D.textureBuffer||e.creatTexture(),this.context.drawImage(this.video,0,0,this.width,this.height),t.Context3DProxy.gl.pixelStorei(t.Context3DProxy.gl.UNPACK_ALIGNMENT,1),t.Context3DProxy.gl.bindTexture(t.Context3DProxy.gl.TEXTURE_2D,this.texture2D.textureBuffer),t.Context3DProxy.gl.texImage2D(t.Context3DProxy.gl.TEXTURE_2D,0,t.Context3DProxy.gl.RGB,t.Context3DProxy.gl.RGB,t.Context3DProxy.gl.UNSIGNED_BYTE,this.tmpCanvas),t.Context3DProxy.gl.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_MIN_FILTER,t.Context3DProxy.gl.LINEAR),t.Context3DProxy.gl.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_MAG_FILTER,t.Context3DProxy.gl.LINEAR),t.Context3DProxy.gl.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_WRAP_S,t.Context3DProxy.gl.CLAMP_TO_EDGE),t.Context3DProxy.gl.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_WRAP_T,t.Context3DProxy.gl.CLAMP_TO_EDGE)),this.canUpdataTexture&&(this.context.drawImage(this.video,0,0,this.width,this.height),t.Context3DProxy.gl.pixelStorei(t.Context3DProxy.gl.UNPACK_ALIGNMENT,1),t.Context3DProxy.gl.bindTexture(t.Context3DProxy.gl.TEXTURE_2D,this.texture2D.textureBuffer),t.Context3DProxy.gl.texImage2D(t.Context3DProxy.gl.TEXTURE_2D,0,t.Context3DProxy.gl.RGB,t.Context3DProxy.gl.RGB,t.Context3DProxy.gl.UNSIGNED_BYTE,this.tmpCanvas),t.Context3DProxy.gl.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_MIN_FILTER,t.Context3DProxy.gl.LINEAR),t.Context3DProxy.gl.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_MAG_FILTER,t.Context3DProxy.gl.LINEAR),t.Context3DProxy.gl.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_WRAP_S,t.Context3DProxy.gl.CLAMP_TO_EDGE),t.Context3DProxy.gl.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_WRAP_T,t.Context3DProxy.gl.CLAMP_TO_EDGE))},i.prototype.uploadForcing=function(){},i}(t.ITexture);t.VideoTexture=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r,a){void 0===i&&(i=512),void 0===r&&(r=512),void 0===a&&(a=t.FrameBufferFormat.UNSIGNED_BYTE_RGB),e.call(this),this.frameBufferFormat=t.FrameBufferFormat.UNSIGNED_BYTE_RGB,this.useMipmap=!1,this.smooth=!1,this.width=i,this.height=r,this.frameBufferFormat=a,this.uvRectangle=new t.Rectangle(0,0,1,1)}return __extends(i,e),i.prototype.upload=function(t){this.texture2D||(this.texture2D=t.createFramebuffer(this.width,this.height,this.frameBufferFormat))},i.prototype.uploadForcing=function(){},i}(t.ITexture);t.RenderTexture=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){}return t.LITTLE_ENDIAN="littleEndian",t.BIG_ENDIAN="bigEndian",t}();t.Endian=e;var i=function(){function t(t){this.BUFFER_EXT_SIZE=0,this.EOF_byte=-1,this.EOF_code_point=-1,this._setArrayBuffer(t||new ArrayBuffer(this.BUFFER_EXT_SIZE)),this.endian=e.BIG_ENDIAN}return t.prototype._setArrayBuffer=function(t){this.write_position=t.byteLength,this.data=new DataView(t),this._position=0},t.prototype.setArrayBuffer=function(){},Object.defineProperty(t.prototype,"buffer",{get:function(){return this.data.buffer},set:function(t){this.data=new DataView(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataView",{get:function(){return this.data},set:function(t){this.data=t,this.write_position=t.byteLength},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bufferOffset",{get:function(){return this.data.byteOffset},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t,this.write_position=t>this.write_position?t:this.write_position},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this.write_position},set:function(t){this.write_position=t;var e=new Uint8Array(new ArrayBuffer(t)),i=this.data.buffer.byteLength;i>t&&(this._position=t);var r=Math.min(i,t);e.set(new Uint8Array(this.data.buffer,0,r)),this.buffer=e.buffer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bytesAvailable",{get:function(){return this.data.byteLength-this._position},enumerable:!0,configurable:!0}),t.prototype.clear=function(){this._setArrayBuffer(new ArrayBuffer(this.BUFFER_EXT_SIZE))},t.prototype.readBoolean=function(){return this.validate(t.SIZE_OF_BOOLEAN)?0!=this.data.getUint8(this.position++):null},t.prototype.readByte=function(){return this.validate(t.SIZE_OF_INT8)?this.data.getInt8(this.position++):null},t.prototype.readBytes=function(e,i,r){if(void 0===i&&(i=0),void 0===r&&(r=0),0==r)r=this.bytesAvailable;else if(!this.validate(r))return null;e?e.validateBuffer(i+r):e=new t(new ArrayBuffer(i+r));for(var a=0;r>a;a++)e.data.setUint8(a+i,this.data.getUint8(this.position++))},t.prototype.readDouble=function(){if(!this.validate(t.SIZE_OF_FLOAT64))return null;var i=this.data.getFloat64(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=t.SIZE_OF_FLOAT64,i},t.prototype.readFloat=function(){if(!this.validate(t.SIZE_OF_FLOAT32))return null;var i=this.data.getFloat32(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=t.SIZE_OF_FLOAT32,i},t.prototype.readInt=function(){if(!this.validate(t.SIZE_OF_INT32))return null;var i=this.data.getInt32(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=t.SIZE_OF_INT32,i},t.prototype.readShort=function(){if(!this.validate(t.SIZE_OF_INT16))return null;var i=this.data.getInt16(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=t.SIZE_OF_INT16,i},t.prototype.readUnsignedByte=function(){return this.validate(t.SIZE_OF_UINT8)?this.data.getUint8(this.position++):null},t.prototype.readUnsignedInt=function(){if(!this.validate(t.SIZE_OF_UINT32))return null;var i=this.data.getUint32(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=t.SIZE_OF_UINT32,i},t.prototype.readUnsignedShort=function(){if(!this.validate(t.SIZE_OF_UINT16))return null;var i=this.data.getUint16(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=t.SIZE_OF_UINT16,i},t.prototype.readUTF=function(){if(!this.validate(t.SIZE_OF_UINT16))return null;var i=this.data.getUint16(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=t.SIZE_OF_UINT16,i>0?this.readUTFBytes(i):""},t.prototype.readUTFBytes=function(t){if(!this.validate(t))return null;var e=new Uint8Array(this.buffer,this.bufferOffset+this.position,t);return this.position+=t,this.decodeUTF8(e)},t.prototype.writeBoolean=function(e){this.validateBuffer(t.SIZE_OF_BOOLEAN),this.data.setUint8(this.position++,e?1:0)},t.prototype.writeByte=function(e){this.validateBuffer(t.SIZE_OF_INT8),this.data.setInt8(this.position++,e)},t.prototype.writeBytes=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);var r;if(!(0>e)&&!(0>i)&&(r=0==i?t.length-e:Math.min(t.length-e,i),r>0)){this.validateBuffer(r);for(var a=new DataView(t.buffer),i=r,n=4;i>n;i-=n)this.data.setUint32(this._position,a.getUint32(e)),this.position+=n,e+=n;for(;i>0;i--)this.data.setUint8(this.position++,a.getUint8(e++))}},t.prototype.writeDouble=function(i){this.validateBuffer(t.SIZE_OF_FLOAT64),this.data.setFloat64(this.position,i,this.endian==e.LITTLE_ENDIAN),this.position+=t.SIZE_OF_FLOAT64},t.prototype.writeFloat=function(i){this.validateBuffer(t.SIZE_OF_FLOAT32),this.data.setFloat32(this.position,i,this.endian==e.LITTLE_ENDIAN),this.position+=t.SIZE_OF_FLOAT32},t.prototype.writeInt=function(i){this.validateBuffer(t.SIZE_OF_INT32),this.data.setInt32(this.position,i,this.endian==e.LITTLE_ENDIAN),this.position+=t.SIZE_OF_INT32},t.prototype.writeShort=function(i){this.validateBuffer(t.SIZE_OF_INT16),this.data.setInt16(this.position,i,this.endian==e.LITTLE_ENDIAN),this.position+=t.SIZE_OF_INT16},t.prototype.writeUnsignedInt=function(i){this.validateBuffer(t.SIZE_OF_UINT32),this.data.setUint32(this.position,i,this.endian==e.LITTLE_ENDIAN),this.position+=t.SIZE_OF_UINT32},t.prototype.writeUnsignedShort=function(i){this.validateBuffer(t.SIZE_OF_UINT16),this.data.setUint16(this.position,i,this.endian==e.LITTLE_ENDIAN),this.position+=t.SIZE_OF_UINT16},t.prototype.writeUTF=function(i){var r=this.encodeUTF8(i),a=r.length;this.validateBuffer(t.SIZE_OF_UINT16+a),this.data.setUint16(this.position,a,this.endian==e.LITTLE_ENDIAN),this.position+=t.SIZE_OF_UINT16,this._writeUint8Array(r,!1)},t.prototype.writeUTFBytes=function(t){this._writeUint8Array(this.encodeUTF8(t))},t.prototype.toString=function(){return"[ByteArray] length:"+this.length+", bytesAvailable:"+this.bytesAvailable},t.prototype._writeUint8Array=function(t,e){void 0===e&&(e=!0),e&&this.validateBuffer(this.position+t.length);for(var i=0;i<t.length;i++)this.data.setUint8(this.position++,t[i])},t.prototype.validate=function(t){return this.data.byteLength>0&&this._position+t<=this.data.byteLength?!0:void 0},t.prototype.validateBuffer=function(t,e){if(void 0===e&&(e=!1),this.write_position=t>this.write_position?t:this.write_position,t+=this._position,this.data.byteLength<t||e){var i=new Uint8Array(new ArrayBuffer(t+this.BUFFER_EXT_SIZE)),r=Math.min(this.data.buffer.byteLength,t+this.BUFFER_EXT_SIZE);i.set(new Uint8Array(this.data.buffer,0,r)),this.buffer=i.buffer}},t.prototype.encodeUTF8=function(t){for(var e=0,i=this.stringToCodePoints(t),r=[];i.length>e;){var a=i[e++];if(this.inRange(a,55296,57343))this.encoderError(a);else if(this.inRange(a,0,127))r.push(a);else{var n,o;for(this.inRange(a,128,2047)?(n=1,o=192):this.inRange(a,2048,65535)?(n=2,o=224):this.inRange(a,65536,1114111)&&(n=3,o=240),r.push(this.div(a,Math.pow(64,n))+o);n>0;){var s=this.div(a,Math.pow(64,n-1));r.push(128+s%64),n-=1}}}return new Uint8Array(r)},t.prototype.decodeUTF8=function(t){for(var e,i=!1,r=0,a="",n=0,o=0,s=0,h=0;t.length>r;){var l=t[r++];if(l==this.EOF_byte)e=0!=o?this.decoderError(i):this.EOF_code_point;else if(0==o)this.inRange(l,0,127)?e=l:(this.inRange(l,194,223)?(o=1,h=128,n=l-192):this.inRange(l,224,239)?(o=2,h=2048,n=l-224):this.inRange(l,240,244)?(o=3,h=65536,n=l-240):this.decoderError(i),n*=Math.pow(64,o),e=null);else if(this.inRange(l,128,191))if(s+=1,n+=(l-128)*Math.pow(64,o-s),s!==o)e=null;else{var u=n,c=h;n=0,o=0,s=0,h=0,e=this.inRange(u,c,1114111)&&!this.inRange(u,55296,57343)?u:this.decoderError(i,l)}else n=0,o=0,s=0,h=0,r--,e=this.decoderError(i,l);null!==e&&e!==this.EOF_code_point&&(65535>=e?e>0&&(a+=String.fromCharCode(e)):(e-=65536,a+=String.fromCharCode(55296+(e>>10&1023)),a+=String.fromCharCode(56320+(1023&e))))}return a},t.prototype.encoderError=function(){},t.prototype.decoderError=function(t,e){return e||65533},t.prototype.inRange=function(t,e,i){return t>=e&&i>=t},t.prototype.div=function(t,e){return Math.floor(t/e)},t.prototype.stringToCodePoints=function(t){for(var e=[],i=0,r=t.length;i<t.length;){var a=t.charCodeAt(i);if(this.inRange(a,55296,57343))if(this.inRange(a,56320,57343))e.push(65533);else if(i==r-1)e.push(65533);else{var n=t.charCodeAt(i+1);if(this.inRange(n,56320,57343)){var o=1023&a,s=1023&n;i+=1,e.push(65536+(o<<10)+s)}else e.push(65533)}else e.push(a);i+=1}return e},t.SIZE_OF_BOOLEAN=1,t.SIZE_OF_INT8=1,t.SIZE_OF_INT16=2,t.SIZE_OF_INT32=4,t.SIZE_OF_UINT8=1,t.SIZE_OF_UINT16=2,t.SIZE_OF_UINT32=4,t.SIZE_OF_FLOAT32=4,t.SIZE_OF_FLOAT64=8,t}();t.ByteArray=i}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){this.isDebug=!1,this._console=document.createElement("console"),document.body.appendChild(this._console),this._console.style.color="red",this._console.style.zIndex="1000",this._console.style.position="absolute",this._console.style.top="10px",this._console.style.left="10px"
}return t.prototype.trace=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];if(this.isDebug){this.reset();for(var i=t.length,r=0;i>r;r++)this._console.innerHTML+=t[r]+"</br>"}},t.prototype.reset=function(){this._console.innerHTML=""},Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t._instance=null,t}();t.Debug=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.parseContent=function(t){for(var e=new Array,i="",r=";",a=-1,n=0;n<t.length;++n)if("{"==t.charAt(n)&&(a=i.indexOf("="),0>a&&(r="}")),(""!=i||" "!=t.charAt(n)&&"    "!=t.charAt(n)&&"	"!=t.charAt(n))&&(i+=t.charAt(n),"\n"!=r&&(i.indexOf("#extension")>=0?r="\n":i.indexOf("#define")>=0&&(r="\n")),r==t.charAt(n))){if("}"==r){for(var o=0,s=0,h=0;h<i.length;++h)"{"==i.charAt(h)?o++:"}"==i.charAt(h)&&s++;if(o!=s)continue;if(i.indexOf("struct")>=0){r=";";continue}}i.length>0&&e.push(i),i="",r=";"}return e},e.parseLines=function(t){for(var e=new Array,i="",r=!1,a=0;a<t.length;++a)if(r){if(";"==t.charAt(a)){r=!1,i.length>0&&(e.push(i),i="");break}i+=t.charAt(a)}else if(" "!=t.charAt(a)&&"	"!=t.charAt(a)&&","!=t.charAt(a)&&"\r"!=t.charAt(a)&&"\n"!=t.charAt(a)&&":"!=t.charAt(a)){if(";"==t.charAt(a)){i.length>0&&(e.push(i),i="");break}if("="==t.charAt(a)){i.length>0&&(e.push(i),i=""),e.push("="),r=!0;continue}i+=t.charAt(a),a==t.length-1&&""!=t&&(e.push(i),i="")}else""!=i&&(e.push(i),i="");return e},e.hasString=function(t,e){for(var i=0;i<t.length;++i)if(t[i]==e)return i;return-1},e.getVarName=function(t){var e=this.hasString(t,"=");if(e>=0){if(e-=1,e>=0&&e<t.length)return t[e]}else if(e=t.length-1,e>=0&&e<t.length)return t[e];return""},e.getVarValue=function(t){var e=this.hasString(t,"=");return e>=0&&(e+=1,e>=0&&e<t.length)?t[e]:""},e.getVarType=function(t){var e=this.hasString(t,"=");if(e>=0){if(e-=2,e>=0&&e<t.length)return t[e]}else if(e=t.length-2,e>=0&&e<t.length)return t[e];return""},e.getVarKey=function(t){var e=this.hasString(t,"=");return e>=0?(e-=3,e>=0&&e<t.length?t[e]:""):(e=t.length-3,e>=0&&e<t.length?t[e]:t[0])},e.processShaderFile=function(t){var e=["\n","\r"];e=[];for(var i=t,r=i;;){var a=i.indexOf("//");if(0>a)break;var n=i.indexOf("\r\n",a);-1==n&&(n=i.indexOf("\n",a));var o=i.slice(a,n);if(i=i.replace(o,""),i==r)break;r=i}for(var s=0;s<e.length;++s)for(;r=i.replace(e[s],""),i!=r;)i=r;return i},e.colorRgb=function(t){var e=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/,i=t.toLowerCase();if(i&&e.test(i)){if(4===i.length){for(var r="#",a=1;4>a;a+=1)r+=i.slice(a,a+1).concat(i.slice(a,a+1));i=r}for(var n=[],a=1;7>a;a+=2)n.push(parseInt("0x"+i.slice(a,a+2)));return"RGB("+n.join(",")+")"}return i},e.getLineType=function(t){var e=t.indexOf("{");if(e>0){var i=t.substr(0,e);if(i.indexOf("struct")>=0){var r=i.lastIndexOf(" ");r++;var a=i.substr(r,i.length-r);return"struct "+a}if(i.indexOf("=")<0){var n=t.indexOf("("),r=t.lastIndexOf(" ",n);r++;var o=t.substr(r,n-r);return"function "+o}}return"unknown"},e.processStruct=function(t,i,r){var a=i.lastIndexOf("}");a++;for(var n=i.lastIndexOf(";"),o=i.substr(a,n-a),s=e.parseLines(o),h=0;h<s.length;++h){var l=e.getTemper(t+" "+s[h]+";");l&&r.addVar(l)}},e.getAttribute=function(i){var r,a,n,o=i,s=e.parseLines(o);return r=e.getVarName(s),a=e.getVarType(s),n=new t.GLSL.Attribute(r,a),n.value=e.getVarValue(s),n},e.getTemper=function(i){var r,a,n,o=i,s=e.parseLines(o);return r=e.getVarName(s),a=e.getVarType(s),n=new t.GLSL.TmpVar(r,a),n.value=e.getVarValue(s),n},e.getVarying=function(i){var r,a,n,o=i,s=e.parseLines(o);return r=e.getVarName(s),a=e.getVarType(s),n=new t.GLSL.Varying(r,a)},e.getUniform=function(i){var r,a,n,o=i,s=e.parseLines(o);return r=e.getVarName(s),a=e.getVarType(s),n=new t.GLSL.Uniform(r,a)},e.getConst=function(i){var r,a,n,o,s=i,h=e.parseLines(s);return r=e.getVarName(h),a=e.getVarType(h),n=e.getVarValue(h),o=new t.GLSL.ConstVar(r,a,n)},e.getExtension=function(i){var r=i.indexOf("#"),a=i.indexOf(" "),n=(i.substr(r,a),i.indexOf(":")),o=i.substr(a,n-a);o=e.replaceCharacter(o,[" "],""),n+=1;var s=i.substr(n,i.length-n);s=e.replaceCharacter(s,[" ",":","\n","\r"],"");var h=new t.GLSL.Extension(o);return h.value=s,h},e.getDefine=function(i){var r,a=i,n="",o="",s=e.parseLines(a);return n=s[1],s.length>=3&&(o=s[2]),r=new t.GLSL.DefineVar(n,o)},e.getSampler2D=function(i){var r,a,n=i,o=e.parseLines(n);return r=e.getVarName(o),a=new t.GLSL.Sampler2D(r)},e.getSampler3D=function(i){var r,a,n=i,o=e.parseLines(n);return r=e.getVarName(o),a=new t.GLSL.Sampler3D(r)},e.filterCharacter=function(t){for(var i=t,r=i,a=0;a<e._filterChar.length;++a)for(;r=i.replace(e._filterChar[a],""),i!=r;)i=r;return r},e.replaceCharacter=function(t,e,i){for(var r=t,a=!1;!a;){a=!0;for(var n=0;n<e.length;++n)if(r.indexOf(e[n])>=0){a=!1;break}for(var n=0;n<e.length;++n)r=r.replace(e[n],i)}return r},e.getURLName=function(t){var e=t.split(".");return e=e[0].split("/"),e[e.length-1]},e._filterChar=[" ","  ",";","\n","\r","	","\n","\r","	"],e}();t.StringUtil=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){void 0===i&&(i=100),e.call(this),this._xMat=new t.ColorMaterial(16711680),this._xMat.ambientColor=15790320,this._yMat=new t.ColorMaterial(65280),this._yMat.ambientColor=15790320,this._zMat=new t.ColorMaterial(255),this._zMat.ambientColor=15790320;var r,a=i/100;r=new t.CubeGeometry(i,a,a),this._lineX=new t.Mesh(r,this._xMat),this.addChild(this._lineX),r=new t.CubeGeometry(a,i,a),this._lineY=new t.Mesh(r,this._yMat),this.addChild(this._lineY),r=new t.CubeGeometry(a,a,i),this._lineZ=new t.Mesh(r,this._zMat),this.addChild(this._lineZ);var n=i/25,o=(i-n)/2;r=new t.CubeGeometry(n,n,n),this._boxX=new t.Mesh(r,this._xMat),this._boxX.position=new t.Vector3D(o,0,0),this.addChild(this._boxX),this._boxY=new t.Mesh(r,this._yMat),this._boxY.position=new t.Vector3D(0,o,0),this.addChild(this._boxY),this._boxZ=new t.Mesh(r,this._zMat),this._boxZ.position=new t.Vector3D(0,0,o),this.addChild(this._boxZ)}return __extends(i,e),i}(t.Object3D);t.AxisMesh=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e){void 0===e&&(e=null),this.cameraAnimationFrames=[],this._playing=!1,this._playTime=0,this._currentFrameIndex=0,this._loop=!0,this._smooth=!0,this._cameraAnimationFrame=new i,this._event=new t.Event3D,this._quatCurrentFrame=new t.Quaternion,this._quatnNextFrame=new t.Quaternion,this._quatn=new t.Quaternion,this._camera=e,this._cameraAnimationFrame.fov=45,this._cameraAnimationFrame.rotation=new t.Vector3D,this._cameraAnimationFrame.translation=new t.Vector3D}return e.prototype.bindCamera=function(t){this._camera=t},e.prototype.play=function(t){this.cameraAnimationFrames.length<=0||(this._loop=t,this._playTime=0,this._camera.isController=!1,this._playing=!0)},e.prototype.stop=function(){this._camera.isController=!0,this._playing=!1},e.prototype.update=function(t,i){if(this._playing){this._playTime+=5*i;var r=this._playTime%(this.cameraAnimationFrames[this.cameraAnimationFrames.length-1].time-this.cameraAnimationFrames[0].time+160),a=Math.floor(r/160)%this.cameraAnimationFrames.length;this._currentFrameIndex>a&&(this._loop||(this._playing=!1,this._camera.isController=!0),this._camera&&(this._event.eventType=e.EVENT_CAMERA_COMPLETE,this._event.target=this,this._camera.dispatchEvent(this._event))),this._currentFrameIndex=a;var n=this.cameraAnimationFrames[a];if(this._smooth){var o=(a+1)%this.cameraAnimationFrames.length,s=this.cameraAnimationFrames[o],h=(r-n.time)/Math.abs(s.time-n.time);this._cameraAnimationFrame.fov=(s.fov-n.fov)*h+n.fov,this._quatCurrentFrame.fromEulerAngles(n.rotation.x,n.rotation.y,n.rotation.z),this._quatnNextFrame.fromEulerAngles(s.rotation.x,s.rotation.y,s.rotation.z),this._quatn.lerp(this._quatCurrentFrame,this._quatnNextFrame,h),this._quatn.toEulerAngles(this._cameraAnimationFrame.rotation),this._cameraAnimationFrame.translation.lerp(n.translation,s.translation,h)}else this._cameraAnimationFrame.fov=n.fov,this._cameraAnimationFrame.rotation.copyFrom(n.rotation),this._cameraAnimationFrame.translation.copyFrom(n.translation);this._camera.rotation=this._cameraAnimationFrame.rotation,this._camera.position=this._cameraAnimationFrame.translation}},e.EVENT_CAMERA_COMPLETE="event_camera_complete",e}();t.CameraAnimationController=e;var i=function(){function t(){}return t}();t.CameraAnimationFrame=i}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){this.cameras=new Array}return t.prototype.addCamera=function(t){this.cameras.push(t)},t.prototype.update=function(){},t.instance=new t,t}();t.CameraManager=e}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t.perspective=0]="perspective",t[t.orthogonal=1]="orthogonal",t[t.orthogonalToCenter=2]="orthogonalToCenter",t[t.VR=3]="VR"}(t.CameraType||(t.CameraType={}));var e=t.CameraType;!function(t){t[t.left=0]="left",t[t.right=1]="right"}(t.VRType||(t.VRType={}));var i=t.VRType,r=function(r){function a(i){void 0===i&&(i=e.perspective),r.call(this),this.projectMatrix=new t.Matrix4_4,this._orthProjectMatrix=new t.Matrix4_4,this._viewPort=new t.Rectangle,this._scissorRect=new t.Rectangle,this._aspectRatio=1,this._fovY=45,this._near=1,this._far=1e4,this.temp=new t.Matrix4_4,this._lookAtPosition=new t.Vector3D,this._up=new t.Vector3D(0,1,0),this._cameraType=0,this._cameraMatrixChange=!1,this._viewMatrix=new t.Matrix4_4,this._tempQuat=new t.Quaternion,this._normalMatrix=new t.Matrix4_4,this._unprojection=new t.Matrix4_4,this._animation=[],this.orthProjectChange=!0,this._mat=new t.Matrix4_4,this.raw=new Float32Array(16),this.v=new t.Vector3D,this.p=new t.Vector3D,this.frustum=new t.Frustum(this),this._orthProjectMatrix.ortho(this._viewPort.width,this._viewPort.height,this._near,this._far),this.cameraType=i,t.CameraManager.instance.addCamera(this)}return __extends(a,r),Object.defineProperty(a.prototype,"cameraType",{get:function(){return this._cameraType},set:function(i){switch(this._cameraType=i,i){case e.orthogonal:this.projectMatrix.ortho(this._viewPort.width,this._viewPort.height,this._near,this._far);break;case e.orthogonalToCenter:this.projectMatrix.orthoOffCenter(this._viewPort.x,this._viewPort.y,this._viewPort.width,this._viewPort.height,this._near,this._far);break;case e.perspective:this.projectMatrix.perspective(this._fovY,this._aspectRatio,this._near,this._far);break;case e.VR:this.projectMatrix.perspective(this._fovY,1,this._near,this._far),this.eyeMatrix=this.eyeMatrix||new t.EyesMatrix}this._orthProjectMatrix.ortho(this._viewPort.width,this._viewPort.height,this._near,this._far),this.frustum.updateFrustum()},enumerable:!0,configurable:!0}),a.prototype.tap=function(t,r){void 0===r&&(r=null),t==e.VR&&(this.eyeMatrix.update(this),this.orthProjectChange=!0,r==i.left?this.viewMatrix.copyFrom(this.eyeMatrix.leftEyeMatrix):r==i.right&&this.viewMatrix.copyFrom(this.eyeMatrix.rightEyeMatrix),this.viewMatrix.invert())},Object.defineProperty(a.prototype,"aspectRatio",{get:function(){return this._aspectRatio},set:function(t){this._aspectRatio!=t&&(this._aspectRatio=t,this.cameraType=this._cameraType)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fieldOfView",{get:function(){return this._fovY},set:function(t){this._fovY!=t&&(this._fovY=t,this.cameraType=this._cameraType)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"near",{get:function(){return this._near},set:function(t){this._near!=t&&(this._near=t,this.cameraType=this._cameraType)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"far",{get:function(){return this._far},set:function(t){this._far!=t&&(this._far=t,this.cameraType=this._cameraType)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"viewPort",{get:function(){return this._viewPort},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"viewProjectionMatrix",{get:function(){return this.temp.copyFrom(this.viewMatrix),this.temp.multiply(this.projectMatrix),this.temp},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"orthProjectionMatrix",{get:function(){return this.orthProjectChange&&(this.orthProjectChange=!1,this._orthProjectMatrix.ortho(this._viewPort.width,this._viewPort.height,this._near,this._far)),this._orthProjectMatrix},enumerable:!0,configurable:!0}),a.prototype.updateScissorRect=function(t,e,i,r){this._scissorRect.x=t,this._scissorRect.y=e,this._scissorRect.width=i,this._scissorRect.height=r},a.prototype.updateViewport=function(t,i,r,a){if(t!=this._viewPort.x||i!=this._viewPort.y||r!=this._viewPort.width||a!=this._viewPort.height)switch(this.orthProjectChange=!0,this._viewPort.x=t,this._viewPort.y=i,this._viewPort.width=r,this._viewPort.height=a,this.cameraType){case e.orthogonal:case e.orthogonalToCenter:this.cameraType=this.cameraType}},a.prototype.lookAt=function(e,i,r){void 0===r&&(r=t.Vector3D.Y_AXIS),this.position=e,this._lookAtPosition.copyFrom(i),this._up.copyFrom(r),this._viewMatrix.lookAt(this._pos,this._lookAtPosition,this._up),this._mat.copyFrom(this._viewMatrix),this._mat.invert();var a=this._mat.decompose(t.Orientation3D.QUATERNION);this._tempQuat.x=a[1].x,this._tempQuat.y=a[1].y,this._tempQuat.z=a[1].z,this._tempQuat.w=a[1].w,this.orientation=this._tempQuat},a.prototype.onUpdateTransform=function(){this._viewMatrix.copyFrom(this._modelMatrix3D),this._viewMatrix.invert(),this.frustum.update()},Object.defineProperty(a.prototype,"viewMatrix",{get:function(){return this._transformChange&&this.modelMatrix,this._viewMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"lookAtPosition",{get:function(){return this._lookAtPosition},enumerable:!0,configurable:!0}),a.prototype.updataOrth=function(t){var e,i,r,a,n=2e3,o=.5*n,s=o*this._aspectRatio;if(0==this._scissorRect.x&&0==this._scissorRect.y&&this._scissorRect.width==this._viewPort.width&&this._scissorRect.height==this._viewPort.height)e=-s,i=s,r=-o,a=o,this.raw[0]=2/(n*this._aspectRatio),this.raw[5]=2/n,this.raw[10]=1/(this._far-this._near),this.raw[14]=this._near/(this._near-this._far),this.raw[1]=this.raw[2]=this.raw[3]=this.raw[4]=this.raw[6]=this.raw[7]=this.raw[8]=this.raw[9]=this.raw[11]=this.raw[12]=this.raw[13]=0,this.raw[15]=1;else{var h=s*(this._viewPort.width/this._scissorRect.width),l=o*(this._viewPort.height/this._scissorRect.height),u=s*(2*this._scissorRect.x-this._viewPort.width)/this._scissorRect.width+s,c=-o*(2*this._scissorRect.y-this._viewPort.height)/this._scissorRect.height-o;e=u-h,i=u+h,r=c-l,a=c+l,this.raw[0]=2/(i-e),this.raw[5]=-2/(r-a),this.raw[10]=1/(this._far-this._near),this.raw[12]=(i+e)/(i-e),this.raw[13]=(a+r)/(a-r),this.raw[14]=this._near/(this.near-this.far),this.raw[1]=this.raw[2]=this.raw[3]=this.raw[4]=this.raw[6]=this.raw[7]=this.raw[8]=this.raw[9]=this.raw[11]=0,this.raw[15]=1}t.copyRawDataFrom(this.raw)},a.prototype.isVisibleToCamera=function(t){return t.modelMatrix,this.modelMatrix,t.bound?t.bound.inBound(this.frustum):!0},a.prototype.addAnimation=function(t,e){this._animation[t]=e},a.prototype.play=function(t,e){void 0===e&&(e=!1),this._animation[t]&&(this._animation[t].bindCamera(this),this._animation[t].play(e))},a.prototype.update=function(t,e,i){r.prototype.update.call(this,t,e,i);for(var a in this._animation)this._animation[a].update(t,e)},a.prototype.object3DToScreenRay=function(e,i){return void 0===i&&(i=null),i||(i=new t.Vector3D),this._halfw=.5*this.viewPort.width,this._halfh=.5*this.viewPort.height,i=this.viewMatrix.transformVector(e,i),this.project(i,i),i.x=this._halfw+i.x*this._halfw,i.y=this.viewPort.height-(this._halfh-i.y*this._halfh),i},a.prototype.ScreenRayToObject3D=function(e,i){return void 0===i&&(i=null),i||(i=new t.Vector3D),this._halfw=.5*this.viewPort.width,this._halfh=.5*this.viewPort.height,i.x=(e.x-this._halfw)/this._halfw,i.y=(this._halfh-(this.viewPort.height-e.y))/this._halfh,this.unproject(i.x,i.y,e.z,i),this.modelMatrix.transformVector(i,i),i},a.prototype.unproject=function(t,e,i,r){return r.x=t,r.y=-e,r.z=i,r.w=1,r.x*=i,r.y*=i,this._unprojection.copyFrom(this.projectMatrix),this._unprojection.invert(),this._unprojection.transformVector(r,r),r.z=i,r},a.prototype.project=function(t,e){return e=this.projectMatrix.transformVector(t,e),e.x=e.x/e.w,e.y=-e.y/e.w,e.z=t.z,e},a.prototype.onMakeTransform=function(){t.MathUtil.CALCULATION_VECTOR3D.x=1,t.MathUtil.CALCULATION_VECTOR3D.y=1,t.MathUtil.CALCULATION_VECTOR3D.z=1,this._modelMatrix3D.makeTransform(this._globalPos,t.MathUtil.CALCULATION_VECTOR3D,this._globalOrientation)},a}(t.Object3D);t.Camera3D=r}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.minPosX=0,this.minPosY=0,this.maxPosX=0,this.maxPosY=0,this.testID=0,this.points=new Array,this.offsetPosition=new t.Vector3D(0,0,0,0),this.clear()}return e.prototype.setAABox=function(t,i,r,a){this.minPosX=t-r/2-e.TINY,this.maxPosX=t+r/2+e.TINY,this.minPosY=i-a/2-e.TINY,this.maxPosY=i+a/2+e.TINY,this.offsetPosition.setTo(0,0,0)},e.prototype.setOffset=function(t){this.maxPosX+=t.x-this.offsetPosition.x,this.minPosX+=t.x-this.offsetPosition.x,this.minPosY+=t.z-this.offsetPosition.z,this.maxPosY+=t.z-this.offsetPosition.z,this.offsetPosition.copyFrom(t)},e.prototype.setContainRect=function(t,e,i,r){this.minPosX>t&&(this.minPosX=t),this.minPosY>e&&(this.minPosY=e),this.maxPosX<i&&(this.maxPosX=i),this.maxPosY<r&&(this.maxPosY=r)},e.prototype.clear=function(){var t=1e9;this.minPosX=this.minPosY=t,this.maxPosX=this.maxPosY=-t,this.points.length=0,this.testID=0,this.offsetPosition.setTo(0,0,0)},e.prototype.addPoint=function(t){-1==this.points.indexOf(t)&&(t.x<this.minPosX&&(this.minPosX=t.x-e.TINY),t.x>this.maxPosX&&(this.maxPosX=t.x+e.TINY),t.z<this.minPosY&&(this.minPosY=t.z-e.TINY),t.z>this.maxPosY&&(this.maxPosY=t.z+e.TINY),this.points.push(t))},e.prototype.clone=function(){var t=new e;return t.minPosX=this.minPosX,t.minPosY=this.minPosY,t.maxPosX=this.maxPosX,t.maxPosY=this.maxPosY,t},Object.defineProperty(e.prototype,"radius",{get:function(){return Math.sqrt((this.maxPosY-this.minPosY)*(this.maxPosY-this.minPosY)+(this.maxPosX-this.minPosX)*(this.maxPosX-this.minPosX))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sideX",{get:function(){return this.maxPosX-this.minPosX},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sideY",{get:function(){return this.maxPosY-this.minPosY},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"centreX",{get:function(){return.5*(this.maxPosX-this.minPosX)+this.minPosX},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"centreY",{get:function(){return.5*(this.maxPosY-this.minPosY)+this.minPosY},enumerable:!0,configurable:!0}),e.prototype.overlapTest=function(t){return this.minPosY>=t.maxPosY||this.maxPosY<=t.minPosY||this.minPosX>=t.maxPosX||this.maxPosX<=t.minPosX?!1:!0},e.prototype.isPointInside=function(t){return t.x>=this.minPosX&&t.x<=this.maxPosX&&t.z>=this.minPosY&&t.z<=this.maxPosY},e.prototype.isIntersectLineSegment=function(t,e,i,r){var a=!1,n=e-r,o=i-t,s=t*r-i*e,h=(-s-n*this.minPosX)/o;h<=this.maxPosY&&h>=this.minPosY&&(a=!0),h=(-s-n*this.maxPosX)/o,h<=this.maxPosY&&h>=this.minPosY&&(a=!0);var l=(-s-o*this.minPosY)/n;return l<=this.maxPosX&&l>=this.minPosX&&(a=!0),l=(-s-o*this.maxPosY)/n,l<=this.maxPosX&&l>=this.minPosX&&(a=!0),a},e.TINY=1e-6,e}();t.QuadAABB=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.logDeep=0,this._testID=0,this._cells=new Array,this._quadNodes=new Array,this._cellsToTest=new Array,this._aabb=new t.QuadAABB}return e.prototype.getQuadNode=function(t){return this._quadNodes[t]},e.prototype.clear=function(){this._cells.length=0,this._quadNodes.length=0},e.prototype.initNodes=function(t){this.clear();for(var e=0,i=t.length;i>e;)t[e].calcGlobalQuadAABB(),this._quadNodes.push(t[e]),e++},e.prototype.buildQuadTree=function(e,i){this._aabb.clear();for(var r=0,a=this._quadNodes;r<a.length;r++){var n=a[r];if(n.isTriangle)for(var o=0,s=n.aabb.points;o<s.length;o++){var h=s[o];this._aabb.addPoint(h)}else this._aabb.setContainRect(n.aabb.minPosX,n.aabb.minPosY,n.aabb.maxPosX,n.aabb.maxPosY)}this._cells.length=0,this._rootCell=new t.QuadTreeCell(this._aabb),this._cells.push(this._rootCell);for(var l=this._quadNodes.length,u=0;l>u;u++)this._cells[0].nodeIndices[u]=u;var c=new Array;c.push(0);for(var d,p,f;0!=c.length;)if(p=c.pop(),!(this._cells[p].nodeIndices.length<=e||this._cells[p].aabb.radius<i)){for(u=0;u<t.QuadTreeCell.NUM_CHILDREN;u++){this._cells[p].childCellIndices[u]=this._cells.length,c.push(this._cells.length),this._cells.push(new t.QuadTreeCell(this.createAABox(this._cells[p].aabb,u))),f=this._cells[this._cells.length-1],l=this._cells[p].nodeIndices.length;for(var _=0,m=0;l>m;m++)d=this._cells[p].nodeIndices[m],this.doesNodeIntersectCell(this._quadNodes[d],f)&&(_++,f.nodeIndices.push(d))}this._cells[p].nodeIndices.length=0}},e.prototype.createAABox=function(e,i){var r=e.centreX,a=e.centreY,n=e.sideX,o=e.sideY,s=new t.QuadAABB;switch(i){case 0:s.setAABox(r+n/4,a+o/4,n/2,o/2);break;case 1:s.setAABox(r-n/4,a+o/4,n/2,o/2);break;case 2:s.setAABox(r-n/4,a-o/4,n/2,o/2);break;case 3:s.setAABox(r+n/4,a-o/4,n/2,o/2);break;default:s.setAABox(r+n/4,a-o/4,n/2,o/2)}return s},e.prototype.doesNodeIntersectCell=function(t,e){var i=t.aabb;if(!i.overlapTest(e.aabb))return!1;if(!t.isTriangle)return!0;var r=i.points,a=r[0],n=r[1],o=r[2];if(e.aabb.isPointInside(a)||e.aabb.isPointInside(n)||e.aabb.isPointInside(o))return!0;var s=this.pointInTriangle(e.aabb.minPosX,e.aabb.minPosY,a,n,o)||this.pointInTriangle(e.aabb.minPosX,e.aabb.maxPosY,a,n,o)||this.pointInTriangle(e.aabb.maxPosX,e.aabb.maxPosY,a,n,o)||this.pointInTriangle(e.aabb.maxPosX,e.aabb.minPosY,a,n,o);return s?!0:s=e.aabb.isIntersectLineSegment(a.x,a.z,n.x,n.z)||e.aabb.isIntersectLineSegment(a.x,a.z,o.x,o.z)||e.aabb.isIntersectLineSegment(n.x,n.z,o.x,o.z)},e.prototype.getNodesIntersectingtAABox=function(e,i){if(0==this._cells.length)return 0;this._cellsToTest.length=0,this._cellsToTest.push(0),this.incrementTestCounter();for(var r,a,n,o,s=0;0!=this._cellsToTest.length;)if(r=this._cellsToTest.pop(),n=this._cells[r],i.overlapTest(n.aabb))if(n.isLeaf())for(a=n.nodeIndices.length,s=0;a>s;s++)o=this.getQuadNode(n.nodeIndices[s]).aabb,o.testID!=this._testID&&(o.testID=this._testID,i.overlapTest(o)&&e.push(n.nodeIndices[s]));else for(s=0;s<t.QuadTreeCell.NUM_CHILDREN;s++)this._cellsToTest.push(n.childCellIndices[s]);return e.length},e.prototype.pointInTriangle=function(t,e,i,r,a){var n=i,o=r,s=a,h=n.z-o.z,l=o.x-n.x,u=n.x*o.z-o.x*n.z,c=o.z-s.z,d=s.x-o.x,p=o.x*s.z-s.x*o.z,f=s.z-n.z,_=n.x-s.x,m=s.x*n.z-n.x*s.z,g=!1,v=h*t+l*e+u,y=c*t+d*e+p,x=f*t+_*e+m,b=.01;return(v>=-b&&y>=-b&&x>=-b||b>=v&&b>=y&&b>=x)&&(g=!0),g},e.prototype.incrementTestCounter=function(){if(++this._testID,0==this._testID){for(var t=this._quadNodes.length,e=0;t>e;e++)this._quadNodes[e].aabb.testID=0;this._testID=1}},e.prototype.logTree=function(t){if(!(0>t)){this.logDeep++;for(var e=this._cells[t],i="",r=0;r<this.logDeep-1;r++)i+="-|";console.log(i+"i="+t+" "+e.aabb.minPosX.toFixed(2)+" "+e.aabb.maxPosX.toFixed(2)+" "+e.aabb.minPosY.toFixed(2)+" "+e.aabb.maxPosY.toFixed(2));var a;for(a=0;a<e.nodeIndices.length;a++)if(e.nodeIndices[a]>=0){var n=this._quadNodes[e.nodeIndices[a]];console.log(i+" t="+e.nodeIndices[a]+" "+n.aabb.minPosX.toFixed(2)+" "+n.aabb.maxPosX.toFixed(2)+" "+n.aabb.minPosY.toFixed(2)+" "+n.aabb.maxPosY.toFixed(2))}for(a=0;a<e.childCellIndices.length;a++)e.childCellIndices[a]>=0&&this.logTree(e.childCellIndices[a]);this.logDeep--}},e}();t.QuadTree=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e,i){void 0===e&&(e=10),void 0===i&&(i=500),this._maxNodesPerCell=e,this._minCellSize=i,this._segBox=new t.QuadAABB,this._collisionNodesIdx=new Array,this._collisionNodes=new Array}return e.prototype.createQuadTree=function(e){this._quadTree=new t.QuadTree,this._quadTree.initNodes(e),this._quadTree.buildQuadTree(this._maxNodesPerCell,this._minCellSize)},e.prototype.getNodesByAABB=function(t,e,i,r){this._segBox.clear(),this._segBox.maxPosX=i,this._segBox.maxPosY=r,this._segBox.minPosX=t,this._segBox.minPosY=e,this._collisionNodesIdx.length=0,this._collisionNodes.length=0;for(var a,n=(this._quadTree.getNodesIntersectingtAABox(this._collisionNodesIdx,this._segBox),0);n<this._collisionNodesIdx.length;n++)a=this._quadTree.getQuadNode(this._collisionNodesIdx[n]),this._collisionNodes.push(a);return this._collisionNodes},e.prototype.getTriangleAtPoint=function(e,i){void 0===i&&(i=5),this._segBox.clear(),this._segBox.setAABox(e.x,e.z,1,1),this._collisionNodesIdx.length=0,this._collisionNodes.length=0;for(var r,a,n,o,s=(this._quadTree.getNodesIntersectingtAABox(this._collisionNodesIdx,this._segBox),4294967295),h=0,l=0;l<this._collisionNodesIdx.length;l++)a=this._quadTree.getQuadNode(this._collisionNodesIdx[l]),o=a.aabb,t.Navi3DTriangle.pointInsideTriangle(e,o.points[0],o.points[1],o.points[2])&&(n=a,h=Math.abs(n.plane.distance(e)),h>i||(null==a||s>=h)&&(r=n,s=h));return r},e}();t.QuadRoot=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(i){this.childCellIndices=new Array,this.childCellIndices.length=e.NUM_CHILDREN,this.nodeIndices=new Array,this.clear(),this.aabb=i?i.clone():new t.QuadAABB}return e.prototype.isLeaf=function(){return-1==this.childCellIndices[0]},e.prototype.clear=function(){for(var t=0;t<e.NUM_CHILDREN;t++)this.childCellIndices[t]=-1;this.nodeIndices.splice(0,this.nodeIndices.length)},e.NUM_CHILDREN=4,e}();t.QuadTreeCell=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){this._keys=new Array,this._values=new Array}return t.prototype.getIndexByKey=function(t){return this._keys.indexOf(t)},t.prototype.getValueByKey=function(t){var e=this.getIndexByKey(t);return e>-1?this._values[e]:null},t.prototype.put=function(t,e){if(null==t)return null;var i=this.remove(t);return this._keys.push(t),this._values.push(e),i},t.prototype.remove=function(t){var e,i=this._keys.indexOf(t);return i>-1&&(e=this._values[i],this._keys.splice(i,1),this._values.splice(i,1)),e},t.prototype.getValues=function(){return this._values},t.prototype.getKeys=function(){return this._keys},t.prototype.clear=function(){this._values.length=0,this._keys.length=0},t}();t.DoubleArray=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this._findIndex=0,this._openedList=new Array,this._closedList=new Array}return e.prototype.findPath=function(t,e,i){return this._findIndex++,this._navMesh=t,this._startNode=e,this._endNode=i,this._openedList.length=0,this._closedList.length=0,this._startNode&&this._endNode?(this._startNode.g=0,this._startNode.h=0,this._startNode.f=0,this._startNode.parent=null,this.search()):!1},e.prototype.search=function(){for(var e,i=this._startNode,r=new Array;i!=this._endNode;){r=i.getNeibourTriangles(r,t.Navi3DMaskType.WalkAble,t.Navi3DMaskType.WalkAble);for(var a=0,n=r;a<n.length;a++)if(e=n[a],e.closeId!=this._findIndex&&e!=i&&e.walkAble){var o=i.g+t.Navi3DPoint.calcDistance(e,i)*e.costMultiplier,s=t.Navi3DPoint.calcDistance(e,this._endNode),h=o+s;e.openId==this._findIndex?e.f>h&&(e.f=h,e.g=o,e.h=s,e.parent=i):(e.f=h,e.g=o,e.h=s,e.parent=i,e.openId=this._findIndex,this._openedList.push(e))}if(i.closeId=this._findIndex,this._closedList.push(i),0==this._openedList.length)return!1;this._openedList.sort(function(t,e){return t.f-e.f}),i=this._openedList.shift()}return this.buildPath(),!0},e.prototype.buildPath=function(){this._triangleChannel=[];var t=this._endNode;for(this._triangleChannel.push(t);t!=this._startNode;)t=t.parent,this._triangleChannel.unshift(t)},Object.defineProperty(e.prototype,"channel",{get:function(){return this._triangleChannel},enumerable:!0,configurable:!0}),e}();t.Navi3DAstar=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e,i){if(this._edgeMask=0,this._edgeSize=0,this._pointA=e,this._pointB=i,e.id>=i.id)throw new Error("edge point order error!!!");this._triangleOwners=new Array,this._centerPoint=new t.Vector3D,this._edgeMask=t.Navi3DMaskType.WalkAble,t.Navi3DPoint.CALC_VECTOR3D1.setTo(e.x-i.x,e.y-i.y,e.z-i.z),this._edgeSize=t.Navi3DPoint.CALC_VECTOR3D1.length,this._centerPoint.setTo((e.x+i.x)/2,(e.y+i.y)/2,(e.z+i.z)/2)}return Object.defineProperty(e.prototype,"size",{get:function(){return this._edgeSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"triangleOwners",{get:function(){return this._triangleOwners},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"centerPoint",{get:function(){return this._centerPoint},enumerable:!0,configurable:!0}),e.prototype.initFatPoints=function(i){this._edgeDirA2B=this._pointB.subtract(this._pointA),this._edgeDirA2B.normalize(),this.fatPointA=this.fatPointA||new t.Navi3DPointFat(this._pointA,this),this.fatPointB=this.fatPointB||new t.Navi3DPointFat(this._pointB,this),this.fatPointA.radius!=i&&(e.CALC_FAT_VECTOR.copyFrom(this._edgeDirA2B),e.CALC_FAT_VECTOR.scaleBy(i),e.CALC_FAT_VECTOR.incrementBy(this._pointA),this.fatPointA.copyFrom(e.CALC_FAT_VECTOR),this.fatPointA.radius=i),this.fatPointB.radius!=i&&(e.CALC_FAT_VECTOR.copyFrom(this._edgeDirA2B),e.CALC_FAT_VECTOR.scaleBy(-i),e.CALC_FAT_VECTOR.incrementBy(this._pointB),this.fatPointB.copyFrom(e.CALC_FAT_VECTOR),this.fatPointB.radius=i)},e.prototype.getFatPoint=function(t){return t==this._pointA?this.fatPointA:this.fatPointB},e.prototype.getAnotherFatPoint=function(t){return t==this._pointA?this.fatPointB:this.fatPointA},e.prototype.getAnotherPoint=function(t){return t==this._pointA?this._pointB:this._pointA},e.prototype.containsPoint=function(e){return t.Navi3DPoint.equalPoint(e,this._pointA)?this._pointA:t.Navi3DPoint.equalPoint(e,this._pointB)?this._pointB:null},e.prototype.addTriangleOwners=function(t){if(-1==t.edges.indexOf(this))throw new Error("the edge is not belong triangle!!!");-1==this._triangleOwners.indexOf(t)&&this._triangleOwners.push(t)},e.prototype.getPublicPoint=function(t){return this._pointA==t._pointA||this._pointA==t._pointB?this._pointA:this._pointB==t._pointA||this._pointB==t._pointB?this._pointB:null},e.prototype.getEqualPoint=function(e){return t.Navi3DPoint.equalPoint(e,this._pointA)?this._pointA:t.Navi3DPoint.equalPoint(e,this._pointB)?this._pointB:null},Object.defineProperty(e.prototype,"pointA",{get:function(){return this._pointA},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pointB",{get:function(){return this._pointB},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"walkAble",{get:function(){return(this._edgeMask&t.Navi3DMaskType.WalkAble)==t.Navi3DMaskType.WalkAble},enumerable:!0,configurable:!0}),e.prototype.testMask=function(t){return(this._edgeMask&t)==t},e.CALC_FAT_VECTOR=new t.Vector3D,e}();t.Navi3DEdge=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){}return t.WalkAble=1,t}();t.Navi3DMaskType=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){}return t.prototype.setTo=function(t,e){this.x=t,this.y=e},t.prototype.equals=function(t,e){return t==this.x&&e==this.y},t.prototype.equalPoint=function(t){return this.equals(t.x,t.y)},Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},enumerable:!0,configurable:!0}),t.prototype.clone=function(){var e=new t;return e.setTo(this.x,this.y),e},t.prototype.normalize=function(){var t=length;0!=t&&this.setTo(this.x/t,this.y/t)},t}();t.Navi3DPoint2D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(t,i,r,a){e.call(this,i,r,a,0),this._pointId=0,this._pointId=t}return __extends(i,e),Object.defineProperty(i.prototype,"id",{get:function(){return this._pointId},enumerable:!0,configurable:!0}),i.equalPoint=function(e,i){return(e.x-i.x)*(e.x-i.x)+(e.y-i.y)*(e.y-i.y)+(e.z-i.z)*(e.z-i.z)<t.Navi3DFunnel.POWER_EPSILON},i.calcDistance=function(t,e){return i.CALC_VECTOR3D3.setTo(t.x-e.x,t.y-e.y,t.z-e.z),i.CALC_VECTOR3D3.length
},i.CALC_VECTOR3D1=new t.Vector3D,i.CALC_VECTOR3D2=new t.Vector3D,i.CALC_VECTOR3D3=new t.Vector3D,i.CALC_VECTOR3D4=new t.Vector3D,i.CALC_VECTOR3D5=new t.Vector3D,i}(t.Vector3D);t.Navi3DPoint=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(t){function e(e,i){t.call(this,e.id,0,0,0),this.radius=0,this._ownerEdge=i,this._ownerPoint=e}return __extends(e,t),Object.defineProperty(e.prototype,"ownerPoint",{get:function(){return this._ownerPoint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ownerEdge",{get:function(){return this._ownerEdge},enumerable:!0,configurable:!0}),e.prototype.scalePoint=function(t){void 0===t&&(t=.7);var i=new e(this._ownerPoint,this._ownerEdge);return i.copyFrom(this),i.decrementBy(this._ownerPoint),i.scaleBy(t),i.radius=i.length,i.incrementBy(this._ownerPoint),i},e}(t.Navi3DPoint);t.Navi3DPointFat=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r,a,n){e.call(this,0,0,0,0),this._id=0,this._points=new Array,this._edges=new Array,this._neibourTriangles=new t.DoubleArray,this._pointAgainstEdge=new t.DoubleArray,this._edgeAgainstPoint=new t.DoubleArray,this._mask=0,this.f=0,this.g=0,this.h=0,this.costMultiplier=1,this.openId=0,this.closeId=0,this._id=i,this._mask=t.Navi3DMaskType.WalkAble,this._edges.push(r,a,n);for(var o,s=0,h=this._edges;s<h.length;s++)o=h[s],-1==this._points.indexOf(o.pointA)&&this._points.push(o.pointA),-1==this._points.indexOf(o.pointB)&&this._points.push(o.pointB);this.x=(this._points[0].x+this._points[1].x+this._points[2].x)/3,this.y=(this._points[0].y+this._points[1].y+this._points[2].y)/3,this.z=(this._points[0].z+this._points[1].z+this._points[2].z)/3,this._plane=new t.Plane3D,this._plane.fromPoints(this._points[0],this._points[1],this._points[2]),this._plane.normalize(),this.genarateAgainstData(),this.initAABB()}return __extends(i,e),Object.defineProperty(i.prototype,"aabb",{get:function(){return this._aabbBox},enumerable:!0,configurable:!0}),i.prototype.initAABB=function(){this._aabbBox=new t.QuadAABB,this._aabbBox.addPoint(this._points[0]),this._aabbBox.addPoint(this._points[1]),this._aabbBox.addPoint(this._points[2])},i.prototype.calcGlobalQuadAABB=function(){},Object.defineProperty(i.prototype,"isTriangle",{get:function(){return!0},enumerable:!0,configurable:!0}),i.prototype.genarateAgainstData=function(){for(var t,e,i=0,r=this._edges;i<r.length;i++){t=r[i];for(var a=0,n=this._points;a<n.length;a++)e=n[a],t.pointA!=e&&t.pointB!=e&&(this._edgeAgainstPoint.put(t,e),this._pointAgainstEdge.put(e,t))}},Object.defineProperty(i.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"plane",{get:function(){return this._plane},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"points",{get:function(){return this._points},enumerable:!0,configurable:!0}),i.prototype.addNeibour=function(t,e){if(!(this._edges.indexOf(t)>=0))throw new Error("the edge is not in triangle!!!");this._neibourTriangles.put(t,e)},i.prototype.getNeibourTriangles=function(t,e,i){void 0===t&&(t=null),void 0===e&&(e=1),void 0===i&&(i=1),t=t||new Array,t.length=0;for(var r,a,n,o=this._neibourTriangles.getKeys(),s=0,h=o;s<h.length;s++)n=h[s],a=n,a.testMask(e)&&(r=this._neibourTriangles.getValueByKey(a),r.testMask(i)&&t.push(r));return t},i.prototype.getEdges=function(t,e){void 0===t&&(t=null),void 0===e&&(e=1),t=t||new Array,t.length=0;for(var i,r=0,a=this._edges;r<a.length;r++)i=a[r],i.testMask(e)&&t.push(i);return t},Object.defineProperty(i.prototype,"walkAble",{get:function(){return this.testMask(t.Navi3DMaskType.WalkAble)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"edges",{get:function(){return this._edges},enumerable:!0,configurable:!0}),i.prototype.testMask=function(t){return(this._mask&t)==t},i.prototype.getEdgeAgainstPoint=function(t){return this._edgeAgainstPoint.getValueByKey(t)},i.prototype.getPointAgainstEdge=function(t){return this._pointAgainstEdge.getValueByKey(t)},i.prototype.getPublicEdge=function(t){if(t&&t!=this)for(var e,i=this._neibourTriangles.getKeys(),r=0,a=i;r<a.length;r++)if(e=a[r],this._neibourTriangles.getValueByKey(e)==t)return e;return null},i.prototype.loopPublicEdge=function(t){var e,i;if(t&&t!=this)for(var r=0,a=this._edges;r<a.length;r++){e=a[r];for(var n=0,o=t._edges;n<o.length;n++)if(i=o[n],e==i)return e}return null},i.prototype.randomPoint=function(){var t=this._points[2].subtract(this._points[0]);t.scaleBy(Math.random()),t.incrementBy(this._points[0]);var e=this._points[1].subtract(t);return e.scaleBy(Math.random()),e.incrementBy(t),e},i.pointInsideTriangle=function(t,e,r,a){return i.pp.setTo(t.x,t.z),i.p1.setTo(e.x,e.z),i.p2.setTo(r.x,r.z),i.p3.setTo(a.x,a.z),i.pointInsideTriangle2d()},i.pointInsideTriangle2d=function(){return i.product2d(i.p1,i.p2,i.p3)>=0?i.product2d(i.p1,i.p2,i.pp)>=0&&i.product2d(i.p2,i.p3,i.pp)>=0&&i.product2d(i.p3,i.p1,i.pp)>=0:i.product2d(i.p1,i.p2,i.pp)<=0&&i.product2d(i.p2,i.p3,i.pp)<=0&&i.product2d(i.p3,i.p1,i.pp)<=0},i.product2d=function(t,e,i){var r=(t.x-i.x)*(e.y-i.y)-(t.y-i.y)*(e.x-i.x);return r>-1e-5&&1e-5>r&&(r=0),r},i.p1=new t.Navi3DPoint2D,i.p2=new t.Navi3DPoint2D,i.p3=new t.Navi3DPoint2D,i.pp=new t.Navi3DPoint2D,i}(t.Vector3D);t.Navi3DTriangle=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e,i){this._nav3dPoints=new Array,this._nav3dEdges=new Array,this._nav3dTriangles=new Array,this._edgesDict=new t.DoubleArray,this.initPoints(e),this.initEdgesAndTriangles(i),this.createConnections(),this._nav3dAstar=new t.Navi3DAstar,this._nav3dFunnel=new t.Navi3DFunnel,this._terrainQuad=new t.QuadRoot(8,128),this._terrainQuad.createQuadTree(this._nav3dTriangles)}return Object.defineProperty(e.prototype,"edges",{get:function(){return this._nav3dEdges},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"points",{get:function(){return this._nav3dPoints},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._path},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"triangles",{get:function(){return this._nav3dTriangles},enumerable:!0,configurable:!0}),e.prototype.getTriangleAtPoint=function(t,e){return void 0===e&&(e=5),this._terrainQuad.getTriangleAtPoint(t,e)},e.prototype.findPath=function(t,e,i){void 0===i&&(i=5),this._path=null,this._triangleList=null;var r=this.getTriangleAtPoint(t,10),a=this.getTriangleAtPoint(e,10),n=this._nav3dAstar.findPath(this,r,a);return n?(this._triangleList=this._nav3dAstar.channel,n=this._nav3dFunnel.searchPath(this,t,e,this._triangleList,i),this._path=this._nav3dFunnel.path,n):!1},e.prototype.initPoints=function(e){for(var i,r,a=e.length,n=0;a>n;n++)i=e[n],r=new t.Navi3DPoint(n,i.x,i.y,i.z),this._nav3dPoints.push(r)},e.prototype.initEdgesAndTriangles=function(e){for(var i,r,a,n,o,s=e.length,h=0;s>h;h++)i=e[h],r=this.tryCreateEdge(i[0],i[1]),a=this.tryCreateEdge(i[1],i[2]),n=this.tryCreateEdge(i[2],i[0]),null!=r&&null!=a&&null!=n&&(o=new t.Navi3DTriangle(h,r,a,n),this._nav3dTriangles.push(o))},e.prototype.tryCreateEdge=function(e,i){if(e==i)throw new Error("edge point index error!!!");if(e>i){var r=e;e=i,i=r}var a=this._edgesDict.getValueByKey(e+"_"+i);return null==a&&(a=new t.Navi3DEdge(this._nav3dPoints[e],this._nav3dPoints[i]),this._nav3dEdges.push(a),this._edgesDict.put(e+"_"+i,a)),a},e.prototype.createConnections=function(){for(var t,e,i,r,a=this._nav3dTriangles.length,n=this._nav3dTriangles.length,o=0;a>o;o++){t=this._nav3dTriangles[o];for(var s=0,h=t.edges;s<h.length;s++)i=h[s],i.addTriangleOwners(t);for(var l=0;n>l;l++)e=this._nav3dTriangles[l],t!=e&&(r=t.loopPublicEdge(e),r&&(t.addNeibour(r,e),e.addNeibour(r,t)))}},e}();t.Navi3DMesh=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this._aiRadius=0,this._tempPublicEdgeList=new Array,this._tempSamePlaneList=new Array,this._router=new t.Navi3DRouter}return e.prototype.searchPath=function(t,e,i,r,a){return void 0===a&&(a=0),0>=a&&(a=1),this._aiRadius=1.5*a,this._navMesh=t,this.searchEnable(e,i,r)?(this.search(e,i,r),!0):!1},Object.defineProperty(e.prototype,"path",{get:function(){return this._result},enumerable:!0,configurable:!0}),e.prototype.searchEnable=function(i,r,a){return null==i||null==r||null==this._navMesh||null==a?!1:a[0].plane.classifyPoint(i,e.EPSILON)!=t.PlaneClassification.INTERSECT?!1:a[a.length-1].plane.classifyPoint(r,e.EPSILON)!=t.PlaneClassification.INTERSECT?!1:!0},e.prototype.search=function(i,r,a){this._tempPublicEdgeList.length=0,this._tempSamePlaneList.length=0;var n,o,s,h,l=0,u=a.length-1;for(l=0;u>l;l++)o=a[l].getPublicEdge(a[l+1]),o.crossPoint=null,o.initFatPoints(this._aiRadius),this._tempPublicEdgeList.push(o),n=a[l],h=n.plane,n=a[l+1],s=n.getEdgeAgainstPoint(o),this._tempSamePlaneList.push(h.classifyPoint(s,e.EPSILON)==t.PlaneClassification.INTERSECT);this._router.continuePass(i,r,this._tempPublicEdgeList[0]),u=this._tempPublicEdgeList.length;var c,d,p,f;for(l=0;u>l;l++)o=this._tempPublicEdgeList[l],n=a[l+1],f=l==u-1,s=f?r:n.getEdgeAgainstPoint(o),p=this._router.passEdge(o,this._tempPublicEdgeList[l+1],s,f),p||(c=this._router.cornerPoint,d=this._router.cornerEdge,l=this._tempPublicEdgeList.indexOf(d),this._router.continuePass(c,r,this._tempPublicEdgeList[l+1]));this.pushAllPathPoint2(i,r),this._result.length>=3&&(this.optimusTerminusFat(),this.optimusByRadius())},e.prototype.optimusTerminusFat=function(){var e,i,r;r=this._result[1],r instanceof t.Navi3DPointFat&&(e=r),r=this._result[this._result.length-2],r instanceof t.Navi3DPointFat&&(i=r),e&&(this._result[1]=e.scalePoint()),i&&e!=i&&(this._result[this._result.length-2]=i.scalePoint())},e.prototype.pushAllPathPoint2=function(t,i){var r,a,n=this._tempPublicEdgeList.length;this._result=new Array,this._result.push(t);for(var o,s,h,l=t,u=0;n>u;u++)if(r=this._tempPublicEdgeList[u],s=null,r.crossPoint)s=this.getFatPoint(r,r.crossPoint),this._result.push(s?s:r.crossPoint),l=r.crossPoint;else{a=null,o=null;for(var c=u+1;n>c&&(a=this._tempPublicEdgeList[c],!(o=a.crossPoint));c++);null==o&&(o=i),s=this.getFatPoint(r,o),s?this._result.push(s):(e.CROSS_TEST_DIRECTION.setTo(o.x-l.x,0,o.z-l.z),h=this._router.calcCrossEdge(r,l,e.CROSS_TEST_DIRECTION),this._result.push(h))}this._result.push(i)},e.prototype.optimusByRadius=function(){var i=new Array;i.length=this._result.length;var r,a,n,o,s,h,l,u,c,d,p,f,_,m=this._result.length-2;for(_=0;m>_;_++)l=u=c=null,o=s=h=null,p=!1,f=null,r=this._result[_],a=this._result[_+1],n=this._result[_+2],r instanceof t.Navi3DPointFat&&(o=r),a instanceof t.Navi3DPointFat&&(s=a),n instanceof t.Navi3DPointFat&&(h=n),o&&(l=o.ownerPoint),s&&(u=s.ownerPoint),h&&(c=h.ownerPoint),l&&u&&l==u&&u!=c&&(p=!0),c&&u&&c==u&&l!=u&&(p=!0),p&&(e.CROSS_TEST_DIRECTION.copyFrom(r),e.CROSS_TEST_DIRECTION.decrementBy(n),d=s.ownerEdge,p=this._router.hasCrossPoint(d.pointA,d.pointB,n,e.CROSS_TEST_DIRECTION),p&&(f=this._router.calcCrossPointOut(u,a,n,e.CROSS_TEST_DIRECTION)),f&&(i[_+1]=f))},e.prototype.getFatPoint=function(e,i){if(null==e)return null;var r;i instanceof t.Navi3DPointFat&&(r=i);var a;return a=r?r.ownerPoint:e.getEqualPoint(i),null==a?null:r=e.getFatPoint(a)},e.EPSILON=5,e.POWER_EPSILON=e.EPSILON*e.EPSILON,e.CROSS_TEST_DIRECTION=new t.Vector3D,e}();t.Navi3DFunnel=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.prototype.continuePass=function(t,e,i){this.resetData(),this.curPoint=t,this.endPoint=e,this.cornerEdge=i},e.prototype.passEdge=function(i,r,a,n){if((null==this.rayA||null==this.rayB)&&(this.rayA=e.RAY_1,this.rayB=e.RAY_2,this.rayAPoint=i.pointA,this.rayBPoint=i.pointB,this.rayA.setTo(this.rayAPoint.x-this.curPoint.x,0,this.rayAPoint.z-this.curPoint.z),this.rayB.setTo(this.rayBPoint.x-this.curPoint.x,0,this.rayBPoint.z-this.curPoint.z)),n)return this.checkEndPoint(a);if(e.TEST_RAY.setTo(a.x-this.curPoint.x,0,a.z-this.curPoint.z),this.isPointAtCenter(e.TEST_RAY,this.rayA,this.rayB)){this.hasCrossPoint(r.pointA,r.pointB,this.rayAPoint,this.rayA)?(this.rayB.copyFrom(e.TEST_RAY),this.rayBPoint=a instanceof t.Navi3DPoint?a:null):(this.rayA.copyFrom(e.TEST_RAY),this.rayAPoint=a instanceof t.Navi3DPoint?a:null);var o=r.getAnotherPoint(a);e.TEST_RAY.setTo(o.x-this.curPoint.x,0,o.z-this.curPoint.z),(o==this.rayAPoint||o==this.rayBPoint||this.isPointAtCenter(e.TEST_RAY,this.rayA,this.rayB))&&(this.cornerEdge=r)}else{var s;if(e.TEST_RAY_1.copyFrom(r.pointA),e.TEST_RAY_1.decrementBy(this.curPoint),e.TEST_RAY_2.copyFrom(r.pointB),e.TEST_RAY_2.decrementBy(this.curPoint),e.TEST_RAY_1.y=0,e.TEST_RAY_2.y=0,s=this.isPointAtCenter(this.rayA,e.TEST_RAY_1,e.TEST_RAY_2)||this.isPointAtCenter(this.rayB,e.TEST_RAY_1,e.TEST_RAY_2)?!1:!0)return this.cornerPoint=this.isPointAtCenter(this.rayA,e.TEST_RAY,this.rayB)?this.rayAPoint:this.rayBPoint,this.cornerEdge.crossPoint=this.cornerPoint,!1}return!0},e.prototype.checkEndPoint=function(t){return e.TEST_RAY.setTo(t.x-this.curPoint.x,0,t.z-this.curPoint.z),this.isPointAtCenter(e.TEST_RAY,this.rayA,this.rayB)?!0:(this.cornerPoint=this.isPointAtCenter(this.rayA,e.TEST_RAY,this.rayB)?this.rayAPoint:this.rayBPoint,this.cornerEdge.crossPoint=this.cornerPoint,!1)},e.prototype.calcCrossEdge=function(t,e,i){return this.calcCrossPoint(t.fatPointA,t.fatPointB,e,i)},e.prototype.calcCrossPoint=function(t,i,r,a){e.CALC_CROSS_POINT.copyFrom(i),e.CALC_CROSS_POINT.decrementBy(t);var n=((t.z-r.z)*a.x-(t.x-r.x)*a.z)/(e.CALC_CROSS_POINT.x*a.z-a.x*e.CALC_CROSS_POINT.z);return n>1?n=1:0>n&&(n=0),e.CALC_CROSS_POINT.scaleBy(n),e.CALC_CROSS_POINT.incrementBy(t),e.CALC_CROSS_POINT.clone()},e.prototype.calcCrossPointOut=function(t,i,r,a){e.CALC_CROSS_POINT.copyFrom(i),e.CALC_CROSS_POINT.decrementBy(t);var n=((t.z-r.z)*a.x-(t.x-r.x)*a.z)/(e.CALC_CROSS_POINT.x*a.z-a.x*e.CALC_CROSS_POINT.z);return 1>=n&&n>=0?null:(e.CALC_CROSS_POINT.scaleBy(n),e.CALC_CROSS_POINT.incrementBy(t),e.CALC_CROSS_POINT.clone())},e.prototype.hasCrossPoint=function(t,i,r,a){e.CALC_CROSS_TEST.copyFrom(i),e.CALC_CROSS_TEST.decrementBy(t);var n=((t.z-r.z)*a.x-(t.x-r.x)*a.z)/(e.CALC_CROSS_TEST.x*a.z-a.x*e.CALC_CROSS_TEST.z);return 1>=n&&n>=0},e.prototype.isPointAtCenter=function(t,e,i){var r=e.crossProduct(t);if(0==r.length&&t.length<e.length)return!0;var a=i.crossProduct(t);return 0==a.length&&t.length<i.length?!0:(r.normalize(),a.normalize(),r.incrementBy(a),r.length<.01)},e.prototype.resetData=function(){this.cornerEdge=null,this.cornerPoint=null,this.curPoint=null,this.rayA=this.rayB=null,this.rayAPoint=this.rayBPoint=null,e.RAY_1.setTo(0,0,0),e.RAY_2.setTo(0,0,0)},e.RAY_1=new t.Vector3D,e.RAY_2=new t.Vector3D,e.TEST_RAY=new t.Vector3D,e.TEST_RAY_1=new t.Vector3D,e.TEST_RAY_2=new t.Vector3D,e.CALC_CROSS_POINT=new t.Vector3D,e.CALC_CROSS_TEST=new t.Vector3D,e}();t.Navi3DRouter=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e,i,r,a){void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=100),void 0===a&&(a=100),this._rectangle=new t.Rectangle,this._transformMatrix=new t.Matrix4_4,this._change=!1,this._rotation=new t.Vector3D,this._scale=new t.Vector3D(1,1,1),this._position=new t.Vector3D,this._transformComponents=[],this._changeTexture=!1,this._textureStage=!1,this._vertexFormat=t.VertexFormat.VF_POSITION|t.VertexFormat.VF_UV0,this._uv_scale=new Float32Array(2),this.name="",this.bothside=!1,this.cullMode=t.ContextConfig.BACK,this.visible=!0,this.vsShader="hud_vs",this.fsShader="hud_V_fs",this._passUsage=new t.PassUsage,this._attList=new Array,this._transformComponents.push(this._position),this._transformComponents.push(this._rotation),this._transformComponents.push(this._scale),this.x=e,this.y=i,this.width=r,this.height=a,this._uv_scale[0]=1,this._uv_scale[1]=1}return Object.defineProperty(e.prototype,"diffuseTexture",{get:function(){return this._diffuseTexture},set:function(t){this._changeTexture=!0,this._diffuseTexture=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._rectangle.x},set:function(t){this._change=!0,this._rectangle.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._rectangle.y},set:function(t){this._change=!0,this._rectangle.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._rectangle.width},set:function(t){this._change=!0,this._rectangle.width=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._rectangle.height},set:function(t){this._change=!0,this._rectangle.height=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationX",{get:function(){return this._rotation.x},set:function(t){this._change=!0,this._rotation.x!=t&&(this._rotation.x=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationY",{get:function(){return this._rotation.y},set:function(t){this._change=!0,this._rotation.y!=t&&(this._rotation.y=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationZ",{get:function(){return this._rotation.z},set:function(t){this._change=!0,this._rotation.z!=t&&(this._rotation.z=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewPort",{set:function(t){this._viewPort=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uScale",{get:function(){return this._uv_scale[0]},set:function(t){this._uv_scale[0]=t,this._uv_scale[0]>1&&(this._uv_scale[0]=1),this._uv_scale[0]<0&&(this._uv_scale[0]=0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vScale",{get:function(){return this._uv_scale[1]},set:function(t){this._uv_scale[1]=t,this._uv_scale[1]>1&&(this._uv_scale[1]=1),this._uv_scale[1]<0&&(this._uv_scale[1]=0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transformMatrix",{get:function(){return this._viewPort?(this._change&&(this._scale.x=this._rectangle.width/this._viewPort.width,this._scale.y=this._rectangle.height/this._viewPort.height,this._position.x=t.MathUtil.ScreenToPosition(this._rectangle.x,this._rectangle.width,this._viewPort.width),this._position.y=-t.MathUtil.ScreenToPosition(this._rectangle.y,this._rectangle.height,this._viewPort.height),this._transformMatrix.recompose(this._transformComponents),this._change=!1),this._transformMatrix):this._transformMatrix},enumerable:!0,configurable:!0}),e.prototype.updateTexture=function(t){var e;for(var i in this._passUsage.sampler2DList)e=this._passUsage.sampler2DList[i],e.uniformIndex=t.getUniformLocation(this._passUsage.program3D,e.varName),e.texture=this[e.varName];this._changeTexture=!1},e.prototype.upload=function(i){this._vertexBuffer3D||(this._vertexBuffer3D=i.creatVertexBuffer(e.singleQuadData)),this._indexBuffer3D||(this._indexBuffer3D=i.creatIndexBuffer(e.singleQuadIndex)),this._passUsage.vertexShader.shaderType=t.Shader.vertex,this._passUsage.fragmentShader.shaderType=t.Shader.fragment,this._passUsage.vertexShader.addUseShaderName(this.vsShader),this._passUsage.fragmentShader.addUseShaderName(this.fsShader),this._passUsage.vertexShader.shader=this._passUsage.vertexShader.getShader(this._passUsage),this._passUsage.fragmentShader.shader=this._passUsage.fragmentShader.getShader(this._passUsage),this._passUsage.program3D=t.ShaderPool.getProgram(this._passUsage.vertexShader.shader.id,this._passUsage.fragmentShader.shader.id);for(var r in this._passUsage)-1!=r.indexOf("uniform")&&this._passUsage[r]&&(this._passUsage[r].uniformIndex=i.getUniformLocation(this._passUsage.program3D,r));this._attList.length=0;var a=0;this._passUsage.attribute_position&&(this._passUsage.attribute_position.uniformIndex||(this._passUsage.attribute_position.uniformIndex=i.getShaderAttribLocation(this._passUsage.program3D,this._passUsage.attribute_position.varName)),this._attList.push(this._passUsage.attribute_position),this._passUsage.attribute_position.size=t.Geometry.positionSize,this._passUsage.attribute_position.dataType=t.ContextConfig.FLOAT,this._passUsage.attribute_position.normalized=!1,this._passUsage.attribute_position.stride=e.vertexBytes,this._passUsage.attribute_position.offset=a,a+=t.Geometry.positionSize*Float32Array.BYTES_PER_ELEMENT),this._passUsage.attribute_uv0&&(this._passUsage.attribute_uv0.uniformIndex||(this._passUsage.attribute_uv0.uniformIndex=i.getShaderAttribLocation(this._passUsage.program3D,this._passUsage.attribute_uv0.varName)),this._attList.push(this._passUsage.attribute_uv0),this._passUsage.attribute_uv0.size=t.Geometry.uvSize,this._passUsage.attribute_uv0.dataType=t.ContextConfig.FLOAT,this._passUsage.attribute_uv0.normalized=!1,this._passUsage.attribute_uv0.stride=e.vertexBytes,this._passUsage.attribute_uv0.offset=a,a+=t.Geometry.uvSize*Float32Array.BYTES_PER_ELEMENT),this._passUsage.uv_scale=i.getUniformLocation(this._passUsage.program3D,"uv_scale")},e.prototype.draw=function(e,i){if(void 0===i&&(i=null),this.visible){this._passUsage.program3D||this.upload(e),e.setProgram(this._passUsage.program3D),e.bindVertexBuffer(this._vertexBuffer3D),e.bindIndexBuffer(this._indexBuffer3D);for(var r=0;8>r;r++)t.Context3DProxy.gl.disableVertexAttribArray(r);for(var r=0;r<this._attList.length;++r){var a=this._attList[r];a.uniformIndex>=0&&e.vertexAttribPointer(a.uniformIndex,a.size,a.dataType,a.normalized,a.stride,a.offset)}this._changeTexture&&this.updateTexture(e);var n;for(var o in this._passUsage.sampler2DList)n=this._passUsage.sampler2DList[o],n.texture&&(n.texture.upload(e),e.setTexture2DAt(n.activeTextureIndex,n.uniformIndex,n.index,n.texture.texture2D),this._textureStage&&(n.texture.activeState(e),this._textureStage=!1));this._passUsage.uniform_ViewProjectionMatrix&&e.uniformMatrix4fv(this._passUsage.uniform_ViewProjectionMatrix.uniformIndex,!1,this.transformMatrix.rawData),this._passUsage.uniform_ViewMatrix&&i&&e.uniformMatrix4fv(this._passUsage.uniform_ViewMatrix.uniformIndex,!1,i.viewMatrix.rawData),this._passUsage.uniform_ProjectionMatrix&&i&&e.uniformMatrix4fv(this._passUsage.uniform_ProjectionMatrix.uniformIndex,!1,i.projectMatrix.rawData),this._passUsage.uv_scale&&-1!=this._passUsage.uv_scale&&e.uniform2f(this._passUsage.uv_scale,this._uv_scale[0],this._uv_scale[1]),e.setCulling(this.cullMode),this.bothside?e.disableCullFace():e.enableCullFace(),e.enableBlend(),e.setBlendFactors(t.ContextConfig.SRC_ALPHA,t.ContextConfig.ONE_MINUS_SRC_ALPHA),e.drawElement(t.DrawMode.TRIANGLES,0,6),e.clear(t.ContextConfig.DEPTH_BUFFER_BIT)}},e.singleQuadData=new Float32Array([-1,-1,0,0,1,1,-1,0,1,1,1,1,0,1,0,-1,1,0,0,0]),e.singleQuadIndex=new Uint16Array([0,1,2,0,2,3]),e.vertexBytes=20,e}();t.HUD=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e,i,r,a,n){void 0===n&&(n=null),this._viewPort=new t.Rectangle,this._scene=new t.Scene3D,this._scissorRect=new t.Rectangle,this._viewMatrix=new t.Matrix4_4,this._backColor=new t.Vector3D(.3,.3,.6,1),this._cleanParmerts=t.Context3DProxy.gl.COLOR_BUFFER_BIT|t.Context3DProxy.gl.DEPTH_BUFFER_BIT,this._sizeDiry=!1,this._huds=new Array,this._postList=[],this.a=0,this._entityCollect=new t.EntityCollect,this._entityCollect.root=this._scene,this._render=new t.MultiRender(t.PassType.diffusePass),this._camera=n||new t.Camera3D(t.CameraType.perspective),this._camera.name="MainCamera",this._scene.addChild3D(this._camera),this.x=e,this.y=i,this.width=r,this.height=a,this._camera.aspectRatio=this._viewPort.width/this._viewPort.height,this._camera.updateViewport(this._viewPort.x,this._viewPort.y,this._viewPort.width,this._viewPort.height)}return Object.defineProperty(e.prototype,"render",{get:function(){return this._render},set:function(t){this._render=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"quadStage",{get:function(){return this._quadStage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"post",{set:function(e){this._postList=e,e.length>0&&(this._postProcessing=this._postProcessing||new t.PostProcessing,this._postHUD=this._postHUD||new t.HUD(0,0,512,512),this._postHUD.fsShader="hud_H_fs")},enumerable:!0,configurable:!0}),e.prototype.blender=function(e,i){this._cleanParmerts=(e?t.Context3DProxy.gl.COLOR_BUFFER_BIT:0)|(i?t.Context3DProxy.gl.DEPTH_BUFFER_BIT:0)},Object.defineProperty(e.prototype,"backColor",{get:function(){return 255*this._backColor.w<<24|255*this._backColor.x<<16|255*this._backColor.y<<8|255*this._backColor.z},set:function(t){this._backColor.w=(t>>24&255)/255,this._backColor.x=(t>>16&255)/255,this._backColor.y=(t>>8&255)/255,this._backColor.z=(255&t)/255},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backImage",{get:function(){return this._backImg.diffuseTexture},set:function(e){e&&(this._backImg=this._backImg||new t.HUD,this._backImg.diffuseTexture=e,this._backImg.x=this.x,this._backImg.y=this.y,this._backImg.width=this.width,this._backImg.height=this.height)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"camera3D",{get:function(){return this._camera},set:function(t){this._camera=t,this._camera.aspectRatio=this._viewPort.width/this._viewPort.height,this._camera.updateViewport(this._viewPort.x,this._viewPort.y,this._viewPort.width,this._viewPort.height),this._quadStage&&this._quadStage.changeCamera()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scene",{get:function(){return this._scene},set:function(t){this._scene=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._viewPort.x},set:function(t){this._viewPort.x=t,this._camera.updateViewport(this._viewPort.x,this._viewPort.y,this._viewPort.width,this._viewPort.height),this._backImg&&(this._backImg.x=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._viewPort.y},set:function(t){this._viewPort.y=t,this._camera.updateViewport(this._viewPort.x,this._viewPort.y,this._viewPort.width,this._viewPort.height),this._backImg&&(this._backImg.y=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._viewPort.width},set:function(t){this._viewPort.width=t,this._camera.aspectRatio=this._viewPort.width/this._viewPort.height,this._camera.updateViewport(this._viewPort.x,this._viewPort.y,this._viewPort.width,this._viewPort.height),this._backImg&&(this._backImg.width=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._viewPort.height},set:function(t){this._viewPort.height=t,this._camera.aspectRatio=this._viewPort.width/this._viewPort.height,this._camera.updateViewport(this._viewPort.x,this._viewPort.y,this._viewPort.width,this._viewPort.height),this._backImg&&(this._backImg.height=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewPort",{get:function(){return this._viewPort},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entityCollect",{get:function(){return this._entityCollect},enumerable:!0,configurable:!0}),e.prototype.getGUIStage=function(){return this._quadStage||(this._quadStage=new t.QuadStage(this)),this._quadStage},e.prototype.addGUI=function(e){this._quadStage||(this._quadStage=new t.QuadStage(this)),this._quadStage.addChild(e)},e.prototype.removeGUI=function(t){this._quadStage.removeChild(t)},e.prototype.addChild3D=function(t){this._scene.addChild3D(t)},e.prototype.removeChild3D=function(t){this._scene.removeChild3D(t)},e.prototype.inView3D=function(t,e){return this._viewPort.inner(t,e)},e.prototype.addHUD=function(t){-1==this._huds.indexOf(t)&&(t.viewPort=this._viewPort,this._huds.push(t))},e.prototype.findHud=function(t){for(var e=0;e<this._huds.length;++e)if(this._huds[e].name==t)return this._huds[e];return null},e.prototype.delHUD=function(t){var e=this._huds.indexOf(t);e>=0&&e<this._huds.length&&this._huds.splice(e,1)},e.prototype.update=function(e,i){if(this._camera.viewPort=this._viewPort,this.updateObject3D(this._scene.root,e,i),t.Egret3DCanvas.context3DProxy.viewPort(this._viewPort.x,this._viewPort.y,this._viewPort.width,this._viewPort.height),t.Egret3DCanvas.context3DProxy.setScissorRectangle(this._viewPort.x,this._viewPort.y,this._viewPort.width,this._viewPort.height),this._entityCollect.update(this._camera),t.Egret3DEngine.instance.debug){t.Egret3DState.showDataInfo("drawCall : "+this._entityCollect.numberDraw.toString()),t.Egret3DState.showDataInfo("vertex : "+this._entityCollect.numberVertex.toString()),t.Egret3DState.showDataInfo("tris : "+this._entityCollect.numberFace.toString()),t.Egret3DState.showDataInfo("skin : "+this._entityCollect.numberSkin.toString()),t.Egret3DState.showDataInfo("proAnim : "+this._entityCollect.numberAnimation.toString()),t.Egret3DState.showDataInfo("particleEmiter : "+this._entityCollect.numberParticle.toString());for(var r,a=0;a<t.Layer.layerType.length;a++)r=t.Layer.layerType[a]+" layer: "+this._entityCollect.softRenderItems[t.Layer.layerType[a]].length.toString(),t.Egret3DState.showDataInfo(r)}t.PickSystem.instance.enablePick&&t.PickSystem.instance.update(this._entityCollect,this._camera,e,i,this._viewPort),t.ShadowCast.enableShadow&&t.ShadowCast.instance.update(this._entityCollect,this._camera,e,i,this._viewPort),this._cleanParmerts&t.Context3DProxy.gl.COLOR_BUFFER_BIT&&t.Egret3DCanvas.context3DProxy.clearColor(this._backColor.x,this._backColor.y,this._backColor.z,this._backColor.w),t.Egret3DCanvas.context3DProxy.clear(this._cleanParmerts),this._backImg&&this._backImg.draw(t.Egret3DCanvas.context3DProxy),this._postList.length>0?(this._postProcessing.postItem=this._postList,this._postProcessing.drawFrameBuffer(e,i,t.Egret3DCanvas.context3DProxy,this._entityCollect,this._camera,this._viewPort)):this._render.draw(e,i,t.Egret3DCanvas.context3DProxy,this._entityCollect,this._camera,this._viewPort);for(var a=0;a<this._huds.length;++a)this._huds[a].draw(t.Egret3DCanvas.context3DProxy);this._quadStage&&this._quadStage.update(e,i,t.Egret3DCanvas.context3DProxy,this)},e.prototype.updateObject3D=function(t,e,i){if(t){t.update(e,i,this.camera3D);for(var r=0;r<t.childs.length;++r)this.updateObject3D(t.childs[r],e,i)}},e.requestFullScreen=function(){var t=document.documentElement;t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullScreen&&t.webkitRequestFullScreen()},e.exitFullscreen=function(){var t=document;t.exitFullscreen?t.exitFullscreen():t.webkitCancelFullScreen&&t.webkitCancelFullScreen()},e}();t.View3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r,a,n){e.call(this,i,r,a,n,new t.Camera3D(t.CameraType.VR)),this.leftViewPort=new t.Rectangle,this.rightViewPort=new t.Rectangle,this.updateViewport()}return __extends(i,e),i.prototype.updateViewport=function(){this.leftViewPort.x=this._viewPort.x,this.leftViewPort.y=this._viewPort.y,this.leftViewPort.width=this._viewPort.width/2,this.leftViewPort.height=this._viewPort.height,this.rightViewPort.x=this._viewPort.x+this.leftViewPort.width,this.rightViewPort.y=this._viewPort.y,this.rightViewPort.width=this.leftViewPort.width,this.rightViewPort.height=this.leftViewPort.height},Object.defineProperty(i.prototype,"x",{set:function(t){this._viewPort.x=t,this.updateViewport()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{set:function(t){this._viewPort.y=t,this.updateViewport()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{set:function(t){this._viewPort.width=t,this._camera.aspectRatio=this._viewPort.width/this._viewPort.height,this.updateViewport()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{set:function(t){this._viewPort.height=t,this._camera.aspectRatio=this._viewPort.width/this._viewPort.height,this.updateViewport()},enumerable:!0,configurable:!0}),i.prototype.update=function(e,i){for(this._entityCollect.update(this._camera),this._numberEntity=this._entityCollect.renderList.length,this._index=0;this._index<this._numberEntity;this._index++)this._entityCollect.renderList[this._index].update(e,i,this._camera);var r=this.leftViewPort;
this._camera.viewPort=r,this._camera.tap(t.CameraType.VR,t.VRType.left),t.Egret3DCanvas.context3DProxy.viewPort(r.x,r.y,r.width,r.height),t.Egret3DCanvas.context3DProxy.setScissorRectangle(r.x,r.y,r.width,r.height),this._cleanParmerts&t.Context3DProxy.gl.COLOR_BUFFER_BIT&&t.Egret3DCanvas.context3DProxy.clearColor(this._backColor.x,this._backColor.y,this._backColor.z,this._backColor.w),t.Egret3DCanvas.context3DProxy.clear(this._cleanParmerts),this._render.draw(e,i,t.Egret3DCanvas.context3DProxy,this._entityCollect,this._camera),r=this.rightViewPort,this._camera.viewPort=r,this._camera.tap(t.CameraType.VR,t.VRType.right),t.Egret3DCanvas.context3DProxy.viewPort(r.x,r.y,r.width,r.height),t.Egret3DCanvas.context3DProxy.setScissorRectangle(r.x,r.y,r.width,r.height),this._cleanParmerts&t.Context3DProxy.gl.COLOR_BUFFER_BIT&&t.Egret3DCanvas.context3DProxy.clearColor(this._backColor.x,this._backColor.y,this._backColor.z,this._backColor.w),t.Egret3DCanvas.context3DProxy.clear(this._cleanParmerts),this._render.draw(e,i,t.Egret3DCanvas.context3DProxy,this._entityCollect,this._camera)},Object.defineProperty(i.prototype,"eyeDistance",{get:function(){return this._camera.eyeMatrix.eyeSpace},set:function(t){this._camera.eyeMatrix.eyeSpace=t},enumerable:!0,configurable:!0}),i}(t.View3D);t.VRView3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(r){void 0===r&&(r=!1),e.call(this),this.canvas3DRectangle=new t.Rectangle,this._view3DS=new Array,this.sizeDiry=!0,this._time=0,this._delay=0,this._renderer=0,this._timeDate=null,this.offsetX=0,this.offsetY=0,t.ShaderUtil.instance.load(),this._envetManager=new t.EventManager(this),this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.zIndex="-1",document.getElementsByClassName("egret-player").length>0?document.getElementsByClassName("egret-player")[0].appendChild(this.canvas):document.body.appendChild(this.canvas),this.canvas.id="egret3D",this.canvas.oncontextmenu=function(){return!1},i.context3DProxy=new t.Context3DProxy,t.Context3DProxy.gl=this.canvas.getContext("experimental-webgl"),t.Context3DProxy.gl||(t.Context3DProxy.gl=this.canvas.getContext("webgl")),t.Context3DProxy.gl.getExtension("WEBGL_draw_buffers"),t.Context3DProxy.gl||alert("you drivers not suport webgl"),i.context3DProxy.register(),console.log("this.context3D ==>",t.Context3DProxy.gl),t.Input.canvas=this,this.initEvent()}return __extends(i,e),i.prototype.initEvent=function(){this._enterFrameEvent3D=new t.Event3D(t.Event3D.ENTER_FRAME),this._enterFrameEvent3D.target=this},Object.defineProperty(i.prototype,"x",{get:function(){return this.canvas3DRectangle.x},set:function(t){this.canvas3DRectangle.x!=t&&this.resize(t,this.canvas3DRectangle.y,this.canvas3DRectangle.width,this.canvas3DRectangle.height)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this.canvas3DRectangle.y},set:function(t){this.canvas3DRectangle.y!=t&&this.resize(this.canvas3DRectangle.x,t,this.canvas3DRectangle.width,this.canvas3DRectangle.height)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this.canvas3DRectangle.width},set:function(t){this.canvas3DRectangle.width!=t&&this.resize(this.canvas3DRectangle.x,this.canvas3DRectangle.y,t,this.canvas3DRectangle.height)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this.canvas3DRectangle.height},set:function(t){this.canvas3DRectangle.height!=t&&this.resize(this.canvas3DRectangle.x,this.canvas3DRectangle.y,this.canvas3DRectangle.width,t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"view3Ds",{get:function(){return this._view3DS},enumerable:!0,configurable:!0}),i.prototype.addView3D=function(t){var e=this._view3DS.indexOf(t);-1==e&&this._view3DS.push(t)},i.prototype.removeView3D=function(t){var e=this._view3DS.indexOf(t);-1!=e&&this._view3DS.splice(e)},i.prototype.start=function(){this.update(0),i.context3DProxy.enableBlend(),i.context3DProxy.enableCullFace(),t.Context3DProxy.gl.enable(t.Context3DProxy.gl.SCISSOR_TEST),t.Context3DProxy.gl.enableVertexAttribArray(0),t.Context3DProxy.gl.enableVertexAttribArray(1),t.Context3DProxy.gl.enableVertexAttribArray(2),t.Context3DProxy.gl.enableVertexAttribArray(3),t.Context3DProxy.gl.enableVertexAttribArray(4),t.Context3DProxy.gl.enableVertexAttribArray(5),t.Context3DProxy.gl.enableVertexAttribArray(6)},i.prototype.update=function(){var e=this;this._timeDate=new Date,this._delay=this._timeDate.getTime()-this._time,this._time=this._timeDate.getTime(),this._enterFrameEvent3D.time+=this._time,this._enterFrameEvent3D.delay=this._delay,this.dispatchEvent(this._enterFrameEvent3D),i.context3DProxy.viewPort(this.canvas3DRectangle.x,this.canvas3DRectangle.y,this.canvas3DRectangle.width,this.canvas3DRectangle.height),i.context3DProxy.setScissorRectangle(this.canvas3DRectangle.x,this.canvas3DRectangle.y,this.canvas3DRectangle.width,this.canvas3DRectangle.height),t.CameraManager.instance.update(this._time,this._delay);for(var r=0;r<this._view3DS.length;r++)this._view3DS[r].update(this._time,this._delay);t.Egret3DEngine.instance.debug&&(this._renderer=Math.floor((new Date).getTime()-this._time),t.Egret3DState.showTime(this._time,this._delay),t.Egret3DState.showDataInfo("renderer: "+this._renderer.toString()+" ms"),t.Egret3DState.show()),this.afterRender&&this.afterRender(),t.Context3DProxy.gl.flush(),requestAnimationFrame(function(t){return e.update(t)})},i.prototype.resize=function(e,i,r,a){this.canvas3DRectangle.x=e,this.canvas3DRectangle.y=i,this.canvas3DRectangle.width=r,this.canvas3DRectangle.height=a,t.ContextConfig.canvasRectangle=this.canvas3DRectangle,this.canvas.style.left=this.canvas3DRectangle.x.toString()+"px",this.canvas.style.top=this.canvas3DRectangle.y.toString()+"px",this.canvas.width=this.canvas3DRectangle.width,this.canvas.height=this.canvas3DRectangle.height},i}(t.EventDispatcher);t.Egret3DCanvas=e}(egret3d||(egret3d={}));var egret3d;!function(egret3d){var Egret3DEngine=function(){function Egret3DEngine(){this.jsPath="js/",this.debug=!1,this._tsconfigs=[],this.importList=[],this._tsconfigs.push("Egret3D/tsconfig.json")}return Egret3DEngine.getXHR=function(){var t=null;return t=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")},Egret3DEngine.prototype.addTsconfig=function(t){this._tsconfigs.push(t)},Egret3DEngine.prototype.setTsconfig=function(t,e){this._tsconfigs[t]=e},Egret3DEngine.prototype.clearTsconfig=function(){this._tsconfigs.length=0},Egret3DEngine.prototype.preload=function(t,e){void 0===e&&(e=null),this._complete=t,this._thisObject=e,this._tsconfigs.length>0?this.doLoader(this._tsconfigs[0]):this.onAllLoadComplete()},Egret3DEngine.prototype.addImportScript=function(t){this.importList.push(t)},Egret3DEngine.prototype.doLoader=function(t){var e=this;return this._currentConfig=t,null==this._xhr&&(this._xhr=Egret3DEngine.getXHR()),null==this._xhr?void alert("Your browser does not support XMLHTTP."):(this._xhr.readyState>0&&this._xhr.abort(),this._xhr.open("GET",t+"?"+1e5*Math.random(),!0),this._xhr.addEventListener("progress",function(t){return e.onProgress(t)},!1),this._xhr.addEventListener("readystatechange",function(t){return e.onReadyStateChange(t)},!1),this._xhr.addEventListener("error",function(t){return e.onError(t)},!1),this._xhr.responseType="text",void this._xhr.send())},Egret3DEngine.prototype.onProgress=function(t){var e=t.loaded.toString()+t.total;console.log("progress event```"+e)},Egret3DEngine.prototype.onReadyStateChange=function(){4==this._xhr.readyState&&(this._xhr.status>=400||0==this._xhr.status?console.log(this._currentConfig,"load fail"):this.onLoadComplete(this._xhr.responseText))},Egret3DEngine.prototype.onLoadComplete=function(source){for(var s_pos=this._currentConfig.lastIndexOf("/"),dir=this._currentConfig.substr(0,s_pos+1),obj=eval("("+source+")"),importName,i=0;i<obj.files.length;++i)importName=this.jsPath+dir,importName+=obj.files[i],importName=importName.replace(".ts",".js"),this.importList.push(importName);var index=this._tsconfigs.indexOf(this._currentConfig);index==this._tsconfigs.length-1?this.onAllLoadTsconfigComplete():(this._xhr=null,this.doLoader(this._tsconfigs[++index]))},Egret3DEngine.prototype.onError=function(){},Egret3DEngine.prototype.onAllLoadTsconfigComplete=function(){this.onTsconfig&&this.onTsconfig(),this.startLoadScript(null)},Egret3DEngine.prototype.onAllLoadComplete=function(){this._complete&&(this._thisObject?this._complete.call(this._thisObject):this._complete())},Egret3DEngine.prototype.startLoadScript=function(){var t=this;if(this.importList.length>0){var e=document.createElement("script");e.src=this.importList.shift(),e.onload=function(e){return t.startLoadScript(e)},e.onerror=function(e){return t.loadScriptError(e)},document.head.appendChild(e)}else console.log("all complete"),this.onAllLoadComplete()},Egret3DEngine.prototype.loadScriptError=function(t){var e="load Script Error \r\n no file:"+t.srcElement.src;alert(e),this.startLoadScript(null)},Egret3DEngine.instance=new Egret3DEngine,Egret3DEngine}();egret3d.Egret3DEngine=Egret3DEngine}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this._debugHud=new t.HUD,this.postRender=new t.PostRender("hud_vs","SSAO")}return e.prototype.drawTexture=function(t,e,i,r,a,n,o){this.postRender.hud.colorPass=o.colorPass,this.postRender.hud.positionPass=o.positionPass,this.postRender.hud.normalPass=o.normalPass,this.postRender.draw(t,e,i,r,a,n,o),o.end=this.postRender.renderTexture},e}();t.AmbientOcclusion=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this._debugHud=new t.HUD,this.mainPassRender=new t.MultiRender(t.PassType.normalPass),this.mainPassRender.setRenderToTexture(2048,2048,t.FrameBufferFormat.UNSIGNED_BYTE_RGB),this._debugHud.fsShader="hud_H_fs",this._debugHud.x=512,this._debugHud.y=0,this._debugHud.width=256,this._debugHud.height=256}return e.prototype.drawTexture=function(t,e,i,r,a,n,o){this.mainPassRender.draw(t,e,i,r,a,n),o.mainPass=this.mainPassRender.renderTexture,o.end=this.mainPassRender.renderTexture,o.colorTexture=this.mainPassRender.renderTexture},e}();t.MainPass=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this._debugHud=new t.HUD,this.colorPassRender=new t.MultiRender(t.PassType.colorPass),this.colorPassRender.setRenderToTexture(2048,2048,t.FrameBufferFormat.UNSIGNED_BYTE_RGB),this.PositionPassRender=new t.MultiRender(t.PassType.depthPass_8),this.PositionPassRender.setRenderToTexture(2048,2048,t.FrameBufferFormat.FLOAT_RGBA),this.NormalPassRender=new t.MultiRender(t.PassType.normalPass),this.NormalPassRender.setRenderToTexture(2048,2048,t.FrameBufferFormat.UNSIGNED_BYTE_RGB),this._debugHud.fsShader="hud_H_fs",this._debugHud.x=512,this._debugHud.y=0,this._debugHud.width=256,this._debugHud.height=256}return e.prototype.drawTexture=function(t,e,i,r,a,n,o){this.colorPassRender.draw(t,e,i,r,a,n),this.NormalPassRender.draw(t,e,i,r,a,n),this.PositionPassRender.draw(t,e,i,r,a,n),o.colorPass=this.colorPassRender.renderTexture,o.positionPass=this.PositionPassRender.renderTexture,o.normalPass=this.NormalPassRender.renderTexture,this._debugHud.viewPort=a.viewPort,this._debugHud.diffuseTexture=this.colorPassRender.renderTexture,this._debugHud.draw(i)},e}();t.DeferredShadingProcessing=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this._debugHud=new t.HUD,this.postRender=new t.PostRender("hud_vs","bloom_fs"),this.postRender.setRenderToTexture(256,256,t.FrameBufferFormat.UNSIGNED_BYTE_RGB),this.gaussPass=new t.GaussPass,this._debugHud.fsShader="hud_H_fs",this._debugHud.x=768,this._debugHud.y=0,this._debugHud.width=128,this._debugHud.height=128}return e.prototype.drawTexture=function(t,e,i,r,a,n,o){this.postRender.draw(t,e,i,r,a,n,o),o.bloomPass=this.postRender.renderTexture,o.end=this.postRender.renderTexture,this.gaussPass.drawTexture(t,e,i,r,a,n,o)},e}();t.BloomPass=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this._debugHud=new t.HUD,this._h_postRender=new t.PostRender("hud_vs","gaussian_H_fs"),this._h_postRender.setRenderToTexture(2048,2048,t.FrameBufferFormat.UNSIGNED_BYTE_RGB),this._v_postRender=new t.PostRender("hud_vs","gaussian_V_fs"),this._v_postRender.setRenderToTexture(2048,2048,t.FrameBufferFormat.UNSIGNED_BYTE_RGB),this._debugHud.fsShader="hud_H_fs",this._debugHud.x=768,this._debugHud.y=0,this._debugHud.width=128,this._debugHud.height=128}return e.prototype.drawTexture=function(t,e,i,r,a,n,o){this._h_postRender.draw(t,e,i,r,a,n,o),o.end=this._h_postRender.renderTexture,this._v_postRender.draw(t,e,i,r,a,n,o),o.end=this._v_postRender.renderTexture,o.bloomPass=this._v_postRender.renderTexture},e}();t.GaussPass=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.posTex={},this.postItem=[],this.postRender=new t.MultiRender(t.PassType.diffusePass),this.postRender.setRenderToTexture(1024,1024,t.FrameBufferFormat.FLOAT_RGB),this.endTexture=this.posTex.end=this.postRender.renderTexture}return e.prototype.drawFrameBuffer=function(t,e,i,r,a,n){void 0===n&&(n=null);for(var o=0;o<this.postItem.length;o++)this.postItem[o].drawTexture(t,e,i,r,a,n,this.posTex),this.endTexture=this.posTex.end},e}();t.PostProcessing=e}(egret3d||(egret3d={}));
;/*!libs/static/tween/TweenMax.js*/
var _gsScope="undefined"!=typeof module&&module.exports&&"undefined"!=typeof global?global:this||window;(_gsScope._gsQueue||(_gsScope._gsQueue=[])).push(function(){"use strict";_gsScope._gsDefine("TweenMax",["core.Animation","core.SimpleTimeline","TweenLite"],function(t,e,i){var s=function(t){var e,i=[],s=t.length;for(e=0;e!==s;i.push(t[e++]));return i},r=function(t,e,i){var s,r,n=t.cycle;for(s in n)r=n[s],t[s]="function"==typeof r?r(i,e[i]):r[i%r.length];delete t.cycle},n=function(t,e,s){i.call(this,t,e,s),this._cycle=0,this._yoyo=this.vars.yoyo===!0,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._dirty=!0,this.render=n.prototype.render},a=1e-10,o=i._internals,l=o.isSelector,h=o.isArray,_=n.prototype=i.to({},.1,{}),u=[];n.version="1.19.0",_.constructor=n,_.kill()._gc=!1,n.killTweensOf=n.killDelayedCallsTo=i.killTweensOf,n.getTweensOf=i.getTweensOf,n.lagSmoothing=i.lagSmoothing,n.ticker=i.ticker,n.render=i.render,_.invalidate=function(){return this._yoyo=this.vars.yoyo===!0,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._uncache(!0),i.prototype.invalidate.call(this)},_.updateTo=function(t,e){var s,r=this.ratio,n=this.vars.immediateRender||t.immediateRender;e&&this._startTime<this._timeline._time&&(this._startTime=this._timeline._time,this._uncache(!1),this._gc?this._enabled(!0,!1):this._timeline.insert(this,this._startTime-this._delay));for(s in t)this.vars[s]=t[s];if(this._initted||n)if(e)this._initted=!1,n&&this.render(0,!0,!0);else if(this._gc&&this._enabled(!0,!1),this._notifyPluginsOfEnabled&&this._firstPT&&i._onPluginEvent("_onDisable",this),this._time/this._duration>.998){var a=this._totalTime;this.render(0,!0,!1),this._initted=!1,this.render(a,!0,!1)}else if(this._initted=!1,this._init(),this._time>0||n)for(var o,l=1/(1-r),h=this._firstPT;h;)o=h.s+h.c,h.c*=l,h.s=o-h.c,h=h._next;return this},_.render=function(t,e,i){this._initted||0===this._duration&&this.vars.repeat&&this.invalidate();var s,r,n,l,h,_,u,f,c=this._dirty?this.totalDuration():this._totalDuration,p=this._time,m=this._totalTime,d=this._cycle,g=this._duration,v=this._rawPrevTime;if(t>=c-1e-7?(this._totalTime=c,this._cycle=this._repeat,this._yoyo&&0!==(1&this._cycle)?(this._time=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0):(this._time=g,this.ratio=this._ease._calcEnd?this._ease.getRatio(1):1),this._reversed||(s=!0,r="onComplete",i=i||this._timeline.autoRemoveChildren),0===g&&(this._initted||!this.vars.lazy||i)&&(this._startTime===this._timeline._duration&&(t=0),(0>v||0>=t&&t>=-1e-7||v===a&&"isPause"!==this.data)&&v!==t&&(i=!0,v>a&&(r="onReverseComplete")),this._rawPrevTime=f=!e||t||v===t?t:a)):1e-7>t?(this._totalTime=this._time=this._cycle=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0,(0!==m||0===g&&v>0)&&(r="onReverseComplete",s=this._reversed),0>t&&(this._active=!1,0===g&&(this._initted||!this.vars.lazy||i)&&(v>=0&&(i=!0),this._rawPrevTime=f=!e||t||v===t?t:a)),this._initted||(i=!0)):(this._totalTime=this._time=t,0!==this._repeat&&(l=g+this._repeatDelay,this._cycle=this._totalTime/l>>0,0!==this._cycle&&this._cycle===this._totalTime/l&&t>=m&&this._cycle--,this._time=this._totalTime-this._cycle*l,this._yoyo&&0!==(1&this._cycle)&&(this._time=g-this._time),this._time>g?this._time=g:this._time<0&&(this._time=0)),this._easeType?(h=this._time/g,_=this._easeType,u=this._easePower,(1===_||3===_&&h>=.5)&&(h=1-h),3===_&&(h*=2),1===u?h*=h:2===u?h*=h*h:3===u?h*=h*h*h:4===u&&(h*=h*h*h*h),this.ratio=1===_?1-h:2===_?h:this._time/g<.5?h/2:1-h/2):this.ratio=this._ease.getRatio(this._time/g)),p===this._time&&!i&&d===this._cycle)return void(m!==this._totalTime&&this._onUpdate&&(e||this._callback("onUpdate")));if(!this._initted){if(this._init(),!this._initted||this._gc)return;if(!i&&this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration))return this._time=p,this._totalTime=m,this._rawPrevTime=v,this._cycle=d,o.lazyTweens.push(this),void(this._lazy=[t,e]);this._time&&!s?this.ratio=this._ease.getRatio(this._time/g):s&&this._ease._calcEnd&&(this.ratio=this._ease.getRatio(0===this._time?0:1))}for(this._lazy!==!1&&(this._lazy=!1),this._active||!this._paused&&this._time!==p&&t>=0&&(this._active=!0),0===m&&(2===this._initted&&t>0&&this._init(),this._startAt&&(t>=0?this._startAt.render(t,e,i):r||(r="_dummyGS")),this.vars.onStart&&(0!==this._totalTime||0===g)&&(e||this._callback("onStart"))),n=this._firstPT;n;)n.f?n.t[n.p](n.c*this.ratio+n.s):n.t[n.p]=n.c*this.ratio+n.s,n=n._next;this._onUpdate&&(0>t&&this._startAt&&this._startTime&&this._startAt.render(t,e,i),e||(this._totalTime!==m||r)&&this._callback("onUpdate")),this._cycle!==d&&(e||this._gc||this.vars.onRepeat&&this._callback("onRepeat")),r&&(!this._gc||i)&&(0>t&&this._startAt&&!this._onUpdate&&this._startTime&&this._startAt.render(t,e,i),s&&(this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!e&&this.vars[r]&&this._callback(r),0===g&&this._rawPrevTime===a&&f!==a&&(this._rawPrevTime=0))},n.to=function(t,e,i){return new n(t,e,i)},n.from=function(t,e,i){return i.runBackwards=!0,i.immediateRender=0!=i.immediateRender,new n(t,e,i)},n.fromTo=function(t,e,i,s){return s.startAt=i,s.immediateRender=0!=s.immediateRender&&0!=i.immediateRender,new n(t,e,s)},n.staggerTo=n.allTo=function(t,e,a,o,_,f,c){o=o||0;var p,m,d,g,v=0,y=[],T=function(){a.onComplete&&a.onComplete.apply(a.onCompleteScope||this,arguments),_.apply(c||a.callbackScope||this,f||u)},x=a.cycle,w=a.startAt&&a.startAt.cycle;for(h(t)||("string"==typeof t&&(t=i.selector(t)||t),l(t)&&(t=s(t))),t=t||[],0>o&&(t=s(t),t.reverse(),o*=-1),p=t.length-1,d=0;p>=d;d++){m={};for(g in a)m[g]=a[g];if(x&&(r(m,t,d),null!=m.duration&&(e=m.duration,delete m.duration)),w){w=m.startAt={};for(g in a.startAt)w[g]=a.startAt[g];r(m.startAt,t,d)}m.delay=v+(m.delay||0),d===p&&_&&(m.onComplete=T),y[d]=new n(t[d],e,m),v+=o}return y},n.staggerFrom=n.allFrom=function(t,e,i,s,r,a,o){return i.runBackwards=!0,i.immediateRender=0!=i.immediateRender,n.staggerTo(t,e,i,s,r,a,o)},n.staggerFromTo=n.allFromTo=function(t,e,i,s,r,a,o,l){return s.startAt=i,s.immediateRender=0!=s.immediateRender&&0!=i.immediateRender,n.staggerTo(t,e,s,r,a,o,l)},n.delayedCall=function(t,e,i,s,r){return new n(e,0,{delay:t,onComplete:e,onCompleteParams:i,callbackScope:s,onReverseComplete:e,onReverseCompleteParams:i,immediateRender:!1,useFrames:r,overwrite:0})},n.set=function(t,e){return new n(t,0,e)},n.isTweening=function(t){return i.getTweensOf(t,!0).length>0};var f=function(t,e){for(var s=[],r=0,n=t._first;n;)n instanceof i?s[r++]=n:(e&&(s[r++]=n),s=s.concat(f(n,e)),r=s.length),n=n._next;return s},c=n.getAllTweens=function(e){return f(t._rootTimeline,e).concat(f(t._rootFramesTimeline,e))};n.killAll=function(t,i,s,r){null==i&&(i=!0),null==s&&(s=!0);var n,a,o,l=c(0!=r),h=l.length,_=i&&s&&r;for(o=0;h>o;o++)a=l[o],(_||a instanceof e||(n=a.target===a.vars.onComplete)&&s||i&&!n)&&(t?a.totalTime(a._reversed?0:a.totalDuration()):a._enabled(!1,!1))},n.killChildTweensOf=function(t,e){if(null!=t){var r,a,_,u,f,c=o.tweenLookup;if("string"==typeof t&&(t=i.selector(t)||t),l(t)&&(t=s(t)),h(t))for(u=t.length;--u>-1;)n.killChildTweensOf(t[u],e);else{r=[];for(_ in c)for(a=c[_].target.parentNode;a;)a===t&&(r=r.concat(c[_].tweens)),a=a.parentNode;for(f=r.length,u=0;f>u;u++)e&&r[u].totalTime(r[u].totalDuration()),r[u]._enabled(!1,!1)}}};var p=function(t,i,s,r){i=i!==!1,s=s!==!1,r=r!==!1;for(var n,a,o=c(r),l=i&&s&&r,h=o.length;--h>-1;)a=o[h],(l||a instanceof e||(n=a.target===a.vars.onComplete)&&s||i&&!n)&&a.paused(t)};return n.pauseAll=function(t,e,i){p(!0,t,e,i)},n.resumeAll=function(t,e,i){p(!1,t,e,i)},n.globalTimeScale=function(e){var s=t._rootTimeline,r=i.ticker.time;return arguments.length?(e=e||a,s._startTime=r-(r-s._startTime)*s._timeScale/e,s=t._rootFramesTimeline,r=i.ticker.frame,s._startTime=r-(r-s._startTime)*s._timeScale/e,s._timeScale=t._rootTimeline._timeScale=e,e):s._timeScale},_.progress=function(t,e){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&0!==(1&this._cycle)?1-t:t)+this._cycle*(this._duration+this._repeatDelay),e):this._time/this.duration()},_.totalProgress=function(t,e){return arguments.length?this.totalTime(this.totalDuration()*t,e):this._totalTime/this.totalDuration()},_.time=function(t,e){return arguments.length?(this._dirty&&this.totalDuration(),t>this._duration&&(t=this._duration),this._yoyo&&0!==(1&this._cycle)?t=this._duration-t+this._cycle*(this._duration+this._repeatDelay):0!==this._repeat&&(t+=this._cycle*(this._duration+this._repeatDelay)),this.totalTime(t,e)):this._time},_.duration=function(e){return arguments.length?t.prototype.duration.call(this,e):this._duration},_.totalDuration=function(t){return arguments.length?-1===this._repeat?this:this.duration((t-this._repeat*this._repeatDelay)/(this._repeat+1)):(this._dirty&&(this._totalDuration=-1===this._repeat?999999999999:this._duration*(this._repeat+1)+this._repeatDelay*this._repeat,this._dirty=!1),this._totalDuration)},_.repeat=function(t){return arguments.length?(this._repeat=t,this._uncache(!0)):this._repeat},_.repeatDelay=function(t){return arguments.length?(this._repeatDelay=t,this._uncache(!0)):this._repeatDelay},_.yoyo=function(t){return arguments.length?(this._yoyo=t,this):this._yoyo},n},!0),_gsScope._gsDefine("TimelineLite",["core.Animation","core.SimpleTimeline","TweenLite"],function(t,e,i){var s=function(t){e.call(this,t),this._labels={},this.autoRemoveChildren=this.vars.autoRemoveChildren===!0,this.smoothChildTiming=this.vars.smoothChildTiming===!0,this._sortChildren=!0,this._onUpdate=this.vars.onUpdate;var i,s,r=this.vars;for(s in r)i=r[s],l(i)&&-1!==i.join("").indexOf("{self}")&&(r[s]=this._swapSelfInParams(i));l(r.tweens)&&this.add(r.tweens,0,r.align,r.stagger)},r=1e-10,n=i._internals,a=s._internals={},o=n.isSelector,l=n.isArray,h=n.lazyTweens,_=n.lazyRender,u=_gsScope._gsDefine.globals,f=function(t){var e,i={};for(e in t)i[e]=t[e];return i},c=function(t,e,i){var s,r,n=t.cycle;for(s in n)r=n[s],t[s]="function"==typeof r?r.call(e[i],i):r[i%r.length];delete t.cycle},p=a.pauseCallback=function(){},m=function(t){var e,i=[],s=t.length;for(e=0;e!==s;i.push(t[e++]));return i},d=s.prototype=new e;return s.version="1.19.0",d.constructor=s,d.kill()._gc=d._forcingPlayhead=d._hasPause=!1,d.to=function(t,e,s,r){var n=s.repeat&&u.TweenMax||i;return e?this.add(new n(t,e,s),r):this.set(t,s,r)},d.from=function(t,e,s,r){return this.add((s.repeat&&u.TweenMax||i).from(t,e,s),r)},d.fromTo=function(t,e,s,r,n){var a=r.repeat&&u.TweenMax||i;return e?this.add(a.fromTo(t,e,s,r),n):this.set(t,r,n)},d.staggerTo=function(t,e,r,n,a,l,h,_){var u,p,d=new s({onComplete:l,onCompleteParams:h,callbackScope:_,smoothChildTiming:this.smoothChildTiming}),g=r.cycle;for("string"==typeof t&&(t=i.selector(t)||t),t=t||[],o(t)&&(t=m(t)),n=n||0,0>n&&(t=m(t),t.reverse(),n*=-1),p=0;p<t.length;p++)u=f(r),u.startAt&&(u.startAt=f(u.startAt),u.startAt.cycle&&c(u.startAt,t,p)),g&&(c(u,t,p),null!=u.duration&&(e=u.duration,delete u.duration)),d.to(t[p],e,u,p*n);return this.add(d,a)},d.staggerFrom=function(t,e,i,s,r,n,a,o){return i.immediateRender=0!=i.immediateRender,i.runBackwards=!0,this.staggerTo(t,e,i,s,r,n,a,o)},d.staggerFromTo=function(t,e,i,s,r,n,a,o,l){return s.startAt=i,s.immediateRender=0!=s.immediateRender&&0!=i.immediateRender,this.staggerTo(t,e,s,r,n,a,o,l)},d.call=function(t,e,s,r){return this.add(i.delayedCall(0,t,e,s),r)},d.set=function(t,e,s){return s=this._parseTimeOrLabel(s,0,!0),null==e.immediateRender&&(e.immediateRender=s===this._time&&!this._paused),this.add(new i(t,0,e),s)},s.exportRoot=function(t,e){t=t||{},null==t.smoothChildTiming&&(t.smoothChildTiming=!0);var r,n,a=new s(t),o=a._timeline;for(null==e&&(e=!0),o._remove(a,!0),a._startTime=0,a._rawPrevTime=a._time=a._totalTime=o._time,r=o._first;r;)n=r._next,e&&r instanceof i&&r.target===r.vars.onComplete||a.add(r,r._startTime-r._delay),r=n;return o.add(a,0),a},d.add=function(r,n,a,o){var h,_,u,f,c,p;if("number"!=typeof n&&(n=this._parseTimeOrLabel(n,0,!0,r)),!(r instanceof t)){if(r instanceof Array||r&&r.push&&l(r)){for(a=a||"normal",o=o||0,h=n,_=r.length,u=0;_>u;u++)l(f=r[u])&&(f=new s({tweens:f})),this.add(f,h),"string"!=typeof f&&"function"!=typeof f&&("sequence"===a?h=f._startTime+f.totalDuration()/f._timeScale:"start"===a&&(f._startTime-=f.delay())),h+=o;return this._uncache(!0)}if("string"==typeof r)return this.addLabel(r,n);if("function"!=typeof r)throw"Cannot add "+r+" into the timeline; it is not a tween, timeline, function, or string.";r=i.delayedCall(0,r)}if(e.prototype.add.call(this,r,n),(this._gc||this._time===this._duration)&&!this._paused&&this._duration<this.duration())for(c=this,p=c.rawTime()>r._startTime;c._timeline;)p&&c._timeline.smoothChildTiming?c.totalTime(c._totalTime,!0):c._gc&&c._enabled(!0,!1),c=c._timeline;return this},d.remove=function(e){if(e instanceof t){this._remove(e,!1);var i=e._timeline=e.vars.useFrames?t._rootFramesTimeline:t._rootTimeline;return e._startTime=(e._paused?e._pauseTime:i._time)-(e._reversed?e.totalDuration()-e._totalTime:e._totalTime)/e._timeScale,this}if(e instanceof Array||e&&e.push&&l(e)){for(var s=e.length;--s>-1;)this.remove(e[s]);return this}return"string"==typeof e?this.removeLabel(e):this.kill(null,e)},d._remove=function(t,i){e.prototype._remove.call(this,t,i);var s=this._last;return s?this._time>s._startTime+s._totalDuration/s._timeScale&&(this._time=this.duration(),this._totalTime=this._totalDuration):this._time=this._totalTime=this._duration=this._totalDuration=0,this},d.append=function(t,e){return this.add(t,this._parseTimeOrLabel(null,e,!0,t))},d.insert=d.insertMultiple=function(t,e,i,s){return this.add(t,e||0,i,s)},d.appendMultiple=function(t,e,i,s){return this.add(t,this._parseTimeOrLabel(null,e,!0,t),i,s)},d.addLabel=function(t,e){return this._labels[t]=this._parseTimeOrLabel(e),this},d.addPause=function(t,e,s,r){var n=i.delayedCall(0,p,s,r||this);return n.vars.onComplete=n.vars.onReverseComplete=e,n.data="isPause",this._hasPause=!0,this.add(n,t)},d.removeLabel=function(t){return delete this._labels[t],this},d.getLabelTime=function(t){return null!=this._labels[t]?this._labels[t]:-1},d._parseTimeOrLabel=function(e,i,s,r){var n;if(r instanceof t&&r.timeline===this)this.remove(r);else if(r&&(r instanceof Array||r.push&&l(r)))for(n=r.length;--n>-1;)r[n]instanceof t&&r[n].timeline===this&&this.remove(r[n]);if("string"==typeof i)return this._parseTimeOrLabel(i,s&&"number"==typeof e&&null==this._labels[i]?e-this.duration():0,s);if(i=i||0,"string"!=typeof e||!isNaN(e)&&null==this._labels[e])null==e&&(e=this.duration());else{if(n=e.indexOf("="),-1===n)return null==this._labels[e]?s?this._labels[e]=this.duration()+i:i:this._labels[e]+i;i=parseInt(e.charAt(n-1)+"1",10)*Number(e.substr(n+1)),e=n>1?this._parseTimeOrLabel(e.substr(0,n-1),0,s):this.duration()}return Number(e)+i},d.seek=function(t,e){return this.totalTime("number"==typeof t?t:this._parseTimeOrLabel(t),e!==!1)},d.stop=function(){return this.paused(!0)},d.gotoAndPlay=function(t,e){return this.play(t,e)},d.gotoAndStop=function(t,e){return this.pause(t,e)},d.render=function(t,e,i){this._gc&&this._enabled(!0,!1);var s,n,a,o,l,u,f,c=this._dirty?this.totalDuration():this._totalDuration,p=this._time,m=this._startTime,d=this._timeScale,g=this._paused;if(t>=c-1e-7)this._totalTime=this._time=c,this._reversed||this._hasPausedChild()||(n=!0,o="onComplete",l=!!this._timeline.autoRemoveChildren,0===this._duration&&(0>=t&&t>=-1e-7||this._rawPrevTime<0||this._rawPrevTime===r)&&this._rawPrevTime!==t&&this._first&&(l=!0,this._rawPrevTime>r&&(o="onReverseComplete"))),this._rawPrevTime=this._duration||!e||t||this._rawPrevTime===t?t:r,t=c+1e-4;else if(1e-7>t)if(this._totalTime=this._time=0,(0!==p||0===this._duration&&this._rawPrevTime!==r&&(this._rawPrevTime>0||0>t&&this._rawPrevTime>=0))&&(o="onReverseComplete",n=this._reversed),0>t)this._active=!1,this._timeline.autoRemoveChildren&&this._reversed?(l=n=!0,o="onReverseComplete"):this._rawPrevTime>=0&&this._first&&(l=!0),this._rawPrevTime=t;else{if(this._rawPrevTime=this._duration||!e||t||this._rawPrevTime===t?t:r,0===t&&n)for(s=this._first;s&&0===s._startTime;)s._duration||(n=!1),s=s._next;t=0,this._initted||(l=!0)}else{if(this._hasPause&&!this._forcingPlayhead&&!e){if(t>=p)for(s=this._first;s&&s._startTime<=t&&!u;)s._duration||"isPause"!==s.data||s.ratio||0===s._startTime&&0===this._rawPrevTime||(u=s),s=s._next;else for(s=this._last;s&&s._startTime>=t&&!u;)s._duration||"isPause"===s.data&&s._rawPrevTime>0&&(u=s),s=s._prev;u&&(this._time=t=u._startTime,this._totalTime=t+this._cycle*(this._totalDuration+this._repeatDelay))}this._totalTime=this._time=this._rawPrevTime=t}if(this._time!==p&&this._first||i||l||u){if(this._initted||(this._initted=!0),this._active||!this._paused&&this._time!==p&&t>0&&(this._active=!0),0===p&&this.vars.onStart&&(0===this._time&&this._duration||e||this._callback("onStart")),f=this._time,f>=p)for(s=this._first;s&&(a=s._next,f===this._time&&(!this._paused||g));)(s._active||s._startTime<=f&&!s._paused&&!s._gc)&&(u===s&&this.pause(),s._reversed?s.render((s._dirty?s.totalDuration():s._totalDuration)-(t-s._startTime)*s._timeScale,e,i):s.render((t-s._startTime)*s._timeScale,e,i)),s=a;else for(s=this._last;s&&(a=s._prev,f===this._time&&(!this._paused||g));){if(s._active||s._startTime<=p&&!s._paused&&!s._gc){if(u===s){for(u=s._prev;u&&u.endTime()>this._time;)u.render(u._reversed?u.totalDuration()-(t-u._startTime)*u._timeScale:(t-u._startTime)*u._timeScale,e,i),u=u._prev;u=null,this.pause()}s._reversed?s.render((s._dirty?s.totalDuration():s._totalDuration)-(t-s._startTime)*s._timeScale,e,i):s.render((t-s._startTime)*s._timeScale,e,i)}s=a}this._onUpdate&&(e||(h.length&&_(),this._callback("onUpdate"))),o&&(this._gc||(m===this._startTime||d!==this._timeScale)&&(0===this._time||c>=this.totalDuration())&&(n&&(h.length&&_(),this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!e&&this.vars[o]&&this._callback(o)))}},d._hasPausedChild=function(){for(var t=this._first;t;){if(t._paused||t instanceof s&&t._hasPausedChild())return!0;t=t._next}return!1},d.getChildren=function(t,e,s,r){r=r||-9999999999;for(var n=[],a=this._first,o=0;a;)a._startTime<r||(a instanceof i?e!==!1&&(n[o++]=a):(s!==!1&&(n[o++]=a),t!==!1&&(n=n.concat(a.getChildren(!0,e,s)),o=n.length))),a=a._next;return n},d.getTweensOf=function(t,e){var s,r,n=this._gc,a=[],o=0;for(n&&this._enabled(!0,!0),s=i.getTweensOf(t),r=s.length;--r>-1;)(s[r].timeline===this||e&&this._contains(s[r]))&&(a[o++]=s[r]);return n&&this._enabled(!1,!0),a},d.recent=function(){return this._recent},d._contains=function(t){for(var e=t.timeline;e;){if(e===this)return!0;e=e.timeline}return!1},d.shiftChildren=function(t,e,i){i=i||0;for(var s,r=this._first,n=this._labels;r;)r._startTime>=i&&(r._startTime+=t),r=r._next;if(e)for(s in n)n[s]>=i&&(n[s]+=t);return this._uncache(!0)},d._kill=function(t,e){if(!t&&!e)return this._enabled(!1,!1);for(var i=e?this.getTweensOf(e):this.getChildren(!0,!0,!1),s=i.length,r=!1;--s>-1;)i[s]._kill(t,e)&&(r=!0);return r},d.clear=function(t){var e=this.getChildren(!1,!0,!0),i=e.length;for(this._time=this._totalTime=0;--i>-1;)e[i]._enabled(!1,!1);return t!==!1&&(this._labels={}),this._uncache(!0)},d.invalidate=function(){for(var e=this._first;e;)e.invalidate(),e=e._next;return t.prototype.invalidate.call(this)},d._enabled=function(t,i){if(t===this._gc)for(var s=this._first;s;)s._enabled(t,!0),s=s._next;return e.prototype._enabled.call(this,t,i)},d.totalTime=function(){this._forcingPlayhead=!0;var e=t.prototype.totalTime.apply(this,arguments);return this._forcingPlayhead=!1,e},d.duration=function(t){return arguments.length?(0!==this.duration()&&0!==t&&this.timeScale(this._duration/t),this):(this._dirty&&this.totalDuration(),this._duration)},d.totalDuration=function(t){if(!arguments.length){if(this._dirty){for(var e,i,s=0,r=this._last,n=999999999999;r;)e=r._prev,r._dirty&&r.totalDuration(),r._startTime>n&&this._sortChildren&&!r._paused?this.add(r,r._startTime-r._delay):n=r._startTime,r._startTime<0&&!r._paused&&(s-=r._startTime,this._timeline.smoothChildTiming&&(this._startTime+=r._startTime/this._timeScale),this.shiftChildren(-r._startTime,!1,-9999999999),n=0),i=r._startTime+r._totalDuration/r._timeScale,i>s&&(s=i),r=e;this._duration=this._totalDuration=s,this._dirty=!1}return this._totalDuration}return t&&this.totalDuration()?this.timeScale(this._totalDuration/t):this},d.paused=function(e){if(!e)for(var i=this._first,s=this._time;i;)i._startTime===s&&"isPause"===i.data&&(i._rawPrevTime=0),i=i._next;return t.prototype.paused.apply(this,arguments)},d.usesFrames=function(){for(var e=this._timeline;e._timeline;)e=e._timeline;return e===t._rootFramesTimeline},d.rawTime=function(){return this._paused?this._totalTime:(this._timeline.rawTime()-this._startTime)*this._timeScale},s},!0),_gsScope._gsDefine("TimelineMax",["TimelineLite","TweenLite","easing.Ease"],function(t,e,i){var s=function(e){t.call(this,e),this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._cycle=0,this._yoyo=this.vars.yoyo===!0,this._dirty=!0},r=1e-10,n=e._internals,a=n.lazyTweens,o=n.lazyRender,l=_gsScope._gsDefine.globals,h=new i(null,null,1,0),_=s.prototype=new t;return _.constructor=s,_.kill()._gc=!1,s.version="1.19.0",_.invalidate=function(){return this._yoyo=this.vars.yoyo===!0,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._uncache(!0),t.prototype.invalidate.call(this)},_.addCallback=function(t,i,s,r){return this.add(e.delayedCall(0,t,s,r),i)},_.removeCallback=function(t,e){if(t)if(null==e)this._kill(null,t);else for(var i=this.getTweensOf(t,!1),s=i.length,r=this._parseTimeOrLabel(e);--s>-1;)i[s]._startTime===r&&i[s]._enabled(!1,!1);return this},_.removePause=function(e){return this.removeCallback(t._internals.pauseCallback,e)},_.tweenTo=function(t,i){i=i||{};var s,r,n,a={ease:h,useFrames:this.usesFrames(),immediateRender:!1},o=i.repeat&&l.TweenMax||e;for(r in i)a[r]=i[r];return a.time=this._parseTimeOrLabel(t),s=Math.abs(Number(a.time)-this._time)/this._timeScale||.001,n=new o(this,s,a),a.onStart=function(){n.target.paused(!0),n.vars.time!==n.target.time()&&s===n.duration()&&n.duration(Math.abs(n.vars.time-n.target.time())/n.target._timeScale),i.onStart&&n._callback("onStart")},n},_.tweenFromTo=function(t,e,i){i=i||{},t=this._parseTimeOrLabel(t),i.startAt={onComplete:this.seek,onCompleteParams:[t],callbackScope:this},i.immediateRender=i.immediateRender!==!1;var s=this.tweenTo(e,i);return s.duration(Math.abs(s.vars.time-t)/this._timeScale||.001)},_.render=function(t,e,i){this._gc&&this._enabled(!0,!1);var s,n,l,h,_,u,f,c,p=this._dirty?this.totalDuration():this._totalDuration,m=this._duration,d=this._time,g=this._totalTime,v=this._startTime,y=this._timeScale,T=this._rawPrevTime,x=this._paused,w=this._cycle;if(t>=p-1e-7)this._locked||(this._totalTime=p,this._cycle=this._repeat),this._reversed||this._hasPausedChild()||(n=!0,h="onComplete",_=!!this._timeline.autoRemoveChildren,0===this._duration&&(0>=t&&t>=-1e-7||0>T||T===r)&&T!==t&&this._first&&(_=!0,T>r&&(h="onReverseComplete"))),this._rawPrevTime=this._duration||!e||t||this._rawPrevTime===t?t:r,this._yoyo&&0!==(1&this._cycle)?this._time=t=0:(this._time=m,t=m+1e-4);else if(1e-7>t)if(this._locked||(this._totalTime=this._cycle=0),this._time=0,(0!==d||0===m&&T!==r&&(T>0||0>t&&T>=0)&&!this._locked)&&(h="onReverseComplete",n=this._reversed),0>t)this._active=!1,this._timeline.autoRemoveChildren&&this._reversed?(_=n=!0,h="onReverseComplete"):T>=0&&this._first&&(_=!0),this._rawPrevTime=t;else{if(this._rawPrevTime=m||!e||t||this._rawPrevTime===t?t:r,0===t&&n)for(s=this._first;s&&0===s._startTime;)s._duration||(n=!1),s=s._next;t=0,this._initted||(_=!0)}else if(0===m&&0>T&&(_=!0),this._time=this._rawPrevTime=t,this._locked||(this._totalTime=t,0!==this._repeat&&(u=m+this._repeatDelay,this._cycle=this._totalTime/u>>0,0!==this._cycle&&this._cycle===this._totalTime/u&&t>=g&&this._cycle--,this._time=this._totalTime-this._cycle*u,this._yoyo&&0!==(1&this._cycle)&&(this._time=m-this._time),this._time>m?(this._time=m,t=m+1e-4):this._time<0?this._time=t=0:t=this._time)),this._hasPause&&!this._forcingPlayhead&&!e){if(t=this._time,t>=d)for(s=this._first;s&&s._startTime<=t&&!f;)s._duration||"isPause"!==s.data||s.ratio||0===s._startTime&&0===this._rawPrevTime||(f=s),s=s._next;else for(s=this._last;s&&s._startTime>=t&&!f;)s._duration||"isPause"===s.data&&s._rawPrevTime>0&&(f=s),s=s._prev;f&&(this._time=t=f._startTime,this._totalTime=t+this._cycle*(this._totalDuration+this._repeatDelay))}if(this._cycle!==w&&!this._locked){var b=this._yoyo&&0!==(1&w),P=b===(this._yoyo&&0!==(1&this._cycle)),O=this._totalTime,k=this._cycle,S=this._rawPrevTime,R=this._time;if(this._totalTime=w*m,this._cycle<w?b=!b:this._totalTime+=m,this._time=d,this._rawPrevTime=0===m?T-1e-4:T,this._cycle=w,this._locked=!0,d=b?0:m,this.render(d,e,0===m),e||this._gc||this.vars.onRepeat&&this._callback("onRepeat"),d!==this._time)return;if(P&&(d=b?m+1e-4:-1e-4,this.render(d,!0,!1)),this._locked=!1,this._paused&&!x)return;this._time=R,this._totalTime=O,this._cycle=k,this._rawPrevTime=S}if(!(this._time!==d&&this._first||i||_||f))return void(g!==this._totalTime&&this._onUpdate&&(e||this._callback("onUpdate")));if(this._initted||(this._initted=!0),this._active||!this._paused&&this._totalTime!==g&&t>0&&(this._active=!0),0===g&&this.vars.onStart&&(0===this._totalTime&&this._totalDuration||e||this._callback("onStart")),c=this._time,c>=d)for(s=this._first;s&&(l=s._next,c===this._time&&(!this._paused||x));)(s._active||s._startTime<=this._time&&!s._paused&&!s._gc)&&(f===s&&this.pause(),s._reversed?s.render((s._dirty?s.totalDuration():s._totalDuration)-(t-s._startTime)*s._timeScale,e,i):s.render((t-s._startTime)*s._timeScale,e,i)),s=l;else for(s=this._last;s&&(l=s._prev,c===this._time&&(!this._paused||x));){if(s._active||s._startTime<=d&&!s._paused&&!s._gc){if(f===s){for(f=s._prev;f&&f.endTime()>this._time;)f.render(f._reversed?f.totalDuration()-(t-f._startTime)*f._timeScale:(t-f._startTime)*f._timeScale,e,i),f=f._prev;f=null,this.pause()}s._reversed?s.render((s._dirty?s.totalDuration():s._totalDuration)-(t-s._startTime)*s._timeScale,e,i):s.render((t-s._startTime)*s._timeScale,e,i)}s=l}this._onUpdate&&(e||(a.length&&o(),this._callback("onUpdate"))),h&&(this._locked||this._gc||(v===this._startTime||y!==this._timeScale)&&(0===this._time||p>=this.totalDuration())&&(n&&(a.length&&o(),this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!e&&this.vars[h]&&this._callback(h)))},_.getActive=function(t,e,i){null==t&&(t=!0),null==e&&(e=!0),null==i&&(i=!1);var s,r,n=[],a=this.getChildren(t,e,i),o=0,l=a.length;for(s=0;l>s;s++)r=a[s],r.isActive()&&(n[o++]=r);return n},_.getLabelAfter=function(t){t||0!==t&&(t=this._time);var e,i=this.getLabelsArray(),s=i.length;for(e=0;s>e;e++)if(i[e].time>t)return i[e].name;return null},_.getLabelBefore=function(t){null==t&&(t=this._time);for(var e=this.getLabelsArray(),i=e.length;--i>-1;)if(e[i].time<t)return e[i].name;return null},_.getLabelsArray=function(){var t,e=[],i=0;for(t in this._labels)e[i++]={time:this._labels[t],name:t};return e.sort(function(t,e){return t.time-e.time}),e},_.progress=function(t,e){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&0!==(1&this._cycle)?1-t:t)+this._cycle*(this._duration+this._repeatDelay),e):this._time/this.duration()},_.totalProgress=function(t,e){return arguments.length?this.totalTime(this.totalDuration()*t,e):this._totalTime/this.totalDuration()},_.totalDuration=function(e){return arguments.length?-1!==this._repeat&&e?this.timeScale(this.totalDuration()/e):this:(this._dirty&&(t.prototype.totalDuration.call(this),this._totalDuration=-1===this._repeat?999999999999:this._duration*(this._repeat+1)+this._repeatDelay*this._repeat),this._totalDuration)},_.time=function(t,e){return arguments.length?(this._dirty&&this.totalDuration(),t>this._duration&&(t=this._duration),this._yoyo&&0!==(1&this._cycle)?t=this._duration-t+this._cycle*(this._duration+this._repeatDelay):0!==this._repeat&&(t+=this._cycle*(this._duration+this._repeatDelay)),this.totalTime(t,e)):this._time},_.repeat=function(t){return arguments.length?(this._repeat=t,this._uncache(!0)):this._repeat},_.repeatDelay=function(t){return arguments.length?(this._repeatDelay=t,this._uncache(!0)):this._repeatDelay},_.yoyo=function(t){return arguments.length?(this._yoyo=t,this):this._yoyo},_.currentLabel=function(t){return arguments.length?this.seek(t,!0):this.getLabelBefore(this._time+1e-8)},s},!0),function(){var t=180/Math.PI,e=[],i=[],s=[],r={},n=_gsScope._gsDefine.globals,a=function(t,e,i,s){i===s&&(i=s-(s-e)/1e6),t===e&&(e=t+(i-t)/1e6),this.a=t,this.b=e,this.c=i,this.d=s,this.da=s-t,this.ca=i-t,this.ba=e-t},o=",x,y,z,left,top,right,bottom,marginTop,marginLeft,marginRight,marginBottom,paddingLeft,paddingTop,paddingRight,paddingBottom,backgroundPosition,backgroundPosition_y,",l=function(t,e,i,s){var r={a:t},n={},a={},o={c:s},l=(t+e)/2,h=(e+i)/2,_=(i+s)/2,u=(l+h)/2,f=(h+_)/2,c=(f-u)/8;return r.b=l+(t-l)/4,n.b=u+c,r.c=n.a=(r.b+n.b)/2,n.c=a.a=(u+f)/2,a.b=f-c,o.b=_+(s-_)/4,a.c=o.a=(a.b+o.b)/2,[r,n,a,o]},h=function(t,r,n,a,o){var h,_,u,f,c,p,m,d,g,v,y,T,x,w=t.length-1,b=0,P=t[0].a;for(h=0;w>h;h++)c=t[b],_=c.a,u=c.d,f=t[b+1].d,o?(y=e[h],T=i[h],x=(T+y)*r*.25/(a?.5:s[h]||.5),p=u-(u-_)*(a?.5*r:0!==y?x/y:0),m=u+(f-u)*(a?.5*r:0!==T?x/T:0),d=u-(p+((m-p)*(3*y/(y+T)+.5)/4||0))):(p=u-(u-_)*r*.5,m=u+(f-u)*r*.5,d=u-(p+m)/2),p+=d,m+=d,c.c=g=p,c.b=0!==h?P:P=c.a+.6*(c.c-c.a),c.da=u-_,c.ca=g-_,c.ba=P-_,n?(v=l(_,P,g,u),t.splice(b,1,v[0],v[1],v[2],v[3]),b+=4):b++,P=m;c=t[b],c.b=P,c.c=P+.4*(c.d-P),c.da=c.d-c.a,c.ca=c.c-c.a,c.ba=P-c.a,n&&(v=l(c.a,P,c.c,c.d),t.splice(b,1,v[0],v[1],v[2],v[3]))},_=function(t,s,r,n){var o,l,h,_,u,f,c=[];if(n)for(t=[n].concat(t),l=t.length;--l>-1;)"string"==typeof(f=t[l][s])&&"="===f.charAt(1)&&(t[l][s]=n[s]+Number(f.charAt(0)+f.substr(2)));if(o=t.length-2,0>o)return c[0]=new a(t[0][s],0,0,t[-1>o?0:1][s]),c;for(l=0;o>l;l++)h=t[l][s],_=t[l+1][s],c[l]=new a(h,0,0,_),r&&(u=t[l+2][s],e[l]=(e[l]||0)+(_-h)*(_-h),i[l]=(i[l]||0)+(u-_)*(u-_));return c[l]=new a(t[l][s],0,0,t[l+1][s]),c},u=function(t,n,a,l,u,f){var c,p,m,d,g,v,y,T,x={},w=[],b=f||t[0];u="string"==typeof u?","+u+",":o,null==n&&(n=1);for(p in t[0])w.push(p);if(t.length>1){for(T=t[t.length-1],y=!0,c=w.length;--c>-1;)if(p=w[c],Math.abs(b[p]-T[p])>.05){y=!1;break}y&&(t=t.concat(),f&&t.unshift(f),t.push(t[1]),f=t[t.length-3])}for(e.length=i.length=s.length=0,c=w.length;--c>-1;)p=w[c],r[p]=-1!==u.indexOf(","+p+","),x[p]=_(t,p,r[p],f);for(c=e.length;--c>-1;)e[c]=Math.sqrt(e[c]),i[c]=Math.sqrt(i[c]);if(!l){for(c=w.length;--c>-1;)if(r[p])for(m=x[w[c]],v=m.length-1,d=0;v>d;d++)g=m[d+1].da/i[d]+m[d].da/e[d]||0,s[d]=(s[d]||0)+g*g;for(c=s.length;--c>-1;)s[c]=Math.sqrt(s[c])}for(c=w.length,d=a?4:1;--c>-1;)p=w[c],m=x[p],h(m,n,a,l,r[p]),y&&(m.splice(0,d),m.splice(m.length-d,d));return x},f=function(t,e,i){e=e||"soft";var s,r,n,o,l,h,_,u,f,c,p,m={},d="cubic"===e?3:2,g="soft"===e,v=[];if(g&&i&&(t=[i].concat(t)),null==t||t.length<d+1)throw"invalid Bezier data";for(f in t[0])v.push(f);for(h=v.length;--h>-1;){for(f=v[h],m[f]=l=[],c=0,u=t.length,_=0;u>_;_++)s=null==i?t[_][f]:"string"==typeof(p=t[_][f])&&"="===p.charAt(1)?i[f]+Number(p.charAt(0)+p.substr(2)):Number(p),g&&_>1&&u-1>_&&(l[c++]=(s+l[c-2])/2),l[c++]=s;for(u=c-d+1,c=0,_=0;u>_;_+=d)s=l[_],r=l[_+1],n=l[_+2],o=2===d?0:l[_+3],l[c++]=p=3===d?new a(s,r,n,o):new a(s,(2*r+s)/3,(2*r+n)/3,n);l.length=c}return m},c=function(t,e,i){for(var s,r,n,a,o,l,h,_,u,f,c,p=1/i,m=t.length;--m>-1;)for(f=t[m],n=f.a,a=f.d-n,o=f.c-n,l=f.b-n,s=r=0,_=1;i>=_;_++)h=p*_,u=1-h,s=r-(r=(h*h*a+3*u*(h*o+u*l))*h),c=m*i+_-1,e[c]=(e[c]||0)+s*s},p=function(t,e){e=e>>0||6;var i,s,r,n,a=[],o=[],l=0,h=0,_=e-1,u=[],f=[];for(i in t)c(t[i],a,e);for(r=a.length,s=0;r>s;s++)l+=Math.sqrt(a[s]),n=s%e,f[n]=l,n===_&&(h+=l,n=s/e>>0,u[n]=f,o[n]=h,l=0,f=[]);return{length:h,lengths:o,segments:u}},m=_gsScope._gsDefine.plugin({propName:"bezier",priority:-1,version:"1.3.7",API:2,global:!0,init:function(t,e,i){this._target=t,e instanceof Array&&(e={values:e}),this._func={},this._mod={},this._props=[],this._timeRes=null==e.timeResolution?6:parseInt(e.timeResolution,10);
var s,r,n,a,o,l=e.values||[],h={},_=l[0],c=e.autoRotate||i.vars.orientToBezier;this._autoRotate=c?c instanceof Array?c:[["x","y","rotation",c===!0?0:Number(c)||0]]:null;for(s in _)this._props.push(s);for(n=this._props.length;--n>-1;)s=this._props[n],this._overwriteProps.push(s),r=this._func[s]="function"==typeof t[s],h[s]=r?t[s.indexOf("set")||"function"!=typeof t["get"+s.substr(3)]?s:"get"+s.substr(3)]():parseFloat(t[s]),o||h[s]!==l[0][s]&&(o=h);if(this._beziers="cubic"!==e.type&&"quadratic"!==e.type&&"soft"!==e.type?u(l,isNaN(e.curviness)?1:e.curviness,!1,"thruBasic"===e.type,e.correlate,o):f(l,e.type,h),this._segCount=this._beziers[s].length,this._timeRes){var m=p(this._beziers,this._timeRes);this._length=m.length,this._lengths=m.lengths,this._segments=m.segments,this._l1=this._li=this._s1=this._si=0,this._l2=this._lengths[0],this._curSeg=this._segments[0],this._s2=this._curSeg[0],this._prec=1/this._curSeg.length}if(c=this._autoRotate)for(this._initialRotations=[],c[0]instanceof Array||(this._autoRotate=c=[c]),n=c.length;--n>-1;){for(a=0;3>a;a++)s=c[n][a],this._func[s]="function"==typeof t[s]?t[s.indexOf("set")||"function"!=typeof t["get"+s.substr(3)]?s:"get"+s.substr(3)]:!1;s=c[n][2],this._initialRotations[n]=(this._func[s]?this._func[s].call(this._target):this._target[s])||0,this._overwriteProps.push(s)}return this._startRatio=i.vars.runBackwards?1:0,!0},set:function(e){var i,s,r,n,a,o,l,h,_,u,f=this._segCount,c=this._func,p=this._target,m=e!==this._startRatio;if(this._timeRes){if(_=this._lengths,u=this._curSeg,e*=this._length,r=this._li,e>this._l2&&f-1>r){for(h=f-1;h>r&&(this._l2=_[++r])<=e;);this._l1=_[r-1],this._li=r,this._curSeg=u=this._segments[r],this._s2=u[this._s1=this._si=0]}else if(e<this._l1&&r>0){for(;r>0&&(this._l1=_[--r])>=e;);0===r&&e<this._l1?this._l1=0:r++,this._l2=_[r],this._li=r,this._curSeg=u=this._segments[r],this._s1=u[(this._si=u.length-1)-1]||0,this._s2=u[this._si]}if(i=r,e-=this._l1,r=this._si,e>this._s2&&r<u.length-1){for(h=u.length-1;h>r&&(this._s2=u[++r])<=e;);this._s1=u[r-1],this._si=r}else if(e<this._s1&&r>0){for(;r>0&&(this._s1=u[--r])>=e;);0===r&&e<this._s1?this._s1=0:r++,this._s2=u[r],this._si=r}o=(r+(e-this._s1)/(this._s2-this._s1))*this._prec||0}else i=0>e?0:e>=1?f-1:f*e>>0,o=(e-i*(1/f))*f;for(s=1-o,r=this._props.length;--r>-1;)n=this._props[r],a=this._beziers[n][i],l=(o*o*a.da+3*s*(o*a.ca+s*a.ba))*o+a.a,this._mod[n]&&(l=this._mod[n](l,p)),c[n]?p[n](l):p[n]=l;if(this._autoRotate){var d,g,v,y,T,x,w,b=this._autoRotate;for(r=b.length;--r>-1;)n=b[r][2],x=b[r][3]||0,w=b[r][4]===!0?1:t,a=this._beziers[b[r][0]],d=this._beziers[b[r][1]],a&&d&&(a=a[i],d=d[i],g=a.a+(a.b-a.a)*o,y=a.b+(a.c-a.b)*o,g+=(y-g)*o,y+=(a.c+(a.d-a.c)*o-y)*o,v=d.a+(d.b-d.a)*o,T=d.b+(d.c-d.b)*o,v+=(T-v)*o,T+=(d.c+(d.d-d.c)*o-T)*o,l=m?Math.atan2(T-v,y-g)*w+x:this._initialRotations[r],this._mod[n]&&(l=this._mod[n](l,p)),c[n]?p[n](l):p[n]=l)}}}),d=m.prototype;m.bezierThrough=u,m.cubicToQuadratic=l,m._autoCSS=!0,m.quadraticToCubic=function(t,e,i){return new a(t,(2*e+t)/3,(2*e+i)/3,i)},m._cssRegister=function(){var t=n.CSSPlugin;if(t){var e=t._internals,i=e._parseToProxy,s=e._setPluginRatio,r=e.CSSPropTween;e._registerComplexSpecialProp("bezier",{parser:function(t,e,n,a,o,l){e instanceof Array&&(e={values:e}),l=new m;var h,_,u,f=e.values,c=f.length-1,p=[],d={};if(0>c)return o;for(h=0;c>=h;h++)u=i(t,f[h],a,o,l,c!==h),p[h]=u.end;for(_ in e)d[_]=e[_];return d.values=p,o=new r(t,"bezier",0,0,u.pt,2),o.data=u,o.plugin=l,o.setRatio=s,0===d.autoRotate&&(d.autoRotate=!0),!d.autoRotate||d.autoRotate instanceof Array||(h=d.autoRotate===!0?0:Number(d.autoRotate),d.autoRotate=null!=u.end.left?[["left","top","rotation",h,!1]]:null!=u.end.x?[["x","y","rotation",h,!1]]:!1),d.autoRotate&&(a._transform||a._enableTransforms(!1),u.autoRotate=a._target._gsTransform,u.proxy.rotation=u.autoRotate.rotation||0,a._overwriteProps.push("rotation")),l._onInitTween(u.proxy,d,a._tween),o}})}},d._mod=function(t){for(var e,i=this._overwriteProps,s=i.length;--s>-1;)e=t[i[s]],e&&"function"==typeof e&&(this._mod[i[s]]=e)},d._kill=function(t){var e,i,s=this._props;for(e in this._beziers)if(e in t)for(delete this._beziers[e],delete this._func[e],i=s.length;--i>-1;)s[i]===e&&s.splice(i,1);if(s=this._autoRotate)for(i=s.length;--i>-1;)t[s[i][2]]&&s.splice(i,1);return this._super._kill.call(this,t)}}(),_gsScope._gsDefine("plugins.CSSPlugin",["plugins.TweenPlugin","TweenLite"],function(t,e){var i,s,r,n,a=function(){t.call(this,"css"),this._overwriteProps.length=0,this.setRatio=a.prototype.setRatio},o=_gsScope._gsDefine.globals,l={},h=a.prototype=new t("css");h.constructor=a,a.version="1.19.0",a.API=2,a.defaultTransformPerspective=0,a.defaultSkewType="compensated",a.defaultSmoothOrigin=!0,h="px",a.suffixMap={top:h,right:h,bottom:h,left:h,width:h,height:h,fontSize:h,padding:h,margin:h,perspective:h,lineHeight:""};var _,u,f,c,p,m,d,g,v=/(?:\-|\.|\b)(\d|\.|e\-)+/g,y=/(?:\d|\-\d|\.\d|\-\.\d|\+=\d|\-=\d|\+=.\d|\-=\.\d)+/g,T=/(?:\+=|\-=|\-|\b)[\d\-\.]+[a-zA-Z0-9]*(?:%|\b)/gi,x=/(?![+-]?\d*\.?\d+|[+-]|e[+-]\d+)[^0-9]/g,w=/(?:\d|\-|\+|=|#|\.)*/g,b=/opacity *= *([^)]*)/i,P=/opacity:([^;]*)/i,O=/alpha\(opacity *=.+?\)/i,k=/^(rgb|hsl)/,S=/([A-Z])/g,R=/-([a-z])/gi,A=/(^(?:url\(\"|url\())|(?:(\"\))$|\)$)/gi,C=function(t,e){return e.toUpperCase()},D=/(?:Left|Right|Width)/i,M=/(M11|M12|M21|M22)=[\d\-\.e]+/gi,F=/progid\:DXImageTransform\.Microsoft\.Matrix\(.+?\)/i,z=/,(?=[^\)]*(?:\(|$))/gi,X=/[\s,\(]/i,I=Math.PI/180,N=180/Math.PI,L={},E=document,Y=function(t){return E.createElementNS?E.createElementNS("http://www.w3.org/1999/xhtml",t):E.createElement(t)},B=Y("div"),j=Y("img"),U=a._internals={_specialProps:l},V=navigator.userAgent,q=function(){var t=V.indexOf("Android"),e=Y("a");return f=-1!==V.indexOf("Safari")&&-1===V.indexOf("Chrome")&&(-1===t||Number(V.substr(t+8,1))>3),p=f&&Number(V.substr(V.indexOf("Version/")+8,1))<6,c=-1!==V.indexOf("Firefox"),(/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(V)||/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(V))&&(m=parseFloat(RegExp.$1)),e?(e.style.cssText="top:1px;opacity:.55;",/^0.55/.test(e.style.opacity)):!1}(),W=function(t){return b.test("string"==typeof t?t:(t.currentStyle?t.currentStyle.filter:t.style.filter)||"")?parseFloat(RegExp.$1)/100:1},Z=function(t){window.console&&console.log(t)},G="",$="",Q=function(t,e){e=e||B;var i,s,r=e.style;if(void 0!==r[t])return t;for(t=t.charAt(0).toUpperCase()+t.substr(1),i=["O","Moz","ms","Ms","Webkit"],s=5;--s>-1&&void 0===r[i[s]+t];);return s>=0?($=3===s?"ms":i[s],G="-"+$.toLowerCase()+"-",$+t):null},H=E.defaultView?E.defaultView.getComputedStyle:function(){},K=a.getStyle=function(t,e,i,s,r){var n;return q||"opacity"!==e?(!s&&t.style[e]?n=t.style[e]:(i=i||H(t))?n=i[e]||i.getPropertyValue(e)||i.getPropertyValue(e.replace(S,"-$1").toLowerCase()):t.currentStyle&&(n=t.currentStyle[e]),null==r||n&&"none"!==n&&"auto"!==n&&"auto auto"!==n?n:r):W(t)},J=U.convertToPixels=function(t,i,s,r,n){if("px"===r||!r)return s;if("auto"===r||!s)return 0;var o,l,h,_=D.test(i),u=t,f=B.style,c=0>s,p=1===s;if(c&&(s=-s),p&&(s*=100),"%"===r&&-1!==i.indexOf("border"))o=s/100*(_?t.clientWidth:t.clientHeight);else{if(f.cssText="border:0 solid red;position:"+K(t,"position")+";line-height:0;","%"!==r&&u.appendChild&&"v"!==r.charAt(0)&&"rem"!==r)f[_?"borderLeftWidth":"borderTopWidth"]=s+r;else{if(u=t.parentNode||E.body,l=u._gsCache,h=e.ticker.frame,l&&_&&l.time===h)return l.width*s/100;f[_?"width":"height"]=s+r}u.appendChild(B),o=parseFloat(B[_?"offsetWidth":"offsetHeight"]),u.removeChild(B),_&&"%"===r&&a.cacheWidths!==!1&&(l=u._gsCache=u._gsCache||{},l.time=h,l.width=o/s*100),0!==o||n||(o=J(t,i,s,r,!0))}return p&&(o/=100),c?-o:o},te=U.calculateOffset=function(t,e,i){if("absolute"!==K(t,"position",i))return 0;var s="left"===e?"Left":"Top",r=K(t,"margin"+s,i);return t["offset"+s]-(J(t,e,parseFloat(r),r.replace(w,""))||0)},ee=function(t,e){var i,s,r,n={};if(e=e||H(t,null))if(i=e.length)for(;--i>-1;)r=e[i],(-1===r.indexOf("-transform")||Re===r)&&(n[r.replace(R,C)]=e.getPropertyValue(r));else for(i in e)(-1===i.indexOf("Transform")||Se===i)&&(n[i]=e[i]);else if(e=t.currentStyle||t.style)for(i in e)"string"==typeof i&&void 0===n[i]&&(n[i.replace(R,C)]=e[i]);return q||(n.opacity=W(t)),s=Be(t,e,!1),n.rotation=s.rotation,n.skewX=s.skewX,n.scaleX=s.scaleX,n.scaleY=s.scaleY,n.x=s.x,n.y=s.y,Ce&&(n.z=s.z,n.rotationX=s.rotationX,n.rotationY=s.rotationY,n.scaleZ=s.scaleZ),n.filters&&delete n.filters,n},ie=function(t,e,i,s,r){var n,a,o,l={},h=t.style;for(a in i)"cssText"!==a&&"length"!==a&&isNaN(a)&&(e[a]!==(n=i[a])||r&&r[a])&&-1===a.indexOf("Origin")&&("number"==typeof n||"string"==typeof n)&&(l[a]="auto"!==n||"left"!==a&&"top"!==a?""!==n&&"auto"!==n&&"none"!==n||"string"!=typeof e[a]||""===e[a].replace(x,"")?n:0:te(t,a),void 0!==h[a]&&(o=new ge(h,a,h[a],o)));if(s)for(a in s)"className"!==a&&(l[a]=s[a]);return{difs:l,firstMPT:o}},se={width:["Left","Right"],height:["Top","Bottom"]},re=["marginLeft","marginRight","marginTop","marginBottom"],ne=function(t,e,i){if("svg"===(t.nodeName+"").toLowerCase())return(i||H(t))[e]||0;if(t.getBBox&&Le(t))return t.getBBox()[e]||0;var s=parseFloat("width"===e?t.offsetWidth:t.offsetHeight),r=se[e],n=r.length;for(i=i||H(t,null);--n>-1;)s-=parseFloat(K(t,"padding"+r[n],i,!0))||0,s-=parseFloat(K(t,"border"+r[n]+"Width",i,!0))||0;return s},ae=function(t,e){if("contain"===t||"auto"===t||"auto auto"===t)return t+" ";(null==t||""===t)&&(t="0 0");var i,s=t.split(" "),r=-1!==t.indexOf("left")?"0%":-1!==t.indexOf("right")?"100%":s[0],n=-1!==t.indexOf("top")?"0%":-1!==t.indexOf("bottom")?"100%":s[1];if(s.length>3&&!e){for(s=t.split(", ").join(",").split(","),t=[],i=0;i<s.length;i++)t.push(ae(s[i]));return t.join(",")}return null==n?n="center"===r?"50%":"0":"center"===n&&(n="50%"),("center"===r||isNaN(parseFloat(r))&&-1===(r+"").indexOf("="))&&(r="50%"),t=r+" "+n+(s.length>2?" "+s[2]:""),e&&(e.oxp=-1!==r.indexOf("%"),e.oyp=-1!==n.indexOf("%"),e.oxr="="===r.charAt(1),e.oyr="="===n.charAt(1),e.ox=parseFloat(r.replace(x,"")),e.oy=parseFloat(n.replace(x,"")),e.v=t),e||t},oe=function(t,e){return"function"==typeof t&&(t=t(g,d)),"string"==typeof t&&"="===t.charAt(1)?parseInt(t.charAt(0)+"1",10)*parseFloat(t.substr(2)):parseFloat(t)-parseFloat(e)||0},le=function(t,e){return"function"==typeof t&&(t=t(g,d)),null==t?e:"string"==typeof t&&"="===t.charAt(1)?parseInt(t.charAt(0)+"1",10)*parseFloat(t.substr(2))+e:parseFloat(t)||0},he=function(t,e,i,s){var r,n,a,o,l,h=1e-6;return"function"==typeof t&&(t=t(g,d)),null==t?o=e:"number"==typeof t?o=t:(r=360,n=t.split("_"),l="="===t.charAt(1),a=(l?parseInt(t.charAt(0)+"1",10)*parseFloat(n[0].substr(2)):parseFloat(n[0]))*(-1===t.indexOf("rad")?1:N)-(l?0:e),n.length&&(s&&(s[i]=e+a),-1!==t.indexOf("short")&&(a%=r,a!==a%(r/2)&&(a=0>a?a+r:a-r)),-1!==t.indexOf("_cw")&&0>a?a=(a+9999999999*r)%r-(a/r|0)*r:-1!==t.indexOf("ccw")&&a>0&&(a=(a-9999999999*r)%r-(a/r|0)*r)),o=e+a),h>o&&o>-h&&(o=0),o},_e={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},ue=function(t,e,i){return t=0>t?t+1:t>1?t-1:t,255*(1>6*t?e+(i-e)*t*6:.5>t?i:2>3*t?e+(i-e)*(2/3-t)*6:e)+.5|0},fe=a.parseColor=function(t,e){var i,s,r,n,a,o,l,h,_,u,f;if(t)if("number"==typeof t)i=[t>>16,t>>8&255,255&t];else{if(","===t.charAt(t.length-1)&&(t=t.substr(0,t.length-1)),_e[t])i=_e[t];else if("#"===t.charAt(0))4===t.length&&(s=t.charAt(1),r=t.charAt(2),n=t.charAt(3),t="#"+s+s+r+r+n+n),t=parseInt(t.substr(1),16),i=[t>>16,t>>8&255,255&t];else if("hsl"===t.substr(0,3))if(i=f=t.match(v),e){if(-1!==t.indexOf("="))return t.match(y)}else a=Number(i[0])%360/360,o=Number(i[1])/100,l=Number(i[2])/100,r=.5>=l?l*(o+1):l+o-l*o,s=2*l-r,i.length>3&&(i[3]=Number(t[3])),i[0]=ue(a+1/3,s,r),i[1]=ue(a,s,r),i[2]=ue(a-1/3,s,r);else i=t.match(v)||_e.transparent;i[0]=Number(i[0]),i[1]=Number(i[1]),i[2]=Number(i[2]),i.length>3&&(i[3]=Number(i[3]))}else i=_e.black;return e&&!f&&(s=i[0]/255,r=i[1]/255,n=i[2]/255,h=Math.max(s,r,n),_=Math.min(s,r,n),l=(h+_)/2,h===_?a=o=0:(u=h-_,o=l>.5?u/(2-h-_):u/(h+_),a=h===s?(r-n)/u+(n>r?6:0):h===r?(n-s)/u+2:(s-r)/u+4,a*=60),i[0]=a+.5|0,i[1]=100*o+.5|0,i[2]=100*l+.5|0),i},ce=function(t,e){var i,s,r,n=t.match(pe)||[],a=0,o=n.length?"":t;for(i=0;i<n.length;i++)s=n[i],r=t.substr(a,t.indexOf(s,a)-a),a+=r.length+s.length,s=fe(s,e),3===s.length&&s.push(1),o+=r+(e?"hsla("+s[0]+","+s[1]+"%,"+s[2]+"%,"+s[3]:"rgba("+s.join(","))+")";return o+t.substr(a)},pe="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3}){1,2}\\b";for(h in _e)pe+="|"+h+"\\b";pe=new RegExp(pe+")","gi"),a.colorStringFilter=function(t){var e,i=t[0]+t[1];pe.test(i)&&(e=-1!==i.indexOf("hsl(")||-1!==i.indexOf("hsla("),t[0]=ce(t[0],e),t[1]=ce(t[1],e)),pe.lastIndex=0},e.defaultStringFilter||(e.defaultStringFilter=a.colorStringFilter);var me=function(t,e,i,s){if(null==t)return function(t){return t};var r,n=e?(t.match(pe)||[""])[0]:"",a=t.split(n).join("").match(T)||[],o=t.substr(0,t.indexOf(a[0])),l=")"===t.charAt(t.length-1)?")":"",h=-1!==t.indexOf(" ")?" ":",",_=a.length,u=_>0?a[0].replace(v,""):"";return _?r=e?function(t){var e,f,c,p;if("number"==typeof t)t+=u;else if(s&&z.test(t)){for(p=t.replace(z,"|").split("|"),c=0;c<p.length;c++)p[c]=r(p[c]);return p.join(",")}if(e=(t.match(pe)||[n])[0],f=t.split(e).join("").match(T)||[],c=f.length,_>c--)for(;++c<_;)f[c]=i?f[(c-1)/2|0]:a[c];return o+f.join(h)+h+e+l+(-1!==t.indexOf("inset")?" inset":"")}:function(t){var e,n,f;if("number"==typeof t)t+=u;else if(s&&z.test(t)){for(n=t.replace(z,"|").split("|"),f=0;f<n.length;f++)n[f]=r(n[f]);return n.join(",")}if(e=t.match(T)||[],f=e.length,_>f--)for(;++f<_;)e[f]=i?e[(f-1)/2|0]:a[f];return o+e.join(h)+l}:function(t){return t}},de=function(t){return t=t.split(","),function(e,i,s,r,n,a,o){var l,h=(i+"").split(" ");for(o={},l=0;4>l;l++)o[t[l]]=h[l]=h[l]||h[(l-1)/2>>0];return r.parse(e,o,n,a)}},ge=(U._setPluginRatio=function(t){this.plugin.setRatio(t);for(var e,i,s,r,n,a=this.data,o=a.proxy,l=a.firstMPT,h=1e-6;l;)e=o[l.v],l.r?e=Math.round(e):h>e&&e>-h&&(e=0),l.t[l.p]=e,l=l._next;if(a.autoRotate&&(a.autoRotate.rotation=a.mod?a.mod(o.rotation,this.t):o.rotation),1===t||0===t)for(l=a.firstMPT,n=1===t?"e":"b";l;){if(i=l.t,i.type){if(1===i.type){for(r=i.xs0+i.s+i.xs1,s=1;s<i.l;s++)r+=i["xn"+s]+i["xs"+(s+1)];i[n]=r}}else i[n]=i.s+i.xs0;l=l._next}},function(t,e,i,s,r){this.t=t,this.p=e,this.v=i,this.r=r,s&&(s._prev=this,this._next=s)}),ve=(U._parseToProxy=function(t,e,i,s,r,n){var a,o,l,h,_,u=s,f={},c={},p=i._transform,m=L;for(i._transform=null,L=e,s=_=i.parse(t,e,s,r),L=m,n&&(i._transform=p,u&&(u._prev=null,u._prev&&(u._prev._next=null)));s&&s!==u;){if(s.type<=1&&(o=s.p,c[o]=s.s+s.c,f[o]=s.s,n||(h=new ge(s,"s",o,h,s.r),s.c=0),1===s.type))for(a=s.l;--a>0;)l="xn"+a,o=s.p+"_"+l,c[o]=s.data[l],f[o]=s[l],n||(h=new ge(s,l,o,h,s.rxp[l]));s=s._next}return{proxy:f,end:c,firstMPT:h,pt:_}},U.CSSPropTween=function(t,e,s,r,a,o,l,h,_,u,f){this.t=t,this.p=e,this.s=s,this.c=r,this.n=l||e,t instanceof ve||n.push(this.n),this.r=h,this.type=o||0,_&&(this.pr=_,i=!0),this.b=void 0===u?s:u,this.e=void 0===f?s+r:f,a&&(this._next=a,a._prev=this)}),ye=function(t,e,i,s,r,n){var a=new ve(t,e,i,s-i,r,-1,n);return a.b=i,a.e=a.xs0=s,a},Te=a.parseComplex=function(t,e,i,s,r,n,o,l,h,u){i=i||n||"","function"==typeof s&&(s=s(g,d)),o=new ve(t,e,0,0,o,u?2:1,null,!1,l,i,s),s+="",r&&pe.test(s+i)&&(s=[i,s],a.colorStringFilter(s),i=s[0],s=s[1]);var f,c,p,m,T,x,w,b,P,O,k,S,R,A=i.split(", ").join(",").split(" "),C=s.split(", ").join(",").split(" "),D=A.length,M=_!==!1;for((-1!==s.indexOf(",")||-1!==i.indexOf(","))&&(A=A.join(" ").replace(z,", ").split(" "),C=C.join(" ").replace(z,", ").split(" "),D=A.length),D!==C.length&&(A=(n||"").split(" "),D=A.length),o.plugin=h,o.setRatio=u,pe.lastIndex=0,f=0;D>f;f++)if(m=A[f],T=C[f],b=parseFloat(m),b||0===b)o.appendXtra("",b,oe(T,b),T.replace(y,""),M&&-1!==T.indexOf("px"),!0);else if(r&&pe.test(m))S=T.indexOf(")")+1,S=")"+(S?T.substr(S):""),R=-1!==T.indexOf("hsl")&&q,m=fe(m,R),T=fe(T,R),P=m.length+T.length>6,P&&!q&&0===T[3]?(o["xs"+o.l]+=o.l?" transparent":"transparent",o.e=o.e.split(C[f]).join("transparent")):(q||(P=!1),R?o.appendXtra(P?"hsla(":"hsl(",m[0],oe(T[0],m[0]),",",!1,!0).appendXtra("",m[1],oe(T[1],m[1]),"%,",!1).appendXtra("",m[2],oe(T[2],m[2]),P?"%,":"%"+S,!1):o.appendXtra(P?"rgba(":"rgb(",m[0],T[0]-m[0],",",!0,!0).appendXtra("",m[1],T[1]-m[1],",",!0).appendXtra("",m[2],T[2]-m[2],P?",":S,!0),P&&(m=m.length<4?1:m[3],o.appendXtra("",m,(T.length<4?1:T[3])-m,S,!1))),pe.lastIndex=0;else if(x=m.match(v)){if(w=T.match(y),!w||w.length!==x.length)return o;for(p=0,c=0;c<x.length;c++)k=x[c],O=m.indexOf(k,p),o.appendXtra(m.substr(p,O-p),Number(k),oe(w[c],k),"",M&&"px"===m.substr(O+k.length,2),0===c),p=O+k.length;o["xs"+o.l]+=m.substr(p)}else o["xs"+o.l]+=o.l||o["xs"+o.l]?" "+T:T;if(-1!==s.indexOf("=")&&o.data){for(S=o.xs0+o.data.s,f=1;f<o.l;f++)S+=o["xs"+f]+o.data["xn"+f];o.e=S+o["xs"+f]}return o.l||(o.type=-1,o.xs0=o.e),o.xfirst||o},xe=9;for(h=ve.prototype,h.l=h.pr=0;--xe>0;)h["xn"+xe]=0,h["xs"+xe]="";h.xs0="",h._next=h._prev=h.xfirst=h.data=h.plugin=h.setRatio=h.rxp=null,h.appendXtra=function(t,e,i,s,r,n){var a=this,o=a.l;return a["xs"+o]+=n&&(o||a["xs"+o])?" "+t:t||"",i||0===o||a.plugin?(a.l++,a.type=a.setRatio?2:1,a["xs"+a.l]=s||"",o>0?(a.data["xn"+o]=e+i,a.rxp["xn"+o]=r,a["xn"+o]=e,a.plugin||(a.xfirst=new ve(a,"xn"+o,e,i,a.xfirst||a,0,a.n,r,a.pr),a.xfirst.xs0=0),a):(a.data={s:e+i},a.rxp={},a.s=e,a.c=i,a.r=r,a)):(a["xs"+o]+=e+(s||""),a)};var we=function(t,e){e=e||{},this.p=e.prefix?Q(t)||t:t,l[t]=l[this.p]=this,this.format=e.formatter||me(e.defaultValue,e.color,e.collapsible,e.multi),e.parser&&(this.parse=e.parser),this.clrs=e.color,this.multi=e.multi,this.keyword=e.keyword,this.dflt=e.defaultValue,this.pr=e.priority||0},be=U._registerComplexSpecialProp=function(t,e,i){"object"!=typeof e&&(e={parser:i});var s,r,n=t.split(","),a=e.defaultValue;for(i=i||[a],s=0;s<n.length;s++)e.prefix=0===s&&e.prefix,e.defaultValue=i[s]||a,r=new we(n[s],e)},Pe=U._registerPluginProp=function(t){if(!l[t]){var e=t.charAt(0).toUpperCase()+t.substr(1)+"Plugin";be(t,{parser:function(t,i,s,r,n,a,h){var _=o.com.greensock.plugins[e];return _?(_._cssRegister(),l[s].parse(t,i,s,r,n,a,h)):(Z("Error: "+e+" js file not loaded."),n)}})}};h=we.prototype,h.parseComplex=function(t,e,i,s,r,n){var a,o,l,h,_,u,f=this.keyword;if(this.multi&&(z.test(i)||z.test(e)?(o=e.replace(z,"|").split("|"),l=i.replace(z,"|").split("|")):f&&(o=[e],l=[i])),l){for(h=l.length>o.length?l.length:o.length,a=0;h>a;a++)e=o[a]=o[a]||this.dflt,i=l[a]=l[a]||this.dflt,f&&(_=e.indexOf(f),u=i.indexOf(f),_!==u&&(-1===u?o[a]=o[a].split(f).join(""):-1===_&&(o[a]+=" "+f)));e=o.join(", "),i=l.join(", ")}return Te(t,this.p,e,i,this.clrs,this.dflt,s,this.pr,r,n)},h.parse=function(t,e,i,s,n,a){return this.parseComplex(t.style,this.format(K(t,this.p,r,!1,this.dflt)),this.format(e),n,a)},a.registerSpecialProp=function(t,e,i){be(t,{parser:function(t,s,r,n,a,o){var l=new ve(t,r,0,0,a,2,r,!1,i);return l.plugin=o,l.setRatio=e(t,s,n._tween,r),l},priority:i})},a.useSVGTransformAttr=f||c;var Oe,ke="scaleX,scaleY,scaleZ,x,y,z,skewX,skewY,rotation,rotationX,rotationY,perspective,xPercent,yPercent".split(","),Se=Q("transform"),Re=G+"transform",Ae=Q("transformOrigin"),Ce=null!==Q("perspective"),De=U.Transform=function(){this.perspective=parseFloat(a.defaultTransformPerspective)||0,this.force3D=a.defaultForce3D!==!1&&Ce?a.defaultForce3D||"auto":!1},Me=window.SVGElement,Fe=function(t,e,i){var s,r=E.createElementNS("http://www.w3.org/2000/svg",t),n=/([a-z])([A-Z])/g;for(s in i)r.setAttributeNS(null,s.replace(n,"$1-$2").toLowerCase(),i[s]);return e.appendChild(r),r},ze=E.documentElement,Xe=function(){var t,e,i,s=m||/Android/i.test(V)&&!window.chrome;return E.createElementNS&&!s&&(t=Fe("svg",ze),e=Fe("rect",t,{width:100,height:50,x:100}),i=e.getBoundingClientRect().width,e.style[Ae]="50% 50%",e.style[Se]="scaleX(0.5)",s=i===e.getBoundingClientRect().width&&!(c&&Ce),ze.removeChild(t)),s}(),Ie=function(t,e,i,s,r,n){var o,l,h,_,u,f,c,p,m,d,g,v,y,T,x=t._gsTransform,w=Ye(t,!0);x&&(y=x.xOrigin,T=x.yOrigin),(!s||(o=s.split(" ")).length<2)&&(c=t.getBBox(),e=ae(e).split(" "),o=[(-1!==e[0].indexOf("%")?parseFloat(e[0])/100*c.width:parseFloat(e[0]))+c.x,(-1!==e[1].indexOf("%")?parseFloat(e[1])/100*c.height:parseFloat(e[1]))+c.y]),i.xOrigin=_=parseFloat(o[0]),i.yOrigin=u=parseFloat(o[1]),s&&w!==Ee&&(f=w[0],c=w[1],p=w[2],m=w[3],d=w[4],g=w[5],v=f*m-c*p,l=_*(m/v)+u*(-p/v)+(p*g-m*d)/v,h=_*(-c/v)+u*(f/v)-(f*g-c*d)/v,_=i.xOrigin=o[0]=l,u=i.yOrigin=o[1]=h),x&&(n&&(i.xOffset=x.xOffset,i.yOffset=x.yOffset,x=i),r||r!==!1&&a.defaultSmoothOrigin!==!1?(l=_-y,h=u-T,x.xOffset+=l*w[0]+h*w[2]-l,x.yOffset+=l*w[1]+h*w[3]-h):x.xOffset=x.yOffset=0),n||t.setAttribute("data-svg-origin",o.join(" "))},Ne=function(t){try{return t.getBBox()}catch(t){}},Le=function(t){return!!(Me&&t.getBBox&&t.getCTM&&Ne(t)&&(!t.parentNode||t.parentNode.getBBox&&t.parentNode.getCTM))},Ee=[1,0,0,1,0,0],Ye=function(t,e){var i,s,r,n,a,o,l=t._gsTransform||new De,h=1e5,_=t.style;if(Se?s=K(t,Re,null,!0):t.currentStyle&&(s=t.currentStyle.filter.match(M),s=s&&4===s.length?[s[0].substr(4),Number(s[2].substr(4)),Number(s[1].substr(4)),s[3].substr(4),l.x||0,l.y||0].join(","):""),i=!s||"none"===s||"matrix(1, 0, 0, 1, 0, 0)"===s,i&&Se&&((o="none"===H(t).display)||!t.parentNode)&&(o&&(n=_.display,_.display="block"),t.parentNode||(a=1,ze.appendChild(t)),s=K(t,Re,null,!0),i=!s||"none"===s||"matrix(1, 0, 0, 1, 0, 0)"===s,n?_.display=n:o&&qe(_,"display"),a&&ze.removeChild(t)),(l.svg||t.getBBox&&Le(t))&&(i&&-1!==(_[Se]+"").indexOf("matrix")&&(s=_[Se],i=0),r=t.getAttribute("transform"),i&&r&&(-1!==r.indexOf("matrix")?(s=r,i=0):-1!==r.indexOf("translate")&&(s="matrix(1,0,0,1,"+r.match(/(?:\-|\b)[\d\-\.e]+\b/gi).join(",")+")",i=0))),i)return Ee;for(r=(s||"").match(v)||[],xe=r.length;--xe>-1;)n=Number(r[xe]),r[xe]=(a=n-(n|=0))?(a*h+(0>a?-.5:.5)|0)/h+n:n;return e&&r.length>6?[r[0],r[1],r[4],r[5],r[12],r[13]]:r},Be=U.getTransform=function(t,i,s,r){if(t._gsTransform&&s&&!r)return t._gsTransform;var n,o,l,h,_,u,f=s?t._gsTransform||new De:new De,c=f.scaleX<0,p=2e-5,m=1e5,d=Ce?parseFloat(K(t,Ae,i,!1,"0 0 0").split(" ")[2])||f.zOrigin||0:0,g=parseFloat(a.defaultTransformPerspective)||0;if(f.svg=!(!t.getBBox||!Le(t)),f.svg&&(Ie(t,K(t,Ae,i,!1,"50% 50%")+"",f,t.getAttribute("data-svg-origin")),Oe=a.useSVGTransformAttr||Xe),n=Ye(t),n!==Ee){if(16===n.length){var v,y,T,x,w,b=n[0],P=n[1],O=n[2],k=n[3],S=n[4],R=n[5],A=n[6],C=n[7],D=n[8],M=n[9],F=n[10],z=n[12],X=n[13],I=n[14],L=n[11],E=Math.atan2(A,F);f.zOrigin&&(I=-f.zOrigin,z=D*I-n[12],X=M*I-n[13],I=F*I+f.zOrigin-n[14]),f.rotationX=E*N,E&&(x=Math.cos(-E),w=Math.sin(-E),v=S*x+D*w,y=R*x+M*w,T=A*x+F*w,D=S*-w+D*x,M=R*-w+M*x,F=A*-w+F*x,L=C*-w+L*x,S=v,R=y,A=T),E=Math.atan2(-O,F),f.rotationY=E*N,E&&(x=Math.cos(-E),w=Math.sin(-E),v=b*x-D*w,y=P*x-M*w,T=O*x-F*w,M=P*w+M*x,F=O*w+F*x,L=k*w+L*x,b=v,P=y,O=T),E=Math.atan2(P,b),f.rotation=E*N,E&&(x=Math.cos(-E),w=Math.sin(-E),b=b*x+S*w,y=P*x+R*w,R=P*-w+R*x,A=O*-w+A*x,P=y),f.rotationX&&Math.abs(f.rotationX)+Math.abs(f.rotation)>359.9&&(f.rotationX=f.rotation=0,f.rotationY=180-f.rotationY),f.scaleX=(Math.sqrt(b*b+P*P)*m+.5|0)/m,f.scaleY=(Math.sqrt(R*R+M*M)*m+.5|0)/m,f.scaleZ=(Math.sqrt(A*A+F*F)*m+.5|0)/m,f.rotationX||f.rotationY?f.skewX=0:(f.skewX=S||R?Math.atan2(S,R)*N+f.rotation:f.skewX||0,Math.abs(f.skewX)>90&&Math.abs(f.skewX)<270&&(c?(f.scaleX*=-1,f.skewX+=f.rotation<=0?180:-180,f.rotation+=f.rotation<=0?180:-180):(f.scaleY*=-1,f.skewX+=f.skewX<=0?180:-180))),f.perspective=L?1/(0>L?-L:L):0,f.x=z,f.y=X,f.z=I,f.svg&&(f.x-=f.xOrigin-(f.xOrigin*b-f.yOrigin*S),f.y-=f.yOrigin-(f.yOrigin*P-f.xOrigin*R))}else if(!Ce||r||!n.length||f.x!==n[4]||f.y!==n[5]||!f.rotationX&&!f.rotationY){var Y=n.length>=6,B=Y?n[0]:1,j=n[1]||0,U=n[2]||0,V=Y?n[3]:1;f.x=n[4]||0,f.y=n[5]||0,l=Math.sqrt(B*B+j*j),h=Math.sqrt(V*V+U*U),_=B||j?Math.atan2(j,B)*N:f.rotation||0,u=U||V?Math.atan2(U,V)*N+_:f.skewX||0,Math.abs(u)>90&&Math.abs(u)<270&&(c?(l*=-1,u+=0>=_?180:-180,_+=0>=_?180:-180):(h*=-1,u+=0>=u?180:-180)),f.scaleX=l,f.scaleY=h,f.rotation=_,f.skewX=u,Ce&&(f.rotationX=f.rotationY=f.z=0,f.perspective=g,f.scaleZ=1),f.svg&&(f.x-=f.xOrigin-(f.xOrigin*B+f.yOrigin*U),f.y-=f.yOrigin-(f.xOrigin*j+f.yOrigin*V))}f.zOrigin=d;for(o in f)f[o]<p&&f[o]>-p&&(f[o]=0)}return s&&(t._gsTransform=f,f.svg&&(Oe&&t.style[Se]?e.delayedCall(.001,function(){qe(t.style,Se)}):!Oe&&t.getAttribute("transform")&&e.delayedCall(.001,function(){t.removeAttribute("transform")}))),f},je=function(t){var e,i,s=this.data,r=-s.rotation*I,n=r+s.skewX*I,a=1e5,o=(Math.cos(r)*s.scaleX*a|0)/a,l=(Math.sin(r)*s.scaleX*a|0)/a,h=(Math.sin(n)*-s.scaleY*a|0)/a,_=(Math.cos(n)*s.scaleY*a|0)/a,u=this.t.style,f=this.t.currentStyle;if(f){i=l,l=-h,h=-i,e=f.filter,u.filter="";var c,p,d=this.t.offsetWidth,g=this.t.offsetHeight,v="absolute"!==f.position,y="progid:DXImageTransform.Microsoft.Matrix(M11="+o+", M12="+l+", M21="+h+", M22="+_,T=s.x+d*s.xPercent/100,x=s.y+g*s.yPercent/100;if(null!=s.ox&&(c=(s.oxp?d*s.ox*.01:s.ox)-d/2,p=(s.oyp?g*s.oy*.01:s.oy)-g/2,T+=c-(c*o+p*l),x+=p-(c*h+p*_)),v?(c=d/2,p=g/2,y+=", Dx="+(c-(c*o+p*l)+T)+", Dy="+(p-(c*h+p*_)+x)+")"):y+=", sizingMethod='auto expand')",u.filter=-1!==e.indexOf("DXImageTransform.Microsoft.Matrix(")?e.replace(F,y):y+" "+e,(0===t||1===t)&&1===o&&0===l&&0===h&&1===_&&(v&&-1===y.indexOf("Dx=0, Dy=0")||b.test(e)&&100!==parseFloat(RegExp.$1)||-1===e.indexOf("gradient("&&e.indexOf("Alpha"))&&u.removeAttribute("filter")),!v){var P,O,k,S=8>m?1:-1;for(c=s.ieOffsetX||0,p=s.ieOffsetY||0,s.ieOffsetX=Math.round((d-((0>o?-o:o)*d+(0>l?-l:l)*g))/2+T),s.ieOffsetY=Math.round((g-((0>_?-_:_)*g+(0>h?-h:h)*d))/2+x),xe=0;4>xe;xe++)O=re[xe],P=f[O],i=-1!==P.indexOf("px")?parseFloat(P):J(this.t,O,parseFloat(P),P.replace(w,""))||0,k=i!==s[O]?2>xe?-s.ieOffsetX:-s.ieOffsetY:2>xe?c-s.ieOffsetX:p-s.ieOffsetY,u[O]=(s[O]=Math.round(i-k*(0===xe||2===xe?1:S)))+"px"}}},Ue=U.set3DTransformRatio=U.setTransformRatio=function(t){var e,i,s,r,n,a,o,l,h,_,u,f,p,m,d,g,v,y,T,x,w,b,P,O=this.data,k=this.t.style,S=O.rotation,R=O.rotationX,A=O.rotationY,C=O.scaleX,D=O.scaleY,M=O.scaleZ,F=O.x,z=O.y,X=O.z,N=O.svg,L=O.perspective,E=O.force3D;if(!(((1!==t&&0!==t||"auto"!==E||this.tween._totalTime!==this.tween._totalDuration&&this.tween._totalTime)&&E||X||L||A||R||1!==M)&&(!Oe||!N)&&Ce))return void(S||O.skewX||N?(S*=I,b=O.skewX*I,P=1e5,e=Math.cos(S)*C,r=Math.sin(S)*C,i=Math.sin(S-b)*-D,n=Math.cos(S-b)*D,b&&"simple"===O.skewType&&(v=Math.tan(b-O.skewY*I),v=Math.sqrt(1+v*v),i*=v,n*=v,O.skewY&&(v=Math.tan(O.skewY*I),v=Math.sqrt(1+v*v),e*=v,r*=v)),N&&(F+=O.xOrigin-(O.xOrigin*e+O.yOrigin*i)+O.xOffset,z+=O.yOrigin-(O.xOrigin*r+O.yOrigin*n)+O.yOffset,Oe&&(O.xPercent||O.yPercent)&&(m=this.t.getBBox(),F+=.01*O.xPercent*m.width,z+=.01*O.yPercent*m.height),m=1e-6,m>F&&F>-m&&(F=0),m>z&&z>-m&&(z=0)),T=(e*P|0)/P+","+(r*P|0)/P+","+(i*P|0)/P+","+(n*P|0)/P+","+F+","+z+")",N&&Oe?this.t.setAttribute("transform","matrix("+T):k[Se]=(O.xPercent||O.yPercent?"translate("+O.xPercent+"%,"+O.yPercent+"%) matrix(":"matrix(")+T):k[Se]=(O.xPercent||O.yPercent?"translate("+O.xPercent+"%,"+O.yPercent+"%) matrix(":"matrix(")+C+",0,0,"+D+","+F+","+z+")");if(c&&(m=1e-4,m>C&&C>-m&&(C=M=2e-5),m>D&&D>-m&&(D=M=2e-5),!L||O.z||O.rotationX||O.rotationY||(L=0)),S||O.skewX)S*=I,d=e=Math.cos(S),g=r=Math.sin(S),O.skewX&&(S-=O.skewX*I,d=Math.cos(S),g=Math.sin(S),"simple"===O.skewType&&(v=Math.tan((O.skewX-O.skewY)*I),v=Math.sqrt(1+v*v),d*=v,g*=v,O.skewY&&(v=Math.tan(O.skewY*I),v=Math.sqrt(1+v*v),e*=v,r*=v))),i=-g,n=d;else{if(!(A||R||1!==M||L||N))return void(k[Se]=(O.xPercent||O.yPercent?"translate("+O.xPercent+"%,"+O.yPercent+"%) translate3d(":"translate3d(")+F+"px,"+z+"px,"+X+"px)"+(1!==C||1!==D?" scale("+C+","+D+")":""));e=n=1,i=r=0}h=1,s=a=o=l=_=u=0,f=L?-1/L:0,p=O.zOrigin,m=1e-6,x=",",w="0",S=A*I,S&&(d=Math.cos(S),g=Math.sin(S),o=-g,_=f*-g,s=e*g,a=r*g,h=d,f*=d,e*=d,r*=d),S=R*I,S&&(d=Math.cos(S),g=Math.sin(S),v=i*d+s*g,y=n*d+a*g,l=h*g,u=f*g,s=i*-g+s*d,a=n*-g+a*d,h*=d,f*=d,i=v,n=y),1!==M&&(s*=M,a*=M,h*=M,f*=M),1!==D&&(i*=D,n*=D,l*=D,u*=D),1!==C&&(e*=C,r*=C,o*=C,_*=C),(p||N)&&(p&&(F+=s*-p,z+=a*-p,X+=h*-p+p),N&&(F+=O.xOrigin-(O.xOrigin*e+O.yOrigin*i)+O.xOffset,z+=O.yOrigin-(O.xOrigin*r+O.yOrigin*n)+O.yOffset),m>F&&F>-m&&(F=w),m>z&&z>-m&&(z=w),m>X&&X>-m&&(X=0)),T=O.xPercent||O.yPercent?"translate("+O.xPercent+"%,"+O.yPercent+"%) matrix3d(":"matrix3d(",T+=(m>e&&e>-m?w:e)+x+(m>r&&r>-m?w:r)+x+(m>o&&o>-m?w:o),T+=x+(m>_&&_>-m?w:_)+x+(m>i&&i>-m?w:i)+x+(m>n&&n>-m?w:n),R||A||1!==M?(T+=x+(m>l&&l>-m?w:l)+x+(m>u&&u>-m?w:u)+x+(m>s&&s>-m?w:s),T+=x+(m>a&&a>-m?w:a)+x+(m>h&&h>-m?w:h)+x+(m>f&&f>-m?w:f)+x):T+=",0,0,0,0,1,0,",T+=F+x+z+x+X+x+(L?1+-X/L:1)+")",k[Se]=T};h=De.prototype,h.x=h.y=h.z=h.skewX=h.skewY=h.rotation=h.rotationX=h.rotationY=h.zOrigin=h.xPercent=h.yPercent=h.xOffset=h.yOffset=0,h.scaleX=h.scaleY=h.scaleZ=1,be("transform,scale,scaleX,scaleY,scaleZ,x,y,z,rotation,rotationX,rotationY,rotationZ,skewX,skewY,shortRotation,shortRotationX,shortRotationY,shortRotationZ,transformOrigin,svgOrigin,transformPerspective,directionalRotation,parseTransform,force3D,skewType,xPercent,yPercent,smoothOrigin",{parser:function(t,e,i,s,n,o,l){if(s._lastParsedTransform===l)return n;s._lastParsedTransform=l;var h;"function"==typeof l[i]&&(h=l[i],l[i]=e);var _,u,f,c,p,m,v,y,T,x=t._gsTransform,w=t.style,b=1e-6,P=ke.length,O=l,k={},S="transformOrigin",R=Be(t,r,!0,O.parseTransform),A=O.transform&&("function"==typeof O.transform?O.transform(g,d):O.transform);if(s._transform=R,A&&"string"==typeof A&&Se)u=B.style,u[Se]=A,u.display="block",u.position="absolute",E.body.appendChild(B),_=Be(B,null,!1),R.svg&&(m=R.xOrigin,v=R.yOrigin,_.x-=R.xOffset,_.y-=R.yOffset,(O.transformOrigin||O.svgOrigin)&&(A={},Ie(t,ae(O.transformOrigin),A,O.svgOrigin,O.smoothOrigin,!0),m=A.xOrigin,v=A.yOrigin,_.x-=A.xOffset-R.xOffset,_.y-=A.yOffset-R.yOffset),(m||v)&&(y=Ye(B,!0),_.x-=m-(m*y[0]+v*y[2]),_.y-=v-(m*y[1]+v*y[3]))),E.body.removeChild(B),_.perspective||(_.perspective=R.perspective),null!=O.xPercent&&(_.xPercent=le(O.xPercent,R.xPercent)),null!=O.yPercent&&(_.yPercent=le(O.yPercent,R.yPercent));else if("object"==typeof O){if(_={scaleX:le(null!=O.scaleX?O.scaleX:O.scale,R.scaleX),scaleY:le(null!=O.scaleY?O.scaleY:O.scale,R.scaleY),scaleZ:le(O.scaleZ,R.scaleZ),x:le(O.x,R.x),y:le(O.y,R.y),z:le(O.z,R.z),xPercent:le(O.xPercent,R.xPercent),yPercent:le(O.yPercent,R.yPercent),perspective:le(O.transformPerspective,R.perspective)},p=O.directionalRotation,null!=p)if("object"==typeof p)for(u in p)O[u]=p[u];else O.rotation=p;"string"==typeof O.x&&-1!==O.x.indexOf("%")&&(_.x=0,_.xPercent=le(O.x,R.xPercent)),"string"==typeof O.y&&-1!==O.y.indexOf("%")&&(_.y=0,_.yPercent=le(O.y,R.yPercent)),_.rotation=he("rotation"in O?O.rotation:"shortRotation"in O?O.shortRotation+"_short":"rotationZ"in O?O.rotationZ:R.rotation-R.skewY,R.rotation-R.skewY,"rotation",k),Ce&&(_.rotationX=he("rotationX"in O?O.rotationX:"shortRotationX"in O?O.shortRotationX+"_short":R.rotationX||0,R.rotationX,"rotationX",k),_.rotationY=he("rotationY"in O?O.rotationY:"shortRotationY"in O?O.shortRotationY+"_short":R.rotationY||0,R.rotationY,"rotationY",k)),_.skewX=he(O.skewX,R.skewX-R.skewY),(_.skewY=he(O.skewY,R.skewY))&&(_.skewX+=_.skewY,_.rotation+=_.skewY)}for(Ce&&null!=O.force3D&&(R.force3D=O.force3D,c=!0),R.skewType=O.skewType||R.skewType||a.defaultSkewType,f=R.force3D||R.z||R.rotationX||R.rotationY||_.z||_.rotationX||_.rotationY||_.perspective,f||null==O.scale||(_.scaleZ=1);--P>-1;)T=ke[P],A=_[T]-R[T],(A>b||-b>A||null!=O[T]||null!=L[T])&&(c=!0,n=new ve(R,T,R[T],A,n),T in k&&(n.e=k[T]),n.xs0=0,n.plugin=o,s._overwriteProps.push(n.n));return A=O.transformOrigin,R.svg&&(A||O.svgOrigin)&&(m=R.xOffset,v=R.yOffset,Ie(t,ae(A),_,O.svgOrigin,O.smoothOrigin),n=ye(R,"xOrigin",(x?R:_).xOrigin,_.xOrigin,n,S),n=ye(R,"yOrigin",(x?R:_).yOrigin,_.yOrigin,n,S),(m!==R.xOffset||v!==R.yOffset)&&(n=ye(R,"xOffset",x?m:R.xOffset,R.xOffset,n,S),n=ye(R,"yOffset",x?v:R.yOffset,R.yOffset,n,S)),A=Oe?null:"0px 0px"),(A||Ce&&f&&R.zOrigin)&&(Se?(c=!0,T=Ae,A=(A||K(t,T,r,!1,"50% 50%"))+"",n=new ve(w,T,0,0,n,-1,S),n.b=w[T],n.plugin=o,Ce?(u=R.zOrigin,A=A.split(" "),R.zOrigin=(A.length>2&&(0===u||"0px"!==A[2])?parseFloat(A[2]):u)||0,n.xs0=n.e=A[0]+" "+(A[1]||"50%")+" 0px",n=new ve(R,"zOrigin",0,0,n,-1,n.n),n.b=u,n.xs0=n.e=R.zOrigin):n.xs0=n.e=A):ae(A+"",R)),c&&(s._transformType=R.svg&&Oe||!f&&3!==this._transformType?2:3),h&&(l[i]=h),n
},prefix:!0}),be("boxShadow",{defaultValue:"0px 0px 0px 0px #999",prefix:!0,color:!0,multi:!0,keyword:"inset"}),be("borderRadius",{defaultValue:"0px",parser:function(t,e,i,n,a){e=this.format(e);var o,l,h,_,u,f,c,p,m,d,g,v,y,T,x,w,b=["borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"],P=t.style;for(m=parseFloat(t.offsetWidth),d=parseFloat(t.offsetHeight),o=e.split(" "),l=0;l<b.length;l++)this.p.indexOf("border")&&(b[l]=Q(b[l])),u=_=K(t,b[l],r,!1,"0px"),-1!==u.indexOf(" ")&&(_=u.split(" "),u=_[0],_=_[1]),f=h=o[l],c=parseFloat(u),v=u.substr((c+"").length),y="="===f.charAt(1),y?(p=parseInt(f.charAt(0)+"1",10),f=f.substr(2),p*=parseFloat(f),g=f.substr((p+"").length-(0>p?1:0))||""):(p=parseFloat(f),g=f.substr((p+"").length)),""===g&&(g=s[i]||v),g!==v&&(T=J(t,"borderLeft",c,v),x=J(t,"borderTop",c,v),"%"===g?(u=T/m*100+"%",_=x/d*100+"%"):"em"===g?(w=J(t,"borderLeft",1,"em"),u=T/w+"em",_=x/w+"em"):(u=T+"px",_=x+"px"),y&&(f=parseFloat(u)+p+g,h=parseFloat(_)+p+g)),a=Te(P,b[l],u+" "+_,f+" "+h,!1,"0px",a);return a},prefix:!0,formatter:me("0px 0px 0px 0px",!1,!0)}),be("borderBottomLeftRadius,borderBottomRightRadius,borderTopLeftRadius,borderTopRightRadius",{defaultValue:"0px",parser:function(t,e,i,s,n){return Te(t.style,i,this.format(K(t,i,r,!1,"0px 0px")),this.format(e),!1,"0px",n)},prefix:!0,formatter:me("0px 0px",!1,!0)}),be("backgroundPosition",{defaultValue:"0 0",parser:function(t,e,i,s,n,a){var o,l,h,_,u,f,c="background-position",p=r||H(t,null),d=this.format((p?m?p.getPropertyValue(c+"-x")+" "+p.getPropertyValue(c+"-y"):p.getPropertyValue(c):t.currentStyle.backgroundPositionX+" "+t.currentStyle.backgroundPositionY)||"0 0"),g=this.format(e);if(-1!==d.indexOf("%")!=(-1!==g.indexOf("%"))&&g.split(",").length<2&&(f=K(t,"backgroundImage").replace(A,""),f&&"none"!==f)){for(o=d.split(" "),l=g.split(" "),j.setAttribute("src",f),h=2;--h>-1;)d=o[h],_=-1!==d.indexOf("%"),_!==(-1!==l[h].indexOf("%"))&&(u=0===h?t.offsetWidth-j.width:t.offsetHeight-j.height,o[h]=_?parseFloat(d)/100*u+"px":parseFloat(d)/u*100+"%");d=o.join(" ")}return this.parseComplex(t.style,d,g,n,a)},formatter:ae}),be("backgroundSize",{defaultValue:"0 0",formatter:function(t){return t+="",ae(-1===t.indexOf(" ")?t+" "+t:t)}}),be("perspective",{defaultValue:"0px",prefix:!0}),be("perspectiveOrigin",{defaultValue:"50% 50%",prefix:!0}),be("transformStyle",{prefix:!0}),be("backfaceVisibility",{prefix:!0}),be("userSelect",{prefix:!0}),be("margin",{parser:de("marginTop,marginRight,marginBottom,marginLeft")}),be("padding",{parser:de("paddingTop,paddingRight,paddingBottom,paddingLeft")}),be("clip",{defaultValue:"rect(0px,0px,0px,0px)",parser:function(t,e,i,s,n,a){var o,l,h;return 9>m?(l=t.currentStyle,h=8>m?" ":",",o="rect("+l.clipTop+h+l.clipRight+h+l.clipBottom+h+l.clipLeft+")",e=this.format(e).split(",").join(h)):(o=this.format(K(t,this.p,r,!1,this.dflt)),e=this.format(e)),this.parseComplex(t.style,o,e,n,a)}}),be("textShadow",{defaultValue:"0px 0px 0px #999",color:!0,multi:!0}),be("autoRound,strictUnits",{parser:function(t,e,i,s,r){return r}}),be("border",{defaultValue:"0px solid #000",parser:function(t,e,i,s,n,a){var o=K(t,"borderTopWidth",r,!1,"0px"),l=this.format(e).split(" "),h=l[0].replace(w,"");return"px"!==h&&(o=parseFloat(o)/J(t,"borderTopWidth",1,h)+h),this.parseComplex(t.style,this.format(o+" "+K(t,"borderTopStyle",r,!1,"solid")+" "+K(t,"borderTopColor",r,!1,"#000")),l.join(" "),n,a)},color:!0,formatter:function(t){var e=t.split(" ");return e[0]+" "+(e[1]||"solid")+" "+(t.match(pe)||["#000"])[0]}}),be("borderWidth",{parser:de("borderTopWidth,borderRightWidth,borderBottomWidth,borderLeftWidth")}),be("float,cssFloat,styleFloat",{parser:function(t,e,i,s,r){var n=t.style,a="cssFloat"in n?"cssFloat":"styleFloat";return new ve(n,a,0,0,r,-1,i,!1,0,n[a],e)}});var Ve=function(t){var e,i=this.t,s=i.filter||K(this.data,"filter")||"",r=this.s+this.c*t|0;100===r&&(-1===s.indexOf("atrix(")&&-1===s.indexOf("radient(")&&-1===s.indexOf("oader(")?(i.removeAttribute("filter"),e=!K(this.data,"filter")):(i.filter=s.replace(O,""),e=!0)),e||(this.xn1&&(i.filter=s=s||"alpha(opacity="+r+")"),-1===s.indexOf("pacity")?0===r&&this.xn1||(i.filter=s+" alpha(opacity="+r+")"):i.filter=s.replace(b,"opacity="+r))};be("opacity,alpha,autoAlpha",{defaultValue:"1",parser:function(t,e,i,s,n,a){var o=parseFloat(K(t,"opacity",r,!1,"1")),l=t.style,h="autoAlpha"===i;return"string"==typeof e&&"="===e.charAt(1)&&(e=("-"===e.charAt(0)?-1:1)*parseFloat(e.substr(2))+o),h&&1===o&&"hidden"===K(t,"visibility",r)&&0!==e&&(o=0),q?n=new ve(l,"opacity",o,e-o,n):(n=new ve(l,"opacity",100*o,100*(e-o),n),n.xn1=h?1:0,l.zoom=1,n.type=2,n.b="alpha(opacity="+n.s+")",n.e="alpha(opacity="+(n.s+n.c)+")",n.data=t,n.plugin=a,n.setRatio=Ve),h&&(n=new ve(l,"visibility",0,0,n,-1,null,!1,0,0!==o?"inherit":"hidden",0===e?"hidden":"inherit"),n.xs0="inherit",s._overwriteProps.push(n.n),s._overwriteProps.push(i)),n}});var qe=function(t,e){e&&(t.removeProperty?(("ms"===e.substr(0,2)||"webkit"===e.substr(0,6))&&(e="-"+e),t.removeProperty(e.replace(S,"-$1").toLowerCase())):t.removeAttribute(e))},We=function(t){if(this.t._gsClassPT=this,1===t||0===t){this.t.setAttribute("class",0===t?this.b:this.e);for(var e=this.data,i=this.t.style;e;)e.v?i[e.p]=e.v:qe(i,e.p),e=e._next;1===t&&this.t._gsClassPT===this&&(this.t._gsClassPT=null)}else this.t.getAttribute("class")!==this.e&&this.t.setAttribute("class",this.e)};be("className",{parser:function(t,e,s,n,a,o,l){var h,_,u,f,c,p=t.getAttribute("class")||"",m=t.style.cssText;if(a=n._classNamePT=new ve(t,s,0,0,a,2),a.setRatio=We,a.pr=-11,i=!0,a.b=p,_=ee(t,r),u=t._gsClassPT){for(f={},c=u.data;c;)f[c.p]=1,c=c._next;u.setRatio(1)}return t._gsClassPT=a,a.e="="!==e.charAt(1)?e:p.replace(new RegExp("(?:\\s|^)"+e.substr(2)+"(?![\\w-])"),"")+("+"===e.charAt(0)?" "+e.substr(2):""),t.setAttribute("class",a.e),h=ie(t,_,ee(t),l,f),t.setAttribute("class",p),a.data=h.firstMPT,t.style.cssText=m,a=a.xfirst=n.parse(t,h.difs,a,o)}});var Ze=function(t){if((1===t||0===t)&&this.data._totalTime===this.data._totalDuration&&"isFromStart"!==this.data.data){var e,i,s,r,n,a=this.t.style,o=l.transform.parse;if("all"===this.e)a.cssText="",r=!0;else for(e=this.e.split(" ").join("").split(","),s=e.length;--s>-1;)i=e[s],l[i]&&(l[i].parse===o?r=!0:i="transformOrigin"===i?Ae:l[i].p),qe(a,i);r&&(qe(a,Se),n=this.t._gsTransform,n&&(n.svg&&(this.t.removeAttribute("data-svg-origin"),this.t.removeAttribute("transform")),delete this.t._gsTransform))}};for(be("clearProps",{parser:function(t,e,s,r,n){return n=new ve(t,s,0,0,n,2),n.setRatio=Ze,n.e=e,n.pr=-10,n.data=r._tween,i=!0,n}}),h="bezier,throwProps,physicsProps,physics2D".split(","),xe=h.length;xe--;)Pe(h[xe]);h=a.prototype,h._firstPT=h._lastParsedTransform=h._transform=null,h._onInitTween=function(t,e,o,h){if(!t.nodeType)return!1;this._target=d=t,this._tween=o,this._vars=e,g=h,_=e.autoRound,i=!1,s=e.suffixMap||a.suffixMap,r=H(t,""),n=this._overwriteProps;var c,m,v,y,T,x,w,b,O,k=t.style;if(u&&""===k.zIndex&&(c=K(t,"zIndex",r),("auto"===c||""===c)&&this._addLazySet(k,"zIndex",0)),"string"==typeof e&&(y=k.cssText,c=ee(t,r),k.cssText=y+";"+e,c=ie(t,c,ee(t)).difs,!q&&P.test(e)&&(c.opacity=parseFloat(RegExp.$1)),e=c,k.cssText=y),this._firstPT=m=e.className?l.className.parse(t,e.className,"className",this,null,null,e):this.parse(t,e,null),this._transformType){for(O=3===this._transformType,Se?f&&(u=!0,""===k.zIndex&&(w=K(t,"zIndex",r),("auto"===w||""===w)&&this._addLazySet(k,"zIndex",0)),p&&this._addLazySet(k,"WebkitBackfaceVisibility",this._vars.WebkitBackfaceVisibility||(O?"visible":"hidden"))):k.zoom=1,v=m;v&&v._next;)v=v._next;b=new ve(t,"transform",0,0,null,2),this._linkCSSP(b,null,v),b.setRatio=Se?Ue:je,b.data=this._transform||Be(t,r,!0),b.tween=o,b.pr=-1,n.pop()}if(i){for(;m;){for(x=m._next,v=y;v&&v.pr>m.pr;)v=v._next;(m._prev=v?v._prev:T)?m._prev._next=m:y=m,(m._next=v)?v._prev=m:T=m,m=x}this._firstPT=y}return!0},h.parse=function(t,e,i,n){var a,o,h,u,f,c,p,m,v,y,T=t.style;for(a in e)c=e[a],"function"==typeof c&&(c=c(g,d)),o=l[a],o?i=o.parse(t,c,a,this,i,n,e):(f=K(t,a,r)+"",v="string"==typeof c,"color"===a||"fill"===a||"stroke"===a||-1!==a.indexOf("Color")||v&&k.test(c)?(v||(c=fe(c),c=(c.length>3?"rgba(":"rgb(")+c.join(",")+")"),i=Te(T,a,f,c,!0,"transparent",i,0,n)):v&&X.test(c)?i=Te(T,a,f,c,!0,null,i,0,n):(h=parseFloat(f),p=h||0===h?f.substr((h+"").length):"",(""===f||"auto"===f)&&("width"===a||"height"===a?(h=ne(t,a,r),p="px"):"left"===a||"top"===a?(h=te(t,a,r),p="px"):(h="opacity"!==a?0:1,p="")),y=v&&"="===c.charAt(1),y?(u=parseInt(c.charAt(0)+"1",10),c=c.substr(2),u*=parseFloat(c),m=c.replace(w,"")):(u=parseFloat(c),m=v?c.replace(w,""):""),""===m&&(m=a in s?s[a]:p),c=u||0===u?(y?u+h:u)+m:e[a],p!==m&&""!==m&&(u||0===u)&&h&&(h=J(t,a,h,p),"%"===m?(h/=J(t,a,100,"%")/100,e.strictUnits!==!0&&(f=h+"%")):"em"===m||"rem"===m||"vw"===m||"vh"===m?h/=J(t,a,1,m):"px"!==m&&(u=J(t,a,u,m),m="px"),y&&(u||0===u)&&(c=u+h+m)),y&&(u+=h),!h&&0!==h||!u&&0!==u?void 0!==T[a]&&(c||c+""!="NaN"&&null!=c)?(i=new ve(T,a,u||h||0,0,i,-1,a,!1,0,f,c),i.xs0="none"!==c||"display"!==a&&-1===a.indexOf("Style")?c:f):Z("invalid "+a+" tween value: "+e[a]):(i=new ve(T,a,h,u-h,i,0,a,_!==!1&&("px"===m||"zIndex"===a),0,f,c),i.xs0=m))),n&&i&&!i.plugin&&(i.plugin=n);return i},h.setRatio=function(t){var e,i,s,r=this._firstPT,n=1e-6;if(1!==t||this._tween._time!==this._tween._duration&&0!==this._tween._time)if(t||this._tween._time!==this._tween._duration&&0!==this._tween._time||this._tween._rawPrevTime===-1e-6)for(;r;){if(e=r.c*t+r.s,r.r?e=Math.round(e):n>e&&e>-n&&(e=0),r.type)if(1===r.type)if(s=r.l,2===s)r.t[r.p]=r.xs0+e+r.xs1+r.xn1+r.xs2;else if(3===s)r.t[r.p]=r.xs0+e+r.xs1+r.xn1+r.xs2+r.xn2+r.xs3;else if(4===s)r.t[r.p]=r.xs0+e+r.xs1+r.xn1+r.xs2+r.xn2+r.xs3+r.xn3+r.xs4;else if(5===s)r.t[r.p]=r.xs0+e+r.xs1+r.xn1+r.xs2+r.xn2+r.xs3+r.xn3+r.xs4+r.xn4+r.xs5;else{for(i=r.xs0+e+r.xs1,s=1;s<r.l;s++)i+=r["xn"+s]+r["xs"+(s+1)];r.t[r.p]=i}else-1===r.type?r.t[r.p]=r.xs0:r.setRatio&&r.setRatio(t);else r.t[r.p]=e+r.xs0;r=r._next}else for(;r;)2!==r.type?r.t[r.p]=r.b:r.setRatio(t),r=r._next;else for(;r;){if(2!==r.type)if(r.r&&-1!==r.type)if(e=Math.round(r.s+r.c),r.type){if(1===r.type){for(s=r.l,i=r.xs0+e+r.xs1,s=1;s<r.l;s++)i+=r["xn"+s]+r["xs"+(s+1)];r.t[r.p]=i}}else r.t[r.p]=e+r.xs0;else r.t[r.p]=r.e;else r.setRatio(t);r=r._next}},h._enableTransforms=function(t){this._transform=this._transform||Be(this._target,r,!0),this._transformType=this._transform.svg&&Oe||!t&&3!==this._transformType?2:3};var Ge=function(){this.t[this.p]=this.e,this.data._linkCSSP(this,this._next,null,!0)};h._addLazySet=function(t,e,i){var s=this._firstPT=new ve(t,e,0,0,this._firstPT,2);s.e=i,s.setRatio=Ge,s.data=this},h._linkCSSP=function(t,e,i,s){return t&&(e&&(e._prev=t),t._next&&(t._next._prev=t._prev),t._prev?t._prev._next=t._next:this._firstPT===t&&(this._firstPT=t._next,s=!0),i?i._next=t:s||null!==this._firstPT||(this._firstPT=t),t._next=e,t._prev=i),t},h._mod=function(t){for(var e=this._firstPT;e;)"function"==typeof t[e.p]&&t[e.p]===Math.round&&(e.r=1),e=e._next},h._kill=function(e){var i,s,r,n=e;if(e.autoAlpha||e.alpha){n={};for(s in e)n[s]=e[s];n.opacity=1,n.autoAlpha&&(n.visibility=1)}for(e.className&&(i=this._classNamePT)&&(r=i.xfirst,r&&r._prev?this._linkCSSP(r._prev,i._next,r._prev._prev):r===this._firstPT&&(this._firstPT=i._next),i._next&&this._linkCSSP(i._next,i._next._next,r._prev),this._classNamePT=null),i=this._firstPT;i;)i.plugin&&i.plugin!==s&&i.plugin._kill&&(i.plugin._kill(e),s=i.plugin),i=i._next;return t.prototype._kill.call(this,n)};var $e=function(t,e,i){var s,r,n,a;if(t.slice)for(r=t.length;--r>-1;)$e(t[r],e,i);else for(s=t.childNodes,r=s.length;--r>-1;)n=s[r],a=n.type,n.style&&(e.push(ee(n)),i&&i.push(n)),1!==a&&9!==a&&11!==a||!n.childNodes.length||$e(n,e,i)};return a.cascadeTo=function(t,i,s){var r,n,a,o,l=e.to(t,i,s),h=[l],_=[],u=[],f=[],c=e._internals.reservedProps;for(t=l._targets||l.target,$e(t,_,f),l.render(i,!0,!0),$e(t,u),l.render(0,!0,!0),l._enabled(!0),r=f.length;--r>-1;)if(n=ie(f[r],_[r],u[r]),n.firstMPT){n=n.difs;for(a in s)c[a]&&(n[a]=s[a]);o={};for(a in n)o[a]=_[r][a];h.push(e.fromTo(f[r],i,o,n))}return h},t.activate([a]),a},!0),function(){var t=_gsScope._gsDefine.plugin({propName:"roundProps",version:"1.6.0",priority:-1,API:2,init:function(t,e,i){return this._tween=i,!0}}),e=function(t){for(;t;)t.f||t.blob||(t.m=Math.round),t=t._next},i=t.prototype;i._onInitAllProps=function(){for(var t,i,s,r=this._tween,n=r.vars.roundProps.join?r.vars.roundProps:r.vars.roundProps.split(","),a=n.length,o={},l=r._propLookup.roundProps;--a>-1;)o[n[a]]=Math.round;for(a=n.length;--a>-1;)for(t=n[a],i=r._firstPT;i;)s=i._next,i.pg?i.t._mod(o):i.n===t&&(2===i.f&&i.t?e(i.t._firstPT):(this._add(i.t,t,i.s,i.c),s&&(s._prev=i._prev),i._prev?i._prev._next=s:r._firstPT===i&&(r._firstPT=s),i._next=i._prev=null,r._propLookup[t]=l)),i=s;return!1},i._add=function(t,e,i,s){this._addTween(t,e,i,i+s,e,Math.round),this._overwriteProps.push(e)}}(),function(){_gsScope._gsDefine.plugin({propName:"attr",API:2,version:"0.6.0",init:function(t,e,i,s){var r,n;if("function"!=typeof t.setAttribute)return!1;for(r in e)n=e[r],"function"==typeof n&&(n=n(s,t)),this._addTween(t,"setAttribute",t.getAttribute(r)+"",n+"",r,!1,r),this._overwriteProps.push(r);return!0}})}(),_gsScope._gsDefine.plugin({propName:"directionalRotation",version:"0.3.0",API:2,init:function(t,e,i,s){"object"!=typeof e&&(e={rotation:e}),this.finals={};var r,n,a,o,l,h,_=e.useRadians===!0?2*Math.PI:360,u=1e-6;for(r in e)"useRadians"!==r&&(o=e[r],"function"==typeof o&&(o=o(s,t)),h=(o+"").split("_"),n=h[0],a=parseFloat("function"!=typeof t[r]?t[r]:t[r.indexOf("set")||"function"!=typeof t["get"+r.substr(3)]?r:"get"+r.substr(3)]()),o=this.finals[r]="string"==typeof n&&"="===n.charAt(1)?a+parseInt(n.charAt(0)+"1",10)*Number(n.substr(2)):Number(n)||0,l=o-a,h.length&&(n=h.join("_"),-1!==n.indexOf("short")&&(l%=_,l!==l%(_/2)&&(l=0>l?l+_:l-_)),-1!==n.indexOf("_cw")&&0>l?l=(l+9999999999*_)%_-(l/_|0)*_:-1!==n.indexOf("ccw")&&l>0&&(l=(l-9999999999*_)%_-(l/_|0)*_)),(l>u||-u>l)&&(this._addTween(t,r,a,a+l,r),this._overwriteProps.push(r)));return!0},set:function(t){var e;if(1!==t)this._super.setRatio.call(this,t);else for(e=this._firstPT;e;)e.f?e.t[e.p](this.finals[e.p]):e.t[e.p]=this.finals[e.p],e=e._next}})._autoCSS=!0,_gsScope._gsDefine("easing.Back",["easing.Ease"],function(t){var e,i,s,r=_gsScope.GreenSockGlobals||_gsScope,n=r.com.greensock,a=2*Math.PI,o=Math.PI/2,l=n._class,h=function(e,i){var s=l("easing."+e,function(){},!0),r=s.prototype=new t;return r.constructor=s,r.getRatio=i,s},_=t.register||function(){},u=function(t,e,i,s){var r=l("easing."+t,{easeOut:new e,easeIn:new i,easeInOut:new s},!0);return _(r,t),r},f=function(t,e,i){this.t=t,this.v=e,i&&(this.next=i,i.prev=this,this.c=i.v-e,this.gap=i.t-t)},c=function(e,i){var s=l("easing."+e,function(t){this._p1=t||0===t?t:1.70158,this._p2=1.525*this._p1},!0),r=s.prototype=new t;return r.constructor=s,r.getRatio=i,r.config=function(t){return new s(t)},s},p=u("Back",c("BackOut",function(t){return(t-=1)*t*((this._p1+1)*t+this._p1)+1}),c("BackIn",function(t){return t*t*((this._p1+1)*t-this._p1)}),c("BackInOut",function(t){return(t*=2)<1?.5*t*t*((this._p2+1)*t-this._p2):.5*((t-=2)*t*((this._p2+1)*t+this._p2)+2)})),m=l("easing.SlowMo",function(t,e,i){e=e||0===e?e:.7,null==t?t=.7:t>1&&(t=1),this._p=1!==t?e:0,this._p1=(1-t)/2,this._p2=t,this._p3=this._p1+this._p2,this._calcEnd=i===!0},!0),d=m.prototype=new t;return d.constructor=m,d.getRatio=function(t){var e=t+(.5-t)*this._p;return t<this._p1?this._calcEnd?1-(t=1-t/this._p1)*t:e-(t=1-t/this._p1)*t*t*t*e:t>this._p3?this._calcEnd?1-(t=(t-this._p3)/this._p1)*t:e+(t-e)*(t=(t-this._p3)/this._p1)*t*t*t:this._calcEnd?1:e},m.ease=new m(.7,.7),d.config=m.config=function(t,e,i){return new m(t,e,i)},e=l("easing.SteppedEase",function(t){t=t||1,this._p1=1/t,this._p2=t+1},!0),d=e.prototype=new t,d.constructor=e,d.getRatio=function(t){return 0>t?t=0:t>=1&&(t=.999999999),(this._p2*t>>0)*this._p1},d.config=e.config=function(t){return new e(t)},i=l("easing.RoughEase",function(e){e=e||{};for(var i,s,r,n,a,o,l=e.taper||"none",h=[],_=0,u=0|(e.points||20),c=u,p=e.randomize!==!1,m=e.clamp===!0,d=e.template instanceof t?e.template:null,g="number"==typeof e.strength?.4*e.strength:.4;--c>-1;)i=p?Math.random():1/u*c,s=d?d.getRatio(i):i,"none"===l?r=g:"out"===l?(n=1-i,r=n*n*g):"in"===l?r=i*i*g:.5>i?(n=2*i,r=n*n*.5*g):(n=2*(1-i),r=n*n*.5*g),p?s+=Math.random()*r-.5*r:c%2?s+=.5*r:s-=.5*r,m&&(s>1?s=1:0>s&&(s=0)),h[_++]={x:i,y:s};for(h.sort(function(t,e){return t.x-e.x}),o=new f(1,1,null),c=u;--c>-1;)a=h[c],o=new f(a.x,a.y,o);this._prev=new f(0,0,0!==o.t?o:o.next)},!0),d=i.prototype=new t,d.constructor=i,d.getRatio=function(t){var e=this._prev;if(t>e.t){for(;e.next&&t>=e.t;)e=e.next;e=e.prev}else for(;e.prev&&t<=e.t;)e=e.prev;return this._prev=e,e.v+(t-e.t)/e.gap*e.c},d.config=function(t){return new i(t)},i.ease=new i,u("Bounce",h("BounceOut",function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}),h("BounceIn",function(t){return(t=1-t)<1/2.75?1-7.5625*t*t:2/2.75>t?1-(7.5625*(t-=1.5/2.75)*t+.75):2.5/2.75>t?1-(7.5625*(t-=2.25/2.75)*t+.9375):1-(7.5625*(t-=2.625/2.75)*t+.984375)}),h("BounceInOut",function(t){var e=.5>t;return t=e?1-2*t:2*t-1,t=1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,e?.5*(1-t):.5*t+.5})),u("Circ",h("CircOut",function(t){return Math.sqrt(1-(t-=1)*t)}),h("CircIn",function(t){return-(Math.sqrt(1-t*t)-1)}),h("CircInOut",function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)})),s=function(e,i,s){var r=l("easing."+e,function(t,e){this._p1=t>=1?t:1,this._p2=(e||s)/(1>t?t:1),this._p3=this._p2/a*(Math.asin(1/this._p1)||0),this._p2=a/this._p2},!0),n=r.prototype=new t;return n.constructor=r,n.getRatio=i,n.config=function(t,e){return new r(t,e)},r},u("Elastic",s("ElasticOut",function(t){return this._p1*Math.pow(2,-10*t)*Math.sin((t-this._p3)*this._p2)+1},.3),s("ElasticIn",function(t){return-(this._p1*Math.pow(2,10*(t-=1))*Math.sin((t-this._p3)*this._p2))},.3),s("ElasticInOut",function(t){return(t*=2)<1?-.5*this._p1*Math.pow(2,10*(t-=1))*Math.sin((t-this._p3)*this._p2):this._p1*Math.pow(2,-10*(t-=1))*Math.sin((t-this._p3)*this._p2)*.5+1},.45)),u("Expo",h("ExpoOut",function(t){return 1-Math.pow(2,-10*t)}),h("ExpoIn",function(t){return Math.pow(2,10*(t-1))-.001}),h("ExpoInOut",function(t){return(t*=2)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*(t-1)))})),u("Sine",h("SineOut",function(t){return Math.sin(t*o)}),h("SineIn",function(t){return-Math.cos(t*o)+1}),h("SineInOut",function(t){return-.5*(Math.cos(Math.PI*t)-1)})),l("easing.EaseLookup",{find:function(e){return t.map[e]}},!0),_(r.SlowMo,"SlowMo","ease,"),_(i,"RoughEase","ease,"),_(e,"SteppedEase","ease,"),p},!0)}),_gsScope._gsDefine&&_gsScope._gsQueue.pop()(),function(t,e){"use strict";var i={},s=t.GreenSockGlobals=t.GreenSockGlobals||t;if(!s.TweenLite){var r,n,a,o,l,h=function(t){var e,i=t.split("."),r=s;for(e=0;e<i.length;e++)r[i[e]]=r=r[i[e]]||{};return r},_=h("com.greensock"),u=1e-10,f=function(t){var e,i=[],s=t.length;for(e=0;e!==s;i.push(t[e++]));return i},c=function(){},p=function(){var t=Object.prototype.toString,e=t.call([]);return function(i){return null!=i&&(i instanceof Array||"object"==typeof i&&!!i.push&&t.call(i)===e)}}(),m={},d=function(r,n,a,o){this.sc=m[r]?m[r].sc:[],m[r]=this,this.gsClass=null,this.func=a;var l=[];this.check=function(_){for(var u,f,c,p,g,v=n.length,y=v;--v>-1;)(u=m[n[v]]||new d(n[v],[])).gsClass?(l[v]=u.gsClass,y--):_&&u.sc.push(this);if(0===y&&a){if(f=("com.greensock."+r).split("."),c=f.pop(),p=h(f.join("."))[c]=this.gsClass=a.apply(a,l),o)if(s[c]=i[c]=p,g="undefined"!=typeof module&&module.exports,!g&&"function"==typeof define&&define.amd)define((t.GreenSockAMDPath?t.GreenSockAMDPath+"/":"")+r.split(".").pop(),[],function(){return p});else if(g)if(r===e){module.exports=i[e]=p;for(v in i)p[v]=i[v]}else i[e]&&(i[e][c]=p);for(v=0;v<this.sc.length;v++)this.sc[v].check()}},this.check(!0)},g=t._gsDefine=function(t,e,i,s){return new d(t,e,i,s)},v=_._class=function(t,e,i){return e=e||function(){},g(t,[],function(){return e},i),e};g.globals=s;var y=[0,0,1,1],T=v("easing.Ease",function(t,e,i,s){this._func=t,this._type=i||0,this._power=s||0,this._params=e?y.concat(e):y},!0),x=T.map={},w=T.register=function(t,e,i,s){for(var r,n,a,o,l=e.split(","),h=l.length,u=(i||"easeIn,easeOut,easeInOut").split(",");--h>-1;)for(n=l[h],r=s?v("easing."+n,null,!0):_.easing[n]||{},a=u.length;--a>-1;)o=u[a],x[n+"."+o]=x[o+n]=r[o]=t.getRatio?t:t[o]||new t};for(a=T.prototype,a._calcEnd=!1,a.getRatio=function(t){if(this._func)return this._params[0]=t,this._func.apply(null,this._params);var e=this._type,i=this._power,s=1===e?1-t:2===e?t:.5>t?2*t:2*(1-t);return 1===i?s*=s:2===i?s*=s*s:3===i?s*=s*s*s:4===i&&(s*=s*s*s*s),1===e?1-s:2===e?s:.5>t?s/2:1-s/2},r=["Linear","Quad","Cubic","Quart","Quint,Strong"],n=r.length;--n>-1;)a=r[n]+",Power"+n,w(new T(null,null,1,n),a,"easeOut",!0),w(new T(null,null,2,n),a,"easeIn"+(0===n?",easeNone":"")),w(new T(null,null,3,n),a,"easeInOut");x.linear=_.easing.Linear.easeIn,x.swing=_.easing.Quad.easeInOut;var b=v("events.EventDispatcher",function(t){this._listeners={},this._eventTarget=t||this});a=b.prototype,a.addEventListener=function(t,e,i,s,r){r=r||0;var n,a,h=this._listeners[t],_=0;for(this!==o||l||o.wake(),null==h&&(this._listeners[t]=h=[]),a=h.length;--a>-1;)n=h[a],n.c===e&&n.s===i?h.splice(a,1):0===_&&n.pr<r&&(_=a+1);h.splice(_,0,{c:e,s:i,up:s,pr:r})},a.removeEventListener=function(t,e){var i,s=this._listeners[t];if(s)for(i=s.length;--i>-1;)if(s[i].c===e)return void s.splice(i,1)},a.dispatchEvent=function(t){var e,i,s,r=this._listeners[t];if(r)for(e=r.length,e>1&&(r=r.slice(0)),i=this._eventTarget;--e>-1;)s=r[e],s&&(s.up?s.c.call(s.s||i,{type:t,target:i}):s.c.call(s.s||i))};var P=t.requestAnimationFrame,O=t.cancelAnimationFrame,k=Date.now||function(){return(new Date).getTime()},S=k();for(r=["ms","moz","webkit","o"],n=r.length;--n>-1&&!P;)P=t[r[n]+"RequestAnimationFrame"],O=t[r[n]+"CancelAnimationFrame"]||t[r[n]+"CancelRequestAnimationFrame"];v("Ticker",function(t,e){var i,s,r,n,a,h=this,_=k(),f=e!==!1&&P?"auto":!1,p=500,m=33,d="tick",g=function(t){var e,o,l=k()-S;l>p&&(_+=l-m),S+=l,h.time=(S-_)/1e3,e=h.time-a,(!i||e>0||t===!0)&&(h.frame++,a+=e+(e>=n?.004:n-e),o=!0),t!==!0&&(r=s(g)),o&&h.dispatchEvent(d)};b.call(h),h.time=h.frame=0,h.tick=function(){g(!0)},h.lagSmoothing=function(t,e){p=t||1/u,m=Math.min(e,p,0)},h.sleep=function(){null!=r&&(f&&O?O(r):clearTimeout(r),s=c,r=null,h===o&&(l=!1))},h.wake=function(t){null!==r?h.sleep():t?_+=-S+(S=k()):h.frame>10&&(S=k()-p+5),s=0===i?c:f&&P?P:function(t){return setTimeout(t,1e3*(a-h.time)+1|0)},h===o&&(l=!0),g(2)},h.fps=function(t){return arguments.length?(i=t,n=1/(i||60),a=this.time+n,void h.wake()):i},h.useRAF=function(t){return arguments.length?(h.sleep(),f=t,void h.fps(i)):f},h.fps(t),setTimeout(function(){"auto"===f&&h.frame<5&&"hidden"!==document.visibilityState&&h.useRAF(!1)},1500)}),a=_.Ticker.prototype=new _.events.EventDispatcher,a.constructor=_.Ticker;var R=v("core.Animation",function(t,e){if(this.vars=e=e||{},this._duration=this._totalDuration=t||0,this._delay=Number(e.delay)||0,this._timeScale=1,this._active=e.immediateRender===!0,this.data=e.data,this._reversed=e.reversed===!0,Z){l||o.wake();var i=this.vars.useFrames?W:Z;i.add(this,i._time),this.vars.paused&&this.paused(!0)}});o=R.ticker=new _.Ticker,a=R.prototype,a._dirty=a._gc=a._initted=a._paused=!1,a._totalTime=a._time=0,a._rawPrevTime=-1,a._next=a._last=a._onUpdate=a._timeline=a.timeline=null,a._paused=!1;var A=function(){l&&k()-S>2e3&&o.wake(),setTimeout(A,2e3)};A(),a.play=function(t,e){return null!=t&&this.seek(t,e),this.reversed(!1).paused(!1)},a.pause=function(t,e){return null!=t&&this.seek(t,e),this.paused(!0)},a.resume=function(t,e){return null!=t&&this.seek(t,e),this.paused(!1)},a.seek=function(t,e){return this.totalTime(Number(t),e!==!1)},a.restart=function(t,e){return this.reversed(!1).paused(!1).totalTime(t?-this._delay:0,e!==!1,!0)},a.reverse=function(t,e){return null!=t&&this.seek(t||this.totalDuration(),e),this.reversed(!0).paused(!1)},a.render=function(){},a.invalidate=function(){return this._time=this._totalTime=0,this._initted=this._gc=!1,this._rawPrevTime=-1,(this._gc||!this.timeline)&&this._enabled(!0),this},a.isActive=function(){var t,e=this._timeline,i=this._startTime;return!e||!this._gc&&!this._paused&&e.isActive()&&(t=e.rawTime())>=i&&t<i+this.totalDuration()/this._timeScale},a._enabled=function(t,e){return l||o.wake(),this._gc=!t,this._active=this.isActive(),e!==!0&&(t&&!this.timeline?this._timeline.add(this,this._startTime-this._delay):!t&&this.timeline&&this._timeline._remove(this,!0)),!1},a._kill=function(){return this._enabled(!1,!1)},a.kill=function(t,e){return this._kill(t,e),this},a._uncache=function(t){for(var e=t?this:this.timeline;e;)e._dirty=!0,e=e.timeline;return this},a._swapSelfInParams=function(t){for(var e=t.length,i=t.concat();--e>-1;)"{self}"===t[e]&&(i[e]=this);return i},a._callback=function(t){var e=this.vars,i=e[t],s=e[t+"Params"],r=e[t+"Scope"]||e.callbackScope||this,n=s?s.length:0;switch(n){case 0:i.call(r);break;case 1:i.call(r,s[0]);break;case 2:i.call(r,s[0],s[1]);break;default:i.apply(r,s)}},a.eventCallback=function(t,e,i,s){if("on"===(t||"").substr(0,2)){var r=this.vars;if(1===arguments.length)return r[t];null==e?delete r[t]:(r[t]=e,r[t+"Params"]=p(i)&&-1!==i.join("").indexOf("{self}")?this._swapSelfInParams(i):i,r[t+"Scope"]=s),"onUpdate"===t&&(this._onUpdate=e)}return this},a.delay=function(t){return arguments.length?(this._timeline.smoothChildTiming&&this.startTime(this._startTime+t-this._delay),this._delay=t,this):this._delay},a.duration=function(t){return arguments.length?(this._duration=this._totalDuration=t,this._uncache(!0),this._timeline.smoothChildTiming&&this._time>0&&this._time<this._duration&&0!==t&&this.totalTime(this._totalTime*(t/this._duration),!0),this):(this._dirty=!1,this._duration)},a.totalDuration=function(t){return this._dirty=!1,arguments.length?this.duration(t):this._totalDuration},a.time=function(t,e){return arguments.length?(this._dirty&&this.totalDuration(),this.totalTime(t>this._duration?this._duration:t,e)):this._time},a.totalTime=function(t,e,i){if(l||o.wake(),!arguments.length)return this._totalTime;if(this._timeline){if(0>t&&!i&&(t+=this.totalDuration()),this._timeline.smoothChildTiming){this._dirty&&this.totalDuration();var s=this._totalDuration,r=this._timeline;if(t>s&&!i&&(t=s),this._startTime=(this._paused?this._pauseTime:r._time)-(this._reversed?s-t:t)/this._timeScale,r._dirty||this._uncache(!1),r._timeline)for(;r._timeline;)r._timeline._time!==(r._startTime+r._totalTime)/r._timeScale&&r.totalTime(r._totalTime,!0),r=r._timeline}this._gc&&this._enabled(!0,!1),(this._totalTime!==t||0===this._duration)&&(z.length&&$(),this.render(t,e,!1),z.length&&$())}return this},a.progress=a.totalProgress=function(t,e){var i=this.duration();return arguments.length?this.totalTime(i*t,e):i?this._time/i:this.ratio},a.startTime=function(t){return arguments.length?(t!==this._startTime&&(this._startTime=t,this.timeline&&this.timeline._sortChildren&&this.timeline.add(this,t-this._delay)),this):this._startTime},a.endTime=function(t){return this._startTime+(0!=t?this.totalDuration():this.duration())/this._timeScale},a.timeScale=function(t){if(!arguments.length)return this._timeScale;if(t=t||u,this._timeline&&this._timeline.smoothChildTiming){var e=this._pauseTime,i=e||0===e?e:this._timeline.totalTime();this._startTime=i-(i-this._startTime)*this._timeScale/t}return this._timeScale=t,this._uncache(!1)},a.reversed=function(t){return arguments.length?(t!=this._reversed&&(this._reversed=t,this.totalTime(this._timeline&&!this._timeline.smoothChildTiming?this.totalDuration()-this._totalTime:this._totalTime,!0)),this):this._reversed},a.paused=function(t){if(!arguments.length)return this._paused;var e,i,s=this._timeline;return t!=this._paused&&s&&(l||t||o.wake(),e=s.rawTime(),i=e-this._pauseTime,!t&&s.smoothChildTiming&&(this._startTime+=i,this._uncache(!1)),this._pauseTime=t?e:null,this._paused=t,this._active=this.isActive(),!t&&0!==i&&this._initted&&this.duration()&&(e=s.smoothChildTiming?this._totalTime:(e-this._startTime)/this._timeScale,this.render(e,e===this._totalTime,!0))),this._gc&&!t&&this._enabled(!0,!1),this};var C=v("core.SimpleTimeline",function(t){R.call(this,0,t),this.autoRemoveChildren=this.smoothChildTiming=!0});a=C.prototype=new R,a.constructor=C,a.kill()._gc=!1,a._first=a._last=a._recent=null,a._sortChildren=!1,a.add=a.insert=function(t,e){var i,s;if(t._startTime=Number(e||0)+t._delay,t._paused&&this!==t._timeline&&(t._pauseTime=t._startTime+(this.rawTime()-t._startTime)/t._timeScale),t.timeline&&t.timeline._remove(t,!0),t.timeline=t._timeline=this,t._gc&&t._enabled(!0,!0),i=this._last,this._sortChildren)for(s=t._startTime;i&&i._startTime>s;)i=i._prev;return i?(t._next=i._next,i._next=t):(t._next=this._first,this._first=t),t._next?t._next._prev=t:this._last=t,t._prev=i,this._recent=t,this._timeline&&this._uncache(!0),this},a._remove=function(t,e){return t.timeline===this&&(e||t._enabled(!1,!0),t._prev?t._prev._next=t._next:this._first===t&&(this._first=t._next),t._next?t._next._prev=t._prev:this._last===t&&(this._last=t._prev),t._next=t._prev=t.timeline=null,t===this._recent&&(this._recent=this._last),this._timeline&&this._uncache(!0)),this},a.render=function(t,e,i){var s,r=this._first;for(this._totalTime=this._time=this._rawPrevTime=t;r;)s=r._next,(r._active||t>=r._startTime&&!r._paused)&&(r._reversed?r.render((r._dirty?r.totalDuration():r._totalDuration)-(t-r._startTime)*r._timeScale,e,i):r.render((t-r._startTime)*r._timeScale,e,i)),r=s},a.rawTime=function(){return l||o.wake(),this._totalTime};var D=v("TweenLite",function(e,i,s){if(R.call(this,i,s),this.render=D.prototype.render,null==e)throw"Cannot tween a null target.";this.target=e="string"!=typeof e?e:D.selector(e)||e;var r,n,a,o=e.jquery||e.length&&e!==t&&e[0]&&(e[0]===t||e[0].nodeType&&e[0].style&&!e.nodeType),l=this.vars.overwrite;if(this._overwrite=l=null==l?q[D.defaultOverwrite]:"number"==typeof l?l>>0:q[l],(o||e instanceof Array||e.push&&p(e))&&"number"!=typeof e[0])for(this._targets=a=f(e),this._propLookup=[],this._siblings=[],r=0;r<a.length;r++)n=a[r],n?"string"!=typeof n?n.length&&n!==t&&n[0]&&(n[0]===t||n[0].nodeType&&n[0].style&&!n.nodeType)?(a.splice(r--,1),this._targets=a=a.concat(f(n))):(this._siblings[r]=Q(n,this,!1),1===l&&this._siblings[r].length>1&&K(n,this,null,1,this._siblings[r])):(n=a[r--]=D.selector(n),"string"==typeof n&&a.splice(r+1,1)):a.splice(r--,1);else this._propLookup={},this._siblings=Q(e,this,!1),1===l&&this._siblings.length>1&&K(e,this,null,1,this._siblings);(this.vars.immediateRender||0===i&&0===this._delay&&this.vars.immediateRender!==!1)&&(this._time=-u,this.render(Math.min(0,-this._delay)))},!0),M=function(e){return e&&e.length&&e!==t&&e[0]&&(e[0]===t||e[0].nodeType&&e[0].style&&!e.nodeType)},F=function(t,e){var i,s={};for(i in t)V[i]||i in e&&"transform"!==i&&"x"!==i&&"y"!==i&&"width"!==i&&"height"!==i&&"className"!==i&&"border"!==i||!(!B[i]||B[i]&&B[i]._autoCSS)||(s[i]=t[i],delete t[i]);t.css=s};a=D.prototype=new R,a.constructor=D,a.kill()._gc=!1,a.ratio=0,a._firstPT=a._targets=a._overwrittenProps=a._startAt=null,a._notifyPluginsOfEnabled=a._lazy=!1,D.version="1.19.0",D.defaultEase=a._ease=new T(null,null,1,1),D.defaultOverwrite="auto",D.ticker=o,D.autoSleep=120,D.lagSmoothing=function(t,e){o.lagSmoothing(t,e)},D.selector=t.$||t.jQuery||function(e){var i=t.$||t.jQuery;return i?(D.selector=i,i(e)):"undefined"==typeof document?e:document.querySelectorAll?document.querySelectorAll(e):document.getElementById("#"===e.charAt(0)?e.substr(1):e)};var z=[],X={},I=/(?:(-|-=|\+=)?\d*\.?\d*(?:e[\-+]?\d+)?)[0-9]/gi,N=function(t){for(var e,i=this._firstPT,s=1e-6;i;)e=i.blob?t?this.join(""):this.start:i.c*t+i.s,i.m?e=i.m(e,this._target||i.t):s>e&&e>-s&&(e=0),i.f?i.fp?i.t[i.p](i.fp,e):i.t[i.p](e):i.t[i.p]=e,i=i._next
},L=function(t,e,i,s){var r,n,a,o,l,h,_,u=[t,e],f=0,c="",p=0;for(u.start=t,i&&(i(u),t=u[0],e=u[1]),u.length=0,r=t.match(I)||[],n=e.match(I)||[],s&&(s._next=null,s.blob=1,u._firstPT=u._applyPT=s),l=n.length,o=0;l>o;o++)_=n[o],h=e.substr(f,e.indexOf(_,f)-f),c+=h||!o?h:",",f+=h.length,p?p=(p+1)%5:"rgba("===h.substr(-5)&&(p=1),_===r[o]||r.length<=o?c+=_:(c&&(u.push(c),c=""),a=parseFloat(r[o]),u.push(a),u._firstPT={_next:u._firstPT,t:u,p:u.length-1,s:a,c:("="===_.charAt(1)?parseInt(_.charAt(0)+"1",10)*parseFloat(_.substr(2)):parseFloat(_)-a)||0,f:0,m:p&&4>p?Math.round:0}),f+=_.length;return c+=e.substr(f),c&&u.push(c),u.setRatio=N,u},E=function(t,e,i,s,r,n,a,o,l){"function"==typeof s&&(s=s(l||0,t));var h,_,u="get"===i?t[e]:i,f=typeof t[e],c="string"==typeof s&&"="===s.charAt(1),p={t:t,p:e,s:u,f:"function"===f,pg:0,n:r||e,m:n?"function"==typeof n?n:Math.round:0,pr:0,c:c?parseInt(s.charAt(0)+"1",10)*parseFloat(s.substr(2)):parseFloat(s)-u||0};return"number"!==f&&("function"===f&&"get"===i&&(_=e.indexOf("set")||"function"!=typeof t["get"+e.substr(3)]?e:"get"+e.substr(3),p.s=u=a?t[_](a):t[_]()),"string"==typeof u&&(a||isNaN(u))?(p.fp=a,h=L(u,s,o||D.defaultStringFilter,p),p={t:h,p:"setRatio",s:0,c:1,f:2,pg:0,n:r||e,pr:0,m:0}):c||(p.s=parseFloat(u),p.c=parseFloat(s)-p.s||0)),p.c?((p._next=this._firstPT)&&(p._next._prev=p),this._firstPT=p,p):void 0},Y=D._internals={isArray:p,isSelector:M,lazyTweens:z,blobDif:L},B=D._plugins={},j=Y.tweenLookup={},U=0,V=Y.reservedProps={ease:1,delay:1,overwrite:1,onComplete:1,onCompleteParams:1,onCompleteScope:1,useFrames:1,runBackwards:1,startAt:1,onUpdate:1,onUpdateParams:1,onUpdateScope:1,onStart:1,onStartParams:1,onStartScope:1,onReverseComplete:1,onReverseCompleteParams:1,onReverseCompleteScope:1,onRepeat:1,onRepeatParams:1,onRepeatScope:1,easeParams:1,yoyo:1,immediateRender:1,repeat:1,repeatDelay:1,data:1,paused:1,reversed:1,autoCSS:1,lazy:1,onOverwrite:1,callbackScope:1,stringFilter:1,id:1},q={none:0,all:1,auto:2,concurrent:3,allOnStart:4,preexisting:5,"true":1,"false":0},W=R._rootFramesTimeline=new C,Z=R._rootTimeline=new C,G=30,$=Y.lazyRender=function(){var t,e=z.length;for(X={};--e>-1;)t=z[e],t&&t._lazy!==!1&&(t.render(t._lazy[0],t._lazy[1],!0),t._lazy=!1);z.length=0};Z._startTime=o.time,W._startTime=o.frame,Z._active=W._active=!0,setTimeout($,1),R._updateRoot=D.render=function(){var t,e,i;if(z.length&&$(),Z.render((o.time-Z._startTime)*Z._timeScale,!1,!1),W.render((o.frame-W._startTime)*W._timeScale,!1,!1),z.length&&$(),o.frame>=G){G=o.frame+(parseInt(D.autoSleep,10)||120);for(i in j){for(e=j[i].tweens,t=e.length;--t>-1;)e[t]._gc&&e.splice(t,1);0===e.length&&delete j[i]}if(i=Z._first,(!i||i._paused)&&D.autoSleep&&!W._first&&1===o._listeners.tick.length){for(;i&&i._paused;)i=i._next;i||o.sleep()}}},o.addEventListener("tick",R._updateRoot);var Q=function(t,e,i){var s,r,n=t._gsTweenID;if(j[n||(t._gsTweenID=n="t"+U++)]||(j[n]={target:t,tweens:[]}),e&&(s=j[n].tweens,s[r=s.length]=e,i))for(;--r>-1;)s[r]===e&&s.splice(r,1);return j[n].tweens},H=function(t,e,i,s){var r,n,a=t.vars.onOverwrite;return a&&(r=a(t,e,i,s)),a=D.onOverwrite,a&&(n=a(t,e,i,s)),r!==!1&&n!==!1},K=function(t,e,i,s,r){var n,a,o,l;if(1===s||s>=4){for(l=r.length,n=0;l>n;n++)if((o=r[n])!==e)o._gc||o._kill(null,t,e)&&(a=!0);else if(5===s)break;return a}var h,_=e._startTime+u,f=[],c=0,p=0===e._duration;for(n=r.length;--n>-1;)(o=r[n])===e||o._gc||o._paused||(o._timeline!==e._timeline?(h=h||J(e,0,p),0===J(o,h,p)&&(f[c++]=o)):o._startTime<=_&&o._startTime+o.totalDuration()/o._timeScale>_&&((p||!o._initted)&&_-o._startTime<=2e-10||(f[c++]=o)));for(n=c;--n>-1;)if(o=f[n],2===s&&o._kill(i,t,e)&&(a=!0),2!==s||!o._firstPT&&o._initted){if(2!==s&&!H(o,e))continue;o._enabled(!1,!1)&&(a=!0)}return a},J=function(t,e,i){for(var s=t._timeline,r=s._timeScale,n=t._startTime;s._timeline;){if(n+=s._startTime,r*=s._timeScale,s._paused)return-100;s=s._timeline}return n/=r,n>e?n-e:i&&n===e||!t._initted&&2*u>n-e?u:(n+=t.totalDuration()/t._timeScale/r)>e+u?0:n-e-u};a._init=function(){var t,e,i,s,r,n,a=this.vars,o=this._overwrittenProps,l=this._duration,h=!!a.immediateRender,_=a.ease;if(a.startAt){this._startAt&&(this._startAt.render(-1,!0),this._startAt.kill()),r={};for(s in a.startAt)r[s]=a.startAt[s];if(r.overwrite=!1,r.immediateRender=!0,r.lazy=h&&a.lazy!==!1,r.startAt=r.delay=null,this._startAt=D.to(this.target,0,r),h)if(this._time>0)this._startAt=null;else if(0!==l)return}else if(a.runBackwards&&0!==l)if(this._startAt)this._startAt.render(-1,!0),this._startAt.kill(),this._startAt=null;else{0!==this._time&&(h=!1),i={};for(s in a)V[s]&&"autoCSS"!==s||(i[s]=a[s]);if(i.overwrite=0,i.data="isFromStart",i.lazy=h&&a.lazy!==!1,i.immediateRender=h,this._startAt=D.to(this.target,0,i),h){if(0===this._time)return}else this._startAt._init(),this._startAt._enabled(!1),this.vars.immediateRender&&(this._startAt=null)}if(this._ease=_=_?_ instanceof T?_:"function"==typeof _?new T(_,a.easeParams):x[_]||D.defaultEase:D.defaultEase,a.easeParams instanceof Array&&_.config&&(this._ease=_.config.apply(_,a.easeParams)),this._easeType=this._ease._type,this._easePower=this._ease._power,this._firstPT=null,this._targets)for(n=this._targets.length,t=0;n>t;t++)this._initProps(this._targets[t],this._propLookup[t]={},this._siblings[t],o?o[t]:null,t)&&(e=!0);else e=this._initProps(this.target,this._propLookup,this._siblings,o,0);if(e&&D._onPluginEvent("_onInitAllProps",this),o&&(this._firstPT||"function"!=typeof this.target&&this._enabled(!1,!1)),a.runBackwards)for(i=this._firstPT;i;)i.s+=i.c,i.c=-i.c,i=i._next;this._onUpdate=a.onUpdate,this._initted=!0},a._initProps=function(e,i,s,r,n){var a,o,l,h,_,u;if(null==e)return!1;X[e._gsTweenID]&&$(),this.vars.css||e.style&&e!==t&&e.nodeType&&B.css&&this.vars.autoCSS!==!1&&F(this.vars,e);for(a in this.vars)if(u=this.vars[a],V[a])u&&(u instanceof Array||u.push&&p(u))&&-1!==u.join("").indexOf("{self}")&&(this.vars[a]=u=this._swapSelfInParams(u,this));else if(B[a]&&(h=new B[a])._onInitTween(e,this.vars[a],this,n)){for(this._firstPT=_={_next:this._firstPT,t:h,p:"setRatio",s:0,c:1,f:1,n:a,pg:1,pr:h._priority,m:0},o=h._overwriteProps.length;--o>-1;)i[h._overwriteProps[o]]=this._firstPT;(h._priority||h._onInitAllProps)&&(l=!0),(h._onDisable||h._onEnable)&&(this._notifyPluginsOfEnabled=!0),_._next&&(_._next._prev=_)}else i[a]=E.call(this,e,a,"get",u,a,0,null,this.vars.stringFilter,n);return r&&this._kill(r,e)?this._initProps(e,i,s,r,n):this._overwrite>1&&this._firstPT&&s.length>1&&K(e,this,i,this._overwrite,s)?(this._kill(i,e),this._initProps(e,i,s,r,n)):(this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration)&&(X[e._gsTweenID]=!0),l)},a.render=function(t,e,i){var s,r,n,a,o=this._time,l=this._duration,h=this._rawPrevTime;if(t>=l-1e-7)this._totalTime=this._time=l,this.ratio=this._ease._calcEnd?this._ease.getRatio(1):1,this._reversed||(s=!0,r="onComplete",i=i||this._timeline.autoRemoveChildren),0===l&&(this._initted||!this.vars.lazy||i)&&(this._startTime===this._timeline._duration&&(t=0),(0>h||0>=t&&t>=-1e-7||h===u&&"isPause"!==this.data)&&h!==t&&(i=!0,h>u&&(r="onReverseComplete")),this._rawPrevTime=a=!e||t||h===t?t:u);else if(1e-7>t)this._totalTime=this._time=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0,(0!==o||0===l&&h>0)&&(r="onReverseComplete",s=this._reversed),0>t&&(this._active=!1,0===l&&(this._initted||!this.vars.lazy||i)&&(h>=0&&(h!==u||"isPause"!==this.data)&&(i=!0),this._rawPrevTime=a=!e||t||h===t?t:u)),this._initted||(i=!0);else if(this._totalTime=this._time=t,this._easeType){var _=t/l,f=this._easeType,c=this._easePower;(1===f||3===f&&_>=.5)&&(_=1-_),3===f&&(_*=2),1===c?_*=_:2===c?_*=_*_:3===c?_*=_*_*_:4===c&&(_*=_*_*_*_),this.ratio=1===f?1-_:2===f?_:.5>t/l?_/2:1-_/2}else this.ratio=this._ease.getRatio(t/l);if(this._time!==o||i){if(!this._initted){if(this._init(),!this._initted||this._gc)return;if(!i&&this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration))return this._time=this._totalTime=o,this._rawPrevTime=h,z.push(this),void(this._lazy=[t,e]);this._time&&!s?this.ratio=this._ease.getRatio(this._time/l):s&&this._ease._calcEnd&&(this.ratio=this._ease.getRatio(0===this._time?0:1))}for(this._lazy!==!1&&(this._lazy=!1),this._active||!this._paused&&this._time!==o&&t>=0&&(this._active=!0),0===o&&(this._startAt&&(t>=0?this._startAt.render(t,e,i):r||(r="_dummyGS")),this.vars.onStart&&(0!==this._time||0===l)&&(e||this._callback("onStart"))),n=this._firstPT;n;)n.f?n.t[n.p](n.c*this.ratio+n.s):n.t[n.p]=n.c*this.ratio+n.s,n=n._next;this._onUpdate&&(0>t&&this._startAt&&t!==-1e-4&&this._startAt.render(t,e,i),e||(this._time!==o||s||i)&&this._callback("onUpdate")),r&&(!this._gc||i)&&(0>t&&this._startAt&&!this._onUpdate&&t!==-1e-4&&this._startAt.render(t,e,i),s&&(this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!e&&this.vars[r]&&this._callback(r),0===l&&this._rawPrevTime===u&&a!==u&&(this._rawPrevTime=0))}},a._kill=function(t,e,i){if("all"===t&&(t=null),null==t&&(null==e||e===this.target))return this._lazy=!1,this._enabled(!1,!1);e="string"!=typeof e?e||this._targets||this.target:D.selector(e)||e;var s,r,n,a,o,l,h,_,u,f=i&&this._time&&i._startTime===this._startTime&&this._timeline===i._timeline;if((p(e)||M(e))&&"number"!=typeof e[0])for(s=e.length;--s>-1;)this._kill(t,e[s],i)&&(l=!0);else{if(this._targets){for(s=this._targets.length;--s>-1;)if(e===this._targets[s]){o=this._propLookup[s]||{},this._overwrittenProps=this._overwrittenProps||[],r=this._overwrittenProps[s]=t?this._overwrittenProps[s]||{}:"all";break}}else{if(e!==this.target)return!1;o=this._propLookup,r=this._overwrittenProps=t?this._overwrittenProps||{}:"all"}if(o){if(h=t||o,_=t!==r&&"all"!==r&&t!==o&&("object"!=typeof t||!t._tempKill),i&&(D.onOverwrite||this.vars.onOverwrite)){for(n in h)o[n]&&(u||(u=[]),u.push(n));if((u||!t)&&!H(this,i,e,u))return!1}for(n in h)(a=o[n])&&(f&&(a.f?a.t[a.p](a.s):a.t[a.p]=a.s,l=!0),a.pg&&a.t._kill(h)&&(l=!0),a.pg&&0!==a.t._overwriteProps.length||(a._prev?a._prev._next=a._next:a===this._firstPT&&(this._firstPT=a._next),a._next&&(a._next._prev=a._prev),a._next=a._prev=null),delete o[n]),_&&(r[n]=1);!this._firstPT&&this._initted&&this._enabled(!1,!1)}}return l},a.invalidate=function(){return this._notifyPluginsOfEnabled&&D._onPluginEvent("_onDisable",this),this._firstPT=this._overwrittenProps=this._startAt=this._onUpdate=null,this._notifyPluginsOfEnabled=this._active=this._lazy=!1,this._propLookup=this._targets?{}:[],R.prototype.invalidate.call(this),this.vars.immediateRender&&(this._time=-u,this.render(Math.min(0,-this._delay))),this},a._enabled=function(t,e){if(l||o.wake(),t&&this._gc){var i,s=this._targets;if(s)for(i=s.length;--i>-1;)this._siblings[i]=Q(s[i],this,!0);else this._siblings=Q(this.target,this,!0)}return R.prototype._enabled.call(this,t,e),this._notifyPluginsOfEnabled&&this._firstPT?D._onPluginEvent(t?"_onEnable":"_onDisable",this):!1},D.to=function(t,e,i){return new D(t,e,i)},D.from=function(t,e,i){return i.runBackwards=!0,i.immediateRender=0!=i.immediateRender,new D(t,e,i)},D.fromTo=function(t,e,i,s){return s.startAt=i,s.immediateRender=0!=s.immediateRender&&0!=i.immediateRender,new D(t,e,s)},D.delayedCall=function(t,e,i,s,r){return new D(e,0,{delay:t,onComplete:e,onCompleteParams:i,callbackScope:s,onReverseComplete:e,onReverseCompleteParams:i,immediateRender:!1,lazy:!1,useFrames:r,overwrite:0})},D.set=function(t,e){return new D(t,0,e)},D.getTweensOf=function(t,e){if(null==t)return[];t="string"!=typeof t?t:D.selector(t)||t;var i,s,r,n;if((p(t)||M(t))&&"number"!=typeof t[0]){for(i=t.length,s=[];--i>-1;)s=s.concat(D.getTweensOf(t[i],e));for(i=s.length;--i>-1;)for(n=s[i],r=i;--r>-1;)n===s[r]&&s.splice(i,1)}else for(s=Q(t).concat(),i=s.length;--i>-1;)(s[i]._gc||e&&!s[i].isActive())&&s.splice(i,1);return s},D.killTweensOf=D.killDelayedCallsTo=function(t,e,i){"object"==typeof e&&(i=e,e=!1);for(var s=D.getTweensOf(t,e),r=s.length;--r>-1;)s[r]._kill(i,t)};var te=v("plugins.TweenPlugin",function(t,e){this._overwriteProps=(t||"").split(","),this._propName=this._overwriteProps[0],this._priority=e||0,this._super=te.prototype},!0);if(a=te.prototype,te.version="1.19.0",te.API=2,a._firstPT=null,a._addTween=E,a.setRatio=N,a._kill=function(t){var e,i=this._overwriteProps,s=this._firstPT;if(null!=t[this._propName])this._overwriteProps=[];else for(e=i.length;--e>-1;)null!=t[i[e]]&&i.splice(e,1);for(;s;)null!=t[s.n]&&(s._next&&(s._next._prev=s._prev),s._prev?(s._prev._next=s._next,s._prev=null):this._firstPT===s&&(this._firstPT=s._next)),s=s._next;return!1},a._mod=a._roundProps=function(t){for(var e,i=this._firstPT;i;)e=t[this._propName]||null!=i.n&&t[i.n.split(this._propName+"_").join("")],e&&"function"==typeof e&&(2===i.f?i.t._applyPT.m=e:i.m=e),i=i._next},D._onPluginEvent=function(t,e){var i,s,r,n,a,o=e._firstPT;if("_onInitAllProps"===t){for(;o;){for(a=o._next,s=r;s&&s.pr>o.pr;)s=s._next;(o._prev=s?s._prev:n)?o._prev._next=o:r=o,(o._next=s)?s._prev=o:n=o,o=a}o=e._firstPT=r}for(;o;)o.pg&&"function"==typeof o.t[t]&&o.t[t]()&&(i=!0),o=o._next;return i},te.activate=function(t){for(var e=t.length;--e>-1;)t[e].API===te.API&&(B[(new t[e])._propName]=t[e]);return!0},g.plugin=function(t){if(!(t&&t.propName&&t.init&&t.API))throw"illegal plugin definition.";var e,i=t.propName,s=t.priority||0,r=t.overwriteProps,n={init:"_onInitTween",set:"setRatio",kill:"_kill",round:"_mod",mod:"_mod",initAll:"_onInitAllProps"},a=v("plugins."+i.charAt(0).toUpperCase()+i.substr(1)+"Plugin",function(){te.call(this,i,s),this._overwriteProps=r||[]},t.global===!0),o=a.prototype=new te(i);o.constructor=a,a.API=t.API;for(e in n)"function"==typeof t[e]&&(o[n[e]]=t[e]);return a.version=t.version,te.activate([a]),a},r=t._gsQueue){for(n=0;n<r.length;n++)r[n]();for(a in m)m[a].func||t.console.log("GSAP encountered missing dependency: "+a)}l=!1}}("undefined"!=typeof module&&module.exports&&"undefined"!=typeof global?global:this||window,"TweenMax");
;/*!libs/static/physics/p2.js*/
!function(t){if("object"==typeof exports)module.exports=t();else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.p2=t()}}(function(){return function t(e,o,i){function n(a,s){if(!o[a]){if(!e[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(r)return r(a,!0);throw new Error("Cannot find module '"+a+"'")}var h=o[a]={exports:{}};e[a][0].call(h.exports,function(t){var o=e[a][1][t];return n(o?o:t)},h,h.exports,t,e,o,i)}return o[a].exports}for(var r="function"==typeof require&&require,a=0;a<i.length;a++)n(i[a]);return n}({1:[function(t,e){function o(){}var i=t("./Scalar");e.exports=o,o.lineInt=function(t,e,o){o=o||0;var n,r,a,s,c,h,l,p=[0,0];return n=t[1][1]-t[0][1],r=t[0][0]-t[1][0],a=n*t[0][0]+r*t[0][1],s=e[1][1]-e[0][1],c=e[0][0]-e[1][0],h=s*e[0][0]+c*e[0][1],l=n*c-s*r,i.eq(l,0,o)||(p[0]=(c*a-r*h)/l,p[1]=(n*h-s*a)/l),p},o.segmentsIntersect=function(t,e,o,i){var n=e[0]-t[0],r=e[1]-t[1],a=i[0]-o[0],s=i[1]-o[1];if(a*r-s*n==0)return!1;var c=(n*(o[1]-t[1])+r*(t[0]-o[0]))/(a*r-s*n),h=(a*(t[1]-o[1])+s*(o[0]-t[0]))/(s*n-a*r);return c>=0&&1>=c&&h>=0&&1>=h}},{"./Scalar":4}],2:[function(t,e){function o(){}e.exports=o,o.area=function(t,e,o){return(e[0]-t[0])*(o[1]-t[1])-(o[0]-t[0])*(e[1]-t[1])},o.left=function(t,e,i){return o.area(t,e,i)>0},o.leftOn=function(t,e,i){return o.area(t,e,i)>=0},o.right=function(t,e,i){return o.area(t,e,i)<0},o.rightOn=function(t,e,i){return o.area(t,e,i)<=0};var i=[],n=[];o.collinear=function(t,e,r,a){if(a){var s=i,c=n;s[0]=e[0]-t[0],s[1]=e[1]-t[1],c[0]=r[0]-e[0],c[1]=r[1]-e[1];var h=s[0]*c[0]+s[1]*c[1],l=Math.sqrt(s[0]*s[0]+s[1]*s[1]),p=Math.sqrt(c[0]*c[0]+c[1]*c[1]),u=Math.acos(h/(l*p));return a>u}return 0==o.area(t,e,r)},o.sqdist=function(t,e){var o=e[0]-t[0],i=e[1]-t[1];return o*o+i*i}},{}],3:[function(t,e){function o(){this.vertices=[]}function i(t,e,o,i,n){n=n||0;var r=e[1]-t[1],s=t[0]-e[0],c=r*t[0]+s*t[1],h=i[1]-o[1],l=o[0]-i[0],p=h*o[0]+l*o[1],u=r*l-h*s;return a.eq(u,0,n)?[0,0]:[(l*c-s*p)/u,(r*p-h*c)/u]}var n=t("./Line"),r=t("./Point"),a=t("./Scalar");e.exports=o,o.prototype.at=function(t){var e=this.vertices,o=e.length;return e[0>t?t%o+o:t%o]},o.prototype.first=function(){return this.vertices[0]},o.prototype.last=function(){return this.vertices[this.vertices.length-1]},o.prototype.clear=function(){this.vertices.length=0},o.prototype.append=function(t,e,o){if("undefined"==typeof e)throw new Error("From is not given!");if("undefined"==typeof o)throw new Error("To is not given!");if(e>o-1)throw new Error("lol1");if(o>t.vertices.length)throw new Error("lol2");if(0>e)throw new Error("lol3");for(var i=e;o>i;i++)this.vertices.push(t.vertices[i])},o.prototype.makeCCW=function(){for(var t=0,e=this.vertices,o=1;o<this.vertices.length;++o)(e[o][1]<e[t][1]||e[o][1]==e[t][1]&&e[o][0]>e[t][0])&&(t=o);r.left(this.at(t-1),this.at(t),this.at(t+1))||this.reverse()},o.prototype.reverse=function(){for(var t=[],e=0,o=this.vertices.length;e!==o;e++)t.push(this.vertices.pop());this.vertices=t},o.prototype.isReflex=function(t){return r.right(this.at(t-1),this.at(t),this.at(t+1))};var s=[],c=[];o.prototype.canSee=function(t,e){var o,i,a=s,h=c;if(r.leftOn(this.at(t+1),this.at(t),this.at(e))&&r.rightOn(this.at(t-1),this.at(t),this.at(e)))return!1;i=r.sqdist(this.at(t),this.at(e));for(var l=0;l!==this.vertices.length;++l)if((l+1)%this.vertices.length!==t&&l!==t&&r.leftOn(this.at(t),this.at(e),this.at(l+1))&&r.rightOn(this.at(t),this.at(e),this.at(l))&&(a[0]=this.at(t),a[1]=this.at(e),h[0]=this.at(l),h[1]=this.at(l+1),o=n.lineInt(a,h),r.sqdist(this.at(t),o)<i))return!1;return!0},o.prototype.copy=function(t,e,i){var n=i||new o;if(n.clear(),e>t)for(var r=t;e>=r;r++)n.vertices.push(this.vertices[r]);else{for(var r=0;e>=r;r++)n.vertices.push(this.vertices[r]);for(var r=t;r<this.vertices.length;r++)n.vertices.push(this.vertices[r])}return n},o.prototype.getCutEdges=function(){for(var t=[],e=[],i=[],n=new o,r=Number.MAX_VALUE,a=0;a<this.vertices.length;++a)if(this.isReflex(a))for(var s=0;s<this.vertices.length;++s)if(this.canSee(a,s)){e=this.copy(a,s,n).getCutEdges(),i=this.copy(s,a,n).getCutEdges();for(var c=0;c<i.length;c++)e.push(i[c]);e.length<r&&(t=e,r=e.length,t.push([this.at(a),this.at(s)]))}return t},o.prototype.decomp=function(){var t=this.getCutEdges();return t.length>0?this.slice(t):[this]},o.prototype.slice=function(t){if(0==t.length)return[this];if(t instanceof Array&&t.length&&t[0]instanceof Array&&2==t[0].length&&t[0][0]instanceof Array){for(var e=[this],o=0;o<t.length;o++)for(var i=t[o],n=0;n<e.length;n++){var r=e[n],a=r.slice(i);if(a){e.splice(n,1),e.push(a[0],a[1]);break}}return e}var i=t,o=this.vertices.indexOf(i[0]),n=this.vertices.indexOf(i[1]);return-1!=o&&-1!=n?[this.copy(o,n),this.copy(n,o)]:!1},o.prototype.isSimple=function(){for(var t=this.vertices,e=0;e<t.length-1;e++)for(var o=0;e-1>o;o++)if(n.segmentsIntersect(t[e],t[e+1],t[o],t[o+1]))return!1;for(var e=1;e<t.length-2;e++)if(n.segmentsIntersect(t[0],t[t.length-1],t[e],t[e+1]))return!1;return!0},o.prototype.quickDecomp=function(t,e,n,a,s,c){s=s||100,c=c||0,a=a||25,t="undefined"!=typeof t?t:[],e=e||[],n=n||[];var h=[0,0],l=[0,0],p=[0,0],u=0,d=0,f=0,v=0,y=0,m=0,g=0,A=new o,b=new o,E=this,B=this.vertices;if(B.length<3)return t;if(c++,c>s)return console.warn("quickDecomp: max level ("+s+") reached."),t;for(var q=0;q<this.vertices.length;++q)if(E.isReflex(q)){e.push(E.vertices[q]),u=d=Number.MAX_VALUE;for(var P=0;P<this.vertices.length;++P)r.left(E.at(q-1),E.at(q),E.at(P))&&r.rightOn(E.at(q-1),E.at(q),E.at(P-1))&&(p=i(E.at(q-1),E.at(q),E.at(P),E.at(P-1)),r.right(E.at(q+1),E.at(q),p)&&(f=r.sqdist(E.vertices[q],p),d>f&&(d=f,l=p,m=P))),r.left(E.at(q+1),E.at(q),E.at(P+1))&&r.rightOn(E.at(q+1),E.at(q),E.at(P))&&(p=i(E.at(q+1),E.at(q),E.at(P),E.at(P+1)),r.left(E.at(q-1),E.at(q),p)&&(f=r.sqdist(E.vertices[q],p),u>f&&(u=f,h=p,y=P)));if(m==(y+1)%this.vertices.length)p[0]=(l[0]+h[0])/2,p[1]=(l[1]+h[1])/2,n.push(p),y>q?(A.append(E,q,y+1),A.vertices.push(p),b.vertices.push(p),0!=m&&b.append(E,m,E.vertices.length),b.append(E,0,q+1)):(0!=q&&A.append(E,q,E.vertices.length),A.append(E,0,y+1),A.vertices.push(p),b.vertices.push(p),b.append(E,m,q+1));else{if(m>y&&(y+=this.vertices.length),v=Number.MAX_VALUE,m>y)return t;for(var P=m;y>=P;++P)r.leftOn(E.at(q-1),E.at(q),E.at(P))&&r.rightOn(E.at(q+1),E.at(q),E.at(P))&&(f=r.sqdist(E.at(q),E.at(P)),v>f&&(v=f,g=P%this.vertices.length));g>q?(A.append(E,q,g+1),0!=g&&b.append(E,g,B.length),b.append(E,0,q+1)):(0!=q&&A.append(E,q,B.length),A.append(E,0,g+1),b.append(E,g,q+1))}return A.vertices.length<b.vertices.length?(A.quickDecomp(t,e,n,a,s,c),b.quickDecomp(t,e,n,a,s,c)):(b.quickDecomp(t,e,n,a,s,c),A.quickDecomp(t,e,n,a,s,c)),t}return t.push(this),t},o.prototype.removeCollinearPoints=function(t){for(var e=0,o=this.vertices.length-1;this.vertices.length>3&&o>=0;--o)r.collinear(this.at(o-1),this.at(o),this.at(o+1),t)&&(this.vertices.splice(o%this.vertices.length,1),o--,e++);return e}},{"./Line":1,"./Point":2,"./Scalar":4}],4:[function(t,e){function o(){}e.exports=o,o.eq=function(t,e,o){return o=o||0,Math.abs(t-e)<o}},{}],5:[function(t,e){e.exports={Polygon:t("./Polygon"),Point:t("./Point")}},{"./Point":2,"./Polygon":3}],6:[function(t,e){e.exports={name:"p2",version:"0.7.0",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"^0.4.5","grunt-contrib-jshint":"^0.11.2","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.0"}}},{}],7:[function(t,e){function o(t){this.lowerBound=i.create(),t&&t.lowerBound&&i.copy(this.lowerBound,t.lowerBound),this.upperBound=i.create(),t&&t.upperBound&&i.copy(this.upperBound,t.upperBound)}var i=t("../math/vec2");t("../utils/Utils"),e.exports=o;var n=i.create();o.prototype.setFromPoints=function(t,e,o,r){var a=this.lowerBound,s=this.upperBound;"number"!=typeof o&&(o=0),0!==o?i.rotate(a,t[0],o):i.copy(a,t[0]),i.copy(s,a);for(var c=Math.cos(o),h=Math.sin(o),l=1;l<t.length;l++){var p=t[l];if(0!==o){var u=p[0],d=p[1];n[0]=c*u-h*d,n[1]=h*u+c*d,p=n}for(var f=0;2>f;f++)p[f]>s[f]&&(s[f]=p[f]),p[f]<a[f]&&(a[f]=p[f])}e&&(i.add(this.lowerBound,this.lowerBound,e),i.add(this.upperBound,this.upperBound,e)),r&&(this.lowerBound[0]-=r,this.lowerBound[1]-=r,this.upperBound[0]+=r,this.upperBound[1]+=r)},o.prototype.copy=function(t){i.copy(this.lowerBound,t.lowerBound),i.copy(this.upperBound,t.upperBound)},o.prototype.extend=function(t){for(var e=2;e--;){var o=t.lowerBound[e];this.lowerBound[e]>o&&(this.lowerBound[e]=o);var i=t.upperBound[e];this.upperBound[e]<i&&(this.upperBound[e]=i)}},o.prototype.overlaps=function(t){var e=this.lowerBound,o=this.upperBound,i=t.lowerBound,n=t.upperBound;return(i[0]<=o[0]&&o[0]<=n[0]||e[0]<=n[0]&&n[0]<=o[0])&&(i[1]<=o[1]&&o[1]<=n[1]||e[1]<=n[1]&&n[1]<=o[1])},o.prototype.containsPoint=function(t){var e=this.lowerBound,o=this.upperBound;return e[0]<=t[0]&&t[0]<=o[0]&&e[1]<=t[1]&&t[1]<=o[1]},o.prototype.overlapsRay=function(t){var e=1/t.direction[0],o=1/t.direction[1],i=(this.lowerBound[0]-t.from[0])*e,n=(this.upperBound[0]-t.from[0])*e,r=(this.lowerBound[1]-t.from[1])*o,a=(this.upperBound[1]-t.from[1])*o,s=Math.max(Math.max(Math.min(i,n),Math.min(r,a))),c=Math.min(Math.min(Math.max(i,n),Math.max(r,a)));return 0>c?-1:s>c?-1:s}},{"../math/vec2":30,"../utils/Utils":57}],8:[function(t,e){function o(t){this.type=t,this.result=[],this.world=null,this.boundingVolumeType=o.AABB}var i=t("../math/vec2"),n=t("../objects/Body");e.exports=o,o.AABB=1,o.BOUNDING_CIRCLE=2,o.prototype.setWorld=function(t){this.world=t},o.prototype.getCollisionPairs=function(){};var r=i.create();o.boundingRadiusCheck=function(t,e){i.sub(r,t.position,e.position);var o=i.squaredLength(r),n=t.boundingRadius+e.boundingRadius;return n*n>=o},o.aabbCheck=function(t,e){return t.getAABB().overlaps(e.getAABB())},o.prototype.boundingVolumeCheck=function(t,e){var i;switch(this.boundingVolumeType){case o.BOUNDING_CIRCLE:i=o.boundingRadiusCheck(t,e);break;case o.AABB:i=o.aabbCheck(t,e);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return i},o.canCollide=function(t,e){var o=n.KINEMATIC,i=n.STATIC;return t.type===i&&e.type===i?!1:t.type===o&&e.type===i||t.type===i&&e.type===o?!1:t.type===o&&e.type===o?!1:t.sleepState===n.SLEEPING&&e.sleepState===n.SLEEPING?!1:t.sleepState===n.SLEEPING&&e.type===i||e.sleepState===n.SLEEPING&&t.type===i?!1:!0},o.NAIVE=1,o.SAP=2},{"../math/vec2":30,"../objects/Body":31}],9:[function(t,e){function o(){i.call(this,i.NAIVE)}var i=(t("../shapes/Circle"),t("../shapes/Plane"),t("../shapes/Shape"),t("../shapes/Particle"),t("../collision/Broadphase"));t("../math/vec2"),e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.getCollisionPairs=function(t){var e=t.bodies,o=this.result;o.length=0;for(var n=0,r=e.length;n!==r;n++)for(var a=e[n],s=0;n>s;s++){var c=e[s];i.canCollide(a,c)&&this.boundingVolumeCheck(a,c)&&o.push(a,c)}return o},o.prototype.aabbQuery=function(t,e,o){o=o||[];for(var i=t.bodies,n=0;n<i.length;n++){var r=i[n];r.aabbNeedsUpdate&&r.updateAABB(),r.aabb.overlaps(e)&&o.push(r)}return o}},{"../collision/Broadphase":8,"../math/vec2":30,"../shapes/Circle":39,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45}],10:[function(t,e){function o(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.enabledEquations=!0,this.slipForce=10,this.frictionCoefficient=.3,this.surfaceVelocity=0,this.contactEquationPool=new h({size:32}),this.frictionEquationPool=new l({size:64}),this.restitution=0,this.stiffness=u.DEFAULT_STIFFNESS,this.relaxation=u.DEFAULT_RELAXATION,this.frictionStiffness=u.DEFAULT_STIFFNESS,this.frictionRelaxation=u.DEFAULT_RELAXATION,this.enableFrictionReduction=!0,this.collidingBodiesLastStep=new p,this.contactSkinSize=.01}function i(t,e){r.set(t.vertices[0],.5*-e.length,-e.radius),r.set(t.vertices[1],.5*e.length,-e.radius),r.set(t.vertices[2],.5*e.length,e.radius),r.set(t.vertices[3],.5*-e.length,e.radius)}function n(t,e,o,i){for(var n=X,c=j,h=z,l=Y,p=t,u=e.vertices,d=null,f=0;f!==u.length+1;f++){var v=u[f%u.length],y=u[(f+1)%u.length];r.rotate(n,v,i),r.rotate(c,y,i),s(n,n,o),s(c,c,o),a(h,n,p),a(l,c,p);var m=r.crossLength(h,l);if(null===d&&(d=m),0>=m*d)return!1;d=m}return!0}var r=t("../math/vec2"),a=r.sub,s=r.add,c=r.dot,h=(t("../utils/Utils"),t("../utils/ContactEquationPool")),l=t("../utils/FrictionEquationPool"),p=t("../utils/TupleDictionary"),u=t("../equations/Equation"),d=(t("../equations/ContactEquation"),t("../equations/FrictionEquation"),t("../shapes/Circle")),f=t("../shapes/Convex"),v=t("../shapes/Shape"),y=(t("../objects/Body"),t("../shapes/Box"));e.exports=o;var m=r.fromValues(0,1),g=r.fromValues(0,0),A=r.fromValues(0,0),b=r.fromValues(0,0),E=r.fromValues(0,0),B=r.fromValues(0,0),q=r.fromValues(0,0),P=r.fromValues(0,0),w=r.fromValues(0,0),S=r.fromValues(0,0),C=r.fromValues(0,0),L=r.fromValues(0,0),x=r.fromValues(0,0),F=r.fromValues(0,0),M=r.fromValues(0,0),I=r.fromValues(0,0),R=r.fromValues(0,0),V=r.fromValues(0,0),T=r.fromValues(0,0),N=[],G=r.create(),O=r.create();o.prototype.bodiesOverlap=function(t,e){for(var o=G,i=O,n=0,r=t.shapes.length;n!==r;n++){var a=t.shapes[n];t.toWorldFrame(o,a.position);for(var s=0,c=e.shapes.length;s!==c;s++){var h=e.shapes[s];if(e.toWorldFrame(i,h.position),this[a.type|h.type](t,a,o,a.angle+t.angle,e,h,i,h.angle+e.angle,!0))return!0}}return!1},o.prototype.collidedLastStep=function(t,e){var o=0|t.id,i=0|e.id;return!!this.collidingBodiesLastStep.get(o,i)},o.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var t=this.contactEquations,e=t.length;e--;){var o=t[e],i=o.bodyA.id,n=o.bodyB.id;this.collidingBodiesLastStep.set(i,n,!0)}for(var r=this.contactEquations,a=this.frictionEquations,s=0;s<r.length;s++)this.contactEquationPool.release(r[s]);for(var s=0;s<a.length;s++)this.frictionEquationPool.release(a[s]);this.contactEquations.length=this.frictionEquations.length=0},o.prototype.createContactEquation=function(t,e,o,i){var n=this.contactEquationPool.get();return n.bodyA=t,n.bodyB=e,n.shapeA=o,n.shapeB=i,n.restitution=this.restitution,n.firstImpact=!this.collidedLastStep(t,e),n.stiffness=this.stiffness,n.relaxation=this.relaxation,n.needsUpdate=!0,n.enabled=this.enabledEquations,n.offset=this.contactSkinSize,n},o.prototype.createFrictionEquation=function(t,e,o,i){var n=this.frictionEquationPool.get();return n.bodyA=t,n.bodyB=e,n.shapeA=o,n.shapeB=i,n.setSlipForce(this.slipForce),n.frictionCoefficient=this.frictionCoefficient,n.relativeVelocity=this.surfaceVelocity,n.enabled=this.enabledEquations,n.needsUpdate=!0,n.stiffness=this.frictionStiffness,n.relaxation=this.frictionRelaxation,n.contactEquations.length=0,n},o.prototype.createFrictionFromContact=function(t){var e=this.createFrictionEquation(t.bodyA,t.bodyB,t.shapeA,t.shapeB);return r.copy(e.contactPointA,t.contactPointA),r.copy(e.contactPointB,t.contactPointB),r.rotate90cw(e.t,t.normalA),e.contactEquations.push(t),e},o.prototype.createFrictionFromAverage=function(t){var e=this.contactEquations[this.contactEquations.length-1],o=this.createFrictionEquation(e.bodyA,e.bodyB,e.shapeA,e.shapeB),i=e.bodyA;e.bodyB,r.set(o.contactPointA,0,0),r.set(o.contactPointB,0,0),r.set(o.t,0,0);for(var n=0;n!==t;n++)e=this.contactEquations[this.contactEquations.length-1-n],e.bodyA===i?(r.add(o.t,o.t,e.normalA),r.add(o.contactPointA,o.contactPointA,e.contactPointA),r.add(o.contactPointB,o.contactPointB,e.contactPointB)):(r.sub(o.t,o.t,e.normalA),r.add(o.contactPointA,o.contactPointA,e.contactPointB),r.add(o.contactPointB,o.contactPointB,e.contactPointA)),o.contactEquations.push(e);var a=1/t;return r.scale(o.contactPointA,o.contactPointA,a),r.scale(o.contactPointB,o.contactPointB,a),r.normalize(o.t,o.t),r.rotate90cw(o.t,o.t),o},o.prototype[v.LINE|v.CONVEX]=o.prototype.convexLine=function(t,e,o,i,n,r,a,s,c){return c?!1:0},o.prototype[v.LINE|v.BOX]=o.prototype.lineBox=function(t,e,o,i,n,r,a,s,c){return c?!1:0};var U=new y({width:1,height:1}),k=r.create();o.prototype[v.CAPSULE|v.CONVEX]=o.prototype[v.CAPSULE|v.BOX]=o.prototype.convexCapsule=function(t,e,o,n,a,s,c,h,l){var p=k;r.set(p,s.length/2,0),r.rotate(p,p,h),r.add(p,p,c);var u=this.circleConvex(a,s,p,h,t,e,o,n,l,s.radius);r.set(p,-s.length/2,0),r.rotate(p,p,h),r.add(p,p,c);var d=this.circleConvex(a,s,p,h,t,e,o,n,l,s.radius);if(l&&(u||d))return!0;var f=U;i(f,s);var v=this.convexConvex(t,e,o,n,a,f,c,h,l);return v+u+d},o.prototype[v.CAPSULE|v.LINE]=o.prototype.lineCapsule=function(t,e,o,i,n,r,a,s,c){return c?!1:0};var _=r.create(),D=r.create(),W=new y({width:1,height:1});o.prototype[v.CAPSULE|v.CAPSULE]=o.prototype.capsuleCapsule=function(t,e,o,n,a,s,c,h,l){for(var p,u=_,d=D,f=0,v=0;2>v;v++){r.set(u,(0===v?-1:1)*e.length/2,0),r.rotate(u,u,n),r.add(u,u,o);for(var y=0;2>y;y++){r.set(d,(0===y?-1:1)*s.length/2,0),r.rotate(d,d,h),r.add(d,d,c),this.enableFrictionReduction&&(p=this.enableFriction,this.enableFriction=!1);var m=this.circleCircle(t,e,u,n,a,s,d,h,l,e.radius,s.radius);if(this.enableFrictionReduction&&(this.enableFriction=p),l&&m)return!0;f+=m}}this.enableFrictionReduction&&(p=this.enableFriction,this.enableFriction=!1);var g=W;i(g,e);var A=this.convexCapsule(t,g,o,n,a,s,c,h,l);if(this.enableFrictionReduction&&(this.enableFriction=p),l&&A)return!0;if(f+=A,this.enableFrictionReduction){var p=this.enableFriction;this.enableFriction=!1}i(g,s);var b=this.convexCapsule(a,g,c,h,t,e,o,n,l);return this.enableFrictionReduction&&(this.enableFriction=p),l&&b?!0:(f+=b,this.enableFrictionReduction&&f&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(f)),f)},o.prototype[v.LINE|v.LINE]=o.prototype.lineLine=function(t,e,o,i,n,r,a,s,c){return c?!1:0},o.prototype[v.PLANE|v.LINE]=o.prototype.planeLine=function(t,e,o,i,n,h,l,p,u){var d=g,f=A,v=b,y=E,C=B,L=q,x=P,F=w,M=S,I=N,R=0;r.set(d,-h.length/2,0),r.set(f,h.length/2,0),r.rotate(v,d,p),r.rotate(y,f,p),s(v,v,l),s(y,y,l),r.copy(d,v),r.copy(f,y),a(C,f,d),r.normalize(L,C),r.rotate90cw(M,L),r.rotate(F,m,i),I[0]=d,I[1]=f;for(var V=0;V<I.length;V++){var T=I[V];a(x,T,o);var G=c(x,F);if(0>G){if(u)return!0;var O=this.createContactEquation(t,n,e,h);R++,r.copy(O.normalA,F),r.normalize(O.normalA,O.normalA),r.scale(x,F,G),a(O.contactPointA,T,x),a(O.contactPointA,O.contactPointA,t.position),a(O.contactPointB,T,l),s(O.contactPointB,O.contactPointB,l),a(O.contactPointB,O.contactPointB,n.position),this.contactEquations.push(O),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(O))}}return u?!1:(this.enableFrictionReduction||R&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(R)),R)},o.prototype[v.PARTICLE|v.CAPSULE]=o.prototype.particleCapsule=function(t,e,o,i,n,r,a,s,c){return this.circleLine(t,e,o,i,n,r,a,s,c,r.radius,0)},o.prototype[v.CIRCLE|v.LINE]=o.prototype.circleLine=function(t,e,o,i,n,h,l,p,u,d,f){var d=d||0,f="undefined"!=typeof f?f:e.radius,v=g,y=A,m=b,I=E,R=B,V=q,T=P,G=w,O=S,U=C,k=L,_=x,D=F,W=M,X=N;r.set(G,-h.length/2,0),r.set(O,h.length/2,0),r.rotate(U,G,p),r.rotate(k,O,p),s(U,U,l),s(k,k,l),r.copy(G,U),r.copy(O,k),a(V,O,G),r.normalize(T,V),r.rotate90cw(R,T),a(_,o,G);var j=c(_,R);a(I,G,l),a(D,o,l);var z=f+d;if(Math.abs(j)<z){r.scale(v,R,j),a(m,o,v),r.scale(y,R,c(R,D)),r.normalize(y,y),r.scale(y,y,d),s(m,m,y);var Y=c(T,m),K=c(T,G),H=c(T,O);if(Y>K&&H>Y){if(u)return!0;var Z=this.createContactEquation(t,n,e,h);return r.scale(Z.normalA,v,-1),r.normalize(Z.normalA,Z.normalA),r.scale(Z.contactPointA,Z.normalA,f),s(Z.contactPointA,Z.contactPointA,o),a(Z.contactPointA,Z.contactPointA,t.position),a(Z.contactPointB,m,l),s(Z.contactPointB,Z.contactPointB,l),a(Z.contactPointB,Z.contactPointB,n.position),this.contactEquations.push(Z),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Z)),1}}X[0]=G,X[1]=O;for(var J=0;J<X.length;J++){var Q=X[J];if(a(_,Q,o),r.squaredLength(_)<Math.pow(z,2)){if(u)return!0;var Z=this.createContactEquation(t,n,e,h);return r.copy(Z.normalA,_),r.normalize(Z.normalA,Z.normalA),r.scale(Z.contactPointA,Z.normalA,f),s(Z.contactPointA,Z.contactPointA,o),a(Z.contactPointA,Z.contactPointA,t.position),a(Z.contactPointB,Q,l),r.scale(W,Z.normalA,-d),s(Z.contactPointB,Z.contactPointB,W),s(Z.contactPointB,Z.contactPointB,l),a(Z.contactPointB,Z.contactPointB,n.position),this.contactEquations.push(Z),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Z)),1}}return 0},o.prototype[v.CIRCLE|v.CAPSULE]=o.prototype.circleCapsule=function(t,e,o,i,n,r,a,s,c){return this.circleLine(t,e,o,i,n,r,a,s,c,r.radius)},o.prototype[v.CIRCLE|v.CONVEX]=o.prototype[v.CIRCLE|v.BOX]=o.prototype.circleConvex=function(t,e,o,i,c,h,l,p,u,d){for(var d="number"==typeof d?d:e.radius,f=g,v=A,y=b,m=E,q=B,P=C,w=L,S=F,x=M,V=I,T=R,N=!1,G=Number.MAX_VALUE,O=h.vertices,U=0;U!==O.length+1;U++){var k=O[U%O.length],_=O[(U+1)%O.length];if(r.rotate(f,k,p),r.rotate(v,_,p),s(f,f,l),s(v,v,l),a(y,v,f),r.normalize(m,y),r.rotate90cw(q,m),r.scale(x,q,-e.radius),s(x,x,o),n(x,h,l,p)){r.sub(V,f,x);var D=Math.abs(r.dot(V,q));G>D&&(r.copy(T,x),G=D,r.scale(S,q,D),r.add(S,S,x),N=!0)}}if(N){if(u)return!0;var W=this.createContactEquation(t,c,e,h);return r.sub(W.normalA,T,o),r.normalize(W.normalA,W.normalA),r.scale(W.contactPointA,W.normalA,d),s(W.contactPointA,W.contactPointA,o),a(W.contactPointA,W.contactPointA,t.position),a(W.contactPointB,S,l),s(W.contactPointB,W.contactPointB,l),a(W.contactPointB,W.contactPointB,c.position),this.contactEquations.push(W),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(W)),1}if(d>0)for(var U=0;U<O.length;U++){var X=O[U];if(r.rotate(w,X,p),s(w,w,l),a(P,w,o),r.squaredLength(P)<Math.pow(d,2)){if(u)return!0;var W=this.createContactEquation(t,c,e,h);return r.copy(W.normalA,P),r.normalize(W.normalA,W.normalA),r.scale(W.contactPointA,W.normalA,d),s(W.contactPointA,W.contactPointA,o),a(W.contactPointA,W.contactPointA,t.position),a(W.contactPointB,w,l),s(W.contactPointB,W.contactPointB,l),a(W.contactPointB,W.contactPointB,c.position),this.contactEquations.push(W),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(W)),1}}return 0};var X=r.create(),j=r.create(),z=r.create(),Y=r.create();o.prototype[v.PARTICLE|v.CONVEX]=o.prototype[v.PARTICLE|v.BOX]=o.prototype.particleConvex=function(t,e,o,i,h,l,p,u,d){var f=g,v=A,y=b,m=E,w=B,S=q,L=P,x=C,M=F,I=V,R=T,N=Number.MAX_VALUE,G=!1,O=l.vertices;if(!n(o,l,p,u))return 0;if(d)return!0;for(var U=0;U!==O.length+1;U++){var k=O[U%O.length],_=O[(U+1)%O.length];r.rotate(f,k,u),r.rotate(v,_,u),s(f,f,p),s(v,v,p),a(y,v,f),r.normalize(m,y),r.rotate90cw(w,m),a(x,o,f),c(x,w),a(S,f,p),a(L,o,p),r.sub(I,f,o);var D=Math.abs(r.dot(I,w));N>D&&(N=D,r.scale(M,w,D),r.add(M,M,o),r.copy(R,w),G=!0)}if(G){var W=this.createContactEquation(t,h,e,l);return r.scale(W.normalA,R,-1),r.normalize(W.normalA,W.normalA),r.set(W.contactPointA,0,0),s(W.contactPointA,W.contactPointA,o),a(W.contactPointA,W.contactPointA,t.position),a(W.contactPointB,M,p),s(W.contactPointB,W.contactPointB,p),a(W.contactPointB,W.contactPointB,h.position),this.contactEquations.push(W),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(W)),1}return 0},o.prototype[v.CIRCLE]=o.prototype.circleCircle=function(t,e,o,i,n,c,h,l,p,u,d){var f=g,u=u||e.radius,d=d||c.radius;a(f,o,h);var v=u+d;if(r.squaredLength(f)>Math.pow(v,2))return 0;if(p)return!0;var y=this.createContactEquation(t,n,e,c);return a(y.normalA,h,o),r.normalize(y.normalA,y.normalA),r.scale(y.contactPointA,y.normalA,u),r.scale(y.contactPointB,y.normalA,-d),s(y.contactPointA,y.contactPointA,o),a(y.contactPointA,y.contactPointA,t.position),s(y.contactPointB,y.contactPointB,h),a(y.contactPointB,y.contactPointB,n.position),this.contactEquations.push(y),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(y)),1},o.prototype[v.PLANE|v.CONVEX]=o.prototype[v.PLANE|v.BOX]=o.prototype.planeConvex=function(t,e,o,i,n,h,l,p,u){var d=g,f=A,v=b,y=0;r.rotate(f,m,i);for(var E=0;E!==h.vertices.length;E++){var B=h.vertices[E];if(r.rotate(d,B,p),s(d,d,l),a(v,d,o),c(v,f)<=0){if(u)return!0;y++;var q=this.createContactEquation(t,n,e,h);a(v,d,o),r.copy(q.normalA,f);var P=c(v,q.normalA);r.scale(v,q.normalA,P),a(q.contactPointB,d,n.position),a(q.contactPointA,d,v),a(q.contactPointA,q.contactPointA,t.position),this.contactEquations.push(q),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(q))}}return this.enableFrictionReduction&&this.enableFriction&&y&&this.frictionEquations.push(this.createFrictionFromAverage(y)),y},o.prototype[v.PARTICLE|v.PLANE]=o.prototype.particlePlane=function(t,e,o,i,n,s,h,l,p){var u=g,d=A;l=l||0,a(u,o,h),r.rotate(d,m,l);var f=c(u,d);if(f>0)return 0;if(p)return!0;var v=this.createContactEquation(n,t,s,e);return r.copy(v.normalA,d),r.scale(u,v.normalA,f),a(v.contactPointA,o,u),a(v.contactPointA,v.contactPointA,n.position),a(v.contactPointB,o,t.position),this.contactEquations.push(v),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(v)),1},o.prototype[v.CIRCLE|v.PARTICLE]=o.prototype.circleParticle=function(t,e,o,i,n,c,h,l,p){var u=g;if(a(u,h,o),r.squaredLength(u)>Math.pow(e.radius,2))return 0;if(p)return!0;var d=this.createContactEquation(t,n,e,c);return r.copy(d.normalA,u),r.normalize(d.normalA,d.normalA),r.scale(d.contactPointA,d.normalA,e.radius),s(d.contactPointA,d.contactPointA,o),a(d.contactPointA,d.contactPointA,t.position),a(d.contactPointB,h,n.position),this.contactEquations.push(d),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(d)),1};var K=new d({radius:1}),H=r.create(),Z=r.create();r.create(),o.prototype[v.PLANE|v.CAPSULE]=o.prototype.planeCapsule=function(t,e,o,i,n,a,c,h,l){var p=H,u=Z,d=K;r.set(p,-a.length/2,0),r.rotate(p,p,h),s(p,p,c),r.set(u,a.length/2,0),r.rotate(u,u,h),s(u,u,c),d.radius=a.radius;var f;this.enableFrictionReduction&&(f=this.enableFriction,this.enableFriction=!1);var v=this.circlePlane(n,d,p,0,t,e,o,i,l),y=this.circlePlane(n,d,u,0,t,e,o,i,l);if(this.enableFrictionReduction&&(this.enableFriction=f),l)return v||y;var m=v+y;return this.enableFrictionReduction&&m&&this.frictionEquations.push(this.createFrictionFromAverage(m)),m},o.prototype[v.CIRCLE|v.PLANE]=o.prototype.circlePlane=function(t,e,o,i,n,h,l,p,u){var d=t,f=e,v=o,y=n,E=l,B=p;B=B||0;var q=g,P=A,w=b;a(q,v,E),r.rotate(P,m,B);var S=c(P,q);if(S>f.radius)return 0;if(u)return!0;var C=this.createContactEquation(y,d,h,e);return r.copy(C.normalA,P),r.scale(C.contactPointB,C.normalA,-f.radius),s(C.contactPointB,C.contactPointB,v),a(C.contactPointB,C.contactPointB,d.position),r.scale(w,C.normalA,S),a(C.contactPointA,q,w),s(C.contactPointA,C.contactPointA,E),a(C.contactPointA,C.contactPointA,y.position),this.contactEquations.push(C),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(C)),1},o.prototype[v.CONVEX]=o.prototype[v.CONVEX|v.BOX]=o.prototype[v.BOX]=o.prototype.convexConvex=function(t,e,i,n,h,l,p,u,d,f){var v=g,y=A,m=b,q=E,C=B,L=P,x=w,F=S,M=0,f="number"==typeof f?f:0,I=o.findSeparatingAxis(e,i,n,l,p,u,v);if(!I)return 0;a(x,p,i),c(v,x)>0&&r.scale(v,v,-1);var R=o.getClosestEdge(e,n,v,!0),V=o.getClosestEdge(l,u,v);if(-1===R||-1===V)return 0;for(var T=0;2>T;T++){var N=R,G=V,O=e,U=l,k=i,_=p,D=n,W=u,X=t,j=h;if(0===T){var z;z=N,N=G,G=z,z=O,O=U,U=z,z=k,k=_,_=z,z=D,D=W,W=z,z=X,X=j,j=z}for(var Y=G;G+2>Y;Y++){var K=U.vertices[(Y+U.vertices.length)%U.vertices.length];r.rotate(y,K,W),s(y,y,_);for(var H=0,Z=N-1;N+2>Z;Z++){var J=O.vertices[(Z+O.vertices.length)%O.vertices.length],Q=O.vertices[(Z+1+O.vertices.length)%O.vertices.length];r.rotate(m,J,D),r.rotate(q,Q,D),s(m,m,k),s(q,q,k),a(C,q,m),r.rotate90cw(F,C),r.normalize(F,F),a(x,y,m);var $=c(F,x);(Z===N&&f>=$||Z!==N&&0>=$)&&H++}if(H>=3){if(d)return!0;var te=this.createContactEquation(X,j,O,U);M++;var J=O.vertices[N%O.vertices.length],Q=O.vertices[(N+1)%O.vertices.length];r.rotate(m,J,D),r.rotate(q,Q,D),s(m,m,k),s(q,q,k),a(C,q,m),r.rotate90cw(te.normalA,C),r.normalize(te.normalA,te.normalA),a(x,y,m);var $=c(te.normalA,x);r.scale(L,te.normalA,$),a(te.contactPointA,y,k),a(te.contactPointA,te.contactPointA,L),s(te.contactPointA,te.contactPointA,k),a(te.contactPointA,te.contactPointA,X.position),a(te.contactPointB,y,_),s(te.contactPointB,te.contactPointB,_),a(te.contactPointB,te.contactPointB,j.position),this.contactEquations.push(te),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(te))}}}return this.enableFrictionReduction&&this.enableFriction&&M&&this.frictionEquations.push(this.createFrictionFromAverage(M)),M};var J=r.fromValues(0,0);o.projectConvexOntoAxis=function(t,e,o,i,n){var a,s,h=null,l=null,p=J;r.rotate(p,i,-o);for(var u=0;u<t.vertices.length;u++)a=t.vertices[u],s=c(a,p),(null===h||s>h)&&(h=s),(null===l||l>s)&&(l=s);if(l>h){var d=l;l=h,h=d}var f=c(e,i);r.set(n,l+f,h+f)};var Q=r.fromValues(0,0),$=r.fromValues(0,0),te=r.fromValues(0,0),ee=r.fromValues(0,0),oe=r.fromValues(0,0),ie=r.fromValues(0,0);o.findSeparatingAxis=function(t,e,i,n,s,c,h){var l=null,p=!1,u=!1,d=Q,f=$,v=te,m=ee,g=oe,A=ie;if(t instanceof y&&n instanceof y)for(var b=0;2!==b;b++){var E=t,B=i;1===b&&(E=n,B=c);for(var q=0;2!==q;q++){0===q?r.set(m,0,1):1===q&&r.set(m,1,0),0!==B&&r.rotate(m,m,B),o.projectConvexOntoAxis(t,e,i,m,g),o.projectConvexOntoAxis(n,s,c,m,A);var P=g,w=A,S=!1;g[0]>A[0]&&(w=g,P=A,S=!0);var C=w[0]-P[1];p=0>=C,(null===l||C>l)&&(r.copy(h,m),l=C,u=p)}}else for(var b=0;2!==b;b++){var E=t,B=i;1===b&&(E=n,B=c);for(var q=0;q!==E.vertices.length;q++){r.rotate(f,E.vertices[q],B),r.rotate(v,E.vertices[(q+1)%E.vertices.length],B),a(d,v,f),r.rotate90cw(m,d),r.normalize(m,m),o.projectConvexOntoAxis(t,e,i,m,g),o.projectConvexOntoAxis(n,s,c,m,A);var P=g,w=A,S=!1;g[0]>A[0]&&(w=g,P=A,S=!0);var C=w[0]-P[1];p=0>=C,(null===l||C>l)&&(r.copy(h,m),l=C,u=p)}}return u};var ne=r.fromValues(0,0),re=r.fromValues(0,0),ae=r.fromValues(0,0);o.getClosestEdge=function(t,e,o,i){var n=ne,s=re,h=ae;r.rotate(n,o,-e),i&&r.scale(n,n,-1);for(var l=-1,p=t.vertices.length,u=-1,d=0;d!==p;d++){a(s,t.vertices[(d+1)%p],t.vertices[d%p]),r.rotate90cw(h,s),r.normalize(h,h);var f=c(h,n);(-1===l||f>u)&&(l=d%p,u=f)}return l};var se=r.create(),ce=r.create(),he=r.create(),le=r.create(),pe=r.create(),ue=r.create(),de=r.create();o.prototype[v.CIRCLE|v.HEIGHTFIELD]=o.prototype.circleHeightfield=function(t,e,o,i,n,c,h,l,p,u){var d=c.heights,u=u||e.radius,f=c.elementWidth,v=ce,y=se,m=pe,g=de,A=ue,b=he,E=le,B=Math.floor((o[0]-u-h[0])/f),q=Math.ceil((o[0]+u-h[0])/f);0>B&&(B=0),q>=d.length&&(q=d.length-1);for(var P=d[B],w=d[q],S=B;q>S;S++)d[S]<w&&(w=d[S]),d[S]>P&&(P=d[S]);if(o[1]-u>P)return p?!1:0;for(var C=!1,S=B;q>S;S++){r.set(b,S*f,d[S]),r.set(E,(S+1)*f,d[S+1]),r.add(b,b,h),r.add(E,E,h),r.sub(A,E,b),r.rotate(A,A,Math.PI/2),r.normalize(A,A),r.scale(y,A,-u),r.add(y,y,o),r.sub(v,y,b);var L=r.dot(v,A);if(y[0]>=b[0]&&y[0]<E[0]&&0>=L){if(p)return!0;C=!0,r.scale(v,A,-L),r.add(m,y,v),r.copy(g,A);var x=this.createContactEquation(n,t,c,e);r.copy(x.normalA,g),r.scale(x.contactPointB,x.normalA,-u),s(x.contactPointB,x.contactPointB,o),a(x.contactPointB,x.contactPointB,t.position),r.copy(x.contactPointA,m),r.sub(x.contactPointA,x.contactPointA,n.position),this.contactEquations.push(x),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(x))}}if(C=!1,u>0)for(var S=B;q>=S;S++)if(r.set(b,S*f,d[S]),r.add(b,b,h),r.sub(v,o,b),r.squaredLength(v)<Math.pow(u,2)){if(p)return!0;C=!0;var x=this.createContactEquation(n,t,c,e);r.copy(x.normalA,v),r.normalize(x.normalA,x.normalA),r.scale(x.contactPointB,x.normalA,-u),s(x.contactPointB,x.contactPointB,o),a(x.contactPointB,x.contactPointB,t.position),a(x.contactPointA,b,h),s(x.contactPointA,x.contactPointA,h),a(x.contactPointA,x.contactPointA,n.position),this.contactEquations.push(x),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(x))
}return C?1:0};var fe=r.create(),ve=r.create(),ye=r.create(),me=new f({vertices:[r.create(),r.create(),r.create(),r.create()]});o.prototype[v.BOX|v.HEIGHTFIELD]=o.prototype[v.CONVEX|v.HEIGHTFIELD]=o.prototype.convexHeightfield=function(t,e,o,i,n,a,s,c,h){var l=a.heights,p=a.elementWidth,u=fe,d=ve,f=ye,v=me,y=Math.floor((t.aabb.lowerBound[0]-s[0])/p),m=Math.ceil((t.aabb.upperBound[0]-s[0])/p);0>y&&(y=0),m>=l.length&&(m=l.length-1);for(var g=l[y],A=l[m],b=y;m>b;b++)l[b]<A&&(A=l[b]),l[b]>g&&(g=l[b]);if(t.aabb.lowerBound[1]>g)return h?!1:0;for(var E=0,b=y;m>b;b++){r.set(u,b*p,l[b]),r.set(d,(b+1)*p,l[b+1]),r.add(u,u,s),r.add(d,d,s);var B=100;r.set(f,.5*(d[0]+u[0]),.5*(d[1]+u[1]-B)),r.sub(v.vertices[0],d,f),r.sub(v.vertices[1],u,f),r.copy(v.vertices[2],v.vertices[1]),r.copy(v.vertices[3],v.vertices[0]),v.vertices[2][1]-=B,v.vertices[3][1]-=B,E+=this.convexConvex(t,e,o,i,n,v,f,0,h)}return E}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../shapes/Box":37,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Shape":45,"../utils/ContactEquationPool":48,"../utils/FrictionEquationPool":49,"../utils/TupleDictionary":56,"../utils/Utils":57}],11:[function(t,e){function o(t){t=t||{},this.from=t.from?n.fromValues(t.from[0],t.from[1]):n.create(),this.to=t.to?n.fromValues(t.to[0],t.to[1]):n.create(),this.checkCollisionResponse=void 0!==t.checkCollisionResponse?t.checkCollisionResponse:!0,this.skipBackfaces=!!t.skipBackfaces,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:-1,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:-1,this.mode=void 0!==t.mode?t.mode:o.ANY,this.callback=t.callback||function(){},this.direction=n.create(),this.length=1,this.update()}function i(t,e,o){n.sub(a,o,t);var i=n.dot(a,e);return n.scale(s,e,i),n.add(s,s,t),n.squaredDistance(o,s)}e.exports=o;var n=t("../math/vec2");t("../collision/RaycastResult"),t("../shapes/Shape"),t("../collision/AABB"),o.prototype.constructor=o,o.CLOSEST=1,o.ANY=2,o.ALL=4,o.prototype.update=function(){var t=this.direction;n.sub(t,this.to,this.from),this.length=n.length(t),n.normalize(t,t)},o.prototype.intersectBodies=function(t,e){for(var o=0,i=e.length;!t.shouldStop(this)&&i>o;o++){var n=e[o],r=n.getAABB();(r.overlapsRay(this)>=0||r.containsPoint(this.from))&&this.intersectBody(t,n)}};var r=n.create();o.prototype.intersectBody=function(t,e){var o=this.checkCollisionResponse;if(!o||e.collisionResponse)for(var i=r,a=0,s=e.shapes.length;s>a;a++){var c=e.shapes[a];if((!o||c.collisionResponse)&&0!==(this.collisionGroup&c.collisionMask)&&0!==(c.collisionGroup&this.collisionMask)){n.rotate(i,c.position,e.angle),n.add(i,i,e.position);var h=c.angle+e.angle;if(this.intersectShape(t,c,h,i,e),t.shouldStop(this))break}}},o.prototype.intersectShape=function(t,e,o,n,r){var a=this.from,s=i(a,this.direction,n);s>e.boundingRadius*e.boundingRadius||(this._currentBody=r,this._currentShape=e,e.raycast(t,this,n,o),this._currentBody=this._currentShape=null)},o.prototype.getAABB=function(t){var e=this.to,o=this.from;n.set(t.lowerBound,Math.min(e[0],o[0]),Math.min(e[1],o[1])),n.set(t.upperBound,Math.max(e[0],o[0]),Math.max(e[1],o[1]))},n.create(),o.prototype.reportIntersection=function(t,e,i,r){var a=(this.from,this.to,this._currentShape),s=this._currentBody;if(!(this.skipBackfaces&&n.dot(i,this.direction)>0))switch(this.mode){case o.ALL:t.set(i,a,s,e,r),this.callback(t);break;case o.CLOSEST:(e<t.fraction||!t.hasHit())&&t.set(i,a,s,e,r);break;case o.ANY:t.set(i,a,s,e,r)}};var a=n.create(),s=n.create()},{"../collision/AABB":7,"../collision/RaycastResult":12,"../math/vec2":30,"../shapes/Shape":45}],12:[function(t,e){function o(){this.normal=i.create(),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1}var i=t("../math/vec2"),n=t("../collision/Ray");e.exports=o,o.prototype.reset=function(){i.set(this.normal,0,0),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1},o.prototype.getHitDistance=function(t){return i.distance(t.from,t.to)*this.fraction},o.prototype.hasHit=function(){return-1!==this.fraction},o.prototype.getHitPoint=function(t,e){i.lerp(t,e.from,e.to,this.fraction)},o.prototype.stop=function(){this.isStopped=!0},o.prototype.shouldStop=function(t){return this.isStopped||-1!==this.fraction&&t.mode===n.ANY},o.prototype.set=function(t,e,o,n,r){i.copy(this.normal,t),this.shape=e,this.body=o,this.fraction=n,this.faceIndex=r}},{"../collision/Ray":11,"../math/vec2":30}],13:[function(t,e){function o(){n.call(this,n.SAP),this.axisList=[],this.axisIndex=0;var t=this;this._addBodyHandler=function(e){t.axisList.push(e.body)},this._removeBodyHandler=function(e){var o=t.axisList.indexOf(e.body);-1!==o&&t.axisList.splice(o,1)}}var i=t("../utils/Utils"),n=t("../collision/Broadphase");e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.setWorld=function(t){this.axisList.length=0,i.appendArray(this.axisList,t.bodies),t.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),t.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=t},o.sortAxisList=function(t,e){e=0|e;for(var o=1,i=t.length;i>o;o++){for(var n=t[o],r=o-1;r>=0&&!(t[r].aabb.lowerBound[e]<=n.aabb.lowerBound[e]);r--)t[r+1]=t[r];t[r+1]=n}return t},o.prototype.sortList=function(){var t=this.axisList,e=this.axisIndex;o.sortAxisList(t,e)},o.prototype.getCollisionPairs=function(){var t=this.axisList,e=this.result,o=this.axisIndex;e.length=0;for(var i=t.length;i--;){var r=t[i];r.aabbNeedsUpdate&&r.updateAABB()}this.sortList();for(var a=0,s=0|t.length;a!==s;a++)for(var c=t[a],h=a+1;s>h;h++){var l=t[h],p=l.aabb.lowerBound[o]<=c.aabb.upperBound[o];if(!p)break;n.canCollide(c,l)&&this.boundingVolumeCheck(c,l)&&e.push(c,l)}return e},o.prototype.aabbQuery=function(t,e,o){o=o||[],this.sortList();var i=this.axisIndex,n="x";1===i&&(n="y"),2===i&&(n="z");for(var r=this.axisList,a=(e.lowerBound[n],e.upperBound[n],0);a<r.length;a++){var s=r[a];s.aabbNeedsUpdate&&s.updateAABB(),s.aabb.overlaps(e)&&o.push(s)}return o}},{"../collision/Broadphase":8,"../utils/Utils":57}],14:[function(t,e){function o(t,e,o,n){this.type=o,n=i.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}e.exports=o;var i=t("../utils/Utils");o.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},o.DISTANCE=1,o.GEAR=2,o.LOCK=3,o.PRISMATIC=4,o.REVOLUTE=5,o.prototype.setStiffness=function(t){for(var e=this.equations,o=0;o!==e.length;o++){var i=e[o];i.stiffness=t,i.needsUpdate=!0}},o.prototype.setRelaxation=function(t){for(var e=this.equations,o=0;o!==e.length;o++){var i=e[o];i.relaxation=t,i.needsUpdate=!0}}},{"../utils/Utils":57}],15:[function(t,e){function o(t,e,o){o=a.defaults(o,{localAnchorA:[0,0],localAnchorB:[0,0]}),i.call(this,t,e,i.DISTANCE,o),this.localAnchorA=r.fromValues(o.localAnchorA[0],o.localAnchorA[1]),this.localAnchorB=r.fromValues(o.localAnchorB[0],o.localAnchorB[1]);var s=this.localAnchorA,c=this.localAnchorB;if(this.distance=0,"number"==typeof o.distance)this.distance=o.distance;else{var h=r.create(),l=r.create(),p=r.create();r.rotate(h,s,t.angle),r.rotate(l,c,e.angle),r.add(p,e.position,l),r.sub(p,p,h),r.sub(p,p,t.position),this.distance=r.length(p)}var u;u="undefined"==typeof o.maxForce?Number.MAX_VALUE:o.maxForce;var d=new n(t,e,-u,u);this.equations=[d],this.maxForce=u;var p=r.create(),f=r.create(),v=r.create(),y=this;d.computeGq=function(){var t=this.bodyA,e=this.bodyB,o=t.position,i=e.position;return r.rotate(f,s,t.angle),r.rotate(v,c,e.angle),r.add(p,i,v),r.sub(p,p,f),r.sub(p,p,o),r.length(p)-y.distance},this.setMaxForce(u),this.upperLimitEnabled=!1,this.upperLimit=1,this.lowerLimitEnabled=!1,this.lowerLimit=0,this.position=0}var i=t("./Constraint"),n=t("../equations/Equation"),r=t("../math/vec2"),a=t("../utils/Utils");e.exports=o,o.prototype=new i,o.prototype.constructor=o;var s=r.create(),c=r.create(),h=r.create();o.prototype.update=function(){var t=this.equations[0],e=this.bodyA,o=this.bodyB,i=(this.distance,e.position),n=o.position,a=this.equations[0],l=t.G;r.rotate(c,this.localAnchorA,e.angle),r.rotate(h,this.localAnchorB,o.angle),r.add(s,n,h),r.sub(s,s,c),r.sub(s,s,i),this.position=r.length(s);var p=!1;if(this.upperLimitEnabled&&this.position>this.upperLimit&&(a.maxForce=0,a.minForce=-this.maxForce,this.distance=this.upperLimit,p=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(a.maxForce=this.maxForce,a.minForce=0,this.distance=this.lowerLimit,p=!0),(this.lowerLimitEnabled||this.upperLimitEnabled)&&!p)return void(a.enabled=!1);a.enabled=!0,r.normalize(s,s);var u=r.crossLength(c,s),d=r.crossLength(h,s);l[0]=-s[0],l[1]=-s[1],l[2]=-u,l[3]=s[0],l[4]=s[1],l[5]=d},o.prototype.setMaxForce=function(t){var e=this.equations[0];e.minForce=-t,e.maxForce=t},o.prototype.getMaxForce=function(){var t=this.equations[0];return t.maxForce}},{"../equations/Equation":22,"../math/vec2":30,"../utils/Utils":57,"./Constraint":14}],16:[function(t,e){function o(t,e,o){o=o||{},i.call(this,t,e,i.GEAR,o),this.ratio=void 0!==o.ratio?o.ratio:1,this.angle=void 0!==o.angle?o.angle:e.angle-this.ratio*t.angle,o.angle=this.angle,o.ratio=this.ratio,this.equations=[new n(t,e,o)],void 0!==o.maxTorque&&this.setMaxTorque(o.maxTorque)}var i=t("./Constraint"),n=(t("../equations/Equation"),t("../equations/AngleLockEquation"));t("../math/vec2"),e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.update=function(){var t=this.equations[0];t.ratio!==this.ratio&&t.setRatio(this.ratio),t.angle=this.angle},o.prototype.setMaxTorque=function(t){this.equations[0].setMaxTorque(t)},o.prototype.getMaxTorque=function(){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":20,"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],17:[function(t,e){function o(t,e,o){o=o||{},i.call(this,t,e,i.LOCK,o);var a="undefined"==typeof o.maxForce?Number.MAX_VALUE:o.maxForce,s=(o.localAngleB||0,new r(t,e,-a,a)),c=new r(t,e,-a,a),h=new r(t,e,-a,a),l=n.create(),p=n.create(),u=this;s.computeGq=function(){return n.rotate(l,u.localOffsetB,t.angle),n.sub(p,e.position,t.position),n.sub(p,p,l),p[0]},c.computeGq=function(){return n.rotate(l,u.localOffsetB,t.angle),n.sub(p,e.position,t.position),n.sub(p,p,l),p[1]};var d=n.create(),f=n.create();h.computeGq=function(){return n.rotate(d,u.localOffsetB,e.angle-u.localAngleB),n.scale(d,d,-1),n.sub(p,t.position,e.position),n.add(p,p,d),n.rotate(f,d,-Math.PI/2),n.normalize(f,f),n.dot(p,f)},this.localOffsetB=n.create(),o.localOffsetB?n.copy(this.localOffsetB,o.localOffsetB):(n.sub(this.localOffsetB,e.position,t.position),n.rotate(this.localOffsetB,this.localOffsetB,-t.angle)),this.localAngleB=0,this.localAngleB="number"==typeof o.localAngleB?o.localAngleB:e.angle-t.angle,this.equations.push(s,c,h),this.setMaxForce(a)}var i=t("./Constraint"),n=t("../math/vec2"),r=t("../equations/Equation");e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.setMaxForce=function(t){for(var e=this.equations,o=0;o<this.equations.length;o++)e[o].maxForce=t,e[o].minForce=-t},o.prototype.getMaxForce=function(){return this.equations[0].maxForce};var a=n.create(),s=n.create(),c=n.create(),h=n.fromValues(1,0),l=n.fromValues(0,1);o.prototype.update=function(){var t=this.equations[0],e=this.equations[1],o=this.equations[2],i=this.bodyA,r=this.bodyB;n.rotate(a,this.localOffsetB,i.angle),n.rotate(s,this.localOffsetB,r.angle-this.localAngleB),n.scale(s,s,-1),n.rotate(c,s,Math.PI/2),n.normalize(c,c),t.G[0]=-1,t.G[1]=0,t.G[2]=-n.crossLength(a,h),t.G[3]=1,e.G[0]=0,e.G[1]=-1,e.G[2]=-n.crossLength(a,l),e.G[4]=1,o.G[0]=-c[0],o.G[1]=-c[1],o.G[3]=c[0],o.G[4]=c[1],o.G[5]=n.crossLength(s,c)}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],18:[function(t,e){function o(t,e,o){o=o||{},i.call(this,t,e,i.PRISMATIC,o);var c=a.fromValues(0,0),h=a.fromValues(1,0),l=a.fromValues(0,0);o.localAnchorA&&a.copy(c,o.localAnchorA),o.localAxisA&&a.copy(h,o.localAxisA),o.localAnchorB&&a.copy(l,o.localAnchorB),this.localAnchorA=c,this.localAnchorB=l,this.localAxisA=h;var p=this.maxForce="undefined"!=typeof o.maxForce?o.maxForce:Number.MAX_VALUE,u=new r(t,e,-p,p),d=new a.create,f=new a.create,v=new a.create,y=new a.create;if(u.computeGq=function(){return a.dot(v,y)},u.updateJacobian=function(){var o=this.G,i=t.position,n=e.position;a.rotate(d,c,t.angle),a.rotate(f,l,e.angle),a.add(v,n,f),a.sub(v,v,i),a.sub(v,v,d),a.rotate(y,h,t.angle+Math.PI/2),o[0]=-y[0],o[1]=-y[1],o[2]=-a.crossLength(d,y)+a.crossLength(y,v),o[3]=y[0],o[4]=y[1],o[5]=a.crossLength(f,y)},this.equations.push(u),!o.disableRotationalLock){var m=new s(t,e,-p,p);this.equations.push(m)}this.position=0,this.velocity=0,this.lowerLimitEnabled="undefined"!=typeof o.lowerLimit?!0:!1,this.upperLimitEnabled="undefined"!=typeof o.upperLimit?!0:!1,this.lowerLimit="undefined"!=typeof o.lowerLimit?o.lowerLimit:0,this.upperLimit="undefined"!=typeof o.upperLimit?o.upperLimit:1,this.upperLimitEquation=new n(t,e),this.lowerLimitEquation=new n(t,e),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=p,this.motorEquation=new r(t,e),this.motorEnabled=!1,this.motorSpeed=0;var g=this,A=this.motorEquation;A.computeGW,A.computeGq=function(){return 0},A.computeGW=function(){var t=this.G,e=this.bodyA,o=this.bodyB,i=e.velocity,n=o.velocity,r=e.angularVelocity,a=o.angularVelocity;return this.gmult(t,i,r,n,a)+g.motorSpeed}}var i=t("./Constraint"),n=t("../equations/ContactEquation"),r=t("../equations/Equation"),a=t("../math/vec2"),s=t("../equations/RotationalLockEquation");e.exports=o,o.prototype=new i,o.prototype.constructor=o;var c=a.create(),h=a.create(),l=a.create(),p=a.create(),u=a.create(),d=a.create();o.prototype.update=function(){var t=this.equations,e=t[0],o=this.upperLimit,i=this.lowerLimit,n=this.upperLimitEquation,r=this.lowerLimitEquation,s=this.bodyA,f=this.bodyB,v=this.localAxisA,y=this.localAnchorA,m=this.localAnchorB;e.updateJacobian(),a.rotate(c,v,s.angle),a.rotate(p,y,s.angle),a.add(h,p,s.position),a.rotate(u,m,f.angle),a.add(l,u,f.position);var g=this.position=a.dot(l,c)-a.dot(h,c);if(this.motorEnabled){var A=this.motorEquation.G;A[0]=c[0],A[1]=c[1],A[2]=a.crossLength(c,u),A[3]=-c[0],A[4]=-c[1],A[5]=-a.crossLength(c,p)}if(this.upperLimitEnabled&&g>o)a.scale(n.normalA,c,-1),a.sub(n.contactPointA,h,s.position),a.sub(n.contactPointB,l,f.position),a.scale(d,c,o),a.add(n.contactPointA,n.contactPointA,d),-1===t.indexOf(n)&&t.push(n);else{var b=t.indexOf(n);-1!==b&&t.splice(b,1)}if(this.lowerLimitEnabled&&i>g)a.scale(r.normalA,c,1),a.sub(r.contactPointA,h,s.position),a.sub(r.contactPointB,l,f.position),a.scale(d,c,i),a.sub(r.contactPointB,r.contactPointB,d),-1===t.indexOf(r)&&t.push(r);else{var b=t.indexOf(r);-1!==b&&t.splice(b,1)}},o.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},o.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},o.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../math/vec2":30,"./Constraint":14}],19:[function(t,e){function o(t,e,o){o=o||{},i.call(this,t,e,i.REVOLUTE,o);var d=this.maxForce="undefined"!=typeof o.maxForce?o.maxForce:Number.MAX_VALUE;this.pivotA=s.create(),this.pivotB=s.create(),o.worldPivot?(s.sub(this.pivotA,o.worldPivot,t.position),s.sub(this.pivotB,o.worldPivot,e.position),s.rotate(this.pivotA,this.pivotA,-t.angle),s.rotate(this.pivotB,this.pivotB,-e.angle)):(s.copy(this.pivotA,o.localPivotA),s.copy(this.pivotB,o.localPivotB));var f=this.equations=[new n(t,e,-d,d),new n(t,e,-d,d)],v=f[0],y=f[1],m=this;v.computeGq=function(){return s.rotate(c,m.pivotA,t.angle),s.rotate(h,m.pivotB,e.angle),s.add(u,e.position,h),s.sub(u,u,t.position),s.sub(u,u,c),s.dot(u,l)},y.computeGq=function(){return s.rotate(c,m.pivotA,t.angle),s.rotate(h,m.pivotB,e.angle),s.add(u,e.position,h),s.sub(u,u,t.position),s.sub(u,u,c),s.dot(u,p)},y.minForce=v.minForce=-d,y.maxForce=v.maxForce=d,this.motorEquation=new r(t,e),this.motorEnabled=!1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0,this.upperLimitEquation=new a(t,e),this.lowerLimitEquation=new a(t,e),this.upperLimitEquation.minForce=0,this.lowerLimitEquation.maxForce=0}var i=t("./Constraint"),n=t("../equations/Equation"),r=t("../equations/RotationalVelocityEquation"),a=t("../equations/RotationalLockEquation"),s=t("../math/vec2");e.exports=o;var c=s.create(),h=s.create(),l=s.fromValues(1,0),p=s.fromValues(0,1),u=s.create();o.prototype=new i,o.prototype.constructor=o,o.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)},o.prototype.update=function(){var t=this.bodyA,e=this.bodyB,o=this.pivotA,i=this.pivotB,n=this.equations,r=(n[0],n[1],n[0]),a=n[1],u=this.upperLimit,d=this.lowerLimit,f=this.upperLimitEquation,v=this.lowerLimitEquation,y=this.angle=e.angle-t.angle;if(this.upperLimitEnabled&&y>u)f.angle=u,-1===n.indexOf(f)&&n.push(f);else{var m=n.indexOf(f);-1!==m&&n.splice(m,1)}if(this.lowerLimitEnabled&&d>y)v.angle=d,-1===n.indexOf(v)&&n.push(v);else{var m=n.indexOf(v);-1!==m&&n.splice(m,1)}s.rotate(c,o,t.angle),s.rotate(h,i,e.angle),r.G[0]=-1,r.G[1]=0,r.G[2]=-s.crossLength(c,l),r.G[3]=1,r.G[4]=0,r.G[5]=s.crossLength(h,l),a.G[0]=0,a.G[1]=-1,a.G[2]=-s.crossLength(c,p),a.G[3]=0,a.G[4]=1,a.G[5]=s.crossLength(h,p)},o.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},o.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},o.prototype.motorIsEnabled=function(){return!!this.motorEnabled},o.prototype.setMotorSpeed=function(t){if(this.motorEnabled){var e=this.equations.indexOf(this.motorEquation);this.equations[e].relativeVelocity=t}},o.prototype.getMotorSpeed=function(){return this.motorEnabled?this.motorEquation.relativeVelocity:!1}},{"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../equations/RotationalVelocityEquation":25,"../math/vec2":30,"./Constraint":14}],20:[function(t,e){function o(t,e,o){o=o||{},i.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=o.angle||0,this.ratio="number"==typeof o.ratio?o.ratio:1,this.setRatio(this.ratio)}var i=t("./Equation");t("../math/vec2"),e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},o.prototype.setRatio=function(t){var e=this.G;e[2]=t,e[5]=-1,this.ratio=t},o.prototype.setMaxTorque=function(t){this.maxForce=t,this.minForce=-t}},{"../math/vec2":30,"./Equation":22}],21:[function(t,e){function o(t,e){i.call(this,t,e,0,Number.MAX_VALUE),this.contactPointA=n.create(),this.penetrationVec=n.create(),this.contactPointB=n.create(),this.normalA=n.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}var i=t("./Equation"),n=t("../math/vec2");e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.computeB=function(t,e,o){var i=this.bodyA,r=this.bodyB,a=this.contactPointA,s=this.contactPointB,c=i.position,h=r.position,l=this.penetrationVec,p=this.normalA,u=this.G,d=n.crossLength(a,p),f=n.crossLength(s,p);u[0]=-p[0],u[1]=-p[1],u[2]=-d,u[3]=p[0],u[4]=p[1],u[5]=f,n.add(l,h,s),n.sub(l,l,c),n.sub(l,l,a);var v,y;this.firstImpact&&0!==this.restitution?(y=0,v=1/e*(1+this.restitution)*this.computeGW()):(y=n.dot(p,l)+this.offset,v=this.computeGW());var m=this.computeGiMf(),g=-y*t-v*e-o*m;return g}},{"../math/vec2":30,"./Equation":22}],22:[function(t,e){function o(t,e,i,r){this.minForce="undefined"==typeof i?-Number.MAX_VALUE:i,this.maxForce="undefined"==typeof r?Number.MAX_VALUE:r,this.bodyA=t,this.bodyB=e,this.stiffness=o.DEFAULT_STIFFNESS,this.relaxation=o.DEFAULT_RELAXATION,this.G=new n.ARRAY_TYPE(6);for(var a=0;6>a;a++)this.G[a]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0}e.exports=o;var i=t("../math/vec2"),n=t("../utils/Utils");t("../objects/Body"),o.prototype.constructor=o,o.DEFAULT_STIFFNESS=1e6,o.DEFAULT_RELAXATION=4,o.prototype.update=function(){var t=this.stiffness,e=this.relaxation,o=this.timeStep;this.a=4/(o*(1+4*e)),this.b=4*e/(1+4*e),this.epsilon=4/(o*o*t*(1+4*e)),this.needsUpdate=!1},o.prototype.gmult=function(t,e,o,i,n){return t[0]*e[0]+t[1]*e[1]+t[2]*o+t[3]*i[0]+t[4]*i[1]+t[5]*n},o.prototype.computeB=function(t,e,o){var i=this.computeGW(),n=this.computeGq(),r=this.computeGiMf();return-n*t-i*e-r*o};var r=i.create(),a=i.create();o.prototype.computeGq=function(){var t=this.G,e=this.bodyA,o=this.bodyB,i=(e.position,o.position,e.angle),n=o.angle;return this.gmult(t,r,i,a,n)+this.offset},o.prototype.computeGW=function(){var t=this.G,e=this.bodyA,o=this.bodyB,i=e.velocity,n=o.velocity,r=e.angularVelocity,a=o.angularVelocity;return this.gmult(t,i,r,n,a)+this.relativeVelocity},o.prototype.computeGWlambda=function(){var t=this.G,e=this.bodyA,o=this.bodyB,i=e.vlambda,n=o.vlambda,r=e.wlambda,a=o.wlambda;return this.gmult(t,i,r,n,a)};var s=i.create(),c=i.create();o.prototype.computeGiMf=function(){var t=this.bodyA,e=this.bodyB,o=t.force,n=t.angularForce,r=e.force,a=e.angularForce,h=t.invMassSolve,l=e.invMassSolve,p=t.invInertiaSolve,u=e.invInertiaSolve,d=this.G;return i.scale(s,o,h),i.multiply(s,t.massMultiplier,s),i.scale(c,r,l),i.multiply(c,e.massMultiplier,c),this.gmult(d,s,n*p,c,a*u)},o.prototype.computeGiMGt=function(){var t=this.bodyA,e=this.bodyB,o=t.invMassSolve,i=e.invMassSolve,n=t.invInertiaSolve,r=e.invInertiaSolve,a=this.G;return a[0]*a[0]*o*t.massMultiplier[0]+a[1]*a[1]*o*t.massMultiplier[1]+a[2]*a[2]*n+a[3]*a[3]*i*e.massMultiplier[0]+a[4]*a[4]*i*e.massMultiplier[1]+a[5]*a[5]*r};var h=i.create(),l=i.create(),p=i.create();i.create(),i.create(),i.create(),o.prototype.addToWlambda=function(t){var e=this.bodyA,o=this.bodyB,n=h,r=l,a=p,s=e.invMassSolve,c=o.invMassSolve,u=e.invInertiaSolve,d=o.invInertiaSolve,f=this.G;r[0]=f[0],r[1]=f[1],a[0]=f[3],a[1]=f[4],i.scale(n,r,s*t),i.multiply(n,n,e.massMultiplier),i.add(e.vlambda,e.vlambda,n),e.wlambda+=u*f[2]*t,i.scale(n,a,c*t),i.multiply(n,n,o.massMultiplier),i.add(o.vlambda,o.vlambda,n),o.wlambda+=d*f[5]*t},o.prototype.computeInvC=function(t){return 1/(this.computeGiMGt()+t)}},{"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],23:[function(t,e){function o(t,e,o){n.call(this,t,e,-o,o),this.contactPointA=i.create(),this.contactPointB=i.create(),this.t=i.create(),this.contactEquations=[],this.shapeA=null,this.shapeB=null,this.frictionCoefficient=.3}var i=t("../math/vec2"),n=t("./Equation");t("../utils/Utils"),e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.setSlipForce=function(t){this.maxForce=t,this.minForce=-t},o.prototype.getSlipForce=function(){return this.maxForce},o.prototype.computeB=function(t,e,o){var n=(this.bodyA,this.bodyB,this.contactPointA),r=this.contactPointB,a=this.t,s=this.G;s[0]=-a[0],s[1]=-a[1],s[2]=-i.crossLength(n,a),s[3]=a[0],s[4]=a[1],s[5]=i.crossLength(r,a);var c=this.computeGW(),h=this.computeGiMf(),l=-c*e-o*h;return l}},{"../math/vec2":30,"../utils/Utils":57,"./Equation":22}],24:[function(t,e){function o(t,e,o){o=o||{},i.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=o.angle||0;var n=this.G;n[2]=1,n[5]=-1}var i=t("./Equation"),n=t("../math/vec2");e.exports=o,o.prototype=new i,o.prototype.constructor=o;var r=n.create(),a=n.create(),s=n.fromValues(1,0),c=n.fromValues(0,1);o.prototype.computeGq=function(){return n.rotate(r,s,this.bodyA.angle+this.angle),n.rotate(a,c,this.bodyB.angle),n.dot(r,a)}},{"../math/vec2":30,"./Equation":22}],25:[function(t,e){function o(t,e){i.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}var i=t("./Equation");t("../math/vec2"),e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.computeB=function(t,e,o){var i=this.G;i[2]=-1,i[5]=this.ratio;var n=this.computeGiMf(),r=this.computeGW(),a=-r*e-o*n;return a}},{"../math/vec2":30,"./Equation":22}],26:[function(t,e){var o=function(){};e.exports=o,o.prototype={constructor:o,on:function(t,e,o){e.context=o||this,void 0===this._listeners&&(this._listeners={});var i=this._listeners;return void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e),this},has:function(t,e){if(void 0===this._listeners)return!1;var o=this._listeners;if(e){if(void 0!==o[t]&&-1!==o[t].indexOf(e))return!0}else if(void 0!==o[t])return!0;return!1},off:function(t,e){if(void 0===this._listeners)return this;var o=this._listeners,i=o[t].indexOf(e);return-1!==i&&o[t].splice(i,1),this},emit:function(t){if(void 0===this._listeners)return this;var e=this._listeners,o=e[t.type];if(void 0!==o){t.target=this;for(var i=0,n=o.length;n>i;i++){var r=o[i];r.call(r.context,t)}}return this}}},{}],27:[function(t,e){function o(t,e,r){if(r=r||{},!(t instanceof i&&e instanceof i))throw new Error("First two arguments must be Material instances.");this.id=o.idCounter++,this.materialA=t,this.materialB=e,this.friction="undefined"!=typeof r.friction?Number(r.friction):.3,this.restitution="undefined"!=typeof r.restitution?Number(r.restitution):0,this.stiffness="undefined"!=typeof r.stiffness?Number(r.stiffness):n.DEFAULT_STIFFNESS,this.relaxation="undefined"!=typeof r.relaxation?Number(r.relaxation):n.DEFAULT_RELAXATION,this.frictionStiffness="undefined"!=typeof r.frictionStiffness?Number(r.frictionStiffness):n.DEFAULT_STIFFNESS,this.frictionRelaxation="undefined"!=typeof r.frictionRelaxation?Number(r.frictionRelaxation):n.DEFAULT_RELAXATION,this.surfaceVelocity="undefined"!=typeof r.surfaceVelocity?Number(r.surfaceVelocity):0,this.contactSkinSize=.005}var i=t("./Material"),n=t("../equations/Equation");e.exports=o,o.idCounter=0},{"../equations/Equation":22,"./Material":28}],28:[function(t,e){function o(t){this.id=t||o.idCounter++}e.exports=o,o.idCounter=0},{}],29:[function(t,e){var o={};o.GetArea=function(t){if(t.length<6)return 0;for(var e=t.length-2,o=0,i=0;e>i;i+=2)o+=(t[i+2]-t[i])*(t[i+1]+t[i+3]);return o+=(t[0]-t[e])*(t[e+1]+t[1]),.5*-o},o.Triangulate=function(t){var e=t.length>>1;if(3>e)return[];for(var i=[],n=[],r=0;e>r;r++)n.push(r);for(var r=0,a=e;a>3;){var s=n[(r+0)%a],c=n[(r+1)%a],h=n[(r+2)%a],l=t[2*s],p=t[2*s+1],u=t[2*c],d=t[2*c+1],f=t[2*h],v=t[2*h+1],y=!1;if(o._convex(l,p,u,d,f,v)){y=!0;for(var m=0;a>m;m++){var g=n[m];if(g!=s&&g!=c&&g!=h&&o._PointInTriangle(t[2*g],t[2*g+1],l,p,u,d,f,v)){y=!1;break}}}if(y)i.push(s,c,h),n.splice((r+1)%a,1),a--,r=0;else if(r++>3*a)break}return i.push(n[0],n[1],n[2]),i},o._PointInTriangle=function(t,e,o,i,n,r,a,s){var c=a-o,h=s-i,l=n-o,p=r-i,u=t-o,d=e-i,f=c*c+h*h,v=c*l+h*p,y=c*u+h*d,m=l*l+p*p,g=l*u+p*d,A=1/(f*m-v*v),b=(m*y-v*g)*A,E=(f*g-v*y)*A;return b>=0&&E>=0&&1>b+E},o._convex=function(t,e,o,i,n,r){return(e-i)*(n-o)+(o-t)*(r-i)>=0},e.exports=o},{}],30:[function(t,e){var o=e.exports={},i=t("../utils/Utils");o.crossLength=function(t,e){return t[0]*e[1]-t[1]*e[0]},o.crossVZ=function(t,e,i){return o.rotate(t,e,-Math.PI/2),o.scale(t,t,i),t},o.crossZV=function(t,e,i){return o.rotate(t,i,Math.PI/2),o.scale(t,t,e),t},o.rotate=function(t,e,o){if(0!==o){var i=Math.cos(o),n=Math.sin(o),r=e[0],a=e[1];t[0]=i*r-n*a,t[1]=n*r+i*a}else t[0]=e[0],t[1]=e[1]},o.rotate90cw=function(t,e){var o=e[0],i=e[1];t[0]=i,t[1]=-o},o.toLocalFrame=function(t,e,i,n){o.copy(t,e),o.sub(t,t,i),o.rotate(t,t,-n)},o.toGlobalFrame=function(t,e,i,n){o.copy(t,e),o.rotate(t,t,n),o.add(t,t,i)},o.vectorToLocalFrame=function(t,e,i){o.rotate(t,e,-i)},o.vectorToGlobalFrame=function(t,e,i){o.rotate(t,e,i)},o.centroid=function(t,e,i,n){return o.add(t,e,i),o.add(t,t,n),o.scale(t,t,1/3),t},o.create=function(){var t=new i.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},o.clone=function(t){var e=new i.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},o.fromValues=function(t,e){var o=new i.ARRAY_TYPE(2);return o[0]=t,o[1]=e,o},o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},o.set=function(t,e,o){return t[0]=e,t[1]=o,t},o.add=function(t,e,o){return t[0]=e[0]+o[0],t[1]=e[1]+o[1],t},o.subtract=function(t,e,o){return t[0]=e[0]-o[0],t[1]=e[1]-o[1],t},o.sub=o.subtract,o.multiply=function(t,e,o){return t[0]=e[0]*o[0],t[1]=e[1]*o[1],t},o.mul=o.multiply,o.divide=function(t,e,o){return t[0]=e[0]/o[0],t[1]=e[1]/o[1],t},o.div=o.divide,o.scale=function(t,e,o){return t[0]=e[0]*o,t[1]=e[1]*o,t},o.distance=function(t,e){var o=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(o*o+i*i)},o.dist=o.distance,o.squaredDistance=function(t,e){var o=e[0]-t[0],i=e[1]-t[1];return o*o+i*i},o.sqrDist=o.squaredDistance,o.length=function(t){var e=t[0],o=t[1];return Math.sqrt(e*e+o*o)},o.len=o.length,o.squaredLength=function(t){var e=t[0],o=t[1];return e*e+o*o},o.sqrLen=o.squaredLength,o.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},o.normalize=function(t,e){var o=e[0],i=e[1],n=o*o+i*i;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t},o.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},o.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},o.lerp=function(t,e,o,i){var n=e[0],r=e[1];return t[0]=n+i*(o[0]-n),t[1]=r+i*(o[1]-r),t},o.reflect=function(t,e,o){var i=e[0]*o[0]+e[1]*o[1];t[0]=e[0]-2*o[0]*i,t[1]=e[1]-2*o[1]*i},o.getLineSegmentsIntersection=function(t,e,i,n,r){var a=o.getLineSegmentsIntersectionFraction(e,i,n,r);return 0>a?!1:(t[0]=e[0]+a*(i[0]-e[0]),t[1]=e[1]+a*(i[1]-e[1]),!0)},o.getLineSegmentsIntersectionFraction=function(t,e,o,i){var n,r,a=e[0]-t[0],s=e[1]-t[1],c=i[0]-o[0],h=i[1]-o[1];return n=(-s*(t[0]-o[0])+a*(t[1]-o[1]))/(-c*s+a*h),r=(c*(t[1]-o[1])-h*(t[0]-o[0]))/(-c*s+a*h),n>=0&&1>=n&&r>=0&&1>=r?r:-1}},{"../utils/Utils":57}],31:[function(t,e){function o(t){t=t||{},h.call(this),this.id=t.id||++o._idCounter,this.world=null,this.shapes=[],this.mass=t.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.invMassSolve=0,this.invInertiaSolve=0,this.fixedRotation=!!t.fixedRotation,this.fixedX=!!t.fixedX,this.fixedY=!!t.fixedY,this.massMultiplier=i.create(),this.position=i.fromValues(0,0),t.position&&i.copy(this.position,t.position),this.interpolatedPosition=i.fromValues(0,0),this.interpolatedAngle=0,this.previousPosition=i.fromValues(0,0),this.previousAngle=0,this.velocity=i.fromValues(0,0),t.velocity&&i.copy(this.velocity,t.velocity),this.vlambda=i.fromValues(0,0),this.wlambda=0,this.angle=t.angle||0,this.angularVelocity=t.angularVelocity||0,this.force=i.create(),t.force&&i.copy(this.force,t.force),this.angularForce=t.angularForce||0,this.damping="number"==typeof t.damping?t.damping:.1,this.angularDamping="number"==typeof t.angularDamping?t.angularDamping:.1,this.type=o.STATIC,this.type="undefined"!=typeof t.type?t.type:t.mass?o.DYNAMIC:o.STATIC,this.boundingRadius=0,this.aabb=new c,this.aabbNeedsUpdate=!0,this.allowSleep=void 0!==t.allowSleep?t.allowSleep:!0,this.wantsToSleep=!1,this.sleepState=o.AWAKE,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.2,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.gravityScale=void 0!==t.gravityScale?t.gravityScale:1,this.collisionResponse=void 0!==t.collisionResponse?t.collisionResponse:!0,this.idleTime=0,this.timeLastSleepy=0,this.ccdSpeedThreshold=void 0!==t.ccdSpeedThreshold?t.ccdSpeedThreshold:-1,this.ccdIterations=void 0!==t.ccdIterations?t.ccdIterations:10,this.concavePath=null,this._wakeUpAfterNarrowphase=!1,this.updateMassProperties()
}var i=t("../math/vec2"),n=t("poly-decomp"),r=t("../shapes/Convex"),a=t("../collision/RaycastResult"),s=t("../collision/Ray"),c=t("../collision/AABB"),h=t("../events/EventEmitter");e.exports=o,o.prototype=new h,o.prototype.constructor=o,o._idCounter=0,o.prototype.updateSolveMassProperties=function(){this.sleepState===o.SLEEPING||this.type===o.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)},o.prototype.setDensity=function(t){var e=this.getArea();this.mass=e*t,this.updateMassProperties()},o.prototype.getArea=function(){for(var t=0,e=0;e<this.shapes.length;e++)t+=this.shapes[e].area;return t},o.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var l=new c,p=i.create();o.prototype.updateAABB=function(){for(var t=this.shapes,e=t.length,o=p,n=this.angle,r=0;r!==e;r++){var a=t[r],s=a.angle+n;i.rotate(o,a.position,n),i.add(o,o,this.position),a.computeAABB(l,o,s),0===r?this.aabb.copy(l):this.aabb.extend(l)}this.aabbNeedsUpdate=!1},o.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=t.length,o=0,n=0;n!==e;n++){var r=t[n],a=i.length(r.position),s=r.boundingRadius;a+s>o&&(o=a+s)}this.boundingRadius=o},o.prototype.addShape=function(t,e,o){if(t.body)throw new Error("A shape can only be added to one body.");t.body=this,e?i.copy(t.position,e):i.set(t.position,0,0),t.angle=o||0,this.shapes.push(t),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},o.prototype.removeShape=function(t){var e=this.shapes.indexOf(t);return-1!==e?(this.shapes.splice(e,1),this.aabbNeedsUpdate=!0,t.body=null,!0):!1},o.prototype.updateMassProperties=function(){if(this.type===o.STATIC||this.type===o.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var t=this.shapes,e=t.length,n=this.mass/e,r=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(var a=0;e>a;a++){var s=t[a],c=i.squaredLength(s.position),h=s.computeMomentOfInertia(n);r+=h+n*c}this.inertia=r,this.invInertia=r>0?1/r:0}this.invMass=1/this.mass,i.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}},i.create(),o.prototype.applyForce=function(t,e){if(i.add(this.force,this.force,t),e){var o=i.crossLength(e,t);this.angularForce+=o}};var u=i.create(),d=i.create(),f=i.create();o.prototype.applyForceLocal=function(t,e){e=e||f;var o=u,i=d;this.vectorToWorldFrame(o,t),this.vectorToWorldFrame(i,e),this.applyForce(o,i)};var v=i.create();o.prototype.applyImpulse=function(t,e){if(this.type===o.DYNAMIC){var n=v;if(i.scale(n,t,this.invMass),i.multiply(n,this.massMultiplier,n),i.add(this.velocity,n,this.velocity),e){var r=i.crossLength(e,t);r*=this.invInertia,this.angularVelocity+=r}}};var y=i.create(),m=i.create(),g=i.create();o.prototype.applyImpulseLocal=function(t,e){e=e||g;var o=y,i=m;this.vectorToWorldFrame(o,t),this.vectorToWorldFrame(i,e),this.applyImpulse(o,i)},o.prototype.toLocalFrame=function(t,e){i.toLocalFrame(t,e,this.position,this.angle)},o.prototype.toWorldFrame=function(t,e){i.toGlobalFrame(t,e,this.position,this.angle)},o.prototype.vectorToLocalFrame=function(t,e){i.vectorToLocalFrame(t,e,this.angle)},o.prototype.vectorToWorldFrame=function(t,e){i.vectorToGlobalFrame(t,e,this.angle)},o.prototype.fromPolygon=function(t,e){e=e||{};for(var o=this.shapes.length;o>=0;--o)this.removeShape(this.shapes[o]);var a=new n.Polygon;if(a.vertices=t,a.makeCCW(),"number"==typeof e.removeCollinearPoints&&a.removeCollinearPoints(e.removeCollinearPoints),"undefined"==typeof e.skipSimpleCheck&&!a.isSimple())return!1;this.concavePath=a.vertices.slice(0);for(var o=0;o<this.concavePath.length;o++){var s=[0,0];i.copy(s,this.concavePath[o]),this.concavePath[o]=s}var c;c=e.optimalDecomp?a.decomp():a.quickDecomp();for(var h=i.create(),o=0;o!==c.length;o++){for(var l=new r({vertices:c[o].vertices}),p=0;p!==l.vertices.length;p++){var s=l.vertices[p];i.sub(s,s,l.centerOfMass)}i.scale(h,l.centerOfMass,1),l.updateTriangles(),l.updateCenterOfMass(),l.updateBoundingRadius(),this.addShape(l,h)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0};var A=(i.fromValues(0,0),i.fromValues(0,0)),b=i.fromValues(0,0),E=i.fromValues(0,0);o.prototype.adjustCenterOfMass=function(){var t=A,e=b,o=E,n=0;i.set(e,0,0);for(var r=0;r!==this.shapes.length;r++){var a=this.shapes[r];i.scale(t,a.position,a.area),i.add(e,e,t),n+=a.area}i.scale(o,e,1/n);for(var r=0;r!==this.shapes.length;r++){var a=this.shapes[r];i.sub(a.position,a.position,o)}i.add(this.position,this.position,o);for(var r=0;this.concavePath&&r<this.concavePath.length;r++)i.sub(this.concavePath[r],this.concavePath[r],o);this.updateMassProperties(),this.updateBoundingRadius()},o.prototype.setZeroForce=function(){i.set(this.force,0,0),this.angularForce=0},o.prototype.resetConstraintVelocity=function(){var t=this,e=t.vlambda;i.set(e,0,0),t.wlambda=0},o.prototype.addConstraintVelocity=function(){var t=this,e=t.velocity;i.add(e,e,t.vlambda),t.angularVelocity+=t.wlambda},o.prototype.applyDamping=function(t){if(this.type===o.DYNAMIC){var e=this.velocity;i.scale(e,e,Math.pow(1-this.damping,t)),this.angularVelocity*=Math.pow(1-this.angularDamping,t)}},o.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=o.AWAKE,this.idleTime=0,t!==o.AWAKE&&this.emit(o.wakeUpEvent)},o.prototype.sleep=function(){this.sleepState=o.SLEEPING,this.angularVelocity=0,this.angularForce=0,i.set(this.velocity,0,0),i.set(this.force,0,0),this.emit(o.sleepEvent)},o.prototype.sleepTick=function(t,e,n){if(this.allowSleep&&this.type!==o.SLEEPING){this.wantsToSleep=!1;var r=(this.sleepState,i.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2)),a=Math.pow(this.sleepSpeedLimit,2);r>=a?(this.idleTime=0,this.sleepState=o.AWAKE):(this.idleTime+=n,this.sleepState=o.SLEEPY),this.idleTime>this.sleepTimeLimit&&(e?this.wantsToSleep=!0:this.sleep())}},o.prototype.overlaps=function(t){return this.world.overlapKeeper.bodiesAreOverlapping(this,t)};var B=i.create(),q=i.create();o.prototype.integrate=function(t){var e=this.invMass,o=this.force,n=this.position,r=this.velocity;i.copy(this.previousPosition,this.position),this.previousAngle=this.angle,this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*t),i.scale(B,o,t*e),i.multiply(B,this.massMultiplier,B),i.add(r,B,r),this.integrateToTimeOfImpact(t)||(i.scale(q,r,t),i.add(n,n,q),this.fixedRotation||(this.angle+=this.angularVelocity*t)),this.aabbNeedsUpdate=!0};var P=new a,w=new s({mode:s.ALL}),S=i.create(),C=i.create(),L=i.create(),x=i.create();o.prototype.integrateToTimeOfImpact=function(t){if(this.ccdSpeedThreshold<0||i.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2))return!1;i.normalize(S,this.velocity),i.scale(C,this.velocity,t),i.add(C,C,this.position),i.sub(L,C,this.position);var e,o=this.angularVelocity*t,n=i.length(L),r=1,a=this;if(P.reset(),w.callback=function(t){t.body!==a&&(e=t.body,t.getHitPoint(C,w),i.sub(L,C,a.position),r=i.length(L)/n,t.stop())},i.copy(w.from,this.position),i.copy(w.to,C),w.update(),this.world.raycast(P,w),!e)return!1;var s=this.angle;i.copy(x,this.position);for(var c=0,h=0,l=0,p=r;p>=h&&c<this.ccdIterations;){c++,l=(p-h)/2,i.scale(q,L,r),i.add(this.position,x,q),this.angle=s+o*r,this.updateAABB();var u=this.aabb.overlaps(e.aabb)&&this.world.narrowphase.bodiesOverlap(this,e);u?h=l:p=l}return r=l,i.copy(this.position,x),this.angle=s,i.scale(q,L,r),i.add(this.position,this.position,q),this.fixedRotation||(this.angle+=o*r),!0},o.prototype.getVelocityAtPoint=function(t,e){return i.crossVZ(t,e,this.angularVelocity),i.subtract(t,this.velocity,t),t},o.sleepyEvent={type:"sleepy"},o.sleepEvent={type:"sleep"},o.wakeUpEvent={type:"wakeup"},o.DYNAMIC=1,o.STATIC=2,o.KINEMATIC=4,o.AWAKE=0,o.SLEEPY=1,o.SLEEPING=2},{"../collision/AABB":7,"../collision/Ray":11,"../collision/RaycastResult":12,"../events/EventEmitter":26,"../math/vec2":30,"../shapes/Convex":40,"poly-decomp":5}],32:[function(t,e){function o(t,e,o){o=o||{},n.call(this,t,e,o),this.localAnchorA=i.fromValues(0,0),this.localAnchorB=i.fromValues(0,0),o.localAnchorA&&i.copy(this.localAnchorA,o.localAnchorA),o.localAnchorB&&i.copy(this.localAnchorB,o.localAnchorB),o.worldAnchorA&&this.setWorldAnchorA(o.worldAnchorA),o.worldAnchorB&&this.setWorldAnchorB(o.worldAnchorB);var r=i.create(),a=i.create();this.getWorldAnchorA(r),this.getWorldAnchorB(a);var s=i.distance(r,a);this.restLength="number"==typeof o.restLength?o.restLength:s}var i=t("../math/vec2"),n=t("./Spring");t("../utils/Utils"),e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.setWorldAnchorA=function(t){this.bodyA.toLocalFrame(this.localAnchorA,t)},o.prototype.setWorldAnchorB=function(t){this.bodyB.toLocalFrame(this.localAnchorB,t)},o.prototype.getWorldAnchorA=function(t){this.bodyA.toWorldFrame(t,this.localAnchorA)},o.prototype.getWorldAnchorB=function(t){this.bodyB.toWorldFrame(t,this.localAnchorB)};var r=i.create(),a=i.create(),s=i.create(),c=i.create(),h=i.create(),l=i.create(),p=i.create(),u=i.create(),d=i.create();o.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,o=this.restLength,n=this.bodyA,f=this.bodyB,v=r,y=a,m=s,g=c,A=d,b=h,E=l,B=p,q=u;this.getWorldAnchorA(b),this.getWorldAnchorB(E),i.sub(B,b,n.position),i.sub(q,E,f.position),i.sub(v,E,b);var P=i.len(v);i.normalize(y,v),i.sub(m,f.velocity,n.velocity),i.crossZV(A,f.angularVelocity,q),i.add(m,m,A),i.crossZV(A,n.angularVelocity,B),i.sub(m,m,A),i.scale(g,y,-t*(P-o)-e*i.dot(m,y)),i.sub(n.force,n.force,g),i.add(f.force,f.force,g);var w=i.crossLength(B,g),S=i.crossLength(q,g);n.angularForce-=w,f.angularForce+=S}},{"../math/vec2":30,"../utils/Utils":57,"./Spring":34}],33:[function(t,e){function o(t,e,o){o=o||{},i.call(this,t,e,o),this.restAngle="number"==typeof o.restAngle?o.restAngle:e.angle-t.angle}var i=(t("../math/vec2"),t("./Spring"));e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,o=this.restAngle,i=this.bodyA,n=this.bodyB,r=n.angle-i.angle,a=n.angularVelocity-i.angularVelocity,s=-t*(r-o)-e*a*0;i.angularForce-=s,n.angularForce+=s}},{"../math/vec2":30,"./Spring":34}],34:[function(t,e){function o(t,e,o){o=i.defaults(o,{stiffness:100,damping:1}),this.stiffness=o.stiffness,this.damping=o.damping,this.bodyA=t,this.bodyB=e}var i=(t("../math/vec2"),t("../utils/Utils"));e.exports=o,o.prototype.applyForce=function(){}},{"../math/vec2":30,"../utils/Utils":57}],35:[function(t,e){function o(t,e){e=e||{},this.chassisBody=t,this.wheels=[],this.groundBody=new s({mass:0}),this.world=null;var o=this;this.preStepCallback=function(){o.update()}}function i(t,e){e=e||{},this.vehicle=t,this.forwardEquation=new a(t.chassisBody,t.groundBody),this.sideEquation=new a(t.chassisBody,t.groundBody),this.steerValue=0,this.engineForce=0,this.setSideFriction(void 0!==e.sideFriction?e.sideFriction:5),this.localForwardVector=n.fromValues(0,1),e.localForwardVector&&n.copy(this.localForwardVector,e.localForwardVector),this.localPosition=n.fromValues(0,0),e.localPosition&&n.copy(this.localPosition,e.localPosition),r.apply(this,t.chassisBody,t.groundBody),this.equations.push(this.forwardEquation,this.sideEquation),this.setBrakeForce(0)}var n=t("../math/vec2"),r=(t("../utils/Utils"),t("../constraints/Constraint")),a=t("../equations/FrictionEquation"),s=t("../objects/Body");e.exports=o,o.prototype.addToWorld=function(t){this.world=t,t.addBody(this.groundBody),t.on("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var o=this.wheels[e];t.addConstraint(o)}},o.prototype.removeFromWorld=function(){var t=this.world;t.removeBody(this.groundBody),t.off("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var o=this.wheels[e];t.removeConstraint(o)}this.world=null},o.prototype.addWheel=function(t){var e=new i(this,t);return this.wheels.push(e),e},o.prototype.update=function(){for(var t=0;t<this.wheels.length;t++)this.wheels[t].update()},i.prototype=new r,i.prototype.setBrakeForce=function(t){this.forwardEquation.setSlipForce(t)},i.prototype.setSideFriction=function(t){this.sideEquation.setSlipForce(t)};var c=n.create(),h=n.create();i.prototype.getSpeed=function(){return this.vehicle.chassisBody.vectorToWorldFrame(h,this.localForwardVector),this.vehicle.chassisBody.getVelocityAtPoint(c,h),n.dot(c,h)};var l=n.create();i.prototype.update=function(){this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.t,this.localForwardVector),n.rotate(this.sideEquation.t,this.localForwardVector,Math.PI/2),this.vehicle.chassisBody.vectorToWorldFrame(this.sideEquation.t,this.sideEquation.t),n.rotate(this.forwardEquation.t,this.forwardEquation.t,this.steerValue),n.rotate(this.sideEquation.t,this.sideEquation.t,this.steerValue),this.vehicle.chassisBody.toWorldFrame(this.forwardEquation.contactPointB,this.localPosition),n.copy(this.sideEquation.contactPointB,this.forwardEquation.contactPointB),this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.contactPointA,this.localPosition),n.copy(this.sideEquation.contactPointA,this.forwardEquation.contactPointA),n.normalize(l,this.forwardEquation.t),n.scale(l,l,this.engineForce),this.vehicle.chassisBody.applyForce(l,this.forwardEquation.contactPointA)}},{"../constraints/Constraint":14,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],36:[function(t,e){var o=e.exports={AABB:t("./collision/AABB"),AngleLockEquation:t("./equations/AngleLockEquation"),Body:t("./objects/Body"),Broadphase:t("./collision/Broadphase"),Capsule:t("./shapes/Capsule"),Circle:t("./shapes/Circle"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),ContactEquationPool:t("./utils/ContactEquationPool"),ContactMaterial:t("./material/ContactMaterial"),Convex:t("./shapes/Convex"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventEmitter:t("./events/EventEmitter"),FrictionEquation:t("./equations/FrictionEquation"),FrictionEquationPool:t("./utils/FrictionEquationPool"),GearConstraint:t("./constraints/GearConstraint"),GSSolver:t("./solver/GSSolver"),Heightfield:t("./shapes/Heightfield"),Line:t("./shapes/Line"),LockConstraint:t("./constraints/LockConstraint"),Material:t("./material/Material"),Narrowphase:t("./collision/Narrowphase"),NaiveBroadphase:t("./collision/NaiveBroadphase"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),Pool:t("./utils/Pool"),RevoluteConstraint:t("./constraints/RevoluteConstraint"),PrismaticConstraint:t("./constraints/PrismaticConstraint"),Ray:t("./collision/Ray"),RaycastResult:t("./collision/RaycastResult"),Box:t("./shapes/Box"),RotationalVelocityEquation:t("./equations/RotationalVelocityEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Spring:t("./objects/Spring"),TopDownVehicle:t("./objects/TopDownVehicle"),LinearSpring:t("./objects/LinearSpring"),RotationalSpring:t("./objects/RotationalSpring"),Utils:t("./utils/Utils"),World:t("./world/World"),vec2:t("./math/vec2"),version:t("../package.json").version};Object.defineProperty(o,"Rectangle",{get:function(){return console.warn("The Rectangle class has been renamed to Box."),this.Box}})},{"../package.json":6,"./collision/AABB":7,"./collision/Broadphase":8,"./collision/NaiveBroadphase":9,"./collision/Narrowphase":10,"./collision/Ray":11,"./collision/RaycastResult":12,"./collision/SAPBroadphase":13,"./constraints/Constraint":14,"./constraints/DistanceConstraint":15,"./constraints/GearConstraint":16,"./constraints/LockConstraint":17,"./constraints/PrismaticConstraint":18,"./constraints/RevoluteConstraint":19,"./equations/AngleLockEquation":20,"./equations/ContactEquation":21,"./equations/Equation":22,"./equations/FrictionEquation":23,"./equations/RotationalVelocityEquation":25,"./events/EventEmitter":26,"./material/ContactMaterial":27,"./material/Material":28,"./math/vec2":30,"./objects/Body":31,"./objects/LinearSpring":32,"./objects/RotationalSpring":33,"./objects/Spring":34,"./objects/TopDownVehicle":35,"./shapes/Box":37,"./shapes/Capsule":38,"./shapes/Circle":39,"./shapes/Convex":40,"./shapes/Heightfield":41,"./shapes/Line":42,"./shapes/Particle":43,"./shapes/Plane":44,"./shapes/Shape":45,"./solver/GSSolver":46,"./solver/Solver":47,"./utils/ContactEquationPool":48,"./utils/FrictionEquationPool":49,"./utils/Pool":55,"./utils/Utils":57,"./world/World":61}],37:[function(t,e){function o(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={width:arguments[0],height:arguments[1]},console.warn("The Rectangle has been renamed to Box and its constructor signature has changed. Please use the following format: new Box({ width: 1, height: 1, ... })")),t=t||{};var e=this.width=t.width||1,o=this.height=t.height||1,a=[i.fromValues(-e/2,-o/2),i.fromValues(e/2,-o/2),i.fromValues(e/2,o/2),i.fromValues(-e/2,o/2)],s=[i.fromValues(1,0),i.fromValues(0,1)];t.vertices=a,t.axes=s,t.type=n.BOX,r.call(this,t)}var i=t("../math/vec2"),n=t("./Shape"),r=t("./Convex");e.exports=o,o.prototype=new r,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(t){var e=this.width,o=this.height;return t*(o*o+e*e)/12},o.prototype.updateBoundingRadius=function(){var t=this.width,e=this.height;this.boundingRadius=Math.sqrt(t*t+e*e)/2},i.create(),i.create(),i.create(),i.create(),o.prototype.computeAABB=function(t,e,o){t.setFromPoints(this.vertices,e,o,0)},o.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":30,"./Convex":40,"./Shape":45}],38:[function(t,e){function o(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={length:arguments[0],radius:arguments[1]},console.warn("The Capsule constructor signature has changed. Please use the following format: new Capsule({ radius: 1, length: 1 })")),t=t||{},this.length=t.length||1,this.radius=t.radius||1,t.type=i.CAPSULE,i.call(this,t)}var i=t("./Shape"),n=t("../math/vec2");e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(t){var e=this.radius,o=this.length+e,i=2*e;return t*(i*i+o*o)/12},o.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},o.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var r=n.create();o.prototype.computeAABB=function(t,e,o){var i=this.radius;n.set(r,this.length/2,0),0!==o&&n.rotate(r,r,o),n.set(t.upperBound,Math.max(r[0]+i,-r[0]+i),Math.max(r[1]+i,-r[1]+i)),n.set(t.lowerBound,Math.min(r[0]-i,-r[0]-i),Math.min(r[1]-i,-r[1]-i)),n.add(t.lowerBound,t.lowerBound,e),n.add(t.upperBound,t.upperBound,e)};var a=n.create(),s=n.create(),c=n.create(),h=n.create(),l=n.fromValues(0,1);o.prototype.raycast=function(t,e,o,i){for(var r=e.from,p=e.to,u=(e.direction,a),d=s,f=c,v=h,y=this.length/2,m=0;2>m;m++){var g=this.radius*(2*m-1);n.set(f,-y,g),n.set(v,y,g),n.toGlobalFrame(f,f,o,i),n.toGlobalFrame(v,v,o,i);var A=n.getLineSegmentsIntersectionFraction(r,p,f,v);if(A>=0&&(n.rotate(d,l,i),n.scale(d,d,2*m-1),e.reportIntersection(t,A,d,-1),t.shouldStop(e)))return}for(var b=Math.pow(this.radius,2)+Math.pow(y,2),m=0;2>m;m++){n.set(f,y*(2*m-1),0),n.toGlobalFrame(f,f,o,i);var E=Math.pow(p[0]-r[0],2)+Math.pow(p[1]-r[1],2),B=2*((p[0]-r[0])*(r[0]-f[0])+(p[1]-r[1])*(r[1]-f[1])),q=Math.pow(r[0]-f[0],2)+Math.pow(r[1]-f[1],2)-Math.pow(this.radius,2),A=Math.pow(B,2)-4*E*q;if(!(0>A))if(0===A){if(n.lerp(u,r,p,A),n.squaredDistance(u,o)>b&&(n.sub(d,u,f),n.normalize(d,d),e.reportIntersection(t,A,d,-1),t.shouldStop(e)))return}else{var P=Math.sqrt(A),w=1/(2*E),S=(-B-P)*w,C=(-B+P)*w;if(S>=0&&1>=S&&(n.lerp(u,r,p,S),n.squaredDistance(u,o)>b&&(n.sub(d,u,f),n.normalize(d,d),e.reportIntersection(t,S,d,-1),t.shouldStop(e))))return;if(C>=0&&1>=C&&(n.lerp(u,r,p,C),n.squaredDistance(u,o)>b&&(n.sub(d,u,f),n.normalize(d,d),e.reportIntersection(t,C,d,-1),t.shouldStop(e))))return}}}},{"../math/vec2":30,"./Shape":45}],39:[function(t,e){function o(t){"number"==typeof arguments[0]&&(t={radius:arguments[0]},console.warn("The Circle constructor signature has changed. Please use the following format: new Circle({ radius: 1 })")),t=t||{},this.radius=t.radius||1,t.type=i.CIRCLE,i.call(this,t)}var i=t("./Shape"),n=t("../math/vec2");e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(t){var e=this.radius;return t*e*e/2},o.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},o.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius},o.prototype.computeAABB=function(t,e){var o=this.radius;n.set(t.upperBound,o,o),n.set(t.lowerBound,-o,-o),e&&(n.add(t.lowerBound,t.lowerBound,e),n.add(t.upperBound,t.upperBound,e))};var r=n.create(),a=n.create();o.prototype.raycast=function(t,e,o){var i=e.from,s=e.to,c=this.radius,h=Math.pow(s[0]-i[0],2)+Math.pow(s[1]-i[1],2),l=2*((s[0]-i[0])*(i[0]-o[0])+(s[1]-i[1])*(i[1]-o[1])),p=Math.pow(i[0]-o[0],2)+Math.pow(i[1]-o[1],2)-Math.pow(c,2),u=Math.pow(l,2)-4*h*p,d=r,f=a;if(!(0>u))if(0===u)n.lerp(d,i,s,u),n.sub(f,d,o),n.normalize(f,f),e.reportIntersection(t,u,f,-1);else{var v=Math.sqrt(u),y=1/(2*h),m=(-l-v)*y,g=(-l+v)*y;if(m>=0&&1>=m&&(n.lerp(d,i,s,m),n.sub(f,d,o),n.normalize(f,f),e.reportIntersection(t,m,f,-1),t.shouldStop(e)))return;g>=0&&1>=g&&(n.lerp(d,i,s,g),n.sub(f,d,o),n.normalize(f,f),e.reportIntersection(t,g,f,-1))}}},{"../math/vec2":30,"./Shape":45}],40:[function(t,e){function o(t){Array.isArray(arguments[0])&&(t={vertices:arguments[0],axes:arguments[1]},console.warn("The Convex constructor signature has changed. Please use the following format: new Convex({ vertices: [...], ... })")),t=t||{},this.vertices=[];for(var e=void 0!==t.vertices?t.vertices:[],o=0;o<e.length;o++){var r=n.create();n.copy(r,e[o]),this.vertices.push(r)}if(this.axes=[],t.axes)for(var o=0;o<t.axes.length;o++){var a=n.create();n.copy(a,t.axes[o]),this.axes.push(a)}else for(var o=0;o<this.vertices.length;o++){var s=this.vertices[o],c=this.vertices[(o+1)%this.vertices.length],h=n.create();n.sub(h,c,s),n.rotate90cw(h,h),n.normalize(h,h),this.axes.push(h)}if(this.centerOfMass=n.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,t.type=i.CONVEX,i.call(this,t),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in conter-clockwise winding.")}var i=t("./Shape"),n=t("../math/vec2"),r=t("../math/polyk");t("poly-decomp"),e.exports=o,o.prototype=new i,o.prototype.constructor=o;var a=n.create(),s=n.create();o.prototype.projectOntoLocalAxis=function(t,e){for(var o,i,r=null,s=null,t=a,c=0;c<this.vertices.length;c++)o=this.vertices[c],i=n.dot(o,t),(null===r||i>r)&&(r=i),(null===s||s>i)&&(s=i);if(s>r){var h=s;s=r,r=h}n.set(e,s,r)},o.prototype.projectOntoWorldAxis=function(t,e,o,i){var r=s;this.projectOntoLocalAxis(t,i),0!==o?n.rotate(r,t,o):r=t;var a=n.dot(e,r);n.set(i,i[0]+a,i[1]+a)},o.prototype.updateTriangles=function(){this.triangles.length=0;for(var t=[],e=0;e<this.vertices.length;e++){var o=this.vertices[e];t.push(o[0],o[1])}for(var i=r.Triangulate(t),e=0;e<i.length;e+=3){var n=i[e],a=i[e+1],s=i[e+2];this.triangles.push([n,a,s])}};var c=n.create(),h=n.create(),l=n.create(),p=n.create(),u=n.create();n.create(),n.create(),n.create(),n.create(),o.prototype.updateCenterOfMass=function(){var t=this.triangles,e=this.vertices,i=this.centerOfMass,r=c,a=l,s=p,d=u,f=h;n.set(i,0,0);for(var v=0,y=0;y!==t.length;y++){var m=t[y],a=e[m[0]],s=e[m[1]],d=e[m[2]];n.centroid(r,a,s,d);var g=o.triangleArea(a,s,d);v+=g,n.scale(f,r,g),n.add(i,i,f)}n.scale(i,i,1/v)},o.prototype.computeMomentOfInertia=function(t){for(var e=0,o=0,i=this.vertices.length,r=i-1,a=0;i>a;r=a,a++){var s=this.vertices[r],c=this.vertices[a],h=Math.abs(n.crossLength(s,c)),l=n.dot(c,c)+n.dot(c,s)+n.dot(s,s);e+=h*l,o+=h}return t/6*(e/o)},o.prototype.updateBoundingRadius=function(){for(var t=this.vertices,e=0,o=0;o!==t.length;o++){var i=n.squaredLength(t[o]);i>e&&(e=i)}this.boundingRadius=Math.sqrt(e)},o.triangleArea=function(t,e,o){return.5*((e[0]-t[0])*(o[1]-t[1])-(o[0]-t[0])*(e[1]-t[1]))},o.prototype.updateArea=function(){this.updateTriangles(),this.area=0;for(var t=this.triangles,e=this.vertices,i=0;i!==t.length;i++){var n=t[i],r=e[n[0]],a=e[n[1]],s=e[n[2]],c=o.triangleArea(r,a,s);this.area+=c}},o.prototype.computeAABB=function(t,e,o){t.setFromPoints(this.vertices,e,o,0)};var d=n.create(),f=n.create(),v=n.create();o.prototype.raycast=function(t,e,o,i){var r=d,a=f,s=v,c=this.vertices;n.toLocalFrame(r,e.from,o,i),n.toLocalFrame(a,e.to,o,i);for(var h=c.length,l=0;h>l&&!t.shouldStop(e);l++){var p=c[l],u=c[(l+1)%h],y=n.getLineSegmentsIntersectionFraction(r,a,p,u);y>=0&&(n.sub(s,u,p),n.rotate(s,s,-Math.PI/2+i),n.normalize(s,s),e.reportIntersection(t,y,s,l))}}},{"../math/polyk":29,"../math/vec2":30,"./Shape":45,"poly-decomp":5}],41:[function(t,e){function o(t){if(Array.isArray(arguments[0])){if(t={heights:arguments[0]},"object"==typeof arguments[1])for(var e in arguments[1])t[e]=arguments[1][e];console.warn("The Heightfield constructor signature has changed. Please use the following format: new Heightfield({ heights: [...], ... })")}t=t||{},this.heights=t.heights?t.heights.slice(0):[],this.maxValue=t.maxValue||null,this.minValue=t.minValue||null,this.elementWidth=t.elementWidth||.1,(void 0===t.maxValue||void 0===t.minValue)&&this.updateMaxMinValues(),t.type=i.HEIGHTFIELD,i.call(this,t)}var i=t("./Shape"),n=t("../math/vec2");t("../utils/Utils"),e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.updateMaxMinValues=function(){for(var t=this.heights,e=t[0],o=t[0],i=0;i!==t.length;i++){var n=t[i];n>e&&(e=n),o>n&&(o=n)}this.maxValue=e,this.minValue=o},o.prototype.computeMomentOfInertia=function(){return Number.MAX_VALUE},o.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},o.prototype.updateArea=function(){for(var t=this.heights,e=0,o=0;o<t.length-1;o++)e+=(t[o]+t[o+1])/2*this.elementWidth;this.area=e};var r=[n.create(),n.create(),n.create(),n.create()];o.prototype.computeAABB=function(t,e,o){n.set(r[0],0,this.maxValue),n.set(r[1],this.elementWidth*this.heights.length,this.maxValue),n.set(r[2],this.elementWidth*this.heights.length,this.minValue),n.set(r[3],0,this.minValue),t.setFromPoints(r,e,o)},o.prototype.getLineSegment=function(t,e,o){var i=this.heights,r=this.elementWidth;n.set(t,o*r,i[o]),n.set(e,(o+1)*r,i[o+1])},o.prototype.getSegmentIndex=function(t){return Math.floor(t[0]/this.elementWidth)},o.prototype.getClampedSegmentIndex=function(t){var e=this.getSegmentIndex(t);return e=Math.min(this.heights.length,Math.max(e,0))};var a=(n.create(),n.create()),s=n.create(),c=n.create(),h=n.create(),l=n.create();n.fromValues(0,1),o.prototype.raycast=function(t,e,o,i){var r=e.from,p=e.to,u=(e.direction,a),d=s,f=c,v=h,y=l;n.toLocalFrame(v,r,o,i),n.toLocalFrame(y,p,o,i);var m=this.getClampedSegmentIndex(v),g=this.getClampedSegmentIndex(y);if(m>g){var A=m;m=g,g=A}for(var b=0;b<this.heights.length-1;b++){this.getLineSegment(d,f,b);var E=n.getLineSegmentsIntersectionFraction(v,y,d,f);if(E>=0&&(n.sub(u,f,d),n.rotate(u,u,i+Math.PI/2),n.normalize(u,u),e.reportIntersection(t,E,u,-1),t.shouldStop(e)))return}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],42:[function(t,e){function o(t){"number"==typeof arguments[0]&&(t={length:arguments[0]},console.warn("The Line constructor signature has changed. Please use the following format: new Line({ length: 1, ... })")),t=t||{},this.length=t.length||1,t.type=i.LINE,i.call(this,t)}var i=t("./Shape"),n=t("../math/vec2");e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(t){return t*Math.pow(this.length,2)/12},o.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var r=[n.create(),n.create()];o.prototype.computeAABB=function(t,e,o){var i=this.length/2;n.set(r[0],-i,0),n.set(r[1],i,0),t.setFromPoints(r,e,o,0)};var a=(n.create(),n.create()),s=n.create(),c=n.create(),h=n.fromValues(0,1);o.prototype.raycast=function(t,e,o,i){var r=e.from,l=e.to,p=s,u=c,d=this.length/2;n.set(p,-d,0),n.set(u,d,0),n.toGlobalFrame(p,p,o,i),n.toGlobalFrame(u,u,o,i);var f=n.getLineSegmentsIntersectionFraction(p,u,r,l);if(f>=0){var v=a;n.rotate(v,h,i),e.reportIntersection(t,f,v,-1)}}},{"../math/vec2":30,"./Shape":45}],43:[function(t,e){function o(t){t=t||{},t.type=i.PARTICLE,i.call(this,t)}var i=t("./Shape"),n=t("../math/vec2");e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(){return 0},o.prototype.updateBoundingRadius=function(){this.boundingRadius=0},o.prototype.computeAABB=function(t,e){n.copy(t.lowerBound,e),n.copy(t.upperBound,e)}},{"../math/vec2":30,"./Shape":45}],44:[function(t,e){function o(t){t=t||{},t.type=i.PLANE,i.call(this,t)}var i=t("./Shape"),n=t("../math/vec2");t("../utils/Utils"),e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(){return 0},o.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},o.prototype.computeAABB=function(t,e,o){var i=o%(2*Math.PI),r=n.set,a=Number.MAX_VALUE,s=t.lowerBound,c=t.upperBound;0===i?(r(s,-a,-a),r(c,a,0)):i===Math.PI/2?(r(s,0,-a),r(c,a,a)):i===Math.PI?(r(s,-a,0),r(c,a,a)):i===3*Math.PI/2?(r(s,-a,-a),r(c,0,a)):(r(s,-a,-a),r(c,a,a)),n.add(s,s,e),n.add(c,c,e)},o.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var r=n.create(),a=(n.create(),n.create(),n.create()),s=n.create();o.prototype.raycast=function(t,e,o,i){var c=e.from,h=e.to,l=e.direction,p=r,u=a,d=s;n.set(u,0,1),n.rotate(u,u,i),n.sub(d,c,o);var f=n.dot(d,u);n.sub(d,h,o);var v=n.dot(d,u);if(!(f*v>0||n.squaredDistance(c,h)<f*f)){var y=n.dot(u,l);n.sub(p,c,o);var m=-n.dot(u,p)/y/e.length;e.reportIntersection(t,m,u,-1)}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],45:[function(t,e){function o(t){t=t||{},this.body=null,this.position=i.fromValues(0,0),t.position&&i.copy(this.position,t.position),this.angle=t.angle||0,this.type=t.type||0,this.id=o.idCounter++,this.boundingRadius=0,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:1,this.collisionResponse=void 0!==t.collisionResponse?t.collisionResponse:!0,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:1,this.material=t.material||null,this.area=0,this.sensor=void 0!==t.sensor?t.sensor:!1,this.type&&this.updateBoundingRadius(),this.updateArea()}e.exports=o;var i=t("../math/vec2");o.idCounter=0,o.CIRCLE=1,o.PARTICLE=2,o.PLANE=4,o.CONVEX=8,o.LINE=16,o.BOX=32,Object.defineProperty(o,"RECTANGLE",{get:function(){return console.warn("Shape.RECTANGLE is deprecated, use Shape.BOX instead."),o.BOX}}),o.CAPSULE=64,o.HEIGHTFIELD=128,o.prototype.computeMomentOfInertia=function(){},o.prototype.updateBoundingRadius=function(){},o.prototype.updateArea=function(){},o.prototype.computeAABB=function(){},o.prototype.raycast=function(){}},{"../math/vec2":30}],46:[function(t,e){function o(t){r.call(this,t,r.GS),t=t||{},this.iterations=t.iterations||10,this.tolerance=t.tolerance||1e-7,this.arrayStep=30,this.lambda=new a.ARRAY_TYPE(this.arrayStep),this.Bs=new a.ARRAY_TYPE(this.arrayStep),this.invCs=new a.ARRAY_TYPE(this.arrayStep),this.useZeroRHS=!1,this.frictionIterations=0,this.usedIterations=0}function i(t){for(var e=t.length;e--;)t[e]=0}var n=t("../math/vec2"),r=t("./Solver"),a=t("../utils/Utils"),s=t("../equations/FrictionEquation");e.exports=o,o.prototype=new r,o.prototype.constructor=o,o.prototype.solve=function(t,e){this.sortEquations();var r=0,c=this.iterations,h=this.frictionIterations,l=this.equations,p=l.length,u=Math.pow(this.tolerance*p,2),d=e.bodies,f=e.bodies.length,v=(n.add,n.set,this.useZeroRHS),y=this.lambda;if(this.usedIterations=0,p)for(var m=0;m!==f;m++){var g=d[m];g.updateSolveMassProperties()}y.length<p&&(y=this.lambda=new a.ARRAY_TYPE(p+this.arrayStep),this.Bs=new a.ARRAY_TYPE(p+this.arrayStep),this.invCs=new a.ARRAY_TYPE(p+this.arrayStep)),i(y);
for(var A=this.invCs,b=this.Bs,y=this.lambda,m=0;m!==l.length;m++){var E=l[m];(E.timeStep!==t||E.needsUpdate)&&(E.timeStep=t,E.update()),b[m]=E.computeB(E.a,E.b,t),A[m]=E.computeInvC(E.epsilon)}var E,B,m,q;if(0!==p){for(m=0;m!==f;m++){var g=d[m];g.resetConstraintVelocity()}if(h){for(r=0;r!==h;r++){for(B=0,q=0;q!==p;q++){E=l[q];var P=o.iterateEquation(q,E,E.epsilon,b,A,y,v,t,r);B+=Math.abs(P)}if(this.usedIterations++,u>=B*B)break}for(o.updateMultipliers(l,y,1/t),q=0;q!==p;q++){var w=l[q];if(w instanceof s){for(var S=0,C=0;C!==w.contactEquations.length;C++)S+=w.contactEquations[C].multiplier;S*=w.frictionCoefficient/w.contactEquations.length,w.maxForce=S,w.minForce=-S}}}for(r=0;r!==c;r++){for(B=0,q=0;q!==p;q++){E=l[q];var P=o.iterateEquation(q,E,E.epsilon,b,A,y,v,t,r);B+=Math.abs(P)}if(this.usedIterations++,u>=B*B)break}for(m=0;m!==f;m++)d[m].addConstraintVelocity();o.updateMultipliers(l,y,1/t)}},o.updateMultipliers=function(t,e,o){for(var i=t.length;i--;)t[i].multiplier=e[i]*o},o.iterateEquation=function(t,e,o,i,n,r,a,s){var c=i[t],h=n[t],l=r[t],p=e.computeGWlambda(),u=e.maxForce,d=e.minForce;a&&(c=0);var f=h*(c-p-o*l),v=l+f;return d*s>v?f=d*s-l:v>u*s&&(f=u*s-l),r[t]+=f,e.addToWlambda(f),f}},{"../equations/FrictionEquation":23,"../math/vec2":30,"../utils/Utils":57,"./Solver":47}],47:[function(t,e){function o(t,e){t=t||{},i.call(this),this.type=e,this.equations=[],this.equationSortFunction=t.equationSortFunction||!1}var i=(t("../utils/Utils"),t("../events/EventEmitter"));e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.solve=function(){throw new Error("Solver.solve should be implemented by subclasses!")};var n={bodies:[]};o.prototype.solveIsland=function(t,e){this.removeAllEquations(),e.equations.length&&(this.addEquations(e.equations),n.bodies.length=0,e.getBodies(n.bodies),n.bodies.length&&this.solve(t,n))},o.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},o.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},o.prototype.addEquations=function(t){for(var e=0,o=t.length;e!==o;e++){var i=t[e];i.enabled&&this.equations.push(i)}},o.prototype.removeEquation=function(t){var e=this.equations.indexOf(t);-1!==e&&this.equations.splice(e,1)},o.prototype.removeAllEquations=function(){this.equations.length=0},o.GS=1,o.ISLAND=2},{"../events/EventEmitter":26,"../utils/Utils":57}],48:[function(t,e){function o(){n.apply(this,arguments)}var i=t("../equations/ContactEquation"),n=t("./Pool");e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.create=function(){return new i},o.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},{"../equations/ContactEquation":21,"./Pool":55}],49:[function(t,e){function o(){n.apply(this,arguments)}var i=t("../equations/FrictionEquation"),n=t("./Pool");e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.create=function(){return new i},o.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},{"../equations/FrictionEquation":23,"./Pool":55}],50:[function(t,e){function o(){n.apply(this,arguments)}var i=t("../world/IslandNode"),n=t("./Pool");e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.create=function(){return new i},o.prototype.destroy=function(t){return t.reset(),this}},{"../world/IslandNode":60,"./Pool":55}],51:[function(t,e){function o(){n.apply(this,arguments)}var i=t("../world/Island"),n=t("./Pool");e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.create=function(){return new i},o.prototype.destroy=function(t){return t.reset(),this}},{"../world/Island":58,"./Pool":55}],52:[function(t,e){function o(){this.overlappingShapesLastState=new i,this.overlappingShapesCurrentState=new i,this.recordPool=new n({size:16}),this.tmpDict=new i,this.tmpArray1=[]}var i=t("./TupleDictionary"),n=(t("./OverlapKeeperRecord"),t("./OverlapKeeperRecordPool"));t("./Utils"),e.exports=o,o.prototype.tick=function(){for(var t=this.overlappingShapesLastState,e=this.overlappingShapesCurrentState,o=t.keys.length;o--;){var i=t.keys[o],n=t.getByKey(i);e.getByKey(i),n&&this.recordPool.release(n)}t.reset(),t.copy(e),e.reset()},o.prototype.setOverlapping=function(t,e,o,i){var n=(this.overlappingShapesLastState,this.overlappingShapesCurrentState);if(!n.get(e.id,i.id)){var r=this.recordPool.get();r.set(t,e,o,i),n.set(e.id,i.id,r)}},o.prototype.getNewOverlaps=function(t){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,t)},o.prototype.getEndOverlaps=function(t){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,t)},o.prototype.bodiesAreOverlapping=function(t,e){for(var o=this.overlappingShapesCurrentState,i=o.keys.length;i--;){var n=o.keys[i],r=o.data[n];if(r.bodyA===t&&r.bodyB===e||r.bodyA===e&&r.bodyB===t)return!0}return!1},o.prototype.getDiff=function(t,e,o){var o=o||[],i=t,n=e;o.length=0;for(var r=n.keys.length;r--;){var a=n.keys[r],s=n.data[a];if(!s)throw new Error("Key "+a+" had no data!");var c=i.data[a];c||o.push(s)}return o},o.prototype.isNewOverlap=function(t,e){var o=0|t.id,i=0|e.id,n=this.overlappingShapesLastState,r=this.overlappingShapesCurrentState;return!n.get(o,i)&&!!r.get(o,i)},o.prototype.getNewBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},o.prototype.getEndBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},o.prototype.getBodyDiff=function(t,e){e=e||[];for(var o=this.tmpDict,i=t.length;i--;){var n=t[i];o.set(0|n.bodyA.id,0|n.bodyB.id,n)}for(i=o.keys.length;i--;){var n=o.getByKey(o.keys[i]);n&&e.push(n.bodyA,n.bodyB)}return o.reset(),e}},{"./OverlapKeeperRecord":53,"./OverlapKeeperRecordPool":54,"./TupleDictionary":56,"./Utils":57}],53:[function(t,e){function o(t,e,o,i){this.shapeA=e,this.shapeB=i,this.bodyA=t,this.bodyB=o}e.exports=o,o.prototype.set=function(t,e,i,n){o.call(this,t,e,i,n)}},{}],54:[function(t,e){function o(){n.apply(this,arguments)}var i=t("./OverlapKeeperRecord"),n=t("./Pool");e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.create=function(){return new i},o.prototype.destroy=function(t){return t.bodyA=t.bodyB=t.shapeA=t.shapeB=null,this}},{"./OverlapKeeperRecord":53,"./Pool":55}],55:[function(t,e){function o(t){t=t||{},this.objects=[],void 0!==t.size&&this.resize(t.size)}e.exports=o,o.prototype.resize=function(t){for(var e=this.objects;e.length>t;)e.pop();for(;e.length<t;)e.push(this.create());return this},o.prototype.get=function(){var t=this.objects;return t.length?t.pop():this.create()},o.prototype.release=function(t){return this.destroy(t),this.objects.push(t),this}},{}],56:[function(t,e){function o(){this.data={},this.keys=[]}var i=t("./Utils");e.exports=o,o.prototype.getKey=function(t,e){return t=0|t,e=0|e,(0|t)===(0|e)?-1:0|((0|t)>(0|e)?t<<16|65535&e:e<<16|65535&t)},o.prototype.getByKey=function(t){return t=0|t,this.data[t]},o.prototype.get=function(t,e){return this.data[this.getKey(t,e)]},o.prototype.set=function(t,e,o){if(!o)throw new Error("No data!");var i=this.getKey(t,e);return this.data[i]||this.keys.push(i),this.data[i]=o,i},o.prototype.reset=function(){for(var t=this.data,e=this.keys,o=e.length;o--;)delete t[e[o]];e.length=0},o.prototype.copy=function(t){this.reset(),i.appendArray(this.keys,t.keys);for(var e=t.keys.length;e--;){var o=t.keys[e];this.data[o]=t.data[o]}}},{"./Utils":57}],57:[function(t,e){function o(){}e.exports=o,o.appendArray=function(t,e){if(e.length<15e4)t.push.apply(t,e);else for(var o=0,i=e.length;o!==i;++o)t.push(e[o])},o.splice=function(t,e,o){o=o||1;for(var i=e,n=t.length-o;n>i;i++)t[i]=t[i+o];t.length=n},o.ARRAY_TYPE="undefined"!=typeof P2_ARRAY_TYPE?P2_ARRAY_TYPE:"undefined"!=typeof Float32Array?Float32Array:Array,o.extend=function(t,e){for(var o in e)t[o]=e[o]},o.defaults=function(t,e){t=t||{};for(var o in e)o in t||(t[o]=e[o]);return t}},{}],58:[function(t,e){function o(){this.equations=[],this.bodies=[]}var i=t("../objects/Body");e.exports=o,o.prototype.reset=function(){this.equations.length=this.bodies.length=0};var n=[];o.prototype.getBodies=function(t){var e=t||[],o=this.equations;n.length=0;for(var i=0;i!==o.length;i++){var r=o[i];-1===n.indexOf(r.bodyA.id)&&(e.push(r.bodyA),n.push(r.bodyA.id)),-1===n.indexOf(r.bodyB.id)&&(e.push(r.bodyB),n.push(r.bodyB.id))}return e},o.prototype.wantsToSleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];if(e.type===i.DYNAMIC&&!e.wantsToSleep)return!1}return!0},o.prototype.sleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];e.sleep()}return!0}},{"../objects/Body":31}],59:[function(t,e){function o(){this.nodePool=new i({size:16}),this.islandPool=new n({size:8}),this.equations=[],this.islands=[],this.nodes=[],this.queue=[]}var i=(t("../math/vec2"),t("./Island"),t("./IslandNode"),t("./../utils/IslandNodePool")),n=t("./../utils/IslandPool"),r=t("../objects/Body");e.exports=o,o.getUnvisitedNode=function(t){for(var e=t.length,o=0;o!==e;o++){var i=t[o];if(!i.visited&&i.body.type===r.DYNAMIC)return i}return!1},o.prototype.visit=function(t,e,o){e.push(t.body);for(var i=t.equations.length,n=0;n!==i;n++){var r=t.equations[n];-1===o.indexOf(r)&&o.push(r)}},o.prototype.bfs=function(t,e,i){var n=this.queue;for(n.length=0,n.push(t),t.visited=!0,this.visit(t,e,i);n.length;)for(var a,s=n.pop();a=o.getUnvisitedNode(s.neighbors);)a.visited=!0,this.visit(a,e,i),a.body.type===r.DYNAMIC&&n.push(a)},o.prototype.split=function(t){for(var e=t.bodies,i=this.nodes,n=this.equations;i.length;)this.nodePool.release(i.pop());for(var r=0;r!==e.length;r++){var a=this.nodePool.get();a.body=e[r],i.push(a)}for(var s=0;s!==n.length;s++){var c=n[s],r=e.indexOf(c.bodyA),h=e.indexOf(c.bodyB),l=i[r],p=i[h];l.neighbors.push(p),p.neighbors.push(l),l.equations.push(c),p.equations.push(c)}for(var u=this.islands,r=0;r<u.length;r++)this.islandPool.release(u[r]);u.length=0;for(var d;d=o.getUnvisitedNode(i);){var f=this.islandPool.get();this.bfs(d,f.bodies,f.equations),u.push(f)}return u}},{"../math/vec2":30,"../objects/Body":31,"./../utils/IslandNodePool":50,"./../utils/IslandPool":51,"./Island":58,"./IslandNode":60}],60:[function(t,e){function o(t){this.body=t,this.neighbors=[],this.equations=[],this.visited=!1}e.exports=o,o.prototype.reset=function(){this.equations.length=0,this.neighbors.length=0,this.visited=!1,this.body=null}},{}],61:[function(t,e){function o(t){l.apply(this),t=t||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=t.solver||new i,this.narrowphase=new y(this),this.islandManager=new A,this.gravity=n.fromValues(0,-9.78),t.gravity&&n.copy(this.gravity,t.gravity),this.frictionGravity=n.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.broadphase=t.broadphase||new v,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new u,this.defaultContactMaterial=new d(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.accumulator=0,this.stepping=!1,this.bodiesToBeRemoved=[],this.islandSplit="undefined"!=typeof t.islandSplit?!!t.islandSplit:!0,this.emitImpactEvent=!0,this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.addSpringEvent={type:"addSpring",spring:null},this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},this.postBroadphaseEvent={type:"postBroadphase",pairs:null},this.sleepMode=o.NO_SLEEPING,this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null},this.overlappingShapesLastState={keys:[]},this.overlappingShapesCurrentState={keys:[]},this.overlapKeeper=new g}var i=t("../solver/GSSolver"),n=(t("../solver/Solver"),t("../collision/Ray"),t("../math/vec2")),r=t("../shapes/Circle"),a=t("../shapes/Convex"),s=(t("../shapes/Line"),t("../shapes/Plane")),c=t("../shapes/Capsule"),h=t("../shapes/Particle"),l=t("../events/EventEmitter"),p=t("../objects/Body"),u=(t("../shapes/Shape"),t("../objects/LinearSpring"),t("../material/Material")),d=t("../material/ContactMaterial"),f=(t("../constraints/DistanceConstraint"),t("../constraints/Constraint"),t("../constraints/LockConstraint"),t("../constraints/RevoluteConstraint"),t("../constraints/PrismaticConstraint"),t("../constraints/GearConstraint"),t("../../package.json"),t("../collision/Broadphase"),t("../collision/AABB")),v=t("../collision/SAPBroadphase"),y=t("../collision/Narrowphase"),m=t("../utils/Utils"),g=t("../utils/OverlapKeeper"),A=t("./IslandManager");t("../objects/RotationalSpring"),e.exports=o,o.prototype=new Object(l.prototype),o.prototype.constructor=o,o.NO_SLEEPING=1,o.BODY_SLEEPING=2,o.ISLAND_SLEEPING=4,o.prototype.addConstraint=function(t){this.constraints.push(t)},o.prototype.addContactMaterial=function(t){this.contactMaterials.push(t)},o.prototype.removeContactMaterial=function(t){var e=this.contactMaterials.indexOf(t);-1!==e&&m.splice(this.contactMaterials,e,1)},o.prototype.getContactMaterial=function(t,e){for(var o=this.contactMaterials,i=0,n=o.length;i!==n;i++){var r=o[i];if(r.materialA.id===t.id&&r.materialB.id===e.id||r.materialA.id===e.id&&r.materialB.id===t.id)return r}return!1},o.prototype.removeConstraint=function(t){var e=this.constraints.indexOf(t);-1!==e&&m.splice(this.constraints,e,1)};var b=(n.create(),n.create(),n.create(),n.create(),n.create(),n.create(),n.create()),E=n.fromValues(0,0),B=n.fromValues(0,0);n.fromValues(0,0),n.fromValues(0,0),o.prototype.step=function(t,e,o){if(o=o||10,e=e||0,0===e)this.internalStep(t),this.time+=t;else{this.accumulator+=e;for(var i=0;this.accumulator>=t&&o>i;)this.internalStep(t),this.time+=t,this.accumulator-=t,i++;for(var r=this.accumulator%t/t,a=0;a!==this.bodies.length;a++){var s=this.bodies[a];n.lerp(s.interpolatedPosition,s.previousPosition,s.position,r),s.interpolatedAngle=s.previousAngle+r*(s.angle-s.previousAngle)}}};var q=[];o.prototype.internalStep=function(t){this.stepping=!0;var e=this.springs.length,i=this.springs,r=this.bodies,a=this.gravity,s=this.solver,c=this.bodies.length,h=this.broadphase,l=this.narrowphase,u=this.constraints,d=b,f=(n.scale,n.add),v=(n.rotate,this.islandManager);if(this.overlapKeeper.tick(),this.lastTimeStep=t,this.useWorldGravityAsFrictionGravity){var y=n.length(this.gravity);0===y&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=y)}if(this.applyGravity)for(var g=0;g!==c;g++){var A=r[g],E=A.force;A.type===p.DYNAMIC&&A.sleepState!==p.SLEEPING&&(n.scale(d,a,A.mass*A.gravityScale),f(E,E,d))}if(this.applySpringForces)for(var g=0;g!==e;g++){var B=i[g];B.applyForce()}if(this.applyDamping)for(var g=0;g!==c;g++){var A=r[g];A.type===p.DYNAMIC&&A.applyDamping(t)}for(var P=h.getCollisionPairs(this),w=this.disabledBodyCollisionPairs,g=w.length-2;g>=0;g-=2)for(var S=P.length-2;S>=0;S-=2)(w[g]===P[S]&&w[g+1]===P[S+1]||w[g+1]===P[S]&&w[g]===P[S+1])&&P.splice(S,2);var C=u.length;for(g=0;g!==C;g++){var L=u[g];if(!L.collideConnected)for(var S=P.length-2;S>=0;S-=2)(L.bodyA===P[S]&&L.bodyB===P[S+1]||L.bodyB===P[S]&&L.bodyA===P[S+1])&&P.splice(S,2)}this.postBroadphaseEvent.pairs=P,this.emit(this.postBroadphaseEvent),this.postBroadphaseEvent.pairs=null,l.reset(this);for(var g=0,x=P.length;g!==x;g+=2)for(var F=P[g],M=P[g+1],I=0,R=F.shapes.length;I!==R;I++)for(var V=F.shapes[I],T=V.position,N=V.angle,G=0,O=M.shapes.length;G!==O;G++){var U=M.shapes[G],k=U.position,_=U.angle,D=this.defaultContactMaterial;if(V.material&&U.material){var W=this.getContactMaterial(V.material,U.material);W&&(D=W)}this.runNarrowphase(l,F,V,T,N,M,U,k,_,D,this.frictionGravity)}for(var g=0;g!==c;g++){var X=r[g];X._wakeUpAfterNarrowphase&&(X.wakeUp(),X._wakeUpAfterNarrowphase=!1)}if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(q);for(var j=this.endContactEvent,G=q.length;G--;){var z=q[G];j.shapeA=z.shapeA,j.shapeB=z.shapeB,j.bodyA=z.bodyA,j.bodyB=z.bodyB,this.emit(j)}q.length=0}var Y=this.preSolveEvent;Y.contactEquations=l.contactEquations,Y.frictionEquations=l.frictionEquations,this.emit(Y),Y.contactEquations=Y.frictionEquations=null;var C=u.length;for(g=0;g!==C;g++)u[g].update();if(l.contactEquations.length||l.frictionEquations.length||C)if(this.islandSplit){for(v.equations.length=0,m.appendArray(v.equations,l.contactEquations),m.appendArray(v.equations,l.frictionEquations),g=0;g!==C;g++)m.appendArray(v.equations,u[g].equations);v.split(this);for(var g=0;g!==v.islands.length;g++){var K=v.islands[g];K.equations.length&&s.solveIsland(t,K)}}else{for(s.addEquations(l.contactEquations),s.addEquations(l.frictionEquations),g=0;g!==C;g++)s.addEquations(u[g].equations);this.solveConstraints&&s.solve(t,this),s.removeAllEquations()}for(var g=0;g!==c;g++){var X=r[g];X.integrate(t)}for(var g=0;g!==c;g++)r[g].setZeroForce();if(this.emitImpactEvent&&this.has("impact"))for(var H=this.impactEvent,g=0;g!==l.contactEquations.length;g++){var Z=l.contactEquations[g];Z.firstImpact&&(H.bodyA=Z.bodyA,H.bodyB=Z.bodyB,H.shapeA=Z.shapeA,H.shapeB=Z.shapeB,H.contactEquation=Z,this.emit(H))}if(this.sleepMode===o.BODY_SLEEPING)for(g=0;g!==c;g++)r[g].sleepTick(this.time,!1,t);else if(this.sleepMode===o.ISLAND_SLEEPING&&this.islandSplit){for(g=0;g!==c;g++)r[g].sleepTick(this.time,!0,t);for(var g=0;g<this.islandManager.islands.length;g++){var K=this.islandManager.islands[g];K.wantsToSleep()&&K.sleep()}}this.stepping=!1;for(var J=this.bodiesToBeRemoved,g=0;g!==J.length;g++)this.removeBody(J[g]);J.length=0,this.emit(this.postStepEvent)},o.prototype.runNarrowphase=function(t,e,o,i,r,a,s,c,h,l,u){if(0!==(o.collisionGroup&s.collisionMask)&&0!==(s.collisionGroup&o.collisionMask)){n.rotate(E,i,e.angle),n.rotate(B,c,a.angle),n.add(E,E,e.position),n.add(B,B,a.position);var d=r+e.angle,f=h+a.angle;t.enableFriction=l.friction>0,t.frictionCoefficient=l.friction;var v;v=e.type===p.STATIC||e.type===p.KINEMATIC?a.mass:a.type===p.STATIC||a.type===p.KINEMATIC?e.mass:e.mass*a.mass/(e.mass+a.mass),t.slipForce=l.friction*u*v,t.restitution=l.restitution,t.surfaceVelocity=l.surfaceVelocity,t.frictionStiffness=l.frictionStiffness,t.frictionRelaxation=l.frictionRelaxation,t.stiffness=l.stiffness,t.relaxation=l.relaxation,t.contactSkinSize=l.contactSkinSize,t.enabledEquations=e.collisionResponse&&a.collisionResponse&&o.collisionResponse&&s.collisionResponse;var y=t[o.type|s.type],m=0;if(y){var g=o.sensor||s.sensor,A=t.frictionEquations.length;m=o.type<s.type?y.call(t,e,o,E,d,a,s,B,f,g):y.call(t,a,s,B,f,e,o,E,d,g);var b=t.frictionEquations.length-A;if(m){if(e.allowSleep&&e.type===p.DYNAMIC&&e.sleepState===p.SLEEPING&&a.sleepState===p.AWAKE&&a.type!==p.STATIC){var q=n.squaredLength(a.velocity)+Math.pow(a.angularVelocity,2),P=Math.pow(a.sleepSpeedLimit,2);q>=2*P&&(e._wakeUpAfterNarrowphase=!0)}if(a.allowSleep&&a.type===p.DYNAMIC&&a.sleepState===p.SLEEPING&&e.sleepState===p.AWAKE&&e.type!==p.STATIC){var w=n.squaredLength(e.velocity)+Math.pow(e.angularVelocity,2),S=Math.pow(e.sleepSpeedLimit,2);w>=2*S&&(a._wakeUpAfterNarrowphase=!0)}if(this.overlapKeeper.setOverlapping(e,o,a,s),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(o,s)){var C=this.beginContactEvent;if(C.shapeA=o,C.shapeB=s,C.bodyA=e,C.bodyB=a,C.contactEquations.length=0,"number"==typeof m)for(var L=t.contactEquations.length-m;L<t.contactEquations.length;L++)C.contactEquations.push(t.contactEquations[L]);this.emit(C)}if("number"==typeof m&&b>1)for(var L=t.frictionEquations.length-b;L<t.frictionEquations.length;L++){var x=t.frictionEquations[L];x.setSlipForce(x.getSlipForce()/b)}}}}},o.prototype.addSpring=function(t){this.springs.push(t);var e=this.addSpringEvent;e.spring=t,this.emit(e),e.spring=null},o.prototype.removeSpring=function(t){var e=this.springs.indexOf(t);-1!==e&&m.splice(this.springs,e,1)},o.prototype.addBody=function(t){if(-1===this.bodies.indexOf(t)){this.bodies.push(t),t.world=this;var e=this.addBodyEvent;e.body=t,this.emit(e),e.body=null}},o.prototype.removeBody=function(t){if(this.stepping)this.bodiesToBeRemoved.push(t);else{t.world=null;var e=this.bodies.indexOf(t);-1!==e&&(m.splice(this.bodies,e,1),this.removeBodyEvent.body=t,t.resetConstraintVelocity(),this.emit(this.removeBodyEvent),this.removeBodyEvent.body=null)}},o.prototype.getBodyById=function(t){for(var e=this.bodies,o=0;o<e.length;o++){var i=e[o];if(i.id===t)return i}return!1},o.prototype.disableBodyCollision=function(t,e){this.disabledBodyCollisionPairs.push(t,e)},o.prototype.enableBodyCollision=function(t,e){for(var o=this.disabledBodyCollisionPairs,i=0;i<o.length;i+=2)if(o[i]===t&&o[i+1]===e||o[i+1]===t&&o[i]===e)return void o.splice(i,2)},o.prototype.clear=function(){this.time=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();for(var t=this.constraints,e=t.length-1;e>=0;e--)this.removeConstraint(t[e]);for(var i=this.bodies,e=i.length-1;e>=0;e--)this.removeBody(i[e]);for(var n=this.springs,e=n.length-1;e>=0;e--)this.removeSpring(n[e]);for(var r=this.contactMaterials,e=r.length-1;e>=0;e--)this.removeContactMaterial(r[e]);o.apply(this)};var P=n.create(),w=(n.fromValues(0,0),n.fromValues(0,0));o.prototype.hitTest=function(t,e,o){o=o||0;var i=new p({position:t}),l=new h,u=t,d=0,f=P,v=w;i.addShape(l);for(var y=this.narrowphase,m=[],g=0,A=e.length;g!==A;g++)for(var b=e[g],E=0,B=b.shapes.length;E!==B;E++){var q=b.shapes[E];n.rotate(f,q.position,b.angle),n.add(f,f,b.position);var S=q.angle+b.angle;(q instanceof r&&y.circleParticle(b,q,f,S,i,l,u,d,!0)||q instanceof a&&y.particleConvex(i,l,u,d,b,q,f,S,!0)||q instanceof s&&y.particlePlane(i,l,u,d,b,q,f,S,!0)||q instanceof c&&y.particleCapsule(i,l,u,d,b,q,f,S,!0)||q instanceof h&&n.squaredLength(n.sub(v,f,t))<o*o)&&m.push(b)}return m},o.prototype.setGlobalStiffness=function(t){for(var e=this.constraints,o=0;o!==e.length;o++)for(var i=e[o],n=0;n!==i.equations.length;n++){var r=i.equations[n];r.stiffness=t,r.needsUpdate=!0}for(var a=this.contactMaterials,o=0;o!==a.length;o++){var i=a[o];i.stiffness=i.frictionStiffness=t}var i=this.defaultContactMaterial;i.stiffness=i.frictionStiffness=t},o.prototype.setGlobalRelaxation=function(t){for(var e=0;e!==this.constraints.length;e++)for(var o=this.constraints[e],i=0;i!==o.equations.length;i++){var n=o.equations[i];n.relaxation=t,n.needsUpdate=!0}for(var e=0;e!==this.contactMaterials.length;e++){var o=this.contactMaterials[e];o.relaxation=o.frictionRelaxation=t}var o=this.defaultContactMaterial;o.relaxation=o.frictionRelaxation=t};var S=new f,C=[];o.prototype.raycast=function(t,e){return e.getAABB(S),this.broadphase.aabbQuery(this,S,C),e.intersectBodies(t,C),C.length=0,t.hasHit()}},{"../../package.json":6,"../collision/AABB":7,"../collision/Broadphase":8,"../collision/Narrowphase":10,"../collision/Ray":11,"../collision/SAPBroadphase":13,"../constraints/Constraint":14,"../constraints/DistanceConstraint":15,"../constraints/GearConstraint":16,"../constraints/LockConstraint":17,"../constraints/PrismaticConstraint":18,"../constraints/RevoluteConstraint":19,"../events/EventEmitter":26,"../material/ContactMaterial":27,"../material/Material":28,"../math/vec2":30,"../objects/Body":31,"../objects/LinearSpring":32,"../objects/RotationalSpring":33,"../shapes/Capsule":38,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Line":42,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45,"../solver/GSSolver":46,"../solver/Solver":47,"../utils/OverlapKeeper":52,"../utils/Utils":57,"./IslandManager":59}]},{},[36])(36)});
;/*!libs/libs/modules/egret/egret.min.js*/
function __extends(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i}var egret;!function(t){function e(){return""}function i(t){throw new Error("#"+t)}function n(){}function r(){}function s(){}t.getString=e,t.$error=i,t.$warn=n,t.$markReadOnly=r,t.$markCannotUse=s}(egret||(egret={}));var egret;!function(t){function e(t,e,i){var n=t.prototype;n.__class__=e;var r=[e];i&&(r=r.concat(i));var s=n.__types__;if(n.__types__)for(var a=s.length,o=0;a>o;o++){var h=s[o];-1==r.indexOf(h)&&r.push(h)}n.__types__=r}t.registerClass=e}(egret||(egret={}));var __define=this.__define||function(t,e,i,n){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:i,set:n})},egret;!function(t){t.$hashCount=1;var e=function(){function e(){this.$hashCode=t.$hashCount++}var i=__define,n=e,r=n.prototype;return i(r,"hashCode",function(){return this.$hashCode}),e}();t.HashObject=e,t.registerClass(e,"egret.HashObject",["egret.IHashObject"])}(egret||(egret={}));var egret;!function(t){var e=[],i=function(i){function n(t){void 0===t&&(t=null),i.call(this),this.$EventDispatcher={0:t?t:this,1:{},2:{},3:0}}__extends(n,i);var r=n,s=r.prototype;return s.$getEventMap=function(t){var e=this.$EventDispatcher,i=t?e[2]:e[1];return i},s.addEventListener=function(t,e,i,n,r){this.$addListener(t,e,i,n,r)},s.once=function(t,e,i,n,r){this.$addListener(t,e,i,n,r,!0)},s.$addListener=function(t,e,i,n,r,s){var a=this.$EventDispatcher,o=n?a[2]:a[1],h=o[t];h?0!==a[3]&&(o[t]=h=h.concat()):h=o[t]=[],this.$insertEventBin(h,t,e,i,n,r,s)},s.$insertEventBin=function(t,e,i,n,r,s,a){s=0|+s;for(var o=-1,h=t.length,l=0;h>l;l++){var u=t[l];if(u.listener==i&&u.thisObject==n&&u.target==this)return!1;-1==o&&u.priority<s&&(o=l)}var c={type:e,listener:i,thisObject:n,priority:s,target:this,useCapture:r,dispatchOnce:!!a};return-1!==o?t.splice(o,0,c):t.push(c),!0},s.removeEventListener=function(t,e,i,n){var r=this.$EventDispatcher,s=n?r[2]:r[1],a=s[t];a&&(0!==r[3]&&(s[t]=a=a.concat()),this.$removeEventBin(a,e,i),0==a.length&&(s[t]=null))},s.$removeEventBin=function(t,e,i){for(var n=t.length,r=0;n>r;r++){var s=t[r];if(s.listener==e&&s.thisObject==i&&s.target==this)return t.splice(r,1),!0}return!1},s.hasEventListener=function(t){var e=this.$EventDispatcher;return!(!e[1][t]&&!e[2][t])},s.willTrigger=function(t){return this.hasEventListener(t)},s.dispatchEvent=function(t){return t.$currentTarget=this.$EventDispatcher[0],t.$setTarget(t.$currentTarget),this.$notifyListener(t,!1)},s.$notifyListener=function(t,i){var n=this.$EventDispatcher,r=i?n[2]:n[1],s=r[t.$type];if(!s)return!0;var a=s.length;if(0==a)return!0;var o=e;n[3]++;for(var h=0;a>h;h++){var l=s[h];if(l.listener.call(l.thisObject,t),l.dispatchOnce&&o.push(l),t.$isPropagationImmediateStopped)break}for(n[3]--;o.length;)l=o.pop(),l.target.removeEventListener(l.type,l.listener,l.thisObject,l.useCapture);return!t.$isDefaultPrevented},s.dispatchEventWith=function(e,i,n,r){if(i||this.hasEventListener(e)){var s=t.Event.create(t.Event,e,i,r);s.data=n;var a=this.dispatchEvent(s);return t.Event.release(s),a}return!0},n}(t.HashObject);t.EventDispatcher=i,t.registerClass(i,"egret.EventDispatcher",["egret.IEventDispatcher"])}(egret||(egret={}));var egret;!function(t){var e=[],i=function(i){function n(t,e,n,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),i.call(this),this.x=t,this.y=e,this.width=n,this.height=r}__extends(n,i);var r=__define,s=n,a=s.prototype;return n.release=function(t){t&&e.push(t)},n.create=function(){var t=e.pop();return t||(t=new n),t},r(a,"right",function(){return this.x+this.width},function(t){this.width=t-this.x}),r(a,"bottom",function(){return this.y+this.height},function(t){this.height=t-this.y}),r(a,"left",function(){return this.x},function(t){this.width+=this.x-t,this.x=t}),r(a,"top",function(){return this.y},function(t){this.height+=this.y-t,this.y=t}),r(a,"topLeft",function(){return new t.Point(this.left,this.top)},function(t){this.top=t.y,this.left=t.x}),r(a,"bottomRight",function(){return new t.Point(this.right,this.bottom)},function(t){this.bottom=t.y,this.right=t.x}),a.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},a.setTo=function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this},a.contains=function(t,e){return this.x<=t&&this.x+this.width>=t&&this.y<=e&&this.y+this.height>=e},a.intersection=function(t){return this.clone().$intersectInPlace(t)},a.inflate=function(t,e){this.x-=t,this.width+=2*t,this.y-=e,this.height+=2*e},a.$intersectInPlace=function(t){var e=this.x,i=this.y,n=t.x,r=t.y,s=Math.max(e,n),a=Math.min(e+this.width,n+t.width);if(a>=s){var o=Math.max(i,r),h=Math.min(i+this.height,r+t.height);if(h>=o)return this.setTo(s,o,a-s,h-o),this}return this.setEmpty(),this},a.intersects=function(t){return Math.max(this.x,t.x)<=Math.min(this.right,t.right)&&Math.max(this.y,t.y)<=Math.min(this.bottom,t.bottom)},a.isEmpty=function(){return this.width<=0||this.height<=0},a.setEmpty=function(){this.x=0,this.y=0,this.width=0,this.height=0},a.clone=function(){return new n(this.x,this.y,this.width,this.height)},a.containsPoint=function(t){return this.x<t.x&&this.x+this.width>t.x&&this.y<t.y&&this.y+this.height>t.y?!0:!1},a.containsRect=function(t){var e=t.x+t.width,i=t.y+t.height,n=this.x+this.width,r=this.y+this.height;return t.x>=this.x&&t.x<n&&t.y>=this.y&&t.y<r&&e>this.x&&n>=e&&i>this.y&&r>=i},a.equals=function(t){return this===t?!0:this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},a.inflatePoint=function(t){this.inflate(t.x,t.y)},a.offset=function(t,e){this.x+=t,this.y+=e},a.offsetPoint=function(t){this.offset(t.x,t.y)},a.toString=function(){return"(x="+this.x+", y="+this.y+", width="+this.width+", height="+this.height+")"},a.union=function(t){var e=this.clone();if(t.isEmpty())return e;if(e.isEmpty())return e.copyFrom(t),e;var i=Math.min(e.x,t.x),n=Math.min(e.y,t.y);return e.setTo(i,n,Math.max(e.right,t.right)-i,Math.max(e.bottom,t.bottom)-n),e},a.$getBaseWidth=function(t){var e=Math.abs(Math.cos(t)),i=Math.abs(Math.sin(t));return e*this.width+i*this.height},a.$getBaseHeight=function(t){var e=Math.abs(Math.cos(t)),i=Math.abs(Math.sin(t));return i*this.width+e*this.height},n}(t.HashObject);t.Rectangle=i,t.registerClass(i,"egret.Rectangle"),t.$TempRectangle=new i}(egret||(egret={}));var egret;!function(t){function e(t){return t%=360,t>180?t-=360:-180>t&&(t+=360),t}var i=function(i){function n(){i.call(this),this.$children=null,this.$parent=null,this.$stage=null,this.$nestLevel=0,this.$visible=!0,this.$displayList=null,this.$alpha=1,this.$touchEnabled=n.defaultTouchEnabled,this.$scrollRect=null,this.$blendMode=0,this.$maskedObject=null,this.$mask=null,this.$maskRect=null,this.$parentDisplayList=null,this.$renderNode=null,this.$displayFlags=2032,this.$DisplayObject={0:1,1:1,2:0,3:0,4:0,5:"",6:new t.Matrix,7:new t.Matrix,8:new t.Matrix,9:new t.Rectangle,10:new t.Rectangle,11:!1,12:0,13:0,14:0/0,15:0/0,16:0,17:0,18:0,19:null,20:null}}__extends(n,i);var r=__define,s=n,a=s.prototype;return a.$setFlags=function(t){this.$displayFlags|=t},a.$removeFlags=function(t){this.$displayFlags&=~t},a.$removeFlagsUp=function(t){if(this.$hasAnyFlags(t)){this.$removeFlags(t);var e=this.$parent;e&&e.$removeFlagsUp(t)}},a.$hasFlags=function(t){return(this.$displayFlags&t)==t},a.$propagateFlagsUp=function(t){if(!this.$hasFlags(t)){this.$setFlags(t);var e=this.$parent;e&&e.$propagateFlagsUp(t)}},a.$propagateFlagsDown=function(t){this.$setFlags(t)},a.$hasAnyFlags=function(t){return!!(this.$displayFlags&t)},a.$invalidateMatrix=function(){this.$setFlags(8),this.$invalidatePosition()},a.$invalidatePosition=function(){var t=this;t.$invalidateTransform(),t.$propagateFlagsDown(48),t.$parent&&t.$parent.$propagateFlagsUp(4)},r(a,"name",function(){return this.$DisplayObject[5]},function(t){this.$DisplayObject[5]=t}),r(a,"parent",function(){return this.$parent}),a.$setParent=function(t){return this.$parent==t?!1:(this.$parent=t,!0)},a.$onAddToStage=function(e,i){this.$stage=e,this.$nestLevel=i,this.$hasAddToStage=!0,t.Sprite.$EVENT_ADD_TO_STAGE_LIST.push(this)},a.$onRemoveFromStage=function(){this.$nestLevel=0,t.Sprite.$EVENT_REMOVE_FROM_STAGE_LIST.push(this)},r(a,"stage",function(){return this.$stage}),r(a,"matrix",function(){return this.$getMatrix().clone()},function(t){this.$setMatrix(t)}),a.$getMatrix=function(){var t=this.$DisplayObject;return this.$hasFlags(8)&&(t[6].$updateScaleAndRotation(t[0],t[1],t[2],t[3]),this.$removeFlags(8)),t[6]},a.$setMatrix=function(t,i){void 0===i&&(i=!0);var n=this,r=n.$DisplayObject,s=r[6];return s.equals(t)?!1:(s.copyFrom(t),i&&(r[0]=s.$getScaleX(),r[1]=s.$getScaleY(),r[2]=t.$getSkewX(),r[3]=t.$getSkewY(),r[16]=e(180*r[2]/Math.PI),r[17]=e(180*r[3]/Math.PI),r[4]=e(180*r[3]/Math.PI)),n.$removeFlags(8),n.$invalidatePosition(),!0)},a.$getConcatenatedMatrix=function(){var e=this.$DisplayObject[7];if(this.$hasFlags(16)){this.$parent?this.$parent.$getConcatenatedMatrix().$preMultiplyInto(this.$getMatrix(),e):e.copyFrom(this.$getMatrix());var i=this.$DisplayObject,n=i[12],r=i[13],s=this.$scrollRect;s?e.$preMultiplyInto(t.$TempMatrix.setTo(1,0,0,1,-s.x-n,-s.y-r),e):(0!=n||0!=r)&&e.$preMultiplyInto(t.$TempMatrix.setTo(1,0,0,1,-n,-r),e),this.$displayList&&(this.$displayList.$renderNode.moved=!0),this.$renderNode&&(this.$renderNode.moved=!0),this.$removeFlags(16)}return e},a.$getInvertedConcatenatedMatrix=function(){var t=this.$DisplayObject;return this.$hasFlags(32)&&(this.$getConcatenatedMatrix().$invertInto(t[8]),this.$removeFlags(32)),t[8]},r(a,"x",function(){return this.$getX()},function(t){this.$setX(t)}),a.$getX=function(){return this.$DisplayObject[6].tx},a.$setX=function(t){t=+t||0;var e=this.$DisplayObject[6];return t==e.tx?!1:(e.tx=t,this.$invalidatePosition(),!0)},r(a,"y",function(){return this.$getY()},function(t){this.$setY(t)}),a.$getY=function(){return this.$DisplayObject[6].ty},a.$setY=function(t){t=+t||0;var e=this.$DisplayObject[6];return t==e.ty?!1:(e.ty=t,this.$invalidatePosition(),!0)},r(a,"scaleX",function(){return this.$getScaleX()},function(t){this.$setScaleX(t)}),a.$getScaleX=function(){return this.$DisplayObject[0]},a.$setScaleX=function(t){t=+t||0;var e=this.$DisplayObject;return t==e[0]?!1:(e[0]=t,this.$invalidateMatrix(),!0)},r(a,"scaleY",function(){return this.$getScaleY()},function(t){this.$setScaleY(t)}),a.$getScaleY=function(){return this.$DisplayObject[1]},a.$setScaleY=function(t){return t=+t||0,t==this.$DisplayObject[1]?!1:(this.$DisplayObject[1]=t,this.$invalidateMatrix(),!0)},r(a,"rotation",function(){return this.$getRotation()},function(t){this.$setRotation(t)}),a.$getRotation=function(){return this.$DisplayObject[4]},a.$setRotation=function(t){t=+t||0,t=e(t);var i=this.$DisplayObject;if(t==i[4])return!1;var n=t-i[4],r=n/180*Math.PI;return i[2]+=r,i[3]+=r,i[4]=t,this.$invalidateMatrix(),!0},r(a,"skewX",function(){return this.$DisplayObject[16]},function(t){this.$setSkewX(t)}),a.$setSkewX=function(t){t=+t||0;var i=this.$DisplayObject;return t==i[16]?!1:(i[16]=t,t=e(t),t=t/180*Math.PI,i[2]=t,this.$invalidateMatrix(),!0)},r(a,"skewY",function(){return this.$DisplayObject[17]},function(t){this.$setSkewY(t)}),a.$setSkewY=function(t){t=+t||0;var i=this.$DisplayObject;return t==i[17]?!1:(i[17]=t,t=e(t),t=t/180*Math.PI,i[3]=t,this.$invalidateMatrix(),!0)},r(a,"width",function(){return this.$getWidth()},function(t){this.$setWidth(t)}),a.$getWidth=function(){return isNaN(this.$getExplicitWidth())?this.$getOriginalBounds().width:this.$getExplicitWidth()},a.$getExplicitWidth=function(){return this.$DisplayObject[14]},a.$setWidth=function(t){return this.$DisplayObject[14]=isNaN(t)?0/0:t,t=+t,0>t?!1:(this.$invalidateMatrix(),!0)},r(a,"height",function(){return this.$getHeight()},function(t){this.$setHeight(t)}),a.$getHeight=function(){return isNaN(this.$getExplicitHeight())?this.$getOriginalBounds().height:this.$getExplicitHeight()},a.$getExplicitHeight=function(){return this.$DisplayObject[15]},a.$setHeight=function(t){return this.$DisplayObject[15]=isNaN(t)?0/0:t,t=+t,0>t?!1:(this.$invalidateMatrix(),!0)},r(a,"measuredWidth",function(){return this.$getOriginalBounds().width}),r(a,"measuredHeight",function(){return this.$getOriginalBounds().height}),r(a,"anchorOffsetX",function(){return this.$DisplayObject[12]},function(t){this.$setAnchorOffsetX(t)}),a.$getAnchorOffsetX=function(){return this.$DisplayObject[12]},a.$setAnchorOffsetX=function(t){return t=+t||0,t==this.$DisplayObject[12]?!1:(this.$DisplayObject[12]=t,this.$invalidatePosition(),!0)},r(a,"anchorOffsetY",function(){return this.$DisplayObject[13]},function(t){this.$setAnchorOffsetY(t)}),a.$getAnchorOffsetY=function(){return this.$DisplayObject[13]},a.$setAnchorOffsetY=function(t){return t=+t||0,t==this.$DisplayObject[13]?!1:(this.$DisplayObject[13]=t,this.$invalidatePosition(),!0)},r(a,"visible",function(){return this.$visible},function(t){this.$setVisible(t)}),a.$setVisible=function(t){return t=!!t,t==this.$visible?!1:(this.$visible=t,this.$propagateFlagsDown(1024),this.$invalidateTransform(),!0)},a.$getConcatenatedVisible=function(){var t=this.$DisplayObject;if(this.$hasFlags(1024)){if(this.$parent){var e=this.$parent.$getConcatenatedVisible();t[19]=e&&this.$visible}else t[19]=this.$visible;this.$removeFlags(1024)}return t[19]},r(a,"cacheAsBitmap",function(){return this.$DisplayObject[11]},function(t){t=!!t,this.$DisplayObject[11]=t,this.$setHasDisplayList(t)}),a.$setHasDisplayList=function(e){var i=!!this.$displayList;if(i!=e)if(e){var n=t.sys.DisplayList.create(this);n&&(this.$displayList=n,this.$parentDisplayList&&this.$parentDisplayList.markDirty(n),this.$cacheAsBitmapChanged())}else this.$displayList=null,this.$cacheAsBitmapChanged()},a.$cacheAsBitmapChanged=function(){var t=this.$displayList||this.$parentDisplayList;this.$renderNode&&t&&t.markDirty(this),this.$propagateFlagsDown(48)},r(a,"alpha",function(){return this.$alpha},function(t){this.$setAlpha(t)}),a.$setAlpha=function(t){return t=+t||0,t==this.$alpha?!1:(this.$alpha=t,this.$propagateFlagsDown(64),this.$invalidate(),!0)},a.$getConcatenatedAlpha=function(){var t=this.$DisplayObject;if(this.$hasFlags(64)){if(this.$parent){var e=this.$parent.$getConcatenatedAlpha();t[18]=e*this.$alpha}else t[18]=this.$alpha;this.$removeFlags(64)}return t[18]},r(a,"touchEnabled",function(){return this.$getTouchEnabled()},function(t){this.$setTouchEnabled(t)}),a.$getTouchEnabled=function(){return this.$touchEnabled},a.$setTouchEnabled=function(t){return this.$touchEnabled==t?!1:(this.$touchEnabled=t,!0)},r(a,"scrollRect",function(){return this.$scrollRect},function(t){this.$setScrollRect(t)}),a.$setScrollRect=function(e){return e||this.$scrollRect?(e?(this.$scrollRect||(this.$scrollRect=new t.Rectangle),this.$scrollRect.copyFrom(e)):this.$scrollRect=null,this.$invalidatePosition(),!0):!1},r(a,"blendMode",function(){return t.sys.numberToBlendMode(this.$blendMode)},function(e){var i=t.sys.blendModeToNumber(e);i!=this.$blendMode&&(this.$blendMode=i,this.$invalidateTransform())}),r(a,"mask",function(){return this.$mask?this.$mask:this.$maskRect},function(t){if(t!==this){if(t)if(t instanceof n){if(t==this.$mask)return;t.$maskedObject&&(t.$maskedObject.mask=null),t.$maskedObject=this,t.$invalidateTransform(),this.$mask=t,this.$maskRect=null}else this.$setMaskRect(t),this.$mask&&(this.$mask.$maskedObject=null,this.$mask.$invalidateTransform()),this.$mask=null;else this.$mask&&(this.$mask.$maskedObject=null,this.$mask.$invalidateTransform()),this.$mask=null,this.$maskRect=null;this.$invalidateTransform()}}),a.$setMaskRect=function(e){return e||this.$maskRect?(e?(this.$maskRect||(this.$maskRect=new t.Rectangle),this.$maskRect.copyFrom(e)):this.$maskRect=null,this.$invalidatePosition(),!0):!1},r(a,"filters",function(){return this.$DisplayObject[20]},function(t){var e=this.$DisplayObject[20];if(!e&&!t)return void(this.$DisplayObject[20]=t);if(this.$invalidateContentBounds(),this.$invalidate(!0),e&&e.length)for(var i=e.length,n=0;i>n;n++)e[n].$removeTarget(this);if(this.$DisplayObject[20]=t,t&&t.length)for(i=t.length,n=0;i>n;n++)t[n].$addTarget(this)}),a.$getFilters=function(){return this.$DisplayObject[20]},a.getTransformedBounds=function(t,e){return t=t||this,this.$getTransformedBounds(t,e)},a.getBounds=function(t,e){if(void 0===e&&(e=!0),t=this.$getTransformedBounds(this,t),e){var i=this.$DisplayObject;(0!=i[12]||0!=i[13])&&(t.x-=i[12],t.y-=i[13])}return t},a.$getTransformedBounds=function(e,i){var n=this.$getOriginalBounds();if(i||(i=new t.Rectangle),i.copyFrom(n),e==this||i.isEmpty())return i;var r;if(e){r=t.$TempMatrix;var s=e.$getInvertedConcatenatedMatrix();s.$preMultiplyInto(this.$getConcatenatedMatrix(),r)}else r=this.$getConcatenatedMatrix();return r.$transformBounds(i),i},a.globalToLocal=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0);var n=this.$getInvertedConcatenatedMatrix();return n.transformPoint(t,e,i)},a.localToGlobal=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0);var n=this.$getConcatenatedMatrix();return n.transformPoint(t,e,i)},a.$invalidateContentBounds=function(){this.$invalidate(),this.$setFlags(2),this.$propagateFlagsUp(4)},a.$getOriginalBounds=function(){var t=this.$DisplayObject[9];if(this.$hasFlags(4)){t.copyFrom(this.$getContentBounds()),this.$measureChildBounds(t),this.$removeFlags(4),this.$displayList&&(this.$displayList.$renderNode.moved=!0);var e=this.$measureFiltersOffset();e&&(t.x+=e.minX,t.y+=e.minY,t.width+=e.maxX,t.height+=e.maxY)}return t},a.$measureChildBounds=function(){},a.$getContentBounds=function(){var t=this.$DisplayObject[10];return this.$hasFlags(2)&&(this.$measureContentBounds(t),this.$renderNode&&(this.$renderNode.moved=!0),this.$removeFlags(2)),t},a.$measureContentBounds=function(){},a.$invalidate=function(){if(this.$renderNode&&!this.$hasFlags(256)){this.$setFlags(384);var t=this.$displayList?this.$displayList:this.$parentDisplayList;t&&t.markDirty(this)}},a.$invalidateTransform=function(){var t=this;if(!t.$hasFlags(512)){t.$setFlags(512);var e=t.$displayList;(e||t.$renderNode)&&t.$parentDisplayList&&t.$parentDisplayList.markDirty(e||t)}},a.$getRenderNode=function(){var t=this.$renderNode;return t?(128&this.$displayFlags&&(t.cleanBeforeRender(),this.$render(),this.$removeFlags(128),t=this.$renderNode),t):null},a.$update=function(e,i){var n=this;n.$removeFlagsUp(768);var r=n.$renderNode;r.renderAlpha=n.$getConcatenatedAlpha();var s=n.$getConcatenatedMatrix();if(e==t.DirtyRegionPolicy.OFF){var a=n.$displayList||n.$parentDisplayList;if(!a)return!1;var o=r.renderMatrix;o.copyFrom(s);var h=a.root;h!==n.$stage&&n.$getConcatenatedMatrixAt(h,o)}else{var l=i||n.$getContentBounds();r.renderVisible=n.$getConcatenatedVisible();var a=n.$displayList||n.$parentDisplayList,u=r.renderRegion;if(!a)return u.setTo(0,0,0,0),r.moved=!1,!1;if(!r.moved)return!1;r.moved=!1;var o=r.renderMatrix;o.copyFrom(s);var h=a.root;h!==n.$stage&&n.$getConcatenatedMatrixAt(h,o),u.updateRegion(l,o);var c=n.$measureFiltersOffset();c&&(u.minX+=c.minX,u.minY+=c.minY,u.maxX+=c.maxX,u.maxY+=c.maxY,u.updateArea())}return!0},a.$measureFiltersOffset=function(){var e=this.$DisplayObject[20];if(e&&e.length){for(var i=e.length,n=0,r=0,s=0,a=0,o=0;i>o;o++){var h=e[o];if("blur"==h.type){var l=h.blurX,u=h.blurY;n-=l,r-=u,s+=2*l,a+=2*u}else if("glow"==h.type){var l=h.blurX,u=h.blurY;n-=l,r-=u,s+=2*l,a+=2*u;var c=h.distance||0,d=h.angle||0,f=0,g=0;0!=c&&(f=Math.ceil(c*t.NumberUtils.cos(d)),g=Math.ceil(c*t.NumberUtils.sin(d)),f>0?s+=f:0>f&&(n+=f,s-=f),g>0?a+=g:0>g&&(r+=g,a-=g))}}return{minX:n,minY:r,maxX:s,maxY:a}}return null},a.$getConcatenatedMatrixAt=function(e,i){var n=e.$getInvertedConcatenatedMatrix();if(0===n.a||0===n.d){var r=this,s=e.$nestLevel;for(i.identity();r.$nestLevel>s;){var a=r.$scrollRect;a&&i.concat(t.$TempMatrix.setTo(1,0,0,1,-a.x,-a.y)),i.concat(r.$getMatrix()),r=r.$parent}}else n.$preMultiplyInto(i,i)},a.$getConcatenatedAlphaAt=function(t,e){var i=t.$getConcatenatedAlpha();if(0===i){e=1;for(var n=this,r=t.$nestLevel;n.$nestLevel>r;)e*=n.$alpha,n=n.$parent}else e/=i;return e},a.$render=function(){},a.$hitTest=function(t,e){var i=this.$DisplayObject;if(!this.$renderNode||!this.$visible||0==i[0]||0==i[1])return null;var n=this.$getInvertedConcatenatedMatrix();if(0==n.a&&0==n.b&&0==n.c&&0==n.d)return null;var r=this.$getContentBounds(),s=n.a*t+n.c*e+n.tx,a=n.b*t+n.d*e+n.ty;if(r.contains(s,a)){if(!this.$children){var o=this.$scrollRect?this.$scrollRect:this.$maskRect;if(o&&!o.contains(s,a))return null;if(this.$mask&&!this.$mask.$hitTest(t,e))return null}return this}return null},a.hitTestPoint=function(e,i,n){if(n){var r,s=this.$getInvertedConcatenatedMatrix(),a=s.a*e+s.c*i+s.tx,o=s.b*e+s.d*i+s.ty,h=this.$displayList;if(h){var l=h.renderBuffer;try{r=l.getPixel(a-h.offsetX,o-h.offsetY)}catch(u){throw new Error(t.sys.tr(1039))}}else{var l=t.sys.customHitTestBuffer;l.resize(3,3);var c=t.Matrix.create();c.identity(),c.translate(1-a,1-o),t.sys.systemRenderer.render(this,l,c,null,!0),t.Matrix.release(c);try{r=l.getPixel(1,1)}catch(u){throw new Error(t.sys.tr(1039))}}return 0===r[3]?!1:!0}var d=this.$DisplayObject;if(0==d[0]||0==d[1])return!1;var s=this.$getInvertedConcatenatedMatrix(),f=this.getBounds(null,!1),a=s.a*e+s.c*i+s.tx,o=s.b*e+s.d*i+s.ty;if(f.contains(a,o)){var g=this.$scrollRect?this.$scrollRect:this.$maskRect;return g&&!g.contains(a,o)?!1:!0}return!1},a.$addListener=function(e,r,s,a,o,h){i.prototype.$addListener.call(this,e,r,s,a,o,h);var l=e==t.Event.ENTER_FRAME;if(l||e==t.Event.RENDER){var u=l?n.$enterFrameCallBackList:n.$renderCallBackList;-1==u.indexOf(this)&&u.push(this)}},a.removeEventListener=function(e,r,s,a){i.prototype.removeEventListener.call(this,e,r,s,a);var o=e==t.Event.ENTER_FRAME;if((o||e==t.Event.RENDER)&&!this.hasEventListener(e)){var h=o?n.$enterFrameCallBackList:n.$renderCallBackList,l=h.indexOf(this);-1!==l&&h.splice(l,1)}},a.dispatchEvent=function(t){if(!t.$bubbles)return i.prototype.dispatchEvent.call(this,t);var e=this.$getPropagationList(this),n=.5*e.length;return t.$setTarget(this),this.$dispatchPropagationEvent(t,e,n),!t.$isDefaultPrevented},a.$getPropagationList=function(t){for(var e=[];t;)e.push(t),t=t.$parent;var i=e.concat();return i.reverse(),e=i.concat(e)},a.$dispatchPropagationEvent=function(t,e,i){for(var n=e.length,r=i-1,s=0;n>s;s++){var a=e[s];if(t.$currentTarget=a,t.$eventPhase=r>s?1:s==i||s==r?2:3,a.$notifyListener(t,i>s),t.$isPropagationStopped||t.$isPropagationImmediateStopped)return}},a.willTrigger=function(t){for(var e=this;e;){if(e.hasEventListener(t))return!0;e=e.$parent}return!1},n.defaultTouchEnabled=!1,n.boundsForUpdate=new t.Rectangle,n.$enterFrameCallBackList=[],n.$renderCallBackList=[],n}(t.EventDispatcher);t.DisplayObject=i,t.registerClass(i,"egret.DisplayObject",["egret.sys.Renderable"])}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(n){e.call(this),this.$scale9Grid=null,this.$fillMode="scale",this._pixelHitTest=!1,this.$renderNode=new t.sys.BitmapNode,this.$Bitmap={0:null,1:null,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:i.defaultSmoothing,11:0/0,12:0/0},this.$setBitmapData(n)}__extends(i,e);var n=__define,r=i,s=r.prototype;return s.$onAddToStage=function(i,n){e.prototype.$onAddToStage.call(this,i,n);var r=this.$Bitmap[0];r&&t.BitmapData.$addDisplayObject(this,r)},s.$onRemoveFromStage=function(){e.prototype.$onRemoveFromStage.call(this);var i=this.$Bitmap[0];i&&t.BitmapData.$removeDisplayObject(this,i)},n(s,"bitmapData",function(){var e=this.$Bitmap[0];return e instanceof t.Texture?null:e},function(t){this.$setBitmapData(t)}),n(s,"texture",function(){var e=this.$Bitmap[0];return e instanceof t.Texture?e:null},function(t){this.$setBitmapData(t)}),s.$setBitmapData=function(e){var i=this.$Bitmap,n=i[0];if(e==n)return!1;if(i[0]=e,!e)return n&&t.BitmapData.$removeDisplayObject(this,n),this.setImageData(null,0,0,0,0,0,0,0,0,0,0),this.$invalidateContentBounds(),!0;if(this.$refreshImageData(),this.$stage){if(n){var r;r=n._bitmapData&&n._bitmapData.hashCode?n._bitmapData.hashCode:n.hashCode;var s;if(s=e._bitmapData&&e._bitmapData.hashCode?e._bitmapData.hashCode:e.hashCode,r==s)return this.$invalidateContentBounds(),!0;t.BitmapData.$removeDisplayObject(this,n)}t.BitmapData.$addDisplayObject(this,e)}return this.$invalidateContentBounds(),!0},s.$refreshImageData=function(){var e=this.$Bitmap,i=e[0];if(i)if(i instanceof t.Texture){var n=i;this.setImageData(n._bitmapData,n._bitmapX,n._bitmapY,n._bitmapWidth,n._bitmapHeight,n._offsetX,n._offsetY,n.$getTextureWidth(),n.$getTextureHeight(),n._sourceWidth,n._sourceHeight)}else{var r=i.width,s=i.height;this.setImageData(i,0,0,r,s,0,0,r,s,r,s)}},s.setImageData=function(t,e,i,n,r,s,a,o,h,l,u){var c=this.$Bitmap;c[1]=t,c[2]=e,c[3]=i,c[4]=n,c[5]=r,c[6]=s,c[7]=a,c[8]=o,c[9]=h,c[13]=l,c[14]=u},n(s,"scale9Grid",function(){return this.$scale9Grid},function(t){this.$scale9Grid=t,this.$invalidateContentBounds()}),n(s,"fillMode",function(){return this.$fillMode},function(t){this.$setFillMode(t)}),s.$setFillMode=function(t){return t==this.$fillMode?!1:(this.$fillMode=t,!0)},n(s,"smoothing",function(){var t=this.$Bitmap;return t[10]},function(t){t=!!t;var e=this.$Bitmap;t!=e[10]&&(e[10]=t,this.$invalidate())}),s.$setWidth=function(t){var e=this.$Bitmap;return 0>t||t==e[11]?!1:(e[11]=t,this.$invalidateContentBounds(),!0)},s.$setHeight=function(t){var e=this.$Bitmap;return 0>t||t==e[12]?!1:(e[12]=t,this.$invalidateContentBounds(),!0)},s.$getWidth=function(){var t=this.$Bitmap;return isNaN(t[11])?this.$getContentBounds().width:t[11]},s.$getHeight=function(){var t=this.$Bitmap;return isNaN(t[12])?this.$getContentBounds().height:t[12]},s.$measureContentBounds=function(t){var e=this.$Bitmap;if(e[1]){var e=this.$Bitmap,i=isNaN(e[11])?e[8]:e[11],n=isNaN(e[12])?e[9]:e[12];t.setTo(0,0,i,n)}else i=isNaN(e[11])?0:e[11],n=isNaN(e[12])?0:e[12],t.setTo(0,0,i,n)},s.$render=function(){var e=this.$Bitmap;if(e[1]){var i=isNaN(e[11])?e[8]:e[11],n=isNaN(e[12])?e[9]:e[12];t.sys.BitmapNode.$updateTextureData(this.$renderNode,e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],i,n,e[13],e[14],this.scale9Grid||e[0].scale9Grid,this.fillMode,e[10])}},n(s,"pixelHitTest",function(){return this._pixelHitTest},function(t){this._pixelHitTest=!!t}),s.$hitTest=function(t,i){var n=e.prototype.$hitTest.call(this,t,i);return n&&this._pixelHitTest&&(n=this.hitTestPixel(t,i)),n},s.hitTestPixel=function(e,i){var n,r=this.$getInvertedConcatenatedMatrix(),s=r.a*e+r.c*i+r.tx,a=r.b*e+r.d*i+r.ty,o=this.$displayList;if(o){var h=o.renderBuffer;try{n=h.getPixel(s-o.offsetX,a-o.offsetY)}catch(l){throw console.log(this.$Bitmap[0]),new Error(t.sys.tr(1039))}}else{var h=t.sys.customHitTestBuffer;h.resize(3,3);var u=this.$getRenderNode(),c=t.Matrix.create();c.identity(),c.translate(1-s,1-a),t.sys.systemRenderer.drawNodeToBuffer(u,h,c,!0),t.Matrix.release(c);try{n=h.getPixel(1,1)}catch(l){throw console.log(this.$Bitmap[0]),new Error(t.sys.tr(1039))}}return 0===n[3]?null:this},i.$drawImage=function(e,i,n,r,s,a,o,h,l,u,c,d,f,g,p,v,$){console.warn("deprecated method : Bitmap.$drawImage,use egret.sys.BitmapNode.$drawImage instead of it"),t.sys.BitmapNode.$updateTextureData(e,i,n,r,s,a,o,h,l,u,c,d,f,g,p,v,$)},i.defaultSmoothing=!0,i}(t.DisplayObject);t.Bitmap=e,t.registerClass(e,"egret.Bitmap")}(egret||(egret={}));var egret;!function(t){function e(){var t=Object.create(null);return t.__v8__=void 0,delete t.__v8__,t}t.createMap=e}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(t){e.call(this),this.format="image",this.$deleteSource=!0,this.source=t,this.width=t.width,this.height=t.height}__extends(i,e);var n=i,r=n.prototype;return r.$dispose=function(){t.Capabilities.runtimeType==t.RuntimeType.WEB&&"webgl"==t.Capabilities.renderMode&&this.webGLTexture&&(t.WebGLUtils.deleteWebGLTexture(this.webGLTexture),this.webGLTexture=null),this.source&&this.source.dispose&&this.source.dispose(),this.source=null,i.$dispose(this)},i.$addDisplayObject=function(t,e){var n;if(n=e._bitmapData&&e._bitmapData.hashCode?e._bitmapData.hashCode:e.hashCode){if(!i._displayList[n])return void(i._displayList[n]=[t]);var r=i._displayList[n];r.indexOf(t)<0&&r.push(t)}},i.$removeDisplayObject=function(t,e){var n;if(n=e._bitmapData&&e._bitmapData.hashCode?e._bitmapData.hashCode:e.hashCode,n&&i._displayList[n]){var r=i._displayList[n],s=r.indexOf(t);s>=0&&r.splice(s)}},i.$invalidate=function(e){var n;if(n=e._bitmapData&&e._bitmapData.hashCode?e._bitmapData.hashCode:e.hashCode,n&&i._displayList[n])for(var r=i._displayList[n],s=0;s<r.length;s++)r[s]instanceof t.Bitmap&&r[s].$refreshImageData(),r[s].$invalidateContentBounds()},i.$dispose=function(e){var n;if(n=e._bitmapData&&e._bitmapData.hashCode?e._bitmapData.hashCode:e.hashCode,n&&i._displayList[n]){for(var r=i._displayList[n],s=0;s<r.length;s++)r[s]instanceof t.Bitmap&&(r[s].$Bitmap[1]=null),r[s].$invalidateContentBounds();delete i._displayList[n]}},i._displayList=t.createMap(),i}(t.HashObject);t.BitmapData=e,t.registerClass(e,"egret.BitmapData")}(egret||(egret={}));var egret;!function(t){t.BitmapFillMode={REPEAT:"repeat",SCALE:"scale",CLIP:"clip"}}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}var e=t;return e.prototype,t.NORMAL="normal",t.ADD="add",t.ERASE="erase",t}();t.BlendMode=e,t.registerClass(e,"egret.BlendMode")}(egret||(egret={}));var egret;!function(t){var e;!function(t){function e(t){var e=r[t];return void 0===e?0:e}function i(t){var e=n[t];return void 0===e?"normal":e}for(var n=["normal","add","erase"],r={},s=n.length,a=0;s>a;a++){var o=n[a];r[o]=a}t.blendModeToNumber=e,t.numberToBlendMode=i}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){t.CapsStyle={NONE:"none",ROUND:"round",SQUARE:"square"}}(egret||(egret={}));var egret;!function(t){t.DirtyRegionPolicy={OFF:"off",ON:"on"}}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){e.call(this),this.$touchChildren=!0,this.$children=[]}__extends(i,e);var n=__define,r=i,s=r.prototype;return s.$propagateFlagsDown=function(t){if(!this.$hasFlags(t)){this.$setFlags(t);for(var e=this.$children,i=e.length,n=0;i>n;n++)e[n].$propagateFlagsDown(t)}},n(s,"numChildren",function(){return this.$children.length}),s.addChild=function(t){var e=this.$children.length;return t.$parent==this&&e--,this.$doAddChild(t,e)},s.addChildAt=function(t,e){return e=0|+e,(0>e||e>=this.$children.length)&&(e=this.$children.length,t.$parent==this&&e--),this.$doAddChild(t,e)},s.$doAddChild=function(e,n,r){void 0===r&&(r=!0);var s=e.$parent;if(s==this)return this.doSetChildIndex(e,n),e;s&&s.removeChild(e),this.$children.splice(n,0,e),e.$setParent(this);var a=this.$stage;if(a&&e.$onAddToStage(a,this.$nestLevel+1),r&&e.dispatchEventWith(t.Event.ADDED,!0),a)for(var o=i.$EVENT_ADD_TO_STAGE_LIST;o.length;){var h=o.shift();h.$stage&&r&&h.dispatchEventWith(t.Event.ADDED_TO_STAGE)}var l=this.$displayList||this.$parentDisplayList;return this.assignParentDisplayList(e,l,l),e.$propagateFlagsDown(1648),this.$propagateFlagsUp(4),this.$childAdded(e,n),e},s.contains=function(t){for(;t;){if(t==this)return!0;t=t.$parent}return!1},s.getChildAt=function(t){return t=0|+t,t>=0&&t<this.$children.length?this.$children[t]:null},s.getChildIndex=function(t){return this.$children.indexOf(t)},s.getChildByName=function(t){for(var e,i=this.$children,n=i.length,r=0;n>r;r++)if(e=i[r],e.name==t)return e;return null},s.removeChild=function(t){var e=this.$children.indexOf(t);return e>=0?this.$doRemoveChild(e):null},s.removeChildAt=function(t){return t=0|+t,t>=0&&t<this.$children.length?this.$doRemoveChild(t):null},s.$doRemoveChild=function(e,n){void 0===n&&(n=!0),e=0|+e;var r=this.$children,s=r[e];if(this.$childRemoved(s,e),n&&s.dispatchEventWith(t.Event.REMOVED,!0),this.$stage){s.$onRemoveFromStage();for(var a=i.$EVENT_REMOVE_FROM_STAGE_LIST;a.length>0;){var o=a.shift();n&&o.$hasAddToStage&&(o.$hasAddToStage=!1,o.dispatchEventWith(t.Event.REMOVED_FROM_STAGE)),o.$hasAddToStage=!1,o.$stage=null}}var h=this.$displayList||this.$parentDisplayList;this.assignParentDisplayList(s,h,null),s.$propagateFlagsDown(1648),s.$setParent(null);
var l=r.indexOf(s);return-1!=l&&r.splice(l,1),this.$propagateFlagsUp(4),s},s.setChildIndex=function(t,e){e=0|+e,(0>e||e>=this.$children.length)&&(e=this.$children.length-1),this.doSetChildIndex(t,e)},s.doSetChildIndex=function(t,e){var i=this.$children.indexOf(t);i!=e&&(this.$childRemoved(t,i),this.$children.splice(i,1),this.$children.splice(e,0,t),this.$childAdded(t,e),t.$invalidateTransform(),this.$propagateFlagsUp(4))},s.swapChildrenAt=function(t,e){t=0|+t,e=0|+e,t>=0&&t<this.$children.length&&e>=0&&e<this.$children.length&&this.doSwapChildrenAt(t,e)},s.swapChildren=function(t,e){var i=this.$children.indexOf(t),n=this.$children.indexOf(e);-1==i||-1==n||this.doSwapChildrenAt(i,n)},s.doSwapChildrenAt=function(t,e){if(t>e){var i=e;e=t,t=i}else if(t==e)return;var n=this.$children,r=n[t],s=n[e];this.$childRemoved(r,t),this.$childRemoved(s,e),n[t]=s,n[e]=r,this.$childAdded(s,t),this.$childAdded(r,e),r.$invalidateTransform(),s.$invalidateTransform(),this.$propagateFlagsUp(4)},s.removeChildren=function(){for(var t=this.$children,e=t.length-1;e>=0;e--)this.$doRemoveChild(e)},s.$childAdded=function(){},s.$childRemoved=function(){},s.$onAddToStage=function(t,i){e.prototype.$onAddToStage.call(this,t,i);var n=this.$children,r=n.length;i++;for(var s=0;r>s;s++){var a=this.$children[s];a.$onAddToStage(t,i)}},s.$onRemoveFromStage=function(){e.prototype.$onRemoveFromStage.call(this);for(var t=this.$children,i=t.length,n=0;i>n;n++){var r=t[n];r.$onRemoveFromStage()}},s.$measureChildBounds=function(e){var i=this.$children,n=i.length;if(0!=n){for(var r=0,s=0,a=0,o=0,h=!1,l=-1;n>l;l++){var u=-1==l?e:i[l].$getTransformedBounds(this,t.$TempRectangle);u.isEmpty()||(h?(r=Math.min(r,u.x),s=Math.max(s,u.x+u.width),a=Math.min(a,u.y),o=Math.max(o,u.y+u.height)):(h=!0,r=u.x,s=r+u.width,a=u.y,o=a+u.height))}e.setTo(r,a,s-r,o-a)}},n(s,"touchChildren",function(){return this.$getTouchChildren()},function(t){this.$setTouchChildren(!!t)}),s.$getTouchChildren=function(){return this.$touchChildren},s.$setTouchChildren=function(t){return this.$touchChildren==t?!1:(this.$touchChildren=t,!0)},s.$invalidate=function(t){if(e.prototype.$invalidate.call(this,t),t){var i=this.$displayList||this.$parentDisplayList,n=this.$children;if(n)for(var r=n.length-1;r>=0;r--)this.markChildDirty(n[r],i)}},s.$invalidateTransform=function(){this.markChildDirty(this,this.$parentDisplayList)},s.markChildDirty=function(t,e){if(!t.$hasFlags(512)){t.$setFlags(512);var i=t.$displayList;if((i||t.$renderNode)&&e&&e.markDirty(i||t),!i){var n=t.$children;if(n)for(var r=n.length-1;r>=0;r--)this.markChildDirty(n[r],e)}}},s.$cacheAsBitmapChanged=function(){e.prototype.$cacheAsBitmapChanged.call(this);for(var t=this.$displayList||this.$parentDisplayList,i=this.$children,n=i.length-1;n>=0;n--)this.assignParentDisplayList(i[n],t,t)},s.assignParentDisplayList=function(t,e,i){t.$parentDisplayList=i,t.$setFlags(512);var n=t.$displayList;if((t.$renderNode||n)&&e&&e.markDirty(n||t),!n){var r=t.$children;if(r)for(var s=r.length-1;s>=0;s--)this.assignParentDisplayList(r[s],e,i)}},s.$hitTest=function(t,i){if(!this.$visible)return null;var n=this.$getInvertedConcatenatedMatrix(),r=n.a*t+n.c*i+n.tx,s=n.b*t+n.d*i+n.ty,a=this.$scrollRect?this.$scrollRect:this.$maskRect;if(a&&!a.contains(r,s))return null;if(this.$mask&&!this.$mask.$hitTest(t,i))return null;for(var o=this.$children,h=!1,l=o.length-1;l>=0;l--){var u=o[l];if(!u.$maskedObject){var c=u.$hitTest(t,i);if(c){if(h=!0,c.$touchEnabled)break;c=null}}}return c?this.$touchChildren?c:this:h?this:e.prototype.$hitTest.call(this,t,i)},s.$setAlpha=function(t){return t=+t||0,t==this.$alpha?!1:(this.$alpha=t,this.$propagateFlagsDown(64),this.$invalidate(),this.$invalidateAllChildren(),!0)},s.$invalidateAllChildren=function(){var t=this.$children;if(t)for(var e=t.length-1;e>=0;e--){var i=t[e];i.$invalidate(),i.$children&&i.$invalidateAllChildren()}},i.$EVENT_ADD_TO_STAGE_LIST=[],i.$EVENT_REMOVE_FROM_STAGE_LIST=[],i}(t.DisplayObject);t.DisplayObjectContainer=e,t.registerClass(e,"egret.DisplayObjectContainer")}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}var e=t;return e.prototype,t.LINEAR="linear",t.RADIAL="radial",t}();t.GradientType=e,t.registerClass(e,"egret.GradientType")}(egret||(egret={}));var egret;!function(t){function e(t){return t%=2*Math.PI,0>t&&(t+=2*Math.PI),t}var i=function(i){function n(){i.call(this),this.lastX=0,this.lastY=0,this.fillPath=null,this.strokePath=null,this.topLeftStrokeWidth=0,this.bottomRightStrokeWidth=0,this.minX=1/0,this.minY=1/0,this.maxX=-(1/0),this.maxY=-(1/0),this.includeLastPosition=!0,this.$renderNode=new t.sys.GraphicsNode}__extends(n,i);var r=n,s=r.prototype;return s.$setTarget=function(t){this.targetDisplay&&(this.targetDisplay.$renderNode=null),t.$renderNode=this.$renderNode,this.targetDisplay=t},s.setStrokeWidth=function(t){switch(t){case 1:this.topLeftStrokeWidth=0,this.bottomRightStrokeWidth=1;break;case 3:this.topLeftStrokeWidth=1,this.bottomRightStrokeWidth=2;break;default:var e=0|Math.ceil(.5*t);this.topLeftStrokeWidth=e,this.bottomRightStrokeWidth=e}},s.beginFill=function(t,e){void 0===e&&(e=1),t=+t||0,e=+e||0,this.fillPath=this.$renderNode.beginFill(t,e,this.strokePath),this.$renderNode.drawData.length>1&&this.fillPath.moveTo(this.lastX,this.lastY)},s.beginGradientFill=function(t,e,i,n,r){void 0===r&&(r=null),this.fillPath=this.$renderNode.beginGradientFill(t,e,i,n,r,this.strokePath),this.$renderNode.drawData.length>1&&this.fillPath.moveTo(this.lastX,this.lastY)},s.endFill=function(){this.fillPath=null},s.lineStyle=function(t,e,i,n,r,s,a,o){void 0===t&&(t=0/0),void 0===e&&(e=0),void 0===i&&(i=1),void 0===n&&(n=!1),void 0===r&&(r="normal"),void 0===s&&(s=null),void 0===a&&(a=null),void 0===o&&(o=3),t=+t||0,0>=t?(this.strokePath=null,this.setStrokeWidth(0)):(e=+e||0,i=+i||0,o=+o||0,this.setStrokeWidth(t),this.strokePath=this.$renderNode.lineStyle(t,e,i,s,a,o),this.$renderNode.drawData.length>1&&this.strokePath.moveTo(this.lastX,this.lastY))},s.drawRect=function(t,e,i,n){t=+t||0,e=+e||0,i=+i||0,n=+n||0;var r=this.fillPath,s=this.strokePath;r&&r.drawRect(t,e,i,n),s&&s.drawRect(t,e,i,n),this.extendBoundsByPoint(t+i,e+n),this.updatePosition(t,e),this.$renderNode.dirtyRender=!0},s.drawRoundRect=function(t,e,i,n,r,s){t=+t||0,e=+e||0,i=+i||0,n=+n||0,r=+r||0,s=+s||0;var a=this.fillPath,o=this.strokePath;a&&a.drawRoundRect(t,e,i,n,r,s),o&&o.drawRoundRect(t,e,i,n,r,s);var h=.5*r|0,l=s?.5*s|0:h,u=t+i,c=e+n,d=c-l;this.extendBoundsByPoint(t,e),this.extendBoundsByPoint(u,c),this.updatePosition(u,d),this.$renderNode.dirtyRender=!0},s.drawCircle=function(t,e,i){t=+t||0,e=+e||0,i=+i||0;var n=this.fillPath,r=this.strokePath;n&&n.drawCircle(t,e,i),r&&r.drawCircle(t,e,i),this.extendBoundsByPoint(t-i,e-i),this.extendBoundsByPoint(t+i,e+i),this.updatePosition(t+i,e),this.$renderNode.dirtyRender=!0},s.drawEllipse=function(t,e,i,n){t=+t||0,e=+e||0,i=+i||0,n=+n||0;var r=this.fillPath,s=this.strokePath;r&&r.drawEllipse(t,e,i,n),s&&s.drawEllipse(t,e,i,n),this.extendBoundsByPoint(t+i,e+n),this.updatePosition(t+i,e+.5*n),this.$renderNode.dirtyRender=!0},s.moveTo=function(t,e){t=+t||0,e=+e||0;var i=this.fillPath,n=this.strokePath;i&&i.moveTo(t,e),n&&n.moveTo(t,e),this.includeLastPosition=!1,this.lastX=t,this.lastY=e,this.$renderNode.dirtyRender=!0},s.lineTo=function(t,e){t=+t||0,e=+e||0;var i=this.fillPath,n=this.strokePath;i&&i.lineTo(t,e),n&&n.lineTo(t,e),this.updatePosition(t,e),this.$renderNode.dirtyRender=!0},s.curveTo=function(t,e,i,n){t=+t||0,e=+e||0,i=+i||0,n=+n||0;var r=this.fillPath,s=this.strokePath;r&&r.curveTo(t,e,i,n),s&&s.curveTo(t,e,i,n),this.extendBoundsByPoint(t,e),this.extendBoundsByPoint(i,n),this.updatePosition(i,n),this.$renderNode.dirtyRender=!0},s.cubicCurveTo=function(t,e,i,n,r,s){t=+t||0,e=+e||0,i=+i||0,n=+n||0,r=+r||0,s=+s||0;var a=this.fillPath,o=this.strokePath;a&&a.cubicCurveTo(t,e,i,n,r,s),o&&o.cubicCurveTo(t,e,i,n,r,s),this.extendBoundsByPoint(t,e),this.extendBoundsByPoint(i,n),this.extendBoundsByPoint(r,s),this.updatePosition(r,s),this.$renderNode.dirtyRender=!0},s.drawArc=function(t,i,n,r,s,a){if(!(0>n||r===s)){t=+t||0,i=+i||0,n=+n||0,r=+r||0,s=+s||0,a=!!a,r=e(r),s=e(s);var o=this.fillPath,h=this.strokePath;o&&(o.$lastX=this.lastX,o.$lastY=this.lastY,o.drawArc(t,i,n,r,s,a)),h&&(h.$lastX=this.lastX,h.$lastY=this.lastY,h.drawArc(t,i,n,r,s,a)),a?this.arcBounds(t,i,n,s,r):this.arcBounds(t,i,n,r,s);var l=t+Math.cos(s)*n,u=i+Math.sin(s)*n;this.updatePosition(l,u),this.$renderNode.dirtyRender=!0}},s.arcBounds=function(t,e,i,n,r){var s=Math.PI;if(Math.abs(n-r)<.01)return this.extendBoundsByPoint(t-i,e-i),void this.extendBoundsByPoint(t+i,e+i);n>r&&(r+=2*s);for(var a=Math.cos(n)*i,o=Math.cos(r)*i,h=Math.min(a,o),l=Math.max(a,o),u=Math.sin(n)*i,c=Math.sin(r)*i,d=Math.min(u,c),f=Math.max(u,c),g=n/(.5*s),p=r/(.5*s),v=Math.ceil(g);p>=v;v++)switch(v%4){case 0:l=i;break;case 1:f=i;break;case 2:h=-i;break;case 3:d=-i}h=Math.floor(h),d=Math.floor(d),l=Math.ceil(l),f=Math.ceil(f),this.extendBoundsByPoint(h+t,d+e),this.extendBoundsByPoint(l+t,f+e)},s.clear=function(){this.$renderNode.clear(),this.updatePosition(0,0),this.minX=1/0,this.minY=1/0,this.maxX=-(1/0),this.maxY=-(1/0)},s.extendBoundsByPoint=function(t,e){this.extendBoundsByX(t),this.extendBoundsByY(e)},s.extendBoundsByX=function(t){this.minX=Math.min(this.minX,t-this.topLeftStrokeWidth),this.maxX=Math.max(this.maxX,t+this.bottomRightStrokeWidth),this.updateNodeBounds()},s.extendBoundsByY=function(t){this.minY=Math.min(this.minY,t-this.topLeftStrokeWidth),this.maxY=Math.max(this.maxY,t+this.bottomRightStrokeWidth),this.updateNodeBounds()},s.updateNodeBounds=function(){var t=this.$renderNode;t.x=this.minX,t.y=this.minY,t.width=Math.ceil(this.maxX-this.minX),t.height=Math.ceil(this.maxY-this.minY)},s.updatePosition=function(t,e){this.includeLastPosition||(this.extendBoundsByPoint(this.lastX,this.lastY),this.includeLastPosition=!0),this.lastX=t,this.lastY=e,this.extendBoundsByPoint(t,e),this.targetDisplay.$invalidateContentBounds()},s.$measureContentBounds=function(t){this.minX===1/0?t.setEmpty():t.setTo(this.minX,this.minY,this.maxX-this.minX,this.maxY-this.minY)},s.$hitTest=function(e,i){var n=this.targetDisplay,r=n.$getInvertedConcatenatedMatrix(),s=r.a*e+r.c*i+r.tx,a=r.b*e+r.d*i+r.ty,o=t.sys.canvasHitTestBuffer;o.resize(3,3);var h=this.$renderNode,l=t.Matrix.create();l.identity(),l.translate(1-s,1-a),t.sys.canvasRenderer.drawNodeToBuffer(h,o,l,!0),t.Matrix.release(l);try{var u=o.getPixel(1,1)}catch(c){throw new Error(t.sys.tr(1039))}return 0===u[3]?null:n},s.$onRemoveFromStage=function(){this.$renderNode&&this.$renderNode.clean()},n}(t.HashObject);t.Graphics=i,t.registerClass(i,"egret.Graphics")}(egret||(egret={}));var egret;!function(t){t.JointStyle={BEVEL:"bevel",MITER:"miter",ROUND:"round"}}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(i){e.call(this,i),this._verticesDirty=!0,this._bounds=new t.Rectangle,this.$renderNode=new t.sys.MeshNode}__extends(i,e);var n=i,r=n.prototype;return r.$render=function(){var e=this.$Bitmap,i=e[1];if(i){var n=(t.$TextureScaleFactor,this.$renderNode);n.smoothing=e[10],n.image=i,n.imageWidth=e[13],n.imageHeight=e[14];var r=isNaN(e[11])?e[8]:e[11],s=isNaN(e[12])?e[9]:e[12],a=r/e[8],o=s/e[9],h=e[4],l=e[5];n.drawMesh(e[2],e[3],h,l,e[6]*a,e[7]*o,a*h,o*l)}},r.$updateVertices=function(){this._verticesDirty=!0,this.$invalidateContentBounds()},r.$measureContentBounds=function(t){if(this._verticesDirty){this._verticesDirty=!1;var e=this.$renderNode,i=e.vertices;if(i.length){this._bounds.setTo(Number.MAX_VALUE,Number.MAX_VALUE,Number.MIN_VALUE,Number.MIN_VALUE);for(var n=0,r=i.length;r>n;n+=2){var s=i[n],a=i[n+1];this._bounds.x>s&&(this._bounds.x=s),this._bounds.width<s&&(this._bounds.width=s),this._bounds.y>a&&(this._bounds.y=a),this._bounds.height<a&&(this._bounds.height=a)}this._bounds.width-=this._bounds.x,this._bounds.height-=this._bounds.y}else this._bounds.setTo(0,0,0,0);e.bounds.copyFrom(this._bounds)}t.copyFrom(this._bounds)},i}(t.Bitmap);t.Mesh=e,t.registerClass(e,"egret.Mesh")}(egret||(egret={}));var egret;!function(t){t.OrientationMode={AUTO:"auto",PORTRAIT:"portrait",LANDSCAPE:"landscape",LANDSCAPE_FLIPPED:"landscapeFlipped"}}(egret||(egret={}));var egret;!function(t){t.$TextureScaleFactor=1;var e=function(e){function i(){e.call(this),this._bitmapX=0,this._bitmapY=0,this._bitmapWidth=0,this._bitmapHeight=0,this._offsetX=0,this._offsetY=0,this._textureWidth=0,this._textureHeight=0,this._sourceWidth=0,this._sourceHeight=0,this._bitmapData=null}__extends(i,e);var n=__define,r=i,s=r.prototype;return n(s,"textureWidth",function(){return this.$getTextureWidth()}),s.$getTextureWidth=function(){return this._textureWidth},n(s,"textureHeight",function(){return this.$getTextureHeight()}),s.$getTextureHeight=function(){return this._textureHeight},s.$getScaleBitmapWidth=function(){return this._bitmapWidth*t.$TextureScaleFactor},s.$getScaleBitmapHeight=function(){return this._bitmapHeight*t.$TextureScaleFactor},n(s,"bitmapData",function(){return this._bitmapData}),s._setBitmapData=function(e){this._bitmapData=e;var i=t.$TextureScaleFactor,n=e.width*i,r=e.height*i;this.$initData(0,0,n,r,0,0,n,r,e.width,e.height)},s.$initData=function(e,i,n,r,s,a,o,h,l,u){var c=t.$TextureScaleFactor;this._bitmapX=e/c,this._bitmapY=i/c,this._bitmapWidth=n/c,this._bitmapHeight=r/c,this._offsetX=s,this._offsetY=a,this._textureWidth=o,this._textureHeight=h,this._sourceWidth=l,this._sourceHeight=u,t.BitmapData.$invalidate(this)},s.getPixel32=function(){throw new Error},s.toDataURL=function(){throw new Error},s.saveToFile=function(){throw new Error},s.dispose=function(){this._bitmapData&&(this._bitmapData.$dispose(),this._bitmapData=null)},i}(t.HashObject);t.Texture=e,t.registerClass(e,"egret.Texture")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){e.call(this),this.renderBuffer=new t.sys.CanvasRenderBuffer;var i=new t.BitmapData(this.renderBuffer.surface);i.$deleteSource=!1,this._setBitmapData(i)}__extends(i,e);var n=i,r=n.prototype;return r.drawToTexture=function(e,i,n){if(void 0===n&&(n=1),i&&(0==i.width||0==i.height))return!1;var r=i||e.$getOriginalBounds();if(0==r.width||0==r.height)return!1;n/=t.$TextureScaleFactor;var s=(r.x+r.width)*n,a=(r.y+r.height)*n;i&&(s=r.width*n,a=r.height*n);var o=this.renderBuffer;if(!o)return!1;o.resize(s,a),this._bitmapData.width=s,this._bitmapData.height=a;var h=t.Matrix.create();return h.identity(),i&&h.translate(-i.x,-i.y),h.scale(n,n),t.sys.canvasRenderer.render(e,o,h,null,!0),t.Matrix.release(h),this.$initData(0,0,s,a,0,0,s,a,s,a),e.$propagateFlagsDown(128),!0},r.getPixel32=function(e,i){var n;if(this.renderBuffer){var r=t.$TextureScaleFactor;e=Math.round(e/r),i=Math.round(i/r),n=this.renderBuffer.getPixel(e,i)}return n},r.dispose=function(){e.prototype.dispose.call(this),this.renderBuffer=null},i}(t.Texture);t.RenderTexture=e,t.registerClass(e,"egret.RenderTexture")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){e.call(this),this.$graphics=new t.Graphics,this.$graphics.$setTarget(this)}__extends(i,e);var n=__define,r=i,s=r.prototype;return n(s,"graphics",function(){return this.$graphics}),s.$measureContentBounds=function(t){this.$graphics.$measureContentBounds(t)},s.$hitTest=function(t,i){var n=e.prototype.$hitTest.call(this,t,i);return n==this&&(n=this.$graphics.$hitTest(t,i)),n},s.$onRemoveFromStage=function(){e.prototype.$onRemoveFromStage.call(this),this.$graphics&&this.$graphics.$onRemoveFromStage()},i}(t.DisplayObject);t.Shape=e,t.registerClass(e,"egret.Shape")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){e.call(this),this.$graphics=new t.Graphics,this.$graphics.$setTarget(this)}__extends(i,e);var n=__define,r=i,s=r.prototype;return n(s,"graphics",function(){return this.$graphics}),s.$hitTest=function(e,i){if(!this.$visible)return null;var n=this.$getInvertedConcatenatedMatrix(),r=n.a*e+n.c*i+n.tx,s=n.b*e+n.d*i+n.ty,a=this.$scrollRect?this.$scrollRect:this.$maskRect;if(a&&!a.contains(r,s))return null;if(this.$mask&&!this.$mask.$hitTest(e,i))return null;for(var o=this.$children,h=!1,l=o.length-1;l>=0;l--){var u=o[l];if(!u.$maskedObject){var c=u.$hitTest(e,i);if(c){if(h=!0,c.$touchEnabled)break;c=null}}}return c?this.$touchChildren?c:this:h?this:(c=t.DisplayObject.prototype.$hitTest.call(this,e,i),c&&(c=this.$graphics.$hitTest(e,i)),c)},s.$measureContentBounds=function(t){this.$graphics.$measureContentBounds(t)},s.$onRemoveFromStage=function(){e.prototype.$onRemoveFromStage.call(this),this.$graphics&&this.$graphics.$onRemoveFromStage()},i}(t.DisplayObjectContainer);t.Sprite=e,t.registerClass(e,"egret.Sprite")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(i){e.call(this),this._bitmapX=0,this._bitmapY=0,this._textureMap=t.createMap(),this.$texture=i,this._bitmapX=i._bitmapX-i._offsetX,this._bitmapY=i._bitmapY-i._offsetY}__extends(i,e);var n=i,r=n.prototype;return r.getTexture=function(t){return this._textureMap[t]},r.createTexture=function(e,i,n,r,s,a,o,h,l){void 0===a&&(a=0),void 0===o&&(o=0),void 0===h&&(h=a+r),void 0===l&&(l=o+s);var u=new t.Texture;return u._bitmapData=this.$texture._bitmapData,u.$initData(this._bitmapX+i,this._bitmapY+n,r,s,a,o,h,l,this.$texture._sourceWidth,this.$texture._sourceHeight),this._textureMap[e]=u,u},r.dispose=function(){this.$texture&&this.$texture.dispose()},i}(t.HashObject);t.SpriteSheet=e,t.registerClass(e,"egret.SpriteSheet")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){e.call(this),this.$stageWidth=0,this.$stageHeight=0,this.implMap={},this.$scaleMode=t.StageScaleMode.SHOW_ALL,this.$orientation=t.OrientationMode.AUTO,this.$maxTouches=99,this.$dirtyRegionPolicy=t.DirtyRegionPolicy.ON,this.$stage=this,this.$nestLevel=1}__extends(i,e);var n=__define,r=i,s=r.prototype;return n(s,"frameRate",function(){return t.sys.$ticker.$frameRate},function(e){t.sys.$ticker.$setFrameRate(e)}),n(s,"stageWidth",function(){return this.$stageWidth}),n(s,"stageHeight",function(){return this.$stageHeight}),s.invalidate=function(){t.sys.$invalidateRenderFlag=!0},s.registerImplementation=function(t,e){this.implMap[t]=e},s.getImplementation=function(t){return this.implMap[t]},n(s,"scaleMode",function(){return this.$scaleMode},function(t){this.$scaleMode!=t&&(this.$scaleMode=t,this.$screen.updateScreenSize())}),n(s,"orientation",function(){return this.$orientation},function(t){this.$orientation!=t&&(this.$orientation=t,this.$screen.updateScreenSize())}),n(s,"textureScaleFactor",function(){return t.$TextureScaleFactor},function(e){t.$TextureScaleFactor=e}),n(s,"maxTouches",function(){return this.$maxTouches},function(t){this.$maxTouches!=t&&(this.$maxTouches=t,this.$screen.updateMaxTouches())}),n(s,"dirtyRegionPolicy",function(){return this.$dirtyRegionPolicy},function(t){this.$dirtyRegionPolicy!=t&&(this.$dirtyRegionPolicy=t,this.$displayList.setDirtyRegionPolicy(t))}),s.setContentSize=function(t,e){this.$screen.setContentSize(t,e)},i}(t.DisplayObjectContainer);t.Stage=e,t.registerClass(e,"egret.Stage")}(egret||(egret={}));var egret;!function(t){var e=function(t){function e(e,i,n,r){t.call(this),this.$eventPhase=2,this.$currentTarget=null,this.$target=null,this.$isDefaultPrevented=!1,this.$isPropagationStopped=!1,this.$isPropagationImmediateStopped=!1,this.$type=e,this.$bubbles=!!i,this.$cancelable=!!n,this.data=r}__extends(e,t);var i=__define,n=e,r=n.prototype;return i(r,"type",function(){return this.$type}),i(r,"bubbles",function(){return this.$bubbles}),i(r,"cancelable",function(){return this.$cancelable}),i(r,"eventPhase",function(){return this.$eventPhase}),i(r,"currentTarget",function(){return this.$currentTarget}),i(r,"target",function(){return this.$target}),r.$setTarget=function(t){return this.$target=t,!0},r.isDefaultPrevented=function(){return this.$isDefaultPrevented},r.preventDefault=function(){this.$cancelable&&(this.$isDefaultPrevented=!0)},r.stopPropagation=function(){this.$bubbles&&(this.$isPropagationStopped=!0)},r.stopImmediatePropagation=function(){this.$bubbles&&(this.$isPropagationImmediateStopped=!0)},r.clean=function(){this.data=this.$currentTarget=null,this.$setTarget(null)},e.dispatchEvent=function(t,i,n,r){void 0===n&&(n=!1);var s=e.create(e,i,n),a=e._getPropertyData(e);void 0!=r&&(a.data=r);var o=t.dispatchEvent(s);return e.release(s),o},e._getPropertyData=function(t){var e=t._props;return e||(e=t._props={}),e},e.create=function(t,e,i,n){var r=t.eventPool;if(r||(r=t.eventPool=[]),r.length){var s=r.pop();return s.$type=e,s.$bubbles=!!i,s.$cancelable=!!n,s.$isDefaultPrevented=!1,s.$isPropagationStopped=!1,s.$isPropagationImmediateStopped=!1,s.$eventPhase=2,s}return new t(e,i,n)},e.release=function(t){t.clean();var e=Object.getPrototypeOf(t).constructor;e.eventPool.push(t)},e.ADDED_TO_STAGE="addedToStage",e.REMOVED_FROM_STAGE="removedFromStage",e.ADDED="added",e.REMOVED="removed",e.ENTER_FRAME="enterFrame",e.RENDER="render",e.RESIZE="resize",e.CHANGE="change",e.CHANGING="changing",e.COMPLETE="complete",e.LOOP_COMPLETE="loopComplete",e.FOCUS_IN="focusIn",e.FOCUS_OUT="focusOut",e.ENDED="ended",e.ACTIVATE="activate",e.DEACTIVATE="deactivate",e.CLOSE="close",e.CONNECT="connect",e.LEAVE_STAGE="leaveStage",e.SOUND_COMPLETE="soundComplete",e}(t.HashObject);t.Event=e,t.registerClass(e,"egret.Event")}(egret||(egret={}));var egret;!function(t){var e=function(t){function e(e,i,n){void 0===i&&(i=!1),void 0===n&&(n=!1),t.call(this,e,i,n)}__extends(e,t);var i=e;return i.prototype,e.FOCUS_IN="focusIn",e.FOCUS_OUT="focusOut",e}(t.Event);t.FocusEvent=e,t.registerClass(e,"egret.FocusEvent")}(egret||(egret={}));var egret;!function(t){var e=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=e;return i.prototype,e.PERMISSION_DENIED="permissionDenied",e.UNAVAILABLE="unavailable",e}(t.Event);t.GeolocationEvent=e,t.registerClass(e,"egret.GeolocationEvent")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(t,i,n){void 0===i&&(i=!1),void 0===n&&(n=!1),e.call(this,t,i,n),this._status=0}__extends(i,e);var n=__define,r=i,s=r.prototype;return n(s,"status",function(){return this._status}),i.dispatchHTTPStatusEvent=function(e,n){var r=t.Event.create(i,i.HTTP_STATUS);r._status=n;var s=e.dispatchEvent(r);return t.Event.release(r),s},i.HTTP_STATUS="httpStatus",i}(t.Event);t.HTTPStatusEvent=e,t.registerClass(e,"egret.HTTPStatusEvent")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(t,i,n){void 0===i&&(i=!1),void 0===n&&(n=!1),e.call(this,t,i,n)}__extends(i,e);var n=i;return n.prototype,i.dispatchIOErrorEvent=function(e){var n=t.Event.create(i,i.IO_ERROR),r=e.dispatchEvent(n);return t.Event.release(n),r},i.IO_ERROR="ioError",i}(t.Event);t.IOErrorEvent=e,t.registerClass(e,"egret.IOErrorEvent")}(egret||(egret={}));var egret;!function(t){var e=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=e;return i.prototype,e}(t.Event);t.MotionEvent=e,t.registerClass(e,"egret.MotionEvent")}(egret||(egret={}));var egret;!function(t){var e=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=e;return i.prototype,e}(t.Event);t.OrientationEvent=e,t.registerClass(e,"egret.OrientationEvent")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(t,i,n,r,s){void 0===i&&(i=!1),void 0===n&&(n=!1),void 0===r&&(r=0),void 0===s&&(s=0),e.call(this,t,i,n),this.bytesLoaded=0,this.bytesTotal=0,this.bytesLoaded=r,this.bytesTotal=s}__extends(i,e);var n=i;return n.prototype,i.dispatchProgressEvent=function(e,n,r,s){void 0===r&&(r=0),void 0===s&&(s=0);var a=t.Event.create(i,n);a.bytesLoaded=r,a.bytesTotal=s;var o=e.dispatchEvent(a);return t.Event.release(a),o},i.PROGRESS="progress",i.SOCKET_DATA="socketData",i}(t.Event);t.ProgressEvent=e,t.registerClass(e,"egret.ProgressEvent")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(t,i,n){void 0===i&&(i=!1),void 0===n&&(n=!1),e.call(this,t,i,n)}__extends(i,e);var n=i;return n.prototype,i.dispatchStageOrientationEvent=function(e,n){var r=t.Event.create(i,n),s=e.dispatchEvent(r);return t.Event.release(r),s},i.ORIENTATION_CHANGE="orientationChange",i}(t.Event);t.StageOrientationEvent=e,t.registerClass(e,"egret.StageOrientationEvent")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(t,i,n,r){void 0===i&&(i=!1),void 0===n&&(n=!1),void 0===r&&(r=""),e.call(this,t,i,n),this.text=r}__extends(i,e);var n=i;return n.prototype,i.dispatchTextEvent=function(e,n,r){var s=t.Event.create(i,n);s.text=r;var a=e.dispatchEvent(s);return t.Event.release(s),a},i.LINK="link",i}(t.Event);t.TextEvent=e,t.registerClass(e,"egret.TextEvent")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(t,i,n){e.call(this,t,i,n)}__extends(i,e);var n=i,r=n.prototype;return r.updateAfterEvent=function(){t.sys.$requestRenderingFlag=!0},i.dispatchTimerEvent=function(e,n,r,s){var a=t.Event.create(i,n,r,s),o=e.dispatchEvent(a);return t.Event.release(a),o},i.TIMER="timer",i.TIMER_COMPLETE="timerComplete",i}(t.Event);t.TimerEvent=e,t.registerClass(e,"egret.TimerEvent")}(egret||(egret={}));var egret;!function(t){var e=[],i=Math.PI/180,n=function(n){function r(t,e){void 0===t&&(t=0),void 0===e&&(e=0),n.call(this),this.x=t,this.y=e}__extends(r,n);var s=__define,a=r,o=a.prototype;return r.release=function(t){t&&e.push(t)},r.create=function(t,i){var n=e.pop();return n||(n=new r),n.setTo(t,i)},s(o,"length",function(){return Math.sqrt(this.x*this.x+this.y*this.y)}),o.setTo=function(t,e){return this.x=t,this.y=e,this},o.clone=function(){return new r(this.x,this.y)},o.equals=function(t){return this.x==t.x&&this.y==t.y},r.distance=function(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))},o.copyFrom=function(t){this.x=t.x,this.y=t.y},o.add=function(t){return new r(this.x+t.x,this.y+t.y)},r.interpolate=function(t,e,i){var n=1-i;return new r(t.x*i+e.x*n,t.y*i+e.y*n)},o.normalize=function(t){if(0!=this.x||0!=this.y){var e=t/this.length;this.x*=e,this.y*=e}},o.offset=function(t,e){this.x+=t,this.y+=e},r.polar=function(e,n){return new r(e*t.NumberUtils.cos(n/i),e*t.NumberUtils.sin(n/i))},o.subtract=function(t){return new r(this.x-t.x,this.y-t.y)},o.toString=function(){return"(x="+this.x+", y="+this.y+")"},r}(t.HashObject);t.Point=n,t.registerClass(n,"egret.Point"),t.$TempPoint=new n}(egret||(egret={}));var egret;!function(t){var e=new t.Point,i=function(i){function n(t,e,n,r,s,a){i.call(this,t,e,n),this.targetChanged=!0,this.touchDown=!1,this.$initTo(r,s,a)}__extends(n,i);var r=__define,s=n,a=s.prototype;return a.$initTo=function(t,e,i){this.touchPointID=+i||0,this.$stageX=+t||0,this.$stageY=+e||0},r(a,"stageX",function(){return this.$stageX}),r(a,"stageY",function(){return this.$stageY}),r(a,"localX",function(){return this.targetChanged&&this.getLocalXY(),this._localX}),r(a,"localY",function(){return this.targetChanged&&this.getLocalXY(),this._localY}),a.getLocalXY=function(){this.targetChanged=!1;var t=this.$target.$getInvertedConcatenatedMatrix();t.transformPoint(this.$stageX,this.$stageY,e),this._localX=e.x,this._localY=e.y},a.$setTarget=function(t){return this.$target=t,this.targetChanged=!!t,!0},a.updateAfterEvent=function(){t.sys.$requestRenderingFlag=!0},n.dispatchTouchEvent=function(e,i,r,s,a,o,h,l){if(void 0===l&&(l=!1),!r&&!e.hasEventListener(i))return!0;var u=t.Event.create(n,i,r,s);u.$initTo(a,o,h),u.touchDown=l;var c=e.dispatchEvent(u);return t.Event.release(u),c},n.TOUCH_MOVE="touchMove",n.TOUCH_BEGIN="touchBegin",n.TOUCH_END="touchEnd",n.TOUCH_CANCEL="touchcancel",n.TOUCH_TAP="touchTap",n.TOUCH_RELEASE_OUTSIDE="touchReleaseOutside",n.TOUCH_ROLL_OUT="touchRollOut",n.TOUCH_ROLL_OVER="touchRollOver",n}(t.Event);t.TouchEvent=i,t.registerClass(i,"egret.TouchEvent")}(egret||(egret={}));var egret;!function(){}(egret||(egret={}));var egret;!function(t){var e=function(t){function e(){t.apply(this,arguments),this.type=null,this.$targets=[]}__extends(e,t);var i=e,n=i.prototype;return n.$addTarget=function(t){for(var e=this.$targets.length,i=0;e>i;i++)if(this.$targets[i].$hashCode==t.$hashCode)return;this.$targets.push(t)},n.$removeTarget=function(t){for(var e=this.$targets.length,i=0;e>i;i++)if(this.$targets[i].$hashCode==t.$hashCode)return void this.$targets.splice(i,1)},n.invalidate=function(){for(var t=this.$targets.length,e=0;t>e;e++)this.$targets[e].$invalidateContentBounds()},n.$toJson=function(){return""},e}(t.HashObject);t.Filter=e,t.registerClass(e,"egret.Filter")}(egret||(egret={}));var egret;!function(t){var e=function(t){function e(e,i,n){void 0===e&&(e=4),void 0===i&&(i=4),void 0===n&&(n=1),t.call(this),this.type="blur",this.$blurX=e,this.$blurY=i,this.$quality=n}__extends(e,t);var i=__define,n=e,r=n.prototype;return i(r,"blurX",function(){return this.$blurX},function(t){this.$blurX!=t&&(this.$blurX=t,this.invalidate())}),i(r,"blurY",function(){return this.$blurY},function(t){this.$blurY!=t&&(this.$blurY=t,this.invalidate())}),r.$toJson=function(){return'{"blurX": '+this.$blurX+', "blurY": '+this.$blurY+', "quality": 1}'},e}(t.Filter);t.BlurFilter=e,t.registerClass(e,"egret.BlurFilter")}(egret||(egret={}));var egret;!function(t){var e=function(t){function e(e){void 0===e&&(e=null),t.call(this),this.$matrix=[],this.matrix2=[],this.type="colorTransform",this.setMatrix(e)}__extends(e,t);var i=__define,n=e,r=n.prototype;return i(r,"matrix",function(){for(var t=0;20>t;t++)this.matrix2[t]=this.$matrix[t];return this.matrix2},function(t){this.setMatrix(t),this.invalidate()}),r.setMatrix=function(t){if(t)for(var e=0;20>e;e++)this.$matrix[e]=t[e];else for(var e=0;20>e;e++)this.$matrix[e]=0==e||6==e||12==e||18==e?1:0},r.$toJson=function(){return'{"matrix": ['+this.$matrix.toString()+"]}"},e}(t.Filter);t.ColorMatrixFilter=e,t.registerClass(e,"egret.ColorMatrixFilter")}(egret||(egret={}));var egret;!function(t){var e=function(t){function e(e,i,n,r,s,a,o,h){void 0===e&&(e=16711680),void 0===i&&(i=1),void 0===n&&(n=6),void 0===r&&(r=6),void 0===s&&(s=2),void 0===a&&(a=1),void 0===o&&(o=!1),void 0===h&&(h=!1),t.call(this),this.type="glow",this.$color=e,this.$blue=255&e,this.$green=(65280&e)>>8,this.$red=e>>16,this.$alpha=i,this.$blurX=n,this.$blurY=r,this.$strength=s,this.$quality=a,this.$inner=o,this.$knockout=h}__extends(e,t);var i=__define,n=e,r=n.prototype;return i(r,"color",function(){return this.$color},function(t){this.$color!=t&&(this.$color=t,this.$blue=255&t,this.$green=(65280&t)>>8,this.$red=t>>16,this.invalidate())}),i(r,"alpha",function(){return this.$alpha},function(t){this.$alpha!=t&&(this.$alpha=t,this.invalidate())}),i(r,"blurX",function(){return this.$blurX},function(t){this.$blurX!=t&&(this.$blurX=t,this.invalidate())}),i(r,"blurY",function(){return this.$blurY},function(t){this.$blurY!=t&&(this.$blurY=t,this.invalidate())}),i(r,"strength",function(){return this.$strength},function(t){this.$strength!=t&&(this.$strength=t,this.invalidate())}),i(r,"quality",function(){return this.$quality},function(t){this.$quality!=t&&(this.$quality=t,this.invalidate())}),i(r,"inner",function(){return this.$inner},function(t){this.$inner!=t&&(this.$inner=t,this.invalidate())}),i(r,"knockout",function(){return this.$knockout},function(t){this.$knockout!=t&&(this.$knockout=t,this.invalidate())}),r.$toJson=function(){return'{"color": '+this.$color+', "red": '+this.$red+', "green": '+this.$green+', "blue": '+this.$blue+', "alpha": '+this.$alpha+', "blurX": '+this.$blurX+', "blurY": '+this.blurY+', "strength": '+this.$strength+', "quality": '+this.$quality+', "inner": '+this.$inner+', "knockout": '+this.$knockout+"}"},e}(t.Filter);t.GlowFilter=e,t.registerClass(e,"egret.GlowFilter")}(egret||(egret={}));var egret;!function(t){var e=function(t){function e(e,i,n,r,s,a,o,h,l,u,c){void 0===e&&(e=4),void 0===i&&(i=45),void 0===n&&(n=0),void 0===r&&(r=1),void 0===s&&(s=4),void 0===a&&(a=4),void 0===o&&(o=1),void 0===h&&(h=1),void 0===l&&(l=!1),void 0===u&&(u=!1),void 0===c&&(c=!1),t.call(this,n,r,s,a,o,h,l,u),this.$distance=e,this.$angle=i,this.$hideObject=c}__extends(e,t);
var i=__define,n=e,r=n.prototype;return i(r,"distance",function(){return this.$distance},function(t){this.$distance!=t&&(this.$distance=t,this.invalidate())}),i(r,"angle",function(){return this.$angle},function(t){this.$angle!=t&&(this.$angle=t,this.invalidate())}),i(r,"hideObject",function(){return this.$hideObject},function(t){this.$hideObject!=t&&(this.$hideObject=t,this.invalidate())}),r.$toJson=function(){return'{"distance": '+this.$distance+', "angle": '+this.$angle+', "color": '+this.$color+', "red": '+this.$red+', "green": '+this.$green+', "blue": '+this.$blue+', "alpha": '+this.$alpha+', "blurX": '+this.$blurX+', "blurY": '+this.blurY+', "strength": '+this.$strength+', "quality": '+this.$quality+', "inner": '+this.$inner+', "knockout": '+this.$knockout+', "hideObject": '+this.$hideObject+"}"},e}(t.GlowFilter);t.DropShadowFilter=e,t.registerClass(e,"egret.DropShadowFilter")}(egret||(egret={}));var egret;!function(t){var e=Math.PI,i=2*e,n=e/180,r=[],s=function(s){function a(t,e,i,n,r,a){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===r&&(r=0),void 0===a&&(a=0),s.call(this),this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=a}__extends(a,s);var o=a,h=o.prototype;return a.release=function(t){t&&r.push(t)},a.create=function(){var t=r.pop();return t||(t=new a),t},h.clone=function(){return new a(this.a,this.b,this.c,this.d,this.tx,this.ty)},h.concat=function(t){var e=this.a*t.a,i=0,n=0,r=this.d*t.d,s=this.tx*t.a+t.tx,a=this.ty*t.d+t.ty;(0!==this.b||0!==this.c||0!==t.b||0!==t.c)&&(e+=this.b*t.c,r+=this.c*t.b,i+=this.a*t.b+this.b*t.d,n+=this.c*t.a+this.d*t.c,s+=this.ty*t.c,a+=this.tx*t.b),this.a=e,this.b=i,this.c=n,this.d=r,this.tx=s,this.ty=a},h.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},h.identity=function(){this.a=this.d=1,this.b=this.c=this.tx=this.ty=0},h.invert=function(){this.$invertInto(this)},h.$invertInto=function(t){var e=this.a,i=this.b,n=this.c,r=this.d,s=this.tx,a=this.ty;if(0==i&&0==n)return t.b=t.c=0,void(0==e||0==r?t.a=t.d=t.tx=t.ty=0:(e=t.a=1/e,r=t.d=1/r,t.tx=-e*s,t.ty=-r*a));var o=e*r-i*n;if(0==o)return void t.identity();o=1/o;var h=t.a=r*o;i=t.b=-i*o,n=t.c=-n*o,r=t.d=e*o,t.tx=-(h*s+n*a),t.ty=-(i*s+r*a)},h.rotate=function(e){if(e=+e,0!==e){e/=n;var i=t.NumberUtils.cos(e),r=t.NumberUtils.sin(e),s=this.a,a=this.b,o=this.c,h=this.d,l=this.tx,u=this.ty;this.a=s*i-a*r,this.b=s*r+a*i,this.c=o*i-h*r,this.d=o*r+h*i,this.tx=l*i-u*r,this.ty=l*r+u*i}},h.scale=function(t,e){1!==t&&(this.a*=t,this.c*=t,this.tx*=t),1!==e&&(this.b*=e,this.d*=e,this.ty*=e)},h.setTo=function(t,e,i,n,r,s){return this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=s,this},h.transformPoint=function(e,i,n){var r=this.a*e+this.c*i+this.tx,s=this.b*e+this.d*i+this.ty;return n?(n.setTo(r,s),n):new t.Point(r,s)},h.translate=function(t,e){this.tx+=t,this.ty+=e},h.equals=function(t){return this.a==t.a&&this.b==t.b&&this.c==t.c&&this.d==t.d&&this.tx==t.tx&&this.ty==t.ty},h.prepend=function(t,e,i,n,r,s){var a=this.tx;if(1!=t||0!=e||0!=i||1!=n){var o=this.a,h=this.c;this.a=o*t+this.b*i,this.b=o*e+this.b*n,this.c=h*t+this.d*i,this.d=h*e+this.d*n}return this.tx=a*t+this.ty*i+r,this.ty=a*e+this.ty*n+s,this},h.append=function(t,e,i,n,r,s){var a=this.a,o=this.b,h=this.c,l=this.d;return(1!=t||0!=e||0!=i||1!=n)&&(this.a=t*a+e*h,this.b=t*o+e*l,this.c=i*a+n*h,this.d=i*o+n*l),this.tx=r*a+s*h+this.tx,this.ty=r*o+s*l+this.ty,this},h.deltaTransformPoint=function(e){var i=this,n=i.a*e.x+i.c*e.y,r=i.b*e.x+i.d*e.y;return new t.Point(n,r)},h.toString=function(){return"(a="+this.a+", b="+this.b+", c="+this.c+", d="+this.d+", tx="+this.tx+", ty="+this.ty+")"},h.createBox=function(e,i,r,s,a){void 0===r&&(r=0),void 0===s&&(s=0),void 0===a&&(a=0);var o=this;if(0!==r){r/=n;var h=t.NumberUtils.cos(r),l=t.NumberUtils.sin(r);o.a=h*e,o.b=l*i,o.c=-l*e,o.d=h*i}else o.a=e,o.b=0,o.c=0,o.d=i;o.tx=s,o.ty=a},h.createGradientBox=function(t,e,i,n,r){void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),this.createBox(t/1638.4,e/1638.4,i,n+t/2,r+e/2)},h.$transformBounds=function(t){var e=this.a,i=this.b,n=this.c,r=this.d,s=this.tx,a=this.ty,o=t.x,h=t.y,l=o+t.width,u=h+t.height,c=e*o+n*h+s,d=i*o+r*h+a,f=e*l+n*h+s,g=i*l+r*h+a,p=e*l+n*u+s,v=i*l+r*u+a,$=e*o+n*u+s,m=i*o+r*u+a,y=0;c>f&&(y=c,c=f,f=y),p>$&&(y=p,p=$,$=y),t.x=Math.floor(p>c?c:p),t.width=Math.ceil((f>$?f:$)-t.x),d>g&&(y=d,d=g,g=y),v>m&&(y=v,v=m,m=y),t.y=Math.floor(v>d?d:v),t.height=Math.ceil((g>m?g:m)-t.y)},h.getDeterminant=function(){return this.a*this.d-this.b*this.c},h.$getScaleX=function(){var t=this;if(1==t.a&&0==t.b)return 1;var e=Math.sqrt(t.a*t.a+t.b*t.b);return this.getDeterminant()<0?-e:e},h.$getScaleY=function(){var t=this;if(0==t.c&&1==t.d)return 1;var e=Math.sqrt(t.c*t.c+t.d*t.d);return this.getDeterminant()<0?-e:e},h.$getSkewX=function(){return Math.atan2(this.d,this.c)-e/2},h.$getSkewY=function(){return Math.atan2(this.b,this.a)},h.$updateScaleAndRotation=function(e,r,s,a){if(!(0!=s&&s!=i||0!=a&&a!=i))return this.a=e,this.b=this.c=0,void(this.d=r);s/=n,a/=n;var o=t.NumberUtils.cos(s),h=t.NumberUtils.sin(s);s==a?(this.a=o*e,this.b=h*e):(this.a=t.NumberUtils.cos(a)*e,this.b=t.NumberUtils.sin(a)*e),this.c=-h*r,this.d=o*r},h.$preMultiplyInto=function(t,e){var i=t.a*this.a,n=0,r=0,s=t.d*this.d,a=t.tx*this.a+this.tx,o=t.ty*this.d+this.ty;(0!==t.b||0!==t.c||0!==this.b||0!==this.c)&&(i+=t.b*this.c,s+=t.c*this.b,n+=t.a*this.b+t.b*this.d,r+=t.c*this.a+t.d*this.c,a+=t.ty*this.c,o+=t.tx*this.b),e.a=i,e.b=n,e.c=r,e.d=s,e.tx=a,e.ty=o},a}(t.HashObject);t.Matrix=s,t.registerClass(s,"egret.Matrix"),t.$TempMatrix=new s}(egret||(egret={}));var egret;!function(t){t.$locale_strings=t.$locale_strings||{},t.$locale_strings.en_US=t.$locale_strings.en_US||{};var e=t.$locale_strings.en_US;e[1001]="Could not find Egret entry class: {0}",e[1002]="Egret entry class '{0}' must inherit from egret.DisplayObject.",e[1003]="Parameter {0} must be non-null.",e[1004]="An object cannot be added as a child to one of it's children (or children's children, etc.).",e[1005]="An object cannot be added as a child of itself.",e[1006]="The supplied DisplayObject must be a child of the caller.",e[1007]="An index specified for a parameter was out of range.",e[1008]="Instantiate singleton errorsingleton class {0} can not create multiple instances.",e[1009]='the Class {0} cannot use the property "{1}"',e[1010]='the property "{1}" of the Class "{0}" is readonly',e[1011]="Stream Error. URL: {0}",e[1012]="The type of parameter {0} must be Class.",e[1013]="Variable assignment is NaN, please see the code!",e[1014]='the constant "{1}" of the Class "{0}" is read-only',e[1015]="xml not found!",e[1016]="{0}has been obsoleted",e[1017]="The format of JSON file is incorrect: {0}\ndata: {1}",e[1018]="the scale9Grid is not correct",e[1019]="Network ab:{0}",e[1020]="Cannot initialize Shader",e[1021]="Current browser does not support webgl",e[1022]="{0} ArgumentError",e[1023]="This method is not available in the ScrollView!",e[1025]="end of the file",e[1026]="! EncodingError The code point {0} could not be encoded.",e[1027]="DecodingError",e[1028]=". called injection is not configured rule: {0}, please specify configuration during its initial years of injection rule, and then call the corresponding single case.",e[1029]="Function.prototype.bind - what is trying to be bound is not callable",e[1033]="Photos can not be used across domains toDataURL to convert base64",e[1034]='Music file decoding failed: "{0}", please use the standard conversion tool reconversion under mp3.',e[1035]="Native does not support this feature!",e[1036]="Sound has stopped, please recall Sound.play () to play the sound!",e[1037]="Non-load the correct blob!",e[1038]="XML format error!",e[1039]="crossOrigin images can not set pixelHitTest  property!",e[1040]="hitTestPoint can not detect crossOrigin images! Please check if the display object has crossOrigin elements.",e[1041]="egret.MainContext.runtimeType is deprecated, please use egret.Capabilities.runtimeType replace",e[1042]="The parameters passed in the region needs is an integer in drawToTexture method. Otherwise, some browsers will draw abnormal.",e[1043]="Compile errors in {0}, the attribute name: {1}, the attribute value: {2}.",e[1044]="The current version of the Runtime does not support video playback, please use the latest version",e[1045]="The resource url is not found",e[1046]="BitmapText no corresponding characters: {0}, please check the configuration file",e[1047]="egret.localStorage.setItem save failed,key={0}&value={1}",e[1048]="Video loading failed",e[1049]="In the absence of sound is not allowed to play after loading",e[3e3]="Theme configuration file failed to load: {0}",e[3001]="Cannot find the skin name which is configured in Theme: {0}",e[3002]='Index:"{0}" is out of the collection element index range',e[3003]="Cannot be available in this component. If this component is container, please continue to use",e[3004]="addChild(){0}addElement() replace",e[3005]="addChildAt(){0}addElementAt() replace",e[3006]="removeChild(){0}removeElement() replace",e[3007]="removeChildAt(){0}removeElementAt() replace",e[3008]="setChildIndex(){0}setElementIndex() replace",e[3009]="swapChildren(){0}swapElements() replace",e[3010]="swapChildrenAt(){0}swapElementsAt() replace",e[3011]='Index:"{0}" is out of the visual element index range',e[3012]="This method is not available in Scroller component!",e[3013]="UIStage is GUI root container, and only one such instant is in the display list",e[3014]="set fullscreen error",e[3100]="Current browser does not support WebSocket",e[3101]="Please connect Socket firstly",e[3102]="Please set the type of binary type",e[4e3]="An Bone cannot be added as a child to itself or one of its children (or children's children, etc.)",e[4001]="Abstract class can not be instantiated!",e[4002]="Unnamed data!",e[4003]="Nonsupport version!"}(egret||(egret={}));var egret;!function(t){t.$locale_strings=t.$locale_strings||{},t.$language="en_US"}(egret||(egret={}));var egret;!function(t){var e;!function(e){function i(e){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var r=t.$locale_strings[t.$language][e];if(!r)return"{"+e+"}";for(var s=i.length,a=0;s>a;a++)r=r.replace("{"+a+"}",i[a]);return r}e.tr=i}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){t.$locale_strings=t.$locale_strings||{},t.$locale_strings.zh_CN=t.$locale_strings.zh_CN||{};var e=t.$locale_strings.zh_CN;e[1001]="Egret: {0}",e[1002]="Egret {0} egret.DisplayObject",e[1003]=" {0}  null",e[1004]="",e[1005]="",e[1006]=" DisplayObject ",e[1007]="",e[1008]=" {0} ",e[1009]=" {0}  {1}",e[1010]=" {0}  {1} ",e[1011]="URL: {0}",e[1012]=" {0}  Class",e[1013]="NaN",e[1014]=" {0}  {1} ",e[1015]="xml not found!",e[1016]="{0}",e[1017]="JSON: {0}\ndata: {1}",e[1018]="9",e[1019]=":{0}",e[1020]="",e[1021]="webgl",e[1022]="{0} ArgumentError",e[1023]="ScrollView!",e[1025]="",e[1026]="EncodingError! The code point {0} could not be encoded.",e[1027]="DecodingError",e[1028]=":{0} ",e[1029]="Function.prototype.bind - what is trying to be bound is not callable",e[1033]="toDataURLbase64",e[1034]='"{0}"mp3',e[1035]="Native ",e[1036]=" Sound.play() ",e[1037]="blob",e[1038]="XML !",e[1039]=" pixelHitTest !",e[1040]="hitTestPoint ! ",e[1041]="egret.MainContext.runtimeType ,egret.Capabilities.runtimeType ",e[1042]="drawToTexture,",e[1043]="{0}  : {1} : {2}",e[1044]=" runtime ,",e[1045]="",e[1046]="BitmapText :{0}",e[1047]="egret.localStorage.setItem,key={0}&value={1}",e[1048]="",e[1049]="",e[3e3]=": {0}",e[3001]=": {0}",e[3002]=':"{0}"',e[3003]="",e[3004]="addChild(){0}addElement()",e[3005]="addChildAt(){0}addElementAt()",e[3006]="removeChild(){0}removeElement()",e[3007]="removeChildAt(){0}removeElementAt()",e[3008]="setChildIndex(){0}setElementIndex()",e[3009]="swapChildren(){0}swapElements()",e[3010]="swapChildrenAt(){0}swapElementsAt()",e[3011]=':"{0}"',e[3012]="Scroller!",e[3013]="UIStageGUI",e[3014]="",e[3100]="WebSocket",e[3101]="WebSocket",e[3102]="type",e[4e3]="An Bone cannot be added as a child to itself or one of its children (or children's children, etc.)",e[4001]="Abstract class can not be instantiated!",e[4002]="Unnamed data!",e[4003]="Nonsupport version!"}(egret||(egret={}));var egret;!function(t){var e;!function(){}(e=t.localStorage||(t.localStorage={}))}(egret||(egret={}));var egret;!function(t){var e;!function(t){function e(t){n.indexOf(t)<0&&n.push(t)}function i(t){var e=n.indexOf(t);return e>=0?(n.splice(e,1),!0):!1}var n=[];t.$pushSoundChannel=e,t.$popSoundChannel=i}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(){}(egret||(egret={}));var egret;!function(){}(egret||(egret={}));var egret;!function(t){var e=function(){function e(){this.onSuccessFunc=null,this.onSuccessThisObject=null,this.onErrorFunc=null,this.onErrorThisObject=null,this.downloadingSizeFunc=null,this.downloadingSizeThisObject=null,this.onResponseHeaderFunc=null,this.onResponseHeaderThisObject=null}var i=e,n=i.prototype;return e.create=function(){return e.promiseObjectList.length?e.promiseObjectList.pop():new t.PromiseObject},n.onSuccess=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];this.onSuccessFunc&&this.onSuccessFunc.apply(this.onSuccessThisObject,t),this.destroy()},n.onError=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];this.onErrorFunc&&this.onErrorFunc.apply(this.onErrorThisObject,t),this.destroy()},n.downloadingSize=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];this.downloadingSizeFunc&&this.downloadingSizeFunc.apply(this.downloadingSizeThisObject,t)},n.onResponseHeader=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];this.onResponseHeaderFunc&&this.onResponseHeaderFunc.apply(this.onResponseHeaderThisObject,t)},n.destroy=function(){this.onSuccessFunc=void 0,this.onSuccessThisObject=void 0,this.onErrorFunc=void 0,this.onErrorThisObject=void 0,this.downloadingSizeFunc=void 0,this.downloadingSizeThisObject=void 0,this.onResponseHeaderFunc=void 0,this.onResponseHeaderThisObject=void 0,e.promiseObjectList.push(this)},e.promiseObjectList=[],e}();t.PromiseObject=e,t.registerClass(e,"egret.PromiseObject")}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}var e=t;return e.prototype,t.GET="GET",t.POST="POST",t}();t.HttpMethod=e,t.registerClass(e,"egret.HttpMethod")}(egret||(egret={}));var egret;!function(){}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}var e=t;return e.prototype,t.TEXT="text",t.ARRAY_BUFFER="arraybuffer",t}();t.HttpResponseType=e,t.registerClass(e,"egret.HttpResponseType")}(egret||(egret={}));var egret;!function(){}(egret||(egret={}));var egret;!function(t){var e;!function(e){function i(t,e){var i=t.minX<e.minX?t.minX:e.minX,n=t.minY<e.minY?t.minY:e.minY,r=t.maxX>e.maxX?t.maxX:e.maxX,s=t.maxY>e.maxY?t.maxY:e.maxY;return(r-i)*(s-n)}var n=function(){function n(e){this.dirtyList=[],this.hasClipRect=!1,this.clipWidth=0,this.clipHeight=0,this.clipArea=0,this.clipRectChanged=!1,this.$dirtyRegionPolicy=t.DirtyRegionPolicy.ON,this.root=e}var r=n,s=r.prototype;return s.setClipRect=function(t,e){this.hasClipRect=!0,this.clipRectChanged=!0,this.clipWidth=Math.ceil(t),this.clipHeight=Math.ceil(e),this.clipArea=this.clipWidth*this.clipHeight},s.addRegion=function(i){var n=i.minX,r=i.minY,s=i.maxX,a=i.maxY;if(this.hasClipRect&&(0>n&&(n=0),0>r&&(r=0),s>this.clipWidth&&(s=this.clipWidth),a>this.clipHeight&&(a=this.clipHeight)),n>=s||r>=a)return!1;if(this.clipRectChanged)return!0;var o=this.dirtyList,h=e.Region.create();return o.push(h.setTo(n,r,s,a)),this.$dirtyRegionPolicy!=t.DirtyRegionPolicy.OFF&&this.mergeDirtyList(o),!0},s.clear=function(){for(var t=this.dirtyList,i=t.length,n=0;i>n;n++)e.Region.release(t[n]);t.length=0},s.getDirtyRegions=function(){var i=this.dirtyList;if(this.$dirtyRegionPolicy==t.DirtyRegionPolicy.OFF||t.Capabilities.runtimeType==t.RuntimeType.NATIVE&&!t["native"].$supportCanvas){this.clipRectChanged=!0,this.clear();var n=e.Region.create();if(this.hasClipRect)i.push(n.setTo(0,0,this.clipWidth,this.clipHeight));else{var r=this.root.$getOriginalBounds();i.push(n.setTo(r.x,r.y,r.width,r.height))}}else if(this.clipRectChanged){this.clipRectChanged=!1,this.clear();var n=e.Region.create();i.push(n.setTo(0,0,this.clipWidth,this.clipHeight))}else for(;this.mergeDirtyList(i););var s=this.dirtyList.length;if(s>0)for(var a=0;s>a;a++)this.dirtyList[a].intValues();return this.dirtyList},s.mergeDirtyList=function(t){var n=t.length;if(2>n)return!1;for(var r=this.hasClipRect,s=n>3?Number.POSITIVE_INFINITY:0,a=0,o=0,h=0,l=0;n-1>l;l++){var u=t[l];r&&(h+=u.area);for(var c=l+1;n>c;c++){var d=t[c],f=i(u,d)-u.area-d.area;s>f&&(a=l,o=c,s=f)}}if(r&&h/this.clipArea>.95&&(this.clipRectChanged=!0),a!=o){var g=t[o];return t[a].union(g),e.Region.release(g),t.splice(o,1),!0}return!1},s.setDirtyRegionPolicy=function(t){this.$dirtyRegionPolicy=t},n}();e.DirtyRegion=n,t.registerClass(n,"egret.sys.DirtyRegion")}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(i){function n(n){i.call(this),this.isStage=!1,this.$renderNode=new e.BitmapNode,this.renderBuffer=null,this.offsetX=0,this.offsetY=0,this.offsetMatrix=new t.Matrix,this.isDirty=!1,this.needUpdateRegions=!1,this.dirtyNodeList=[],this.dirtyList=null,this.sizeChanged=!1,this.$dirtyRegionPolicy=t.DirtyRegionPolicy.ON,this.root=n,this.dirtyRegion=new e.DirtyRegion(n),this.isStage=n instanceof t.Stage,this.dirtyNodes=t.createMap()}__extends(n,i);var r=n,s=r.prototype;return n.create=function(i){var n=new t.sys.DisplayList(i);try{var r=new e.RenderBuffer}catch(s){return null}return n.renderBuffer=r,n.root=i,n},s.$getRenderNode=function(){return this.$renderNode},s.$update=function(e){var i=this.root;if(null==i)return!1;i.$removeFlagsUp(768);var n=this.$renderNode,r=i.$getConcatenatedMatrix();if(e==t.DirtyRegionPolicy.OFF){var s=i.$parentDisplayList;if(this.needUpdateRegions&&this.updateDirtyRegions(),!s)return!1;var a=n.renderMatrix;a.copyFrom(r);var o=s.root;o!==i.$stage&&i.$getConcatenatedMatrixAt(o,a)}else{var h=i.$getOriginalBounds(),s=i.$parentDisplayList,l=n.renderRegion;if(this.needUpdateRegions&&this.updateDirtyRegions(),!s)return l.setTo(0,0,0,0),n.moved=!1,!1;if(!n.moved)return!1;n.moved=!1;var a=n.renderMatrix;a.copyFrom(r);var o=s.root;o!==i.$stage&&i.$getConcatenatedMatrixAt(o,a),l.updateRegion(h,a)}return!0},s.setClipRect=function(t,e){this.dirtyRegion.setClipRect(t,e),this.renderBuffer.resize(t,e)},s.markDirty=function(t){var e=t.$hashCode;if(!this.dirtyNodes[e]&&(this.dirtyNodes[e]=!0,this.dirtyNodeList.push(t),!this.needUpdateRegions)){this.needUpdateRegions=!0,this.isDirty=!0;var i=this.root.$parentDisplayList;i&&i.markDirty(this)}},s.updateDirtyRegions=function(){var e=this.dirtyNodeList;this.dirtyNodeList=[],this.dirtyNodes=t.createMap(),this.needUpdateRegions=!1;for(var i=this.dirtyRegion,n=e.length,r=0;n>r;r++){var s=e[r],a=s.$getRenderNode();if(a)if(a.needRedraw=!1,this.isStage){a.renderAlpha>0&&a.renderVisible&&i.addRegion(a.renderRegion)&&(a.needRedraw=!0);var o=s.$update(this.$dirtyRegionPolicy);a.renderAlpha>0&&a.renderVisible&&(o||!a.needRedraw)&&i.addRegion(a.renderRegion)&&(a.needRedraw=!0)}else{i.addRegion(a.renderRegion)&&(a.needRedraw=!0);var o=s.$update(this.$dirtyRegionPolicy);(o||!a.needRedraw)&&i.addRegion(a.renderRegion)&&(a.needRedraw=!0)}}return this.dirtyList=i.getDirtyRegions(),this.dirtyList},s.drawToSurface=function(){var i=0,n=this.dirtyList;if(n&&n.length>0){this.isStage||this.changeSurfaceSize();var r=this.renderBuffer;r.beginClip(this.dirtyList,this.offsetX,this.offsetY);var n=this.$dirtyRegionPolicy==t.DirtyRegionPolicy.OFF?null:this.dirtyList,i=e.systemRenderer.render(this.root,r,this.offsetMatrix,n);if(r.endClip(),!this.isStage){var s=r.surface,a=this.$renderNode;a.drawData.length=0;var o=s.width,h=s.height;this.bitmapData?(this.bitmapData.source=s,this.bitmapData.width=o,this.bitmapData.height=h):this.bitmapData=new t.BitmapData(s),a.image=this.bitmapData,a.imageWidth=o,a.imageHeight=h,a.drawImage(0,0,o,h,-this.offsetX,-this.offsetY,o,h)}}return this.dirtyList=null,this.dirtyRegion.clear(),this.isDirty=!1,i},s.changeSurfaceSize=function(){var t=(this.root,this.offsetX),e=this.offsetY,i=this.root.$getOriginalBounds();this.offsetX=-i.x,this.offsetY=-i.y,this.offsetMatrix.setTo(1,0,0,1,this.offsetX,this.offsetY);var n=this.renderBuffer,r=Math.max(257,i.width),s=Math.max(257,i.height);(this.offsetX!=t||this.offsetY!=e||n.surface.width!=r||n.surface.height!=s)&&(this.sizeChanged?n.resizeTo(r,s,this.offsetX-t,this.offsetY-e):(this.sizeChanged=!0,n.resize(r,s)))},s.setDirtyRegionPolicy=function(t){this.$dirtyRegionPolicy=t,this.dirtyRegion.setDirtyRegionPolicy(t),this.renderBuffer.setDirtyRegionPolicy(t)},n}(t.HashObject);e.DisplayList=i,t.registerClass(i,"egret.sys.DisplayList",["egret.sys.Renderable"])}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(){}(egret||(egret={}));var egret;!function(){}(egret||(egret={}));var egret;!function(t){var e;!function(e){function i(i,n,r,s){if(n&&(t.log=function(){for(var t=arguments.length,i="",n=0;t>n;n++)i+=arguments[n]+" ";e.$logToFPS(i),console.log.apply(console,a(arguments))}),l=s?{}:s,n=!!n,this.showFPS=!!i,this.showLog=n,!this.fpsDisplay){var o=void 0===s.x?0:s.x,c=void 0===s.y?0:s.y;h=this.fpsDisplay=new FPS(this.stage,i,n,r,s),h.x=o,h.y=c;for(var d=u.length,f=0;d>f;f++)h.updateInfo(u[f]);u=null}}function n(t){t=!!t,this._showPaintRect!=t&&(this._showPaintRect=t,t?(this.stageDisplayList||(this.stageDisplayList=e.DisplayList.create(this.stage)),this.stage.$displayList=this.stageDisplayList):this.stage.$displayList=this.screenDisplayList)}function r(t){for(var e=t.length,i=[],n=0;e>n;n++){var r=t[n];i[n]=[r.minX,r.minY,r.width,r.height],r.width-=1,r.height-=1}var s=this.paintList;s.push(i),s.length>1&&s.shift();var a=this.screenDisplayList.renderBuffer,o=a.context;for(o.setTransform(1,0,0,1,0,0),o.clearRect(0,0,a.surface.width,a.surface.height),o.drawImage(this.stageDisplayList.renderBuffer.surface,0,0),e=s.length,n=0;e>n;n++){i=s[n];for(var h=i.length-1;h>=0;h--){var l=i[h];this.drawDirtyRect(l[0],l[1],l[2],l[3],o)}}o.save(),o.beginPath();for(var e=t.length,n=0;e>n;n++){var r=t[n];o.clearRect(r.minX,r.minY,r.width,r.height),o.rect(r.minX,r.minY,r.width,r.height)}o.clip(),o.drawImage(this.stageDisplayList.renderBuffer.surface,0,0),o.restore()}function s(t,e,i,n,r){r.strokeStyle="rgb(255,0,0)",r.lineWidth=5,r.strokeRect(t-.5,e-.5,i,n)}function a(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i]);return e}var o=function(a){function o(t,e,o){a.call(this),this.isPlaying=!1,this.entryClassName=o,this.stage=e,this.screenDisplayList=this.createDisplayList(e,t),this.showFPS=!1,this.showLog=!1,this._showPaintRect=!1,this.stageDisplayList=null,this.paintList=[],this.displayFPS=i,this.showPaintRect=n,this.drawPaintRect=r,this.drawDirtyRect=s}__extends(o,a);var h=o,l=h.prototype;return l.createDisplayList=function(t,i){var n=new e.DisplayList(t);return n.renderBuffer=i,t.$displayList=n,n},l.start=function(){!this.isPlaying&&this.stage&&(e.$TempStage=e.$TempStage||this.stage,this.isPlaying=!0,this.root||this.initialize(),e.$ticker.$addPlayer(this))},l.initialize=function(){var e;if(this.entryClassName&&(e=t.getDefinitionByName(this.entryClassName)),e){var i=new e;this.root=i,i instanceof t.DisplayObject&&this.stage.addChild(i)}},l.stop=function(){this.pause(),this.stage=null},l.pause=function(){this.isPlaying&&(this.isPlaying=!1,e.$ticker.$removePlayer(this))},l.$render=function(e,i){(this.showFPS||this.showLog)&&this.stage.addChild(this.fpsDisplay),this.callLaters(),this.callLaterAsyncs();var n=this.stage,r=t.getTimer(),s=n.$displayList.updateDirtyRegions(),a=t.getTimer();s=s.concat();var o=n.$displayList.drawToSurface();this._showPaintRect&&this.drawPaintRect(s);var h=t.getTimer();if(e&&this.showFPS){var l=0;if(o>0){for(var u=s.length,c=0,d=0;u>d;d++)c+=s[d].area;l=Math.ceil(1e3*c/(n.stageWidth*n.stageHeight))/10}this.fpsDisplay.update(o,l,a-r,h-a,i)}},l.callLaters=function(){if(t.$callLaterFunctionList.length>0){var e=t.$callLaterFunctionList;t.$callLaterFunctionList=[];var i=t.$callLaterThisList;t.$callLaterThisList=[];var n=t.$callLaterArgsList;t.$callLaterArgsList=[]}if(e)for(var r=e.length,s=0;r>s;s++){var a=e[s];null!=a&&a.apply(i[s],n[s])}},l.callLaterAsyncs=function(){if(t.$callAsyncFunctionList.length>0){var e=t.$callAsyncFunctionList,i=t.$callAsyncThisList,n=t.$callAsyncArgsList;t.$callAsyncFunctionList=[],t.$callAsyncThisList=[],t.$callAsyncArgsList=[];for(var r=0;r<e.length;r++){var s=e[r];null!=s&&s.apply(i[r],n[r])}}},l.updateStageSize=function(e,i){var n=this.stage;n.$stageWidth=e,n.$stageHeight=i,this.screenDisplayList.setClipRect(e,i),this.stageDisplayList&&this.stageDisplayList.setClipRect(e,i),n.dispatchEventWith(t.Event.RESIZE),n.$invalidate(!0)},o}(t.HashObject);e.Player=o,t.registerClass(o,"egret.sys.Player");var h,l,u=[];e.$logToFPS=function(t){return h?void h.updateInfo(t):void u.push(t)},FPS=function(i){function n(e,n,r,s,a){i.call(this),this.isFPS=!0,this.infoLines=[],this.totalTime=0,this.totalTick=0,this.lastTime=0,this.drawCalls=0,this.dirtyRatio=0,this.costDirty=0,this.costRender=0,this.costTicker=0,this._stage=e,this.showFPS=n,this.showLog=r,this.logFilter=s,this.touchChildren=!1,this.touchEnabled=!1,this.styles=a,this.fpsDisplay=new t.FPSDisplay(e,n,r,s,a),this.addChild(this.fpsDisplay);try{var o=s?new RegExp(s):null}catch(h){t.log(h)}this.filter=function(t){return o?o.test(t):!s||0==t.indexOf(s)}}return __extends(n,i),n.prototype.update=function(i,n,r,s,a){var o=t.getTimer();if(this.totalTime+=o-this.lastTime,this.lastTime=o,this.totalTick++,this.drawCalls+=i,this.dirtyRatio+=n,this.costDirty+=r,this.costRender+=s,this.costTicker+=a,this.totalTime>=1e3){var h=Math.min(Math.ceil(1e3*this.totalTick/this.totalTime),e.$ticker.$frameRate),l=Math.round(this.drawCalls/this.totalTick),u=Math.round(this.dirtyRatio/this.totalTick),c=Math.round(this.costDirty/this.totalTick),d=Math.round(this.costRender/this.totalTick),f=Math.round(this.costTicker/this.totalTick);this.fpsDisplay.update({fps:h,draw:l,dirty:u,costTicker:f,costDirty:c,costRender:d}),this.totalTick=0,this.totalTime=this.totalTime%1e3,this.drawCalls=0,this.dirtyRatio=0,this.costDirty=0,this.costRender=0,this.costTicker=0}},n.prototype.updateInfo=function(t){t&&this.showLog&&this.filter(t)&&this.fpsDisplay.updateInfo(t)},n}(t.Sprite),t.warn=function(){console.warn.apply(console,a(arguments))},t.error=function(){console.error.apply(console,a(arguments))},t.assert=function(){console.assert.apply(console,a(arguments))},t.log=function(){console.log.apply(console,a(arguments))}}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=[],n=function(){function t(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.width=0,this.height=0,this.area=0,this.moved=!1}var e=t,n=e.prototype;return t.release=function(t){i.push(t)},t.create=function(){var e=i.pop();return e||(e=new t),e},n.setTo=function(t,e,i,n){return this.minX=t,this.minY=e,this.maxX=i,this.maxY=n,this.updateArea(),this},n.intValues=function(){this.minX=Math.floor(this.minX),this.minY=Math.floor(this.minY),this.maxX=Math.ceil(this.maxX),this.maxY=Math.ceil(this.maxY),this.updateArea()},n.updateArea=function(){this.width=this.maxX-this.minX,this.height=this.maxY-this.minY,this.area=this.width*this.height},n.union=function(t){this.minX>t.minX&&(this.minX=t.minX),this.minY>t.minY&&(this.minY=t.minY),this.maxX<t.maxX&&(this.maxX=t.maxX),this.maxY<t.maxY&&(this.maxY=t.maxY),this.updateArea()},n.intersect=function(t){return this.minX<t.minX&&(this.minX=t.minX),this.maxX>t.maxX&&(this.maxX=t.maxX),this.minX>=this.maxX?void this.setEmpty():(this.minY<t.minY&&(this.minY=t.minY),this.maxY>t.maxY&&(this.maxY=t.maxY),this.minY>=this.maxY?void this.setEmpty():void this.updateArea())},n.setEmpty=function(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.width=0,this.height=0,this.area=0},n.isEmpty=function(){return this.width<=0||this.height<=0},n.intersects=function(t){if(this.isEmpty())return!1;var e=this.minX>t.minX?this.minX:t.minX,i=this.maxX<t.maxX?this.maxX:t.maxX;return e>i?!1:(e=this.minY>t.minY?this.minY:t.minY,i=this.maxY<t.maxY?this.maxY:t.maxY,i>=e)},n.updateRegion=function(t,e){if(0==t.width||0==t.height)return void this.setEmpty();var i,n,r,s,a=e,o=a.a,h=a.b,l=a.c,u=a.d,c=a.tx,d=a.ty,f=t.x,g=t.y,p=f+t.width,v=g+t.height;if(1==o&&0==h&&0==l&&1==u)i=f+c-1,n=g+d-1,r=p+c+1,s=v+d+1;else{var $=o*f+l*g+c,m=h*f+u*g+d,y=o*p+l*g+c,T=h*p+u*g+d,x=o*p+l*v+c,b=h*p+u*v+d,_=o*f+l*v+c,E=h*f+u*v+d,C=0;$>y&&(C=$,$=y,y=C),x>_&&(C=x,x=_,_=C),i=(x>$?$:x)-1,r=(y>_?y:_)+1,m>T&&(C=m,m=T,T=C),b>E&&(C=b,b=E,E=C),n=(b>m?m:b)-1,s=(T>E?T:E)+1}this.minX=i,this.minY=n,this.maxX=r,this.maxY=s,this.width=r-i,this.height=s-n,this.area=this.width*this.height},t}();e.Region=n,t.registerClass(n,"egret.sys.Region")}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(){}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}__extends(i,e);var n=i,r=n.prototype;return r.calculateStageSize=function(e,i,n,r,s){var a=i,o=n,h=r,l=s,u=i/h||0,c=n/l||0;switch(e){case t.StageScaleMode.EXACT_FIT:break;case t.StageScaleMode.FIXED_HEIGHT:h=Math.round(i/c);break;case t.StageScaleMode.FIXED_WIDTH:l=Math.round(n/u);break;case t.StageScaleMode.NO_BORDER:u>c?o=Math.round(l*u):a=Math.round(h*c);break;case t.StageScaleMode.SHOW_ALL:u>c?a=Math.round(h*c):o=Math.round(l*u);break;case t.StageScaleMode.FIXED_NARROW:u>c?h=Math.round(i/c):l=Math.round(n/u);break;case t.StageScaleMode.FIXED_WIDE:u>c?l=Math.round(n/u):h=Math.round(i/c);break;default:h=i,l=n}return a%2!=0&&(a+=1),o%2!=0&&(o+=1),{stageWidth:h,stageHeight:l,displayWidth:a,displayHeight:o}},i}(t.HashObject);e.DefaultScreenAdapter=i,t.registerClass(i,"egret.sys.DefaultScreenAdapter",["egret.sys.IScreenAdapter"])}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}var e=t;return e.prototype,t.NO_SCALE="noScale",t.SHOW_ALL="showAll",t.NO_BORDER="noBorder",t.EXACT_FIT="exactFit",t.FIXED_WIDTH="fixedWidth",t.FIXED_HEIGHT="fixedHeight",t.FIXED_NARROW="fixedNarrow",t.FIXED_WIDE="fixedWide",t}();t.StageScaleMode=e,t.registerClass(e,"egret.StageScaleMode")}(egret||(egret={}));var egret;!function(t){var e;!function(){}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){e.$START_TIME=0,e.$invalidateRenderFlag=!1,e.$requestRenderingFlag=!1;var i=function(){function i(){this.playerList=[],this.callBackList=[],this.thisObjectList=[],this.$frameRate=30,this.lastTimeStamp=0,this.costEnterFrame=0,e.$START_TIME=Date.now(),this.frameDeltaTime=1e3/this.$frameRate,this.lastCount=this.frameInterval=Math.round(6e4/this.$frameRate)}var n=i,r=n.prototype;return r.$addPlayer=function(t){-1==this.playerList.indexOf(t)&&(this.playerList=this.playerList.concat(),this.playerList.push(t))},r.$removePlayer=function(t){var e=this.playerList.indexOf(t);-1!==e&&(this.playerList=this.playerList.concat(),this.playerList.splice(e,1))},r.$startTick=function(t,e){var i=this.getTickIndex(t,e);-1==i&&(this.concatTick(),this.callBackList.push(t),this.thisObjectList.push(e))},r.$stopTick=function(t,e){var i=this.getTickIndex(t,e);
-1!=i&&(this.concatTick(),this.callBackList.splice(i,1),this.thisObjectList.splice(i,1))},r.getTickIndex=function(t,e){for(var i=this.callBackList,n=this.thisObjectList,r=i.length-1;r>=0;r--)if(i[r]==t&&n[r]==e)return r;return-1},r.concatTick=function(){this.callBackList=this.callBackList.concat(),this.thisObjectList=this.thisObjectList.concat()},r.$setFrameRate=function(e){return e=+e||0,0>=e?!1:this.$frameRate==e?!1:(this.$frameRate=e,e>60&&(e=60),t.Capabilities.runtimeType==t.RuntimeType.NATIVE&&(egret_native.setFrameRate(e),e=60),this.frameDeltaTime=1e3/e,this.lastCount=this.frameInterval=Math.round(6e4/e),!0)},r.update=function(){for(var i=t.getTimer(),n=this.callBackList,r=this.thisObjectList,s=n.length,a=e.$requestRenderingFlag,o=t.getTimer(),h=0;s>h;h++)n[h].call(r[h],o)&&(a=!0);var l=t.getTimer(),u=o-this.lastTimeStamp;if(this.lastTimeStamp=o,u>=this.frameDeltaTime)this.lastCount=this.frameInterval;else{if(this.lastCount-=1e3,this.lastCount>0)return void(a&&this.render(!1,this.costEnterFrame+l-i));this.lastCount+=this.frameInterval}this.render(!0,this.costEnterFrame+l-i);var c=t.getTimer();this.broadcastEnterFrame();var d=t.getTimer();this.costEnterFrame=d-c},r.render=function(t,i){var n=this.playerList,r=n.length;if(0!=r){e.$invalidateRenderFlag&&(this.broadcastRender(),e.$invalidateRenderFlag=!1);for(var s=0;r>s;s++)n[s].$render(t,i);e.$requestRenderingFlag=!1}},r.broadcastEnterFrame=function(){var e=t.DisplayObject.$enterFrameCallBackList,i=e.length;if(0!=i){e=e.concat();for(var n=0;i>n;n++)e[n].dispatchEventWith(t.Event.ENTER_FRAME)}},r.broadcastRender=function(){var e=t.DisplayObject.$renderCallBackList,i=e.length;if(0!=i){e=e.concat();for(var n=0;i>n;n++)e[n].dispatchEventWith(t.Event.RENDER)}},i}();e.SystemTicker=i,t.registerClass(i,"egret.sys.SystemTicker"),e.$ticker=new e.SystemTicker}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret_stages,egret;!function(t){var e;!function(e){var i=function(e){function i(t){e.call(this),this.maxTouches=0,this.useTouchesCount=0,this.touchDownTarget={},this.lastTouchX=-1,this.lastTouchY=-1,this.stage=t}__extends(i,e);var n=i,r=n.prototype;return r.$initMaxTouches=function(){this.maxTouches=this.stage.$maxTouches},r.onTouchBegin=function(e,i,n){if(!(this.useTouchesCount>=this.maxTouches)){this.lastTouchX=e,this.lastTouchY=i;var r=this.findTarget(e,i);null==this.touchDownTarget[n]&&(this.touchDownTarget[n]=r,this.useTouchesCount++),t.TouchEvent.dispatchTouchEvent(r,t.TouchEvent.TOUCH_BEGIN,!0,!0,e,i,n,!0)}},r.onTouchMove=function(e,i,n){if(null!=this.touchDownTarget[n]&&(this.lastTouchX!=e||this.lastTouchY!=i)){this.lastTouchX=e,this.lastTouchY=i;var r=this.findTarget(e,i);t.TouchEvent.dispatchTouchEvent(r,t.TouchEvent.TOUCH_MOVE,!0,!0,e,i,n,!0)}},r.onTouchEnd=function(e,i,n){if(null!=this.touchDownTarget[n]){var r=this.findTarget(e,i),s=this.touchDownTarget[n];delete this.touchDownTarget[n],this.useTouchesCount--,t.TouchEvent.dispatchTouchEvent(r,t.TouchEvent.TOUCH_END,!0,!0,e,i,n,!1),s==r?t.TouchEvent.dispatchTouchEvent(r,t.TouchEvent.TOUCH_TAP,!0,!0,e,i,n,!1):t.TouchEvent.dispatchTouchEvent(s,t.TouchEvent.TOUCH_RELEASE_OUTSIDE,!0,!0,e,i,n,!1)}},r.findTarget=function(t,e){var i=this.stage.$hitTest(t,e);return i||(i=this.stage),i},i}(t.HashObject);e.TouchHandler=i,t.registerClass(i,"egret.sys.TouchHandler")}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(){function i(){this.type=0,this.needRedraw=!1,this.renderAlpha=1,this.renderVisible=!0,this.renderMatrix=new t.Matrix,this.renderRegion=new e.Region,this.moved=!1,this.drawData=[],this.renderCount=0}var n=i,r=n.prototype;return r.cleanBeforeRender=function(){this.drawData.length=0,this.renderCount=0},r.$getRenderCount=function(){return this.renderCount},i}();e.RenderNode=i,t.registerClass(i,"egret.sys.RenderNode")}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this),this.image=null,this.smoothing=!0,this.blendMode=null,this.alpha=0/0,this.filter=null,this.type=1}__extends(i,e);var n=i,r=n.prototype;return r.drawImage=function(t,e,i,n,r,s,a,o){this.drawData.push(t,e,i,n,r,s,a,o),this.renderCount++},r.cleanBeforeRender=function(){e.prototype.cleanBeforeRender.call(this),this.image=null,this.matrix=null,this.blendMode=null,this.alpha=0/0,this.filter=null},i.$updateTextureData=function(e,n,r,s,a,o,h,l,u,c,d,f,g,p,v,$,m){if(n){var y=t.$TextureScaleFactor;if(e.smoothing=m,e.image=n,e.imageWidth=g,e.imageHeight=p,v)i.$updateTextureDataWithScale9Grid(e,v,r,s,a,o,h,l,u,c,d,f);else if($==t.BitmapFillMode.SCALE){var T=d/u*y,x=f/c*y;e.drawImage(r,s,a,o,h,l,T*a,x*o)}else if($==t.BitmapFillMode.CLIP){var b=Math.min(u,d),_=Math.min(c,f),E=a*y,C=o*y;i.drawClipImage(e,y,r,s,E,C,h,l,b,_)}else for(var E=a*y,C=o*y,F=0;d>F;F+=u)for(var w=0;f>w;w+=c){var b=Math.min(d-F,u),_=Math.min(f-w,c);i.drawClipImage(e,y,r,s,E,C,h,l,b,_,F,w)}}},i.$updateTextureDataWithScale9Grid=function(e,i,n,r,s,a,o,h,l,u,c,d){var f=s,g=a;c-=l-s*t.$TextureScaleFactor,d-=u-a*t.$TextureScaleFactor;var p=i.x-o,v=i.y-h,$=p/t.$TextureScaleFactor,m=v/t.$TextureScaleFactor,y=i.width/t.$TextureScaleFactor,T=i.height/t.$TextureScaleFactor;0==T&&(T=1,m>=g&&m--),0==y&&(y=1,$>=f&&$--);var x=n,b=x+$,_=b+y,E=f-$-y,C=r,F=C+m,w=F+T,R=g-m-T,S=E*t.$TextureScaleFactor,D=R*t.$TextureScaleFactor;if(($+E)*t.$TextureScaleFactor>c||(m+R)*t.$TextureScaleFactor>d)return void e.drawImage(n,r,s,a,o,h,c,d);var O=o,L=O+p,M=O+(c-S),N=c-p-S,A=h,I=A+v,B=A+d-D,P=d-v-D;m>0&&($>0&&e.drawImage(x,C,$,m,O,A,p,v),y>0&&e.drawImage(b,C,y,m,L,A,N,v),E>0&&e.drawImage(_,C,E,m,M,A,S,v)),T>0&&($>0&&e.drawImage(x,F,$,T,O,I,p,P),y>0&&e.drawImage(b,F,y,T,L,I,N,P),E>0&&e.drawImage(_,F,E,T,M,I,S,P)),R>0&&($>0&&e.drawImage(x,w,$,R,O,B,p,D),y>0&&e.drawImage(b,w,y,R,L,B,N,D),E>0&&e.drawImage(_,w,E,R,M,B,S,D))},i.drawClipImage=function(t,e,i,n,r,s,a,o,h,l,u,c){void 0===u&&(u=0),void 0===c&&(c=0);var d=a+r-h;d>0&&(r-=d),d=o+s-l,d>0&&(s-=d),t.drawImage(i,n,r/e,s/e,u+a,c+o,r,s)},i}(e.RenderNode);e.BitmapNode=i,t.registerClass(i,"egret.sys.BitmapNode")}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=["none","round","square"],n=["bevel","miter","round"],r=function(r){function s(){r.call(this),this.dirtyRender=!0,this.type=3}__extends(s,r);var a=s,o=a.prototype;return o.beginFill=function(t,i,n){void 0===i&&(i=1);var r=new e.FillPath;if(r.fillColor=t,r.fillAlpha=i,n){var s=this.drawData.lastIndexOf(n);this.drawData.splice(s,0,r)}else this.drawData.push(r);return r},o.beginGradientFill=function(i,n,r,s,a,o){var h=new t.Matrix;a?(h.a=819.2*a.a,h.b=819.2*a.b,h.c=819.2*a.c,h.d=819.2*a.d,h.tx=a.tx,h.ty=a.ty):(h.a=100,h.d=100);var l=new e.GradientFillPath;if(l.gradientType=i,l.colors=n,l.alphas=r,l.ratios=s,l.matrix=h,o){var u=this.drawData.lastIndexOf(o);this.drawData.splice(u,0,l)}else this.drawData.push(l);return l},o.lineStyle=function(r,s,a,o,h,l){void 0===a&&(a=1),void 0===l&&(l=3),-1==i.indexOf(o)&&(o="round"),-1==n.indexOf(h)&&(h="round");var u=new e.StrokePath;return u.lineWidth=r,u.lineColor=s,u.lineAlpha=a,u.caps=o||t.CapsStyle.ROUND,u.joints=h,u.miterLimit=l,this.drawData.push(u),u},o.clear=function(){this.drawData.length=0,this.dirtyRender=!0},o.cleanBeforeRender=function(){},o.clean=function(){this.$texture&&(t.WebGLUtils.deleteWebGLTexture(this.$texture),this.$texture=null,this.dirtyRender=!0)},s}(e.RenderNode);e.GraphicsNode=r,t.registerClass(r,"egret.sys.GraphicsNode")}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(t){function e(){t.call(this),this.type=4}__extends(e,t);var i=e,n=i.prototype;return n.addNode=function(t){this.drawData.push(t)},n.cleanBeforeRender=function(){for(var t=this.drawData,e=t.length-1;e>=0;e--)t[e].cleanBeforeRender()},n.$getRenderCount=function(){for(var t=0,e=this.drawData,i=e.length-1;i>=0;i--)t+=e[i].$getRenderCount();return t},e}(e.RenderNode);e.GroupNode=i,t.registerClass(i,"egret.sys.GroupNode")}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this),this.image=null,this.smoothing=!0,this.bounds=new t.Rectangle,this.type=7,this.vertices=[],this.uvs=[],this.indices=[]}__extends(i,e);var n=i,r=n.prototype;return r.drawMesh=function(t,e,i,n,r,s,a,o){this.drawData.push(t,e,i,n,r,s,a,o),this.renderCount++},r.cleanBeforeRender=function(){e.prototype.cleanBeforeRender.call(this),this.image=null,this.matrix=null},i}(e.RenderNode);e.MeshNode=i,t.registerClass(i,"egret.sys.MeshNode")}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(t){function e(){t.call(this),this.type=6}__extends(e,t);var i=e,n=i.prototype;return n.setAlpha=function(t){0!=this.drawData.length&&(this.drawData.length=0),this.drawData.push(t),this.renderCount++},e}(e.RenderNode);e.SetAlphaNode=i,t.registerClass(i,"egret.sys.SetAlphaNode")}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this),this.textColor=16777215,this.strokeColor=0,this.size=30,this.stroke=0,this.bold=!1,this.italic=!1,this.fontFamily="Arial",this.dirtyRender=!0,this.type=2}__extends(i,e);var n=i,r=n.prototype;return r.drawText=function(t,e,i,n){this.drawData.push(t,e,i,n),this.renderCount++,this.dirtyRender=!0},r.cleanBeforeRender=function(){e.prototype.cleanBeforeRender.call(this)},r.clean=function(){this.$texture&&(t.WebGLUtils.deleteWebGLTexture(this.$texture),this.$texture=null,this.dirtyRender=!0)},i}(e.RenderNode);e.TextNode=i,t.registerClass(i,"egret.sys.TextNode")}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(){function t(){this.type=0,this.$commands=[],this.$data=[],this.commandPosition=0,this.dataPosition=0,this.$lastX=0,this.$lastY=0}var e=t,i=e.prototype;return i.moveTo=function(t,e){this.$commands[this.commandPosition++]=1;var i=this.dataPosition;this.$data[i++]=t,this.$data[i++]=e,this.dataPosition=i},i.lineTo=function(t,e){this.$commands[this.commandPosition++]=2;var i=this.dataPosition;this.$data[i++]=t,this.$data[i++]=e,this.dataPosition=i},i.curveTo=function(t,e,i,n){this.$commands[this.commandPosition++]=3;var r=this.dataPosition;this.$data[r++]=t,this.$data[r++]=e,this.$data[r++]=i,this.$data[r++]=n,this.dataPosition=r},i.cubicCurveTo=function(t,e,i,n,r,s){this.$commands[this.commandPosition++]=4;var a=this.dataPosition;this.$data[a++]=t,this.$data[a++]=e,this.$data[a++]=i,this.$data[a++]=n,this.$data[a++]=r,this.$data[a++]=s,this.dataPosition=a},i.drawRect=function(t,e,i,n){var r=t+i,s=e+n;this.moveTo(t,e),this.lineTo(r,e),this.lineTo(r,s),this.lineTo(t,s),this.lineTo(t,e)},i.drawRoundRect=function(t,e,i,n,r,s){var a=.5*r|0,o=s?.5*s|0:a;if(!a||!o)return void this.drawRect(t,e,i,n);var h=.5*i,l=.5*n;if(a>h&&(a=h),o>l&&(o=l),h===a&&l===o)return void(a===o?this.drawCircle(t+a,e+o,a):this.drawEllipse(t,e,2*a,2*o));var u=t+i,c=e+n,d=t+a,f=u-a,g=e+o,p=c-o;this.moveTo(u,p),this.curveTo(u,c,f,c),this.lineTo(d,c),this.curveTo(t,c,t,p),this.lineTo(t,g),this.curveTo(t,e,d,e),this.lineTo(f,e),this.curveTo(u,e,u,g),this.lineTo(u,p)},i.drawCircle=function(t,e,i){this.arcToBezier(t,e,i,i,0,2*Math.PI)},i.drawEllipse=function(t,e,i,n){var r=.5*i,s=.5*n;t+=r,e+=s,this.arcToBezier(t,e,r,s,0,2*Math.PI)},i.drawArc=function(t,e,i,n,r,s){s?r>=n&&(r-=2*Math.PI):n>=r&&(r+=2*Math.PI),this.arcToBezier(t,e,i,i,n,r,s)},i.arcToBezier=function(t,e,i,n,r,s,a){var o=.5*Math.PI,h=r,l=h;a?(l+=-o-h%o,s>l&&(l=s)):(l+=o-h%o,l>s&&(l=s));var u=t+Math.cos(h)*i,c=e+Math.sin(h)*n;(this.$lastX!=u||this.$lastY!=c)&&this.moveTo(u,c);for(var d=Math.cos(h),f=Math.sin(h),g=0;4>g;g++){var p=l-h,v=4*Math.tan(p/4)/3,$=u-f*v*i,m=c+d*v*n;d=Math.cos(l),f=Math.sin(l),u=t+d*i,c=e+f*n;var y=u+f*v*i,T=c-d*v*n;if(this.cubicCurveTo($,m,y,T,u,c),l===s)break;h=l,a?(l=h-o,s>l&&(l=s)):(l=h+o,l>s&&(l=s))}},t}();e.Path2D=i,t.registerClass(i,"egret.sys.Path2D")}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(t){function e(){t.call(this),this.type=1}__extends(e,t);var i=e;return i.prototype,e}(e.Path2D);e.FillPath=i,t.registerClass(i,"egret.sys.FillPath")}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(t){function e(){t.call(this),this.type=2}__extends(e,t);var i=e;return i.prototype,e}(e.Path2D);e.GradientFillPath=i,t.registerClass(i,"egret.sys.GradientFillPath")}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(t){function e(){t.call(this),this.type=3}__extends(e,t);var i=e;return i.prototype,e}(e.Path2D);e.StrokePath=i,t.registerClass(i,"egret.sys.StrokePath")}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){function e(t,e){var i=null==e.italic?t.italic:e.italic,n=null==e.bold?t.bold:e.bold,r=null==e.size?t.size:e.size,s=e.fontFamily||t.fontFamily,a=i?"italic ":"normal ";return a+=n?"bold ":"normal ",a+=r+"px "+s}function i(t,e){var i=t>>16,n=t>>8&255,r=255&t;return"rgba("+i+","+n+","+r+","+e+")"}function n(e,n,r,s,a){var o;o=n==t.GradientType.LINEAR?e.createLinearGradient(-1,0,1,0):e.createRadialGradient(0,0,0,0,0,1);for(var h=r.length,l=0;h>l;l++)o.addColorStop(a[l]/255,i(r[l],s[l]));return o}function r(t,e,i,n){for(var r=n[0],s=n[1],a=n[2],o=n[3],h=n[4],l=n[5],u=n[6],c=n[7],d=n[8],f=n[9],g=n[10],p=n[11],v=n[12],$=n[13],m=n[14],y=n[15],T=n[16],x=n[17],b=n[18],_=n[19],E=0,C=e*i*4;C>E;E+=4){var F=t[E+0],w=t[E+1],R=t[E+2],S=t[E+3];t[E+0]=r*F+s*w+a*R+o*S+h,t[E+1]=l*F+u*w+c*R+d*S+f,t[E+2]=g*F+p*w+v*R+$*S+m,t[E+3]=y*F+T*w+x*R+b*S+_}}function s(t,e,i,n,r){a(t,e,i,n),o(t,e,i,r)}function a(t,e,i,n){for(var r=new Uint8ClampedArray(4*e),s=4*e,a=2*n+1,o=0;i>o;o++){for(var h=o*s,l=0,u=0,c=0,d=0,f=0,g=0,p=4*-n,v=4*n+4;v>p;p+=4){var $=h+p;h>$||$>=h+s||(f=t[$+3],l+=t[$+0]*f,u+=t[$+1]*f,c+=t[$+2]*f,d+=f)}for(var p=h,v=h+s,m=0,y=p-4*n,T=p+4*(n+1);v>p;p+=4,m+=4,T+=4,y+=4)r[m+0]=l/d,r[m+1]=u/d,r[m+2]=c/d,r[m+3]=d/a,f=t[T+3],g=t[y+3],f||0==f?g||0==g?(l+=t[T+0]*f-t[y+0]*g,u+=t[T+1]*f-t[y+1]*g,c+=t[T+2]*f-t[y+2]*g,d+=f-g):(l+=t[T+0]*f,u+=t[T+1]*f,c+=t[T+2]*f,d+=f):(g||0==g)&&(l+=-t[y+0]*g,u+=-t[y+1]*g,c+=-t[y+2]*g,d+=-g);t.set(r,h)}}function o(t,e,i,n){for(var r=new Uint8ClampedArray(4*i),s=4*e,a=2*n+1,o=0;e>o;o++){for(var h=4*o,l=0,u=0,c=0,d=0,f=0,g=0,p=-n*s,v=n*s+s;v>p;p+=s){var $=h+p;h>$||$>=h+i*s||(f=t[$+3],l+=t[$+0]*f,u+=t[$+1]*f,c+=t[$+2]*f,d+=f)}for(var p=h,v=h+i*s,m=0,y=h-n*s,T=h+(n+1)*s;v>p;p+=s,m+=4,T+=s,y+=s)r[m+0]=l/d,r[m+1]=u/d,r[m+2]=c/d,r[m+3]=d/a,f=t[T+3],g=t[y+3],f||0==f?g||0==g?(l+=t[T+0]*f-t[y+0]*g,u+=t[T+1]*f-t[y+1]*g,c+=t[T+2]*f-t[y+2]*g,d+=f-g):(l+=t[T+0]*f,u+=t[T+1]*f,c+=t[T+2]*f,d+=f):(g||0==g)&&(l+=-t[y+0]*g,u+=-t[y+1]*g,c+=-t[y+2]*g,d+=-g);for(var x=4*o,v=x+i*s,b=0;v>x;x+=s,b+=4)t[x+0]=r[b+0],t[x+1]=r[b+1],t[x+2]=r[b+2],t[x+3]=r[b+3]}}function h(t,e,i,n,r,a,o,h,f){var g=l(t,n);u(g,e,i,o,h),s(g,e,i,r,a),c(g,f),d(g,t),t.set(g)}function l(t,e){e||(e=[0,0,0,0]);for(var i=new Uint8ClampedArray(t),n=0,r=i.length;r>n;n+=4){var s=i[n+3];i[n+0]=e[0]*s,i[n+1]=e[1]*s,i[n+2]=e[2]*s}return i}function u(t,e,i,n,r){for(var s=Math.sin(n)*r|0,a=Math.cos(n)*r|0,o=new Int32Array(t.buffer),h=new Int32Array(o.length),l=0;i>l;l++){var u=l+s;if(!(0>u||u>i))for(var c=0;e>c;c++){var d=c+a;0>d||d>e||(h[u*e+d]=o[l*e+c])}}o.set(h)}function c(t,e){for(var i=0,n=t.length;n>i;i+=4)t[i+3]*=e}function d(t,e){for(var i=0,n=t.length;n>i;i+=4){var r=t[i+0],s=t[i+1],a=t[i+2],o=t[i+3]/255,h=e[i+0],l=e[i+1],u=e[i+2],c=e[i+3]/255;t[i+0]=h+r*(1-c),t[i+1]=l+s*(1-c),t[i+2]=u+a*(1-c),t[i+3]=255*(c+o*(1-c))}}function f(t,e,i){return t*(1-i)+e*i}function g(t,e,i,n,r,s,a,o,h,l,u,c){for(var d,g,p=new Uint8ClampedArray(t),v=n[3],$=0,m=0,y=o*Math.cos(a),T=o*Math.sin(a),x=7,b=12,_=3.141592653589793,E=r/x,C=s/x,F=0;e>F;F++)for(var w=0;i>w;w++){for(var R=0,S=w*e*4+4*F,D=0,O=0,L=t[S+0]/255,M=t[S+1]/255,N=t[S+2]/255,A=t[S+3]/255,I=0;2*_>=I;I+=2*_/b){d=Math.cos(I+R),g=Math.sin(I+R);for(var B=0;x>B;B++){$=B*E*d,m=B*C*g;var P=Math.round(F+$-y),k=Math.round(w+m-T),U=0;if(P>=e||0>P||0>k||k>=i)U=0;else{var X=k*e*4+4*P;U=t[X+3]/255}D+=(x-B)*U,O+=x-B}}A=Math.max(A,1e-4);var Y=D/O*h*v*(1-l)*Math.max(Math.min(c,u),1-A),H=(O-D)/O*h*v*l*A;A=Math.max(A*u*(1-c),1e-4);var j=H/(H+A),W=f(L,n[0],j),G=f(M,n[1],j),V=f(N,n[2],j),z=Y/(H+A+Y),Z=f(W,n[0],z),q=f(G,n[1],z),J=f(V,n[2],z),K=Math.min(A+Y+H,1);p[S+0]=255*Z,p[S+1]=255*q,p[S+2]=255*J,p[S+3]=255*K}t.set(p)}var p=["source-over","lighter","destination-out"],v="source-over",$="#000000",m={none:"butt",square:"square",round:"round"},y=[],T=function(){function a(){this.nestLevel=0,this.renderingMask=!1}var o=a,l=o.prototype;return l.render=function(t,e,i,n,r){this.nestLevel++;var s=e.context,a=r?t:null,o=this.drawDisplayObject(t,s,n,i,null,null,a);if(this.nestLevel--,0===this.nestLevel){y.length>6&&(y.length=6);for(var h=y.length,l=0;h>l;l++)y[l].resize(0,0)}return o},l.drawDisplayObject=function(e,i,n,r,s,a,o){var h,l=0;if(s&&!o?(s.isDirty&&(l+=s.drawToSurface()),h=s.$renderNode):h=e.$getRenderNode(),h){if(n){var u=h.renderRegion;if(a&&!a.intersects(u))h.needRedraw=!1;else if(!h.needRedraw)for(var c=n.length,d=0;c>d;d++)if(u.intersects(n[d])){h.needRedraw=!0;break}}else h.needRedraw=!0;if(h.needRedraw){var f,g;o?(f=e.$getConcatenatedAlphaAt(o,e.$getConcatenatedAlpha()),g=t.Matrix.create().copyFrom(e.$getConcatenatedMatrix()),e.$getConcatenatedMatrixAt(o,g),r.$preMultiplyInto(g,g),i.setTransform(g.a,g.b,g.c,g.d,g.tx,g.ty),t.Matrix.release(g)):(f=h.renderAlpha,g=h.renderMatrix,i.setTransform(g.a,g.b,g.c,g.d,g.tx+r.tx,g.ty+r.ty)),i.globalAlpha=f,l+=this.renderNode(h,i),h.needRedraw=!1}}if(s&&!o)return l;var p=e.$children;if(p)for(var v=p.length,$=0;v>$;$++){var m=p[$];if(!(!m.$visible||m.$alpha<=0||m.$maskedObject)){var y=m.$getFilters();y&&y.length>0?l+=this.drawWithFilter(m,i,n,r,a,o):0!==m.$blendMode||m.$mask&&(m.$mask.$parentDisplayList||o)?l+=this.drawWithClip(m,i,n,r,a,o):m.$scrollRect||m.$maskRect?l+=this.drawWithScrollRect(m,i,n,r,a,o):m.isFPS?this.drawDisplayObject(m,i,n,r,m.$displayList,a,o):l+=this.drawDisplayObject(m,i,n,r,m.$displayList,a,o)}}return l},l.drawWithFilter=function(e,i,n,a,o,l){if(t.Capabilities.runtimeType==t.RuntimeType.NATIVE){var u=0,c=e.$getFilters(),d=0!==e.$blendMode;if(d){var f=p[e.$blendMode];f||(f=v)}if(1==c.length&&"colorTransform"==c[0].type&&!e.$children)return d&&(i.globalCompositeOperation=f),i.setGlobalShader(c[0].$toJson()),u+=e.$mask&&(e.$mask.$parentDisplayList||l)?this.drawWithClip(e,i,n,a,o,l):e.$scrollRect||e.$maskRect?this.drawWithScrollRect(e,i,n,a,o,l):this.drawDisplayObject(e,i,n,a,e.$displayList,o,l),i.setGlobalShader(""),d&&(i.globalCompositeOperation=v),u;var $=t.Matrix.create();$.copyFrom(e.$getConcatenatedMatrix());var m;m=t.sys.Region.create();var T=e.$getOriginalBounds();m.updateRegion(T,$);var x=this.createRenderBuffer(m.width,m.height);x.context.setTransform(1,0,0,1,-m.minX,-m.minY);var b=t.Matrix.create().setTo(1,0,0,1,-m.minX,-m.minY);return u+=e.$mask&&(e.$mask.$parentDisplayList||l)?this.drawWithClip(e,x.context,n,b,m,l):e.$scrollRect||e.$maskRect?this.drawWithScrollRect(e,x.context,n,b,m,l):this.drawDisplayObject(e,x.context,n,b,e.$displayList,m,l),t.Matrix.release(b),u>0&&(d&&(i.globalCompositeOperation=f),u++,i.globalAlpha=1,i.setTransform(1,0,0,1,m.minX+a.tx,m.minY+a.ty),i.setGlobalShader(c[0].$toJson()),i.drawImage(x.surface,0,0,x.width,x.height,0,0,x.width,x.height),i.setGlobalShader(""),d&&(i.globalCompositeOperation=v)),y.push(x),t.sys.Region.release(m),t.Matrix.release($),u}var u=0,c=e.$getFilters(),_=c.length,d=0!==e.$blendMode;if(d){var f=p[e.$blendMode];f||(f=v)}var $=t.Matrix.create();$.copyFrom(e.$getConcatenatedMatrix());var m;m=t.sys.Region.create();var T=e.$getOriginalBounds();m.updateRegion(T,$);var x=this.createRenderBuffer(m.width,m.height),E=x.context;E.setTransform(1,0,0,1,-m.minX,-m.minY);var b=t.Matrix.create().setTo(1,0,0,1,-m.minX,-m.minY);if(u+=e.$mask&&(e.$mask.$parentDisplayList||l)?this.drawWithClip(e,E,n,b,m,l):e.$scrollRect||e.$maskRect?this.drawWithScrollRect(e,E,n,b,m,l):this.drawDisplayObject(e,E,n,b,e.$displayList,m,l),t.Matrix.release(b),u>0){d&&(i.globalCompositeOperation=f),u++,i.globalAlpha=1,i.setTransform(1,0,0,1,m.minX+a.tx,m.minY+a.ty);for(var C=E.getImageData(0,0,x.surface.width,x.surface.height),F=0;_>F;F++){var w=c[F];if("colorTransform"==w.type)r(C.data,x.surface.width,x.surface.height,w.$matrix);else if("blur"==w.type)s(C.data,x.surface.width,x.surface.height,w.$blurX,w.$blurY);else if("glow"==w.type){var R=w.$red,S=w.$green,D=w.$blue,O=w.$alpha;w.$inner||w.$knockout||w.$hideObject?g(C.data,x.surface.width,x.surface.height,[R/255,S/255,D/255,O],w.$blurX,w.$blurY,w.$angle?w.$angle/180*Math.PI:0,w.$distance||0,w.$strength,w.$inner?1:0,w.$knockout?0:1,w.$hideObject?1:0):h(C.data,x.surface.width,x.surface.height,[R/255,S/255,D/255,O/255],w.$blurX,w.$blurY,w.$angle?w.$angle/180*Math.PI:0,w.$distance||0,w.$strength)}}E.putImageData(C,0,0),i.drawImage(x.surface,0,0),d&&(i.globalCompositeOperation=v)}return y.push(x),t.sys.Region.release(m),t.Matrix.release($),u},l.drawWithClip=function(e,i,n,r,s,a){var o=0,h=0!==e.$blendMode;if(h){var l=p[e.$blendMode];l||(l=v)}var u=e.$scrollRect?e.$scrollRect:e.$maskRect,c=e.$mask;if(c){var d=c.$getRenderNode();if(d){var f=d.renderMatrix;if(0==f.a&&0==f.b||0==f.c&&0==f.d)return o}}var g,$=t.Matrix.create();if($.copyFrom(e.$getConcatenatedMatrix()),e.$parentDisplayList){var m,T=e.$parentDisplayList.root;T!==e.$stage&&e.$getConcatenatedMatrixAt(T,$)}if(c){var x=c.$getOriginalBounds();g=t.sys.Region.create();var b=t.Matrix.create();b.copyFrom(c.$getConcatenatedMatrix()),m&&m.$preMultiplyInto(b,b),g.updateRegion(x,b),t.Matrix.release(b)}var _;if(u&&(_=t.sys.Region.create(),_.updateRegion(u,$)),_&&g?(_.intersect(g),t.sys.Region.release(g)):!_&&g&&(_=g),_){if(_.isEmpty()||s&&!s.intersects(_))return t.sys.Region.release(_),t.Matrix.release($),o}else _=t.sys.Region.create(),x=e.$getOriginalBounds(),_.updateRegion(x,$);var E=!1;if(n){for(var C=n.length,F=0;C>F;F++)if(_.intersects(n[F])){E=!0;break}}else E=!0;if(!E)return t.sys.Region.release(_),t.Matrix.release($),o;if(!(c||e.$children&&0!=e.$children.length)){if(u){var b=$;i.save(),i.setTransform(b.a,b.b,b.c,b.d,b.tx-_.minX,b.ty-_.minY),i.beginPath(),i.rect(u.x,u.y,u.width,u.height),i.clip()}return h&&(i.globalCompositeOperation=l),o+=this.drawDisplayObject(e,i,n,r,e.$displayList,s,a),h&&(i.globalCompositeOperation=v),u&&i.restore(),o}if(c&&t.Capabilities.$runtimeType==t.RuntimeType.WEB&&(!c.$children||0==c.$children.length)&&d&&3==d.type&&1==d.drawData.length&&1==d.drawData[0].type&&1==d.drawData[0].fillAlpha){this.renderingMask=!0,i.save();var w=this.drawDisplayObject(c,i,n,r,c.$displayList,s,a);if(this.renderingMask=!1,u){var b=$;i.setTransform(b.a,b.b,b.c,b.d,b.tx-_.minX,b.ty-_.minY),i.beginPath(),i.rect(u.x,u.y,u.width,u.height),i.clip()}return w+=this.drawDisplayObject(e,i,n,r,e.$displayList,s,a),i.restore(),w}var R=this.createRenderBuffer(_.width,_.height),S=R.context;if(!S)return o+=this.drawDisplayObject(e,i,n,r,e.$displayList,s,a),t.sys.Region.release(_),t.Matrix.release($),o;S.setTransform(1,0,0,1,-_.minX,-_.minY);var D=t.Matrix.create().setTo(1,0,0,1,-_.minX,-_.minY);if(o+=this.drawDisplayObject(e,S,n,D,e.$displayList,_,a),c)if(t.Capabilities.$runtimeType==t.RuntimeType.WEB&&d&&1==d.$getRenderCount()||c.$displayList)S.globalCompositeOperation="destination-in",o+=this.drawDisplayObject(c,S,n,D,c.$displayList,_,a);else{var O=this.createRenderBuffer(_.width,_.height),L=O.context;if(!L)return o+=this.drawDisplayObject(e,i,n,r,e.$displayList,s,a),y.push(R),t.sys.Region.release(_),t.Matrix.release($),o;L.setTransform(1,0,0,1,-_.minX,-_.minY),D=t.Matrix.create().setTo(1,0,0,1,-_.minX,-_.minY);var w=this.drawDisplayObject(c,L,n,D,c.$displayList,_,a);w>0&&(o+=w,S.globalCompositeOperation="destination-in",S.setTransform(1,0,0,1,0,0),S.globalAlpha=1,S.drawImage(O.surface,0,0)),y.push(O)}if(t.Matrix.release(D),o>0){if(o++,h&&(i.globalCompositeOperation=l),u){var b=$;i.save(),i.setTransform(b.a,b.b,b.c,b.d,b.tx-_.minX,b.ty-_.minY),i.beginPath(),i.rect(u.x,u.y,u.width,u.height),i.clip()}i.globalAlpha=1,i.setTransform(1,0,0,1,_.minX+r.tx,_.minY+r.ty),i.drawImage(R.surface,0,0),u&&i.restore(),h&&(i.globalCompositeOperation=v)}return y.push(R),t.sys.Region.release(_),t.Matrix.release($),o},l.drawWithScrollRect=function(e,i,n,r,s,a){var o=0,h=e.$scrollRect?e.$scrollRect:e.$maskRect;if(0==h.width||0==h.height)return o;var l=t.Matrix.create();if(l.copyFrom(e.$getConcatenatedMatrix()),a)e.$getConcatenatedMatrixAt(a,l);else if(e.$parentDisplayList){var u=e.$parentDisplayList.root;u!==e.$stage&&e.$getConcatenatedMatrixAt(u,l)}var c=t.sys.Region.create();if(h.isEmpty()||c.updateRegion(h,l),c.isEmpty()||s&&!s.intersects(c))return t.sys.Region.release(c),t.Matrix.release(l),o;var d=!1;if(n){for(var f=n.length,g=0;f>g;g++)if(c.intersects(n[g])){d=!0;break}}else d=!0;return d?(i.save(),i.setTransform(l.a,l.b,l.c,l.d,l.tx+r.tx,l.ty+r.ty),i.beginPath(),i.rect(h.x,h.y,h.width,h.height),i.clip(),o+=this.drawDisplayObject(e,i,n,r,e.$displayList,c,a),i.restore(),t.sys.Region.release(c),t.Matrix.release(l),o):(t.sys.Region.release(c),t.Matrix.release(l),o)},l.drawNodeToBuffer=function(t,e,i,n){var r=e.context;r.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),this.renderNode(t,r,n)},l.renderNode=function(t,e,i){var n=0;switch(t.type){case 1:n=this.renderBitmap(t,e);break;case 2:n=1,this.renderText(t,e);break;case 3:n=1,this.renderGraphics(t,e,i);break;case 4:n=this.renderGroup(t,e);break;case 6:e.globalAlpha=t.drawData[0];break;case 7:n=this.renderMesh(t,e)}return n},l.renderMesh=function(e,i){if(t.Capabilities.runtimeType!=t.RuntimeType.NATIVE)return 0;var n=e.image,r=e.drawData,s=r.length,a=0,o=e.matrix;for(o&&(i.saveTransform(),i.transform(o.a,o.b,o.c,o.d,o.tx,o.ty));s>a;)i.drawMesh(n.source,r[a++],r[a++],r[a++],r[a++],r[a++],r[a++],r[a++],r[a++],e.imageWidth,e.imageHeight,e.uvs,e.vertices,e.indices,e.bounds);return o&&i.restoreTransform(),1},l.renderBitmap=function(e,i){var n=e.image;if(!n||!n.source)return 0;i.$imageSmoothingEnabled!=e.smoothing&&(i.imageSmoothingEnabled=e.smoothing,i.$imageSmoothingEnabled=e.smoothing);var s=e.drawData,a=s.length,o=0,h=e.matrix,l=e.blendMode,u=e.alpha,c=!1;if(h&&(i.saveTransform?i.saveTransform():i.save(),c=!0,i.transform(h.a,h.b,h.c,h.d,h.tx,h.ty)),l&&(i.globalCompositeOperation=p[l]),u==u){var d=i.globalAlpha;i.globalAlpha*=u}var f=0,g=e.filter;if(g&&8==a)if(t.Capabilities.runtimeType==t.RuntimeType.NATIVE){for(egret_native.Graphics.setGlobalShader(g);a>o;)f++,i.drawImage(n.source,s[o++],s[o++],s[o++],s[o++],s[o++],s[o++],s[o++],s[o++]);egret_native.Graphics.setGlobalShader(null)}else{var $=this.createRenderBuffer(s[6],s[7]),m=$.context;f++,m.drawImage(n.source,s[0],s[1],s[2],s[3],0,0,s[6],s[7]),f++;var T=m.getImageData(0,0,$.surface.width,$.surface.height);r(T.data,$.surface.width,$.surface.height,g.$matrix),m.putImageData(T,0,0),i.drawImage($.surface,0,0,s[6],s[7],s[4],s[5],s[6],s[7]),y.push($)}else for(;a>o;)f++,i.drawImage(n.source,s[o++],s[o++],s[o++],s[o++],s[o++],s[o++],s[o++],s[o++]);return c?i.restoreTransform?(i.restoreTransform(),l&&(i.globalCompositeOperation=v),u==u&&(i.globalAlpha=d)):i.restore():(l&&(i.globalCompositeOperation=v),u==u&&(i.globalAlpha=d)),f},l.renderText=function(i,n){n.textAlign="left",n.textBaseline="middle",n.lineJoin="round";for(var r=i.drawData,s=r.length,a=0;s>a;){var o=r[a++],h=r[a++],l=r[a++],u=r[a++];n.font=e(i,u);var c=null==u.textColor?i.textColor:u.textColor,d=null==u.strokeColor?i.strokeColor:u.strokeColor,f=null==u.stroke?i.stroke:u.stroke;n.fillStyle=t.toColorString(c),n.strokeStyle=t.toColorString(d),f&&(n.lineWidth=2*f,n.strokeText(l,o,h)),n.fillText(l,o,h)}},l.renderGraphics=function(t,e,r){var s=t.drawData,a=s.length;r=!!r;for(var o=0;a>o;o++){var h=s[o];switch(h.type){case 1:var l=h;e.fillStyle=r?$:i(l.fillColor,l.fillAlpha),this.renderPath(h,e),this.renderingMask?e.clip():e.fill();break;case 2:var u=h;e.fillStyle=r?$:n(e,u.gradientType,u.colors,u.alphas,u.ratios,u.matrix),e.save();var c=u.matrix;this.renderPath(h,e),e.transform(c.a,c.b,c.c,c.d,c.tx,c.ty),e.fill(),e.restore();break;case 3:var d=h,f=d.lineWidth;e.lineWidth=f,e.strokeStyle=r?$:i(d.lineColor,d.lineAlpha),e.lineCap=m[d.caps],e.lineJoin=d.joints,e.miterLimit=d.miterLimit;var g=1===f||3===f;g&&e.translate(.5,.5),this.renderPath(h,e),e.stroke(),g&&e.translate(-.5,-.5)}}},l.renderPath=function(t,e){e.beginPath();for(var i=t.$data,n=t.$commands,r=n.length,s=0,a=0;r>a;a++){var o=n[a];switch(o){case 4:e.bezierCurveTo(i[s++],i[s++],i[s++],i[s++],i[s++],i[s++]);break;case 3:e.quadraticCurveTo(i[s++],i[s++],i[s++],i[s++]);break;case 2:e.lineTo(i[s++],i[s++]);break;case 1:e.moveTo(i[s++],i[s++])}}},l.renderGroup=function(t,e){for(var i=0,n=t.drawData,r=n.length,s=0;r>s;s++){var a=n[s];i+=this.renderNode(a,e)}return i},l.createRenderBuffer=function(e,i){var n=y.pop();return n?n.resize(e,i,!0):n=new t.sys.CanvasRenderBuffer(e,i),n},a}();t.CanvasRenderer=T,t.registerClass(T,"egret.CanvasRenderer",["egret.sys.SystemRenderer"])}(egret||(egret={}));var egret;!function(t){t.DeviceOrientation=null}(egret||(egret={}));var egret;!function(){}(egret||(egret={}));var egret;!function(){}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}var e=t;return e.prototype,t.WEB="web",t.NATIVE="native",t}();t.RuntimeType=e,t.registerClass(e,"egret.RuntimeType");var i=function(){function t(){}var e=__define,i=t;return i.prototype,e(t,"language",function(){return t.$language}),e(t,"isMobile",function(){return t.$isMobile}),e(t,"os",function(){return t.$os}),e(t,"runtimeType",function(){return t.$runtimeType}),e(t,"supportVersion",function(){return t.$supportVersion}),e(t,"engineVersion",function(){return"3.2.0"}),t.$setNativeCapabilities=function(e){var i=e.split("-");if(i.length<=4){var n=i[0];switch(n){case"android":n="Android";break;case"ios":n="iOS"}t.$os=n;var r=i[2].substring(1,i[2].length);t.$supportVersion=r}},e(t,"renderMode",function(){return t.$renderMode}),e(t,"boundingClientWidth",function(){return t.$boundingClientWidth}),e(t,"boundingClientHeight",function(){return t.$boundingClientHeight}),t.$language="zh-CN",t.$os="Unknown",t.$runtimeType="Unknown",t.$supportVersion="Unknown",t.$renderMode="Unknown",t.$boundingClientWidth=0,t.$boundingClientHeight=0,t}();t.Capabilities=i,t.registerClass(i,"egret.Capabilities")}(egret||(egret={}));var testDeviceType=function(){if(!this.navigator)return!0;var t=navigator.userAgent.toLowerCase();return-1!=t.indexOf("mobile")||-1!=t.indexOf("android")},testRuntimeType=function(){return this.navigator?!0:!1};egret.Capabilities.$isMobile=testDeviceType(),egret.Capabilities.$runtimeType=testRuntimeType()?egret.RuntimeType.WEB:egret.RuntimeType.NATIVE;var egret;!function(t){var e=function(t){function e(e,i){t.call(this,e),this.firstCharHeight=0,this.charList="string"==typeof i?this.parseConfig(i):i&&i.hasOwnProperty("frames")?i.frames:{}}__extends(e,t);var i=e,n=i.prototype;return n.getTexture=function(t){var e=this._textureMap[t];if(!e){var i=this.charList[t];if(!i)return null;e=this.createTexture(t,i.x,i.y,i.w,i.h,i.offX,i.offY,i.sourceW,i.sourceH),this._textureMap[t]=e}return e},n.getConfig=function(t,e){return this.charList[t]?this.charList[t][e]:0},n._getFirstCharHeight=function(){if(0==this.firstCharHeight)for(var t in this.charList){var e=this.charList[t];if(e){var i=e.sourceH;if(void 0===i){var n=e.h;void 0===n&&(n=0);var r=e.offY;void 0===r&&(r=0),i=n+r}if(0>=i)continue;this.firstCharHeight=i;break}}return this.firstCharHeight},n.parseConfig=function(t){t=t.split("\r\n").join("\n");for(var e=t.split("\n"),i=this.getConfigByKey(e[3],"count"),n={},r=4;4+i>r;r++){var s=e[r],a=String.fromCharCode(this.getConfigByKey(s,"id")),o={};n[a]=o,o.x=this.getConfigByKey(s,"x"),o.y=this.getConfigByKey(s,"y"),o.w=this.getConfigByKey(s,"width"),o.h=this.getConfigByKey(s,"height"),o.offX=this.getConfigByKey(s,"xoffset"),o.offY=this.getConfigByKey(s,"yoffset"),o.xadvance=this.getConfigByKey(s,"xadvance")
}return n},n.getConfigByKey=function(t,e){for(var i=t.split(" "),n=0,r=i.length;r>n;n++){var s=i[n];if(e==s.substring(0,e.length)){var a=s.substring(e.length+1);return parseInt(a)}}return 0},e}(t.SpriteSheet);t.BitmapFont=e,t.registerClass(e,"egret.BitmapFont")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){e.call(this),this.$textOffsetX=0,this.$textOffsetY=0,this.$textStartX=0,this.$textStartY=0,this.$lineHeights=[],this.$renderNode=new t.sys.BitmapNode,this.$BitmapText={0:0/0,1:0/0,2:"",3:0,4:0,5:null,6:!1,7:!1,8:!1,9:!1,10:"left",11:"top",12:t.Bitmap.defaultSmoothing}}__extends(i,e);var n=__define,r=i,s=r.prototype;return n(s,"smoothing",function(){var t=this.$BitmapText;return t[12]},function(t){t=!!t;var e=this.$BitmapText;t!=e[12]&&(e[12]=t,this.$invalidate())}),n(s,"text",function(){return this.$BitmapText[2]},function(t){this.$setText(t)}),s.$setText=function(t){null==t&&(t=""),t=String(t);var e=this.$BitmapText;return t==e[2]?!1:(e[2]=t,this.$invalidateContentBounds(),!0)},s.$getWidth=function(){var t=this.$BitmapText[0];return isNaN(t)?this.$getContentBounds().width:t},s.$setWidth=function(t){var e=this.$BitmapText;return 0>t||t==e[0]?!1:(e[0]=t,this.$invalidateContentBounds(),!0)},s.$invalidateContentBounds=function(){e.prototype.$invalidateContentBounds.call(this),this.$BitmapText[7]=!0},s.$getHeight=function(){var t=this.$BitmapText[1];return isNaN(t)?this.$getContentBounds().height:t},s.$setHeight=function(t){var e=this.$BitmapText;return 0>t||t==e[1]?!1:(e[1]=t,this.$invalidateContentBounds(),!0)},n(s,"font",function(){return this.$BitmapText[5]},function(t){this.$setFont(t)}),s.$setFont=function(t){var e=this.$BitmapText;return e[5]==t?!1:(e[5]=t,this.$BitmapText[6]=!0,this.$invalidateContentBounds(),!0)},n(s,"lineSpacing",function(){return this.$BitmapText[3]},function(t){this.$setLineSpacing(t)}),s.$setLineSpacing=function(t){t=+t||0;var e=this.$BitmapText;return e[3]==t?!1:(e[3]=t,this.$invalidateContentBounds(),!0)},n(s,"letterSpacing",function(){return this.$BitmapText[4]},function(t){this.$setLetterSpacing(t)}),s.$setLetterSpacing=function(t){t=+t||0;var e=this.$BitmapText;return e[4]==t?!1:(e[4]=t,this.$invalidateContentBounds(),!0)},n(s,"textAlign",function(){return this.$BitmapText[10]},function(t){this.$setTextAlign(t)}),s.$setTextAlign=function(t){var e=this.$BitmapText;return e[10]==t?!1:(e[10]=t,this.$invalidateContentBounds(),!0)},n(s,"verticalAlign",function(){return this.$BitmapText[11]},function(t){this.$setVerticalAlign(t)}),s.$setVerticalAlign=function(t){var e=this.$BitmapText;return e[11]==t?!1:(e[11]=t,this.$invalidateContentBounds(),!0)},s.$render=function(){var e=this.$BitmapText,n=this.$getTextLines(),r=n.length;if(0!=r){var s=this.$textLinesWidth,a=e[5],o=this.$renderNode;a.$texture&&(o.image=a.$texture._bitmapData),o.smoothing=e[12];for(var h=a._getFirstCharHeight(),l=Math.ceil(h*i.EMPTY_FACTOR),u=!isNaN(e[1]),c=e[8],d=e[0],f=e[1],g=e[10],p=this.$textOffsetY+this.$textStartY,v=this.$lineHeights,$=0;r>$;$++){var m=v[$];if(u&&$>0&&p+m>f)break;var y=n[$],T=y.length,x=this.$textOffsetX;if(g!=t.HorizontalAlign.LEFT){var b=d>c?d:c;g==t.HorizontalAlign.RIGHT?x+=b-s[$]:g==t.HorizontalAlign.CENTER&&(x+=Math.floor((b-s[$])/2))}for(var _=0;T>_;_++){var E=y.charAt(_),C=a.getTexture(E);if(C){var F=C._bitmapWidth,w=C._bitmapHeight;o.imageWidth=C._sourceWidth,o.imageHeight=C._sourceHeight,o.drawImage(C._bitmapX,C._bitmapY,F,w,x+C._offsetX,p+C._offsetY,C.$getScaleBitmapWidth(),C.$getScaleBitmapHeight()),x+=(a.getConfig(E,"xadvance")||C.$getTextureWidth())+e[4]}else" "==E?x+=l:t.$warn(1046,E)}p+=m+e[3]}}},s.$measureContentBounds=function(t){var e=this.$getTextLines();0==e.length?t.setEmpty():t.setTo(this.$textOffsetX+this.$textStartX,this.$textOffsetY+this.$textStartY,this.$BitmapText[8]-this.$textOffsetX,this.$BitmapText[9]-this.$textOffsetY)},n(s,"textWidth",function(){return this.$getTextLines(),this.$BitmapText[8]}),n(s,"textHeight",function(){return this.$getTextLines(),this.$BitmapText[9]}),s.$getTextLines=function(){function e(t){return p&&r.length>0&&u>p?!1:(u+=F+o,R||S||(w-=h),r.push(t),a.push(F),s.push(w),l=Math.max(w,l),!0)}var n=this.$BitmapText;if(!n[7])return this.textLines;var r=[];this.textLines=r;var s=[];this.$textLinesWidth=s,n[7]=!1;var a=[];if(this.$lineHeights=a,!n[2]||!n[5])return r;for(var o=n[3],h=n[4],l=0,u=0,c=0,d=0,f=!isNaN(n[0]),g=n[0],p=n[1],v=n[5],$=v._getFirstCharHeight(),m=Math.ceil($*i.EMPTY_FACTOR),y=n[2],T=y.split(/(?:\r\n|\r|\n)/),x=T.length,b=!0,_=0;x>_;_++){for(var E=T[_],C=E.length,F=0,w=0,R=!0,S=!1,D=0;C>D;D++){R||(w+=h);var O,L,M=E.charAt(D),N=0,A=0,I=v.getTexture(M);if(I)O=I.$getTextureWidth(),L=I.$getTextureHeight(),N=I._offsetX,A=I._offsetY;else{if(" "!=M){t.$warn(1046,M),R&&(R=!1);continue}O=m,L=$}if(R&&(R=!1,c=Math.min(N,c)),b&&(b=!1,d=Math.min(A,d)),f&&D>0&&w+O>g){if(!e(E.substring(0,D)))break;E=E.substring(D),C=E.length,D=0,w=D==C-1?O:v.getConfig(M,"xadvance")||O,F=L}else w+=D==C-1?O:v.getConfig(M,"xadvance")||O,F=Math.max(L,F)}if(p&&_>0&&u>p)break;if(S=!0,!e(E))break}u-=o,n[8]=l,n[9]=u,this.$textOffsetX=c,this.$textOffsetY=d,this.$textStartX=0,this.$textStartY=0;var B;return g>l&&(B=n[10],B==t.HorizontalAlign.RIGHT?this.$textStartX=g-l:B==t.HorizontalAlign.CENTER&&(this.$textStartX=Math.floor((g-l)/2))),p>u&&(B=n[11],B==t.VerticalAlign.BOTTOM?this.$textStartY=p-u:B==t.VerticalAlign.MIDDLE&&(this.$textStartY=Math.floor((p-u)/2))),r},i.EMPTY_FACTOR=.33,i}(t.DisplayObject);t.BitmapText=e,t.registerClass(e,"egret.BitmapText")}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}var e=t;return e.prototype,t.LEFT="left",t.RIGHT="right",t.CENTER="center",t.JUSTIFY="justify",t.CONTENT_JUSTIFY="contentJustify",t}();t.HorizontalAlign=e,t.registerClass(e,"egret.HorizontalAlign")}(egret||(egret={}));var egret;!function(t){var e=function(){function e(){this.replaceArr=[],this.resutlArr=[],this.initReplaceArr()}var i=e,n=i.prototype;return n.initReplaceArr=function(){this.replaceArr=[],this.replaceArr.push([/&lt;/g,"<"]),this.replaceArr.push([/&gt;/g,">"]),this.replaceArr.push([/&amp;/g,"&"]),this.replaceArr.push([/&quot;/g,'"']),this.replaceArr.push([/&apos;/g,"'"])},n.replaceSpecial=function(t){for(var e=0;e<this.replaceArr.length;e++){var i=this.replaceArr[e][0],n=this.replaceArr[e][1];t=t.replace(i,n)}return t},n.parser=function(e){this.stackArray=[],this.resutlArr=[];for(var i=0,n=e.length;n>i;){var r=e.indexOf("<",i);if(0>r)this.addToResultArr(e.substring(i)),i=n;else{this.addToResultArr(e.substring(i,r));var s=e.indexOf(">",r);-1==s?(t.$error(1038),s=r):"/"==e.charAt(r+1)?this.stackArray.pop():this.addToArray(e.substring(r+1,s)),i=s+1}}return this.resutlArr},n.addToResultArr=function(t){""!=t&&(t=this.replaceSpecial(t),this.resutlArr.push(this.stackArray.length>0?{text:t,style:this.stackArray[this.stackArray.length-1]}:{text:t}))},n.changeStringToObject=function(t){t=t.trim();var e={},i=[];if("i"==t.charAt(0)||"b"==t.charAt(0)||"u"==t.charAt(0))this.addProperty(e,t,"true");else if(i=t.match(/^(font|a)\s/)){t=t.substring(i[0].length).trim();for(var n,r=0;n=t.match(this.getHeadReg());){var s=n[0],a="",t=t.substring(s.length).trim();if('"'==t.charAt(0)){var r=t.indexOf('"',1);a=t.substring(1,r),r+=1}else if("'"==t.charAt(0)){var r=t.indexOf("'",1);a=t.substring(1,r),r+=1}else a=t.match(/(\S)+/)[0],r=a.length;this.addProperty(e,s.substring(0,s.length-1).trim(),a.trim()),t=t.substring(r).trim()}}return e},n.getHeadReg=function(){return/^(color|textcolor|strokecolor|stroke|b|bold|i|italic|u|size|fontfamily|href|target)(\s)*=/},n.addProperty=function(t,e,i){switch(e.toLowerCase()){case"color":case"textcolor":i=i.replace(/#/,"0x"),t.textColor=parseInt(i);break;case"strokecolor":i=i.replace(/#/,"0x"),t.strokeColor=parseInt(i);break;case"stroke":t.stroke=parseInt(i);break;case"b":case"bold":t.bold="true"==i;break;case"u":t.underline="true"==i;break;case"i":case"italic":t.italic="true"==i;break;case"size":t.size=parseInt(i);break;case"fontfamily":t.fontFamily=i;break;case"href":t.href=this.replaceSpecial(i);break;case"target":t.target=this.replaceSpecial(i)}},n.addToArray=function(t){var e=this.changeStringToObject(t);if(0==this.stackArray.length)this.stackArray.push(e);else{var i=this.stackArray[this.stackArray.length-1];for(var n in i)null==e[n]&&(e[n]=i[n]);this.stackArray.push(e)}},e}();t.HtmlTextParser=e,t.registerClass(e,"egret.HtmlTextParser")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){e.call(this),this.stageTextAdded=!1,this._text=null,this._isFocus=!1}__extends(i,e);var n=i,r=n.prototype;return r.init=function(e){this._text=e,this.stageText=new t.StageText,this.stageText.$setTextField(this._text)},r._addStageText=function(){this.stageTextAdded||(this._text.$inputEnabled||(this._text.$touchEnabled=!0),this.tempStage=this._text.stage,this.stageText.$addToStage(),this.stageText.addEventListener("updateText",this.updateTextHandler,this),this._text.addEventListener(t.TouchEvent.TOUCH_BEGIN,this.onMouseDownHandler,this),this.stageText.addEventListener("blur",this.blurHandler,this),this.stageText.addEventListener("focus",this.focusHandler,this),this.stageTextAdded=!0)},r._removeStageText=function(){this.stageTextAdded&&(this._text.$inputEnabled||(this._text.$touchEnabled=!1),this.stageText.$removeFromStage(),this.stageText.removeEventListener("updateText",this.updateTextHandler,this),this._text.removeEventListener(t.TouchEvent.TOUCH_BEGIN,this.onMouseDownHandler,this),this.tempStage.removeEventListener(t.TouchEvent.TOUCH_BEGIN,this.onStageDownHandler,this),this.stageText.removeEventListener("blur",this.blurHandler,this),this.stageText.removeEventListener("focus",this.focusHandler,this),this.stageTextAdded=!1)},r._getText=function(){return this.stageText.$getText()},r._setText=function(t){this.stageText.$setText(t)},r._setColor=function(t){this.stageText.$setColor(t)},r.focusHandler=function(e){this._isFocus||(this._isFocus=!0,e.showing||(this._text.$isTyping=!0),this._text.$invalidateContentBounds(),this._text.dispatchEvent(new t.FocusEvent(t.FocusEvent.FOCUS_IN,!0)))},r.blurHandler=function(){this._isFocus&&(this._isFocus=!1,this.tempStage.removeEventListener(t.TouchEvent.TOUCH_BEGIN,this.onStageDownHandler,this),this._text.$isTyping=!1,this._text.$invalidateContentBounds(),this.stageText.$onBlur(),this._text.dispatchEvent(new t.FocusEvent(t.FocusEvent.FOCUS_OUT,!0)))},r.onMouseDownHandler=function(t){t.stopPropagation(),this.$onFocus()},r.$onFocus=function(){this._text.visible&&(this._isFocus||(this.tempStage.addEventListener(t.TouchEvent.TOUCH_BEGIN,this.onStageDownHandler,this),this.stageText.$show()))},r.onStageDownHandler=function(){this.stageText.$hide()},r.updateTextHandler=function(){var e=this._text.$TextField,i=this.stageText.$getText(),n=!1;if(null!=e[35]){var r=new RegExp("["+e[35]+"]","g"),s=i.match(r);i=s?s.join(""):"",n=!0}null!=e[36]&&(r=new RegExp("[^"+e[36]+"]","g"),s=i.match(r),i=s?s.join(""):"",n=!0),n&&this.stageText.$getText()!=i&&this.stageText.$setText(i),this.resetText(),this._text.dispatchEvent(new t.Event(t.Event.CHANGE,!0))},r.resetText=function(){this._text.$setBaseText(this.stageText.$getText())},r._hideInput=function(){this.stageText.$removeFromStage()},r.updateInput=function(){!this._text.$visible&&this.stageText&&this._hideInput()},r._updateProperties=function(){if(this._isFocus)return this.stageText.$resetStageText(),void this.updateInput();var t=this._text.$stage;if(null==t);else for(var e=this._text,i=e.$visible;i&&(e=e.parent,e!=t);)i=e.$visible;this.stageText.$setText(this._text.$TextField[13]),this.stageText.$resetStageText(),this.updateInput()},i}(t.HashObject);t.InputController=e,t.registerClass(e,"egret.InputController")}(egret||(egret={}));var egret;!function(){}(egret||(egret={}));var egret;!function(t){function e(e,i,r){r=r||{};var s=null==r.italic?i[16]:r.italic,a=null==r.bold?i[15]:r.bold,o=null==r.size?i[0]:r.size,h=r.fontFamily||i[8]||n.default_fontFamily;return t.sys.measureText(e,h,o,a,s)}var i=new RegExp("(?=[\\u00BF-\\u1FFF\\u2C00-\\uD7FF]|\\b|\\s)(?![)}\\.\\,\\!\\?\\]\\:])"),n=function(n){function r(){n.call(this),this.$inputEnabled=!1,this.inputUtils=null,this.graphicsNode=null,this.isFlow=!1,this.textArr=[],this.linesArr=[],this.$isTyping=!1;var e=new t.sys.TextNode;e.fontFamily=r.default_fontFamily,this.textNode=e,this.$renderNode=e,this.$TextField={0:30,1:0,2:16777215,3:0/0,4:0/0,5:0,6:0,7:0,8:r.default_fontFamily,9:"left",10:"top",11:"#ffffff",12:"",13:"",14:[],15:!1,16:!1,17:!0,18:!1,19:!1,20:!1,21:0,22:0,23:0,24:t.TextFieldType.DYNAMIC,25:0,26:"#000000",27:0,28:-1,29:0,30:!1,31:!1,32:0,33:!1,34:16777215,35:null,36:null,37:t.TextFieldInputType.TEXT}}__extends(r,n);var s=__define,a=r,o=a.prototype;return o.isInput=function(){return this.$TextField[24]==t.TextFieldType.INPUT},o.$setTouchEnabled=function(t){var e=n.prototype.$setTouchEnabled.call(this,t);return this.isInput()&&(this.$inputEnabled=!0),e},s(o,"fontFamily",function(){return this.$TextField[8]},function(t){this.$setFontFamily(t)}),o.$setFontFamily=function(t){var e=this.$TextField;return e[8]==t?!1:(e[8]=t,this.invalidateFontString(),!0)},s(o,"size",function(){return this.$TextField[0]},function(t){this.$setSize(t)}),o.$setSize=function(t){t=+t||0;var e=this.$TextField;return e[0]==t?!1:(e[0]=t,this.invalidateFontString(),!0)},s(o,"bold",function(){return this.$TextField[15]},function(t){this.$setBold(t)}),o.$setBold=function(t){t=!!t;var e=this.$TextField;return t==e[15]?!1:(e[15]=t,this.invalidateFontString(),!0)},s(o,"italic",function(){return this.$TextField[16]},function(t){this.$setItalic(t)}),o.$setItalic=function(t){t=!!t;var e=this.$TextField;return t==e[16]?!1:(e[16]=t,this.invalidateFontString(),!0)},o.invalidateFontString=function(){this.$TextField[17]=!0,this.$invalidateTextField()},s(o,"textAlign",function(){return this.$TextField[9]},function(t){this.$setTextAlign(t)}),o.$setTextAlign=function(t){var e=this.$TextField;return e[9]==t?!1:(e[9]=t,this.$invalidateTextField(),!0)},s(o,"verticalAlign",function(){return this.$TextField[10]},function(t){this.$setVerticalAlign(t)}),o.$setVerticalAlign=function(t){var e=this.$TextField;return e[10]==t?!1:(e[10]=t,this.$invalidateTextField(),!0)},s(o,"lineSpacing",function(){return this.$TextField[1]},function(t){this.$setLineSpacing(t)}),o.$setLineSpacing=function(t){t=+t||0;var e=this.$TextField;return e[1]==t?!1:(e[1]=t,this.$invalidateTextField(),!0)},s(o,"textColor",function(){return this.$TextField[2]},function(t){this.$setTextColor(t)}),o.$setTextColor=function(t){t=0|+t;var e=this.$TextField;return e[2]==t?!1:(e[2]=t,this.inputUtils&&this.inputUtils._setColor(this.$TextField[2]),this.$invalidate(),!0)},s(o,"wordWrap",function(){return this.$TextField[19]},function(t){t=!!t;var e=this.$TextField;t!=e[19]&&(e[20]||(e[19]=t,this.$invalidateTextField()))}),s(o,"type",function(){return this.$TextField[24]},function(t){this.$setType(t)}),o.$setType=function(e){var i=this.$TextField;return i[24]!=e?(i[24]=e,e==t.TextFieldType.INPUT?(isNaN(i[3])&&this.$setWidth(100),isNaN(i[4])&&this.$setHeight(30),this.$setTouchEnabled(!0),null==this.inputUtils&&(this.inputUtils=new t.InputController),this.inputUtils.init(this),this.$invalidateTextField(),this.$stage&&this.inputUtils._addStageText()):(this.inputUtils&&(this.inputUtils._removeStageText(),this.inputUtils=null),this.$setTouchEnabled(!1)),!0):!1},s(o,"inputType",function(){return this.$TextField[37]},function(t){this.$TextField[37]=t}),s(o,"text",function(){return this.$getText()},function(t){this.$setText(t)}),o.$getText=function(){return this.$TextField[24]==t.TextFieldType.INPUT?this.inputUtils._getText():this.$TextField[13]},o.$setBaseText=function(t){null==t&&(t=""),t=t.toString(),this.isFlow=!1;var e=this.$TextField;if(e[13]!=t){this.$invalidateTextField(),e[13]=t;var i="";return i=e[20]?this.changeToPassText(t):t,this.setMiddleStyle([{text:i}]),!0}return!1},o.$setText=function(t){null==t&&(t="");var e=this.$setBaseText(t);return this.inputUtils&&this.inputUtils._setText(this.$TextField[13]),e},s(o,"displayAsPassword",function(){return this.$TextField[20]},function(t){this.$setDisplayAsPassword(t)}),o.$setDisplayAsPassword=function(t){var e=this.$TextField;if(e[20]!=t){e[20]=t,this.$invalidateTextField();var i="";return i=t?this.changeToPassText(e[13]):e[13],this.setMiddleStyle([{text:i}]),!0}return!1},s(o,"strokeColor",function(){return this.$TextField[25]},function(t){t=+t||0,this.$setStrokeColor(t)}),o.$setStrokeColor=function(e){var i=this.$TextField;return i[25]!=e?(this.$invalidateTextField(),i[25]=e,i[26]=t.toColorString(e),!0):!1},s(o,"stroke",function(){return this.$TextField[27]},function(t){this.$setStroke(t)}),o.$setStroke=function(t){return this.$TextField[27]!=t?(this.$invalidateTextField(),this.$TextField[27]=t,!0):!1},s(o,"maxChars",function(){return this.$TextField[21]},function(t){this.$setMaxChars(t)}),o.$setMaxChars=function(t){return this.$TextField[21]!=t?(this.$TextField[21]=t,!0):!1},s(o,"scrollV",function(){return Math.min(Math.max(this.$TextField[28],1),this.maxScrollV)},function(t){this.$TextField[28]=Math.max(t,1),this.$invalidateTextField()}),s(o,"maxScrollV",function(){return this.$getLinesArr(),Math.max(this.$TextField[29]-t.TextFieldUtils.$getScrollNum(this)+1,1)}),s(o,"selectionBeginIndex",function(){return 0}),s(o,"selectionEndIndex",function(){return 0}),s(o,"caretIndex",function(){return 0}),o.$setSelection=function(){return!1},o.$getLineHeight=function(){return this.$TextField[1]+this.$TextField[0]},s(o,"numLines",function(){return this.$getLinesArr(),this.$TextField[29]}),s(o,"multiline",function(){return this.$TextField[30]},function(t){this.$setMultiline(t)}),o.$setMultiline=function(t){return this.$TextField[30]=t,this.$invalidateTextField(),!0},s(o,"restrict",function(){var t=this.$TextField,e=null;return null!=t[35]&&(e=t[35]),null!=t[36]&&(null==e&&(e=""),e+="^"+t[36]),e},function(t){var e=this.$TextField;if(null==t)e[35]=null,e[36]=null;else{for(var i=-1;i<t.length&&(i=t.indexOf("^",i),0!=i)&&i>0&&"\\"==t.charAt(i-1);)i++;0==i?(e[35]=null,e[36]=t.substring(i+1)):i>0?(e[35]=t.substring(0,i),e[36]=t.substring(i+1)):(e[35]=t,e[36]=null)}}),o.$setWidth=function(t){var e=this.$TextField;if(isNaN(t)){if(isNaN(e[3]))return!1;e[3]=0/0}else{if(e[3]==t)return!1;e[3]=t}return t=+t,0>t?!1:(this.$invalidateTextField(),!0)},o.$setHeight=function(t){var e=this.$TextField;if(isNaN(t)){if(isNaN(e[4]))return!1;e[4]=0/0}else{if(e[4]==t)return!1;e[4]=t}return t=+t,0>t?!1:(this.$invalidateTextField(),!0)},o.$getWidth=function(){var t=this.$TextField;return isNaN(t[3])?this.$getContentBounds().width:t[3]},o.$getHeight=function(){var t=this.$TextField;return isNaN(t[4])?this.$getContentBounds().height:t[4]},s(o,"border",function(){return this.$TextField[31]},function(t){this.$TextField[31]=!!t,this.$invalidate()}),s(o,"borderColor",function(){return this.$TextField[32]},function(t){this.$TextField[32]=+t||0,this.$invalidate()}),s(o,"background",function(){return this.$TextField[33]},function(t){this.$TextField[33]=t,this.$invalidate()}),s(o,"backgroundColor",function(){return this.$TextField[34]},function(t){this.$TextField[34]=t,this.$invalidate()}),o.fillBackground=function(e){var i=this.graphicsNode;i&&i.clear();var n=this.$TextField;if(n[33]||n[31]||e&&e.length>0){if(!i){i=this.graphicsNode=new t.sys.GraphicsNode;var r=new t.sys.GroupNode;r.addNode(i),r.addNode(this.textNode),this.$renderNode=r}var s,a;if(n[33]&&(s=i.beginFill(n[34]),s.drawRect(0,0,this.$getWidth(),this.$getHeight())),n[31]&&(a=i.lineStyle(1,n[32]),a.drawRect(0,0,this.$getWidth()-1,this.$getHeight()-1)),e&&e.length>0)for(var o=n[2],h=-1,l=e.length,u=0;l>u;u+=4){var c=e[u],d=e[u+1],f=e[u+2],g=e[u+3]||o;(0>h||h!=g)&&(h=g,a=i.lineStyle(2,g,1,t.CapsStyle.NONE)),a.moveTo(c,d),a.lineTo(c+f,d)}}if(i){var p=this.$getRenderBounds();i.x=p.x,i.y=p.y,i.width=p.width,i.height=p.height,t.Rectangle.release(p)}},o.setFocus=function(){this.type==t.TextFieldType.INPUT&&this.$stage&&this.inputUtils.$onFocus()},o.$onRemoveFromStage=function(){n.prototype.$onRemoveFromStage.call(this),this.removeEvent(),this.$TextField[24]==t.TextFieldType.INPUT&&this.inputUtils._removeStageText(),this.textNode&&this.textNode.clean()},o.$onAddToStage=function(e,i){n.prototype.$onAddToStage.call(this,e,i),this.addEvent(),this.$TextField[24]==t.TextFieldType.INPUT&&this.inputUtils._addStageText()},o.$invalidateTextField=function(){this.$invalidateContentBounds(),this.$TextField[18]=!0},o.$update=function(e){var i=this.$getRenderBounds(),r=n.prototype.$update.call(this,e,i);return t.Rectangle.release(i),r},o.$getRenderBounds=function(){var e=this.$getContentBounds(),i=t.Rectangle.create();i.copyFrom(e),this.$TextField[31]&&(i.width+=2,i.height+=2);var n=2*this.$TextField[27];return n>0&&(i.width+=2*n,i.height+=2*n),i.x-=n+2,i.y-=n+2,i.width=Math.ceil(i.width)+4,i.height=Math.ceil(i.height)+4,i},o.$measureContentBounds=function(e){this.$getLinesArr();var i=isNaN(this.$TextField[3])?this.$TextField[5]:this.$TextField[3],n=isNaN(this.$TextField[4])?t.TextFieldUtils.$getTextHeight(this):this.$TextField[4];e.setTo(0,0,i,n)},o.$render=function(){if(this.$TextField[24]==t.TextFieldType.INPUT){if((this.$hasAnyFlags(2032)||this.$hasAnyFlags(1648))&&this.inputUtils._updateProperties(),this.$isTyping)return void this.fillBackground()}else if(0==this.$TextField[3])return;var e=this.drawText();this.fillBackground(e);var i=this.$getRenderBounds(),n=this.textNode;n.x=i.x,n.y=i.y,n.width=Math.ceil(i.width),n.height=Math.ceil(i.height),t.Rectangle.release(i)},s(o,"textFlow",function(){return this.textArr},function(t){this.isFlow=!0;var e="";null==t&&(t=[]);for(var i=0;i<t.length;i++){var n=t[i];e+=n.text}this.$TextField[20]?this.$setBaseText(e):(this.$TextField[13]=e,this.setMiddleStyle(t))}),o.changeToPassText=function(t){if(this.$TextField[20]){for(var e="",i=0,n=t.length;n>i;i++)switch(t.charAt(i)){case"\n":e+="\n";break;case"\r":break;default:e+="*"}return e}return t},o.setMiddleStyle=function(t){this.$TextField[18]=!0,this.textArr=t,this.$invalidateTextField()},s(o,"textWidth",function(){return this.$getLinesArr(),this.$TextField[5]}),s(o,"textHeight",function(){return this.$getLinesArr(),t.TextFieldUtils.$getTextHeight(this)}),o.appendText=function(t){this.appendElement({text:t})},o.appendElement=function(t){var e=this.$TextField[13]+t.text;this.$TextField[20]?this.$setBaseText(e):(this.$TextField[13]=e,this.textArr.push(t),this.setMiddleStyle(this.textArr))},o.$getLinesArr=function(){var n=this.$TextField;if(!n[18])return this.linesArr;n[18]=!1;var r=this.textArr;this.linesArr.length=0,n[6]=0,n[5]=0;var s=n[3];if(!isNaN(s)&&0==s)return n[29]=0,[{width:0,height:0,charNum:0,elements:[],hasNextLine:!1}];for(var a,o=this.linesArr,h=0,l=0,u=0,c=0,d=0,f=r.length;f>d;d++){var g=r[d];if(g.text){g.style=g.style||{};for(var p=g.text.toString(),v=p.split(/(?:\r\n|\r|\n)/),$=0,m=v.length;m>$;$++){null==o[c]&&(a={width:0,height:0,elements:[],charNum:0,hasNextLine:!1},o[c]=a,h=0,u=0,l=0),u=n[24]==t.TextFieldType.INPUT?n[0]:Math.max(u,g.style.size||n[0]);var y=!0;if(""==v[$])$==m-1&&(y=!1);else{var T=e(v[$],n,g.style);if(isNaN(s))h+=T,l+=v[$].length,a.elements.push({width:T,text:v[$],style:g.style}),$==m-1&&(y=!1);else if(s>=h+T)a.elements.push({width:T,text:v[$],style:g.style}),h+=T,l+=v[$].length,$==m-1&&(y=!1);else{var x=0,b=0,_=v[$];if(n[19])var E=_.split(i);else E=_.match(/./g);for(var C=E.length,F=0;C>x&&(T=e(E[x],n,g.style),!(0!=h&&h+T>s&&h+x!=0));x++)if(b+T>s)for(var w=E[x].match(/./g),R=0,S=w.length;S>R&&(T=e(w[R],n,g.style),!(R>0&&h+T>s));R++)F+=w[R].length,b+=T,h+=T,l+=F;else F+=E[x].length,b+=T,h+=T,l+=F;if(x>0){a.elements.push({width:b,text:_.substring(0,F),style:g.style});for(var D=_.substring(F),O=0,L=D.length;L>O&&" "==D.charAt(O);O++);v[$]=D.substring(O)}""!=v[$]&&($--,y=!1)}}y&&(l++,a.hasNextLine=!0),$<v.length-1&&(a.width=h,a.height=u,a.charNum=l,n[5]=Math.max(n[5],h),n[6]+=u,c++)}d==r.length-1&&a&&(a.width=h,a.height=u,a.charNum=l,n[5]=Math.max(n[5],h),n[6]+=u)}else a&&(a.width=h,a.height=u,a.charNum=l,n[5]=Math.max(n[5],h),n[6]+=u)}return n[29]=o.length,o},o.drawText=function(){var e=this.textNode,i=this.$TextField;e.bold=i[15],e.fontFamily=i[8]||r.default_fontFamily,e.italic=i[16],e.size=i[0],e.stroke=i[27],e.strokeColor=i[25],e.textColor=i[2];var n=this.$getLinesArr();if(0==i[5])return[];var s=isNaN(i[3])?i[5]:i[3],a=t.TextFieldUtils.$getTextHeight(this),o=0,h=t.TextFieldUtils.$getStartLine(this),l=i[4];if(!isNaN(l)&&l>a){var u=t.TextFieldUtils.$getValign(this);o+=u*(l-a)}o=Math.round(o);for(var c=t.TextFieldUtils.$getHalign(this),d=0,f=[],g=h,p=i[29];p>g;g++){var v=n[g],$=v.height;if(o+=$/2,g!=h){if(i[24]==t.TextFieldType.INPUT&&!i[30])break;if(!isNaN(l)&&o>l)break}d=Math.round((s-v.width)*c);for(var m=0,y=v.elements.length;y>m;m++){var T=v.elements[m],x=T.style.size||i[0];e.drawText(d,o+($-x)/2,T.text,T.style),T.style.underline&&f.push(d,o+$/2,T.width,T.style.textColor),d+=T.width}o+=$/2+i[1]}return f},o.addEvent=function(){this.addEventListener(t.TouchEvent.TOUCH_TAP,this.onTapHandler,this)},o.removeEvent=function(){this.removeEventListener(t.TouchEvent.TOUCH_TAP,this.onTapHandler,this)},o.onTapHandler=function(e){if(this.$TextField[24]!=t.TextFieldType.INPUT){var i=t.TextFieldUtils.$getTextElement(this,e.localX,e.localY);if(null!=i){var n=i.style;if(n&&n.href)if(n.href.match(/^event:/)){var r=n.href.match(/^event:/)[0];t.TextEvent.dispatchTextEvent(this,t.TextEvent.LINK,n.href.substring(r.length))}else open(n.href,n.target||"_blank")}}},r.default_fontFamily="Arial",r}(t.DisplayObject);t.TextField=n,t.registerClass(n,"egret.TextField")}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}var e=t;return e.prototype,t.TEXT="text",t.TEL="tel",t.PASSWORD="password",t}();t.TextFieldInputType=e,t.registerClass(e,"egret.TextFieldInputType")}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}var e=t;return e.prototype,t.DYNAMIC="dynamic",t.INPUT="input",t}();t.TextFieldType=e,t.registerClass(e,"egret.TextFieldType")}(egret||(egret={}));var egret;!function(t){var e=function(){function e(){}var i=e;return i.prototype,e.$getStartLine=function(t){var i=t.$TextField,n=e.$getTextHeight(t),r=0,s=i[4];return isNaN(s)||(s>n||n>s&&(r=Math.max(i[28]-1,0),r=Math.min(i[29]-1,r)),i[30]||(r=Math.max(i[28]-1,0),i[29]>0&&(r=Math.min(i[29]-1,r)))),r},e.$getHalign=function(e){var i=e.$getLinesArr(),n=0;return e.$TextField[9]==t.HorizontalAlign.CENTER?n=.5:e.$TextField[9]==t.HorizontalAlign.RIGHT&&(n=1),e.$TextField[24]==t.TextFieldType.INPUT&&!e.$TextField[30]&&i.length>1&&(n=0),n},e.$getTextHeight=function(e){var i=t.TextFieldType.INPUT!=e.$TextField[24]||e.$TextField[30]?e.$TextField[6]+(e.$TextField[29]-1)*e.$TextField[1]:e.$TextField[0];return i},e.$getValign=function(i){var n=e.$getTextHeight(i),r=i.$TextField[4];if(!isNaN(r)&&r>n){var s=0;return i.$TextField[10]==t.VerticalAlign.MIDDLE?s=.5:i.$TextField[10]==t.VerticalAlign.BOTTOM&&(s=1),s}return 0},e.$getTextElement=function(t,i,n){var r=e.$getHit(t,i,n),s=t.$getLinesArr();return r&&s[r.lineIndex]&&s[r.lineIndex].elements[r.textElementIndex]?s[r.lineIndex].elements[r.textElementIndex]:null},e.$getHit=function(t,i,n){var r=t.$getLinesArr();if(0==t.$TextField[3])return null;var s=0,a=e.$getTextHeight(t),o=0,h=t.$TextField[4];if(!isNaN(h)&&h>a){var l=e.$getValign(t);o=l*(h-a),0!=o&&(n-=o)}for(var u=e.$getStartLine(t),c=0,d=u;d<r.length;d++){var f=r[d];if(c+f.height>=n){n>c&&(s=d+1);break}if(c+=f.height,c+t.$TextField[1]>n)return null;c+=t.$TextField[1]}if(0==s)return null;var g=r[s-1],p=t.$TextField[3];isNaN(p)&&(p=t.textWidth);var v=e.$getHalign(t);i-=v*(p-g.width);var $=0;for(d=0;d<g.elements.length;d++){var m=g.elements[d];if($+m.width<=i)$+=m.width;else if(i>$)return{lineIndex:s-1,textElementIndex:d}}return null},e.$getScrollNum=function(t){var e=1;if(t.$TextField[30]){var i=t.height,n=t.size,r=t.lineSpacing;e=Math.floor(i/(n+r));var s=i-(n+r)*e;s>n/2&&e++}return e},e}();t.TextFieldUtils=e,t.registerClass(e,"egret.TextFieldUtils")}(egret||(egret={}));var egret;!function(t){var e;!function(){}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}var e=t;return e.prototype,t.TOP="top",t.BOTTOM="bottom",t.MIDDLE="middle",t.JUSTIFY="justify",t.CONTENT_JUSTIFY="contentJustify",t}();t.VerticalAlign=e,t.registerClass(e,"egret.VerticalAlign")}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}var e=t;return e.prototype,t.LITTLE_ENDIAN="littleEndian",t.BIG_ENDIAN="bigEndian",t}();t.Endian=e,t.registerClass(e,"egret.Endian");var i=function(){function i(t){this.BUFFER_EXT_SIZE=0,this.EOF_byte=-1,this.EOF_code_point=-1,this._setArrayBuffer(t||new ArrayBuffer(this.BUFFER_EXT_SIZE)),this.endian=e.BIG_ENDIAN}var n=__define,r=i,s=r.prototype;return s._setArrayBuffer=function(t){this.write_position=t.byteLength,this.data=new DataView(t),this._position=0},s.setArrayBuffer=function(){},n(s,"buffer",function(){return this.data.buffer},function(t){this.data=new DataView(t)}),n(s,"dataView",function(){return this.data},function(t){this.data=t,this.write_position=t.byteLength}),n(s,"bufferOffset",function(){return this.data.byteOffset}),n(s,"position",function(){return this._position},function(t){this._position=t,this.write_position=t>this.write_position?t:this.write_position}),n(s,"length",function(){return this.write_position},function(t){this.write_position=t;var e=new Uint8Array(new ArrayBuffer(t)),i=this.data.buffer.byteLength;i>t&&(this._position=t);var n=Math.min(i,t);e.set(new Uint8Array(this.data.buffer,0,n)),this.buffer=e.buffer}),n(s,"bytesAvailable",function(){return this.data.byteLength-this._position}),s.clear=function(){this._setArrayBuffer(new ArrayBuffer(this.BUFFER_EXT_SIZE))},s.readBoolean=function(){return this.validate(i.SIZE_OF_BOOLEAN)?0!=this.data.getUint8(this.position++):null},s.readByte=function(){return this.validate(i.SIZE_OF_INT8)?this.data.getInt8(this.position++):null},s.readBytes=function(t,e,n){if(void 0===e&&(e=0),void 0===n&&(n=0),0==n)n=this.bytesAvailable;else if(!this.validate(n))return null;t?t.validateBuffer(e+n):t=new i(new ArrayBuffer(e+n));for(var r=0;n>r;r++)t.data.setUint8(r+e,this.data.getUint8(this.position++))},s.readDouble=function(){if(!this.validate(i.SIZE_OF_FLOAT64))return null;var t=this.data.getFloat64(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=i.SIZE_OF_FLOAT64,t},s.readFloat=function(){if(!this.validate(i.SIZE_OF_FLOAT32))return null;var t=this.data.getFloat32(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=i.SIZE_OF_FLOAT32,t},s.readInt=function(){if(!this.validate(i.SIZE_OF_INT32))return null;var t=this.data.getInt32(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=i.SIZE_OF_INT32,t},s.readShort=function(){if(!this.validate(i.SIZE_OF_INT16))return null;var t=this.data.getInt16(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=i.SIZE_OF_INT16,t},s.readUnsignedByte=function(){return this.validate(i.SIZE_OF_UINT8)?this.data.getUint8(this.position++):null},s.readUnsignedInt=function(){if(!this.validate(i.SIZE_OF_UINT32))return null;var t=this.data.getUint32(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=i.SIZE_OF_UINT32,t},s.readUnsignedShort=function(){if(!this.validate(i.SIZE_OF_UINT16))return null;var t=this.data.getUint16(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=i.SIZE_OF_UINT16,t},s.readUTF=function(){if(!this.validate(i.SIZE_OF_UINT16))return null;var t=this.data.getUint16(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=i.SIZE_OF_UINT16,t>0?this.readUTFBytes(t):""},s.readUTFBytes=function(t){if(!this.validate(t))return null;var e=new Uint8Array(this.buffer,this.bufferOffset+this.position,t);return this.position+=t,this.decodeUTF8(e)},s.writeBoolean=function(t){this.validateBuffer(i.SIZE_OF_BOOLEAN),this.data.setUint8(this.position++,t?1:0)},s.writeByte=function(t){this.validateBuffer(i.SIZE_OF_INT8),this.data.setInt8(this.position++,t)
},s.writeBytes=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);var n;if(!(0>e)&&!(0>i)&&(n=0==i?t.length-e:Math.min(t.length-e,i),n>0)){this.validateBuffer(n);for(var r=new DataView(t.buffer),i=n,s=4;i>s;i-=s)this.data.setUint32(this._position,r.getUint32(e)),this.position+=s,e+=s;for(;i>0;i--)this.data.setUint8(this.position++,r.getUint8(e++))}},s.writeDouble=function(t){this.validateBuffer(i.SIZE_OF_FLOAT64),this.data.setFloat64(this.position,t,this.endian==e.LITTLE_ENDIAN),this.position+=i.SIZE_OF_FLOAT64},s.writeFloat=function(t){this.validateBuffer(i.SIZE_OF_FLOAT32),this.data.setFloat32(this.position,t,this.endian==e.LITTLE_ENDIAN),this.position+=i.SIZE_OF_FLOAT32},s.writeInt=function(t){this.validateBuffer(i.SIZE_OF_INT32),this.data.setInt32(this.position,t,this.endian==e.LITTLE_ENDIAN),this.position+=i.SIZE_OF_INT32},s.writeShort=function(t){this.validateBuffer(i.SIZE_OF_INT16),this.data.setInt16(this.position,t,this.endian==e.LITTLE_ENDIAN),this.position+=i.SIZE_OF_INT16},s.writeUnsignedInt=function(t){this.validateBuffer(i.SIZE_OF_UINT32),this.data.setUint32(this.position,t,this.endian==e.LITTLE_ENDIAN),this.position+=i.SIZE_OF_UINT32},s.writeUnsignedShort=function(t){this.validateBuffer(i.SIZE_OF_UINT16),this.data.setUint16(this.position,t,this.endian==e.LITTLE_ENDIAN),this.position+=i.SIZE_OF_UINT16},s.writeUTF=function(t){var n=this.encodeUTF8(t),r=n.length;this.validateBuffer(i.SIZE_OF_UINT16+r),this.data.setUint16(this.position,r,this.endian==e.LITTLE_ENDIAN),this.position+=i.SIZE_OF_UINT16,this._writeUint8Array(n,!1)},s.writeUTFBytes=function(t){this._writeUint8Array(this.encodeUTF8(t))},s.toString=function(){return"[ByteArray] length:"+this.length+", bytesAvailable:"+this.bytesAvailable},s._writeUint8Array=function(t,e){void 0===e&&(e=!0),e&&this.validateBuffer(this.position+t.length);for(var i=0;i<t.length;i++)this.data.setUint8(this.position++,t[i])},s.validate=function(e){return this.data.byteLength>0&&this._position+e<=this.data.byteLength?!0:void t.$error(1025)},s.validateBuffer=function(t,e){if(void 0===e&&(e=!1),this.write_position=t>this.write_position?t:this.write_position,t+=this._position,this.data.byteLength<t||e){var i=new Uint8Array(new ArrayBuffer(t+this.BUFFER_EXT_SIZE)),n=Math.min(this.data.buffer.byteLength,t+this.BUFFER_EXT_SIZE);i.set(new Uint8Array(this.data.buffer,0,n)),this.buffer=i.buffer}},s.encodeUTF8=function(t){for(var e=0,i=this.stringToCodePoints(t),n=[];i.length>e;){var r=i[e++];if(this.inRange(r,55296,57343))this.encoderError(r);else if(this.inRange(r,0,127))n.push(r);else{var s,a;for(this.inRange(r,128,2047)?(s=1,a=192):this.inRange(r,2048,65535)?(s=2,a=224):this.inRange(r,65536,1114111)&&(s=3,a=240),n.push(this.div(r,Math.pow(64,s))+a);s>0;){var o=this.div(r,Math.pow(64,s-1));n.push(128+o%64),s-=1}}}return new Uint8Array(n)},s.decodeUTF8=function(t){for(var e,i=!1,n=0,r="",s=0,a=0,o=0,h=0;t.length>n;){var l=t[n++];if(l==this.EOF_byte)e=0!=a?this.decoderError(i):this.EOF_code_point;else if(0==a)this.inRange(l,0,127)?e=l:(this.inRange(l,194,223)?(a=1,h=128,s=l-192):this.inRange(l,224,239)?(a=2,h=2048,s=l-224):this.inRange(l,240,244)?(a=3,h=65536,s=l-240):this.decoderError(i),s*=Math.pow(64,a),e=null);else if(this.inRange(l,128,191))if(o+=1,s+=(l-128)*Math.pow(64,a-o),o!==a)e=null;else{var u=s,c=h;s=0,a=0,o=0,h=0,e=this.inRange(u,c,1114111)&&!this.inRange(u,55296,57343)?u:this.decoderError(i,l)}else s=0,a=0,o=0,h=0,n--,e=this.decoderError(i,l);null!==e&&e!==this.EOF_code_point&&(65535>=e?e>0&&(r+=String.fromCharCode(e)):(e-=65536,r+=String.fromCharCode(55296+(e>>10&1023)),r+=String.fromCharCode(56320+(1023&e))))}return r},s.encoderError=function(e){t.$error(1026,e)},s.decoderError=function(e,i){return e&&t.$error(1027),i||65533},s.inRange=function(t,e,i){return t>=e&&i>=t},s.div=function(t,e){return Math.floor(t/e)},s.stringToCodePoints=function(t){for(var e=[],i=0,n=t.length;i<t.length;){var r=t.charCodeAt(i);if(this.inRange(r,55296,57343))if(this.inRange(r,56320,57343))e.push(65533);else if(i==n-1)e.push(65533);else{var s=t.charCodeAt(i+1);if(this.inRange(s,56320,57343)){var a=1023&r,o=1023&s;i+=1,e.push(65536+(a<<10)+o)}else e.push(65533)}else e.push(r);i+=1}return e},i.SIZE_OF_BOOLEAN=1,i.SIZE_OF_INT8=1,i.SIZE_OF_INT16=2,i.SIZE_OF_INT32=4,i.SIZE_OF_UINT8=1,i.SIZE_OF_UINT16=2,i.SIZE_OF_UINT32=4,i.SIZE_OF_FLOAT32=4,i.SIZE_OF_FLOAT64=8,i}();t.ByteArray=i,t.registerClass(i,"egret.ByteArray")}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}var e=__define,i=t;return i.prototype,e(t,"logLevel",void 0,function(){}),t.ALL="all",t.DEBUG="debug",t.INFO="info",t.WARN="warn",t.ERROR="error",t.OFF="off",t}();t.Logger=e,t.registerClass(e,"egret.Logger")}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}var e=t;return e.prototype,t.isNumber=function(t){return"number"==typeof t&&!isNaN(t)},t.sin=function(e){var i=Math.floor(e),n=i+1,r=t.sinInt(i);if(i==e)return r;var s=t.sinInt(n);return(e-i)*s+(n-e)*r},t.sinInt=function(t){return t%=360,0>t&&(t+=360),egret_sin_map[t]},t.cos=function(e){var i=Math.floor(e),n=i+1,r=t.cosInt(i);if(i==e)return r;var s=t.cosInt(n);return(e-i)*s+(n-e)*r},t.cosInt=function(t){return t%=360,0>t&&(t+=360),egret_cos_map[t]},t}();t.NumberUtils=e,t.registerClass(e,"egret.NumberUtils")}(egret||(egret={}));for(var egret_sin_map={},egret_cos_map={},DEG_TO_RAD=Math.PI/180,NumberUtils_i=0;360>NumberUtils_i;NumberUtils_i++)egret_sin_map[NumberUtils_i]=Math.sin(NumberUtils_i*DEG_TO_RAD),egret_cos_map[NumberUtils_i]=Math.cos(NumberUtils_i*DEG_TO_RAD);egret_sin_map[90]=1,egret_cos_map[90]=0,egret_sin_map[180]=0,egret_cos_map[180]=-1,egret_sin_map[270]=-1,egret_cos_map[270]=0,Function.prototype.bind||(Function.prototype.bind=function(t){"function"!=typeof this&&egret.$error(1029);var e=Array.prototype.slice.call(arguments,1),i=this,n=function(){},r=function(){return i.apply(this instanceof n&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return n.prototype=this.prototype,r.prototype=new n,r});var egret;!function(t){var e=function(e){function i(t,i){void 0===i&&(i=0),e.call(this),this._delay=0,this._currentCount=0,this._running=!1,this.updateInterval=1e3,this.lastCount=1e3,this.lastTimeStamp=0,this.delay=t,this.repeatCount=0|+i}__extends(i,e);var n=__define,r=i,s=r.prototype;return n(s,"delay",function(){return this._delay},function(t){1>t&&(t=1),this._delay!=t&&(this._delay=t,this.lastCount=this.updateInterval=Math.round(60*t))}),n(s,"currentCount",function(){return this._currentCount}),n(s,"running",function(){return this._running}),s.reset=function(){this.stop(),this._currentCount=0},s.start=function(){this._running||(this.lastCount=this.updateInterval,this.lastTimeStamp=t.getTimer(),t.sys.$ticker.$startTick(this.$update,this),this._running=!0)},s.stop=function(){this._running&&(t.stopTick(this.$update,this),this._running=!1)},s.$update=function(e){var i=e-this.lastTimeStamp;if(i>=this._delay)this.lastCount=this.updateInterval;else{if(this.lastCount-=1e3,this.lastCount>0)return!1;this.lastCount+=this.updateInterval}this.lastTimeStamp=e,this._currentCount++;var n=this.repeatCount>0&&this._currentCount>=this.repeatCount;return t.TimerEvent.dispatchTimerEvent(this,t.TimerEvent.TIMER),n&&(this.stop(),t.TimerEvent.dispatchTimerEvent(this,t.TimerEvent.TIMER_COMPLETE)),!1},i}(t.EventDispatcher);t.Timer=e,t.registerClass(e,"egret.Timer")}(egret||(egret={}));var egret;!function(){}(egret||(egret={}));var egret;!function(t){function e(e,i){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];t.$callLaterFunctionList.push(e),t.$callLaterThisList.push(i),t.$callLaterArgsList.push(n)}function i(e,i){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];t.$callAsyncFunctionList.push(e),t.$callAsyncThisList.push(i),t.$callAsyncArgsList.push(n)}t.$callLaterFunctionList=[],t.$callLaterThisList=[],t.$callLaterArgsList=[],t.callLater=e,t.$callAsyncFunctionList=[],t.$callAsyncThisList=[],t.$callAsyncArgsList=[],t.$callAsync=i}(egret||(egret={}));var egret;!function(t){function e(t,e,i){for(var n=[],r=3;r<arguments.length;r++)n[r-3]=arguments[r];var s,a=t.prototype;t.hasOwnProperty("__sets__")||Object.defineProperty(t,"__sets__",{value:{}}),s=t.__sets__;var o=s[i];if(o)return o.apply(e,n);var h=Object.getPrototypeOf(a);if(null!=h){for(;!h.hasOwnProperty(i);)if(h=Object.getPrototypeOf(h),null==h)return;o=Object.getOwnPropertyDescriptor(h,i).set,s[i]=o,o.apply(e,n)}}function i(t,e,i){var n,r=t.prototype;t.hasOwnProperty("__gets__")||Object.defineProperty(t,"__gets__",{value:{}}),n=t.__gets__;var s=n[i];if(s)return s.call(e);var a=Object.getPrototypeOf(r);if(null!=a){for(;!a.hasOwnProperty(i);)if(a=Object.getPrototypeOf(a),null==a)return;return s=Object.getOwnPropertyDescriptor(a,i).get,n[i]=s,s.call(e)}}t.superSetter=e,t.superGetter=i}(egret||(egret={}));var egret;!function(t){function e(t){if(!t)return null;var e=i[t];if(e)return e;var n=t.split("."),r=n.length;e=__global;for(var s=0;r>s;s++){var a=n[s];if(e=e[a],!e)return null}return i[t]=e,e}var i={};t.getDefinitionByName=e}(egret||(egret={}));var __global=__global||this,egret;!function(){}(egret||(egret={}));var egret;!function(t){function e(t){var e=typeof t;if(!t||"object"!=e&&!t.prototype)return e;var i=t.prototype?t.prototype:Object.getPrototypeOf(t);if(i.hasOwnProperty("__class__"))return i.__class__;var n=i.constructor.toString().trim(),r=n.indexOf("("),s=n.substring(9,r);return Object.defineProperty(i,"__class__",{value:s,enumerable:!1,writable:!0}),s}t.getQualifiedClassName=e}(egret||(egret={}));var egret;!function(t){function e(e){if(!e||"object"!=typeof e&&!e.prototype)return null;var i=e.prototype?e.prototype:Object.getPrototypeOf(e),n=Object.getPrototypeOf(i);if(!n)return null;var r=t.getQualifiedClassName(n.constructor);return r?r:null}t.getQualifiedSuperclassName=e}(egret||(egret={}));var egret;!function(t){function e(){return Date.now()-t.sys.$START_TIME}t.getTimer=e}(egret||(egret={}));var egret;!function(t){function e(e){var i=t.getDefinitionByName(e);return i?!0:!1}t.hasDefinition=e}(egret||(egret={}));var egret;!function(t){function e(t,e){if(!t||"object"!=typeof t)return!1;var i=Object.getPrototypeOf(t),n=i?i.__types__:null;return n?-1!==n.indexOf(e):!1}t.is=e}(egret||(egret={}));var egret;!function(t){function e(e,i){t.sys.$ticker.$startTick(e,i)}t.startTick=e}(egret||(egret={}));var egret;!function(t){function e(e,i){t.sys.$ticker.$stopTick(e,i)}t.stopTick=e}(egret||(egret={}));var egret;!function(t){function e(t){0>t&&(t=0),t>16777215&&(t=16777215);for(var e=t.toString(16).toUpperCase();e.length>6;)e=e.slice(1,e.length);for(;e.length<6;)e="0"+e;return"#"+e}t.toColorString=e}(egret||(egret={}));var egret;!function(t){var e=function(){function e(){}var i=e;return i.prototype,e.compileProgram=function(i,n,r){var s=e.compileFragmentShader(i,r),a=e.compileVertexShader(i,n),o=i.createProgram();return i.attachShader(o,a),i.attachShader(o,s),i.linkProgram(o),i.getProgramParameter(o,i.LINK_STATUS)||t.$warn(1020),o},e.compileFragmentShader=function(t,i){return e._compileShader(t,i,t.FRAGMENT_SHADER)},e.compileVertexShader=function(t,i){return e._compileShader(t,i,t.VERTEX_SHADER)},e._compileShader=function(t,e,i){var n=t.createShader(i);return t.shaderSource(n,e),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:null},e.checkCanUseWebGL=function(){if(void 0==e.canUseWebGL)try{var t=document.createElement("canvas");e.canUseWebGL=!(!window.WebGLRenderingContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(i){e.canUseWebGL=!1}return e.canUseWebGL},e.deleteWebGLTexture=function(t){if(t){var e=t.glContext;e&&e.deleteTexture(t)}},e}();t.WebGLUtils=e,t.registerClass(e,"egret.WebGLUtils")}(egret||(egret={}));
;/*!libs/libs/modules/egret/egret.web.min.js*/
var egret;!function(e){var t;!function(){var t="egret.BitmapData";e.registerClass(HTMLImageElement,t),e.registerClass(HTMLCanvasElement,t),e.registerClass(HTMLVideoElement,t)}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){function t(t){return t.hashCode=t.$hashCode=e.$hashCount++,t}e.$toBitmapData=t}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(){function e(){}var t=e;return t.prototype,e.call=function(){},e.addCallback=function(){},e}();t.WebExternalInterface=i,e.registerClass(i,"egret.web.WebExternalInterface",["egret.ExternalInterface"]),e.ExternalInterface=i}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i;!function(){function i(e){return window.localStorage.getItem(e)}function r(t,i){try{return window.localStorage.setItem(t,i),!0}catch(r){return e.$warn(1047,t,i),!1}}function n(e){window.localStorage.removeItem(e)}function a(){window.localStorage.clear()}t.getItem=i,t.setItem=r,t.removeItem=n,t.clear=a}(i=t.web||(t.web={}))}(t=e.localStorage||(e.localStorage={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(i){function r(){i.call(this),this.loaded=!1}__extends(r,i);var n=__define,a=r,s=a.prototype;return n(s,"length",function(){if(this.originAudio)return this.originAudio.duration;throw new Error("sound not loaded!")}),s.load=function(t){function i(){a(),h.indexOf("firefox")>=0&&(o.pause(),o.muted=!1),s.loaded=!0,s.dispatchEventWith(e.Event.COMPLETE)}function n(){a(),s.dispatchEventWith(e.IOErrorEvent.IO_ERROR)}function a(){o.removeEventListener("canplaythrough",i),o.removeEventListener("error",n)}var s=this;this.url=t;var o=new Audio(t);o.addEventListener("canplaythrough",i),o.addEventListener("error",n);var h=navigator.userAgent.toLowerCase();h.indexOf("firefox")>=0&&(o.autoplay=!0,o.muted=!0),o.load(),this.originAudio=o,r.$recycle(this.url,o)},s.play=function(i,n){i=+i||0,n=+n||0;var a=r.$pop(this.url);null==a&&(a=this.originAudio.cloneNode()),a.autoplay=!0;var s=new t.HtmlSoundChannel(a);return s.$url=this.url,s.$loops=n,s.$startTime=i,s.$play(),e.sys.$pushSoundChannel(s),s},s.close=function(){0==this.loaded&&this.originAudio&&(this.originAudio.src=""),this.originAudio&&(this.originAudio=null),r.$clear(this.url)},r.$clear=function(e){var t=r.audios[e];t&&(t.length=0)},r.$pop=function(e){var t=r.audios[e];return t&&t.length>0?t.pop():null},r.$recycle=function(e,t){var i=r.audios[e];null==r.audios[e]&&(i=r.audios[e]=[]),i.push(t)},r.MUSIC="music",r.EFFECT="effect",r.audios={},r}(e.EventDispatcher);t.HtmlSound=i,e.registerClass(i,"egret.web.HtmlSound",["egret.Sound"])}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(i){function r(t){var r=this;i.call(this),this.$startTime=0,this.audio=null,this.isStopped=!1,this.canPlay=function(){r.audio.removeEventListener("canplay",r.canPlay);try{r.audio.currentTime=r.$startTime}catch(e){}finally{r.audio.play()}},this.onPlayEnd=function(){return 1==r.$loops?(r.stop(),void r.dispatchEventWith(e.Event.SOUND_COMPLETE)):(r.$loops>0&&r.$loops--,void r.$play())},t.addEventListener("ended",this.onPlayEnd),this.audio=t}__extends(r,i);var n=__define,a=r,s=a.prototype;return s.$play=function(){if(this.isStopped)return void e.$error(1036);try{this.audio.currentTime=this.$startTime}catch(t){return void this.audio.addEventListener("canplay",this.canPlay)}this.audio.play()},s.stop=function(){if(this.audio){this.isStopped||e.sys.$popSoundChannel(this),this.isStopped=!0;var i=this.audio;i.pause(),i.removeEventListener("ended",this.onPlayEnd),this.audio=null,t.HtmlSound.$recycle(this.$url,i)}},n(s,"volume",function(){return this.audio?this.audio.volume:1},function(t){return this.isStopped?void e.$error(1036):void(this.audio&&(this.audio.volume=t))}),n(s,"position",function(){return this.audio?this.audio.currentTime:0}),r}(e.EventDispatcher);t.HtmlSoundChannel=i,e.registerClass(i,"egret.web.HtmlSoundChannel",["egret.SoundChannel","egret.IEventDispatcher"])}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(i){function r(){i.call(this),this.loaded=!1}__extends(r,i);var n=__define,a=r,s=a.prototype;return s.load=function(i){var r=this;this.url=i,QZAppExternal.preloadSound(function(t){0==t.code?(r.loaded=!0,r.dispatchEventWith(e.Event.COMPLETE)):r.dispatchEventWith(e.IOErrorEvent.IO_ERROR)},{bid:-1,url:t.Html5Capatibility._QQRootPath+i,refresh:1})},n(s,"length",function(){throw new Error("qq sound not supported!")}),s.play=function(i,r){i=+i||0,r=+r||0;var n=new t.QQSoundChannel;return n.$url=this.url,n.$loops=r,n.$type=this.type,n.$startTime=i,n.$play(),e.sys.$pushSoundChannel(n),n},s.close=function(){},r.MUSIC="music",r.EFFECT="effect",r}(e.EventDispatcher);t.QQSound=i,e.registerClass(i,"egret.web.QQSound",["egret.Sound"])}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(t){function i(){var i=this;t.call(this),this.$startTime=0,this.isStopped=!1,this.onPlayEnd=function(){return 1==i.$loops?(i.stop(),void i.dispatchEventWith(e.Event.SOUND_COMPLETE)):(i.$loops>0&&i.$loops--,void i.$play())},this._startTime=0}__extends(i,t);var r=__define,n=i,a=n.prototype;return a.$play=function(){if(this.isStopped)return void e.$error(1036);var t=this;this._startTime=Date.now();var i=0;i=t.$loops>0?t.$loops-1:-1,this.$type==e.Sound.EFFECT?QZAppExternal.playLocalSound(function(){},{bid:-1,url:t.$url,loop:i}):QZAppExternal.playLocalBackSound(function(){},{bid:-1,url:t.$url,loop:i})},a.stop=function(){this.$type==e.Sound.EFFECT?QZAppExternal.stopSound():QZAppExternal.stopBackSound(),this.isStopped||e.sys.$popSoundChannel(this),this.isStopped=!0},r(a,"volume",function(){return 1},function(){return this.isStopped?void e.$error(1036):void 0}),r(a,"position",function(){return(Date.now()-this._startTime)/1e3}),i}(e.EventDispatcher);t.QQSoundChannel=i,e.registerClass(i,"egret.web.QQSoundChannel",["egret.SoundChannel","egret.IEventDispatcher"])}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(){function e(){}var t=e;return t.prototype,e.decodeAudios=function(){if(!(e.decodeArr.length<=0||e.isDecoding)){e.isDecoding=!0;var t=e.decodeArr.shift();e.ctx.decodeAudioData(t.buffer,function(i){t.self.audioBuffer=i,t.success&&t.success(),e.isDecoding=!1,e.decodeAudios()},function(){alert("sound decode error: "+t.url+"\nsee http://edn.egret.com/cn/docs/page/156"),t.fail&&t.fail(),e.isDecoding=!1,e.decodeAudios()})}},e.canUseWebAudio=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,e.ctx=e.canUseWebAudio?new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext):void 0,e.decodeArr=[],e.isDecoding=!1,e}();t.WebAudioDecode=i,e.registerClass(i,"egret.web.WebAudioDecode");var r=function(r){function n(){r.call(this),this.loaded=!1}__extends(n,r);var a=__define,s=n,o=s.prototype;return a(o,"length",function(){if(this.audioBuffer)return this.audioBuffer.duration;throw new Error("sound not loaded!")}),o.load=function(t){function r(){a.loaded=!0,a.dispatchEventWith(e.Event.COMPLETE)}function n(){a.dispatchEventWith(e.IOErrorEvent.IO_ERROR)}var a=this;this.url=t;var s=new XMLHttpRequest;s.open("GET",t,!0),s.responseType="arraybuffer",s.onload=function(){i.decodeArr.push({buffer:s.response,success:r,fail:n,self:a,url:a.url}),i.decodeAudios()},s.send()},o.play=function(i,r){i=+i||0,r=+r||0;var n=new t.WebAudioSoundChannel;return n.$url=this.url,n.$loops=r,n.$audioBuffer=this.audioBuffer,n.$startTime=i,n.$play(),e.sys.$pushSoundChannel(n),n},o.close=function(){},n.MUSIC="music",n.EFFECT="effect",n}(e.EventDispatcher);t.WebAudioSound=r,e.registerClass(r,"egret.web.WebAudioSound",["egret.Sound"])}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(i){function r(){var r=this;i.call(this),this.$startTime=0,this.bufferSource=null,this.context=t.WebAudioDecode.ctx,this.isStopped=!1,this._currentTime=0,this._volume=1,this.onPlayEnd=function(){return 1==r.$loops?(r.stop(),void r.dispatchEventWith(e.Event.SOUND_COMPLETE)):(r.$loops>0&&r.$loops--,void r.$play())},this._startTime=0,this.gain=this.context.createGain?this.context.createGain():this.context.createGainNode()}__extends(r,i);var n=__define,a=r,s=a.prototype;return s.$play=function(){if(this.isStopped)return void e.$error(1036);this.bufferSource&&(this.bufferSource.onended=null,this.bufferSource=null);var t=this.context,i=this.gain,r=t.createBufferSource();this.bufferSource=r,r.buffer=this.$audioBuffer,r.connect(i),i.connect(t.destination),r.onended=this.onPlayEnd,this._startTime=Date.now(),this.gain.gain.value=this._volume,r.start(0,this.$startTime),this._currentTime=0},s.stop=function(){if(this.bufferSource){var t=this.bufferSource;t.stop?t.stop(0):t.noteOff(0),this.bufferSource.disconnect(),this.bufferSource=null,this.$audioBuffer=null}this.isStopped||e.sys.$popSoundChannel(this),this.isStopped=!0},n(s,"volume",function(){return this._volume},function(t){return this.isStopped?void e.$error(1036):(this._volume=t,void(this.gain.gain.value=t))}),n(s,"position",function(){return this.bufferSource?(Date.now()-this._startTime)/1e3+this.$startTime:0}),r}(e.EventDispatcher);t.WebAudioSoundChannel=i,e.registerClass(i,"egret.web.WebAudioSoundChannel",["egret.SoundChannel","egret.IEventDispatcher"])}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(t){function i(i,r){var n=this;void 0===r&&(r=!0),t.call(this),this.loaded=!1,this.closed=!1,this.heightSet=0/0,this.widthSet=0/0,this.isPlayed=!1,this.screenChanged=function(){var t=!!n.video.webkitDisplayingFullscreen;t||(n.checkFullScreen(!1),e.Capabilities.isMobile||(n._fullscreen=t))},this._fullscreen=!0,this.onVideoLoaded=function(){n.video.removeEventListener("canplay",n.onVideoLoaded);var t=n.video;n.loaded=!0,n.posterData&&(n.posterData.width=n.getPlayWidth(),n.posterData.height=n.getPlayHeight()),t.width=t.videoWidth,t.height=t.videoHeight,n.$invalidateContentBounds(),window.setTimeout(function(){n.dispatchEventWith(e.Event.COMPLETE)},200)},this.$renderNode=new e.sys.BitmapNode,this.src=i,this.once(e.Event.ADDED_TO_STAGE,this.loadPoster,this),i&&this.load()}__extends(i,t);var r=__define,n=i,a=n.prototype;return a.load=function(t,i){var r=this;if(void 0===i&&(i=!0),t=t||this.src,this.src=t,!this.video||this.video.src!=t){if(!this.video||e.Capabilities.isMobile){var n=document.createElement("video");this.video=n,n.controls=null}else n=this.video;n.src=t,n.setAttribute("autoplay","autoplay"),n.setAttribute("webkit-playsinline","true"),n.addEventListener("canplay",this.onVideoLoaded),n.addEventListener("error",function(){return r.onVideoError()}),n.addEventListener("ended",function(){return r.onVideoEnded()}),n.load(),n.play(),n.style.position="absolute",n.style.top="0px",n.style.zIndex="-88888",n.style.left="0px",n.height=1,n.width=1,window.setTimeout(function(){return n.pause()},170)}},a.play=function(t,i){var r=this;if(void 0===i&&(i=!1),0==this.loaded)return this.load(this.src),void this.once(e.Event.COMPLETE,function(){return r.play(t,i)},this);this.isPlayed=!0;var n=this.video;void 0!=t&&(n.currentTime=+t||0),n.loop=!!i,n.style.zIndex=e.Capabilities.isMobile?"-88888":"9999",n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.height=n.videoHeight,n.width=n.videoWidth,"Windows PC"!=e.Capabilities.os&&"Mac OS"!=e.Capabilities.os&&window.setTimeout(function(){n.width=0},1e3),this.checkFullScreen(this._fullscreen)},a.checkFullScreen=function(t){var i=this.video;if(t)null==i.parentElement&&(i.removeAttribute("webkit-playsinline"),document.body.appendChild(i)),e.stopTick(this.markDirty,this),this.goFullscreen();else if(null!=i.parentElement&&i.parentElement.removeChild(i),i.setAttribute("webkit-playsinline","true"),this.setFullScreenMonitor(!1),e.startTick(this.markDirty,this),e.Capabilities.isMobile)return this.video.currentTime=0,void this.onVideoEnded();i.play()},a.goFullscreen=function(){var t,i=this.video;return t=e.web.getPrefixStyleName("requestFullscreen",i),i[t]||(t=e.web.getPrefixStyleName("requestFullScreen",i),i[t])?(i.removeAttribute("webkit-playsinline"),i[t](),this.setFullScreenMonitor(!0),!0):!0},a.setFullScreenMonitor=function(e){var t=this.video;e?(t.addEventListener("mozfullscreenchange",this.screenChanged),t.addEventListener("webkitfullscreenchange",this.screenChanged),t.addEventListener("mozfullscreenerror",this.screenError),t.addEventListener("webkitfullscreenerror",this.screenError)):(t.removeEventListener("mozfullscreenchange",this.screenChanged),t.removeEventListener("webkitfullscreenchange",this.screenChanged),t.removeEventListener("mozfullscreenerror",this.screenError),t.removeEventListener("webkitfullscreenerror",this.screenError))},a.screenError=function(){e.$error(3014)},a.exitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.oCancelFullScreen?document.oCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()},a.onVideoEnded=function(){this.pause(),this.isPlayed=!1,this.$invalidateContentBounds(),this.dispatchEventWith(e.Event.ENDED)},a.onVideoError=function(){this.dispatchEventWith(e.IOErrorEvent.IO_ERROR)},a.close=function(){var e=this;this.closed=!0,this.video.removeEventListener("canplay",this.onVideoLoaded),this.video.removeEventListener("error",function(){return e.onVideoError()}),this.video.removeEventListener("ended",function(){return e.onVideoEnded()}),this.pause(),0==this.loaded&&this.video&&(this.video.src=""),this.video&&this.video.parentElement&&(this.video.parentElement.removeChild(this.video),this.video=null),this.loaded=!1},a.pause=function(){this.video&&this.video.pause(),e.stopTick(this.markDirty,this),this.$invalidate()},r(a,"volume",function(){return this.video?this.video.volume:1},function(e){this.video&&(this.video.volume=e)}),r(a,"position",function(){return this.video?this.video.currentTime:0},function(e){this.video&&(this.video.currentTime=e)}),r(a,"fullscreen",function(){return this._fullscreen},function(t){e.Capabilities.isMobile||(this._fullscreen=!!t,this.video&&0==this.video.paused&&this.checkFullScreen(this._fullscreen))}),r(a,"bitmapData",function(){return this.video&&this.loaded?(this._bitmapData||(this.video.width=this.video.videoWidth,this.video.height=this.video.videoHeight,this._bitmapData=new e.BitmapData(this.video),this._bitmapData.$deleteSource=!1),this._bitmapData):null}),a.loadPoster=function(){var t=this,i=this.poster;if(i){var r=new e.ImageLoader;r.once(e.Event.COMPLETE,function(){r.data,t.posterData=r.data,t.posterData.width=t.getPlayWidth(),t.posterData.height=t.getPlayHeight(),t.$invalidateContentBounds()},this),r.load(i)}},a.$measureContentBounds=function(e){var t=this.bitmapData,i=this.posterData;t?e.setTo(0,0,this.getPlayWidth(),this.getPlayHeight()):i?e.setTo(0,0,this.getPlayWidth(),this.getPlayHeight()):e.setEmpty()},a.getPlayWidth=function(){return isNaN(this.widthSet)?this.bitmapData?this.bitmapData.width:this.posterData?this.posterData.width:0/0:this.widthSet},a.getPlayHeight=function(){return isNaN(this.heightSet)?this.bitmapData?this.bitmapData.height:this.posterData?this.posterData.height:0/0:this.heightSet},a.$render=function(){var t=this.$renderNode,i=this.bitmapData,r=this.posterData,n=this.getPlayWidth(),a=this.getPlayHeight();this.isPlayed&&!e.Capabilities.isMobile||!r?this.isPlayed&&i&&(t.image=i,e.WebGLUtils.deleteWebGLTexture(i.webGLTexture),i.webGLTexture=null,t.drawImage(0,0,i.width,i.height,0,0,n,a)):(t.image=r,t.drawImage(0,0,r.width,r.height,0,0,n,a))},a.markDirty=function(){return this.$invalidate(),!0},a.$setHeight=function(e){return this.heightSet=+e||0,this.$invalidate(),this.$invalidateContentBounds(),t.prototype.$setHeight.call(this,e)},a.$setWidth=function(e){return this.widthSet=+e||0,this.$invalidate(),this.$invalidateContentBounds(),t.prototype.$setWidth.call(this,e)},r(a,"paused",function(){return this.video?this.video.paused:!0}),r(a,"length",function(){if(this.video)return this.video.duration;throw new Error("Video not loaded!")}),i}(e.DisplayObject);t.WebVideo=i,e.registerClass(i,"egret.web.WebVideo",["egret.Video"]),e.Video=i}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(t){function i(){t.call(this),this._url="",this._method=""}__extends(i,t);var r=__define,n=i,a=n.prototype;return r(a,"response",function(){if(!this._xhr)return null;if(void 0!=this._xhr.response)return this._xhr.response;if("text"==this._responseType)return this._xhr.responseText;if("arraybuffer"==this._responseType&&/msie 9.0/i.test(navigator.userAgent)){var e=window;return e.convertResponseBodyToText(this._xhr.responseBody)}return"document"==this._responseType?this._xhr.responseXML:null}),r(a,"responseType",function(){return this._responseType},function(e){this._responseType=e}),r(a,"withCredentials",function(){return this._withCredentials},function(e){this._withCredentials=e}),a.getXHR=function(){return window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")},a.open=function(e,t){void 0===t&&(t="GET"),this._url=e,this._method=t,this._xhr&&(this._xhr.abort(),this._xhr=null),this._xhr=this.getXHR(),this._xhr.onreadystatechange=this.onReadyStateChange.bind(this),this._xhr.onprogress=this.updateProgress.bind(this),this._xhr.open(this._method,this._url,!0)},a.send=function(e){if(null!=this._responseType&&(this._xhr.responseType=this._responseType),null!=this._withCredentials&&(this._xhr.withCredentials=this._withCredentials),this.headerObj)for(var t in this.headerObj)this._xhr.setRequestHeader(t,this.headerObj[t]);this._xhr.send(e)},a.abort=function(){this._xhr&&this._xhr.abort()},a.getAllResponseHeaders=function(){if(!this._xhr)return null;var e=this._xhr.getAllResponseHeaders();return e?e:""},a.setRequestHeader=function(e,t){this.headerObj||(this.headerObj={}),this.headerObj[e]=t},a.getResponseHeader=function(e){if(!this._xhr)return null;var t=this._xhr.getResponseHeader(e);return t?t:""},a.onReadyStateChange=function(){var t=this._xhr;if(4==t.readyState){var i=t.status>=400||0==t.status,r=(this._url,this);window.setTimeout(function(){r.dispatchEventWith(i?e.IOErrorEvent.IO_ERROR:e.Event.COMPLETE)},0)}},a.updateProgress=function(t){t.lengthComputable&&e.ProgressEvent.dispatchProgressEvent(this,e.ProgressEvent.PROGRESS,t.loaded,t.total)},i}(e.EventDispatcher);t.WebHttpRequest=i,e.registerClass(i,"egret.web.WebHttpRequest",["egret.HttpRequest"]),e.HttpRequest=i}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=window.URL||window.webkitURL,r=function(r){function n(){r.apply(this,arguments),this.data=null,this._crossOrigin=null,this._hasCrossOriginSet=!1,this.currentImage=null,this.request=null}__extends(n,r);var a=__define,s=n,o=s.prototype;return a(o,"crossOrigin",function(){return this._crossOrigin},function(e){this._hasCrossOriginSet=!0,this._crossOrigin=e}),o.load=function(i){if(t.Html5Capatibility._canUseBlob&&0!=i.indexOf("wxLocalResource:")&&0!=i.indexOf("data:")&&0!=i.indexOf("http:")&&0!=i.indexOf("https:")){var r=this.request;r||(r=this.request=new e.web.WebHttpRequest,r.addEventListener(e.Event.COMPLETE,this.onBlobLoaded,this),r.addEventListener(e.IOErrorEvent.IO_ERROR,this.onBlobError,this),r.responseType="blob"),r.open(i),r.send()}else this.loadImage(i)},o.onBlobLoaded=function(){var e=this.request.response;this.loadImage(i.createObjectURL(e))},o.onBlobError=function(){this.dispatchIOError(this.currentURL)},o.loadImage=function(e){var t=new Image;this.data=null,this.currentImage=t,this._hasCrossOriginSet?this._crossOrigin&&(t.crossOrigin=this._crossOrigin):n.crossOrigin&&(t.crossOrigin=n.crossOrigin),t.onload=this.onImageComplete.bind(this),t.onerror=this.onLoadError.bind(this),t.src=e},o.onImageComplete=function(t){var i=this.getImage(t);if(i){this.data=new e.BitmapData(i);var r=this;window.setTimeout(function(){r.dispatchEventWith(e.Event.COMPLETE)},0)}},o.onLoadError=function(e){var t=this.getImage(e);t&&this.dispatchIOError(t.src)},o.dispatchIOError=function(){var t=this;window.setTimeout(function(){t.dispatchEventWith(e.IOErrorEvent.IO_ERROR)},0)},o.getImage=function(t){var r=t.target,n=r.src;if(0==n.indexOf("blob:"))try{i.revokeObjectURL(r.src)}catch(a){e.$warn(1037)}return r.onerror=null,r.onload=null,this.currentImage!==r?null:(this.currentImage=null,r)},n.crossOrigin=null,n}(e.EventDispatcher);t.WebImageLoader=r,e.registerClass(r,"egret.web.WebImageLoader",["egret.ImageLoader"]),e.ImageLoader=r}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(i){function r(){i.call(this),this._isNeedShow=!1,this.inputElement=null,this.inputDiv=null,this._gscaleX=0,this._gscaleY=0,this._isNeesHide=!1,this.textValue="",this.colorValue=16777215,this._styleInfoes={}}__extends(r,i);var n=r,a=n.prototype;return a.$setTextField=function(e){return this.$textfield=e,!0},a.$addToStage=function(){this.htmlInput=e.web.$getTextAdapter(this.$textfield)},a._initElement=function(){var t=this.$textfield.localToGlobal(0,0),i=t.x,r=t.y,n=this.htmlInput.$scaleX,a=this.htmlInput.$scaleY;this.inputDiv.style.left=i*n+"px",this.inputDiv.style.top=r*a+"px",this.$textfield.multiline&&this.$textfield.height>this.$textfield.size?(this.inputDiv.style.top=r*a+"px",this.inputElement.style.top=-this.$textfield.lineSpacing/2*a+"px"):(this.inputDiv.style.top=r*a+"px",this.inputElement.style.top="0px");for(var s=this.$textfield,o=1,h=1,l=0;s.parent;)o*=s.scaleX,h*=s.scaleY,l+=s.rotation,s=s.parent;var u=e.web.getPrefixStyleName("transform");this.inputDiv.style[u]="rotate("+l+"deg)",this._gscaleX=n*o,this._gscaleY=a*h},a.$show=function(){this.htmlInput.isCurrentStageText(this)?this.inputElement.onblur=null:(this.inputElement=this.htmlInput.getInputElement(this),this.inputElement.type=this.$textfield.multiline?"text":this.$textfield.inputType,this.inputDiv=this.htmlInput._inputDIV),this.htmlInput._needShow=!0,this._isNeedShow=!0,this._initElement()},a.onBlurHandler=function(){this.htmlInput.clearInputElement(),window.scrollTo(0,0)},a.executeShow=function(){this.inputElement.value=this.$getText(),null==this.inputElement.onblur&&(this.inputElement.onblur=this.onBlurHandler.bind(this)),this.$resetStageText(),this.$textfield.maxChars>0?this.inputElement.setAttribute("maxlength",this.$textfield.maxChars):this.inputElement.removeAttribute("maxlength"),this.inputElement.selectionStart=this.inputElement.value.length,this.inputElement.selectionEnd=this.inputElement.value.length,this.inputElement.focus()},a.$hide=function(){this._isNeesHide=!0,this.htmlInput&&e.web.Html5Capatibility._System_OS==e.web.SystemOSType.IOS&&this.htmlInput.disconnectStageText(this)},a.$getText=function(){return this.textValue||(this.textValue=""),this.textValue},a.$setText=function(e){return this.textValue=e,this.resetText(),!0},a.resetText=function(){this.inputElement&&(this.inputElement.value=this.textValue)},a.$setColor=function(e){return this.colorValue=e,this.resetColor(),!0},a.resetColor=function(){this.inputElement&&this.setElementStyle("color",e.toColorString(this.colorValue))},a.$onBlur=function(){t.Html5Capatibility._System_OS==t.SystemOSType.WPHONE&&e.Event.dispatchEvent(this,"updateText",!1)},a._onInput=function(){var i=this;if(t.Html5Capatibility._System_OS==t.SystemOSType.WPHONE){var r=this.$textfield.$TextField;null==r[35]&&null==r[36]?(i.textValue=i.inputElement.value,e.Event.dispatchEvent(i,"updateText",!1)):window.setTimeout(function(){i.inputElement&&i.inputElement.selectionStart&&i.inputElement.selectionEnd&&i.inputElement.selectionStart==i.inputElement.selectionEnd&&(i.textValue=i.inputElement.value,e.Event.dispatchEvent(i,"updateText",!1))},0)}else window.setTimeout(function(){i.inputElement&&i.inputElement.selectionStart==i.inputElement.selectionEnd&&(i.textValue=i.inputElement.value,e.Event.dispatchEvent(i,"updateText",!1))},0)},a.setAreaHeight=function(){var t=this.$textfield;if(t.multiline){var i=e.TextFieldUtils.$getTextHeight(t);if(t.height<=t.size)this.setElementStyle("height",t.size*this._gscaleY+"px"),this.setElementStyle("padding","0px"),this.setElementStyle("lineHeight",t.size*this._gscaleY+"px");else if(t.height<i)this.setElementStyle("height",t.height*this._gscaleY+"px"),this.setElementStyle("padding","0px"),this.setElementStyle("lineHeight",(t.size+t.lineSpacing)*this._gscaleY+"px");else{this.setElementStyle("height",(i+t.lineSpacing)*this._gscaleY+"px");var r=(t.height-i)*this._gscaleY,n=e.TextFieldUtils.$getValign(t),a=r*n,s=r-a;this.setElementStyle("padding",a+"px 0px "+s+"px 0px"),this.setElementStyle("lineHeight",(t.size+t.lineSpacing)*this._gscaleY+"px")}}},a._onClickHandler=function(t){this._isNeedShow&&(t.stopImmediatePropagation(),this._isNeedShow=!1,this.executeShow(),this.dispatchEvent(new e.Event("focus")))},a._onDisconnect=function(){this.inputElement=null,this.dispatchEvent(new e.Event("blur"))},a.setElementStyle=function(e,t){this.inputElement&&this._styleInfoes[e]!=t&&(this.inputElement.style[e]=t)},a.$removeFromStage=function(){this.inputElement&&this.htmlInput.disconnectStageText(this)},a.$resetStageText=function(){if(this.inputElement){var t=this.$textfield;if(this.setElementStyle("fontFamily",t.fontFamily),this.setElementStyle("fontStyle",t.italic?"italic":"normal"),this.setElementStyle("fontWeight",t.bold?"bold":"normal"),this.setElementStyle("textAlign",t.textAlign),this.setElementStyle("fontSize",t.size*this._gscaleY+"px"),this.setElementStyle("color",e.toColorString(t.textColor)),t.stage){var i=t.localToGlobal(0,0).x;i=Math.min(t.width,t.stage.stageWidth-i)}else i=t.width;if(this.setElementStyle("width",i*this._gscaleX+"px"),this.setElementStyle("verticalAlign",t.verticalAlign),t.multiline)this.setAreaHeight();else if(this.setElementStyle("lineHeight",t.size*this._gscaleY+"px"),t.height<t.size){this.setElementStyle("height",t.size*this._gscaleY+"px");var r=t.size/2*this._gscaleY;this.setElementStyle("padding","0px 0px "+r+"px 0px")}else{this.setElementStyle("height",t.size*this._gscaleY+"px");var n=(t.height-t.size)*this._gscaleY,a=e.TextFieldUtils.$getValign(t),s=n*a,r=n-s;r<t.size/2*this._gscaleY&&(r=t.size/2*this._gscaleY),this.setElementStyle("padding",s+"px 0px "+r+"px 0px")}this.inputDiv.style.clip="rect(0px "+t.width*this._gscaleX+"px "+t.height*this._gscaleY+"px 0px)",this.inputDiv.style.height=t.height*this._gscaleY+"px",this.inputDiv.style.width=i*this._gscaleX+"px"}},r}(e.EventDispatcher);t.HTML5StageText=i,e.registerClass(i,"egret.web.HTML5StageText",["egret.StageText"]),e.StageText=i}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(){function t(){this._needShow=!1,this.$scaleX=1,this.$scaleY=1}var i=t,r=i.prototype;return r.isInputOn=function(){return null!=this._stageText},r.isCurrentStageText=function(e){return this._stageText==e},r.initValue=function(e){e.style.position="absolute",e.style.left="0px",e.style.top="0px",e.style.border="none",e.style.padding="0"},r.$updateSize=function(){if(this.canvas){var t=this.canvas.width,i=this.canvas.height,r=this.canvas.style.width.split("px")[0],n=this.canvas.style.height.split("px")[0];this.$scaleX=r/t,this.$scaleY=n/i,this.StageDelegateDiv.style.left=this.canvas.style.left,this.StageDelegateDiv.style.top=this.canvas.style.top;var a=e.web.getPrefixStyleName("transform");this.StageDelegateDiv.style[a]=this.canvas.style[a],this.StageDelegateDiv.style[e.web.getPrefixStyleName("transformOrigin")]="0% 0% 0px"}},r._initStageDelegateDiv=function(t,i){this.canvas=i;var r,n=this;r||(r=document.createElement("div"),this.StageDelegateDiv=r,r.id="StageDelegateDiv",t.appendChild(r),n.initValue(r),n._inputDIV=document.createElement("div"),n.initValue(n._inputDIV),n._inputDIV.style.width="0px",n._inputDIV.style.height="0px",n._inputDIV.style.left="0px",n._inputDIV.style.top="-100px",n._inputDIV.style[e.web.getPrefixStyleName("transformOrigin")]="0% 0% 0px",r.appendChild(n._inputDIV),this.canvas.addEventListener("click",function(e){n._needShow?(n._needShow=!1,n._stageText._onClickHandler(e),n.show()):n._inputElement&&(n.clearInputElement(),n._inputElement.blur(),n._inputElement=null)}),n.initInputElement(!0),n.initInputElement(!1))},r.initInputElement=function(e){var t,i=this;e?(t=document.createElement("textarea"),t.style.resize="none",i._multiElement=t,t.id="egretTextarea"):(t=document.createElement("input"),i._simpleElement=t,t.id="egretInput"),t.type="text",i._inputDIV.appendChild(t),t.setAttribute("tabindex","-1"),t.style.width="1px",t.style.height="12px",i.initValue(t),t.style.outline="thin",t.style.background="none",t.style.overflow="hidden",t.style.wordBreak="break-all",t.style.opacity=0,t.oninput=function(){i._stageText&&i._stageText._onInput()}},r.show=function(){var t=this,i=t._inputElement;e.$callAsync(function(){i.style.opacity=1},t)},r.disconnectStageText=function(e){(null==this._stageText||this._stageText==e)&&(this.clearInputElement(),this._inputElement&&this._inputElement.blur())},r.clearInputElement=function(){var e=this;if(e._inputElement){e._inputElement.value="",e._inputElement.onblur=null,e._inputElement.style.width="1px",e._inputElement.style.height="12px",e._inputElement.style.left="0px",e._inputElement.style.top="0px",e._inputElement.style.opacity=0;var t;t=e._simpleElement==e._inputElement?e._multiElement:e._simpleElement,t.style.display="block",e._inputDIV.style.left="0px",e._inputDIV.style.top="-100px",e._inputDIV.style.height="0px",e._inputDIV.style.width="0px"}e._stageText&&(e._stageText._onDisconnect(),e._stageText=null,this.canvas.userTyping=!1)},r.getInputElement=function(e){var t=this;t.clearInputElement(),t._stageText=e,this.canvas.userTyping=!0,t._inputElement=t._stageText.$textfield.multiline?t._multiElement:t._simpleElement;var i;return i=t._simpleElement==t._inputElement?t._multiElement:t._simpleElement,i.style.display="none",t._inputElement},t}();t.HTMLInput=i,e.registerClass(i,"egret.web.HTMLInput")}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(e){function t(e){var t=e.stage?e.stage.$hashCode:0,i=r[t],s=n[t],o=a[t];return s&&o&&(delete n[t],delete a[t]),i}function i(e,t,i,s){e._initStageDelegateDiv(i,s),r[t.$hashCode]=e,n[t.$hashCode]=s,a[t.$hashCode]=i}var r={},n={},a={};e.$getTextAdapter=t,e.$cacheTextAdapter=i}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(){function t(e,t,a,s,o){r||i();var h="";o&&(h+="italic "),s&&(h+="bold "),h+=(a||12)+"px ",h+=t||"Arial";var l=0,u=n[h]||(n[h]={});r.font=h;for(var c=e.length,d=0;c>d;d++){var f=e.charCodeAt(d),v=u[f]||(u[f]=r.measureText(e.charAt(d)).width);l+=v}return l}function i(){r=e.sys.canvasHitTestBuffer.context,r.textAlign="left",r.textBaseline="middle"}var r=null,n={};e.sys.measureText=t}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function i(e,t){var i=document.createElement("canvas");isNaN(e)||isNaN(t)||(i.width=e,i.height=t);var r=i.getContext("2d");if(void 0===r.imageSmoothingEnabled){for(var n=["webkitImageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled"],a=n.length-1;a>=0;a--){var s=n[a];if(void 0!==r[s])break}try{Object.defineProperty(r,"imageSmoothingEnabled",{get:function(){return this[s]},set:function(e){this[s]=e}})}catch(o){r.imageSmoothingEnabled=r[s]}}return i}var r,n=function(){function e(e,t){this.surface=i(e,t),this.context=this.surface.getContext("2d")}var t=__define,n=e,a=n.prototype;return t(a,"width",function(){return this.surface.width}),t(a,"height",function(){return this.surface.height}),a.resize=function(e,t,i){var r=this.surface;if(i){var n=!1;r.width<e&&(r.width=e,n=!0),r.height<t&&(r.height=t,n=!0),n||(this.context.globalCompositeOperation="source-over",this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1)
}else r.width!=e&&(r.width=e),r.height!=t&&(r.height=t);this.clear()},a.resizeTo=function(e,t,n,a){r||(r=i());var s=(this.context,this.surface),o=r,h=o.getContext("2d");r=s,this.context=h,this.surface=o,o.width=Math.max(e,257),o.height=Math.max(t,257),h.setTransform(1,0,0,1,0,0),h.drawImage(s,n,a),s.height=1,s.width=1},a.setDirtyRegionPolicy=function(){},a.beginClip=function(e,t,i){t=+t||0,i=+i||0;var r=this.context;r.save(),r.beginPath(),r.setTransform(1,0,0,1,t,i);for(var n=e.length,a=0;n>a;a++){var s=e[a];r.clearRect(s.minX,s.minY,s.width,s.height),r.rect(s.minX,s.minY,s.width,s.height)}r.clip()},a.endClip=function(){this.context.restore()},a.getPixel=function(e,t){return this.context.getImageData(e,t,1,1).data},a.toDataURL=function(e,t){return this.surface.toDataURL(e,t)},a.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.surface.width,this.surface.height)},a.destroy=function(){this.surface.width=this.surface.height=0},e}();t.CanvasRenderBuffer=n,e.registerClass(n,"egret.web.CanvasRenderBuffer",["egret.sys.RenderBuffer"])}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(t){function i(i,r){var n=this;t.call(this),this.onTouchBegin=function(e){var t=n.getLocation(e);n.touch.onTouchBegin(t.x,t.y,e.identifier)},this.onTouchMove=function(e){var t=n.getLocation(e);n.touch.onTouchMove(t.x,t.y,e.identifier)},this.onTouchEnd=function(e){var t=n.getLocation(e);n.touch.onTouchEnd(t.x,t.y,e.identifier)},this.scaleX=1,this.scaleY=1,this.rotation=0,this.canvas=r,this.touch=new e.sys.TouchHandler(i),this.addListeners()}__extends(i,t);var r=i,n=r.prototype;return n.addListeners=function(){var t=this;window.navigator.msPointerEnabled?(this.canvas.addEventListener("MSPointerDown",function(e){e.identifier=e.pointerId,t.onTouchBegin(e),t.prevent(e)},!1),this.canvas.addEventListener("MSPointerMove",function(e){e.identifier=e.pointerId,t.onTouchMove(e),t.prevent(e)},!1),this.canvas.addEventListener("MSPointerUp",function(e){e.identifier=e.pointerId,t.onTouchEnd(e),t.prevent(e)},!1)):(e.Capabilities.$isMobile||this.addMouseListener(),this.addTouchListener())},n.addMouseListener=function(){this.canvas.addEventListener("mousedown",this.onTouchBegin),this.canvas.addEventListener("mousemove",this.onTouchMove),this.canvas.addEventListener("mouseup",this.onTouchEnd)},n.addTouchListener=function(){var e=this;this.canvas.addEventListener("touchstart",function(t){for(var i=t.changedTouches.length,r=0;i>r;r++)e.onTouchBegin(t.changedTouches[r]);e.prevent(t)},!1),this.canvas.addEventListener("touchmove",function(t){for(var i=t.changedTouches.length,r=0;i>r;r++)e.onTouchMove(t.changedTouches[r]);e.prevent(t)},!1),this.canvas.addEventListener("touchend",function(t){for(var i=t.changedTouches.length,r=0;i>r;r++)e.onTouchEnd(t.changedTouches[r]);e.prevent(t)},!1),this.canvas.addEventListener("touchcancel",function(t){for(var i=t.changedTouches.length,r=0;i>r;r++)e.onTouchEnd(t.changedTouches[r]);e.prevent(t)},!1)},n.prevent=function(e){e.stopPropagation(),1==e.isScroll||this.canvas.userTyping||e.preventDefault()},n.getLocation=function(t){t.identifier=+t.identifier||0;var i=document.documentElement,r=this.canvas.getBoundingClientRect(),n=r.left+window.pageXOffset-i.clientLeft,a=r.top+window.pageYOffset-i.clientTop,s=t.pageX-n,o=s,h=t.pageY-a,l=h;return 90==this.rotation?(o=h,l=r.width-s):-90==this.rotation&&(o=r.height-h,l=s),o/=this.scaleX,l/=this.scaleY,e.$TempPoint.setTo(Math.round(o),Math.round(l))},n.updateScaleMode=function(e,t,i){this.scaleX=e,this.scaleY=t,this.rotation=i},n.$updateMaxTouches=function(){this.touch.$initMaxTouches()},i}(e.HashObject);t.WebTouchHandler=i,e.registerClass(i,"egret.web.WebTouchHandler")}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(t){function i(e){t.call(this),this.isActivate=!0,this.stage=e,this.registerListener()}__extends(i,t);var r=i,n=r.prototype;return n.registerListener=function(){var t=this,i=function(){t.isActivate&&(t.isActivate=!1,t.stage.dispatchEvent(new e.Event(e.Event.DEACTIVATE)))},r=function(){t.isActivate||(t.isActivate=!0,t.stage.dispatchEvent(new e.Event(e.Event.ACTIVATE)))},n=function(){document[a]?i():r()};window.addEventListener("focus",r,!1),window.addEventListener("blur",i,!1);var a,s;"undefined"!=typeof document.hidden?(a="hidden",s="visibilitychange"):"undefined"!=typeof document.mozHidden?(a="mozHidden",s="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(a="msHidden",s="msvisibilitychange"):"undefined"!=typeof document.webkitHidden?(a="webkitHidden",s="webkitvisibilitychange"):"undefined"!=typeof document.oHidden&&(a="oHidden",s="ovisibilitychange"),"onpageshow"in window&&"onpagehide"in window&&(window.addEventListener("pageshow",r,!1),window.addEventListener("pagehide",i,!1)),a&&s&&document.addEventListener(s,n,!1);var o=navigator.userAgent,h=/micromessenger/gi.test(o),l=/mqq/gi.test(o),u=/mobile.*qq/gi.test(o);if((u||h)&&(l=!1),l){var c=window.browser||{};c.execWebFn=c.execWebFn||{},c.execWebFn.postX5GamePlayerMessage=function(e){var t=e.type;"app_enter_background"==t?i():"app_enter_foreground"==t&&r()},window.browser=c}},i}(e.HashObject);t.WebHideHandler=i,e.registerClass(i,"egret.web.WebHideHandler")}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function i(e,t){var i="";if(null!=t)i=r(e,t);else{if(null==o){var n=document.createElement("div").style;o=r("transform",n)}i=o}return""==i?e:i+e.charAt(0).toUpperCase()+e.substring(1,e.length)}function r(e,t){if(e in t)return"";e=e.charAt(0).toUpperCase()+e.substring(1,e.length);for(var i=["webkit","ms","Moz","O"],r=0;r<i.length;r++){var n=i[r]+e;if(n in t)return i[r]}return""}var n=function(){function e(){}var t=e;return t.prototype,e.QQ_AUDIO=1,e.WEB_AUDIO=2,e.HTML5_AUDIO=3,e}();t.AudioType=n,e.registerClass(n,"egret.web.AudioType");var a=function(){function e(){}var t=e;return t.prototype,e.WPHONE=1,e.IOS=2,e.ADNROID=3,e}();t.SystemOSType=a,e.registerClass(a,"egret.web.SystemOSType");var s=function(t){function i(){t.call(this)}__extends(i,t);var r=i;return r.prototype,i.$init=function(){var t=navigator.userAgent.toLowerCase();i.ua=t,e.Capabilities.$isMobile=-1!=t.indexOf("mobile")||-1!=t.indexOf("android"),i._canUseBlob=!1;var r,s=i._audioType,o=window.AudioContext||window.webkitAudioContext||window.mozAudioContext;if(1==s||2==s||3==s?(r=!1,i.setAudioType(s)):(r=!0,i.setAudioType(n.HTML5_AUDIO)),t.indexOf("windows phone")>=0)i._System_OS=a.WPHONE,e.Capabilities.$os="Windows Phone";else if(t.indexOf("android")>=0){if(e.Capabilities.$os="Android",i._System_OS=a.ADNROID,i.setAudioType(o?n.WEB_AUDIO:n.HTML5_AUDIO),window.hasOwnProperty("QZAppExternal")&&t.indexOf("qzone")>=0){i.setAudioType(n.QQ_AUDIO);var h=document.getElementsByTagName("base");if(h&&h.length>0)i._QQRootPath=h[0].baseURI;else{var l=window.location.href.indexOf("?");-1==l&&(l=window.location.href.length);var u=window.location.href.substring(0,l);u=u.substring(0,u.lastIndexOf("/")),i._QQRootPath=u+"/"}}}else t.indexOf("iphone")>=0||t.indexOf("ipad")>=0||t.indexOf("ipod")>=0?(e.Capabilities.$os="iOS",i._System_OS=a.IOS,i.getIOSVersion()>=7&&(i._canUseBlob=!0,i.setAudioType(n.WEB_AUDIO))):-1!=t.indexOf("windows nt")?e.Capabilities.$os="Windows PC":-1!=t.indexOf("mac os")&&(e.Capabilities.$os="Mac OS");var c=window.URL||window.webkitURL;c||(i._canUseBlob=!1),e.Sound=i._AudioClass},i.setAudioType=function(t){switch(i._audioType=t,t){case n.QQ_AUDIO:i._AudioClass=e.web.QQSound;break;case n.WEB_AUDIO:i._AudioClass=e.web.WebAudioSound;break;case n.HTML5_AUDIO:i._AudioClass=e.web.HtmlSound}},i.getIOSVersion=function(){var e=i.ua.toLowerCase().match(/cpu [^\d]*\d.*like mac os x/)[0];return parseInt(e.match(/\d+(_\d)*/)[0])||0},i.checkHtml5Support=function(){var t=(navigator.language||navigator.browserLanguage).toLowerCase(),i=t.split("-");i.length>1&&(i[1]=i[1].toUpperCase()),e.Capabilities.$language=i.join("-")},i._canUseBlob=!1,i._audioType=0,i._QQRootPath="",i._System_OS=0,i.ua="",i}(e.HashObject);t.Html5Capatibility=s,e.registerClass(s,"egret.web.Html5Capatibility");var o=null;t.getPrefixStyleName=i,t.getPrefix=r}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function i(){if(o)for(var e=document.querySelectorAll(".egret-player"),t=e.length,i=0;t>i;i++){var r=e[i],n=r["egret-player"];n.updateScreenSize()}}function r(i){if(!o){if(o=!0,i||(i={}),t.Html5Capatibility._audioType=i.audioType,t.Html5Capatibility.$init(),"webgl"==i.renderMode){var r=i.antialias;t.WebGLRenderContext.antialias=!!r}e.sys.CanvasRenderBuffer=t.CanvasRenderBuffer,n(i.renderMode);var s=e.sys.$ticker;a(s),i.screenAdapter?e.sys.screenAdapter=i.screenAdapter:e.sys.screenAdapter||(e.sys.screenAdapter=new e.sys.DefaultScreenAdapter);for(var h=document.querySelectorAll(".egret-player"),l=h.length,u=0;l>u;u++){var c=h[u],d=new t.WebPlayer(c,i);c["egret-player"]=d,"webgl"==i.renderMode&&(d.stage.dirtyRegionPolicy=e.DirtyRegionPolicy.OFF,e.sys.DisplayList.prototype.setDirtyRegionPolicy=function(){})}}}function n(i){"webgl"==i&&e.WebGLUtils.checkCanUseWebGL()?(e.sys.RenderBuffer=t.WebGLRenderBuffer,e.sys.systemRenderer=new t.WebGLRenderer,e.sys.canvasRenderer=new e.CanvasRenderer,e.sys.customHitTestBuffer=new t.WebGLRenderBuffer(3,3),e.sys.canvasHitTestBuffer=new t.CanvasRenderBuffer(3,3),e.Capabilities.$renderMode="webgl"):(e.sys.RenderBuffer=t.CanvasRenderBuffer,e.sys.systemRenderer=new e.CanvasRenderer,e.sys.canvasRenderer=e.sys.systemRenderer,e.sys.customHitTestBuffer=new t.CanvasRenderBuffer(3,3),e.sys.canvasHitTestBuffer=e.sys.customHitTestBuffer,e.Capabilities.$renderMode="canvas")}function a(e){function t(){e.update(),i.call(window,t)}var i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;i||(i=function(e){return window.setTimeout(e,1e3/60)}),i.call(window,t)}function s(){h=0/0,e.updateAllScreens()}var o=!1;window.isNaN=function(e){return e=+e,e!==e},e.runEgret=r,e.updateAllScreens=i;var h=0/0;window.addEventListener("resize",function(){isNaN(h)&&(h=window.setTimeout(s,300))})}(t=e.web||(e.web={}))}(egret||(egret={}));var language,egret;!function(e){var t;!function(t){var i=function(){function t(){}var i=t;return i.prototype,t.detect=function(){var i=e.Capabilities,r=navigator.userAgent.toLowerCase();i.$isMobile=-1!=r.indexOf("mobile")||-1!=r.indexOf("android"),i.$isMobile?r.indexOf("windows")<0&&(-1!=r.indexOf("iphone")||-1!=r.indexOf("ipad")||-1!=r.indexOf("ipod"))?i.$os="iOS":-1!=r.indexOf("android")&&-1!=r.indexOf("linux")?i.$os="Android":-1!=r.indexOf("windows")&&(i.$os="Windows Phone"):-1!=r.indexOf("windows nt")?i.$os="Windows PC":-1!=r.indexOf("mac os")&&(i.$os="Mac OS");var n=(navigator.language||navigator.browserLanguage).toLowerCase(),a=n.split("-");a.length>1&&(a[1]=a[1].toUpperCase()),i.$language=a.join("-"),t.injectUIntFixOnIE9()},t.injectUIntFixOnIE9=function(){if(/msie 9.0/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)){var e="<!-- IEBinaryToArray_ByteStr -->\r\n<script type='text/vbscript' language='VBScript'>\r\nFunction IEBinaryToArray_ByteStr(Binary)\r\n   IEBinaryToArray_ByteStr = CStr(Binary)\r\nEnd Function\r\nFunction IEBinaryToArray_ByteStr_Last(Binary)\r\n   Dim lastIndex\r\n   lastIndex = LenB(Binary)\r\n   if lastIndex mod 2 Then\r\n       IEBinaryToArray_ByteStr_Last = Chr( AscB( MidB( Binary, lastIndex, 1 ) ) )\r\n   Else\r\n       IEBinaryToArray_ByteStr_Last = \"\"\r\n   End If\r\nEnd Function\r\n</script>\r\n<!-- convertResponseBodyToText -->\r\n<script>\r\nvar convertResponseBodyToText = function (binary) {\r\n   var byteMapping = {};\r\n   for ( var i = 0; i < 256; i++ ) {\r\n       for ( var j = 0; j < 256; j++ ) {\r\n           byteMapping[ String.fromCharCode( i + j * 256 ) ] =\r\n           String.fromCharCode(i) + String.fromCharCode(j);\r\n       }\r\n   }\r\n   var rawBytes = IEBinaryToArray_ByteStr(binary);\r\n   var lastChr = IEBinaryToArray_ByteStr_Last(binary);\r\n   return rawBytes.replace(/[\\s\\S]/g,                           function( match ) { return byteMapping[match]; }) + lastChr;\r\n};\r\n</script>\r\n";document.write(e)}},t}();t.WebCapability=i,e.registerClass(i,"egret.web.WebCapability"),i.detect()}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(t){function i(i,r,n,a,s){if(t.call(this),this.showPanle=!0,this.fpsHeight=0,this.WIDTH=101,this.HEIGHT=20,this.bgCanvasColor="#18304b",this.fpsFrontColor="#18fefe",this.WIDTH_COST=33,this.cost1Color="#18fefe",this.cost2Color="#ffff00",this.cost3Color="#ff0000",this.arrFps=[],this.arrCost=[],this.arrLog=[],r||n){this.renderMode="canvas"==e.Capabilities.renderMode?"Canvas":"WebGL",this.panelX=void 0===s.x?0:parseInt(s.x),this.panelY=void 0===s.y?0:parseInt(s.y),this.fontColor=void 0===s.textColor?"#ffffff":s.textColor.replace("0x","#"),this.fontSize=void 0===s.size?12:parseInt(s.size),e.Capabilities.isMobile&&(this.fontSize-=2);var o=document.createElement("div");o.style.position="absolute",o.style.background="rgba(0,0,0,"+s.bgAlpha+")",o.style.left=this.panelX+"px",o.style.top=this.panelY+"px",o.style.pointerEvents="none",document.body.appendChild(o);var h=document.createElement("div");h.style.color=this.fontColor,h.style.fontSize=this.fontSize+"px",h.style.lineHeight=this.fontSize+"px",h.style.margin="4px 4px 4px 4px",this.container=h,o.appendChild(h),r&&this.addFps(),n&&this.addLog()}}__extends(i,t);var r=i,n=r.prototype;return n.addFps=function(){var e=document.createElement("div");e.style.display="inline-block",this.containerFps=e,this.container.appendChild(e);var t=document.createElement("div");t.style.paddingBottom="2px",this.fps=t,this.containerFps.appendChild(t),t.innerHTML="0 FPS "+this.renderMode+"<br/>min0 max0 avg0";var i=document.createElement("canvas");this.containerFps.appendChild(i),i.width=this.WIDTH,i.height=this.HEIGHT,this.canvasFps=i;var r=i.getContext("2d");this.contextFps=r,r.fillStyle=this.bgCanvasColor,r.fillRect(0,0,this.WIDTH,this.HEIGHT);var n=document.createElement("div");this.divDatas=n,this.containerFps.appendChild(n);var a=document.createElement("div");a.style["float"]="left",a.innerHTML="Draw<br/>Dirty<br/>Cost",n.appendChild(a);var s=document.createElement("div");s.style.paddingLeft=a.offsetWidth+20+"px",n.appendChild(s);var o=document.createElement("div");this.divDraw=o,o.innerHTML="0<br/>0<br/>",s.appendChild(o);var h=document.createElement("div");this.divCost=h,h.innerHTML='<font  style="color:'+this.cost1Color+'">0<font/> <font  style="color:'+this.cost2Color+'">0<font/> <font  style="color:'+this.cost3Color+'">0<font/>',s.appendChild(h);var i=document.createElement("canvas");this.canvasCost=i,this.containerFps.appendChild(i),i.width=this.WIDTH,i.height=this.HEIGHT;var r=i.getContext("2d");this.contextCost=r,r.fillStyle=this.bgCanvasColor,r.fillRect(0,0,this.WIDTH,this.HEIGHT),r.fillStyle="#000000",r.fillRect(this.WIDTH_COST,0,1,this.HEIGHT),r.fillRect(2*this.WIDTH_COST+1,0,1,this.HEIGHT),this.fpsHeight=this.container.offsetHeight},n.addLog=function(){var e=document.createElement("div");e.style.maxWidth=document.body.clientWidth-8-this.panelX+"px",e.style.wordWrap="break-word",this.log=e,this.container.appendChild(e)},n.update=function(e,t){if(void 0===t&&(t=!1),t)i=this.arrFps[this.arrFps.length-1],r=this.arrCost[this.arrCost.length-1][0],n=this.arrCost[this.arrCost.length-1][1],a=this.arrCost[this.arrCost.length-1][2];else{var i=e.fps,r=e.costTicker,n=e.costDirty,a=e.costRender;this.lastNumDraw=e.draw,this.lastNumDirty=e.dirty,this.arrFps.push(i),this.arrCost.push([r,n,a])}var s=0,o=this.arrFps.length;o>101&&(o=101,this.arrFps.shift());for(var h=this.arrFps[0],l=this.arrFps[0],u=0;o>u;u++){var c=this.arrFps[u];s+=c,h>c?h=c:c>l&&(l=c)}var d=this.WIDTH,f=this.HEIGHT,v=this.contextFps;v.drawImage(this.canvasFps,1,0,d-1,f,0,0,d-1,f),v.fillStyle=this.bgCanvasColor,v.fillRect(d-1,0,1,f);var p=Math.floor(i/60*20);1>p&&(p=1),v.fillStyle=this.fpsFrontColor,v.fillRect(d-1,20-p,1,p);var g=this.WIDTH_COST,v=this.contextCost;v.drawImage(this.canvasCost,1,0,g-1,f,0,0,g-1,f),v.drawImage(this.canvasCost,g+2,0,g-1,f,g+1,0,g-1,f),v.drawImage(this.canvasCost,2*g+3,0,g-1,f,2*g+2,0,g-1,f);var m=Math.floor(r/2);1>m?m=1:m>20&&(m=20);var x=Math.floor(n/2);1>x?x=1:x>20&&(x=20);var b=Math.floor(a/2);1>b?b=1:b>20&&(b=20),v.fillStyle=this.bgCanvasColor,v.fillRect(g-1,0,1,f),v.fillRect(2*g,0,1,f),v.fillRect(3*g+1,0,1,f),v.fillStyle=this.cost1Color,v.fillRect(g-1,20-m,1,m),v.fillStyle=this.cost2Color,v.fillRect(2*g,20-x,1,x),v.fillStyle=this.cost3Color,v.fillRect(3*g+1,20-b,1,b);var w=Math.floor(s/o),y=i+" FPS "+this.renderMode;this.showPanle&&(y+="<br/>min"+h+" max"+l+" avg"+w,this.divDraw.innerHTML=this.lastNumDraw+"<br/>"+this.lastNumDirty+"%<br/>",this.divCost.innerHTML='<font  style="color:#18fefe">'+r+'<font/> <font  style="color:#ffff00">'+n+'<font/> <font  style="color:#ff0000">'+a+"<font/>"),this.fps.innerHTML=y},n.updateInfo=function(e){for(this.arrLog.push(e),this.log.innerHTML=this.arrLog.join("<br/>");document.body.clientHeight<this.log.offsetHeight+this.fpsHeight+this.panelY+2*this.fontSize;)this.arrLog.shift(),this.log.innerHTML=this.arrLog.join("<br/>")},i}(e.DisplayObject);t.WebFps=i,e.registerClass(i,"egret.web.WebFps",["egret.FPSDisplay"]),e.FPSDisplay=i}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function i(e){if(window.location){var t=location.search;if(""==t)return"";t=t.slice(1);for(var i=t.split("&"),r=i.length,n=0;r>n;n++){var a=i[n],s=a.split("=");if(s[0]==e)return s[1]}}return""}t.getOption=i,e.getOption=i}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(i){function r(e,t){i.call(this),this.init(e,t),this.initOrientation()}__extends(r,i);var n=r,a=n.prototype;return a.init=function(i,r){var n=this.readOption(i,r),a=new e.Stage;a.$screen=this,a.$scaleMode=n.scaleMode,a.$orientation=n.orientation,a.$maxTouches=n.maxTouches,a.frameRate=n.frameRate,a.textureScaleFactor=n.textureScaleFactor;var s=new e.sys.RenderBuffer(void 0,void 0,!0),o=s.surface;this.attachCanvas(i,o);var h=new t.WebTouchHandler(a,o),l=new e.sys.Player(s,a,n.entryClassName),u=new e.web.WebHideHandler(a),c=new t.HTMLInput;l.showPaintRect(n.showPaintRect),(n.showFPS||n.showLog)&&l.displayFPS(n.showFPS,n.showLog,n.logFilter,n.fpsStyles),this.playerOption=n,this.container=i,this.canvas=o,this.stage=a,this.player=l,this.webTouchHandler=h,this.webInput=c,this.webHide=u,e.web.$cacheTextAdapter(c,a,i,o),this.updateScreenSize(),this.updateMaxTouches(),l.start()},a.initOrientation=function(){var t=this;window.addEventListener("orientationchange",function(){window.setTimeout(function(){e.StageOrientationEvent.dispatchStageOrientationEvent(t.stage,e.StageOrientationEvent.ORIENTATION_CHANGE)},350)})},a.readOption=function(t,i){var r={};r.entryClassName=t.getAttribute("data-entry-class"),r.scaleMode=t.getAttribute("data-scale-mode")||e.StageScaleMode.NO_SCALE,r.frameRate=+t.getAttribute("data-frame-rate")||30,r.contentWidth=+t.getAttribute("data-content-width")||480,r.contentHeight=+t.getAttribute("data-content-height")||800,r.orientation=t.getAttribute("data-orientation")||e.OrientationMode.AUTO,r.maxTouches=+t.getAttribute("data-multi-fingered")||2,r.textureScaleFactor=+t.getAttribute("texture-scale-factor")||1,r.showPaintRect="webgl"==i.renderMode?!1:"true"==t.getAttribute("data-show-paint-rect"),r.showFPS="true"==t.getAttribute("data-show-fps");for(var n=t.getAttribute("data-show-fps-style")||"",a=n.split(","),s={},o=0;o<a.length;o++){var h=a[o].split(":");s[h[0]]=h[1]}return r.fpsStyles=s,r.showLog="true"==t.getAttribute("data-show-log"),r.logFilter=t.getAttribute("data-log-filter"),r},a.attachCanvas=function(e,t){var i=t.style;i.cursor="inherit",i.position="absolute",i.top="0",i.bottom="0",i.left="0",i.right="0",e.appendChild(t),i=e.style,i.overflow="hidden",i.position="relative",i.webkitTransform="translateZ(0)"},a.updateScreenSize=function(){var t=this.canvas;if(!t.userTyping){var i=this.playerOption,r=this.container.getBoundingClientRect(),n=!1,a=this.stage.$orientation;a!=e.OrientationMode.AUTO&&(n=a!=e.OrientationMode.PORTRAIT&&r.height>r.width||a==e.OrientationMode.PORTRAIT&&r.width>r.height);var s=n?r.height:r.width,o=n?r.width:r.height;e.Capabilities.$boundingClientWidth=s,e.Capabilities.$boundingClientHeight=o;var h=e.sys.screenAdapter.calculateStageSize(this.stage.$scaleMode,s,o,i.contentWidth,i.contentHeight),l=h.stageWidth,u=h.stageHeight,c=h.displayWidth,d=h.displayHeight;t.width!==l&&(t.width=l),t.height!==u&&(t.height=u),t.style[e.web.getPrefixStyleName("transformOrigin")]="0% 0% 0px",t.style.width=c+"px",t.style.height=d+"px";var f=0;n?a==e.OrientationMode.LANDSCAPE?(f=90,t.style.top=(r.height-c)/2+"px",t.style.left=(r.width+d)/2+"px"):(f=-90,t.style.top=(r.height+c)/2+"px",t.style.left=(r.width-d)/2+"px"):(t.style.top=(r.height-d)/2+"px",t.style.left=(r.width-c)/2+"px");var v="rotate("+f+"deg)";t.style[e.web.getPrefixStyleName("transform")]=v;var p=c/l,g=d/u;this.webTouchHandler.updateScaleMode(p,g,f),this.webInput.$updateSize(),this.player.updateStageSize(l,u)}},a.setContentSize=function(e,t){var i=this.playerOption;i.contentWidth=e,i.contentHeight=t,this.updateScreenSize()},a.updateMaxTouches=function(){this.webTouchHandler.$updateMaxTouches()},r}(e.HashObject);t.WebPlayer=i,e.registerClass(i,"egret.web.WebPlayer",["egret.sys.Screen"])}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(){function t(t,i){a||(a=document.createElement("canvas"),s=a.getContext("2d"));var r=t.$getTextureWidth(),n=t.$getTextureHeight();null==i&&(i=e.$TempRectangle,i.x=0,i.y=0,i.width=r,i.height=n),i.x=Math.min(i.x,r-1),i.y=Math.min(i.y,n-1),i.width=Math.min(i.width,r-i.x),i.height=Math.min(i.height,n-i.y);var o=i.width,h=i.height,l=a;l.style.width=o+"px",l.style.height=h+"px",a.width=o,a.height=h;var u=t,c=Math.round(u._offsetX),d=Math.round(u._offsetY),f=u._bitmapWidth,v=u._bitmapHeight;return s.drawImage(u._bitmapData.source,u._bitmapX+i.x/e.$TextureScaleFactor,u._bitmapY+i.y/e.$TextureScaleFactor,f*i.width/r,v*i.height/n,c,d,i.width,i.height),l}function i(i,r){try{var n=t(this,r),a=n.toDataURL(i);return a}catch(s){e.$error(1033)}return null}function r(e,t,r){var n=i.call(this,e,r);if(null!=n){var a=n.replace(/^data:image[^;]*/,"data:image/octet-stream"),s=document.createElement("a");s.download=t,s.href=a;var o=document.createEvent("HTMLEvents");o.initEvent("click",!1,!1),s.dispatchEvent(o)}}function n(t,i){var r=e.sys.canvasHitTestBuffer;r.resize(3,3);var n=r.context;n.translate(1-t,1-i);var a=this._bitmapWidth,s=this._bitmapHeight,o=e.$TextureScaleFactor;n.drawImage(this._bitmapData.source,this._bitmapX,this._bitmapY,a,this._bitmapHeight,this._offsetX,this._offsetY,a*o,s*o);try{var h=r.getPixel(1,1)}catch(l){throw console.log(this),new Error(e.sys.tr(1039))}return h}var a,s;e.Texture.prototype.toDataURL=i,e.Texture.prototype.saveToFile=r,e.Texture.prototype.getPixel32=n}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function i(e){for(var t=o.parseFromString(e,"text/xml"),i=t.childNodes.length,n=0;i>n;n++){var a=t.childNodes[n];if(1==a.nodeType)return r(a,null)}return null}function r(e,t){if("parsererror"==e.localName)throw new Error(e.textContent);for(var i=new a(e.localName,t,e.prefix,e.namespaceURI,e.nodeName),n=e.attributes,o=i.attributes,h=n.length,l=0;h>l;l++){var u=n[l],c=u.name;0!=c.indexOf("xmlns:")&&(o[c]=u.value,i["$"+c]=u.value)}var d=e.childNodes;h=d.length;var f=i.children;for(l=0;h>l;l++){var v=d[l],p=v.nodeType,g=null;if(1==p)g=r(v,i);else if(3==p){var m=v.textContent.trim();m&&(g=new s(m,i))}g&&f.push(g)}return i}var n=function(){function e(e,t){this.nodeType=e,this.parent=t}var t=e;return t.prototype,e}();t.XMLNode=n,e.registerClass(n,"egret.web.XMLNode");var a=function(e){function t(t,i,r,n,a){e.call(this,1,i),this.attributes={},this.children=[],this.localName=t,this.prefix=r,this.namespace=n,this.name=a}__extends(t,e);var i=t;return i.prototype,t}(n);t.XML=a,e.registerClass(a,"egret.web.XML");var s=function(e){function t(t,i){e.call(this,3,i),this.text=t}__extends(t,e);var i=t;return i.prototype,t}(n);t.XMLText=s,e.registerClass(s,"egret.web.XMLText");var o=new DOMParser;e.XML={parse:i}}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(t){function i(){var i=this;t.apply(this,arguments),this.onChange=function(t){var r=new e.OrientationEvent(e.Event.CHANGE);r.beta=t.beta,r.gamma=t.gamma,r.alpha=t.alpha,i.dispatchEvent(r)}}__extends(i,t);var r=i,n=r.prototype;return n.start=function(){window.addEventListener("deviceorientation",this.onChange)},n.stop=function(){window.removeEventListener("deviceorientation",this.onChange)},i}(e.EventDispatcher);t.WebDeviceOrientation=i,e.registerClass(i,"egret.web.WebDeviceOrientation",["egret.DeviceOrientation"])}(t=e.web||(e.web={}))}(egret||(egret={})),egret.DeviceOrientation=egret.web.WebDeviceOrientation;var egret;!function(e){var t;!function(t){var i=function(t){function i(){var i=this;t.call(this),this.onUpdate=function(t){var r=new e.GeolocationEvent(e.Event.CHANGE),n=t.coords;r.altitude=n.altitude,r.heading=n.heading,r.accuracy=n.accuracy,r.latitude=n.latitude,r.longitude=n.longitude,r.speed=n.speed,r.altitudeAccuracy=n.altitudeAccuracy,i.dispatchEvent(r)},this.onError=function(t){var r=e.GeolocationEvent.UNAVAILABLE;t.code==t.PERMISSION_DENIED&&(r=e.GeolocationEvent.PERMISSION_DENIED);var n=new e.GeolocationEvent(e.IOErrorEvent.IO_ERROR);n.errorType=r,n.errorMessage=t.message,i.dispatchEvent(n)},this.geolocation=navigator.geolocation}__extends(i,t);var r=i,n=r.prototype;return n.start=function(){var t=this.geolocation;t?this.watchId=t.watchPosition(this.onUpdate,this.onError):this.onError({code:2,message:e.sys.tr(3004),PERMISSION_DENIED:1,POSITION_UNAVAILABLE:2})},n.stop=function(){var e=this.geolocation;e.clearWatch(this.watchId)},i}(e.EventDispatcher);t.WebGeolocation=i,e.registerClass(i,"egret.web.WebGeolocation",["egret.Geolocation"]),e.Geolocation=e.web.WebGeolocation}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(t){function i(){var i=this;t.apply(this,arguments),this.onChange=function(t){var r=new e.MotionEvent(e.Event.CHANGE),n={x:t.acceleration.x,y:t.acceleration.y,z:t.acceleration.z},a={x:t.accelerationIncludingGravity.x,y:t.accelerationIncludingGravity.y,z:t.accelerationIncludingGravity.z},s={alpha:t.rotationRate.alpha,beta:t.rotationRate.beta,gamma:t.rotationRate.gamma};r.acceleration=n,r.accelerationIncludingGravity=a,r.rotationRate=s,i.dispatchEvent(r)}}__extends(i,t);var r=i,n=r.prototype;return n.start=function(){window.addEventListener("devicemotion",this.onChange)},n.stop=function(){window.removeEventListener("devicemotion",this.onChange)},i}(e.EventDispatcher);t.WebMotion=i,e.registerClass(i,"egret.web.WebMotion",["egret.Motion"]),e.Motion=e.web.WebMotion}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(){}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(){function t(e){this.defaultVertexSrc="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec2 aColor;\nuniform vec2 projectionVector;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nconst vec2 center = vec2(-1.0, 1.0);\nvoid main(void) {\n   gl_Position = vec4( (aVertexPosition / projectionVector) + center , 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vColor = vec4(aColor.x, aColor.x, aColor.x, aColor.x);\n}",this.fragmentSrc="",this.gl=null,this.program=null,this.uniforms={projectionVector:{type:"2f",value:{x:0,y:0},dirty:!0}},this.gl=e}var i=t,r=i.prototype;return r.init=function(){var t=this.gl,i=e.WebGLUtils.compileProgram(t,this.defaultVertexSrc,this.fragmentSrc);t.useProgram(i),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord"),this.colorAttribute=t.getAttribLocation(i,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var r in this.uniforms)this.uniforms[r].uniformLocation=t.getUniformLocation(i,r);this.initUniforms(),this.program=i},r.initUniforms=function(){if(this.uniforms){var e,t=this.gl;for(var i in this.uniforms){e=this.uniforms[i],e.dirty=!0;var r=e.type;"mat2"===r||"mat3"===r||"mat4"===r?(e.glMatrix=!0,e.glValueLength=1,"mat2"===r?e.glFunc=t.uniformMatrix2fv:"mat3"===r?e.glFunc=t.uniformMatrix3fv:"mat4"===r&&(e.glFunc=t.uniformMatrix4fv)):(e.glFunc=t["uniform"+r],e.glValueLength="2f"===r||"2i"===r?2:"3f"===r||"3i"===r?3:"4f"===r||"4i"===r?4:1)}}},r.syncUniforms=function(){if(this.uniforms){var e,t=this.gl;for(var i in this.uniforms)e=this.uniforms[i],e.dirty&&(1===e.glValueLength?e.glMatrix===!0?e.glFunc.call(t,e.uniformLocation,e.transpose,e.value):e.glFunc.call(t,e.uniformLocation,e.value):2===e.glValueLength?e.glFunc.call(t,e.uniformLocation,e.value.x,e.value.y):3===e.glValueLength?e.glFunc.call(t,e.uniformLocation,e.value.x,e.value.y,e.value.z):4===e.glValueLength&&e.glFunc.call(t,e.uniformLocation,e.value.x,e.value.y,e.value.z,e.value.w),e.dirty=!1)}},r.setProjection=function(e,t){var i=this.uniforms.projectionVector;(i.value.x!=e||i.value.y!=t)&&(i.value.x=e,i.value.y=t,i.dirty=!0)},r.setAttribPointer=function(e){var t=this.gl;t.vertexAttribPointer(this.aVertexPosition,2,t.FLOAT,!1,e,0),t.vertexAttribPointer(this.aTextureCoord,2,t.FLOAT,!1,e,8),t.vertexAttribPointer(this.colorAttribute,1,t.FLOAT,!1,e,16)},t}();t.EgretShader=i,e.registerClass(i,"egret.web.EgretShader")}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(e){function t(){e.apply(this,arguments),this.fragmentSrc="precision lowp float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nuniform sampler2D uSampler;\nvoid main(void) {\ngl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;\n}"}__extends(t,e);var i=t;return i.prototype,t}(t.EgretShader);t.TextureShader=i,e.registerClass(i,"egret.web.TextureShader")}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(e){function t(){e.apply(this,arguments),this.fragmentSrc="precision lowp float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvoid main(void) {\ngl_FragColor = vColor;\n}"}__extends(t,e);var i=t;return i.prototype,t}(t.EgretShader);t.PrimitiveShader=i,e.registerClass(i,"egret.web.PrimitiveShader")}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(e){function t(){e.apply(this,arguments),this.fragmentSrc="precision mediump float;uniform vec2 blur;uniform sampler2D uSampler;varying vec2 vTextureCoord;uniform vec2 uTextureSize;void main(){const int sampleRadius = 5;const int samples = sampleRadius * 2 + 1;vec2 blurUv = blur / uTextureSize;vec4 color = vec4(0, 0, 0, 0);vec2 uv = vec2(0.0, 0.0);blurUv /= float(sampleRadius);for (int i = -sampleRadius; i <= sampleRadius; i++) {uv.x = vTextureCoord.x + float(i) * blurUv.x;uv.y = vTextureCoord.y + float(i) * blurUv.y;color += texture2D(uSampler, uv);}color /= float(samples);gl_FragColor = color;}",this.uniforms={projectionVector:{type:"2f",value:{x:0,y:0},dirty:!0},blur:{type:"2f",value:{x:2,y:2},dirty:!0},uTextureSize:{type:"2f",value:{x:100,y:100},dirty:!0}}}__extends(t,e);var i=t,r=i.prototype;return r.setBlur=function(e,t){var i=this.uniforms.blur;(i.value.x!=e||i.value.y!=t)&&(i.value.x=e,i.value.y=t,i.dirty=!0)},r.setTextureSize=function(e,t){var i=this.uniforms.uTextureSize;(e!=i.value.x||t!=i.value.y)&&(i.value.x=e,i.value.y=t,i.dirty=!0)},t}(t.TextureShader);t.BlurShader=i,e.registerClass(i,"egret.web.BlurShader")}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(e){function t(){e.apply(this,arguments),this.fragmentSrc="precision mediump float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nuniform mat4 matrix;\nuniform vec4 colorAdd;\nuniform sampler2D uSampler;\nvoid main(void) {\nvec4 texColor = texture2D(uSampler, vTextureCoord);\nif(texColor.a > 0.) {texColor = vec4(texColor.rgb / texColor.a, texColor.a);\n}vec4 locColor = clamp(texColor * matrix + colorAdd, 0., 1.);\ngl_FragColor = vColor * vec4(locColor.rgb * locColor.a, locColor.a);\n}",this.uniforms={projectionVector:{type:"2f",value:{x:0,y:0},dirty:!0},matrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],dirty:!0},colorAdd:{type:"4f",value:{x:0,y:0,z:0,w:0},dirty:!0}}
}__extends(t,e);var i=t,r=i.prototype;return r.setMatrix=function(e){var t=this.uniforms.matrix;(t.value[0]!=e[0]||t.value[0]!=e[0]||t.value[1]!=e[1]||t.value[2]!=e[2]||t.value[3]!=e[3]||t.value[4]!=e[5]||t.value[5]!=e[6]||t.value[6]!=e[7]||t.value[7]!=e[8]||t.value[8]!=e[10]||t.value[9]!=e[11]||t.value[10]!=e[12]||t.value[11]!=e[13]||t.value[12]!=e[15]||t.value[13]!=e[16]||t.value[14]!=e[17]||t.value[15]!=e[18])&&(t.value[0]=e[0],t.value[1]=e[1],t.value[2]=e[2],t.value[3]=e[3],t.value[4]=e[5],t.value[5]=e[6],t.value[6]=e[7],t.value[7]=e[8],t.value[8]=e[10],t.value[9]=e[11],t.value[10]=e[12],t.value[11]=e[13],t.value[12]=e[15],t.value[13]=e[16],t.value[14]=e[17],t.value[15]=e[18],t.dirty=!0);var i=this.uniforms.colorAdd;(i.value.x!=e[4]/255||i.value.y!=e[9]/255||i.value.z!=e[14]/255||i.value.w!=e[19]/255)&&(i.value.x=e[4]/255,i.value.y=e[9]/255,i.value.z=e[14]/255,i.value.w=e[19]/255,i.dirty=!0)},t}(t.TextureShader);t.ColorTransformShader=i,e.registerClass(i,"egret.web.ColorTransformShader")}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(e){function t(){e.apply(this,arguments),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform sampler2D uSampler;","uniform float distance;","uniform float angle;","uniform vec4 color;","uniform float alpha;","uniform float blurX;","uniform float blurY;","uniform float strength;","uniform float inner;","uniform float knockout;","uniform float hideObject;","uniform vec2 uTextureSize;vec2 px = vec2(1.0 / uTextureSize.x, 1.0 / uTextureSize.y);","float random(vec3 scale, float seed)","{","return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);","}","void main(void) {","const float linearSamplingTimes = 7.0;","const float circleSamplingTimes = 12.0;","vec4 ownColor = texture2D(uSampler, vTextureCoord);","vec4 curColor;","float totalAlpha = 0.0;","float maxTotalAlpha = 0.0;","float curDistanceX = 0.0;","float curDistanceY = 0.0;","float offsetX = distance * cos(angle) * px.x;","float offsetY = distance * sin(angle) * px.y;","const float PI = 3.14159265358979323846264;","float cosAngle;","float sinAngle;","float offset = PI * 2.0 / circleSamplingTimes * random(vec3(12.9898, 78.233, 151.7182), 0.0);","float stepX = blurX * px.x / linearSamplingTimes;","float stepY = blurY * px.y / linearSamplingTimes;","for (float a = 0.0; a <= PI * 2.0; a += PI * 2.0 / circleSamplingTimes) {","cosAngle = cos(a + offset);","sinAngle = sin(a + offset);","for (float i = 1.0; i <= linearSamplingTimes; i++) {","curDistanceX = i * stepX * cosAngle;","curDistanceY = i * stepY * sinAngle;","curColor = texture2D(uSampler, vec2(vTextureCoord.x + curDistanceX - offsetX, vTextureCoord.y + curDistanceY + offsetY));","totalAlpha += (linearSamplingTimes - i) * curColor.a;","maxTotalAlpha += (linearSamplingTimes - i);","}","}","ownColor.a = max(ownColor.a, 0.0001);","ownColor.rgb = ownColor.rgb / ownColor.a;","float outerGlowAlpha = (totalAlpha / maxTotalAlpha) * strength * alpha * (1. - inner) * max(min(hideObject, knockout), 1. - ownColor.a);","float innerGlowAlpha = ((maxTotalAlpha - totalAlpha) / maxTotalAlpha) * strength * alpha * inner * ownColor.a;","ownColor.a = max(ownColor.a * knockout * (1. - hideObject), 0.0001);","vec3 mix1 = mix(ownColor.rgb, color.rgb, innerGlowAlpha / (innerGlowAlpha + ownColor.a));","vec3 mix2 = mix(mix1, color.rgb, outerGlowAlpha / (innerGlowAlpha + ownColor.a + outerGlowAlpha));","float resultAlpha = min(ownColor.a + outerGlowAlpha + innerGlowAlpha, 1.);","gl_FragColor = vec4(mix2 * resultAlpha, resultAlpha);","}"].join("\n"),this.uniforms={projectionVector:{type:"2f",value:{x:0,y:0},dirty:!0},distance:{type:"1f",value:15,dirty:!0},angle:{type:"1f",value:1,dirty:!0},color:{type:"4f",value:{x:1,y:0,z:0,w:0},dirty:!0},alpha:{type:"1f",value:1,dirty:!0},blurX:{type:"1f",value:1,dirty:!0},blurY:{type:"1f",value:1,dirty:!0},strength:{type:"1f",value:1,dirty:!0},inner:{type:"1f",value:1,dirty:!0},knockout:{type:"1f",value:1,dirty:!0},hideObject:{type:"1f",value:0,dirty:!0},uTextureSize:{type:"2f",value:{x:100,y:100},dirty:!0}}}__extends(t,e);var i=t,r=i.prototype;return r.setDistance=function(e){var t=this.uniforms.distance;t.value!=e&&(t.value=e,t.dirty=!0)},r.setAngle=function(e){var t=this.uniforms.angle;t.value!=e&&(t.value=e,t.dirty=!0)},r.setColor=function(e,t,i){var r=this.uniforms.color;(r.value.x!=e||r.value.y!=t||r.value.z!=i)&&(r.value.x=e,r.value.y=t,r.value.z=i,r.dirty=!0)},r.setAlpha=function(e){var t=this.uniforms.alpha;t.value!=e&&(t.value=e,t.dirty=!0)},r.setBlurX=function(e){var t=this.uniforms.blurX;t.value!=e&&(t.value=e,t.dirty=!0)},r.setBlurY=function(e){var t=this.uniforms.blurY;t.value!=e&&(t.value=e,t.dirty=!0)},r.setStrength=function(e){var t=this.uniforms.strength;t.value!=e&&(t.value=e,t.dirty=!0)},r.setInner=function(e){var t=this.uniforms.inner;t.value!=e&&(t.value=e,t.dirty=!0)},r.setKnockout=function(e){var t=this.uniforms.knockout;t.value!=e&&(t.value=e,t.dirty=!0)},r.setHideObject=function(e){var t=this.uniforms.hideObject;t.value!=e&&(t.value=e,t.dirty=!0)},r.setTextureSize=function(e,t){var i=this.uniforms.uTextureSize;(e!=i.value.x||t!=i.value.y)&&(i.value.x=e,i.value.y=t,i.dirty=!0)},t}(t.TextureShader);t.GlowShader=i,e.registerClass(i,"egret.web.GlowShader")}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(){function e(e){this.gl=null,this.maxAttibs=10,this.attribState=[],this.tempAttribState=[],this.currentShader=null,this.defaultShader=null,this.primitiveShader=null,this.colorTransformShader=null,this.blurShader=null,this.glowShader=null;for(var t=0;t<this.maxAttibs;t++)this.attribState[t]=!1;this.setContext(e)}var i=e,r=i.prototype;return r.setContext=function(e){this.gl=e,this.primitiveShader=new t.PrimitiveShader(e),this.defaultShader=new t.TextureShader(e),this.colorTransformShader=new t.ColorTransformShader(e),this.glowShader=new t.GlowShader(e),this.blurShader=new t.BlurShader(e),this.primitiveShader.init(),this.defaultShader.init(),this.colorTransformShader.init(),this.blurShader.init(),this.glowShader.init()},r.activateShader=function(e,t){this.currentShader!=e&&(this.gl.useProgram(e.program),this.setAttribs(e.attributes),e.setAttribPointer(t),this.currentShader=e)},r.setAttribs=function(e){var t,i;for(i=this.tempAttribState.length,t=0;i>t;t++)this.tempAttribState[t]=!1;for(i=e.length,t=0;i>t;t++){var r=e[t];this.tempAttribState[r]=!0}var n=this.gl;for(i=this.attribState.length,t=0;i>t;t++)this.attribState[t]!==this.tempAttribState[t]&&(this.attribState[t]=this.tempAttribState[t],this.tempAttribState[t]?n.enableVertexAttribArray(t):n.disableVertexAttribArray(t))},e}();t.WebGLShaderManager=i,e.registerClass(i,"egret.web.WebGLShaderManager")}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(){function e(){this.drawData=[],this.drawDataLen=0}var t=e,i=t.prototype;return i.pushDrawRect=function(){if(0==this.drawDataLen||1!=this.drawData[this.drawDataLen-1].type){var e=this.drawData[this.drawDataLen]||{};e.type=1,e.count=0,this.drawData[this.drawDataLen]=e,this.drawDataLen++}this.drawData[this.drawDataLen-1].count+=2},i.pushDrawTexture=function(e,t,i,r,n){if(void 0===t&&(t=2),i){var a=this.drawData[this.drawDataLen]||{};a.type=0,a.texture=e,a.filter=i,a.count=t,a.textureWidth=r,a.textureHeight=n,this.drawData[this.drawDataLen]=a,this.drawDataLen++}else{if(0==this.drawDataLen||0!=this.drawData[this.drawDataLen-1].type||e!=this.drawData[this.drawDataLen-1].texture||this.drawData[this.drawDataLen-1].filter){var a=this.drawData[this.drawDataLen]||{};a.type=0,a.texture=e,a.count=0,this.drawData[this.drawDataLen]=a,this.drawDataLen++}this.drawData[this.drawDataLen-1].count+=t}},i.pushPushMask=function(e){void 0===e&&(e=1);var t=this.drawData[this.drawDataLen]||{};t.type=2,t.count=2*e,this.drawData[this.drawDataLen]=t,this.drawDataLen++},i.pushPopMask=function(e){void 0===e&&(e=1);var t=this.drawData[this.drawDataLen]||{};t.type=3,t.count=2*e,this.drawData[this.drawDataLen]=t,this.drawDataLen++},i.pushSetBlend=function(e){for(var t=this.drawDataLen,i=!1,r=t-1;r>=0;r--){var n=this.drawData[r];if(n){if((0==n.type||1==n.type)&&(i=!0),!i&&4==n.type){this.drawData.splice(r,1),this.drawDataLen--;continue}if(4==n.type){if(n.value==e)return;break}}}var a=this.drawData[this.drawDataLen]||{};a.type=4,a.value=e,this.drawData[this.drawDataLen]=a,this.drawDataLen++},i.pushResize=function(e,t,i){var r=this.drawData[this.drawDataLen]||{};r.type=5,r.buffer=e,r.width=t,r.height=i,this.drawData[this.drawDataLen]=r,this.drawDataLen++},i.pushClearColor=function(){var e=this.drawData[this.drawDataLen]||{};e.type=6,this.drawData[this.drawDataLen]=e,this.drawDataLen++},i.pushActivateBuffer=function(e){for(var t=this.drawDataLen,i=!1,r=t-1;r>=0;r--){var n=this.drawData[r];!n||(4!=n.type&&7!=n.type&&(i=!0),i||7!=n.type)||(this.drawData.splice(r,1),this.drawDataLen--)}var a=this.drawData[this.drawDataLen]||{};a.type=7,a.buffer=e,a.width=e.rootRenderTarget.width,a.height=e.rootRenderTarget.height,this.drawData[this.drawDataLen]=a,this.drawDataLen++},i.pushEnableScissor=function(e,t,i,r){var n=this.drawData[this.drawDataLen]||{};n.type=8,n.x=e,n.y=t,n.width=i,n.height=r,this.drawData[this.drawDataLen]=n,this.drawDataLen++},i.pushDisableScissor=function(){var e=this.drawData[this.drawDataLen]||{};e.type=9,this.drawData[this.drawDataLen]=e,this.drawDataLen++},i.clear=function(){for(var e=0;e<this.drawDataLen;e++){var t=this.drawData[e];t.type=0,t.count=0,t.texture=null,t.filter=null,t.uv=null,t.value="",t.buffer=null,t.width=0,t.height=0}this.drawDataLen=0},e}();t.WebGLDrawCmdManager=i,e.registerClass(i,"egret.web.WebGLDrawCmdManager")}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(){function e(){this.size=2e3,this.vertexMaxSize=4*this.size,this.indicesMaxSize=6*this.size,this.vertSize=5,this.vertices=null,this.indices=null,this.indicesForMesh=null,this.vertexIndex=0,this.indexIndex=0,this.hasMesh=!1;var e=this.vertexMaxSize*this.vertSize,t=this.indicesMaxSize;this.vertices=new Float32Array(e),this.indices=new Uint16Array(t),this.indicesForMesh=new Uint16Array(t);for(var i=0,r=0;t>i;i+=6,r+=4)this.indices[i+0]=r+0,this.indices[i+1]=r+1,this.indices[i+2]=r+2,this.indices[i+3]=r+0,this.indices[i+4]=r+2,this.indices[i+5]=r+3}var t=e,i=t.prototype;return i.reachMaxSize=function(e,t){return void 0===e&&(e=4),void 0===t&&(t=6),this.vertexIndex>this.vertexMaxSize-e||this.indexIndex>this.indicesMaxSize-t},i.getVertices=function(){var e=this.vertices.subarray(0,this.vertexIndex*this.vertSize);return e},i.getIndices=function(){return this.indices},i.getMeshIndices=function(){return this.indicesForMesh},i.changeToMeshIndices=function(){if(!this.hasMesh){for(var e=0,t=this.indexIndex;t>e;++e)this.indicesForMesh[e]=this.indices[e];this.hasMesh=!0}},i.isMesh=function(){return this.hasMesh},i.cacheArrays=function(e,t,i,r,n,a,s,o,h,l,u,c,d,f,v){var p=e,g=p.a,m=p.b,x=p.c,b=p.d,w=p.tx,y=p.ty;(0!=s||0!=o)&&p.append(1,0,0,1,s,o),(n/h!=1||a/l!=1)&&p.append(h/n,0,0,l/a,0,0);var T=p.a,E=p.b,S=p.c,C=p.d,R=p.tx,_=p.ty;if(p.a=g,p.b=m,p.c=x,p.d=b,p.tx=w,p.ty=y,f){var L=this.vertices,D=this.vertexIndex*this.vertSize,A=0,M=0,$=0,I=0,B=0,O=0,F=0;for(A=0,$=d.length;$>A;A+=2)M=5*A/2,O=f[A],F=f[A+1],I=d[A],B=d[A+1],L[D+M+0]=T*O+S*F+R,L[D+M+1]=E*O+C*F+_,L[D+M+2]=(i+I*n)/u,L[D+M+3]=(r+B*a)/c,L[D+M+4]=t;if(this.hasMesh)for(var A=0,$=v.length;$>A;++A)this.indicesForMesh[this.indexIndex+A]=v[A]+this.vertexIndex;this.vertexIndex+=d.length/2,this.indexIndex+=v.length}else{var P=u,W=c,H=n,G=a;i/=P,r/=W,n/=P,a/=W;var L=this.vertices,D=this.vertexIndex*this.vertSize;if(L[D++]=R,L[D++]=_,L[D++]=i,L[D++]=r,L[D++]=t,L[D++]=T*H+R,L[D++]=E*H+_,L[D++]=n+i,L[D++]=r,L[D++]=t,L[D++]=T*H+S*G+R,L[D++]=C*G+E*H+_,L[D++]=n+i,L[D++]=a+r,L[D++]=t,L[D++]=S*G+R,L[D++]=C*G+_,L[D++]=i,L[D++]=a+r,L[D++]=t,this.hasMesh){var k=this.indicesForMesh;k[this.indexIndex+0]=0+this.vertexIndex,k[this.indexIndex+1]=1+this.vertexIndex,k[this.indexIndex+2]=2+this.vertexIndex,k[this.indexIndex+3]=0+this.vertexIndex,k[this.indexIndex+4]=2+this.vertexIndex,k[this.indexIndex+5]=3+this.vertexIndex}this.vertexIndex+=4,this.indexIndex+=6}},i.clear=function(){this.hasMesh=!1,this.vertexIndex=0,this.indexIndex=0},e}();t.WebGLVertexArrayObject=i,e.registerClass(i,"egret.web.WebGLVertexArrayObject")}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(){function e(e,t,i){this.clearColor=[0,0,0,0],this.useFrameBuffer=!0,this.gl=e,this.width=t||1,this.height=i||1,this.texture=this.createTexture(),this.frameBuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0),this.stencilBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this.stencilBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,this.width,this.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,this.stencilBuffer)}var t=e,i=t.prototype;return i.resize=function(e,t){var i=this.gl;i.bindTexture(i.TEXTURE_2D,this.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,t,0,i.RGBA,i.UNSIGNED_BYTE,null),i.bindFramebuffer(i.FRAMEBUFFER,this.frameBuffer),i.bindRenderbuffer(i.RENDERBUFFER,this.stencilBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,e,t),this.width=e,this.height=t},i.activate=function(){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,this.getFrameBuffer())},i.getFrameBuffer=function(){return this.useFrameBuffer?this.frameBuffer:null},i.createTexture=function(){var e=this.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t},i.clear=function(e){var t=this.gl;e&&this.activate(),t.colorMask(!0,!0,!0,!0),t.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],this.clearColor[3]),t.clear(t.COLOR_BUFFER_BIT)},e}();t.WebGLRenderTarget=i,e.registerClass(i,"egret.web.WebGLRenderTarget")}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function i(e,t){var i=document.createElement("canvas");return isNaN(e)||isNaN(t)||(i.width=e,i.height=t),i}var r=function(){function r(e,r){this.glID=null,this.projectionX=0/0,this.projectionY=0/0,this.shaderManager=null,this.contextLost=!1,this.$scissorState=!1,this.vertSize=5,this.blurFilter=null,this.surface=i(e,r),this.initWebGL(),this.$bufferStack=[];var n=this.context;this.vertexBuffer=n.createBuffer(),this.indexBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.drawCmdManager=new t.WebGLDrawCmdManager,this.vao=new t.WebGLVertexArrayObject,this.setGlobalCompositeOperation("source-over")}var n=r,a=n.prototype;return r.getInstance=function(e,t){return this.instance?this.instance:(this.instance=new r(e,t),this.instance)},a.pushBuffer=function(e){this.$bufferStack.push(e),e!=this.currentBuffer&&(this.currentBuffer,this.drawCmdManager.pushActivateBuffer(e)),this.currentBuffer=e},a.popBuffer=function(){if(!(this.$bufferStack.length<=1)){var e=this.$bufferStack.pop(),t=this.$bufferStack[this.$bufferStack.length-1];e!=t&&this.drawCmdManager.pushActivateBuffer(t),this.currentBuffer=t}},a.activateBuffer=function(e){e.rootRenderTarget.activate(),this.bindIndices||(this.uploadIndicesArray(this.vao.getIndices()),this.bindIndices=!0),e.restoreStencil(),e.restoreScissor(),this.onResize(e.width,e.height)},a.uploadVerticesArray=function(e){var t=this.context;t.bufferData(t.ARRAY_BUFFER,e,t.STREAM_DRAW)},a.uploadIndicesArray=function(e){var t=this.context;t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)},a.destroy=function(){this.surface.width=this.surface.height=0},a.onResize=function(e,t){var e=e||this.surface.width,t=t||this.surface.height;this.projectionX=e/2,this.projectionY=-t/2,this.context&&this.context.viewport(0,0,e,t)},a.resize=function(e,t,i){var r=this.surface;i?(r.width<e&&(r.width=e),r.height<t&&(r.height=t)):(r.width!=e&&(r.width=e),r.height!=t&&(r.height=t)),this.onResize()},a.initWebGL=function(){this.onResize(),this.surface.addEventListener("webglcontextlost",this.handleContextLost.bind(this),!1),this.surface.addEventListener("webglcontextrestored",this.handleContextRestored.bind(this),!1),this.getWebGLContext(),this.shaderManager=new t.WebGLShaderManager(this.context)},a.handleContextLost=function(){this.contextLost=!0},a.handleContextRestored=function(){this.initWebGL(),this.contextLost=!1},a.getWebGLContext=function(){for(var t,i={antialias:r.antialias,stencil:!0},n=["webgl","experimental-webgl"],a=0;a<n.length;a++){try{t=this.surface.getContext(n[a],i)}catch(s){}if(t)break}t||e.$error(1021),this.setContext(t)},a.setContext=function(e){this.context=e,e.id=r.glContextId++,this.glID=e.id,e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE),e.enable(e.BLEND),e.colorMask(!0,!0,!0,!0),e.activeTexture(e.TEXTURE0)},a.enableStencilTest=function(){var e=this.context;e.enable(e.STENCIL_TEST)},a.disableStencilTest=function(){var e=this.context;e.disable(e.STENCIL_TEST)},a.enableScissorTest=function(e){var t=this.context;t.enable(t.SCISSOR_TEST),t.scissor(e.x,e.y,e.width,e.height)},a.disableScissorTest=function(){var e=this.context;e.disable(e.SCISSOR_TEST)},a.getPixels=function(e,t,i,r,n){var a=this.context;a.readPixels(e,t,i,r,a.RGBA,a.UNSIGNED_BYTE,n)},a.createTexture=function(e){var t=this.context,i=t.createTexture();return i?(i.glContext=t,t.bindTexture(t.TEXTURE_2D,i),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),i):void(this.contextLost=!0)},a.createTextureFromCompressedData=function(){return null},a.updateTexture=function(e,t){var i=this.context;i.bindTexture(i.TEXTURE_2D,e),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t)},a.getWebGLTexture=function(e){return e.webGLTexture||("image"==e.format?e.webGLTexture=this.createTexture(e.source):"pvr"==e.format&&(e.webGLTexture=this.createTextureFromCompressedData(e.source.pvrtcData,e.width,e.height,e.source.mipmapsCount,e.source.format)),e.$deleteSource&&e.webGLTexture&&(e.source=null)),e.webGLTexture},a.clearRect=function(e,t,i,r){if(0!=e||0!=t||i!=this.surface.width||r!=this.surface.height){var n=this.currentBuffer;if(n.$hasScissor)this.setGlobalCompositeOperation("destination-out"),this.drawRect(e,t,i,r),this.setGlobalCompositeOperation("source-over");else{var a=n.globalMatrix;0==a.b&&0==a.c?(e=e*a.a+a.tx,t=t*a.d+a.ty,i*=a.a,r*=a.d,this.enableScissor(e,-t-r+n.height,i,r),this.clear(),this.disableScissor()):(this.setGlobalCompositeOperation("destination-out"),this.drawRect(e,t,i,r),this.setGlobalCompositeOperation("source-over"))}}else this.clear()},a.setGlobalCompositeOperation=function(e){this.drawCmdManager.pushSetBlend(e)},a.drawImage=function(e,t,i,r,n,a,s,o,h,l,u){var c=this.currentBuffer;if(!this.contextLost&&e&&c){var d;if(e.source&&e.source.texture)d=e.source.texture,c.saveTransform(),c.transform(1,0,0,-1,0,h+2*s);else{if(!e.source&&!e.webGLTexture)return;d=this.getWebGLTexture(e)}d&&(this.drawTexture(d,t,i,r,n,a,s,o,h,l,u),e.source&&e.source.texture&&c.restoreTransform())}},a.drawMesh=function(e,t,i,r,n,a,s,o,h,l,u,c,d,f,v){var p=this.currentBuffer;if(!this.contextLost&&e&&p){var g;if(e.source&&e.source.texture)g=e.source.texture,p.saveTransform(),p.transform(1,0,0,-1,0,h+2*s);else{if(!e.source&&!e.webGLTexture)return;g=this.getWebGLTexture(e)}g&&this.drawTexture(g,t,i,r,n,a,s,o,h,l,u,c,d,f,v)}},a.drawTexture=function(e,t,i,r,n,a,s,o,h,l,u,c,d,f){var v=this.currentBuffer;if(!this.contextLost&&e&&v){d&&f?this.vao.reachMaxSize(d.length/2,f.length)&&this.$drawWebGL():this.vao.reachMaxSize()&&this.$drawWebGL(),c&&this.vao.changeToMeshIndices();var p=v.globalMatrix,g=v.globalAlpha,m=f?f.length/3:2;this.drawCmdManager.pushDrawTexture(e,m,this.$filter),this.vao.cacheArrays(p,g,t,i,r,n,a,s,o,h,l,u,c,d,f)}},a.drawRect=function(e,t,i,r){var n=this.currentBuffer;!this.contextLost&&n&&(this.vao.reachMaxSize()&&this.$drawWebGL(),this.drawCmdManager.pushDrawRect(),this.vao.cacheArrays(n.globalMatrix,n.globalAlpha,0,0,i,r,e,t,i,r,i,r))},a.pushMask=function(e){var t=this.currentBuffer;if(!this.contextLost&&t){t.$stencilList.push(e),this.vao.reachMaxSize()&&this.$drawWebGL();var i=e.length;if(i){this.drawCmdManager.pushPushMask(i);for(var r=0;i>r;r++){var n=e[r];this.vao.cacheArrays(t.globalMatrix,t.globalAlpha,0,0,n.width,n.height,n.minX,n.minY,n.width,n.height,n.width,n.height)}}else this.drawCmdManager.pushPushMask(),this.vao.cacheArrays(t.globalMatrix,t.globalAlpha,0,0,e.width,e.height,e.x,e.y,e.width,e.height,e.width,e.height)}},a.popMask=function(){var e=this.currentBuffer;if(!this.contextLost&&e){var t=e.$stencilList.pop();this.vao.reachMaxSize()&&this.$drawWebGL();var i=t.length;if(i){this.drawCmdManager.pushPopMask(i);for(var r=0;i>r;r++){var n=t[r];this.vao.cacheArrays(e.globalMatrix,e.globalAlpha,0,0,n.width,n.height,n.minX,n.minY,n.width,n.height,n.width,n.height)}}else this.drawCmdManager.pushPopMask(),this.vao.cacheArrays(e.globalMatrix,e.globalAlpha,0,0,t.width,t.height,t.x,t.y,t.width,t.height,t.width,t.height)}},a.clear=function(){this.drawCmdManager.pushClearColor()},a.enableScissor=function(e,t,i,r){var n=this.currentBuffer;this.drawCmdManager.pushEnableScissor(e,t,i,r),n.$hasScissor=!0},a.disableScissor=function(){var e=this.currentBuffer;this.drawCmdManager.pushDisableScissor(),e.$hasScissor=!1},a.$drawWebGL=function(){if(0!=this.drawCmdManager.drawDataLen&&!this.contextLost){this.uploadVerticesArray(this.vao.getVertices()),this.vao.isMesh()&&this.uploadIndicesArray(this.vao.getMeshIndices());for(var e=this.drawCmdManager.drawDataLen,t=0,i=0;e>i;i++){var r=this.drawCmdManager.drawData[i];t=this.drawData(r,t),7==r.type&&(this.activatedBuffer=r.buffer),(0==r.type||1==r.type||2==r.type||3==r.type)&&this.activatedBuffer&&this.activatedBuffer.$computeDrawCall&&this.activatedBuffer.$drawCalls++}this.vao.isMesh()&&this.uploadIndicesArray(this.vao.getIndices()),this.drawCmdManager.clear(),this.vao.clear()}},a.drawData=function(e,t){if(e){switch(e.type){case 0:var i,r=e.filter;r?"colorTransform"==r.type?(i=this.shaderManager.colorTransformShader,i.setMatrix(r.$matrix)):"blur"==r.type?(i=this.shaderManager.blurShader,i.setBlur(r.$blurX,r.$blurY),i.setTextureSize(e.textureWidth,e.textureHeight)):"glow"==r.type&&(i=this.shaderManager.glowShader,i.setDistance(r.$distance||0),i.setAngle(r.$angle?r.$angle/180*Math.PI:0),i.setColor(r.$red/255,r.$green/255,r.$blue/255),i.setAlpha(r.$alpha),i.setBlurX(r.$blurX),i.setBlurY(r.$blurY),i.setStrength(r.$strength),i.setInner(r.$inner?1:0),i.setKnockout(r.$knockout?0:1),i.setHideObject(r.$hideObject?1:0),i.setTextureSize(e.textureWidth,e.textureHeight)):i=this.shaderManager.defaultShader,i.setProjection(this.projectionX,this.projectionY),this.shaderManager.activateShader(i,4*this.vertSize),i.syncUniforms(),t+=this.drawTextureElements(e,t);break;case 1:var i=this.shaderManager.primitiveShader;i.setProjection(this.projectionX,this.projectionY),this.shaderManager.activateShader(i,4*this.vertSize),i.syncUniforms(),t+=this.drawRectElements(e,t);break;case 2:var i=this.shaderManager.primitiveShader;i.setProjection(this.projectionX,this.projectionY),this.shaderManager.activateShader(i,4*this.vertSize),i.syncUniforms(),t+=this.drawPushMaskElements(e,t);break;case 3:var i=this.shaderManager.primitiveShader;i.setProjection(this.projectionX,this.projectionY),this.shaderManager.activateShader(i,4*this.vertSize),i.syncUniforms(),t+=this.drawPopMaskElements(e,t);break;case 4:this.setBlendMode(e.value);break;case 5:e.buffer.rootRenderTarget.resize(e.width,e.height),this.onResize(e.width,e.height);break;case 6:if(this.activatedBuffer){var n=this.activatedBuffer.rootRenderTarget;(0!=n.width||0!=n.height)&&n.clear()}break;case 7:this.activateBuffer(e.buffer);break;case 8:var a=this.activatedBuffer;a&&a.enableScissor(e.x,e.y,e.width,e.height);break;case 9:var a=this.activatedBuffer;a&&a.disableScissor()}return t}},a.drawTextureElements=function(e,t){var i=this.context;i.bindTexture(i.TEXTURE_2D,e.texture);var r=3*e.count;return i.drawElements(i.TRIANGLES,r,i.UNSIGNED_SHORT,2*t),r},a.drawRectElements=function(e,t){var i=this.context,r=3*e.count;return i.drawElements(i.TRIANGLES,r,i.UNSIGNED_SHORT,2*t),r},a.drawPushMaskElements=function(e,t){var i=this.context,r=3*e.count,n=this.activatedBuffer;if(n){0==n.stencilHandleCount&&(n.enableStencil(),i.clear(i.STENCIL_BUFFER_BIT));var a=n.stencilHandleCount;n.stencilHandleCount++,i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.EQUAL,a,255),i.stencilOp(i.KEEP,i.KEEP,i.INCR),i.drawElements(i.TRIANGLES,r,i.UNSIGNED_SHORT,2*t),i.stencilFunc(i.EQUAL,a+1,255),i.colorMask(!0,!0,!0,!0),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)}return r},a.drawPopMaskElements=function(e,t){var i=this.context,r=3*e.count,n=this.activatedBuffer;if(n)if(n.stencilHandleCount--,0==n.stencilHandleCount)n.disableStencil();else{var a=n.stencilHandleCount;i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.EQUAL,a+1,255),i.stencilOp(i.KEEP,i.KEEP,i.DECR),i.drawElements(i.TRIANGLES,r,i.UNSIGNED_SHORT,2*t),i.stencilFunc(i.EQUAL,a,255),i.colorMask(!0,!0,!0,!0),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)}return r},a.setBlendMode=function(e){var t=this.context,i=r.blendModesForGL[e];i&&t.blendFunc(i[0],i[1])},a.drawTargetWidthFilters=function(e,i){var r,n=i,a=e.length;if(a>1)for(var s=0;a-1>s;s++){var o=e[s],h=i.rootRenderTarget.width,l=i.rootRenderTarget.height;r=t.WebGLRenderBuffer.create(h,l),r.setTransform(1,0,0,1,0,0),r.globalAlpha=1,this.drawToRenderTarget(o,i,r),i!=n&&t.WebGLRenderBuffer.release(i),i=r}var o=e[a-1];this.drawToRenderTarget(o,i,this.currentBuffer),i!=n&&t.WebGLRenderBuffer.release(i)},a.drawToRenderTarget=function(i,r,n){if(!this.contextLost){this.vao.reachMaxSize()&&this.$drawWebGL(),this.pushBuffer(n);var a,s=r,o=r.rootRenderTarget.width,h=r.rootRenderTarget.height;"blur"==i.type&&(this.blurFilter||(this.blurFilter=new e.BlurFilter(2,2)),0!=i.blurX&&0!=i.blurY?(this.blurFilter.blurX=i.blurX,this.blurFilter.blurY=0,a=t.WebGLRenderBuffer.create(o,h),a.setTransform(1,0,0,1,0,0),a.globalAlpha=1,this.drawToRenderTarget(this.blurFilter,r,a),r!=s&&t.WebGLRenderBuffer.release(r),r=a,this.blurFilter.blurX=0,this.blurFilter.blurY=i.blurY):(this.blurFilter.blurX=i.blurX,this.blurFilter.blurY=i.blurY),i=this.blurFilter),n.saveTransform(),n.transform(1,0,0,-1,0,h),this.vao.cacheArrays(n.globalMatrix,n.globalAlpha,0,0,o,h,0,0,o,h,o,h),n.restoreTransform();var l;l="blur"==i.type?{type:"blur",$blurX:i.$blurX,$blurY:i.$blurY}:i,this.drawCmdManager.pushDrawTexture(r.rootRenderTarget.texture,2,l,o,h),r!=s&&t.WebGLRenderBuffer.release(r),this.popBuffer()}},r.initBlendMode=function(){r.blendModesForGL={},r.blendModesForGL["source-over"]=[1,771],r.blendModesForGL.lighter=[1,772],r.blendModesForGL["lighter-in"]=[770,771],r.blendModesForGL["destination-out"]=[0,771],r.blendModesForGL["destination-in"]=[0,770]},r.glContextId=0,r.blendModesForGL=null,r}();t.WebGLRenderContext=r,e.registerClass(r,"egret.web.WebGLRenderContext"),r.initBlendMode()}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(){function i(i,r,n){if(this.globalAlpha=1,this.stencilState=!1,this.$stencilList=[],this.stencilHandleCount=0,this.$scissorState=!1,this.scissorRect=new e.Rectangle,this.$hasScissor=!0,this.dirtyRegionPolicy=!0,this._dirtyRegionPolicy=!0,this.$drawCalls=0,this.$computeDrawCall=!1,this.globalMatrix=new e.Matrix,this.savedGlobalMatrix=new e.Matrix,this.context=t.WebGLRenderContext.getInstance(i,r),this.rootRenderTarget=new t.WebGLRenderTarget(this.context.context,3,3),i&&r&&this.resize(i,r),this.root=n,this.root)this.context.pushBuffer(this),this.surface=this.context.surface;else{var a=this.context.activatedBuffer;a&&a.rootRenderTarget.activate(),this.surface=this.rootRenderTarget}}var n=__define,a=i,s=a.prototype;return s.enableStencil=function(){this.stencilState||(this.context.enableStencilTest(),this.stencilState=!0)},s.disableStencil=function(){this.stencilState&&(this.context.disableStencilTest(),this.stencilState=!1)},s.restoreStencil=function(){this.stencilState?this.context.enableStencilTest():this.context.disableStencilTest()},s.enableScissor=function(e,t,i,r){this.$scissorState||(this.$scissorState=!0,this.scissorRect.setTo(e,t,i,r),this.context.enableScissorTest(this.scissorRect))},s.disableScissor=function(){this.$scissorState&&(this.$scissorState=!1,this.scissorRect.setEmpty(),this.context.disableScissorTest())},s.restoreScissor=function(){this.$scissorState?this.context.enableScissorTest(this.scissorRect):this.context.disableScissorTest()},n(s,"width",function(){return this.rootRenderTarget.width}),n(s,"height",function(){return this.rootRenderTarget.height}),s.resize=function(e,t,i){this.context.pushBuffer(this),e=e||1,t=t||1,(e!=this.rootRenderTarget.width||t!=this.rootRenderTarget.height)&&(this.context.drawCmdManager.pushResize(this,e,t),this.rootRenderTarget.width=e,this.rootRenderTarget.height=t),this.root&&this.context.resize(e,t,i),this.context.clear(),this.context.popBuffer()},s.resizeTo=function(e,t,r,n){this.context.pushBuffer(this);var a=this.rootRenderTarget.width,s=this.rootRenderTarget.height,o=i.create(a,s);this.context.pushBuffer(o),this.context.drawImage(this.rootRenderTarget,0,0,a,s,0,0,a,s,a,s),this.context.popBuffer(),this.resize(e,t),this.setTransform(1,0,0,1,0,0),this.context.drawImage(o.rootRenderTarget,0,0,a,s,r,n,a,s,a,s),i.release(o),this.context.popBuffer()},s.setDirtyRegionPolicy=function(e){this.dirtyRegionPolicy="on"==e},s.beginClip=function(e,t,i){this.context.pushBuffer(this),this.root&&(this._dirtyRegionPolicy?(this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate()):(this.rootRenderTarget.useFrameBuffer=!1,this.rootRenderTarget.activate(),this.context.clear())),t=+t||0,i=+i||0,this.setTransform(1,0,0,1,t,i);var r=e.length;if(1==r&&0==e[0].minX&&0==e[0].minY&&e[0].width==this.rootRenderTarget.width&&e[0].height==this.rootRenderTarget.height)return this.maskPushed=!1,this.rootRenderTarget.useFrameBuffer&&this.context.clear(),void this.context.popBuffer();for(var n=0;r>n;n++){var a=e[n];this.context.clearRect(a.minX,a.minY,a.width,a.height)}if(r>0){if(this.$hasScissor||1!=r)this.scissorEnabled=!1;else{var a=e[0];e=e.slice(1);var s=a.minX+t,o=a.minY+i,h=a.width,l=a.height;this.context.enableScissor(s,-o-l+this.height,h,l),this.scissorEnabled=!0}e.length>0?(this.context.pushMask(e),this.maskPushed=!0):this.maskPushed=!1,this.offsetX=t,this.offsetY=i}else this.maskPushed=!1;this.context.popBuffer()},s.endClip=function(){(this.maskPushed||this.scissorEnabled)&&(this.context.pushBuffer(this),this.maskPushed&&(this.setTransform(1,0,0,1,this.offsetX,this.offsetY),this.context.popMask()),this.scissorEnabled&&this.context.disableScissor(),this.context.popBuffer())},s.getPixel=function(e,t){var i=new Uint8Array(4),r=this.rootRenderTarget.useFrameBuffer;return this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate(),this.context.getPixels(e,t,1,1,i),this.rootRenderTarget.useFrameBuffer=r,this.rootRenderTarget.activate(),i},s.toDataURL=function(e,t){return this.context.surface.toDataURL(e,t)},s.destroy=function(){this.context.destroy()},s.onRenderFinish=function(){this.$drawCalls=0,this.root&&(!this._dirtyRegionPolicy&&this.dirtyRegionPolicy&&this.drawSurfaceToFrameBuffer(0,0,this.rootRenderTarget.width,this.rootRenderTarget.height,0,0,this.rootRenderTarget.width,this.rootRenderTarget.height,!0),this._dirtyRegionPolicy&&this.drawFrameBufferToSurface(0,0,this.rootRenderTarget.width,this.rootRenderTarget.height,0,0,this.rootRenderTarget.width,this.rootRenderTarget.height),this._dirtyRegionPolicy=this.dirtyRegionPolicy)
},s.drawFrameBufferToSurface=function(e,t,i,r,n,a,s,o,h){void 0===h&&(h=!1),this.rootRenderTarget.useFrameBuffer=!1,this.rootRenderTarget.activate(),this.context.disableStencilTest(),this.context.disableScissorTest(),this.setTransform(1,0,0,1,0,0),this.globalAlpha=1,this.context.setGlobalCompositeOperation("source-over"),h&&this.context.clear(),this.context.drawImage(this.rootRenderTarget,e,t,i,r,n,a,s,o,i,r),this.context.$drawWebGL(),this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate(),this.restoreStencil(),this.restoreScissor()},s.drawSurfaceToFrameBuffer=function(e,t,i,r,n,a,s,o,h){void 0===h&&(h=!1),this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate(),this.context.disableStencilTest(),this.context.disableScissorTest(),this.setTransform(1,0,0,1,0,0),this.globalAlpha=1,this.context.setGlobalCompositeOperation("source-over"),h&&this.context.clear(),this.context.drawImage(this.context.surface,e,t,i,r,n,a,s,o,i,r),this.context.$drawWebGL(),this.rootRenderTarget.useFrameBuffer=!1,this.rootRenderTarget.activate(),this.restoreStencil(),this.restoreScissor()},s.clear=function(){this.context.clear()},s.setTransform=function(e,t,i,r,n,a){var s=this.globalMatrix;s.a=e,s.b=t,s.c=i,s.d=r,s.tx=n,s.ty=a},s.transform=function(e,t,i,r,n,a){var s=this.globalMatrix,o=s.a,h=s.b,l=s.c,u=s.d;(1!=e||0!=t||0!=i||1!=r)&&(s.a=e*o+t*l,s.b=e*h+t*u,s.c=i*o+r*l,s.d=i*h+r*u),s.tx=n*o+a*l+s.tx,s.ty=n*h+a*u+s.ty},s.translate=function(e,t){var i=this.globalMatrix;i.tx+=e,i.ty+=t},s.saveTransform=function(){var e=this.globalMatrix,t=this.savedGlobalMatrix;t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t.tx=e.tx,t.ty=e.ty},s.restoreTransform=function(){var e=this.globalMatrix,t=this.savedGlobalMatrix;e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.tx=t.tx,e.ty=t.ty},i.create=function(e,t){var n=r.pop();return n?n.resize(e,t):(n=new i(e,t),n.$computeDrawCall=!1),n},i.release=function(e){r.push(e)},i}();t.WebGLRenderBuffer=i,e.registerClass(i,"egret.web.WebGLRenderBuffer",["egret.sys.RenderBuffer"]);var r=[]}(t=e.web||(e.web={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=["source-over","lighter","destination-out"],r="source-over",n=[],a=function(){function a(){this.nestLevel=0}var s=a,o=s.prototype;return o.render=function(e,t,i,r,a){this.nestLevel++;var s=t,o=s.context,h=a?e:null;o.pushBuffer(s),this.drawDisplayObject(e,s,r,i,null,null,h),o.$drawWebGL();var l=s.$drawCalls;if(s.onRenderFinish(),o.popBuffer(),this.nestLevel--,0===this.nestLevel){n.length>6&&(n.length=6);for(var u=n.length,c=0;u>c;c++)n[c].resize(0,0)}return l},o.drawDisplayObject=function(t,i,r,n,a,s,o){var h,l=0;if(a&&!o?(a.isDirty&&(l+=a.drawToSurface()),h=a.$renderNode):h=t.$getRenderNode(),h){if(r){var u=h.renderRegion;if(s&&!s.intersects(u))h.needRedraw=!1;else if(!h.needRedraw)for(var c=r.length,d=0;c>d;d++)if(u.intersects(r[d])){h.needRedraw=!0;break}}else h.needRedraw=!0;if(h.needRedraw){l++;var f,v;o?(f=t.$getConcatenatedAlphaAt(o,t.$getConcatenatedAlpha()),v=e.Matrix.create().copyFrom(t.$getConcatenatedMatrix()),t.$getConcatenatedMatrixAt(o,v),n.$preMultiplyInto(v,v),i.setTransform(v.a,v.b,v.c,v.d,v.tx,v.ty),e.Matrix.release(v)):(f=h.renderAlpha,v=h.renderMatrix,i.setTransform(v.a,v.b,v.c,v.d,v.tx+n.tx,v.ty+n.ty)),i.globalAlpha=f,this.renderNode(h,i),h.needRedraw=!1}}if(a&&!o)return l;var p=t.$children;if(p)for(var g=p.length,m=0;g>m;m++){var x=p[m];if(!(!x.$visible||x.$alpha<=0||x.$maskedObject)){var b=x.$getFilters();b&&b.length>0?l+=this.drawWithFilter(x,i,r,n,s,o):0!==x.$blendMode||x.$mask&&(x.$mask.$parentDisplayList||o)?l+=this.drawWithClip(x,i,r,n,s,o):x.$scrollRect||x.$maskRect?l+=this.drawWithScrollRect(x,i,r,n,s,o):x.isFPS?(i.context.$drawWebGL(),i.$computeDrawCall=!1,this.drawDisplayObject(x,i,r,n,x.$displayList,s,o),i.context.$drawWebGL(),i.$computeDrawCall=!0):l+=this.drawDisplayObject(x,i,r,n,x.$displayList,s,o)}}return l},o.drawWithFilter=function(t,a,s,o,h,l){var u=0,c=t.$getFilters(),d=0!==t.$blendMode;if(d){var f=i[t.$blendMode];f||(f=r)}if(1==c.length&&"colorTransform"==c[0].type&&!t.$children)return d&&a.context.setGlobalCompositeOperation(f),a.context.$filter=c[0],u+=t.$mask&&(t.$mask.$parentDisplayList||l)?this.drawWithClip(t,a,s,o,h,l):t.$scrollRect||t.$maskRect?this.drawWithScrollRect(t,a,s,o,h,l):this.drawDisplayObject(t,a,s,o,t.$displayList,h,l),a.context.$filter=null,d&&a.context.setGlobalCompositeOperation(r),u;var v=e.Matrix.create();v.copyFrom(t.$getConcatenatedMatrix());var p;p=e.sys.Region.create();var g=t.$getOriginalBounds();p.updateRegion(g,v);var m=this.createRenderBuffer(p.width,p.height);m.context.pushBuffer(m),m.setTransform(1,0,0,1,-p.minX,-p.minY);var x=e.Matrix.create().setTo(1,0,0,1,-p.minX,-p.minY);return u+=t.$mask&&(t.$mask.$parentDisplayList||l)?this.drawWithClip(t,m,s,x,p,l):t.$scrollRect||t.$maskRect?this.drawWithScrollRect(t,m,s,x,p,l):this.drawDisplayObject(t,m,s,x,t.$displayList,p,l),e.Matrix.release(x),m.context.popBuffer(),u>0&&(d&&a.context.setGlobalCompositeOperation(f),u++,a.globalAlpha=1,a.setTransform(1,0,0,1,p.minX+o.tx,p.minY+o.ty),a.context.drawTargetWidthFilters(c,m),d&&a.context.setGlobalCompositeOperation(r)),n.push(m),e.sys.Region.release(p),e.Matrix.release(v),u},o.drawWithClip=function(t,a,s,o,h,l){var u=0,c=0!==t.$blendMode;if(c){var d=i[t.$blendMode];d||(d=r)}var f=t.$scrollRect?t.$scrollRect:t.$maskRect,v=t.$mask,v=t.$mask;if(v){var p=v.$getRenderNode();if(p){var g=p.renderMatrix;if(0==g.a&&0==g.b||0==g.c&&0==g.d)return u}}var m,x=e.Matrix.create();if(x.copyFrom(t.$getConcatenatedMatrix()),t.$parentDisplayList){var b,w=t.$parentDisplayList.root;w!==t.$stage&&t.$getConcatenatedMatrixAt(w,x)}if(v){var y=v.$getOriginalBounds();m=e.sys.Region.create();var T=e.Matrix.create();T.copyFrom(v.$getConcatenatedMatrix()),b&&b.$preMultiplyInto(T,T),m.updateRegion(y,T),e.Matrix.release(T)}var E;if(f&&(E=e.sys.Region.create(),E.updateRegion(f,x)),E&&m?(E.intersect(m),e.sys.Region.release(m)):!E&&m&&(E=m),E){if(E.isEmpty()||h&&!h.intersects(E))return e.sys.Region.release(E),e.Matrix.release(x),u}else E=e.sys.Region.create(),y=t.$getOriginalBounds(),E.updateRegion(y,x);var S=!1;if(s){for(var C=s.length,R=0;C>R;R++)if(E.intersects(s[R])){S=!0;break}}else S=!0;if(!S)return e.sys.Region.release(E),e.Matrix.release(x),u;if(v||t.$children&&0!=t.$children.length){var _=this.createRenderBuffer(E.width,E.height);_.context.pushBuffer(_),_.setTransform(1,0,0,1,-E.minX,-E.minY);var L=e.Matrix.create().setTo(1,0,0,1,-E.minX,-E.minY);if(u+=this.drawDisplayObject(t,_,s,L,t.$displayList,E,l),v){var D=this.createRenderBuffer(E.width,E.height);D.context.pushBuffer(D),D.setTransform(1,0,0,1,-E.minX,-E.minY),L=e.Matrix.create().setTo(1,0,0,1,-E.minX,-E.minY);var A=this.drawDisplayObject(v,D,s,L,v.$displayList,E,l);if(D.context.popBuffer(),A>0){u+=A,_.context.setGlobalCompositeOperation("destination-in"),_.setTransform(1,0,0,-1,0,D.height),_.globalAlpha=1;var M=D.rootRenderTarget.width,$=D.rootRenderTarget.height;_.context.drawTexture(D.rootRenderTarget.texture,0,0,M,$,0,0,M,$,M,$),_.context.setGlobalCompositeOperation("source-over")}n.push(D)}if(e.Matrix.release(L),_.context.setGlobalCompositeOperation(r),_.context.popBuffer(),u>0){if(u++,c&&a.context.setGlobalCompositeOperation(d),f){var T=x;_.setTransform(T.a,T.b,T.c,T.d,T.tx-E.minX,T.ty-E.minY),_.context.pushMask(f)}a.globalAlpha=1,a.setTransform(1,0,0,-1,E.minX+o.tx,E.minY+o.ty+_.height);var I=_.rootRenderTarget.width,B=_.rootRenderTarget.height;a.context.drawTexture(_.rootRenderTarget.texture,0,0,I,B,0,0,I,B,I,B),f&&_.context.popMask(),c&&a.context.setGlobalCompositeOperation(r)}return n.push(_),e.sys.Region.release(E),e.Matrix.release(x),u}if(f){var T=x;a.setTransform(T.a,T.b,T.c,T.d,T.tx-E.minX,T.ty-E.minY),a.context.pushMask(f)}return c&&a.context.setGlobalCompositeOperation(d),u+=this.drawDisplayObject(t,a,s,o,t.$displayList,E,null),c&&a.context.setGlobalCompositeOperation(r),f&&a.context.popMask(),e.sys.Region.release(E),e.Matrix.release(x),u},o.drawWithScrollRect=function(t,i,r,n,a,s){var o=0,h=t.$scrollRect?t.$scrollRect:t.$maskRect;if(0==h.width||0==h.height)return o;var l=e.Matrix.create();if(l.copyFrom(t.$getConcatenatedMatrix()),s)t.$getConcatenatedMatrixAt(s,l);else if(t.$parentDisplayList){var u=t.$parentDisplayList.root;u!==t.$stage&&t.$getConcatenatedMatrixAt(u,l)}var c=e.sys.Region.create();if(h.isEmpty()||c.updateRegion(h,l),c.isEmpty()||a&&!a.intersects(c))return e.sys.Region.release(c),e.Matrix.release(l),o;var d=!1;if(r){for(var f=r.length,v=0;f>v;v++)if(c.intersects(r[v])){d=!0;break}}else d=!0;if(!d)return e.sys.Region.release(c),e.Matrix.release(l),o;i.setTransform(l.a,l.b,l.c,l.d,l.tx+n.tx,l.ty+n.ty);var p=i.context,g=!1;if(i.$hasScissor||0!=l.b||0!=l.c)p.pushMask(h);else{var m=h.x,x=h.y,b=h.width,w=h.height;m=m*l.a+l.tx+n.tx,x=x*l.d+l.ty+n.ty,b*=l.a,w*=l.d,p.enableScissor(m,-x-w+i.height,b,w),g=!0}return o+=this.drawDisplayObject(t,i,r,n,t.$displayList,c,s),i.setTransform(l.a,l.b,l.c,l.d,l.tx+n.tx,l.ty+n.ty),g?p.disableScissor():p.popMask(),e.sys.Region.release(c),e.Matrix.release(l),o},o.drawNodeToBuffer=function(e,t,i,r){var n=t;n.context.pushBuffer(n),n.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),this.renderNode(e,t,r),n.context.$drawWebGL(),n.onRenderFinish(),n.context.popBuffer()},o.renderNode=function(e,t,i){switch(e.type){case 1:this.renderBitmap(e,t);break;case 2:this.renderText(e,t);break;case 3:this.renderGraphics(e,t,i);break;case 4:this.renderGroup(e,t);break;case 6:t.globalAlpha=e.drawData[0];break;case 7:this.renderMesh(e,t)}},o.renderBitmap=function(e,t){var n=e.image;if(n){var a=e.drawData,s=a.length,o=0,h=e.matrix,l=e.blendMode,u=e.alpha;if(h&&(t.saveTransform(),t.transform(h.a,h.b,h.c,h.d,h.tx,h.ty)),l&&t.context.setGlobalCompositeOperation(i[l]),u==u){var c=t.globalAlpha;t.globalAlpha*=u}if(e.filter){for(t.context.$filter=e.filter;s>o;)t.context.drawImage(n,a[o++],a[o++],a[o++],a[o++],a[o++],a[o++],a[o++],a[o++],e.imageWidth,e.imageHeight);t.context.$filter=null}else for(;s>o;)t.context.drawImage(n,a[o++],a[o++],a[o++],a[o++],a[o++],a[o++],a[o++],a[o++],e.imageWidth,e.imageHeight);l&&t.context.setGlobalCompositeOperation(r),u==u&&(t.globalAlpha=c),h&&t.restoreTransform()}},o.renderMesh=function(e,t){var i=e.image,r=e.drawData,n=r.length,a=0,s=e.matrix;for(s&&(t.saveTransform(),t.transform(s.a,s.b,s.c,s.d,s.tx,s.ty));n>a;)t.context.drawMesh(i,r[a++],r[a++],r[a++],r[a++],r[a++],r[a++],r[a++],r[a++],e.imageWidth,e.imageHeight,e.uvs,e.vertices,e.indices,e.bounds);s&&t.restoreTransform()},o.renderText=function(i,r){var n=i.width-i.x,a=i.height-i.y;if(0!=i.drawData.length&&(this.canvasRenderBuffer&&this.canvasRenderBuffer.context?i.dirtyRender&&this.canvasRenderBuffer.resize(n,a):(this.canvasRenderer=new e.CanvasRenderer,this.canvasRenderBuffer=new t.CanvasRenderBuffer(n,a)),this.canvasRenderBuffer.context)){if((i.x||i.y)&&(i.dirtyRender&&this.canvasRenderBuffer.context.translate(-i.x,-i.y),r.transform(1,0,0,1,i.x,i.y)),i.dirtyRender){var s=this.canvasRenderBuffer.surface;this.canvasRenderer.renderText(i,this.canvasRenderBuffer.context);var o=i.$texture;o?r.context.updateTexture(o,s):(o=r.context.createTexture(s),i.$texture=o),i.$textureWidth=s.width,i.$textureHeight=s.height}var h=i.$textureWidth,l=i.$textureHeight;r.context.drawTexture(i.$texture,0,0,h,l,0,0,h,l,h,l),(i.x||i.y)&&(i.dirtyRender&&this.canvasRenderBuffer.context.translate(i.x,i.y),r.transform(1,0,0,1,-i.x,-i.y)),i.dirtyRender=!1}},o.renderGraphics=function(i,r,n){var a=i.width,s=i.height;if(!(0>=a||0>=s)&&a&&s&&0!=i.drawData.length&&(this.canvasRenderBuffer&&this.canvasRenderBuffer.context?(i.dirtyRender||n)&&this.canvasRenderBuffer.resize(a,s):(this.canvasRenderer=new e.CanvasRenderer,this.canvasRenderBuffer=new t.CanvasRenderBuffer(a,s)),this.canvasRenderBuffer.context)){(i.x||i.y)&&((i.dirtyRender||n)&&this.canvasRenderBuffer.context.translate(-i.x,-i.y),r.transform(1,0,0,1,i.x,i.y));var o=this.canvasRenderBuffer.surface;if(n){this.canvasRenderer.renderGraphics(i,this.canvasRenderBuffer.context,!0),e.WebGLUtils.deleteWebGLTexture(o);var h=r.context.getWebGLTexture(o);r.context.drawTexture(h,0,0,a,s,0,0,a,s,o.width,o.height)}else{if(i.dirtyRender){this.canvasRenderer.renderGraphics(i,this.canvasRenderBuffer.context);var h=i.$texture;h?r.context.updateTexture(h,o):(h=r.context.createTexture(o),i.$texture=h),i.$textureWidth=o.width,i.$textureHeight=o.height}var l=i.$textureWidth,u=i.$textureHeight;r.context.drawTexture(i.$texture,0,0,l,u,0,0,l,u,l,u)}(i.x||i.y)&&((i.dirtyRender||n)&&this.canvasRenderBuffer.context.translate(i.x,i.y),r.transform(1,0,0,1,-i.x,-i.y)),n||(i.dirtyRender=!1)}},o.renderGroup=function(e,t){for(var i=e.drawData,r=i.length,n=0;r>n;n++){var a=i[n];this.renderNode(a,t)}},o.createRenderBuffer=function(e,i){var r=n.pop();return r?r.resize(e,i):(r=new t.WebGLRenderBuffer(e,i),r.$computeDrawCall=!1),r},a}();t.WebGLRenderer=a,e.registerClass(a,"egret.web.WebGLRenderer",["egret.sys.SystemRenderer"])}(t=e.web||(e.web={}))}(egret||(egret={}));
;/*!libs/libs/modules/game/game.min.js*/
var egret;!function(t){var e=function(t){function e(e,i,r){t.call(this),this._name=e,this._frame=0|i,r&&(this._end=0|r)}__extends(e,t);var i=__define,r=e,s=r.prototype;return i(s,"name",function(){return this._name}),i(s,"frame",function(){return this._frame}),i(s,"end",function(){return this._end}),s.clone=function(){return new e(this._name,this._frame,this._end)},e}(t.EventDispatcher);t.FrameLabel=e,t.registerClass(e,"egret.FrameLabel")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(i){e.call(this),this.$bitmapData=null,this.offsetPoint=t.Point.create(0,0),this.$movieClipData=null,this.frames=null,this.$totalFrames=0,this.frameLabels=null,this.$frameLabelStart=0,this.$frameLabelEnd=0,this.frameEvents=null,this.frameIntervalTime=0,this.$eventPool=null,this.$isPlaying=!1,this.isStopped=!0,this.playTimes=0,this.$currentFrameNum=0,this.$nextFrameNum=0,this.displayedKeyFrameNum=0,this.passedTime=0,this.lastTime=0,this.$smoothing=t.Bitmap.defaultSmoothing,this.$renderNode=new t.sys.BitmapNode,this.setMovieClipData(i)}__extends(i,e);var r=__define,s=i,n=s.prototype;return r(n,"smoothing",function(){return this.$smoothing},function(t){t=!!t,t!=this.$smoothing&&(this.$smoothing=t,this.$invalidate())}),n.$init=function(){this.$reset();var t=this.$movieClipData;t&&t.$isDataValid()&&(this.frames=t.frames,this.$totalFrames=t.numFrames,this.frameLabels=t.labels,this.frameEvents=t.events,this.frameIntervalTime=1e3/t.frameRate,this._initFrame())},n.$reset=function(){this.frames=null,this.playTimes=0,this.$isPlaying=!1,this.setIsStopped(!0),this.$currentFrameNum=0,this.$nextFrameNum=1,this.displayedKeyFrameNum=0,this.passedTime=0,this.$eventPool=[]},n._initFrame=function(){this.$movieClipData.$isTextureValid()&&(this.advanceFrame(),this.constructFrame())},n.$render=function(){var e=this.$bitmapData;if(e){var i=Math.round(this.offsetPoint.x),r=Math.round(this.offsetPoint.y),s=e._bitmapWidth,n=e._bitmapHeight,o=e.$getTextureWidth(),a=e.$getTextureHeight(),h=Math.round(e.$getScaleBitmapWidth()),l=Math.round(e.$getScaleBitmapHeight()),c=e._sourceWidth,u=e._sourceHeight;t.sys.BitmapNode.$updateTextureData(this.$renderNode,e._bitmapData,e._bitmapX,e._bitmapY,s,n,i,r,o,a,h,l,c,u,null,t.BitmapFillMode.SCALE,this.$smoothing)}},n.$measureContentBounds=function(t){var e=this.$bitmapData;if(e){var i=this.offsetPoint.x,r=this.offsetPoint.y,s=e.$getTextureWidth(),n=e.$getTextureHeight();t.setTo(i,r,s,n)}else t.setEmpty()},n.$onAddToStage=function(t,i){e.prototype.$onAddToStage.call(this,t,i),this.$isPlaying&&this.$totalFrames>1&&this.setIsStopped(!1)},n.$onRemoveFromStage=function(){e.prototype.$onRemoveFromStage.call(this),this.setIsStopped(!0)},n.getFrameLabelByName=function(t,e){void 0===e&&(e=!1),e&&(t=t.toLowerCase());var i=this.frameLabels;if(i)for(var r=null,s=0;s<i.length;s++)if(r=i[s],e?r.name.toLowerCase()==t:r.name==t)return r;return null},n.getFrameStartEnd=function(t){var e=this.frameLabels;if(e)for(var i=null,r=0;r<e.length;r++)if(i=e[r],t==i.name){this.$frameLabelStart=i.frame,this.$frameLabelEnd=i.end;break}},n.getFrameLabelByFrame=function(t){var e=this.frameLabels;if(e)for(var i=null,r=0;r<e.length;r++)if(i=e[r],i.frame==t)return i;return null},n.getFrameLabelForFrame=function(t){var e=null,i=null,r=this.frameLabels;if(r)for(var s=0;s<r.length;s++){if(i=r[s],i.frame>t)return e;e=i}return e},n.play=function(t){void 0===t&&(t=0),this.$isPlaying=!0,this.setPlayTimes(t),this.$totalFrames>1&&this.$stage&&this.setIsStopped(!1)},n.stop=function(){this.$isPlaying=!1,this.setIsStopped(!0)},n.prevFrame=function(){this.gotoAndStop(this.$currentFrameNum-1)},n.nextFrame=function(){this.gotoAndStop(this.$currentFrameNum+1)},n.gotoAndPlay=function(e,i){void 0===i&&(i=0),(0==arguments.length||arguments.length>2)&&t.$error(1022,"MovieClip.gotoAndPlay()"),"string"==typeof e?this.getFrameStartEnd(e):(this.$frameLabelStart=0,this.$frameLabelEnd=0),this.play(i),this.gotoFrame(e)},n.gotoAndStop=function(e){1!=arguments.length&&t.$error(1022,"MovieClip.gotoAndStop()"),this.stop(),this.gotoFrame(e)},n.gotoFrame=function(e){var i;"string"==typeof e?i=this.getFrameLabelByName(e).frame:(i=parseInt(e+"",10),i!=e&&t.$error(1022,"Frame Label Not Found")),1>i?i=1:i>this.$totalFrames&&(i=this.$totalFrames),i!=this.$nextFrameNum&&(this.$nextFrameNum=i,this.advanceFrame(),this.constructFrame(),this.handlePendingEvent())},n.advanceTime=function(e){var i=this,r=e-i.lastTime;i.lastTime=e;var s=i.frameIntervalTime,n=i.passedTime+r;i.passedTime=n%s;var o=n/s;if(1>o)return!1;for(var a;o>=1;){if(o--,i.$nextFrameNum++,a=this.frameEvents[i.$nextFrameNum],a&&""!=a&&t.MovieClipEvent.dispatchMovieClipEvent(i,t.MovieClipEvent.FRAME_LABEL,a),i.$nextFrameNum>i.$totalFrames||i.$frameLabelStart>0&&i.$nextFrameNum>i.$frameLabelEnd)if(-1==i.playTimes)i.$eventPool.push(t.Event.LOOP_COMPLETE),i.$nextFrameNum=1;else{if(i.playTimes--,!(i.playTimes>0)){i.$nextFrameNum=i.$totalFrames,i.$eventPool.push(t.Event.COMPLETE),i.stop();break}i.$eventPool.push(t.Event.LOOP_COMPLETE),i.$nextFrameNum=1}i.$currentFrameNum==i.$frameLabelEnd&&(i.$nextFrameNum=i.$frameLabelStart),i.advanceFrame()}return i.constructFrame(),i.handlePendingEvent(),!1},n.advanceFrame=function(){this.$currentFrameNum=this.$nextFrameNum},n.constructFrame=function(){var t=this.$currentFrameNum;this.displayedKeyFrameNum!=t&&(this.$bitmapData=this.$movieClipData.getTextureByFrame(t),this.$movieClipData.$getOffsetByFrame(t,this.offsetPoint),this.$invalidateContentBounds(),this.displayedKeyFrameNum=t)},n.handlePendingEvent=function(){if(0!=this.$eventPool.length){this.$eventPool.reverse();for(var e=this.$eventPool,i=e.length,r=!1,s=!1,n=0;i>n;n++){var o=e.pop();o==t.Event.LOOP_COMPLETE?s=!0:o==t.Event.COMPLETE?r=!0:this.dispatchEventWith(o)}s&&this.dispatchEventWith(t.Event.LOOP_COMPLETE),r&&this.dispatchEventWith(t.Event.COMPLETE)}},r(n,"totalFrames",function(){return this.$totalFrames}),r(n,"currentFrame",function(){return this.$currentFrameNum}),r(n,"currentFrameLabel",function(){var t=this.getFrameLabelByFrame(this.$currentFrameNum);return t&&t.name}),r(n,"currentLabel",function(){var t=this.getFrameLabelForFrame(this.$currentFrameNum);return t?t.name:null}),r(n,"frameRate",function(){return this.$movieClipData.frameRate},function(t){t!=this.$movieClipData.frameRate&&(this.$movieClipData.frameRate=t,this.frameIntervalTime=1e3/this.$movieClipData.frameRate)}),r(n,"isPlaying",function(){return this.$isPlaying}),r(n,"movieClipData",function(){return this.$movieClipData},function(t){this.setMovieClipData(t)}),n.setMovieClipData=function(t){this.$movieClipData!=t&&(this.$movieClipData=t,this.$init())},n.setPlayTimes=function(t){(0>t||t>=1)&&(this.playTimes=0>t?-1:Math.floor(t))},n.setIsStopped=function(e){this.isStopped!=e&&(this.isStopped=e,e?(this.playTimes=0,t.sys.$ticker.$stopTick(this.advanceTime,this)):(this.playTimes=0==this.playTimes?1:this.playTimes,this.lastTime=t.getTimer(),t.sys.$ticker.$startTick(this.advanceTime,this)))},i}(t.DisplayObject);t.MovieClip=e,t.registerClass(e,"egret.MovieClip")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){e.call(this),this.$mcData=null,this.numFrames=1,this.frames=[],this.labels=null,this.events=[],this.frameRate=0,this.textureData=null,this.spriteSheet=null}__extends(i,e);var r=__define,s=i,n=s.prototype;return n.$init=function(t,e,i){this.textureData=e,this.spriteSheet=i,this.setMCData(t)},n.getKeyFrameData=function(t){var e=this.frames[t-1];return e.frame&&(e=this.frames[e.frame-1]),e},n.getTextureByFrame=function(t){var e=this.getKeyFrameData(t);if(e.res){var i=this.getTextureByResName(e.res);return i}return null},n.$getOffsetByFrame=function(t,e){var i=this.getKeyFrameData(t);i.res&&e.setTo(0|i.x,0|i.y)},n.getTextureByResName=function(t){var e=this.spriteSheet.getTexture(t);if(!e){var i=this.textureData[t];e=this.spriteSheet.createTexture(t,i.x,i.y,i.w,i.h)}return e},n.$isDataValid=function(){return this.frames.length>0},n.$isTextureValid=function(){return null!=this.textureData&&null!=this.spriteSheet},n.$fillMCData=function(t){this.frameRate=t.frameRate||24,this.fillFramesData(t.frames),this.fillFrameLabelsData(t.labels),this.fillFrameEventsData(t.events)},n.fillFramesData=function(t){for(var e,i=this.frames,r=t?t.length:0,s=0;r>s;s++){var n=t[s];if(i.push(n),n.duration){var o=parseInt(n.duration);if(o>1){e=i.length;for(var a=1;o>a;a++)i.push({frame:e})}}}this.numFrames=i.length},n.fillFrameLabelsData=function(e){if(e){var i=e.length;if(i>0){this.labels=[];for(var r=0;i>r;r++){var s=e[r];this.labels.push(new t.FrameLabel(s.name,s.frame,s.end))}}}},n.fillFrameEventsData=function(t){if(t){var e=t.length;if(e>0){this.events=[];for(var i=0;e>i;i++){var r=t[i];this.events[r.frame]=r.name}}}},r(n,"mcData",function(){return this.$mcData},function(t){this.setMCData(t)}),n.setMCData=function(t){this.$mcData!=t&&(this.$mcData=t,t&&this.$fillMCData(t))},i}(t.HashObject);t.MovieClipData=e,t.registerClass(e,"egret.MovieClipData")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(t,i){e.call(this),this.enableCache=!0,this.$mcDataCache={},this.$mcDataSet=t,this.setTexture(i)}__extends(i,e);var r=__define,s=i,n=s.prototype;return n.clearCache=function(){this.$mcDataCache={}},n.generateMovieClipData=function(e){if(void 0===e&&(e=""),""==e&&this.$mcDataSet)for(e in this.$mcDataSet.mc)break;if(""==e)return null;var i=this.findFromCache(e,this.$mcDataCache);return i||(i=new t.MovieClipData,this.fillData(e,i,this.$mcDataCache)),i},n.findFromCache=function(t,e){return this.enableCache&&e[t]?e[t]:null},n.fillData=function(t,e,i){if(this.$mcDataSet){var r=this.$mcDataSet.mc[t];r&&(e.$init(r,this.$mcDataSet.res,this.$spriteSheet),this.enableCache&&(i[t]=e))}},r(n,"mcDataSet",function(){return this.$mcDataSet},function(t){this.$mcDataSet=t}),r(n,"texture",void 0,function(t){this.setTexture(t)}),r(n,"spriteSheet",function(){return this.$spriteSheet}),n.setTexture=function(e){this.$spriteSheet=e?new t.SpriteSheet(e):null},i}(t.EventDispatcher);t.MovieClipDataFactory=e,t.registerClass(e,"egret.MovieClipDataFactory")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(t,i,r,s){void 0===i&&(i=!1),void 0===r&&(r=!1),void 0===s&&(s=null),e.call(this,t,i,r),this.frameLabel=null,this.frameLabel=s}__extends(i,e);var r=i;return r.prototype,i.dispatchMovieClipEvent=function(e,r,s){void 0===s&&(s=null);var n=t.Event.create(i,r);n.frameLabel=s;var o=e.dispatchEvent(n);return t.Event.release(n),o},i.FRAME_LABEL="frame_label",i}(t.Event);t.MovieClipEvent=e,t.registerClass(e,"egret.MovieClipEvent")}(egret||(egret={}));var egret;!function(t){var e=function(){function e(){t.$error(1014)}var i=e;return i.prototype,e.get=function(t){return-1>t&&(t=-1),t>1&&(t=1),function(e){return 0==t?e:0>t?e*(e*-t+1+t):e*((2-e)*t+(1-t))}},e.getPowOut=function(t){return function(e){return 1-Math.pow(1-e,t)}},e.quintOut=e.getPowOut(5),e.quartOut=e.getPowOut(4),e}();t.ScrollEase=e,t.registerClass(e,"egret.ScrollEase");var i=function(e){function i(t,i,r){e.call(this),this._target=null,this._useTicks=!1,this.ignoreGlobalPause=!1,this.loop=!1,this.pluginData=null,this._steps=null,this._actions=null,this.paused=!1,this.duration=0,this._prevPos=-1,this.position=null,this._prevPosition=0,this._stepPosition=0,this.passive=!1,this.initialize(t,i,r)}__extends(i,e);var r=i,s=r.prototype;return i.get=function(t,e,r,s){return void 0===e&&(e=null),void 0===r&&(r=null),void 0===s&&(s=!1),s&&i.removeTweens(t),new i(t,e,r)},i.removeTweens=function(t){if(t.tween_count){for(var e=i._tweens,r=e.length-1;r>=0;r--)e[r]._target==t&&(e[r].paused=!0,e.splice(r,1));t.tween_count=0}},i.tick=function(t,e){void 0===e&&(e=!1);var r=t-i._lastTime;i._lastTime=t;for(var s=i._tweens.concat(),n=s.length-1;n>=0;n--){var o=s[n];e&&!o.ignoreGlobalPause||o.paused||o.tick(o._useTicks?1:r)}return!1},i._register=function(e,r){var s=e._target,n=i._tweens;if(r)s&&(s.tween_count=s.tween_count>0?s.tween_count+1:1),n.push(e),i._inited||(i._lastTime=t.getTimer(),t.sys.$ticker.$startTick(i.tick,null),i._inited=!0);else{s&&s.tween_count--;for(var o=n.length;o--;)if(n[o]==e)return void n.splice(o,1)}},s.initialize=function(t,e,r){this._target=t,e&&(this._useTicks=e.useTicks,this.ignoreGlobalPause=e.ignoreGlobalPause,this.loop=e.loop,e.onChange&&this.addEventListener("change",e.onChange,e.onChangeObj),e.override&&i.removeTweens(t)),this.pluginData=r||{},this._curQueueProps={},this._initQueueProps={},this._steps=[],this._actions=[],e&&e.paused?this.paused=!0:i._register(this,!0),e&&null!=e.position&&this.setPosition(e.position)},s.setPosition=function(t,e){void 0===e&&(e=1),0>t&&(t=0);var i=t,r=!1;if(i>=this.duration&&(this.loop?i%=this.duration:(i=this.duration,r=!0)),i==this._prevPos)return r;var s=this._prevPos;if(this.position=this._prevPos=i,this._prevPosition=t,this._target)if(r)this._updateTargetProps(null,1);else if(this._steps.length>0){for(var n=0,o=this._steps.length;o>n&&!(this._steps[n].t>i);n++);var a=this._steps[n-1];this._updateTargetProps(a,(this._stepPosition=i-a.t)/a.d)}return r&&this.setPaused(!0),0!=e&&this._actions.length>0&&(this._useTicks?this._runActions(i,i):1==e&&s>i?(s!=this.duration&&this._runActions(s,this.duration),this._runActions(0,i,!0)):this._runActions(s,i)),this.dispatchEventWith("change"),r},s._runActions=function(t,e,i){void 0===i&&(i=!1);var r=t,s=e,n=-1,o=this._actions.length,a=1;for(t>e&&(r=e,s=t,n=o,o=a=-1);(n+=a)!=o;){var h=this._actions[n],l=h.t;(l==s||l>r&&s>l||i&&l==t)&&h.f.apply(h.o,h.p)}},s._updateTargetProps=function(t,e){var r,s,n,o,a,h;if(t||1!=e){if(this.passive=!!t.v,this.passive)return;t.e&&(e=t.e(e,0,1,1)),r=t.p0,s=t.p1}else this.passive=!1,r=s=this._curQueueProps;for(var l in this._initQueueProps){null==(o=r[l])&&(r[l]=o=this._initQueueProps[l]),null==(a=s[l])&&(s[l]=a=o),n=o==a||0==e||1==e||"number"!=typeof o?1==e?a:o:o+(a-o)*e;var c=!1;if(h=i._plugins[l])for(var u=0,_=h.length;_>u;u++){var p=h[u].tween(this,l,n,r,s,e,!!t&&r==s,!t);p==i.IGNORE?c=!0:n=p}c||(this._target[l]=n)}},s.setPaused=function(t){return this.paused=t,i._register(this,!t),this},s._cloneProps=function(t){var e={};for(var i in t)e[i]=t[i];return e},s._addStep=function(t){return t.d>0&&(this._steps.push(t),t.t=this.duration,this.duration+=t.d),this},s._appendQueueProps=function(t){var e,r,s,n,o;for(var a in t)if(void 0===this._initQueueProps[a]){if(r=this._target[a],e=i._plugins[a])for(s=0,n=e.length;n>s;s++)r=e[s].init(this,a,r);this._initQueueProps[a]=this._curQueueProps[a]=void 0===r?null:r}else r=this._curQueueProps[a];for(var a in t){if(r=this._curQueueProps[a],e=i._plugins[a])for(o=o||{},s=0,n=e.length;n>s;s++)e[s].step&&e[s].step(this,a,r,t[a],o);this._curQueueProps[a]=t[a]}return o&&this._appendQueueProps(o),this._curQueueProps},s._addAction=function(t){return t.t=this.duration,this._actions.push(t),this},s.to=function(t,e,i){return void 0===i&&(i=void 0),(isNaN(e)||0>e)&&(e=0),this._addStep({d:e||0,p0:this._cloneProps(this._curQueueProps),e:i,p1:this._cloneProps(this._appendQueueProps(t))})},s.call=function(t,e,i){return void 0===e&&(e=void 0),void 0===i&&(i=void 0),this._addAction({f:t,p:i?i:[],o:e?e:this._target})},s.tick=function(t){this.paused||this.setPosition(this._prevPosition+t)},i._tweens=[],i.IGNORE={},i._plugins={},i._inited=!1,i._lastTime=0,i}(t.EventDispatcher);t.ScrollTween=i,t.registerClass(i,"egret.ScrollTween")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(i){void 0===i&&(i=null),e.call(this),this.scrollBeginThreshold=10,this.scrollSpeed=1,this._content=null,this.delayTouchBeginEvent=null,this.touchBeginTimer=null,this.touchEnabled=!0,this._ScrV_Props_=new t.ScrollViewProperties,i&&this.setContent(i)}__extends(i,e);var r=__define,s=i,n=s.prototype;return r(n,"bounces",function(){return this._ScrV_Props_._bounces},function(t){this._ScrV_Props_._bounces=!!t}),n.setContent=function(t){this._content!==t&&(this.removeContent(),t&&(this._content=t,e.prototype.addChild.call(this,t),this._addEvents()))},n.removeContent=function(){this._content&&(this._removeEvents(),e.prototype.removeChildAt.call(this,0)),this._content=null},r(n,"verticalScrollPolicy",function(){return this._ScrV_Props_._verticalScrollPolicy},function(t){t!=this._ScrV_Props_._verticalScrollPolicy&&(this._ScrV_Props_._verticalScrollPolicy=t)}),r(n,"horizontalScrollPolicy",function(){return this._ScrV_Props_._horizontalScrollPolicy},function(t){t!=this._ScrV_Props_._horizontalScrollPolicy&&(this._ScrV_Props_._horizontalScrollPolicy=t)}),r(n,"scrollLeft",function(){return this._ScrV_Props_._scrollLeft},function(t){t!=this._ScrV_Props_._scrollLeft&&(this._ScrV_Props_._scrollLeft=t,this._validatePosition(!1,!0),this._updateContentPosition())}),r(n,"scrollTop",function(){return this._ScrV_Props_._scrollTop},function(t){t!=this._ScrV_Props_._scrollTop&&(this._ScrV_Props_._scrollTop=t,this._validatePosition(!0,!1),this._updateContentPosition())}),n.setScrollPosition=function(t,e,i){if(void 0===i&&(i=!1),!(i&&0==t&&0==e||!i&&this._ScrV_Props_._scrollTop==t&&this._ScrV_Props_._scrollLeft==e)){var r=this._ScrV_Props_._scrollTop,s=this._ScrV_Props_._scrollLeft;if(i){var n=this.getMaxScrollLeft(),o=this.getMaxScrollTop();(0>=r||r>=o)&&(t/=2),(0>=s||s>=n)&&(e/=2);var a=r+t,h=s+e,l=this._ScrV_Props_._bounces;l||((0>=a||a>=o)&&(a=Math.max(0,Math.min(a,o))),(0>=h||h>=n)&&(h=Math.max(0,Math.min(h,n)))),this._ScrV_Props_._scrollTop=a,this._ScrV_Props_._scrollLeft=h}else this._ScrV_Props_._scrollTop=t,this._ScrV_Props_._scrollLeft=e;this._validatePosition(!0,!0),this._updateContentPosition()}},n._validatePosition=function(t,e){if(void 0===t&&(t=!1),void 0===e&&(e=!1),t){var i=this.height,r=this._getContentHeight();this._ScrV_Props_._scrollTop=Math.max(this._ScrV_Props_._scrollTop,(0-i)/2),this._ScrV_Props_._scrollTop=Math.min(this._ScrV_Props_._scrollTop,r>i?r-i/2:i/2)}if(e){var s=this.width,n=this._getContentWidth();this._ScrV_Props_._scrollLeft=Math.max(this._ScrV_Props_._scrollLeft,(0-s)/2),this._ScrV_Props_._scrollLeft=Math.min(this._ScrV_Props_._scrollLeft,n>s?n-s/2:s/2)}},n.$setWidth=function(t){if(this.$getExplicitWidth()==t)return!1;var i=e.prototype.$setWidth.call(this,t);return this._updateContentPosition(),i},n.$setHeight=function(t){return this.$getExplicitHeight()==t?!1:(e.prototype.$setHeight.call(this,t),this._updateContentPosition(),!0)},n._updateContentPosition=function(){var e=this.height,i=this.width;this.scrollRect=new t.Rectangle(Math.round(this._ScrV_Props_._scrollLeft),Math.round(this._ScrV_Props_._scrollTop),i,e),this.dispatchEvent(new t.Event(t.Event.CHANGE))},n._checkScrollPolicy=function(){var t=this._ScrV_Props_._horizontalScrollPolicy,e=this.__checkScrollPolicy(t,this._getContentWidth(),this.width);this._ScrV_Props_._hCanScroll=e;var i=this._ScrV_Props_._verticalScrollPolicy,r=this.__checkScrollPolicy(i,this._getContentHeight(),this.height);return this._ScrV_Props_._vCanScroll=r,e||r},n.__checkScrollPolicy=function(t,e,i){return"on"==t?!0:"off"==t?!1:e>i},n._addEvents=function(){this.addEventListener(t.TouchEvent.TOUCH_BEGIN,this._onTouchBegin,this),this.addEventListener(t.TouchEvent.TOUCH_BEGIN,this._onTouchBeginCapture,this,!0),this.addEventListener(t.TouchEvent.TOUCH_END,this._onTouchEndCapture,this,!0)},n._removeEvents=function(){this.removeEventListener(t.TouchEvent.TOUCH_BEGIN,this._onTouchBegin,this),this.removeEventListener(t.TouchEvent.TOUCH_BEGIN,this._onTouchBeginCapture,this,!0),this.removeEventListener(t.TouchEvent.TOUCH_END,this._onTouchEndCapture,this,!0)},n._onTouchBegin=function(e){if(!e.$isDefaultPrevented){var i=this._checkScrollPolicy();i&&(this._ScrV_Props_._touchStartPosition.x=e.stageX,this._ScrV_Props_._touchStartPosition.y=e.stageY,(this._ScrV_Props_._isHTweenPlaying||this._ScrV_Props_._isVTweenPlaying)&&this._onScrollFinished(),this._tempStage=this.stage,this._tempStage.addEventListener(t.TouchEvent.TOUCH_MOVE,this._onTouchMove,this),this._tempStage.addEventListener(t.TouchEvent.TOUCH_END,this._onTouchEnd,this),this._tempStage.addEventListener(t.TouchEvent.LEAVE_STAGE,this._onTouchEnd,this),this.addEventListener(t.Event.ENTER_FRAME,this._onEnterFrame,this),this._logTouchEvent(e),e.preventDefault())}},n._onTouchBeginCapture=function(e){var i=this._checkScrollPolicy();if(i){for(var r=e.target;r!=this;){if("_checkScrollPolicy"in r&&(i=r._checkScrollPolicy()))return;r=r.parent}e.stopPropagation();var s=this.cloneTouchEvent(e);this.delayTouchBeginEvent=s,this.touchBeginTimer||(this.touchBeginTimer=new t.Timer(100,1),this.touchBeginTimer.addEventListener(t.TimerEvent.TIMER_COMPLETE,this._onTouchBeginTimer,this)),this.touchBeginTimer.start(),this._onTouchBegin(e)}},n._onTouchEndCapture=function(e){var i=this;if(this.delayTouchBeginEvent){this._onTouchBeginTimer(),e.stopPropagation();var r=this.cloneTouchEvent(e);t.callLater(function(){i.stage&&i.dispatchPropagationEvent(r)},this)}},n._onTouchBeginTimer=function(){this.touchBeginTimer.stop();var t=this.delayTouchBeginEvent;this.delayTouchBeginEvent=null,this.stage&&this.dispatchPropagationEvent(t)},n.dispatchPropagationEvent=function(e){for(var i=e.$target,r=this.$getPropagationList(i),s=r.length,n=.5*r.length,o=-1,a=0;s>a;a++)if(r[a]===this._content){o=a;break}r.splice(0,o+1),n-=o+1,this.$dispatchPropagationEvent(e,r,n),t.Event.release(e)},n._onTouchMove=function(t){if(this._ScrV_Props_._lastTouchPosition.x!=t.stageX||this._ScrV_Props_._lastTouchPosition.y!=t.stageY){if(!this._ScrV_Props_._scrollStarted){var e=t.stageX-this._ScrV_Props_._touchStartPosition.x,i=t.stageY-this._ScrV_Props_._touchStartPosition.y,r=Math.sqrt(e*e+i*i);if(r<this.scrollBeginThreshold)return void this._logTouchEvent(t)}this._ScrV_Props_._scrollStarted=!0,this.delayTouchBeginEvent&&(this.delayTouchBeginEvent=null,this.touchBeginTimer.stop()),this.touchChildren=!1;var s=this._getPointChange(t);this.setScrollPosition(s.y,s.x,!0),this._calcVelocitys(t),this._logTouchEvent(t)}},n._onTouchEnd=function(){this.touchChildren=!0,this._ScrV_Props_._scrollStarted=!1,this._tempStage.removeEventListener(t.TouchEvent.TOUCH_MOVE,this._onTouchMove,this),this._tempStage.removeEventListener(t.TouchEvent.TOUCH_END,this._onTouchEnd,this),this._tempStage.removeEventListener(t.TouchEvent.LEAVE_STAGE,this._onTouchEnd,this),this.removeEventListener(t.Event.ENTER_FRAME,this._onEnterFrame,this),this._moveAfterTouchEnd()},n._onEnterFrame=function(){var e=t.getTimer();e-this._ScrV_Props_._lastTouchTime>100&&e-this._ScrV_Props_._lastTouchTime<300&&this._calcVelocitys(this._ScrV_Props_._lastTouchEvent)},n._logTouchEvent=function(e){this._ScrV_Props_._lastTouchPosition.x=e.stageX,this._ScrV_Props_._lastTouchPosition.y=e.stageY,this._ScrV_Props_._lastTouchEvent=this.cloneTouchEvent(e),this._ScrV_Props_._lastTouchTime=t.getTimer()},n._getPointChange=function(t){return{x:this._ScrV_Props_._hCanScroll===!1?0:this._ScrV_Props_._lastTouchPosition.x-t.stageX,y:this._ScrV_Props_._vCanScroll===!1?0:this._ScrV_Props_._lastTouchPosition.y-t.stageY}},n._calcVelocitys=function(e){var i=t.getTimer();if(0==this._ScrV_Props_._lastTouchTime)return void(this._ScrV_Props_._lastTouchTime=i);var r=this._getPointChange(e),s=i-this._ScrV_Props_._lastTouchTime;r.x/=s,r.y/=s,this._ScrV_Props_._velocitys.push(r),this._ScrV_Props_._velocitys.length>5&&this._ScrV_Props_._velocitys.shift(),this._ScrV_Props_._lastTouchPosition.x=e.stageX,this._ScrV_Props_._lastTouchPosition.y=e.stageY},n._getContentWidth=function(){return this._content.$getExplicitWidth()||this._content.width},n._getContentHeight=function(){return this._content.$getExplicitHeight()||this._content.height},n.getMaxScrollLeft=function(){var t=this._getContentWidth()-this.width;return Math.max(0,t)},n.getMaxScrollTop=function(){var t=this._getContentHeight()-this.height;return Math.max(0,t)},n._moveAfterTouchEnd=function(){if(0!=this._ScrV_Props_._velocitys.length){for(var t={x:0,y:0},e=0,r=0;r<this._ScrV_Props_._velocitys.length;r++){var s=this._ScrV_Props_._velocitys[r],n=i.weight[r];t.x+=s.x*n,t.y+=s.y*n,e+=n}this._ScrV_Props_._velocitys.length=0,this.scrollSpeed<=0&&(this.scrollSpeed=1);var o=t.x/e*this.scrollSpeed,a=t.y/e*this.scrollSpeed,h=Math.abs(o),l=Math.abs(a),c=this.getMaxScrollLeft(),u=this.getMaxScrollTop(),_=h>.02?this.getAnimationDatas(o,this._ScrV_Props_._scrollLeft,c):{position:this._ScrV_Props_._scrollLeft,duration:1},p=l>.02?this.getAnimationDatas(a,this._ScrV_Props_._scrollTop,u):{position:this._ScrV_Props_._scrollTop,duration:1};this.setScrollLeft(_.position,_.duration),this.setScrollTop(p.position,p.duration)}},n.onTweenFinished=function(t){t==this._ScrV_Props_._vScrollTween&&(this._ScrV_Props_._isVTweenPlaying=!1),t==this._ScrV_Props_._hScrollTween&&(this._ScrV_Props_._isHTweenPlaying=!1),0==this._ScrV_Props_._isHTweenPlaying&&0==this._ScrV_Props_._isVTweenPlaying&&this._onScrollFinished()},n._onScrollStarted=function(){},n._onScrollFinished=function(){t.ScrollTween.removeTweens(this),this._ScrV_Props_._hScrollTween=null,this._ScrV_Props_._vScrollTween=null,this._ScrV_Props_._isHTweenPlaying=!1,this._ScrV_Props_._isVTweenPlaying=!1,this.dispatchEvent(new t.Event(t.Event.COMPLETE))},n.setScrollTop=function(e,i){void 0===i&&(i=0);var r=Math.min(this.getMaxScrollTop(),Math.max(e,0));if(0==i)return void(this.scrollTop=r);0==this._ScrV_Props_._bounces&&(e=r);var s=t.ScrollTween.get(this).to({scrollTop:e},i,t.ScrollEase.quartOut);r!=e&&s.to({scrollTop:r},300,t.ScrollEase.quintOut),this._ScrV_Props_._isVTweenPlaying=!0,this._ScrV_Props_._vScrollTween=s,s.call(this.onTweenFinished,this,[s]),this._ScrV_Props_._isHTweenPlaying||this._onScrollStarted()},n.setScrollLeft=function(e,i){void 0===i&&(i=0);var r=Math.min(this.getMaxScrollLeft(),Math.max(e,0));if(0==i)return void(this.scrollLeft=r);0==this._ScrV_Props_._bounces&&(e=r);var s=t.ScrollTween.get(this).to({scrollLeft:e},i,t.ScrollEase.quartOut);r!=e&&s.to({scrollLeft:r},300,t.ScrollEase.quintOut),this._ScrV_Props_._isHTweenPlaying=!0,this._ScrV_Props_._hScrollTween=s,s.call(this.onTweenFinished,this,[s]),this._ScrV_Props_._isVTweenPlaying||this._onScrollStarted()},n.getAnimationDatas=function(t,e,i){var r=Math.abs(t),s=.95,n=0,o=.998,a=.02,h=e+500*t;if(0>h||h>i)for(h=e;Math.abs(t)!=1/0&&Math.abs(t)>a;)h+=t,t*=0>h||h>i?o*s:o,n++;else n=500*-Math.log(a/r);var l={position:Math.min(i+50,Math.max(h,-50)),duration:n};return l},n.cloneTouchEvent=function(e){var i=new t.TouchEvent(e.type,e.bubbles,e.cancelable);return i.touchPointID=e.touchPointID,i.$stageX=e.stageX,i.$stageY=e.stageY,i.touchDown=e.touchDown,i.$isDefaultPrevented=!1,i.$target=e.target,i},n.throwNotSupportedError=function(){t.$error(1023)},n.addChild=function(){return this.throwNotSupportedError(),null},n.addChildAt=function(){return this.throwNotSupportedError(),null},n.removeChild=function(){return this.throwNotSupportedError(),null},n.removeChildAt=function(){return this.throwNotSupportedError(),null},n.setChildIndex=function(){this.throwNotSupportedError()},n.swapChildren=function(){this.throwNotSupportedError()},n.swapChildrenAt=function(){this.throwNotSupportedError()},i.weight=[1,1.33,1.66,2,2.33],i}(t.DisplayObjectContainer);t.ScrollView=e,t.registerClass(e,"egret.ScrollView")}(egret||(egret={}));var egret;!function(t){var e=function(){function e(){this._verticalScrollPolicy="auto",this._horizontalScrollPolicy="auto",this._scrollLeft=0,this._scrollTop=0,this._hCanScroll=!1,this._vCanScroll=!1,this._lastTouchPosition=new t.Point(0,0),this._touchStartPosition=new t.Point(0,0),this._scrollStarted=!1,this._lastTouchTime=0,this._lastTouchEvent=null,this._velocitys=[],this._isHTweenPlaying=!1,this._isVTweenPlaying=!1,this._hScrollTween=null,this._vScrollTween=null,this._bounces=!0}var i=e;return i.prototype,e}();t.ScrollViewProperties=e,t.registerClass(e,"egret.ScrollViewProperties")}(egret||(egret={}));var egret;!function(t){function e(e){var i=e.url;return-1==i.indexOf("?")&&e.method==t.URLRequestMethod.GET&&e.data&&e.data instanceof t.URLVariables&&(i=i+"?"+e.data.toString()),i}t.$getUrl=e}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(i){void 0===i&&(i=null),e.call(this),this.dataFormat=t.URLLoaderDataFormat.TEXT,this.data=null,this._request=null,this._status=-1,i&&this.load(i)}__extends(i,e);var r=i,s=r.prototype;return s.load=function(e){this._request=e,this.data=null,t.NetContext.getNetContext().proceed(this)},s.__recycle=function(){this._request=null,this.data=null},i}(t.EventDispatcher);t.URLLoader=e,t.registerClass(e,"egret.URLLoader")}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}var e=t;return e.prototype,t.BINARY="binary",t.TEXT="text",t.VARIABLES="variables",t.TEXTURE="texture",t.SOUND="sound",t}();t.URLLoaderDataFormat=e,t.registerClass(e,"egret.URLLoaderDataFormat")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(i){void 0===i&&(i=null),e.call(this),this.data=null,this.method=t.URLRequestMethod.GET,this.url="",this.requestHeaders=[],this.url=i}__extends(i,e);var r=i;return r.prototype,i}(t.HashObject);t.URLRequest=e,t.registerClass(e,"egret.URLRequest")}(egret||(egret={}));var egret;!function(t){var e=function(){function t(t,e){this.name="",this.value="",this.name=t,this.value=e}var e=t;return e.prototype,t}();t.URLRequestHeader=e,t.registerClass(e,"egret.URLRequestHeader")}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}var e=t;return e.prototype,t.GET="get",t.POST="post",t}();t.URLRequestMethod=e,t.registerClass(e,"egret.URLRequestMethod")}(egret||(egret={}));var egret;!function(t){var e=function(t){function e(e){void 0===e&&(e=null),t.call(this),this.variables=null,null!==e&&this.decode(e)}__extends(e,t);var i=e,r=i.prototype;return r.decode=function(t){this.variables||(this.variables={}),t=t.split("+").join(" ");for(var e,i=/[?&]?([^=]+)=([^&]*)/g;e=i.exec(t);){var r=decodeURIComponent(e[1]),s=decodeURIComponent(e[2]);if(r in this.variables!=0){var n=this.variables[r];n instanceof Array?n.push(s):this.variables[r]=[n,s]}else this.variables[r]=s}},r.toString=function(){if(!this.variables)return"";var t=this.variables,e=[];for(var i in t)e.push(this.encodeValue(i,t[i]));return e.join("&")},r.encodeValue=function(t,e){return e instanceof Array?this.encodeArray(t,e):encodeURIComponent(t)+"="+encodeURIComponent(e)},r.encodeArray=function(t,e){return t?0==e.length?encodeURIComponent(t)+"=":e.map(function(e){return encodeURIComponent(t)+"="+encodeURIComponent(e)}).join("&"):""},e}(t.HashObject);t.URLVariables=e,t.registerClass(e,"egret.URLVariables")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){e.call(this),this._timeScale=1,this._paused=!1,this._callIndex=-1,this._lastTime=0,this.callBackList=[],null!=i.instance,t.sys.$ticker.$startTick(this.update,this),this._lastTime=t.getTimer()}__extends(i,e);var r=i,s=r.prototype;return s.update=function(t){var e=t-this._lastTime;if(this._lastTime=t,this._paused)return!1;var i=e*this._timeScale;for(this._callList=this.callBackList.concat(),this._callIndex=0;this._callIndex<this._callList.length;this._callIndex++){var r=this._callList[this._callIndex];r.listener.call(r.thisObject,i)}return this._callIndex=-1,this._callList=null,!1},s.register=function(t,e,i){void 0===i&&(i=0),this.$insertEventBin(this.callBackList,"",t,e,!1,i,!1)},s.unregister=function(t,e){this.$removeEventBin(this.callBackList,t,e)},s.setTimeScale=function(t){this._timeScale=t},s.getTimeScale=function(){return this._timeScale},s.pause=function(){this._paused=!0},s.resume=function(){this._paused=!1},i.getInstance=function(){return null==i.instance&&(i.instance=new i),i.instance},i}(t.EventDispatcher);t.Ticker=e,t.registerClass(e,"egret.Ticker")}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){e.call(this)}__extends(i,e);var r=__define,s=i,n=s.prototype;return r(n,"stage",function(){return t.sys.$TempStage}),r(i,"runtimeType",function(){return t.$warn(1041),i._runtimeType}),n.run=function(){},r(i,"instance",function(){return null==i._instance&&(i._instance=new i),i._instance
}),i.deviceType=null,i.DEVICE_PC="web",i.DEVICE_MOBILE="native",i.RUNTIME_HTML5="runtimeHtml5",i.RUNTIME_NATIVE="runtimeNative",i}(t.EventDispatcher);t.MainContext=e,t.registerClass(e,"egret.MainContext")}(egret||(egret={}));var testDeviceType1=function(){if(!this.navigator)return!0;var t=navigator.userAgent.toLowerCase();return-1!=t.indexOf("mobile")||-1!=t.indexOf("android")},testRuntimeType1=function(){return this.navigator?!0:!1};egret.MainContext.deviceType=testDeviceType1()?egret.MainContext.DEVICE_MOBILE:egret.MainContext.DEVICE_PC,egret.MainContext._runtimeType=testRuntimeType1()?egret.MainContext.RUNTIME_HTML5:egret.MainContext.RUNTIME_NATIVE,delete testDeviceType1,delete testRuntimeType1;var egret;!function(t){var e=function(e){function i(t){void 0===t&&(t=300),e.call(this),this.objectPool=[],this._length=0,1>t&&(t=1),this.autoDisposeTime=t,this.frameCount=0}__extends(i,e);var r=__define,s=i,n=s.prototype;return i.$init=function(){t.sys.$ticker.$startTick(i.onUpdate,i)},i.onUpdate=function(){for(var t=i._callBackList,e=t.length-1;e>=0;e--)t[e].$checkFrame();return!1},n.$checkFrame=function(){this.frameCount--,this.frameCount<=0&&this.dispose()},r(n,"length",function(){return this._length}),n.push=function(t){var e=this.objectPool;-1==e.indexOf(t)&&(e.push(t),t.__recycle&&t.__recycle(),this._length++,0==this.frameCount&&(this.frameCount=this.autoDisposeTime,i._callBackList.push(this)))},n.pop=function(){return 0==this._length?null:(this._length--,this.objectPool.pop())},n.dispose=function(){this._length>0&&(this.objectPool=[],this._length=0),this.frameCount=0;var t=i._callBackList,e=t.indexOf(this);-1!=e&&t.splice(e,1)},i._callBackList=[],i}(t.HashObject);t.Recycler=e,t.registerClass(e,"egret.Recycler"),e.$init()}(egret||(egret={}));var egret;!function(t){function e(e,i,h){for(var l=[],c=3;c<arguments.length;c++)l[c-3]=arguments[c];var u={listener:e,thisObject:i,delay:h,originDelay:h,params:l};return o++,1==o&&(a=t.getTimer(),t.sys.$ticker.$startTick(r,null)),n++,s[n]=u,n}function i(e){s[e]&&(o--,delete s[e],0==o&&t.sys.$ticker.$stopTick(r,null))}function r(t){var e=t-a;a=t;for(var i in s){var r=s[i];r.delay-=e,r.delay<=0&&(r.delay=r.originDelay,r.listener.apply(r.thisObject,r.params))}return!1}var s={},n=0,o=0,a=0;t.setInterval=e,t.clearInterval=i}(egret||(egret={}));var egret;!function(t){function e(e,i,h){for(var l=[],c=3;c<arguments.length;c++)l[c-3]=arguments[c];var u={listener:e,thisObject:i,delay:h,params:l};return o++,1==o&&t.sys.$ticker&&(a=t.getTimer(),t.sys.$ticker.$startTick(r,null)),n++,s[n]=u,n}function i(e){s[e]&&(o--,delete s[e],0==o&&t.sys.$ticker&&t.sys.$ticker.$stopTick(r,null))}function r(t){var e=t-a;a=t;for(var r in s){var n=r,o=s[n];o.delay-=e,o.delay<=0&&(o.listener.apply(o.thisObject,o.params),i(n))}return!1}var s={},n=0,o=0,a=0;t.setTimeout=e,t.clearTimeout=i}(egret||(egret={}));
;/*!libs/libs/modules/game/game.web.min.js*/
var egret;!function(e){var t;!function(t){var n=function(t){function n(){t.call(this)}__extends(n,t);var r=n,a=r.prototype;return a.proceed=function(t){function n(e){t.dispatchEvent(e)}function r(e){o(),t.dispatchEvent(e)}function a(){switch(o(),t.dataFormat){case e.URLLoaderDataFormat.VARIABLES:t.data=new e.URLVariables(d.response);break;default:t.data=d.response}window.setTimeout(function(){e.Event.dispatchEvent(t,e.Event.COMPLETE)},0)}function o(){d.removeEventListener(e.Event.COMPLETE,a,i),d.removeEventListener(e.IOErrorEvent.IO_ERROR,r,i),d.removeEventListener(e.ProgressEvent.PROGRESS,n,i)}var i=this;if(t.dataFormat==e.URLLoaderDataFormat.TEXTURE)return void this.loadTexture(t);if(t.dataFormat==e.URLLoaderDataFormat.SOUND)return void this.loadSound(t);var s=t._request,E=i.getVirtualUrl(e.$getUrl(s)),d=new e.HttpRequest;if(d.addEventListener(e.Event.COMPLETE,a,this),d.addEventListener(e.IOErrorEvent.IO_ERROR,r,this),d.addEventListener(e.ProgressEvent.PROGRESS,n,this),d.open(E,s.method),d.responseType=this.getResponseType(t.dataFormat),s.method!=e.URLRequestMethod.GET&&s.data)if(s.data instanceof e.URLVariables){d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var v=s.data;d.send(v.toString())}else d.setRequestHeader("Content-Type","multipart/form-data"),d.send(s.data);else d.send()},a.getResponseType=function(t){switch(t){case e.URLLoaderDataFormat.TEXT:case e.URLLoaderDataFormat.VARIABLES:return e.URLLoaderDataFormat.TEXT;case e.URLLoaderDataFormat.BINARY:return"arraybuffer";default:return t}},a.loadSound=function(t){function n(e){t.dispatchEvent(e)}function r(e){o(),t.dispatchEvent(e)}function a(){o(),t.data=E,window.setTimeout(function(){t.dispatchEventWith(e.Event.COMPLETE)},0)}function o(){E.removeEventListener(e.Event.COMPLETE,a,i),E.removeEventListener(e.IOErrorEvent.IO_ERROR,r,i),E.removeEventListener(e.ProgressEvent.PROGRESS,n,i)}var i=this,s=this.getVirtualUrl(t._request.url),E=new e.Sound;E.addEventListener(e.Event.COMPLETE,a,i),E.addEventListener(e.IOErrorEvent.IO_ERROR,r,i),E.addEventListener(e.ProgressEvent.PROGRESS,n,i),E.load(s)},a.loadTexture=function(t){function n(e){t.dispatchEvent(e)}function r(e){o(),t.dispatchEvent(e)}function a(){o();var n=E.data;n.source.setAttribute("bitmapSrc",s);var r=new e.Texture;r._setBitmapData(n),t.data=r,window.setTimeout(function(){t.dispatchEventWith(e.Event.COMPLETE)},i)}function o(){E.removeEventListener(e.Event.COMPLETE,a,i),E.removeEventListener(e.IOErrorEvent.IO_ERROR,r,i),E.removeEventListener(e.ProgressEvent.PROGRESS,n,i)}var i=this,s=this.getVirtualUrl(t._request.url),E=new e.ImageLoader;E.addEventListener(e.Event.COMPLETE,a,i),E.addEventListener(e.IOErrorEvent.IO_ERROR,r,i),E.addEventListener(e.ProgressEvent.PROGRESS,n,i),E.load(s)},a.getChangeList=function(){return[]},a.getVirtualUrl=function(e){return e},n.getNetContext=function(){return null==n._instance&&(n._instance=new n),n._instance},n}(e.HashObject);t.HTML5NetContext=n,e.registerClass(n,"egret.web.HTML5NetContext",["egret.NetContext"]),e.NetContext=n}(t=e.web||(e.web={}))}(egret||(egret={}));
;/*!libs/libs/modules/res/res.min.js*/
var RES;!function(e){var t=function(){function e(e,t,r){this.groupName="",this.data=null,this._loaded=!1,this.name=e,this.url=t,this.type=r}var t=__define,r=e,i=r.prototype;return t(i,"loaded",function(){return this.data?this.data.loaded:this._loaded},function(e){this.data&&(this.data.loaded=e),this._loaded=e}),i.toString=function(){return'[ResourceItem name="'+this.name+'" url="'+this.url+'" type="'+this.type+'"]'},e.TYPE_XML="xml",e.TYPE_IMAGE="image",e.TYPE_BIN="bin",e.TYPE_TEXT="text",e.TYPE_JSON="json",e.TYPE_SHEET="sheet",e.TYPE_FONT="font",e.TYPE_SOUND="sound",e}();e.ResourceItem=t,egret.registerClass(t,"RES.ResourceItem")}(RES||(RES={}));var RES;!function(e){var t=function(){function t(){this.keyMap={},this.groupDic={},e.configInstance=this}var r=t,i=r.prototype;return i.getGroupByName=function(e){var t=new Array;if(!this.groupDic[e])return t;for(var r=this.groupDic[e],i=r.length,n=0;i>n;n++){var s=r[n];t.push(this.parseResourceItem(s))}return t},i.getRawGroupByName=function(e){return this.groupDic[e]?this.groupDic[e]:[]},i.createGroup=function(e,t,r){if(void 0===r&&(r=!1),!r&&this.groupDic[e]||!t||0==t.length)return!1;for(var i=this.groupDic,n=[],s=t.length,a=0;s>a;a++){var o=t[a],u=i[o];if(u)for(var l=u.length,c=0;l>c;c++){var h=u[c];-1==n.indexOf(h)&&n.push(h)}else h=this.keyMap[o],h?-1==n.indexOf(h)&&n.push(h):egret.$warn(3200,o)}return 0==n.length?!1:(this.groupDic[e]=n,!0)},i.parseConfig=function(e,t){if(e){var r=e.resources;if(r)for(var i=r.length,n=0;i>n;n++){var s=r[n],a=s.url;a&&-1==a.indexOf("://")&&(s.url=t+a),this.addItemToKeyMap(s)}var o=e.groups;if(o)for(i=o.length,n=0;i>n;n++){for(var u=o[n],l=[],c=u.keys.split(","),h=c.length,f=0;h>f;f++){var d=c[f].trim();s=this.keyMap[d],s&&-1==l.indexOf(s)&&l.push(s)}this.groupDic[u.name]=l}}},i.addSubkey=function(e,t){var r=this.keyMap[t];r&&!this.keyMap[e]&&(this.keyMap[e]=r)},i.addItemToKeyMap=function(e){if(this.keyMap[e.name]||(this.keyMap[e.name]=e),e.hasOwnProperty("subkeys")){var t=e.subkeys.split(",");e.subkeys=t;for(var r=t.length,i=0;r>i;i++){var n=t[i];null==this.keyMap[n]&&(this.keyMap[n]=e)}}},i.getName=function(e){var t=this.keyMap[e];return t?t.name:""},i.getType=function(e){var t=this.keyMap[e];return t?t.type:""},i.getRawResourceItem=function(e){return this.keyMap[e]},i.getResourceItem=function(e){var t=this.keyMap[e];return t?this.parseResourceItem(t):null},i.parseResourceItem=function(t){var r=new e.ResourceItem(t.name,t.url,t.type);return r.data=t,r},t}();e.ResourceConfig=t,egret.registerClass(t,"RES.ResourceConfig")}(RES||(RES={}));var RES;!function(e){var t=function(t){function r(){t.call(this),this.thread=2,this.loadingCount=0,this.callBack=null,this.resInstance=null,this.groupTotalDic={},this.numLoadedDic={},this.itemListDic={},this.groupErrorDic={},this.retryTimesDic={},this.maxRetryTimes=3,this.failedList=new Array,this.priorityQueue={},this.lazyLoadList=new Array,this.analyzerDic={},this.queueIndex=0}__extends(r,t);var i=r,n=i.prototype;return n.isGroupInLoading=function(e){return void 0!==this.itemListDic[e]},n.loadGroup=function(t,r,i){if(void 0===i&&(i=0),!this.itemListDic[r]&&r){if(!t||0==t.length){egret.$warn(3201,r);var n=new e.ResourceEvent(e.ResourceEvent.GROUP_LOAD_ERROR);return n.groupName=r,void this.dispatchEvent(n)}this.priorityQueue[i]?this.priorityQueue[i].push(r):this.priorityQueue[i]=[r],this.itemListDic[r]=t;for(var s=t.length,a=0;s>a;a++){var o=t[a];o.groupName=r}this.groupTotalDic[r]=t.length,this.numLoadedDic[r]=0,this.next()}},n.loadItem=function(e){this.lazyLoadList.push(e),e.groupName="",this.next()},n.next=function(){for(;this.loadingCount<this.thread;){var e=this.getOneResourceItem();if(!e)break;if(this.loadingCount++,e.loaded)this.onItemComplete(e);else{var t=this.resInstance.$getAnalyzerByType(e.type);t.loadFile(e,this.onItemComplete,this)}}},n.getOneResourceItem=function(){if(this.failedList.length>0)return this.failedList.shift();var e=Number.NEGATIVE_INFINITY;for(var t in this.priorityQueue)e=Math.max(e,t);var r=this.priorityQueue[e];if(!r||0==r.length)return 0==this.lazyLoadList.length?null:this.lazyLoadList.pop();for(var i,n=r.length,s=0;n>s&&(this.queueIndex>=n&&(this.queueIndex=0),i=this.itemListDic[r[this.queueIndex]],!(i.length>0));s++)this.queueIndex++;return 0==i.length?null:i.shift()},n.onItemComplete=function(t){this.loadingCount--;var r=t.groupName;if(!t.loaded){var i=this.retryTimesDic[t.name]||1;if(!(i>this.maxRetryTimes))return this.retryTimesDic[t.name]=i+1,this.failedList.push(t),void this.next();delete this.retryTimesDic[t.name],e.ResourceEvent.dispatchResourceEvent(this.resInstance,e.ResourceEvent.ITEM_LOAD_ERROR,r,t)}if(r){this.numLoadedDic[r]++;var n=this.numLoadedDic[r],s=this.groupTotalDic[r];if(t.loaded||(this.groupErrorDic[r]=!0),e.ResourceEvent.dispatchResourceEvent(this.resInstance,e.ResourceEvent.GROUP_PROGRESS,r,t,n,s),n==s){var a=this.groupErrorDic[r];this.removeGroupName(r),delete this.groupTotalDic[r],delete this.numLoadedDic[r],delete this.itemListDic[r],delete this.groupErrorDic[r],a?e.ResourceEvent.dispatchResourceEvent(this,e.ResourceEvent.GROUP_LOAD_ERROR,r):e.ResourceEvent.dispatchResourceEvent(this,e.ResourceEvent.GROUP_COMPLETE,r)}}else this.callBack.call(this.resInstance,t);this.next()},n.removeGroupName=function(e){for(var t in this.priorityQueue){for(var r=this.priorityQueue[t],i=r.length,n=0,s=!1,i=r.length,a=0;i>a;a++){var o=r[a];if(o==e){r.splice(n,1),s=!0;break}n++}if(s){0==r.length&&delete this.priorityQueue[t];break}}},r}(egret.EventDispatcher);e.ResourceLoader=t,egret.registerClass(t,"RES.ResourceLoader")}(RES||(RES={}));var RES;!function(e){var t=function(e){function t(t,r,i){void 0===r&&(r=!1),void 0===i&&(i=!1),e.call(this,t,r,i),this.itemsLoaded=0,this.itemsTotal=0,this.groupName="",this.resItem=null}__extends(t,e);var r=t;return r.prototype,t.dispatchResourceEvent=function(e,r,i,n,s,a){void 0===i&&(i=""),void 0===n&&(n=null),void 0===s&&(s=0),void 0===a&&(a=0);var o=egret.Event.create(t,r);o.groupName=i,o.resItem=n,o.itemsLoaded=s,o.itemsTotal=a;var u=e.dispatchEvent(o);return egret.Event.release(o),u},t.ITEM_LOAD_ERROR="itemLoadError",t.CONFIG_COMPLETE="configComplete",t.CONFIG_LOAD_ERROR="configLoadError",t.GROUP_PROGRESS="groupProgress",t.GROUP_COMPLETE="groupComplete",t.GROUP_LOAD_ERROR="groupLoadError",t}(egret.Event);e.ResourceEvent=t,egret.registerClass(t,"RES.ResourceEvent")}(RES||(RES={}));var RES;!function(e){var t=function(t){function r(){t.call(this),this.resourceConfig=null,this.resourceConfig=e.configInstance}__extends(r,t);var i=r,n=i.prototype;return n.addSubkey=function(e,t){this.resourceConfig.addSubkey(e,t)},n.loadFile=function(){},n.getRes=function(){},n.destroyRes=function(){return!1},r.getStringPrefix=function(e){if(!e)return"";var t=e.indexOf(".");return-1!=t?e.substring(0,t):""},r.getStringTail=function(e){if(!e)return"";var t=e.indexOf(".");return-1!=t?e.substring(t+1):""},r}(egret.HashObject);e.AnalyzerBase=t,egret.registerClass(t,"RES.AnalyzerBase")}(RES||(RES={}));var RES;!function(e){var t=function(t){function r(){t.call(this),this.fileDic={},this.resItemDic=[],this._dataFormat=egret.HttpResponseType.ARRAY_BUFFER,this.recycler=[]}__extends(r,t);var i=r,n=i.prototype;return n.loadFile=function(t,r,i){if(this.fileDic[t.name])return void r.call(i,t);var n=this.getRequest();this.resItemDic[n.hashCode]={item:t,func:r,thisObject:i},n.open(e.$getVirtualUrl(t.url)),n.send()},n.getRequest=function(){var e=this.recycler.pop();return e||(e=new egret.HttpRequest,e.addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this)),e.responseType=this._dataFormat,e},n.onLoadFinish=function(e){var t=e.target,r=this.resItemDic[t.hashCode];delete this.resItemDic[t.hashCode];var i=r.item,n=r.func;i.loaded=e.type==egret.Event.COMPLETE,i.loaded&&this.analyzeData(i,t.response),this.recycler.push(t),n.call(r.thisObject,i)},n.analyzeData=function(e,t){var r=e.name;this.fileDic[r]||""!=t&&!t||(this.fileDic[r]=t)},n.getRes=function(e){return this.fileDic[e]},n.hasRes=function(e){var t=this.getRes(e);return null!=t},n.destroyRes=function(e){return this.fileDic[e]?(this.onResourceDestroy(this.fileDic[e]),delete this.fileDic[e],!0):!1},n.onResourceDestroy=function(){},r}(e.AnalyzerBase);e.BinAnalyzer=t,egret.registerClass(t,"RES.BinAnalyzer")}(RES||(RES={}));var RES;!function(e){var t=function(t){function r(){t.call(this),this.fileDic={},this.resItemDic=[],this.recycler=[]}__extends(r,t);var i=r,n=i.prototype;return n.loadFile=function(t,r,i){if(this.fileDic[t.name])return void r.call(i,t);var n=this.getLoader();this.resItemDic[n.$hashCode]={item:t,func:r,thisObject:i},n.load(e.$getVirtualUrl(t.url))},n.getLoader=function(){var e=this.recycler.pop();return e||(e=new egret.ImageLoader,e.addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this)),e},n.onLoadFinish=function(e){var t=e.$target,r=this.resItemDic[t.$hashCode];delete this.resItemDic[t.$hashCode];var i=r.item,n=r.func;if(i.loaded=e.$type==egret.Event.COMPLETE,i.loaded){var s=new egret.Texture;s._setBitmapData(t.data),this.analyzeData(i,s)}this.recycler.push(t),n.call(r.thisObject,i)},n.analyzeData=function(e,t){var r=e.name;if(!this.fileDic[r]&&t){this.fileDic[r]=t;var i=e.data;if(i&&i.scale9grid){var n=i.scale9grid,s=n.split(",");t.scale9Grid=new egret.Rectangle(parseInt(s[0]),parseInt(s[1]),parseInt(s[2]),parseInt(s[3]))}}},n.getRes=function(e){return this.fileDic[e]},n.hasRes=function(e){var t=this.getRes(e);return null!=t},n.destroyRes=function(e){return this.fileDic[e]?(this.onResourceDestroy(this.fileDic[e]),delete this.fileDic[e],!0):!1},n.onResourceDestroy=function(e){e.dispose()},r}(e.AnalyzerBase);e.ImageAnalyzer=t,egret.registerClass(t,"RES.ImageAnalyzer")}(RES||(RES={}));var RES;!function(e){var t=function(e){function t(){e.call(this),this._dataFormat=egret.HttpResponseType.TEXT}__extends(t,e);var r=t;return r.prototype,t}(e.BinAnalyzer);e.TextAnalyzer=t,egret.registerClass(t,"RES.TextAnalyzer")}(RES||(RES={}));var RES;!function(e){var t=function(e){function t(){e.call(this),this._dataFormat=egret.HttpResponseType.TEXT}__extends(t,e);var r=t,i=r.prototype;return i.analyzeData=function(e,t){var r=e.name;if(!this.fileDic[r]&&t)try{var i=t;this.fileDic[r]=JSON.parse(i)}catch(n){egret.$warn(1017,e.url,t)}},t}(e.BinAnalyzer);e.JsonAnalyzer=t,egret.registerClass(t,"RES.JsonAnalyzer")}(RES||(RES={}));var RES;!function(e){var t=function(t){function r(){t.call(this),this.sheetMap={},this.textureMap={},this.recyclerIamge=[],this._dataFormat=egret.HttpResponseType.TEXT}__extends(r,t);var i=r,n=i.prototype;return n.getRes=function(t){var r=this.fileDic[t];if(r||(r=this.textureMap[t]),!r){var i=e.AnalyzerBase.getStringPrefix(t);if(r=this.fileDic[i]){var n=e.AnalyzerBase.getStringTail(t);r=r.getTexture(n)}}return r},n.onLoadFinish=function(e){var t=e.target,r=this.resItemDic[t.$hashCode];delete this.resItemDic[t.hashCode];var i=r.item,n=r.func;if(i.loaded=e.type==egret.Event.COMPLETE,i.loaded)if(t instanceof egret.HttpRequest){i.loaded=!1;var s=this.analyzeConfig(i,t.response);if(s)return this.loadImage(s,r),void this.recycler.push(t)}else{var a=new egret.Texture;a._setBitmapData(t.data),this.analyzeBitmap(i,a)}t instanceof egret.HttpRequest?this.recycler.push(t):this.recyclerIamge.push(t),n.call(r.thisObject,i)},n.analyzeConfig=function(e,t){var r,i=e.name,n="";try{var s=t;r=JSON.parse(s)}catch(a){egret.$warn(1017,e.url,t)}return r&&(this.sheetMap[i]=r,n=this.getRelativePath(e.url,r.file)),n},n.analyzeBitmap=function(e,t){var r=e.name;if(!this.fileDic[r]&&t){var i=this.sheetMap[r];delete this.sheetMap[r];var n=e.data&&e.data.subkeys?"":r,s=this.parseSpriteSheet(t,i,n);this.fileDic[r]=s}},n.getRelativePath=function(e,t){e=e.split("\\").join("/");var r=e.match(/#.*|\?.*/),i="";r&&(i=r[0]);var n=e.lastIndexOf("/");return e=-1!=n?e.substring(0,n+1)+t:t,e+i},n.parseSpriteSheet=function(e,t,r){var i=t.frames;if(!i)return null;var n=new egret.SpriteSheet(e),s=this.textureMap;for(var a in i){var o=i[a],e=n.createTexture(a,o.x,o.y,o.w,o.h,o.offX,o.offY,o.sourceW,o.sourceH);if(o.scale9grid){var u=o.scale9grid,l=u.split(",");e.scale9Grid=new egret.Rectangle(parseInt(l[0]),parseInt(l[1]),parseInt(l[2]),parseInt(l[3]))}null==s[a]&&(s[a]=e,r&&this.addSubkey(a,r))}return n},n.destroyRes=function(e){var t=this.fileDic[e];if(t){delete this.fileDic[e];var r;for(var i in t._textureMap)null==r&&(r=t._textureMap[i],this.onResourceDestroy(r),r=null),delete this.textureMap[i];return t.dispose&&t.dispose(),!0}return!1},n.loadImage=function(t,r){var i=this.getImageLoader();this.resItemDic[i.hashCode]=r,i.load(e.$getVirtualUrl(t))},n.getImageLoader=function(){var e=this.recyclerIamge.pop();return e||(e=new egret.ImageLoader,e.addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this)),e},n.onResourceDestroy=function(e){e&&e.dispose()},r}(e.BinAnalyzer);e.SheetAnalyzer=t,egret.registerClass(t,"RES.SheetAnalyzer")}(RES||(RES={}));var RES;!function(e){var t=function(e){function t(){e.call(this)}__extends(t,e);var r=t,i=r.prototype;return i.analyzeConfig=function(e,t){var r,i=e.name,n="";try{var s=t;r=JSON.parse(s)}catch(a){}return r?n=this.getRelativePath(e.url,r.file):(r=t,n=this.getTexturePath(e.url,r)),this.sheetMap[i]=r,n},i.analyzeBitmap=function(e,t){var r=e.name;if(!this.fileDic[r]&&t){var i=this.sheetMap[r];delete this.sheetMap[r];var n=new egret.BitmapFont(t,i);this.fileDic[r]=n}},i.getTexturePath=function(e,t){var r="",i=t.split("\n"),n=i[2],s=n.indexOf('file="');-1!=s&&(n=n.substring(s+6),s=n.indexOf('"'),r=n.substring(0,s)),e=e.split("\\").join("/");var s=e.lastIndexOf("/");return e=-1!=s?e.substring(0,s+1)+r:r},i.onResourceDestroy=function(e){e&&e.dispose()},t}(e.SheetAnalyzer);e.FontAnalyzer=t,egret.registerClass(t,"RES.FontAnalyzer")}(RES||(RES={}));var RES;!function(e){var t=function(t){function r(){t.call(this),this.soundDic={},this.resItemDic=[]}__extends(r,t);var i=r,n=i.prototype;return n.loadFile=function(t,r,i){if(this.soundDic[t.name])return void r.call(i,t);var n=new egret.Sound;n.addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),n.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this),this.resItemDic[n.$hashCode]={item:t,func:r,thisObject:i},n.load(e.$getVirtualUrl(t.url)),t.data&&(n.type=t.data.soundType)},n.onLoadFinish=function(e){var t=e.$target;t.removeEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),t.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this);var r=this.resItemDic[t.$hashCode];delete this.resItemDic[t.$hashCode];var i=r.item,n=r.func;i.loaded=e.$type==egret.Event.COMPLETE,i.loaded&&this.analyzeData(i,t),n.call(r.thisObject,i)},n.analyzeData=function(e,t){var r=e.name;!this.soundDic[r]&&t&&(this.soundDic[r]=t)},n.getRes=function(e){return this.soundDic[e]},n.hasRes=function(e){return!!this.getRes(e)},n.destroyRes=function(e){return this.soundDic[e]?(delete this.soundDic[e],!0):!1},r}(e.AnalyzerBase);e.SoundAnalyzer=t,egret.registerClass(t,"RES.SoundAnalyzer")}(RES||(RES={}));var RES;!function(e){var t=function(e){function t(){e.call(this),this._dataFormat=egret.HttpResponseType.TEXT}__extends(t,e);var r=t,i=r.prototype;return i.analyzeData=function(e,t){var r=e.name;if(!this.fileDic[r]&&t)try{var i=t,n=egret.XML.parse(i);this.fileDic[r]=n}catch(s){}},t}(e.BinAnalyzer);e.XMLAnalyzer=t,egret.registerClass(t,"RES.XMLAnalyzer")}(RES||(RES={}));var RES;!function(){}(RES||(RES={}));var RES;!function(e){var t;!function(t){var r=function(e){function t(){e.call(this),this._versionInfo={}}__extends(t,e);var r=t,i=r.prototype;return i.fetchVersion=function(e){e.onSuccess(null)},i.getChangeList=function(){return[]},i.getVirtualUrl=function(e){return e},t}(egret.EventDispatcher);t.Html5VersionController=r,egret.registerClass(r,"RES.web.Html5VersionController",["RES.VersionController","RES.IVersionController"]),egret.Capabilities.runtimeType==egret.RuntimeType.WEB&&(e.VersionController=r)}(t=e.web||(e.web={}))}(RES||(RES={}));var RES;!function(e){var t;!function(t){var r=function(){function e(){this._versionInfo={},this._versionPath="",this._localFileArr=[]}var t=e,r=t.prototype;return r.fetchVersion=function(e){var t=this;if(t._versionPath="all.manifest",t._versionInfo=t.getLocalData(t._versionPath),null==t._versionInfo)return void egret.callLater(function(){e.onFail(1,null)},t);var r=0,i=function(i){if(i)for(var n=0;n<i.length;n++)i[n]&&""!=i[n]&&t._localFileArr.push("resource/"+i[n]);r++,2==r&&e.onSuccess(null)};t.getList(i,"assets","resource"),t.getList(i,"update","resource")},r.getList=function(e,t,r){void 0===r&&(r="");var i=egret.PromiseObject.create();i.onSuccessFunc=function(t){e(t)},i.onErrorFunc=function(){console.error("list files error")},"assets"==t?egret_native.Game.listResource(r,i):egret_native.Game.listUpdate(r,i)},r.getChangeList=function(){var e=[],t=this._localFileArr;for(var r in this._versionInfo)t.indexOf(this.getVirtualUrl(r))<0&&e.push({url:this.getVirtualUrl(r),size:this._versionInfo[r].s});return e},r.getVirtualUrl=function(e){return this._versionInfo&&this._versionInfo[e]?"resource/"+this._versionInfo[e].v.substring(0,2)+"/"+this._versionInfo[e].v+"_"+this._versionInfo[e].s+"."+e.substring(e.lastIndexOf(".")+1):e},r.getLocalData=function(e){if(egret_native.readUpdateFileSync&&egret_native.readResourceFileSync){var t=egret_native.readUpdateFileSync(e);if(null!=t)return JSON.parse(t);if(t=egret_native.readResourceFileSync(e),null!=t)return JSON.parse(t)}return null},e}();t.NativeVersionController=r,egret.registerClass(r,"RES.native.NativeVersionController",["RES.VersionController","RES.IVersionController"]),egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE&&(e.VersionController=r)}(t=e["native"]||(e["native"]={}))}(RES||(RES={}));var RES;!function(e){function t(e,t){I.registerAnalyzer(e,t)}function r(e){I.$registerVersionController(e)}function i(){return I.vcs}function n(e,t,r){void 0===t&&(t=""),void 0===r&&(r="json"),I.loadConfig(e,t,r)}function s(e,t){void 0===t&&(t=0),I.loadGroup(e,t)}function a(e){return I.isGroupLoaded(e)}function o(e){return I.getGroupByName(e)}function u(e,t,r){return void 0===r&&(r=!1),I.createGroup(e,t,r)}function l(e){return I.hasRes(e)}function c(e,t){void 0===t&&(t=""),I.parseConfig(e,t)}function h(e){return I.getRes(e)}function f(e,t,r){I.getResAsync(e,t,r)}function d(e,t,r,i){void 0===i&&(i=""),I.getResByUrl(e,t,r,i)}function g(e,t){return I.destroyRes(e,t)}function p(e){I.setMaxLoadingThread(e)}function v(e){I.setMaxRetryTimes(e)}function y(e,t,r,i,n){void 0===i&&(i=!1),void 0===n&&(n=0),I.addEventListener(e,t,r,i,n)}function R(e,t,r,i){void 0===i&&(i=!1),I.removeEventListener(e,t,r,i)}function E(e){return I.vcs?I.vcs.getVirtualUrl(e):e}e.registerAnalyzer=t,e.registerVersionController=r,e.getVersionController=i,e.loadConfig=n,e.loadGroup=s,e.isGroupLoaded=a,e.getGroupByName=o,e.createGroup=u,e.hasRes=l,e.parseConfig=c,e.getRes=h,e.getResAsync=f,e.getResByUrl=d,e.destroyRes=g,e.setMaxLoadingThread=p,e.setMaxRetryTimes=v,e.addEventListener=y,e.removeEventListener=R,e.$getVirtualUrl=E;var m=function(t){function r(){t.call(this),this.analyzerDic={},this.analyzerClassMap={},this.configItemList=[],this.callLaterFlag=!1,this.configComplete=!1,this.loadedGroups=[],this.groupNameList=[],this.asyncDic={},this._loadedUrlTypes={},this.init()}__extends(r,t);var i=r,n=i.prototype;return n.$getAnalyzerByType=function(e){var t=this.analyzerDic[e];if(!t){var r=this.analyzerClassMap[e];if(!r)return null;t=this.analyzerDic[e]=new r}return t},n.registerAnalyzer=function(e,t){this.analyzerClassMap[e]=t},n.$registerVersionController=function(e){this.vcs=e},n.init=function(){this.vcs=new e.VersionController;var t=this.analyzerClassMap;t[e.ResourceItem.TYPE_BIN]=e.BinAnalyzer,t[e.ResourceItem.TYPE_IMAGE]=e.ImageAnalyzer,t[e.ResourceItem.TYPE_TEXT]=e.TextAnalyzer,t[e.ResourceItem.TYPE_JSON]=e.JsonAnalyzer,t[e.ResourceItem.TYPE_SHEET]=e.SheetAnalyzer,t[e.ResourceItem.TYPE_FONT]=e.FontAnalyzer,t[e.ResourceItem.TYPE_SOUND]=e.SoundAnalyzer,t[e.ResourceItem.TYPE_XML]=e.XMLAnalyzer,this.resConfig=new e.ResourceConfig,this.resLoader=new e.ResourceLoader,this.resLoader.callBack=this.onResourceItemComp,this.resLoader.resInstance=this,this.resLoader.addEventListener(e.ResourceEvent.GROUP_COMPLETE,this.onGroupComp,this),this.resLoader.addEventListener(e.ResourceEvent.GROUP_LOAD_ERROR,this.onGroupError,this)},n.loadConfig=function(e,t,r){void 0===r&&(r="json");var i={url:e,resourceRoot:t,type:r};this.configItemList.push(i),this.callLaterFlag||(egret.callLater(this.startLoadConfig,this),this.callLaterFlag=!0)},n.startLoadConfig=function(){var t=this;this.callLaterFlag=!1;var i=this.configItemList;this.configItemList=[],this.loadingConfigList=i;for(var n=i.length,s=[],a=0;n>a;a++){var o=i[a],u=new e.ResourceItem(o.url,o.url,o.type);s.push(u)}var l={onSuccess:function(){t.resLoader.loadGroup(s,r.GROUP_CONFIG,Number.MAX_VALUE)},onFail:function(){e.ResourceEvent.dispatchResourceEvent(t,e.ResourceEvent.CONFIG_LOAD_ERROR)}};this.vcs?this.vcs.fetchVersion(l):this.resLoader.loadGroup(s,r.GROUP_CONFIG,Number.MAX_VALUE)},n.isGroupLoaded=function(e){return-1!=this.loadedGroups.indexOf(e)},n.getGroupByName=function(e){return this.resConfig.getGroupByName(e)},n.loadGroup=function(t,r){if(void 0===r&&(r=0),-1!=this.loadedGroups.indexOf(t))return void e.ResourceEvent.dispatchResourceEvent(this,e.ResourceEvent.GROUP_COMPLETE,t);if(!this.resLoader.isGroupInLoading(t))if(this.configComplete){var i=this.resConfig.getGroupByName(t);this.resLoader.loadGroup(i,t,r)}else this.groupNameList.push({name:t,priority:r})},n.createGroup=function(e,t,r){if(void 0===r&&(r=!1),r){var i=this.loadedGroups.indexOf(e);-1!=i&&this.loadedGroups.splice(i,1)}return this.resConfig.createGroup(e,t,r)},n.onGroupComp=function(t){if(t.groupName==r.GROUP_CONFIG){for(var i=this.loadingConfigList.length,n=0;i>n;n++){var s=this.loadingConfigList[n],a=this.$getAnalyzerByType(s.type),o=a.getRes(s.url);a.destroyRes(s.url),this.resConfig.parseConfig(o,s.resourceRoot)}this.configComplete=!0,this.loadingConfigList=null,e.ResourceEvent.dispatchResourceEvent(this,e.ResourceEvent.CONFIG_COMPLETE),this.loadDelayGroups()}else this.loadedGroups.push(t.groupName),this.dispatchEvent(t)},n.loadDelayGroups=function(){var e=this.groupNameList;this.groupNameList=[];for(var t=e.length,r=0;t>r;r++){var i=e[r];this.loadGroup(i.name,i.priority)}},n.onGroupError=function(t){t.groupName==r.GROUP_CONFIG?(this.loadingConfigList=null,e.ResourceEvent.dispatchResourceEvent(this,e.ResourceEvent.CONFIG_LOAD_ERROR)):this.dispatchEvent(t)},n.hasRes=function(t){var r=this.resConfig.getType(t);if(""==r){var i=e.AnalyzerBase.getStringTail(t);if(r=this.resConfig.getType(i),""==r)return!1}return!0},n.parseConfig=function(e,t){this.resConfig.parseConfig(e,t),this.configComplete||this.loadingConfigList||(this.configComplete=!0,this.loadDelayGroups())},n.getRes=function(t){var r=this.resConfig.getType(t);if(""==r){var i=e.AnalyzerBase.getStringPrefix(t);if(r=this.resConfig.getType(i),""==r)return null}var n=this.$getAnalyzerByType(r);return n.getRes(t)},n.getResAsync=function(t,r,i){var n=this.resConfig.getType(t),s=this.resConfig.getName(t);if(""==n&&(s=e.AnalyzerBase.getStringPrefix(t),n=this.resConfig.getType(s),""==n))return void egret.$callAsync(r,i);var a=this.$getAnalyzerByType(n),o=a.getRes(t);if(o)return void egret.$callAsync(r,i,o,t);var u={key:t,compFunc:r,thisObject:i};if(this.asyncDic[s])this.asyncDic[s].push(u);else{this.asyncDic[s]=[u];var l=this.resConfig.getResourceItem(s);this.resLoader.loadItem(l)}},n.getResByUrl=function(t,r,i,n){if(void 0===n&&(n=""),!t)return void egret.$callAsync(r,i);n||(n=this.getTypeByUrl(t)),null!=this._loadedUrlTypes[t]&&this._loadedUrlTypes[t]!=n&&egret.$warn(3202),this._loadedUrlTypes[t]=n;var s=this.$getAnalyzerByType(n),a=t,o=s.getRes(a);if(o)return void egret.$callAsync(r,i,o,t);var u={key:a,compFunc:r,thisObject:i};if(this.asyncDic[a])this.asyncDic[a].push(u);else{this.asyncDic[a]=[u];var l=new e.ResourceItem(a,t,n);this.resLoader.loadItem(l)}},n.getTypeByUrl=function(t){var r=t.substr(t.lastIndexOf(".")+1);r&&(r=r.toLowerCase());var i;switch(r){case e.ResourceItem.TYPE_XML:case e.ResourceItem.TYPE_JSON:case e.ResourceItem.TYPE_SHEET:i=r;break;case"png":case"jpg":case"gif":case"jpeg":case"bmp":i=e.ResourceItem.TYPE_IMAGE;break;case"fnt":i=e.ResourceItem.TYPE_FONT;break;case"txt":i=e.ResourceItem.TYPE_TEXT;break;case"mp3":case"ogg":case"mpeg":case"wav":case"m4a":case"mp4":case"aiff":case"wma":case"mid":i=e.ResourceItem.TYPE_SOUND;break;default:i=e.ResourceItem.TYPE_BIN}return i},n.onResourceItemComp=function(e){var t=this.asyncDic[e.name];delete this.asyncDic[e.name];for(var r=this.$getAnalyzerByType(e.type),i=t.length,n=0;i>n;n++){var s=t[n],a=r.getRes(s.key);s.compFunc.call(s.thisObject,a,s.key)}},n.destroyRes=function(e,t){void 0===t&&(t=!0);var r=this.resConfig.getRawGroupByName(e);if(r&&r.length>0){var i=this.loadedGroups.indexOf(e);-1!=i&&this.loadedGroups.splice(i,1);for(var n=r.length,s=0;n>s;s++){var a=r[s];if(!t&&this.isResInLoadedGroup(a.name));else{a.loaded=!1;var o=this.$getAnalyzerByType(a.type);o.destroyRes(a.name),this.removeLoadedGroupsByItemName(a.name)}}return!0}var u=this.resConfig.getType(e);if(""==u){if(u=this._loadedUrlTypes[e],null==u||""==u)return!1;delete this._loadedUrlTypes[e];var o=this.$getAnalyzerByType(u);return o.destroyRes(e),!0}a=this.resConfig.getRawResourceItem(e),a.loaded=!1,o=this.$getAnalyzerByType(u);var l=o.destroyRes(e);return this.removeLoadedGroupsByItemName(a.name),l},n.removeLoadedGroupsByItemName=function(e){for(var t=this.loadedGroups,r=t.length,i=0;r>i;i++)for(var n=this.resConfig.getRawGroupByName(t[i]),s=n.length,a=0;s>a;a++){var o=n[a];if(o.name==e){t.splice(i,1),i--,r=t.length;break}}},n.isResInLoadedGroup=function(e){for(var t=this.loadedGroups,r=t.length,i=0;r>i;i++)for(var n=this.resConfig.getRawGroupByName(t[i]),s=n.length,a=0;s>a;a++){var o=n[a];if(o.name==e)return!0}return!1},n.setMaxLoadingThread=function(e){1>e&&(e=1),this.resLoader.thread=e},n.setMaxRetryTimes=function(e){e=Math.max(e,0),this.resLoader.maxRetryTimes=e},r.GROUP_CONFIG="RES__CONFIG",r}(egret.EventDispatcher);egret.registerClass(m,"Resource");var I=new m}(RES||(RES={}));var RES;!function(e){var t=function(t){function r(){t.call(this),this.sheetMap={},this.recyclerIamge=[],this._dataFormat=egret.HttpResponseType.TEXT}__extends(r,t);var i=r,n=i.prototype;return n.onLoadFinish=function(e){var t=e.target,r=this.resItemDic[t.$hashCode];delete this.resItemDic[t.hashCode];var i=r.item,n=r.func;if(i.loaded=e.type==egret.Event.COMPLETE,i.loaded)if(t instanceof egret.HttpRequest){i.loaded=!1;var s=this.analyzeConfig(i,t.response);if(s)return this.loadImage(s,r),void this.recycler.push(t)}else this.analyzeBitmap(i,t.data);t instanceof egret.HttpRequest?this.recycler.push(t):this.recyclerIamge.push(t),n.call(r.thisObject,i)},n.analyzeConfig=function(e,t){var r,i=e.name,n="";try{var s=t;r=JSON.parse(s)}catch(a){egret.$warn(1017,e.url,t)}if(r)if(this.sheetMap[i]=r,r.file)n=this.getRelativePath(e.url,r.file);else{var o=e.url.split("?"),u=o[0].split("/");u[u.length-1]=u[u.length-1].split(".")[0]+".png",n="";for(var l=0;l<u.length;l++)n+=u[l]+(l<u.length-1?"/":"");2==o.length&&(n+=o[2])}return n},n.analyzeBitmap=function(e,t){var r=e.name;if(!this.fileDic[r]&&t){var i=this.sheetMap[r];delete this.sheetMap[r];var n=e.data&&e.data.subkeys?"":r,s=this.parseAnimation(t,i,n);this.fileDic[r]=s}},n.getRelativePath=function(e,t){e=e.split("\\").join("/");var r=e.lastIndexOf("/");return e=-1!=r?e.substring(0,r+1)+t:t},n.parseAnimation=function(e,t){for(var r,i=Object.keys(t.mc),n=t.mc[i[0]].frames,s=n.length,a=[],o=0;s>o;o++){r=t.res[n[o].res];var u=new egret.Texture;u._bitmapData=e,u.$initData(r.x,r.y,r.w,r.h,n[o].x,n[o].y,n[o].sourceW,n[o].sourceH,e.width,e.height)}return a},n.destroyRes=function(e){var t=this.fileDic[e];return t?(delete this.fileDic[e],!0):!1},n.loadImage=function(t,r){var i=this.getImageLoader();this.resItemDic[i.hashCode]=r,i.load(e.$getVirtualUrl(t))},n.getImageLoader=function(){var e=this.recyclerIamge.pop();return e||(e=new egret.ImageLoader,e.addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this)),e},r}(e.BinAnalyzer);e.AnimationAnalyzer=t,egret.registerClass(t,"RES.AnimationAnalyzer")}(RES||(RES={}));var egret;!function(e){e.$locale_strings=e.$locale_strings||{},e.$locale_strings.en_US=e.$locale_strings.en_US||{};var t=e.$locale_strings.en_US;t[3200]="RES.createGroup() passed in non-existed key value in configuration: {0}",t[3201]='RES loaded non-existed or empty resource group:"{0}"',t[3202]="Do not use the different types of ways to load the same material!",t[3203]="Can't find the analyzer of the specified file type:{0} Please register the specified analyzer in the initialization of the project first,then start the resource loading process"}(egret||(egret={}));var egret;!function(e){e.$locale_strings=e.$locale_strings||{},e.$locale_strings.zh_CN=e.$locale_strings.zh_CN||{};var t=e.$locale_strings.zh_CN;t[3200]="RES.createGroup(): {0}",t[3201]='RES:"{0}"',t[3202]="",t[3203]=":{0} "}(egret||(egret={}));
;/*!libs/libs/modules/tween/tween.min.js*/
var egret;!function(t){var e=function(){function e(){t.$error(1014)}var n=e;return n.prototype,e.get=function(t){return-1>t&&(t=-1),t>1&&(t=1),function(e){return 0==t?e:0>t?e*(e*-t+1+t):e*((2-e)*t+(1-t))}},e.getPowIn=function(t){return function(e){return Math.pow(e,t)}},e.getPowOut=function(t){return function(e){return 1-Math.pow(1-e,t)}},e.getPowInOut=function(t){return function(e){return(e*=2)<1?.5*Math.pow(e,t):1-.5*Math.abs(Math.pow(2-e,t))}},e.sineIn=function(t){return 1-Math.cos(t*Math.PI/2)},e.sineOut=function(t){return Math.sin(t*Math.PI/2)},e.sineInOut=function(t){return-.5*(Math.cos(Math.PI*t)-1)},e.getBackIn=function(t){return function(e){return e*e*((t+1)*e-t)}},e.getBackOut=function(t){return function(e){return--e*e*((t+1)*e+t)+1}},e.getBackInOut=function(t){return t*=1.525,function(e){return(e*=2)<1?.5*e*e*((t+1)*e-t):.5*((e-=2)*e*((t+1)*e+t)+2)}},e.circIn=function(t){return-(Math.sqrt(1-t*t)-1)},e.circOut=function(t){return Math.sqrt(1- --t*t)},e.circInOut=function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},e.bounceIn=function(t){return 1-e.bounceOut(1-t)},e.bounceOut=function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},e.bounceInOut=function(t){return.5>t?.5*e.bounceIn(2*t):.5*e.bounceOut(2*t-1)+.5},e.getElasticIn=function(t,e){var n=2*Math.PI;return function(i){if(0==i||1==i)return i;var s=e/n*Math.asin(1/t);return-(t*Math.pow(2,10*(i-=1))*Math.sin((i-s)*n/e))}},e.getElasticOut=function(t,e){var n=2*Math.PI;return function(i){if(0==i||1==i)return i;var s=e/n*Math.asin(1/t);return t*Math.pow(2,-10*i)*Math.sin((i-s)*n/e)+1}},e.getElasticInOut=function(t,e){var n=2*Math.PI;return function(i){var s=e/n*Math.asin(1/t);return(i*=2)<1?-.5*t*Math.pow(2,10*(i-=1))*Math.sin((i-s)*n/e):t*Math.pow(2,-10*(i-=1))*Math.sin((i-s)*n/e)*.5+1}},e.quadIn=e.getPowIn(2),e.quadOut=e.getPowOut(2),e.quadInOut=e.getPowInOut(2),e.cubicIn=e.getPowIn(3),e.cubicOut=e.getPowOut(3),e.cubicInOut=e.getPowInOut(3),e.quartIn=e.getPowIn(4),e.quartOut=e.getPowOut(4),e.quartInOut=e.getPowInOut(4),e.quintIn=e.getPowIn(5),e.quintOut=e.getPowOut(5),e.quintInOut=e.getPowInOut(5),e.backIn=e.getBackIn(1.7),e.backOut=e.getBackOut(1.7),e.backInOut=e.getBackInOut(1.7),e.elasticIn=e.getElasticIn(1,.3),e.elasticOut=e.getElasticOut(1,.3),e.elasticInOut=e.getElasticInOut(1,.3*1.5),e}();t.Ease=e,t.registerClass(e,"egret.Ease")}(egret||(egret={}));var egret;!function(t){var e=function(e){function n(t,n,i){e.call(this),this._target=null,this._useTicks=!1,this.ignoreGlobalPause=!1,this.loop=!1,this.pluginData=null,this._steps=null,this._actions=null,this.paused=!1,this.duration=0,this._prevPos=-1,this.position=null,this._prevPosition=0,this._stepPosition=0,this.passive=!1,this.initialize(t,n,i)}__extends(n,e);var i=n,s=i.prototype;return n.get=function(t,e,i,s){return void 0===e&&(e=null),void 0===i&&(i=null),void 0===s&&(s=!1),s&&n.removeTweens(t),new n(t,e,i)},n.removeTweens=function(t){if(t.tween_count){for(var e=n._tweens,i=e.length-1;i>=0;i--)e[i]._target==t&&(e[i].paused=!0,e.splice(i,1));t.tween_count=0}},n.pauseTweens=function(e){if(e.tween_count)for(var n=t.Tween._tweens,i=n.length-1;i>=0;i--)n[i]._target==e&&(n[i].paused=!0)},n.resumeTweens=function(e){if(e.tween_count)for(var n=t.Tween._tweens,i=n.length-1;i>=0;i--)n[i]._target==e&&(n[i].paused=!1)},n.tick=function(t,e){void 0===e&&(e=!1);var i=t-n._lastTime;n._lastTime=t;for(var s=n._tweens.concat(),r=s.length-1;r>=0;r--){var u=s[r];e&&!u.ignoreGlobalPause||u.paused||u.tick(u._useTicks?1:i)}return!1},n._register=function(e,i){var s=e._target,r=n._tweens;if(i)s&&(s.tween_count=s.tween_count>0?s.tween_count+1:1),r.push(e),n._inited||(n._lastTime=t.getTimer(),t.sys.$ticker.$startTick(n.tick,null),n._inited=!0);else{s&&s.tween_count--;for(var u=r.length;u--;)if(r[u]==e)return void r.splice(u,1)}},n.removeAllTweens=function(){for(var t=n._tweens,e=0,i=t.length;i>e;e++){var s=t[e];s.paused=!0,s._target.tweenjs_count=0}t.length=0},s.initialize=function(t,e,i){this._target=t,e&&(this._useTicks=e.useTicks,this.ignoreGlobalPause=e.ignoreGlobalPause,this.loop=e.loop,e.onChange&&this.addEventListener("change",e.onChange,e.onChangeObj),e.override&&n.removeTweens(t)),this.pluginData=i||{},this._curQueueProps={},this._initQueueProps={},this._steps=[],this._actions=[],e&&e.paused?this.paused=!0:n._register(this,!0),e&&null!=e.position&&this.setPosition(e.position,n.NONE)},s.setPosition=function(t,e){void 0===e&&(e=1),0>t&&(t=0);var n=t,i=!1;if(n>=this.duration&&(this.loop?n%=this.duration:(n=this.duration,i=!0)),n==this._prevPos)return i;var s=this._prevPos;if(this.position=this._prevPos=n,this._prevPosition=t,this._target)if(i)this._updateTargetProps(null,1);else if(this._steps.length>0){for(var r=0,u=this._steps.length;u>r&&!(this._steps[r].t>n);r++);var o=this._steps[r-1];this._updateTargetProps(o,(this._stepPosition=n-o.t)/o.d)}return i&&this.setPaused(!0),0!=e&&this._actions.length>0&&(this._useTicks?this._runActions(n,n):1==e&&s>n?(s!=this.duration&&this._runActions(s,this.duration),this._runActions(0,n,!0)):this._runActions(s,n)),this.dispatchEventWith("change"),i},s._runActions=function(t,e,n){void 0===n&&(n=!1);var i=t,s=e,r=-1,u=this._actions.length,o=1;for(t>e&&(i=e,s=t,r=u,u=o=-1);(r+=o)!=u;){var a=this._actions[r],h=a.t;(h==s||h>i&&s>h||n&&h==t)&&a.f.apply(a.o,a.p)}},s._updateTargetProps=function(t,e){var i,s,r,u,o,a;if(t||1!=e){if(this.passive=!!t.v,this.passive)return;t.e&&(e=t.e(e,0,1,1)),i=t.p0,s=t.p1}else this.passive=!1,i=s=this._curQueueProps;for(var h in this._initQueueProps){null==(u=i[h])&&(i[h]=u=this._initQueueProps[h]),null==(o=s[h])&&(s[h]=o=u),r=u==o||0==e||1==e||"number"!=typeof u?1==e?o:u:u+(o-u)*e;var c=!1;if(a=n._plugins[h])for(var p=0,_=a.length;_>p;p++){var f=a[p].tween(this,h,r,i,s,e,!!t&&i==s,!t);f==n.IGNORE?c=!0:r=f}c||(this._target[h]=r)}},s.setPaused=function(t){return this.paused=t,n._register(this,!t),this},s._cloneProps=function(t){var e={};for(var n in t)e[n]=t[n];return e},s._addStep=function(t){return t.d>0&&(this._steps.push(t),t.t=this.duration,this.duration+=t.d),this},s._appendQueueProps=function(t){var e,i,s,r,u;for(var o in t)if(void 0===this._initQueueProps[o]){if(i=this._target[o],e=n._plugins[o])for(s=0,r=e.length;r>s;s++)i=e[s].init(this,o,i);this._initQueueProps[o]=this._curQueueProps[o]=void 0===i?null:i}else i=this._curQueueProps[o];for(var o in t){if(i=this._curQueueProps[o],e=n._plugins[o])for(u=u||{},s=0,r=e.length;r>s;s++)e[s].step&&e[s].step(this,o,i,t[o],u);this._curQueueProps[o]=t[o]}return u&&this._appendQueueProps(u),this._curQueueProps},s._addAction=function(t){return t.t=this.duration,this._actions.push(t),this},s._set=function(t,e){for(var n in t)e[n]=t[n]},s.wait=function(t,e){if(null==t||0>=t)return this;var n=this._cloneProps(this._curQueueProps);return this._addStep({d:t,p0:n,p1:n,v:e})},s.to=function(t,e,n){return void 0===n&&(n=void 0),(isNaN(e)||0>e)&&(e=0),this._addStep({d:e||0,p0:this._cloneProps(this._curQueueProps),e:n,p1:this._cloneProps(this._appendQueueProps(t))})},s.call=function(t,e,n){return void 0===e&&(e=void 0),void 0===n&&(n=void 0),this._addAction({f:t,p:n?n:[],o:e?e:this._target})},s.set=function(t,e){return void 0===e&&(e=null),this._appendQueueProps(t),this._addAction({f:this._set,o:this,p:[t,e?e:this._target]})},s.play=function(t){return t||(t=this),this.call(t.setPaused,t,[!1])},s.pause=function(t){return t||(t=this),this.call(t.setPaused,t,[!0])},s.tick=function(t){this.paused||this.setPosition(this._prevPosition+t)},n.NONE=0,n.LOOP=1,n.REVERSE=2,n._tweens=[],n.IGNORE={},n._plugins={},n._inited=!1,n._lastTime=0,n}(t.EventDispatcher);t.Tween=e,t.registerClass(e,"egret.Tween")}(egret||(egret={}));var egret;!function(t){var e;!function(e){function n(e){if("function"==typeof e)return e;var n=t.Ease[e];return"function"==typeof n?n:null}function i(t,e,n,i){var s=t.prototype;s.__meta__=s.__meta__||{},s.__meta__[e]=n,i&&(s.__defaultProperty__=e)}var s=function(t){function e(){t.apply(this,arguments),this.name=""}__extends(e,t);var n=e;return n.prototype,e}(t.EventDispatcher);e.BasePath=s,t.registerClass(s,"egret.tween.BasePath");var r=function(t){function e(){t.apply(this,arguments),this.props=void 0,this.duration=500,this.ease=void 0}__extends(e,t);var n=e;return n.prototype,e}(s);e.To=r,t.registerClass(r,"egret.tween.To");var u=function(t){function e(){t.apply(this,arguments),this.duration=500,this.passive=void 0}__extends(e,t);var n=e;return n.prototype,e}(s);e.Wait=u,t.registerClass(u,"egret.tween.Wait");var o=function(t){function e(){t.apply(this,arguments),this.props=void 0}__extends(e,t);var n=e;return n.prototype,e}(s);e.Set=o,t.registerClass(o,"egret.tween.Set");var a=function(t){function e(){t.apply(this,arguments),this.delta=0}__extends(e,t);var n=e;return n.prototype,e}(s);e.Tick=a,t.registerClass(a,"egret.tween.Tick");var h=function(e){function i(){e.call(this)}__extends(i,e);var s=__define,h=i,c=h.prototype;return s(c,"props",function(){return this._props},function(t){this._props=t}),s(c,"target",function(){return this._target},function(t){this._target=t}),s(c,"paths",function(){return this._paths},function(t){this._paths=t||[]}),c.play=function(){this.tween?this.tween.setPaused(!1):this.createTween()},c.pause=function(){this.tween&&this.tween.setPaused(!0)},c.createTween=function(){this.tween=t.Tween.get(this._target,this._props),this._paths&&this.applyPaths()},c.applyPaths=function(){for(var t=0;t<this._paths.length;t++){var e=this._paths[t];this.applyPath(e)}},c.applyPath=function(t){var e=this;t instanceof r?this.tween.to(t.props,t.duration,n(t.ease)):t instanceof u?this.tween.wait(t.duration,t.passive):t instanceof o?this.tween.set(t.props):t instanceof a&&this.tween.tick(t.delta),this.tween.call(function(){return e.pathComplete(t)})},c.pathComplete=function(t){t.dispatchEventWith("complete"),this.dispatchEventWith("pathComplete",!1,t);var e=this._paths.indexOf(t);e>=0&&e===this._paths.length-1&&this.dispatchEventWith("complete")},i}(t.EventDispatcher);e.TweenItem=h,t.registerClass(h,"egret.tween.TweenItem"),i(h,"paths","Array",!0);var c=function(t){function e(){t.call(this),this.completeCount=0}__extends(e,t);var n=__define,i=e,s=i.prototype;return n(s,"items",function(){return this._items},function(t){this.completeCount=0,this.registerEvent(!1),this._items=t,this.registerEvent(!0)}),s.registerEvent=function(t){var e=this;this._items&&this._items.forEach(function(n){t?n.addEventListener("complete",e.itemComplete,e):n.removeEventListener("complete",e.itemComplete,e)})},s.play=function(){if(this._items)for(var t=0;t<this._items.length;t++){var e=this._items[t];e.play()}},s.pause=function(){if(this._items)for(var t=0;t<this._items.length;t++){var e=this._items[t];e.pause()}},s.itemComplete=function(t){var e=t.currentTarget;this.completeCount++,this.dispatchEventWith("itemComplete",!1,e),this.completeCount===this.items.length&&(this.dispatchEventWith("complete"),this.completeCount=0)},e}(t.EventDispatcher);e.TweenGroup=c,t.registerClass(c,"egret.tween.TweenGroup"),i(c,"items","Array",!0)}(e=t.tween||(t.tween={}))}(egret||(egret={}));
;/*!libs/libs/modules/egret3d/egret3d.min.js*/
var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},egret3d;!function(t){var e=function(){function e(){}return e.outError=function(t){console.log("Error:"+t)},e.outWarn=function(t){console.log("Warning:"+t)},e.outDebug=function(e){t.Egret3DEngine.instance.debug&&console.log("Debug:"+e)},e}();t.Egret3DLog=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){this.averageFPS=60,this.averageDelay=16,this.delayNumber=0,this.countFrame=30}return t.prototype.update=function(t,e){return this.delayNumber+=e-1,0==this.countFrame--&&(this.countFrame=30,this.averageDelay=Math.floor(this.delayNumber/this.countFrame),this.averageFPS=Math.floor(1e3/this.averageDelay),this.averageFPS=Math.min(this.averageFPS,60),this.delayNumber=0)," "+this.averageFPS.toString()+" fps/"+this.averageDelay.toString()+" delay"},t.fps=16.6666,t}(),i=function(){function i(){}return i.initState=function(){t.Egret3DEngine.instance.debug&&!i._canvas&&(i._canvas=document.createElement("canvas"),document.body.appendChild(i._canvas),i._canvas.width=i._width,i._canvas.height=i._height,i._canvas.style.backgroundColor="rgba(158,158,158,0.3)")},i.showTime=function(t,e){i.use||i.initState(),i._fps=i.fpsInfo.update(t,e)},i.showDataInfo=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];i.use||i.initState();var r;for(r in t)t[r]&&this.array.push(t[r].toString())},i.show=function(){if(i._canvas){var t=20,e=i._canvas.getContext("2d");e.fillStyle="lightblue",e.font="20px Corbel",e.clearRect(0,0,i._width,i._height),e.fillText(" Egret3D Graphics ",10,t),t+=20,e.fillText(i._fps,10,t),t+=20;for(var r=0;r<this.array.length;r++)e.fillText(this.array[r].toString(),10,t),t+=20;this.array.length=0}},i.use=!1,i._width=260,i._height=300,i.fpsInfo=new e,i._fps="",i.array=[],i}();t.Egret3DState=i}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t.diffuse=0]="diffuse",t[t.normal=1]="normal",t[t.specular=2]="specular",t[t.color=3]="color",t[t.shadow=4]="shadow"}(t.TextureMethodType||(t.TextureMethodType={})),t.TextureMethodType,!function(t){t[t.base_vertex=0]="base_vertex",t[t.start_vertex=1]="start_vertex",t[t.local_vertex=2]="local_vertex",t[t.global_vertex=3]="global_vertex",t[t.end_vertex=4]="end_vertex",t[t.base_fragment=5]="base_fragment",t[t.start_fragment=6]="start_fragment",t[t.materialsource_fragment=7]="materialsource_fragment",t[t.diffuse_fragment=8]="diffuse_fragment",t[t.normal_fragment=9]="normal_fragment",t[t.matCap_fragment=10]="matCap_fragment",t[t.specular_fragment=11]="specular_fragment",t[t.shadow_fragment=12]="shadow_fragment",t[t.lighting_fragment=13]="lighting_fragment",t[t.multi_end_fragment=14]="multi_end_fragment",t[t.end_fragment=15]="end_fragment"}(t.ShaderPhaseType||(t.ShaderPhaseType={})),t.ShaderPhaseType}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.u=0,this.v=0,this.u=t,this.v=e}return t}();t.UV=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},enumerable:!0,configurable:!0}),t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y},t.prototype.equals=function(t){return this.x==t.x&&this.y==t.y},t.prototype.normalize=function(t){if(void 0===t&&(t=1),0!=this.length){var e=t/this.length;return this.x*=e,void(this.y*=e)}throw"Cannot divide by zero length."},t.prototype.offset=function(t,e){this.x+=t,this.y+=e},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.toString=function(){return"[Point] (x="+this.x+", y="+this.y+")"},t.distance=function(t,e){var i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)},t}();t.Point=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),this.x=0,this.y=0,this.z=0,this.w=0,this.x=t,this.y=e,this.z=i,this.w=r}return Object.defineProperty(e.prototype,"a",{get:function(){return this.w},set:function(t){this.w=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"r",{get:function(){return this.x},set:function(t){this.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"g",{get:function(){return this.y},set:function(t){this.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"b",{get:function(){return this.z},set:function(t){this.z=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return Math.sqrt(this.lengthSquared)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lengthSquared",{get:function(){return this.x*this.x+this.y*this.y+this.z*this.z},enumerable:!0,configurable:!0}),e.prototype.add=function(t,i){void 0===i&&(i=null),i||(i=new e);var r=this.x,a=this.y,n=this.z,o=this.w,s=t.x,h=t.y,l=t.z,u=t.w;return i.setTo(r+s,a+h,n+l,o+u),i},e.prototype.clone=function(){return new e(this.x,this.y,this.z,this.w)},e.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w},e.prototype.crossProduct=function(t,i){return void 0===i&&(i=null),i=i||new e,i.x=this.y*t.z-this.z*t.y,i.y=this.z*t.x-this.x*t.z,i.z=this.x*t.y-this.y*t.x,i.w=1,i},e.prototype.decrementBy=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z},e.distance=function(t,e){var i=t.x-e.x,r=t.y-e.y,a=t.z-e.z;return Math.sqrt(i*i+r*r+a*a)},e.prototype.dotProduct=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},e.prototype.equals=function(t,e){return void 0===e&&(e=!1),this.x==t.x&&this.y==t.y&&this.z==t.z&&(!e||this.w==t.w)},e.prototype.incrementBy=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},e.prototype.divide=function(t){return t instanceof e?new e(this.x/t.x,this.y/t.y,this.z/t.z):(this.x=this.x/t,this.y=this.y/t,this.z=this.z/t,this)},e.prototype.negate=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},e.prototype.normalize=function(t){if(void 0===t&&(t=1),0!=this.length){var e=t/this.length;return this.x*=e,this.y*=e,void(this.z*=e)}},e.prototype.scaleBy=function(t){this.x*=t,this.y*=t,this.z*=t},e.prototype.setTo=function(t,e,i,r){void 0===r&&(r=1),this.x=t,this.y=e,this.z=i,this.w=r},e.prototype.subtract=function(t,i){return void 0===i&&(i=null),i||(i=new e),i.setTo(this.x-t.x,this.y-t.y,this.z-t.z),i},e.prototype.multiply=function(t,i){void 0===i&&(i=null),i||(i=new e);var r=this.x,a=this.y,n=this.z,o=t.x,s=t.y,h=t.z;return i.setTo(r*o,a*s,n*h),i},e.prototype.divided=function(t,i){void 0===i&&(i=null),i||(i=new e);var r=this.x,a=this.y,n=this.z,o=t.x,s=t.y,h=t.z;return i.setTo(r/o,a/s,n/h),i},e.prototype.lerp=function(t,e,i){var r=t.x,a=t.y,n=t.z,o=t.w,s=e.x,h=e.y,l=e.z,u=e.w;this.x=(s-r)*i+r,this.y=(h-a)*i+a,this.z=(l-n)*i+n,this.w=(u-o)*i+o},e.prototype.Dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},e.prototype.OrthoNormalVectorFast=function(t,i){i||(i=new e);var r,a;return Math.abs(t.z)>.70710678?(r=t.y*t.y+t.z*t.z,a=1/Math.sqrt(r),i.x=0,i.y=-t.z*a,i.z=t.y*a):(r=t.x*t.x+t.y*t.y,a=1/Math.sqrt(r),i.x=-t.y*a,i.y=t.x*a,i.z=0),i},e.prototype.slerp=function(i,r,a){var n=Math.sqrt(this.Dot(i,i)),o=Math.sqrt(this.Dot(r,r));if(1e-5>n||1e-5>o)return this.lerp(i,r,a);var s=n+a*(o-n),h=this.Dot(i,r)/(n*o);if(h>.99999)return this.lerp(i,r,a);if(-1+1e-5>h){e.HELP_0.copyFrom(i);var l=e.HELP_0.divide(n);this.OrthoNormalVectorFast(l,e.HELP_1);var u=e.HELP_1;t.Quaternion.HELP_0.fromAxisAngle(e.HELP_1,3.1415926*a*t.MathUtil.RADIANS_TO_DEGREES);var c=t.Quaternion.HELP_0.toMatrix3D(t.Matrix4_4.helpMatrix);return c.transformVector(l,this),void this.scaleBy(s)}i.dotProduct,this.Cross(i,r,e.HELP_0);var u=e.HELP_0;e.HELP_1.copyFrom(i);var l=e.HELP_1.divide(n);u.normalize();var d=Math.acos(h)*a;t.Quaternion.HELP_0.fromAxisAngle(u,d*t.MathUtil.RADIANS_TO_DEGREES);var c=t.Quaternion.HELP_0.toMatrix3D(t.Matrix4_4.helpMatrix);return c.transformVector(l,this),void this.scaleBy(s)},e.prototype.Cross=function(t,i,r){return void 0===r&&(r=null),r||(r=new e),r.x=t.y*i.z-t.z*i.y,r.y=t.z*i.x-t.x*i.z,r.z=t.x*i.y-t.y*i.x,r},e.prototype.toString=function(){return"<"+this.x+", "+this.y+", "+this.z+">"},e.prototype.parsing=function(t){var e=t.split(" ");e.length<3||(this.x=parseFloat(e[0]),this.y=parseFloat(e[1]),this.z=parseFloat(e[2]))},e.prototype.equal=function(t){return!(this.x!=t.x||this.y!=t.y||this.z!=t.z||this.w!=t.w)},e.X_AXIS=new e(1,0,0),e.Y_AXIS=new e(0,1,0),e.Z_AXIS=new e(0,0,1),e.HELP_0=new e,e.HELP_1=new e,e.HELP_2=new e,e.HELP_3=new e,e}();t.Vector3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),this.x=0,this.y=0,this.width=0,this.height=0,this.x=t,this.y=e,this.width=i,this.height=r}return t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},t.prototype.copyTo=function(t){t.copyFrom(this)},t.prototype.inner=function(t,e){return t<this.x||t>this.x+this.width||e<this.y||e>this.y+this.height?!1:!0},t.pointInRect=function(t,e,i,r,a,n){return i>t||t>a||r>e||e>n?!1:!0},t.prototype.equal=function(t){return!(this.x!=t.x||this.y!=t.y||this.width!=t.width||this.height!=t.height)},t.prototype.equalArea=function(t,e,i,r){return!(this.x!=t||this.y!=e||this.width!=i||this.height!=r)},t.prototype.equalInnerArea=function(t){var e=this.x,i=this.y,r=this.x+this.width,a=this.y+this.height,n=t.x,o=t.y,s=t.x+t.width,h=t.y+t.height;return Math.max(e,n)<=Math.min(r,s)&&Math.max(i,o)<=Math.min(a,h)?!0:!1},t.prototype.innerArea=function(e,i){i=i||new t;var r=this.x,a=this.y,n=this.x+this.width,o=this.y+this.height,s=e.x,h=e.y,l=e.x+e.width,u=e.y+e.height,c=Math.max(a,h),d=Math.min(o,u),p=Math.max(r,s),f=Math.min(l,n);return c>=0&&d>=0&&d-c>=0&&f-p>0?(i.x=p,i.y=c,i.width=f-p,i.height=d-c):(i.x=0,i.y=0,i.width=0,i.height=0),i},t.prototype.setTo=function(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r},t}();t.Rectangle=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),this.x=0,this.y=0,this.z=0,this.w=1,this.x=t,this.y=e,this.z=i,this.w=r}return Object.defineProperty(e.prototype,"magnitude",{get:function(){return Math.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z)},enumerable:!0,configurable:!0}),e.prototype.multiply=function(t,e){var i=t.w,r=t.x,a=t.y,n=t.z,o=e.w,s=e.x,h=e.y,l=e.z;this.w=i*o-r*s-a*h-n*l,this.x=i*s+r*o+a*l-n*h,this.y=i*h-r*l+a*o+n*s,this.z=i*l+r*h-a*s+n*o},e.prototype.multiplyVector=function(t,i){void 0===i&&(i=null),null===i&&(i=new e);var r=t.x,a=t.y,n=t.z;return i.w=-this.x*r-this.y*a-this.z*n,i.x=this.w*r+this.y*n-this.z*a,i.y=this.w*a-this.x*n+this.z*r,i.z=this.w*n+this.x*a-this.y*r,i},e.prototype.fromAxisAngle=function(t,e){e*=Math.PI/180;var i=.5*e,r=Math.sin(i);this.w=Math.cos(i),this.x=t.x*r,this.y=t.y*r,this.z=t.z*r,this.normalize()},e.prototype.toAxisAngle=function(t){var e=this.x*this.x+this.y*this.y+this.z*this.z,i=0;return e>0?(i=2*Math.acos(this.w),e=1/Math.sqrt(e),t.x=this.x*e,t.y=this.y*e,t.z=this.z*e):(i=0,t.x=1,t.y=0,t.z=0),i/=Math.PI/180},e.prototype.slerp=function(t,e,i){var r=t.w,a=t.x,n=t.y,o=t.z,s=e.w,h=e.x,l=e.y,u=e.z,c=r*s+a*h+n*l+o*u;if(0>c&&(c=-c,s=-s,h=-h,l=-l,u=-u),.95>c){var d=Math.acos(c),p=1/Math.sin(d),f=Math.sin(d*(1-i))*p,_=Math.sin(d*i)*p;this.w=r*f+s*_,this.x=a*f+h*_,this.y=n*f+l*_,this.z=o*f+u*_}else{this.w=r+i*(s-r),this.x=a+i*(h-a),this.y=n+i*(l-n),this.z=o+i*(u-o);var m=1/Math.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z);this.w*=m,this.x*=m,this.y*=m,this.z*=m}},e.prototype.lerp=function(t,e,i){var r,a=t.w,n=t.x,o=t.y,s=t.z,h=e.w,l=e.x,u=e.y,c=e.z;0>a*h+n*l+o*u+s*c&&(h=-h,l=-l,u=-u,c=-c),this.w=a+i*(h-a),this.x=n+i*(l-n),this.y=o+i*(u-o),this.z=s+i*(c-s),r=1/Math.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z),this.w*=r,this.x*=r,this.y*=r,this.z*=r},e.prototype.fromEulerAngles=function(e,i,r){e*=t.MathUtil.DEGREES_TO_RADIANS,i*=t.MathUtil.DEGREES_TO_RADIANS,r*=t.MathUtil.DEGREES_TO_RADIANS;var a=.5*e,n=.5*i,o=.5*r,s=Math.cos(a),h=Math.sin(a),l=Math.cos(n),u=Math.sin(n),c=Math.cos(o),d=Math.sin(o);return this.w=s*l*c+h*u*d,this.x=h*l*c-s*u*d,this.y=s*u*c+h*l*d,this.z=s*l*d-h*u*c,this},e.prototype.toEulerAngles=function(e){void 0===e&&(e=null),null===e&&(e=new t.Vector3D),e.x=Math.atan2(2*(this.w*this.x+this.y*this.z),1-2*(this.x*this.x+this.y*this.y));var i=2*(this.w*this.y-this.z*this.x);return i=t.MathUtil.clampf(i,-1,1),e.y=Math.asin(i),e.z=Math.atan2(2*(this.w*this.z+this.x*this.y),1-2*(this.y*this.y+this.z*this.z)),e.x/=t.MathUtil.DEGREES_TO_RADIANS,e.y/=t.MathUtil.DEGREES_TO_RADIANS,e.z/=t.MathUtil.DEGREES_TO_RADIANS,e},e.prototype.normalize=function(t){void 0===t&&(t=1);var e=t/Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);this.x*=e,this.y*=e,this.z*=e,this.w*=e},e.prototype.toString=function(){return"{x:"+this.x+" y:"+this.y+" z:"+this.z+" w:"+this.w+"}"},e.prototype.toMatrix3D=function(e){void 0===e&&(e=null);var i=t.MathUtil.RAW_DATA_CONTAINER,r=2*this.x*this.y,a=2*this.x*this.z,n=2*this.x*this.w,o=2*this.y*this.z,s=2*this.y*this.w,h=2*this.z*this.w,l=this.x*this.x,u=this.y*this.y,c=this.z*this.z,d=this.w*this.w;return i[0]=l-u-c+d,i[4]=r-h,i[8]=a+s,i[12]=0,i[1]=r+h,i[5]=-l+u-c+d,i[9]=o-n,i[13]=0,i[2]=a-s,i[6]=o+n,i[10]=-l-u+c+d,i[14]=0,i[3]=0,i[7]=0,i[11]=0,i[15]=1,e?(e.copyRawDataFrom(i),e):new t.Matrix4_4(new Float32Array(i))},e.prototype.fromMatrix=function(e){var i=e.decompose(t.Orientation3D.QUATERNION)[1];this.x=i.x,this.y=i.y,this.z=i.z,this.w=i.w},e.prototype.inverse=function(t){void 0===t&&(t=null),t||(t=new e);var i=this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z;if(i>0){var r=1/i;t.w=this.w*r,t.x=-this.x*r,t.y=-this.y*r,t.z=-this.z*r}return t},e.prototype.clone=function(){return new e(this.x,this.y,this.z,this.w)},e.prototype.transformVector=function(e,i){void 0===i&&(i=null);var r,a,n,o,s=e.x,h=e.y,l=e.z;return null===i&&(i=new t.Vector3D),o=-this.x*s-this.y*h-this.z*l,r=this.w*s+this.y*l-this.z*h,a=this.w*h-this.x*l+this.z*s,n=this.w*l+this.x*h-this.y*s,i.x=-o*this.x+r*this.w-a*this.z+n*this.y,i.y=-o*this.y+r*this.z+a*this.w-n*this.x,i.z=-o*this.z-r*this.y+a*this.x+n*this.w,i},e.prototype.fromToRotation=function(e,i){var r=new t.Matrix4_4;t.Matrix4_4.fromToRotation(e,i,r),this.fromMatrix(r)},e.fromToRotation=function(t,i,r){return void 0===r&&(r=null),r||(r=new e),r.fromToRotation(t,i),r},e.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w},e.HELP_0=new e,e.HELP_1=new e,e.HELP_2=new e,e}();t.Quaternion=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){}return t.AXIS_ANGLE="axisAngle",t.EULER_ANGLES="eulerAngles",t.QUATERNION="quaternion",t}();t.Orientation3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),this.a=t,this.b=e,this.c=i,this.d=r}return e.prototype.setTo=function(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),this.a=t,this.b=e,this.c=i,this.d=r},e.prototype.fromPoints=function(t,e,i){var r=e.x-t.x,a=e.y-t.y,n=e.z-t.z,o=i.x-t.x,s=i.y-t.y,h=i.z-t.z;this.a=a*h-n*s,this.b=n*o-r*h,this.c=r*s-a*o,this.d=-(this.a*t.x+this.b*t.y+this.c*t.z)},e.prototype.fromNormalAndPoint=function(t,e){this.a=t.x,this.b=t.y,this.c=t.z,this.d=-(this.a*e.x+this.b*e.y+this.c*e.z)},e.prototype.normalize=function(){var t=Math.sqrt(this.a*this.a+this.b*this.b+this.c*this.c);if(t>0){var e=1/t;this.a*=e,this.b*=e,this.c*=e,this.d*=e}return t},e.prototype.distance=function(t){return this.a*t.x+this.b*t.y+this.c*t.z+this.d},e.prototype.classifyPoint=function(e,i){void 0===i&&(i=.01);var r=this.distance(e);return-i>r?t.PlaneClassification.BACK:r>i?t.PlaneClassification.FRONT:t.PlaneClassification.INTERSECT},e.prototype.toString=function(){return"Plane3D [a:"+this.a+", b:"+this.b+", c:"+this.c+", d:"+this.d+"]"},e.ALIGN_ANY=0,e.ALIGN_XY_AXIS=1,e.ALIGN_YZ_AXIS=2,e.ALIGN_XZ_AXIS=3,e}();t.Plane3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(t){void 0===t&&(t=null),this.rawData=t?t:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return e.prototype.lookAt=function(e,i,r){i.subtract(e,t.Vector3D.HELP_0);var a=t.Vector3D.HELP_0;a.normalize();var n=r.crossProduct(a,t.Vector3D.HELP_1);n.normalize();var o=a.crossProduct(n,t.Vector3D.HELP_2);this.rawData[0]=n.x,this.rawData[1]=o.x,this.rawData[2]=a.x,this.rawData[3]=0,this.rawData[4]=n.y,this.rawData[5]=o.y,this.rawData[6]=a.y,this.rawData[7]=0,this.rawData[8]=n.z,this.rawData[9]=o.z,this.rawData[10]=a.z,this.rawData[11]=0,this.rawData[12]=-n.dotProduct(e),this.rawData[13]=-o.dotProduct(e),this.rawData[14]=-a.dotProduct(e),this.rawData[15]=1},e.prototype.multiply=function(t){var i=this.rawData,r=t.rawData,a=e.helpMatrix;a[0]=i[0]*r[0]+i[1]*r[4]+i[2]*r[8]+i[3]*r[12],a[1]=i[0]*r[1]+i[1]*r[5]+i[2]*r[9]+i[3]*r[13],a[2]=i[0]*r[2]+i[1]*r[6]+i[2]*r[10]+i[3]*r[14],a[3]=i[0]*r[3]+i[1]*r[7]+i[2]*r[11]+i[3]*r[15],a[4]=i[4]*r[0]+i[5]*r[4]+i[6]*r[8]+i[7]*r[12],a[5]=i[4]*r[1]+i[5]*r[5]+i[6]*r[9]+i[7]*r[13],a[6]=i[4]*r[2]+i[5]*r[6]+i[6]*r[10]+i[7]*r[14],a[7]=i[4]*r[3]+i[5]*r[7]+i[6]*r[11]+i[7]*r[15],a[8]=i[8]*r[0]+i[9]*r[4]+i[10]*r[8]+i[11]*r[12],a[9]=i[8]*r[1]+i[9]*r[5]+i[10]*r[9]+i[11]*r[13],a[10]=i[8]*r[2]+i[9]*r[6]+i[10]*r[10]+i[11]*r[14],a[11]=i[8]*r[3]+i[9]*r[7]+i[10]*r[11]+i[11]*r[15],a[12]=i[12]*r[0]+i[13]*r[4]+i[14]*r[8]+i[15]*r[12],a[13]=i[12]*r[1]+i[13]*r[5]+i[14]*r[9]+i[15]*r[13],a[14]=i[12]*r[2]+i[13]*r[6]+i[14]*r[10]+i[15]*r[14],a[15]=i[12]*r[3]+i[13]*r[7]+i[14]*r[11]+i[15]*r[15];for(var n=0;16>n;n++)this.rawData[n]=a[n]},e.prototype.perspectiveB=function(t,e,i,r){var a=Math.tan(t*Math.PI/360)*i,n=a*e;return this.frustum(-n,n,-a,a,i,r)},e.prototype.frustum=function(t,e,i,r,a,n){var o=this.rawData;return o[0]=2*a/(e-t),o[1]=0,o[2]=(e+t)/(e-t),o[3]=0,o[4]=0,o[5]=2*a/(r-i),o[6]=(r+i)/(r-i),o[7]=0,o[8]=0,o[9]=0,o[10]=-(n+a)/(n-a),o[11]=-2*n*a/(n-a),o[12]=0,o[13]=0,o[14]=-1,o[15]=0,this},e.prototype.perspective=function(t,e,i,r){var a=t*(Math.PI/180),n=Math.tan((Math.PI-a)/2),o=n/e;this.rawData[0]=o,this.rawData[1]=0,this.rawData[2]=0,this.rawData[3]=0,this.rawData[4]=0,this.rawData[5]=n,this.rawData[6]=0,this.rawData[7]=0,this.rawData[8]=0,this.rawData[9]=0,this.rawData[10]=r/(r-i),this.rawData[11]=1,this.rawData[12]=0,this.rawData[13]=0,this.rawData[14]=-i*r/(r-i),this.rawData[15]=0},e.prototype.ortho=function(t,e,i,r){this.rawData[0]=2/t,this.rawData[1]=0,this.rawData[2]=0,this.rawData[3]=0,this.rawData[4]=0,this.rawData[5]=2/e,this.rawData[6]=0,this.rawData[7]=0,this.rawData[8]=0,this.rawData[9]=0,this.rawData[10]=1/(r-i),this.rawData[11]=0,this.rawData[12]=0,this.rawData[13]=0,this.rawData[14]=i/(i-r),this.rawData[15]=1},e.prototype.orthoOffCenter=function(t,e,i,r,a,n){this.rawData[0]=2/(e-t),this.rawData[1]=0,this.rawData[2]=0,this.rawData[3]=0,this.rawData[4]=0,this.rawData[5]=2/(r-i),this.rawData[6]=0,this.rawData[7]=0,this.rawData[8]=0,this.rawData[9]=0,this.rawData[10]=1/(n-a),this.rawData[11]=0,this.rawData[12]=(t+e)/(t-e),this.rawData[13]=(r+i)/(i-r),this.rawData[14]=a/(a-n),this.rawData[15]=1},e.prototype.fromToRotation=function(e,i){var r=1e-6,a=t.Vector3D.HELP_0;i.crossProduct(e,a);var n=i.dotProduct(e);if(n>1-r)this.identity();else if(-1+r>3){var o,s,h,l,u,c,d,p,f,_,m,g,v,y,x,b,D,T,w=t.Vector3D.HELP_1,P=t.Vector3D.HELP_2,S=0;P.x=0,P.y=e.z,P.z=-e.y,P.dotProduct(P)<r&&(P.x=-e.z,P.y=0,P.z=e.x),S=1/Math.sqrt(P.dotProduct(P)),P[0]*=S,P[1]*=S,P[2]*=S,P.crossProduct(e,w),o=-e.x*e.x,s=-e.y*e.y,h=-e.z*e.z,l=-e.x*e.y,u=-e.x*e.z,c=-e.y*e.z,d=w.x*w.x,p=w.y*w.y,f=w.z*w.z,_=w.x*w.y,m=w.x*w.z,g=w.y*w.z,v=-P.x*P.x,y=-P.y*P.y,x=-P.z*P.z,b=-P.x*P.y,D=-P.x*P.z,T=-P.y*P.z,this.rawData[0]=o+d+v,this.rawData[1]=l+_+b,this.rawData[2]=u+m+D,this.rawData[4]=this.rawData[1],this.rawData[5]=s+p+y,this.rawData[6]=c+g+T,this.rawData[8]=this.rawData[2],this.rawData[9]=this.rawData[6],this.rawData[10]=h+f+x,this.rawData[3]=0,this.rawData[7]=0,this.rawData[11]=0,this.rawData[15]=1}else{var A,C,E,M,L,z=(1-n)/a.dotProduct(a);A=z*a.x,C=z*a.z,E=A*a.y,M=A*a.z,L=C*a.y,this.rawData[0]=n+A*a.x,this.rawData[1]=E-a.z,this.rawData[2]=M+a.y,this.rawData[4]=E+a.z,this.rawData[5]=n+z*a.y*a.y,this.rawData[6]=L-a.x,this.rawData[8]=M-a.y,this.rawData[9]=L+a.x,this.rawData[10]=n+C*a.z,this.rawData[3]=0,this.rawData[7]=0,this.rawData[11]=0,this.rawData[15]=1}},e.fromToRotation=function(t,i,r){return void 0===r&&(r=null),r||(r=new e),r.fromToRotation(t,i),r},e.prototype.append=function(t){var e=this.rawData[0],i=this.rawData[4],r=this.rawData[8],a=this.rawData[12],n=this.rawData[1],o=this.rawData[5],s=this.rawData[9],h=this.rawData[13],l=this.rawData[2],u=this.rawData[6],c=this.rawData[10],d=this.rawData[14],p=this.rawData[3],f=this.rawData[7],_=this.rawData[11],m=this.rawData[15],g=t.rawData[0],v=t.rawData[4],y=t.rawData[8],x=t.rawData[12],b=t.rawData[1],D=t.rawData[5],T=t.rawData[9],w=t.rawData[13],P=t.rawData[2],S=t.rawData[6],A=t.rawData[10],C=t.rawData[14],E=t.rawData[3],M=t.rawData[7],L=t.rawData[11],z=t.rawData[15];this.rawData[0]=e*g+n*v+l*y+p*x,this.rawData[1]=e*b+n*D+l*T+p*w,this.rawData[2]=e*P+n*S+l*A+p*C,this.rawData[3]=e*E+n*M+l*L+p*z,this.rawData[4]=i*g+o*v+u*y+f*x,this.rawData[5]=i*b+o*D+u*T+f*w,this.rawData[6]=i*P+o*S+u*A+f*C,this.rawData[7]=i*E+o*M+u*L+f*z,this.rawData[8]=r*g+s*v+c*y+_*x,this.rawData[9]=r*b+s*D+c*T+_*w,this.rawData[10]=r*P+s*S+c*A+_*C,this.rawData[11]=r*E+s*M+c*L+_*z,this.rawData[12]=a*g+h*v+d*y+m*x,this.rawData[13]=a*b+h*D+d*T+m*w,this.rawData[14]=a*P+h*S+d*A+m*C,this.rawData[15]=a*E+h*M+d*L+m*z},e.prototype.add=function(t){var e=this.rawData[0],i=this.rawData[4],r=this.rawData[8],a=this.rawData[12],n=this.rawData[1],o=this.rawData[5],s=this.rawData[9],h=this.rawData[13],l=this.rawData[2],u=this.rawData[6],c=this.rawData[10],d=this.rawData[14],p=this.rawData[3],f=this.rawData[7],_=this.rawData[11],m=this.rawData[15],g=t.rawData[0],v=t.rawData[4],y=t.rawData[8],x=t.rawData[12],b=t.rawData[1],D=t.rawData[5],T=t.rawData[9],w=t.rawData[13],P=t.rawData[2],S=t.rawData[6],A=t.rawData[10],C=t.rawData[14],E=t.rawData[3],M=t.rawData[7],L=t.rawData[11],z=t.rawData[15];return this.rawData[0]=e+g,this.rawData[1]=n+b,this.rawData[2]=l+P,this.rawData[3]=p+E,this.rawData[4]=i+v,this.rawData[5]=o+D,this.rawData[6]=u+S,this.rawData[7]=f+M,this.rawData[8]=r+y,this.rawData[9]=s+T,this.rawData[10]=c+A,this.rawData[11]=_+L,this.rawData[12]=a+x,this.rawData[13]=h+w,this.rawData[14]=d+C,this.rawData[15]=m+z,this},e.prototype.sub=function(t){var e=this.rawData[0],i=this.rawData[4],r=this.rawData[8],a=this.rawData[12],n=this.rawData[1],o=this.rawData[5],s=this.rawData[9],h=this.rawData[13],l=this.rawData[2],u=this.rawData[6],c=this.rawData[10],d=this.rawData[14],p=this.rawData[3],f=this.rawData[7],_=this.rawData[11],m=this.rawData[15],g=t.rawData[0],v=t.rawData[4],y=t.rawData[8],x=t.rawData[12],b=t.rawData[1],D=t.rawData[5],T=t.rawData[9],w=t.rawData[13],P=t.rawData[2],S=t.rawData[6],A=t.rawData[10],C=t.rawData[14],E=t.rawData[3],M=t.rawData[7],L=t.rawData[11],z=t.rawData[15];return this.rawData[0]=e-g,this.rawData[1]=n-b,this.rawData[2]=l-P,this.rawData[3]=p-E,this.rawData[4]=i-v,this.rawData[5]=o-D,this.rawData[6]=u-S,this.rawData[7]=f-M,this.rawData[8]=r-y,this.rawData[9]=s-T,this.rawData[10]=c-A,this.rawData[11]=_-L,this.rawData[12]=a-x,this.rawData[13]=h-w,this.rawData[14]=d-C,this.rawData[15]=m-z,this},e.prototype.mult=function(t){return this.rawData[0]*=t,this.rawData[1]*=t,this.rawData[2]*=t,this.rawData[3]*=t,this.rawData[4]*=t,this.rawData[5]*=t,this.rawData[6]*=t,this.rawData[7]*=t,this.rawData[8]*=t,this.rawData[9]*=t,this.rawData[10]*=t,this.rawData[11]*=t,this.rawData[12]*=t,this.rawData[13]*=t,this.rawData[14]*=t,this.rawData[15]*=t,this},e.prototype.rotation=function(e,i,r){this.appendRotation(e,t.Vector3D.X_AXIS),this.appendRotation(i,t.Vector3D.Y_AXIS),this.appendRotation(r,t.Vector3D.Z_AXIS)},e.prototype.appendRotation=function(i,r){var a,n,o=(e.getAxisRotation(r.x,r.y,r.z,i),t.MathUtil.CALCULATION_MATRIX),s=i*t.MathUtil.DEGREES_TO_RADIANS;a=Math.sin(s),n=Math.cos(s),1==r.x&&(o.rawData[0]=1,o.rawData[1]=0,o.rawData[2]=0,o.rawData[3]=0,o.rawData[4]=0,o.rawData[5]=n,o.rawData[6]=a,o.rawData[7]=0,o.rawData[8]=0,o.rawData[9]=-a,o.rawData[10]=n,o.rawData[7]=0,o.rawData[12]=0,o.rawData[13]=0,o.rawData[14]=0,o.rawData[15]=1),1==r.y&&(o.rawData[0]=n,o.rawData[1]=0,o.rawData[2]=-a,o.rawData[3]=0,o.rawData[4]=0,o.rawData[5]=1,o.rawData[6]=0,o.rawData[7]=0,o.rawData[8]=a,o.rawData[9]=0,o.rawData[10]=n,o.rawData[11]=0,o.rawData[12]=0,o.rawData[13]=0,o.rawData[14]=0,o.rawData[15]=1),1==r.z&&(o.rawData[0]=n,o.rawData[1]=a,o.rawData[2]=0,o.rawData[3]=0,o.rawData[4]=-a,o.rawData[5]=n,o.rawData[6]=0,o.rawData[7]=0,o.rawData[8]=0,o.rawData[9]=0,o.rawData[10]=1,o.rawData[11]=0,o.rawData[12]=0,o.rawData[13]=0,o.rawData[14]=0,o.rawData[15]=1),this.append(o)},e.prototype.appendScale=function(t,e,i){this.rawData[0]=t,this.rawData[1]=0,this.rawData[2]=0,this.rawData[4]=0,this.rawData[5]=e,this.rawData[6]=0,this.rawData[8]=0,this.rawData[9]=0,this.rawData[10]=i},e.prototype.appendTranslation=function(t,e,i){this.rawData[12]+=t,this.rawData[13]+=e,this.rawData[14]+=i},e.prototype.clone=function(){var t=new e;return t.copyFrom(this),t},e.prototype.copyColumnFrom=function(t,e){switch(t){case 0:this.rawData[0]=e.x,this.rawData[1]=e.y,this.rawData[2]=e.z,this.rawData[3]=e.w;break;case 1:this.rawData[4]=e.x,this.rawData[5]=e.y,this.rawData[6]=e.z,this.rawData[7]=e.w;break;case 2:this.rawData[8]=e.x,this.rawData[9]=e.y,this.rawData[10]=e.z,this.rawData[11]=e.w;break;case 3:this.rawData[12]=e.x,this.rawData[13]=e.y,this.rawData[14]=e.z,this.rawData[15]=e.w}},e.prototype.copyRowTo=function(t,e){switch(t){case 0:e.x=this.rawData[0],e.y=this.rawData[1],e.z=this.rawData[2],e.w=this.rawData[3];break;case 1:e.x=this.rawData[4],e.y=this.rawData[5],e.z=this.rawData[6],e.w=this.rawData[7];break;case 2:e.x=this.rawData[8],e.y=this.rawData[9],e.z=this.rawData[10],e.w=this.rawData[11];break;case 3:e.x=this.rawData[12],e.y=this.rawData[13],e.z=this.rawData[14],e.w=this.rawData[15]}},e.prototype.copyFrom=function(t){for(var e=t.rawData.length,i=0;e>i;i++)this.rawData[i]=t.rawData[i];return this},e.prototype.copyRawDataFrom=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=!1),i&&this.transpose();for(var r=t.length-e,a=0;r>a;a++)this.rawData[a]=t[a+e];i&&this.transpose()},e.prototype.copyRawDataTo=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=!1),i&&this.transpose();for(var r=this.rawData.length,a=0;r>a;a++)t[a+e]=this.rawData[a];i&&this.transpose()},e.prototype.copyColFrom=function(t,e){switch(t){case 0:this.rawData[0]=e.x,this.rawData[4]=e.y,this.rawData[8]=e.z,this.rawData[12]=e.w;break;case 1:this.rawData[1]=e.x,this.rawData[5]=e.y,this.rawData[9]=e.z,this.rawData[13]=e.w;break;case 2:this.rawData[2]=e.x,this.rawData[6]=e.y,this.rawData[10]=e.z,this.rawData[14]=e.w;break;case 3:this.rawData[3]=e.x,this.rawData[7]=e.y,this.rawData[11]=e.z,this.rawData[15]=e.w;break;default:new Error("no more raw!")}},e.prototype.copyColTo=function(t,e){switch(t){case 0:e.x=this.rawData[0],e.y=this.rawData[4],e.z=this.rawData[8],e.w=this.rawData[12];break;case 1:e.x=this.rawData[1],e.y=this.rawData[5],e.z=this.rawData[9],e.w=this.rawData[13];break;case 2:e.x=this.rawData[2],e.y=this.rawData[6],e.z=this.rawData[10],e.w=this.rawData[14];break;case 3:e.x=this.rawData[3],e.y=this.rawData[7],e.z=this.rawData[11],e.w=this.rawData[15];break;default:new Error("no more raw!")}},e.prototype.copyToMatrix3D=function(t){t.rawData=this.rawData.slice(0)},e.prototype.decompose=function(i,r){void 0===i&&(i="eulerAngles"),void 0===r&&(r=null);var a=t.MathUtil.CALCULATION_QUATERNION,n=r?r:[new t.Vector3D,new t.Vector3D,new t.Vector3D];this.copyRawDataTo(e.helpMatrix.rawData);var o=e.helpMatrix.rawData,s=n[0];s.x=o[12],s.y=o[13],s.z=o[14],o[12]=0,o[13]=0,o[14]=0;var h=n[2];h.x=Math.sqrt(o[0]*o[0]+o[1]*o[1]+o[2]*o[2]),h.y=Math.sqrt(o[4]*o[4]+o[5]*o[5]+o[6]*o[6]),h.z=Math.sqrt(o[8]*o[8]+o[9]*o[9]+o[10]*o[10]),o[0]*(o[5]*o[10]-o[6]*o[9])-o[1]*(o[4]*o[10]-o[6]*o[8])+o[2]*(o[4]*o[9]-o[5]*o[8])<0&&(h.z=-h.z),o[0]/=h.x,o[1]/=h.x,o[2]/=h.x,o[4]/=h.y,o[5]/=h.y,o[6]/=h.y,o[8]/=h.z,o[9]/=h.z,o[10]/=h.z;var l=n[1];switch(i){case t.Orientation3D.AXIS_ANGLE:l.w=Math.acos((o[0]+o[5]+o[10]-1)/2);var u=Math.sqrt((o[6]-o[9])*(o[6]-o[9])+(o[8]-o[2])*(o[8]-o[2])+(o[1]-o[4])*(o[1]-o[4]));l.x=(o[6]-o[9])/u,l.y=(o[8]-o[2])/u,l.z=(o[1]-o[4])/u;break;case t.Orientation3D.QUATERNION:var c=o[0]+o[5]+o[10];c>0?(l.w=Math.sqrt(1+c)/2,l.x=(o[6]-o[9])/(4*l.w),l.y=(o[8]-o[2])/(4*l.w),l.z=(o[1]-o[4])/(4*l.w)):o[0]>o[5]&&o[0]>o[10]?(l.x=Math.sqrt(1+o[0]-o[5]-o[10])/2,l.w=(o[6]-o[9])/(4*l.x),l.y=(o[1]+o[4])/(4*l.x),l.z=(o[8]+o[2])/(4*l.x)):o[5]>o[10]?(l.y=Math.sqrt(1+o[5]-o[0]-o[10])/2,l.x=(o[1]+o[4])/(4*l.y),l.w=(o[8]-o[2])/(4*l.y),l.z=(o[6]+o[9])/(4*l.y)):(l.z=Math.sqrt(1+o[10]-o[0]-o[5])/2,l.x=(o[8]+o[2])/(4*l.z),l.y=(o[6]+o[9])/(4*l.z),l.w=(o[1]-o[4])/(4*l.z));break;case t.Orientation3D.EULER_ANGLES:var c=o[0]+o[5]+o[10];c>0?(a.w=Math.sqrt(1+c)/2,a.x=(o[6]-o[9])/(4*a.w),a.y=(o[8]-o[2])/(4*a.w),a.z=(o[1]-o[4])/(4*a.w)):o[0]>o[5]&&o[0]>o[10]?(a.x=Math.sqrt(1+o[0]-o[5]-o[10])/2,a.w=(o[6]-o[9])/(4*a.x),a.y=(o[1]+o[4])/(4*a.x),a.z=(o[8]+o[2])/(4*a.x)):o[5]>o[10]?(l.y=Math.sqrt(1+o[5]-o[0]-o[10])/2,a.x=(o[1]+o[4])/(4*a.y),a.w=(o[8]-o[2])/(4*a.y),a.z=(o[6]+o[9])/(4*a.y)):(a.z=Math.sqrt(1+o[10]-o[0]-o[5])/2,a.x=(o[8]+o[2])/(4*a.z),a.y=(o[6]+o[9])/(4*a.z),a.w=(o[1]-o[4])/(4*a.z)),a.toEulerAngles(l)}return n[0]=s,n[1]=l,n[2]=h,n},e.prototype.deltaTransformVector=function(e,i){void 0===i&&(i=null),i||(i=new t.Vector3D);var r=e.x,a=e.y,n=e.z;return i.x=r*this.rawData[0]+a*this.rawData[4]+n*this.rawData[8],i.y=r*this.rawData[1]+a*this.rawData[5]+n*this.rawData[9],i.z=r*this.rawData[2]+a*this.rawData[6]+n*this.rawData[10],i.w=r*this.rawData[3]+a*this.rawData[7]+n*this.rawData[11],i},e.prototype.identity=function(){this.rawData[1]=0,this.rawData[2]=0,this.rawData[3]=0,this.rawData[4]=0,this.rawData[6]=0,this.rawData[7]=0,this.rawData[8]=0,this.rawData[9]=0,this.rawData[11]=0,this.rawData[12]=0,this.rawData[13]=0,this.rawData[14]=0,this.rawData[0]=1,this.rawData[5]=1,this.rawData[10]=1,this.rawData[15]=1},e.prototype.fill=function(t){this.rawData[1]=t,this.rawData[2]=t,this.rawData[3]=t,this.rawData[4]=t,this.rawData[6]=t,this.rawData[7]=t,this.rawData[8]=t,this.rawData[9]=t,this.rawData[11]=t,this.rawData[12]=t,this.rawData[13]=t,this.rawData[14]=t,this.rawData[0]=t,this.rawData[5]=t,this.rawData[10]=t,this.rawData[15]=t},e.prototype.invers33=function(){var t=this.rawData[5]*this.rawData[10]-this.rawData[9]*this.rawData[6],e=this.rawData[8]*this.rawData[6]-this.rawData[4]*this.rawData[10],i=this.rawData[4]*this.rawData[9]-this.rawData[8]*this.rawData[5],r=this.rawData[9]*this.rawData[2]-this.rawData[1]*this.rawData[10],a=this.rawData[0]*this.rawData[10]-this.rawData[8]*this.rawData[2],n=this.rawData[8]*this.rawData[1]-this.rawData[0]*this.rawData[9],o=this.rawData[1]*this.rawData[6]-this.rawData[5]*this.rawData[2],s=this.rawData[4]*this.rawData[2]-this.rawData[0]*this.rawData[6],h=this.rawData[0]*this.rawData[5]-this.rawData[4]*this.rawData[1],l=this.rawData[0]*t+this.rawData[4]*r+this.rawData[8]*o;if(Math.abs(l)>1e-11){var u=1/l;this.rawData[0]=u*t,this.rawData[4]=u*e,this.rawData[8]=u*i,this.rawData[1]=u*r,this.rawData[5]=u*a,this.rawData[9]=u*n,this.rawData[2]=u*o,this.rawData[6]=u*s,this.rawData[10]=u*h}},e.transpose=function(t,i){i=i||new e;var r=t.rawData,a=i.rawData;return a[0]=r[0],a[1]=r[4],a[2]=r[8],a[3]=r[12],a[4]=r[1],a[5]=r[5],a[6]=r[9],a[7]=r[13],a[8]=r[2],a[9]=r[6],a[10]=r[10],a[11]=r[14],a[12]=r[3],a[13]=r[7],a[14]=r[11],a[15]=r[15],i
},e.inverse=function(t,i){i=i||new e;var r=t.rawData,a=i.rawData;a[0]=r[5]*r[10]*r[15]-r[5]*r[14]*r[11]-r[6]*r[9]*r[15]+r[6]*r[13]*r[11]+r[7]*r[9]*r[14]-r[7]*r[13]*r[10],a[1]=-r[1]*r[10]*r[15]+r[1]*r[14]*r[11]+r[2]*r[9]*r[15]-r[2]*r[13]*r[11]-r[3]*r[9]*r[14]+r[3]*r[13]*r[10],a[2]=r[1]*r[6]*r[15]-r[1]*r[14]*r[7]-r[2]*r[5]*r[15]+r[2]*r[13]*r[7]+r[3]*r[5]*r[14]-r[3]*r[13]*r[6],a[3]=-r[1]*r[6]*r[11]+r[1]*r[10]*r[7]+r[2]*r[5]*r[11]-r[2]*r[9]*r[7]-r[3]*r[5]*r[10]+r[3]*r[9]*r[6],a[4]=-r[4]*r[10]*r[15]+r[4]*r[14]*r[11]+r[6]*r[8]*r[15]-r[6]*r[12]*r[11]-r[7]*r[8]*r[14]+r[7]*r[12]*r[10],a[5]=r[0]*r[10]*r[15]-r[0]*r[14]*r[11]-r[2]*r[8]*r[15]+r[2]*r[12]*r[11]+r[3]*r[8]*r[14]-r[3]*r[12]*r[10],a[6]=-r[0]*r[6]*r[15]+r[0]*r[14]*r[7]+r[2]*r[4]*r[15]-r[2]*r[12]*r[7]-r[3]*r[4]*r[14]+r[3]*r[12]*r[6],a[7]=r[0]*r[6]*r[11]-r[0]*r[10]*r[7]-r[2]*r[4]*r[11]+r[2]*r[8]*r[7]+r[3]*r[4]*r[10]-r[3]*r[8]*r[6],a[8]=r[4]*r[9]*r[15]-r[4]*r[13]*r[11]-r[5]*r[8]*r[15]+r[5]*r[12]*r[11]+r[7]*r[8]*r[13]-r[7]*r[12]*r[9],a[9]=-r[0]*r[9]*r[15]+r[0]*r[13]*r[11]+r[1]*r[8]*r[15]-r[1]*r[12]*r[11]-r[3]*r[8]*r[13]+r[3]*r[12]*r[9],a[10]=r[0]*r[5]*r[15]-r[0]*r[13]*r[7]-r[1]*r[4]*r[15]+r[1]*r[12]*r[7]+r[3]*r[4]*r[13]-r[3]*r[12]*r[5],a[11]=-r[0]*r[5]*r[11]+r[0]*r[9]*r[7]+r[1]*r[4]*r[11]-r[1]*r[8]*r[7]-r[3]*r[4]*r[9]+r[3]*r[8]*r[5],a[12]=-r[4]*r[9]*r[14]+r[4]*r[13]*r[10]+r[5]*r[8]*r[14]-r[5]*r[12]*r[10]-r[6]*r[8]*r[13]+r[6]*r[12]*r[9],a[13]=r[0]*r[9]*r[14]-r[0]*r[13]*r[10]-r[1]*r[8]*r[14]+r[1]*r[12]*r[10]+r[2]*r[8]*r[13]-r[2]*r[12]*r[9],a[14]=-r[0]*r[5]*r[14]+r[0]*r[13]*r[6]+r[1]*r[4]*r[14]-r[1]*r[12]*r[6]-r[2]*r[4]*r[13]+r[2]*r[12]*r[5],a[15]=r[0]*r[5]*r[10]-r[0]*r[9]*r[6]-r[1]*r[4]*r[10]+r[1]*r[8]*r[6]+r[2]*r[4]*r[9]-r[2]*r[8]*r[5];for(var n=r[0]*a[0]+r[1]*a[4]+r[2]*a[8]+r[3]*a[12],o=0;16>o;o++)a[o]/=n;return i},e.prototype.invert=function(){var t=this.determinant,e=Math.abs(t)>1e-11;if(e){t=1/t;var i=this.rawData[0],r=this.rawData[4],a=this.rawData[8],n=this.rawData[12],o=this.rawData[1],s=this.rawData[5],h=this.rawData[9],l=this.rawData[13],u=this.rawData[2],c=this.rawData[6],d=this.rawData[10],p=this.rawData[14],f=this.rawData[3],_=this.rawData[7],m=this.rawData[11],g=this.rawData[15];this.rawData[0]=t*(s*(d*g-p*m)-h*(c*g-p*_)+l*(c*m-d*_)),this.rawData[1]=-t*(o*(d*g-p*m)-h*(u*g-p*f)+l*(u*m-d*f)),this.rawData[2]=t*(o*(c*g-p*_)-s*(u*g-p*f)+l*(u*_-c*f)),this.rawData[3]=-t*(o*(c*m-d*_)-s*(u*m-d*f)+h*(u*_-c*f)),this.rawData[4]=-t*(r*(d*g-p*m)-a*(c*g-p*_)+n*(c*m-d*_)),this.rawData[5]=t*(i*(d*g-p*m)-a*(u*g-p*f)+n*(u*m-d*f)),this.rawData[6]=-t*(i*(c*g-p*_)-r*(u*g-p*f)+n*(u*_-c*f)),this.rawData[7]=t*(i*(c*m-d*_)-r*(u*m-d*f)+a*(u*_-c*f)),this.rawData[8]=t*(r*(h*g-l*m)-a*(s*g-l*_)+n*(s*m-h*_)),this.rawData[9]=-t*(i*(h*g-l*m)-a*(o*g-l*f)+n*(o*m-h*f)),this.rawData[10]=t*(i*(s*g-l*_)-r*(o*g-l*f)+n*(o*_-s*f)),this.rawData[11]=-t*(i*(s*m-h*_)-r*(o*m-h*f)+a*(o*_-s*f)),this.rawData[12]=-t*(r*(h*p-l*d)-a*(s*p-l*c)+n*(s*d-h*c)),this.rawData[13]=t*(i*(h*p-l*d)-a*(o*p-l*u)+n*(o*d-h*u)),this.rawData[14]=-t*(i*(s*p-l*c)-r*(o*p-l*u)+n*(o*c-s*u)),this.rawData[15]=t*(i*(s*d-h*c)-r*(o*d-h*u)+a*(o*c-s*u))}return e},e.prototype.makeTransform=function(e,i,r){this.appendScale(i.x,i.y,i.z),r.toMatrix3D(t.MathUtil.CALCULATION_MATRIX),this.append(t.MathUtil.CALCULATION_MATRIX),this.rawData[12]=e.x,this.rawData[13]=e.y,this.rawData[14]=e.z,this.rawData[15]=1},e.prototype.recompose=function(e){return t.MathUtil.CALCULATION_QUATERNION.fromEulerAngles(e[1].x,e[1].y,e[1].z),this.makeTransform(e[0],e[2],t.MathUtil.CALCULATION_QUATERNION),!0},e.prototype.transformVector=function(e,i){void 0===i&&(i=null),i||(i=new t.Vector3D);var r=e.x,a=e.y,n=e.z;return i.x=r*this.rawData[0]+a*this.rawData[4]+n*this.rawData[8]+this.rawData[12],i.y=r*this.rawData[1]+a*this.rawData[5]+n*this.rawData[9]+this.rawData[13],i.z=r*this.rawData[2]+a*this.rawData[6]+n*this.rawData[10]+this.rawData[14],i.w=r*this.rawData[3]+a*this.rawData[7]+n*this.rawData[11]+this.rawData[15],i},e.prototype.transformVector4=function(e,i){void 0===i&&(i=null),i||(i=new t.Vector3D);var r=e.x,a=e.y,n=e.z,o=e.w;return i.x=r*this.rawData[0]+a*this.rawData[4]+n*this.rawData[8]+o*this.rawData[12],i.y=r*this.rawData[1]+a*this.rawData[5]+n*this.rawData[9]+o*this.rawData[13],i.z=r*this.rawData[2]+a*this.rawData[6]+n*this.rawData[10]+o*this.rawData[14],i.w=r*this.rawData[3]+a*this.rawData[7]+n*this.rawData[11]+o*this.rawData[15],i},e.prototype.mat3TransformVector=function(e,i){void 0===i&&(i=null),i||(i=new t.Vector3D);var r=e.x,a=e.y,n=e.z;return i.x=r*this.rawData[0]+a*this.rawData[4]+n*this.rawData[8],i.y=r*this.rawData[1]+a*this.rawData[5]+n*this.rawData[9],i.z=r*this.rawData[2]+a*this.rawData[6]+n*this.rawData[10],i},e.prototype.transformPlane=function(i){var r=new e;r.copyFrom(this),r.invert(),r.transpose();var a=new t.Vector3D(i.a,i.b,i.c,i.d);a.copyFrom(r.transformVector(a));var n=new t.Plane3D;return n.a=a.x,n.b=a.y,n.c=a.z,n.d=a.w/Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z),n},e.prototype.transpose=function(){for(var t=0;t<e.helpMatrix.rawData.length;t++)e.helpMatrix.rawData[t]=this.rawData[t];this.rawData[1]=e.helpMatrix.rawData[4],this.rawData[2]=e.helpMatrix.rawData[8],this.rawData[3]=e.helpMatrix.rawData[12],this.rawData[4]=e.helpMatrix.rawData[1],this.rawData[6]=e.helpMatrix.rawData[9],this.rawData[7]=e.helpMatrix.rawData[13],this.rawData[8]=e.helpMatrix.rawData[2],this.rawData[9]=e.helpMatrix.rawData[6],this.rawData[11]=e.helpMatrix.rawData[14],this.rawData[12]=e.helpMatrix.rawData[3],this.rawData[13]=e.helpMatrix.rawData[7],this.rawData[14]=e.helpMatrix.rawData[11]},e.getAxisRotation=function(t,i,r,a){var n,o,s=new e,h=a*(Math.PI/180),l=Math.cos(h),u=Math.sin(h),c=1-l;return s.rawData[0]=l+t*t*c,s.rawData[5]=l+i*i*c,s.rawData[10]=l+r*r*c,n=t*i*c,o=r*u,s.rawData[1]=n+o,s.rawData[4]=n-o,n=t*r*c,o=i*u,s.rawData[8]=n+o,s.rawData[2]=n-o,n=i*r*c,o=t*u,s.rawData[9]=n-o,s.rawData[6]=n+o,s},Object.defineProperty(e.prototype,"determinant",{get:function(){return(this.rawData[0]*this.rawData[5]-this.rawData[4]*this.rawData[1])*(this.rawData[10]*this.rawData[15]-this.rawData[14]*this.rawData[11])-(this.rawData[0]*this.rawData[9]-this.rawData[8]*this.rawData[1])*(this.rawData[6]*this.rawData[15]-this.rawData[14]*this.rawData[7])+(this.rawData[0]*this.rawData[13]-this.rawData[12]*this.rawData[1])*(this.rawData[6]*this.rawData[11]-this.rawData[10]*this.rawData[7])+(this.rawData[4]*this.rawData[9]-this.rawData[8]*this.rawData[5])*(this.rawData[2]*this.rawData[15]-this.rawData[14]*this.rawData[3])-(this.rawData[4]*this.rawData[13]-this.rawData[12]*this.rawData[5])*(this.rawData[2]*this.rawData[11]-this.rawData[10]*this.rawData[3])+(this.rawData[8]*this.rawData[13]-this.rawData[12]*this.rawData[9])*(this.rawData[2]*this.rawData[7]-this.rawData[6]*this.rawData[3])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return new t.Vector3D(this.rawData[12],this.rawData[13],this.rawData[14])},set:function(t){this.rawData[12]=t.x,this.rawData[13]=t.y,this.rawData[14]=t.z},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return new t.Vector3D(this.rawData[0],this.rawData[5],this.rawData[10])},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return"matrix3d("+Math.round(1e3*this.rawData[0])/1e3+","+Math.round(1e3*this.rawData[1])/1e3+","+Math.round(1e3*this.rawData[2])/1e3+","+Math.round(1e3*this.rawData[3])/1e3+","+Math.round(1e3*this.rawData[4])/1e3+","+Math.round(1e3*this.rawData[5])/1e3+","+Math.round(1e3*this.rawData[6])/1e3+","+Math.round(1e3*this.rawData[7])/1e3+","+Math.round(1e3*this.rawData[8])/1e3+","+Math.round(1e3*this.rawData[9])/1e3+","+Math.round(1e3*this.rawData[10])/1e3+","+Math.round(1e3*this.rawData[11])/1e3+","+Math.round(1e3*this.rawData[12])/1e3+","+Math.round(1e3*this.rawData[13])/1e3+","+Math.round(1e3*this.rawData[14])/1e3+","+Math.round(1e3*this.rawData[15])/1e3+")"},e.prototype.lerp=function(t,e,i){this.copyFrom(e).sub(t).mult(i).add(t)},e.helpMatrix=new e,e}();t.Matrix4_4=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.eyeSpace=1,this.eyePosition=new t.Vector3D,this.eyeRotation=new t.Vector3D(0,1,0),this.eyeFocalLength=180,this.leftPos=new t.Vector3D,this.rightPos=new t.Vector3D,this.targetPos=new t.Vector3D(0,0,this.eyeFocalLength),this.lookAtPos=new t.Vector3D,this.quaternion=new t.Quaternion,this.dir=new t.Vector3D,this.leftEyeMatrix=new t.Matrix4_4,this.rightEyeMatrix=new t.Matrix4_4}return e.prototype.update=function(e){e.globalOrientation.transformVector(t.Vector3D.X_AXIS,this.dir),this.dir.normalize(),this.leftEyeMatrix.copyFrom(e.modelMatrix),this.rightEyeMatrix.copyFrom(e.modelMatrix);var i=.5*this.eyeSpace;this.leftEyeMatrix.appendTranslation(-this.dir.x*i,-this.dir.y*i,-this.dir.z*i),this.rightEyeMatrix.appendTranslation(this.dir.x*i,this.dir.y*i,this.dir.z*i)},e}();t.EyesMatrix=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){}return t.BACK=0,t.FRONT=1,t.IN=0,t.OUT=1,t.INTERSECT=2,t}();t.PlaneClassification=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.quaternion2matrix=function(i,r){void 0===r&&(r=null);var a=i.x,n=i.y,o=i.z,s=i.w,h=a*a,l=a*n,u=a*o,c=a*s,d=n*n,p=n*o,f=n*s,_=o*o,m=o*s,g=e.RAW_DATA_CONTAINER;return g[0]=1-2*(d+_),g[1]=2*(l+m),g[2]=2*(u-f),g[4]=2*(l-m),g[5]=1-2*(h+_),g[6]=2*(p+c),g[8]=2*(u+f),g[9]=2*(p-c),g[10]=1-2*(h+d),g[3]=g[7]=g[11]=g[12]=g[13]=g[14]=0,g[15]=1,r?(r.copyRawDataFrom(g),r):new t.Matrix4_4(new Float32Array(g))},e.getForward=function(e,i){return void 0===i&&(i=null),null===i&&(i=new t.Vector3D(0,0,0)),e.copyRowTo(2,i),i.normalize(),i},e.getUp=function(e,i){return void 0===i&&(i=null),null===i&&(i=new t.Vector3D(0,0,0)),e.copyRowTo(1,i),i.normalize(),i},e.getRight=function(e,i){return void 0===i&&(i=null),null===i&&(i=new t.Vector3D(0,0,0)),e.copyRowTo(0,i),i.normalize(),i},e.compare=function(t,i){var r=e.RAW_DATA_CONTAINER,a=i.rawData;t.copyRawDataTo(r);for(var n=0;16>n;++n)if(r[n]!=a[n])return!1;return!0},e.reflection=function(i,r){void 0===r&&(r=null),null===r&&(r=new t.Matrix4_4);var a=i.a,n=i.b,o=i.c,s=i.d,h=e.RAW_DATA_CONTAINER,l=-2*a*n,u=-2*a*o,c=-2*n*o;return h[0]=1-2*a*a,h[4]=l,h[8]=u,h[12]=-2*a*s,h[1]=l,h[5]=1-2*n*n,h[9]=c,h[13]=-2*n*s,h[2]=u,h[6]=c,h[10]=1-2*o*o,h[14]=-2*o*s,h[3]=0,h[7]=0,h[11]=0,h[15]=1,r.copyRawDataFrom(h),r},e.getTranslation=function(e,i){return void 0===i&&(i=null),i||(i=new t.Vector3D),e.copyRowTo(3,i),i},e.clampf=function(t,e,i){if(e>i){var r=e;e=i,i=r}return e>t?e:i>t?t:i},e.ScreenToPosition=function(t,e,i){return(t+.5*e)/i*2-1},e.PositionToScreen=function(t,e,i){return.5*(t+1)*i-.5*e},e.RADIANS_TO_DEGREES=180/Math.PI,e.DEGREES_TO_RADIANS=Math.PI/180,e.MAX_VALUE=2147483647,e.MIN_VALUE=-2147483647,e.RAW_DATA_CONTAINER=new Float32Array(16),e.CALCULATION_MATRIX=new t.Matrix4_4,e.CALCULATION_QUATERNION=new t.Quaternion,e.CALCULATION_VECTOR3D=new t.Vector3D,e}();t.MathUtil=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e,i){void 0===e&&(e=new t.Vector3D),void 0===i&&(i=new t.Vector3D),this.origin=new t.Vector3D,this.dir=new t.Vector3D,this.invViewMat=new t.Matrix4_4,this.origin.copyFrom(e),this.dir.copyFrom(i)}return e.prototype.IntersectTriangle=function(t,e,i,r){void 0===r&&(r=null);var a,n=e.subtract(t),o=i.subtract(t),s=this.dir.crossProduct(o),h=n.dotProduct(s);if(h>0?a=this.origin.subtract(t):(a=t.subtract(this.origin),h=-h),1e-4>h)return!1;var l=a.dotProduct(s);if(null!=r&&(r[1]=l),0>l||l>h)return!1;var u=a.crossProduct(n),c=this.dir.dotProduct(u);if(null!=r&&(r[2]=c),0>c||l+c>h)return!1;var d=o.dotProduct(u),p=1/h;return d*=p,l*=p,c*=p,null!=r&&(r[0]=d,r[1]=l,r[2]=c),0>d?!1:!0},e.prototype.IntersectMeshEx=function(t,e,i){return this.IntersectMesh(t.geometry.vertexArray,t.geometry.indexArray,t.geometry.vertexAttLength,t.geometry.faceCount,e,t.modelMatrix,i)},e.prototype.IntersectMesh=function(e,i,r,a,n,o,s){var h=new Array;h.push(new t.Vector3D),h.push(new t.Vector3D),h.push(new t.Vector3D);var l=new Array;l.push(new t.Vector3D),l.push(new t.Vector3D),l.push(new t.Vector3D);var u=new Array,c=new t.Vector3D,d=new t.Vector3D,p=new t.Vector3D;u.push(c),u.push(d),u.push(p);var f=new t.Vector3D,_=new t.Point,m=new Array;m.push(0),m.push(0),m.push(0);for(var g=-1,v=t.MathUtil.MAX_VALUE,y=0,x=0,b=0;a>b;++b){for(var D=0;3>D;++D){var T=i[3*b+D];f.setTo(e[r*T+0],e[r*T+1],e[r*T+2]),f.copyFrom(o.transformVector(f)),u[D].x=f.x,u[D].y=f.y,u[D].z=f.z}this.IntersectTriangle(c,d,p,m)&&m[0]<v&&(g=b,v=m[0],y=m[1],x=m[2])}if(a>g&&g>=0){for(var b=0;3>b;++b){var T=i[3*g+b];f.setTo(e[r*T+0],e[r*T+1],e[r*T+2]),h[b].copyFrom(f),n>0&&(_.x=e[r*T+0+n],_.y=e[r*T+1+n],l[b].x=_.x,l[b].y=_.y),f.copyFrom(o.transformVector(f)),u[b].x=f.x,u[b].y=f.y,u[b].z=f.z}s.faceIndex=g,s.v0=i[3*g+0],s.v1=i[3*g+1],s.v2=i[3*g+2];var w=d.subtract(c);w.scaleBy(y);var P=p.subtract(c);return P.scaleBy(x),s.globalPosition.copyFrom(c.add(w.add(P))),w=h[1].subtract(h[0]),w.scaleBy(y),P=h[2].subtract(h[0]),P.scaleBy(x),s.localPosition.copyFrom(h[0].add(w.add(P))),n>0&&(w=l[1].subtract(l[0]),w.scaleBy(y),P=l[2].subtract(l[0]),P.scaleBy(x),s.uv.copyFrom(l[0].add(w.add(P)))),!0}return!1},e.prototype.CalculateAndTransformRay=function(t,e,i,r,a,n){this.reset(),this.dir.x=(2*a/t-1)/r.rawData[0],this.dir.y=(-2*n/e+1)/r.rawData[5],this.dir.z=1,this.invViewMat.copyFrom(i),this.origin.copyFrom(this.invViewMat.transformVector(this.origin)),this.dir.copyFrom(this.invViewMat.deltaTransformVector(this.dir)),this.dir.normalize()},e.prototype.reset=function(){this.origin.setTo(0,0,0),this.dir.setTo(0,0,0)},e}();t.Ray=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=255),this.a=255,this.r=255,this.g=255,this.b=255,this.a=r,this.r=t,this.g=e,this.b=i}return e.white=function(){return new e(255,255,255,255)},e.black=function(){return new e(0,0,0,255)},e.red=function(){return new e(255,0,0,255)},e.green=function(){return new e(0,255,0,255)},e.blue=function(){return new e(0,0,255,255)},e.prototype.getColor=function(e){return void 0===e&&(e=t.ContextConfig.ColorFormat_RGBA8888),e==t.ContextConfig.ColorFormat_RGB565?0:e==t.ContextConfig.ColorFormat_RGBA5551?0:e==t.ContextConfig.ColorFormat_RGBA4444?0:this.r<<24|this.g<<16|this.b<<8|this.a},e.prototype.lerp=function(t,e,i){this.a=i*(e.a-t.a)+t.a,this.r=i*(e.r-t.r)+t.r,this.g=i*(e.g-t.g)+t.g,this.b=i*(e.b-t.b)+t.b,this.a=Math.floor(this.a),this.r=Math.floor(this.r),this.g=Math.floor(this.g),this.b=Math.floor(this.b)},e.prototype.copyFrom=function(t){this.a=t.a,this.r=t.r,this.g=t.g,this.b=t.b},e.prototype.setTo=function(t,e,i,r){void 0===t&&(t=255),void 0===e&&(e=255),void 0===i&&(i=255),void 0===r&&(r=255),this.a=t,this.r=e,this.g=i,this.b=r},e.createColor=function(t){var i=new e;return i.setColorARGB(t),i},e.prototype.setColorARGB=function(t){this.a=t/16777216,this.a>>=0,this.r=16711680&t,this.r>>=16,this.g=65280&t,this.g>>=8,this.b=255&t},e.prototype.setColorRGB=function(t){this.r=16711680&t,this.r>>=16,this.g=65280&t,this.g>>=8,this.b=255&t},e.prototype.randomColor=function(t,e,i){if(void 0===i&&(i=!1),i){var r=Math.random();this.a=t.a+(e.a-t.a)*r,this.r=t.r+(e.r-t.r)*r,this.g=t.g+(e.g-t.g)*r,this.b=t.b+(e.b-t.b)*r}else this.a=t.a+(e.a-t.a)*Math.random(),this.r=t.r+(e.r-t.r)*Math.random(),this.g=t.g+(e.g-t.g)*Math.random(),this.b=t.b+(e.b-t.b)*Math.random();this.a=Math.floor(this.a),this.r=Math.floor(this.r),this.g=Math.floor(this.g),this.b=Math.floor(this.b)},e}();t.Color=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.colors=[],this.times=[]}return e.prototype.lerpColor=function(e,i){void 0===i&&(i=null),0>e?e=0:e>1&&(e=1),null==i&&(i=new t.Color);for(var r=0,a=this.times.length-1;a>r;r++)if(e>=this.times[r]&&e<this.times[r+1]){e=(e-this.times[r])/(this.times[r+1]-this.times[r]),i.lerp(this.colors[r],this.colors[r+1],e);break}return i},e}();t.ColorGradients=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e){this.vexLength=3,this._bound=new t.Wireframe,this.matrix=new t.Matrix4_4,this.temp=new t.Vector3D,this.owner=e,this._bound.material.diffuseColor=16777215,this._bound.name="Bound",this._bound.geometry.vertexCount=8,this._bound.geometry.indexCount=24,this._bound.geometry.setVertexIndices(0,[0,1,1,2,2,3,0,3,4,5,5,6,6,7,4,7,0,4,1,5,3,7,2,6])}return Object.defineProperty(e.prototype,"visible",{get:function(){return this._bound.parent?!0:!1},set:function(t){t?this._bound.parent||this.owner.addChild(this._bound):this._bound.parent&&this._bound.parent.removeChild(this._bound)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transform",{get:function(){return this.owner?this.owner.modelMatrix:this.matrix},enumerable:!0,configurable:!0}),e.prototype.pointIntersect=function(){return!1},e.prototype.intersect=function(t,e){return void 0===e&&(e=null),!0},e.prototype.clone=function(){var t=new e(this.owner);return t.copyVertex(this),t},e.prototype.calculateTransform=function(){for(var t=0;t<this.vexData.length;t+=3)this.temp.setTo(this.vexData[t],this.vexData[t+1],this.vexData[t+2]),this.transform.transformVector(this.temp,this.temp),this.vexData[t+0]=this.temp.x,this.vexData[t+1]=this.temp.y,this.vexData[t+2]=this.temp.z},e.prototype.copyVertex=function(t){for(var e=0;e<t.vexData.length;++e)this.vexData[e]=t.vexData[e];for(var e=0;e<t.indexData.length;++e)this.indexData[e]=t.indexData[e];this.vexLength=t.vexLength},e.prototype.createChild=function(){this.childBound=new e(this.owner)},e.prototype.inBound=function(){return!0},e.prototype.updateAABB=function(){},e}();t.Bound=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(t){void 0===t&&(t=!1),this.data=[],this.list=new Array,t&&(this.list=new Array)}return t.prototype.isHas=function(t){return this.data[t]?!0:!1},t.prototype.getValue=function(t){return this.data[t]},t.prototype.getList=function(){return this.list},t.prototype.add=function(t,e){this.data[t]=e,this.list&&this.list.push(e)},t.prototype.remove=function(t){if(this.list){var e=this.list.indexOf(this.data[t]);-1!=e&&this.list.splice(e)}delete this.data[t]},t.prototype.dispose=function(){delete this.data,delete this.list},t}();t.HashMap=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r,a){void 0===i&&(i=null),void 0===r&&(r=new t.Vector3D),void 0===a&&(a=new t.Vector3D),e.call(this,i),this.min=new t.Vector3D,this.max=new t.Vector3D,this.width=0,this.heigth=0,this.depth=0,this.volume=0,this.center=new t.Vector3D,this.radius=0,this.min.copyFrom(r),this.max.copyFrom(a),this.calculateBox()}return __extends(i,e),i.prototype.copyFrom=function(t){this.min.copyFrom(t.min),this.max.copyFrom(t.max),this.calculateBox()},i.prototype.fillBox=function(t,e){this.min.copyFrom(t),this.max.copyFrom(e),this.calculateBox()},i.prototype.pointIntersect=function(t){return t.x<=this.max.x&&t.x>=this.min.x&&t.y<=this.max.y&&t.y>=this.min.y&&t.z<=this.max.z&&t.z>=this.min.z?!0:!1},i.prototype.intersectAABBs=function(t,e){return void 0===e&&(e=null),this.min.x>t.max.x?!1:this.max.x<t.min.x?!1:this.min.y>t.max.y?!1:this.max.y<t.min.y?!1:this.min.z>t.max.z?!1:this.max.z<t.min.z?!1:(null!=e&&(e.min.x=Math.max(this.min.x,t.min.x),e.max.x=Math.min(this.max.x,t.max.x),e.min.y=Math.max(this.min.y,t.min.y),e.max.y=Math.min(this.max.y,t.max.y),e.min.z=Math.max(this.min.z,t.min.z),e.max.z=Math.min(this.max.z,t.max.z),e.calculateBox()),!0)},i.prototype.intersect=function(t,e){return void 0===e&&(e=null),this._box0?(this._box0.copyVertex(this),this._box0.owner=this.owner):this._box0=this.clone(),this._box0.calculateTransform(),this._box0.updateAABB(),this._box1?(this._box1.copyVertex(this),this._box1.owner=t.owner):this._box1=t.clone(),this._box1.calculateTransform(),this._box1.updateAABB(),this._box0.intersectAABBs(this._box1,e)},i.prototype.toString=function(){return"BoundBox [min:("+this.min.x+", "+this.min.y+", "+this.min.z+") max:("+this.max.x+", "+this.max.y+", "+this.max.z+")]"},i.prototype.calculateBox=function(){var e=this.max.subtract(this.min);this.vexData=this.vexData||new Float32Array(24),this.indexData=this.indexData||new Uint16Array(36),this.vexData[0]=this.min.x,this.vexData[1]=this.min.y,this.vexData[2]=this.min.z,this.vexData[3]=this.min.x,this.vexData[4]=this.min.y,this.vexData[5]=this.min.z+e.z,this.vexData[6]=this.min.x+e.x,this.vexData[7]=this.min.y,this.vexData[8]=this.min.z+e.z,this.vexData[9]=this.min.x+e.x,this.vexData[10]=this.min.y,this.vexData[11]=this.min.z,this.vexData[12]=this.max.x-e.x,this.vexData[13]=this.max.y,this.vexData[14]=this.max.z-e.z,this.vexData[15]=this.max.x-e.x,this.vexData[16]=this.max.y,this.vexData[17]=this.max.z,this.vexData[18]=this.max.x,this.vexData[19]=this.max.y,this.vexData[20]=this.max.z,this.vexData[21]=this.max.x,this.vexData[22]=this.max.y,this.vexData[23]=this.max.z-e.z,this.indexData[0]=0,this.indexData[1]=4,this.indexData[2]=7,this.indexData[3]=0,this.indexData[4]=7,this.indexData[5]=3,this.indexData[6]=2,this.indexData[7]=6,this.indexData[8]=5,this.indexData[9]=2,this.indexData[10]=5,this.indexData[11]=1,this.indexData[12]=4,this.indexData[13]=5,this.indexData[14]=6,this.indexData[15]=4,this.indexData[16]=6,this.indexData[17]=7,this.indexData[18]=0,this.indexData[19]=3,this.indexData[20]=2,this.indexData[21]=0,this.indexData[22]=2,this.indexData[23]=1,this.indexData[24]=0,this.indexData[25]=1,this.indexData[26]=5,this.indexData[27]=0,this.indexData[28]=5,this.indexData[29]=4,this.indexData[30]=3,this.indexData[31]=7,this.indexData[32]=6,this.indexData[33]=3,this.indexData[34]=6,this.indexData[35]=2,this.width=this.max.x-this.min.x,this.heigth=this.max.y-this.min.y,this.depth=this.max.z-this.min.z,this.volume=this.width*this.heigth*this.depth;var i=this.max.subtract(this.min);i.scaleBy(.5),this.radius=i.length,this.center.copyFrom(this.min);var r=this.center.add(i);this.center.copyFrom(r);for(var a=0;8>a;++a)this._bound.geometry.setVerticesForIndex(a,t.VertexFormat.VF_POSITION,[this.vexData[3*a+0],this.vexData[3*a+1],this.vexData[3*a+2]],1)},i.prototype.inBound=function(t){return t.inBox(this)},i.prototype.updateAABB=function(){this.min.copyFrom(new t.Vector3D(t.MathUtil.MAX_VALUE,t.MathUtil.MAX_VALUE,t.MathUtil.MAX_VALUE)),this.max.copyFrom(new t.Vector3D(-t.MathUtil.MAX_VALUE,-t.MathUtil.MAX_VALUE,-t.MathUtil.MAX_VALUE));for(var e=0;e<this.vexData.length;e+=this.vexLength)this.max.x<this.vexData[e]&&(this.max.x=this.vexData[e]),this.max.y<this.vexData[e+1]&&(this.max.y=this.vexData[e+1]),this.max.z<this.vexData[e+2]&&(this.max.z=this.vexData[e+2]),this.min.x>this.vexData[e]&&(this.min.x=this.vexData[e]),this.min.y>this.vexData[e+1]&&(this.min.y=this.vexData[e+1]),this.min.z>this.vexData[e+2]&&(this.min.z=this.vexData[e+2])},i.prototype.createChild=function(){this.childBound=new i(this.owner);var e=new t.Vector3D,r=new t.Vector3D;e.x=this.center.x+this.width/4,e.y=this.center.y+this.heigth/4,e.z=this.center.z+this.depth/4,r.x=this.center.x-this.width/4,r.y=this.center.y-this.heigth/4,r.z=this.center.z-this.depth/4,this.childBound.fillBox(r,e)},i.prototype.clone=function(){var t=new i(this.owner);return t.copyVertex(this),t.width=this.width,t.heigth=this.heigth,t.depth=this.depth,t.min.copyFrom(this.min),t.max.copyFrom(this.max),t.volume=this.volume,t.center.copyFrom(this.center),t.radius=this.radius,t},i}(t.Bound);t.BoundBox=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){}return t.prototype.calcBezierY=function(t,e,i){for(var r,a,n,o,s=0;3>s;s++)if(i>=t[s].x&&i<=t[s+1].x){r=t[s],a=e[s],n=t[s+1],o=e[s+1];break}return r||(r=t[t.length-1]),a||(a=e[e.length-1]),n=n||r,o=o||a,i=(i-r.x)/(n.x-r.x),this.cubic_bezier(r.y,a.y,o.y,n.y,i)},t.prototype.calcBezierX=function(t,e,i){for(var r,a,n,o,s=0;3>s;s++)if(i>=t[s].x&&i<=t[s+1].x){r=t[s],a=e[s],n=t[s+1],o=e[s+1];break}return i=(i-r.x)/(n.x-r.x),this.cubic_bezier(r.x,a.x,o.x,n.x,i)},t.prototype.cubic_bezier=function(t,e,i,r,a){return t=this.mix(t,e,a),e=this.mix(e,i,a),i=this.mix(i,r,a),t=this.mix(t,e,a),e=this.mix(e,i,a),t=this.mix(t,e,a)},t.prototype.mix=function(t,e,i){return t*(1-i)+e*i},t}();t.BezierCurve=e;var i=function(){function i(){this.posPoints=[],this.ctrlPoints=[]}return i.prototype.calc=function(t){var e=i.calc.calcBezierY(this.posPoints,this.ctrlPoints,t);return e},i.prototype.trySampler=function(){for(var t=0,e=this.posPoints.length;e>t;t++)if(0!=this.posPoints[t].y||0!=this.ctrlPoints[t].y)return this.doSampler();return null},i.prototype.sampler=function(){return this.doSampler()},i.prototype.doSampler=function(){var t,e,r,a=[],n=[],o=0,s=0,h=9;for(e=0,r=i.SegCount;r>e;e++){a.push(this.posPoints[2*e].y),o=this.posPoints[2*e].x,s=this.posPoints[2*e+1].x,t=(s-o)/h,n.push(t);for(var l=1;h>l;l++)a.push(this.calc(o+t*l));a.push(this.posPoints[2*e+1].y)}var u=new Float32Array(a.length+n.length);for(e=0,r=a.length;r>e;e++)u[e]=a[e];for(var l=0,r=n.length;r>l;e++,l++)u[e]=n[l];return u},i.prototype.validate=function(){null==this.posPoints&&(this.posPoints=[]),null==this.ctrlPoints&&(this.ctrlPoints=[]);var e=0,r=0;for(e=this.posPoints.length/2,r=i.SegCount;r>e;e++)this.posPoints.push(new t.Point(0,0)),this.posPoints.push(new t.Point(1,0));for(e=this.ctrlPoints.length/2,r=i.SegCount;r>e;e++)this.ctrlPoints.push(new t.Point(0,0)),this.ctrlPoints.push(new t.Point(1,0));this.ctrlPoints.length=2*i.SegCount,this.posPoints.length=2*i.SegCount},i.compressFloats=function(e,r){e.length%2==1&&e.push(0);var a=0;a+=5*i.SegCount,a+=2,a+=1,a+=i.SegCount;var n,o,s=new Float32Array(a),h=4096,l=h-1,u=[];u.length=e.length;var c,d=t.MathUtil.MAX_VALUE,p=-d;for(n=0,o=e.length;o>n;n++)c=u[n]=e[n],p=Math.max(c,p),d=Math.min(c,d);var f=p-d;if(f>0){var _=0;for(n=0,o=u.length;o>n;n++)_=u[n],_-=d,_/=f,_*=l,u[n]=Math.floor(_);var m,g;for(n=0,o=u.length/2;o>n;n++)m=u[2*n],g=u[2*n+1],s[n]=m+g/h;s[n]=d,n++,s[n]=f,n++,s[n]=0,n++}else{for(n=0,o=u.length/2;o>n;n++)s[n]=d;s[n]=d,n++,s[n]=f,n++,s[n]=1,n++}for(var v=0,o=i.SegCount;o>v;n++,v++)s[n]=r[v];return s},i.SegCount=2,i.calc=new e,i}();t.BezierData=i}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.m44=new t.Matrix4_4,this.alpha=1}return e.prototype.scale=function(t,e,i,r){void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=1),void 0===r&&(r=1),this.m44.appendScale(t,e,i),this.alpha*=r},e.prototype.offset=function(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),this.m44.appendTranslation(t,e,i),this.alpha+=r},e.prototype.gray=function(){var t=new Float32Array(16);t[0]=.2126,t[1]=.7152,t[2]=.0722,t[3]=1,t[4]=.2126,t[5]=.7152,t[6]=.0722,t[7]=1,t[8]=.2126,t[9]=.7152,t[10]=.0722,t[11]=1,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this.m44.copyRawDataFrom(t,0,!1)},e.prototype.reset=function(){this.m44.identity(),this.alpha=1},e.prototype.multiply=function(t){this.m44.multiply(t.m44),this.alpha*=t.alpha},e.prototype.copyFrom=function(t){this.m44.copyFrom(t.m44),this.alpha=t.alpha},e.prototype.copyTo=function(t){t.copyFrom(this)},e.prototype.setColorRGB=function(t){var e=16711680&t;e>>=16;var i=65280&t;i>>=8;var r=255&t;e/=255,i/=255,r/=255,this.m44.identity(),this.scale(e,i,r,1)},e}();t.ColorTransform=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.localPosition=new t.Vector3D,this.globalPosition=new t.Vector3D,this.uv=new t.Vector3D}return e}();t.PickResult=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this.time=0,this.delay=0,this.eventType=t,this.data=e}return t.ENTER_FRAME="enter_frame",t.RESIZE="resize",t.CHANGE="change",t}();t.Event3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null),t.call(this,e,i)}return __extends(e,t),e.EVENT_PLAY_COMPLETE="event_play_complete",e}(t.Event3D);t.PropertyAnimEvent3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null),t.call(this,e,i)}return __extends(e,t),e.EVENT_PLAY_COMPLETE="event_play_complete",e.EVENT_FRAME_CHANGE="event_frame_change",e}(t.Event3D);t.SkeletonAnimationEvent3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t.Mouse_Left=0]="Mouse_Left",t[t.Mouse_Mid=1]="Mouse_Mid",t[t.Mouse_Right=2]="Mouse_Right"}(t.MouseCode||(t.MouseCode={}));var e=(t.MouseCode,function(t){function e(){t.apply(this,arguments),this.mouseCode=0}return __extends(e,t),e.MOUSE_CLICK="onMouseClick",e.MOUSE_DOWN="onMouseDown",e.MOUSE_UP="onMouseUp",e.MOUSE_MOVE="onMouseMove",e.MOUSE_OVER="onMouseOver",e.MOUSE_OUT="onMouseOut",e.MOUSE_WHEEL="onMouseWheel",e}(t.Event3D));t.MouseEvent3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.TOUCH_MOVE="onTouchMove",e.TOUCH_START="onTouchStart",e.TOUCH_END="onTouchEnd",e}(t.Event3D);t.TouchEvent3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.PICK_CLICK="onPickClick",e.PICK_DOWN="onPickDown",e.PICK_UP="onPickUp",e.PICK_MOVE="onPickMove",e.PICK_WHEEL="onPickWheel",e}(t.Event3D);t.PickEvent3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t.Key_BackSpace=8]="Key_BackSpace",t[t.Key_Tab=9]="Key_Tab",t[t.Key_Clear=12]="Key_Clear",t[t.Key_Enter=13]="Key_Enter",t[t.Key_Shift_L=16]="Key_Shift_L",t[t.Key_Control_L=17]="Key_Control_L",t[t.Key_Alt_L=18]="Key_Alt_L",t[t.Key_Pause=19]="Key_Pause",t[t.Key_CapsLock=20]="Key_CapsLock",t[t.Key_Escape=21]="Key_Escape",t[t.Key_Space=32]="Key_Space",t[t.Key_Prior=33]="Key_Prior",t[t.Key_Next=34]="Key_Next",t[t.Key_End=35]="Key_End",t[t.Key_Home=36]="Key_Home",t[t.Key_Left=37]="Key_Left",t[t.Key_Up=38]="Key_Up",t[t.Key_Right=39]="Key_Right",t[t.Key_Down=40]="Key_Down",t[t.Key_Select=41]="Key_Select",t[t.Key_Print=42]="Key_Print",t[t.Key_Execute=43]="Key_Execute",t[t.Key_Insert=45]="Key_Insert",t[t.Key_Delete=46]="Key_Delete",t[t.Key_Help=47]="Key_Help",t[t.Key_0=48]="Key_0",t[t.Key_1=49]="Key_1",t[t.Key_2=50]="Key_2",t[t.Key_3=51]="Key_3",t[t.Key_4=52]="Key_4",t[t.Key_5=53]="Key_5",t[t.Key_6=54]="Key_6",t[t.Key_7=55]="Key_7",t[t.Key_8=56]="Key_8",t[t.Key_9=57]="Key_9",t[t.Key_A=65]="Key_A",t[t.Key_B=66]="Key_B",t[t.Key_C=67]="Key_C",t[t.Key_D=68]="Key_D",t[t.Key_E=69]="Key_E",t[t.Key_F=70]="Key_F",t[t.Key_G=71]="Key_G",t[t.Key_H=72]="Key_H",t[t.Key_I=73]="Key_I",t[t.Key_J=74]="Key_J",t[t.Key_K=75]="Key_K",t[t.Key_L=76]="Key_L",t[t.Key_M=77]="Key_M",t[t.Key_N=78]="Key_N",t[t.Key_O=79]="Key_O",t[t.Key_P=80]="Key_P",t[t.Key_Q=81]="Key_Q",t[t.Key_R=82]="Key_R",t[t.Key_S=83]="Key_S",t[t.Key_T=84]="Key_T",t[t.Key_U=85]="Key_U",t[t.Key_V=86]="Key_V",t[t.Key_W=87]="Key_W",t[t.Key_X=88]="Key_X",t[t.Key_Y=89]="Key_Y",t[t.Key_Z=90]="Key_Z",t[t.Key_KP_0=96]="Key_KP_0",t[t.Key_KP_1=97]="Key_KP_1",t[t.Key_KP_2=98]="Key_KP_2",t[t.Key_KP_3=99]="Key_KP_3",t[t.Key_KP_4=100]="Key_KP_4",t[t.Key_KP_5=101]="Key_KP_5",t[t.Key_KP_6=102]="Key_KP_6",t[t.Key_KP_7=103]="Key_KP_7",t[t.Key_KP_8=104]="Key_KP_8",t[t.Key_KP_9=105]="Key_KP_9",t[t.Key_Multiply=106]="Key_Multiply",t[t.Key_Add=107]="Key_Add",t[t.Key_Separator=108]="Key_Separator",t[t.Key_Subtract=109]="Key_Subtract",t[t.Key_Decimal=110]="Key_Decimal",t[t.Key_Divide=111]="Key_Divide",t[t.Key_F1=112]="Key_F1",t[t.Key_F2=113]="Key_F2",t[t.Key_F3=114]="Key_F3",t[t.Key_F4=115]="Key_F4",t[t.Key_F5=116]="Key_F5",t[t.Key_F6=117]="Key_F6",t[t.Key_F7=118]="Key_F7",t[t.Key_F8=119]="Key_F8",t[t.Key_F9=120]="Key_F9",t[t.Key_F10=121]="Key_F10",t[t.Key_F11=122]="Key_F11",t[t.Key_F12=123]="Key_F12",t[t.Key_F13=124]="Key_F13",t[t.Key_F14=125]="Key_F14",t[t.Key_F15=126]="Key_F15",t[t.Key_F16=127]="Key_F16",t[t.Key_F17=128]="Key_F17",t[t.Key_F18=129]="Key_F18",t[t.Key_F19=130]="Key_F19",t[t.Key_F20=131]="Key_F20",t[t.Key_F21=132]="Key_F21",t[t.Key_F22=133]="Key_F22",t[t.Key_F23=134]="Key_F23",t[t.Key_F24=135]="Key_F24",t[t.Key_Num_Lock=136]="Key_Num_Lock",t[t.Key_Scroll_Lock=137]="Key_Scroll_Lock"
}(t.KeyCode||(t.KeyCode={}));var e=(t.KeyCode,function(t){function e(){t.apply(this,arguments),this.keyCode=0}return __extends(e,t),e.KEY_CLICK="onKeyClick",e.KEY_DOWN="onKeyDown",e.KEY_UP="onKeyUp",e}(t.Event3D));t.KeyEvent3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t.Portrait_Primary=0]="Portrait_Primary",t[t.Portrait_Secondary=180]="Portrait_Secondary",t[t.Landscape_Primary=-90]="Landscape_Primary",t[t.Landscape_Secondary=90]="Landscape_Secondary"}(t.Orientation||(t.Orientation={}));var e=(t.Orientation,function(t){function e(){t.apply(this,arguments)}return __extends(e,t),Object.defineProperty(e.prototype,"orientation",{get:function(){var t=window.orientation;return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"acceleration",{get:function(){return this._acceleration},set:function(t){this._acceleration=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"accelerationIncludingGravity",{get:function(){return this._accelerationIncludingGravity},set:function(t){this._accelerationIncludingGravity=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationRate",{get:function(){return this._rotationRate},set:function(t){this._rotationRate=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"absolute",{get:function(){return this._absolute},set:function(t){this._absolute=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"beta",{get:function(){return this._beta},set:function(t){this._beta=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gamma",{get:function(){return this._gamma},set:function(t){this._gamma=t},enumerable:!0,configurable:!0}),e.ORIENTATION_CHANGE="onOrientationChange",e.DEVICE_MOTION="onDeviceMotion",e.DEVICE_ORIENTATION="onDeviceOrientation",e}(t.Event3D));t.OrientationEvent3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.LOADER_COMPLETE="onLoadComplete",e.LOADER_PROGRESS="onLoadProgress",e.LOADER_ERROR="onLoadError",e}(t.Event3D);t.LoaderEvent3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.PARSER_COMPLETE="onParserComplete",e}(t.Event3D);t.ParserEvent3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.EMIT_PARTICLE_BIRTH="EMIT_PARTICLE_BIRTH",e.EMIT_PARTICLE_DEATH="EMIT_PARTICLE_DEATH",e}(t.Event3D);t.ParticleEvent3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){this.listeners={}}return t.prototype.dispatchEvent=function(t){var e=this.listeners[t.eventType];if(null!=e){e=e.slice();for(var i=0;i<e.length;i++){var r=e[i];try{t.param=r.param,r.handler.call(r.thisObject,t)}catch(a){window.console&&console.error(a.stack)}}}},t.prototype.addEventListener=function(t,e,r,a,n){void 0===a&&(a=null),void 0===n&&(n=0),null==this.listeners[t]&&(this.listeners[t]=[]);var o=new i(t,r,e,a,n);return o.id=++i.event_id_count,this.listeners[t].push(o),this.listeners[t].sort(function(t,e){return e.priolity-t.priolity}),o.id},t.prototype.removeEventListener=function(t,e,i){if(this.hasEventListener(t,i,e))for(var r=0;r<this.listeners[t].length;r++){var a=this.listeners[t][r];if(a.equalCurrentListener(t,i,e,a.param))return a.handler=null,a.thisObject=null,void this.listeners[t].splice(r,1)}},t.prototype.removeEventListenerAt=function(t){for(var e in this.listeners)for(var i=0;i<this.listeners[e].length;i++){var r=this.listeners[e][i];if(r.id==t)return r.handler=null,r.thisObject=null,void this.listeners[e].splice(i,1)}},t.prototype.clearEventListener=function(){this.listeners={}},t.prototype.containEventListener=function(t){return null==this.listeners[t]?!1:this.listeners[t].length>0},t.prototype.hasEventListener=function(t,e,i){if(void 0===e&&(e=null),void 0===i&&(i=null),null==this.listeners[t])return!1;if(!e||!i)return!0;for(var r=0;r<this.listeners[t].length;r++){var a=this.listeners[t][r];if(a.equalCurrentListener(t,e,i,a.param))return!0}return!1},t}();t.EventDispatcher=e;var i=function(){function t(t,e,i,r,a){void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=0),this.type=t,this.thisObject=e,this.handler=i,this.param=r,this.priolity=a}return t.prototype.equalCurrentListener=function(t,e,i,r){return this.type==t&&this.thisObject==e&&this.handler==i&&this.param==r?!0:!1},t.event_id_count=0,t}()}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e){this._retRenderList=new Array,this._canvas=e,this._pickEvent3d=new t.PickEvent3D,t.Input.addEventListener(t.MouseEvent3D.MOUSE_CLICK,this.onMouseClick,this),t.Input.addEventListener(t.MouseEvent3D.MOUSE_DOWN,this.onMouseDown,this),t.Input.addEventListener(t.MouseEvent3D.MOUSE_UP,this.onMouseUp,this),t.Input.addEventListener(t.MouseEvent3D.MOUSE_MOVE,this.onMouseMove,this),t.Input.addEventListener(t.TouchEvent3D.TOUCH_START,this.onTouchDown,this),t.Input.addEventListener(t.TouchEvent3D.TOUCH_END,this.onTouchUp,this),t.Input.addEventListener(t.TouchEvent3D.TOUCH_MOVE,this.onTouchMove,this)}return Object.defineProperty(e.prototype,"_view3ds",{get:function(){return this._canvas.view3Ds},enumerable:!0,configurable:!0}),e.prototype.onClear=function(){this._canvas=null},e.prototype.onClearListeners=function(){},e.prototype.sendEvent=function(e,i,r){var a=this._canvas;if(a)for(var n=0;n<this._view3ds.length;n++){var o=this._view3ds[n];if(o.entityCollect&&o.entityCollect.mousePickList){var s=o.entityCollect.mousePickList,h=t.Picker.pickObject3DList(a,o,s,!1,this._retRenderList),l=h.length;if(!(0>=l)){for(var u=null,c=t.MathUtil.MAX_VALUE,d=0,p=null,f=!1,_=0;l>_;_++)p=h[_],d=t.Vector3D.distance(p.globalPosition,o.camera3D.globalPosition),c>d&&(c=d,u=h[_]),p.mouseChildren&&(f=p.mouseChildren);if(h.length>0)if(1==h.length&&u)u.dispatchEvent(r.call(this,i,e,u));else if(f)if(h=t.Picker.pickObject3DList(a,o,h,!0,this._retRenderList),c=t.MathUtil.MAX_VALUE,l=h.length,0>=l)u&&u.dispatchEvent(r.call(this,i,e,u));else{u=null;for(var _=0;l>_;_++)p=h[_],d=t.Vector3D.distance(p.globalPosition,o.camera3D.globalPosition),c>d&&(c=d,u=h[_]);u&&u.dispatchEvent(r.call(this,i,e,u))}else u&&u.dispatchEvent(r.call(this,i,e,u))}}}},e.prototype.initPickEvent3D=function(t,e,i){return this._pickEvent3d.eventType=t,this._pickEvent3d.target=i,this._pickEvent3d.data=e,this._pickEvent3d.pickResult=i.pickResult,this._pickEvent3d},e.prototype.onTouchMove=function(e){this.sendEvent(e,t.PickEvent3D.PICK_MOVE,this.initPickEvent3D)},e.prototype.onTouchUp=function(e){this.sendEvent(e,t.PickEvent3D.PICK_UP,this.initPickEvent3D)},e.prototype.onTouchDown=function(e){this.sendEvent(e,t.PickEvent3D.PICK_DOWN,this.initPickEvent3D)},e.prototype.onMouseClick=function(e){this.sendEvent(e,t.PickEvent3D.PICK_CLICK,this.initPickEvent3D)},e.prototype.onMouseDown=function(e){this.sendEvent(e,t.PickEvent3D.PICK_DOWN,this.initPickEvent3D)},e.prototype.onMouseUp=function(e){this.sendEvent(e,t.PickEvent3D.PICK_UP,this.initPickEvent3D)},e.prototype.onMouseMove=function(e){this.sendEvent(e,t.PickEvent3D.PICK_MOVE,this.initPickEvent3D)},e}();t.EventManager=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(t){this.index=0,this.shadersName=new Array,this.endShadername="",this.stateChange=!1,this.maxBone=0,this.shaderType=-1,this.shaderType=t}return e.prototype.addUseShaderName=function(t){this.shadersName.push(t)},e.prototype.addEndShaderName=function(t){this.endShadername=t},e.prototype.getShader=function(e){if(""!=this.endShadername){var i=this.shadersName.indexOf(this.endShadername);-1==i&&this.shadersName.push(this.endShadername)}return t.ShaderUtil.instance.fillShaderContent(this,this.shadersName,e)},e}();t.ShaderBase=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(){function t(){this.varName="",this.name="",this.key="",this.valueType="",this.value="",this.activeTextureIndex=-1,this.index=-1,this.level="",this.size=0,this.dataType=0,this.normalized=!1,this.stride=0,this.offset=0,this.offsetIndex=0,this.offsetBytes=0}return t.prototype["var"]=function(t){return this.level+" "+this.valueType+" "+name+"."+t},t.prototype.use=function(t){return void 0===t&&(t=""),""!=t?this.name+"."+t:this.name},t.prototype.clone=function(){var e=new t;return e.name=this.name,e.valueType=this.valueType,e.level=this.level,e.varName=this.varName,e.value=this.value,e.key=this.key,e},t.prototype.computeVarName=function(){var t=this.name.indexOf("[");this.varName=t>=0?this.name.substr(0,t):this.name},t}();t.VarRegister=e}(e=t.GLSL||(t.GLSL={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(t){function e(e,i){t.call(this),this.name=e,this.computeVarName(),this.key="attribute",this.valueType=i}return __extends(e,t),e}(t.VarRegister);t.Attribute=e}(e=t.GLSL||(t.GLSL={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(){function t(){}return t["int"]="int",t["float"]="float",t.vec2="vec2",t.vec3="vec3",t.vec4="vec4",t.mat2="mat2",t.mat3="mat3",t.mat4="mat4",t}();t.AttributeType=e}(e=t.GLSL||(t.GLSL={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(t){function e(e,i,r){t.call(this),this.name=e,this.computeVarName(),this.key="const",this.valueType=i,this.value=r}return __extends(e,t),e}(t.VarRegister);t.ConstVar=e}(e=t.GLSL||(t.GLSL={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(t){function e(e){t.call(this),this.name=e,this.computeVarName(),this.key="sampler2D"}return __extends(e,t),e}(t.VarRegister);t.Sampler2D=e}(e=t.GLSL||(t.GLSL={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(t){function e(e){t.call(this),this.name=e,this.computeVarName(),this.key="samplerCube"}return __extends(e,t),e}(t.VarRegister);t.Sampler3D=e}(e=t.GLSL||(t.GLSL={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(t){function e(e,i){t.call(this),this.name=e,this.computeVarName(),this.key="",this.valueType=i}return __extends(e,t),e}(t.VarRegister);t.TmpVar=e}(e=t.GLSL||(t.GLSL={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(t){function e(e,i){t.call(this),this.name=e,this.computeVarName(),this.key="uniform",this.valueType=i}return __extends(e,t),e}(t.VarRegister);t.Uniform=e}(e=t.GLSL||(t.GLSL={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(){function t(){}return t.bool="bool",t["int"]="int",t["float"]="float",t.vec2="vec2",t.vec3="vec3",t.vec4="vec4",t.bvec2="bvec2",t.bvec3="bvec3",t.bvec4="bvec4",t.ivec2="ivec2",t.ivec3="ivec3",t.ivec4="ivec4",t.mat2="mat2",t.mat3="mat3",t.mat4="mat4",t.sampler2D="sampler2D",t.sampleCube="sampleCube",t}();t.UniformType=e}(e=t.GLSL||(t.GLSL={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(){function t(){}return t.attribute_position="attribute_position",t.attribute_normal="attribute_normal",t.attribute_tangent="attribute_tangent",t.attribute_vertexColor="attribute_vertexColor",t.attribute_uv0="attribute_uv0",t.attribute_uv1="attribute_uv1",t.varying_pos="varying_pos",t.varying_normal="varying_normal",t.varying_tangent="varying_tangent",t.varying_color="varying_color",t.varying_uv0="varying_uv0",t.varying_uv1="varying_uv1",t.varying_globalPos="varying_globalPos",t.varying_lightDir="varying_lightDir",t.varying_eye="varying_eye",t.uniform_floatv_0="uniform_floatv_0",t.uniform_floatv_1="uniform_floatv_1",t.uniform_floatv_2="uniform_floatv_2",t.uniform_iv_0="uniform_iv_0",t.uniform_iv_1="uniform_iv_1",t.uniform_iv_2="uniform_iv_2",t.uniform_bv_0="uniform_bv_0",t.uniform_bv_1="uniform_bv_1",t.uniform_bv_2="uniform_bv_2",t.uniform_vec2fv_0="uniform_vec2fv_0",t.uniform_vec2fv_1="uniform_vec2fv_1",t.uniform_vec2fv_2="uniform_vec2fv_2",t.uniform_vec3fv_0="uniform_vec3fv_0",t.uniform_vec3fv_1="uniform_vec3fv_1",t.uniform_vec3fv_2="uniform_vec3fv_2",t.uniform_vec4fv_0="uniform_vec4fv_0",t.uniform_vec4fv_1="uniform_vec4fv_1",t.uniform_vec4fv_2="uniform_vec4fv_2",t.uniform_vec2iv_0="uniform_vec2iv_0",t.uniform_vec2iv_1="uniform_vec2iv_1",t.uniform_vec2iv_2="uniform_vec2iv_2",t.uniform_vec3iv_0="uniform_vec3iv_0",t.uniform_vec3iv_1="uniform_vec3iv_1",t.uniform_vec3iv_2="uniform_vec3iv_2",t.uniform_vec4iv_0="uniform_vec4iv_0",t.uniform_vec4iv_1="uniform_vec4iv_1",t.uniform_vec4iv_2="uniform_vec4iv_2",t.uniform_vec2bv_0="uniform_vec2bv_0",t.uniform_vec2bv_1="uniform_vec2bv_1",t.uniform_vec2bv_2="uniform_vec2bv_2",t.uniform_vec3bv_0="uniform_vec3bv_0",t.uniform_vec3bv_1="uniform_vec3bv_1",t.uniform_vec3bv_2="uniform_vec3bv_2",t.uniform_vec4bv_0="uniform_vec4bv_0",t.uniform_vec4bv_1="uniform_vec4bv_1",t.uniform_vec4bv_2="uniform_vec4bv_2",t.uniform_modelMatrix="uniform_modelMatrix",t.uniform_projectionMatrix="uniform_projectionMatrix",t.uniform_normalMatrix="uniform_normalMatrix",t.uniform_eye="uniform_eye",t.uniform_lightDir="uniform_lightDir",t.texture2D_0="texture2D_0",t.texture2D_1="texture2D_1",t.texture2D_2="texture2D_2",t.texture2D_3="texture2D_3",t.texture2D_4="texture2D_4",t}();t.VarConstName=e}(e=t.GLSL||(t.GLSL={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(t){function e(e,i){t.call(this),this.name=e,this.computeVarName(),this.key="varying",this.valueType=i}return __extends(e,t),e}(t.VarRegister);t.Varying=e}(e=t.GLSL||(t.GLSL={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(t){function e(e){t.call(this),this.name=e,this.computeVarName(),this.key="#extension"}return __extends(e,t),e}(t.VarRegister);t.Extension=e}(e=t.GLSL||(t.GLSL={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(t){function e(e,i){t.call(this),this.name=e,this.computeVarName(),this.key="#define",this.value=i}return __extends(e,t),e}(t.VarRegister);t.DefineVar=e}(e=t.GLSL||(t.GLSL={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(){function t(){}return t.bool="bool",t["int"]="int",t["float"]="float",t.vec2="vec2",t.vec3="vec3",t.vec4="vec4",t.bvec2="bvec2",t.bvec3="bvec3",t.bvec4="bvec4",t.ivec2="ivec2",t.ivec3="ivec3",t.ivec4="ivec4",t.mat2="mat2",t.mat3="mat3",t.mat4="mat4",t.sampler2D="sampler2D",t.sampleCube="sampleCube",t}();t.VaryingType=e}(e=t.GLSL||(t.GLSL={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){}return t.lib={alphaMask_fs:"uniform sampler2D maskTexture ; \nvoid main(void){ \nfloat maskAlpha = texture2D( maskTexture , uv_0 ).x; \nif(maskAlpha * diffuseColor.w < 0.001){ \ndiscard; \n} \nmaterialSource.alpha *= maskAlpha; \n} \n",AOMap_fs:"uniform sampler2D aoTexture ; \nuniform float aoPower ; \nvoid main(void){ \nfloat ao = texture2D( aoTexture , varying_uv1 ).x ; \ndiffuseColor.xyz *= (ao * aoPower) ; \n} \n",baseShadowPass_fs:"varying vec2 varying_uv0; \nvarying vec4 varying_color; \nvec4 outColor ; \nvec2 uv_0; \nvoid main() { \nuv_0 = varying_uv0; \n} \n",baseShadowPass_vs:"attribute vec3 attribute_position; \nattribute vec2 attribute_uv0; \nattribute vec4 attribute_color; \nuniform mat4 uniform_ProjectionMatrix ; \nvarying vec2 varying_uv0; \nvarying vec4 varying_color; \nvec3 e_position = vec3(0.0, 0.0, 0.0); \nvec4 outPosition ; \nvoid main(void){ \ne_position = attribute_position; \nvarying_color = attribute_color; \nvarying_uv0 = attribute_uv0; \n} \n",base_fs:"#extension GL_OES_standard_derivatives : enable \nvarying vec3 varying_eyeNormal  ; \nvarying vec2 varying_uv0; \nvarying vec4 varying_color; \nuniform mat4 uniform_ViewMatrix ; \nvec4 outColor ; \nvec4 diffuseColor ; \nvec4 specularColor ; \nvec4 ambientColor; \nvec4 light ; \nvec3 normal; \nvec2 uv_0; \nvec3 flatNormals(vec3 pos) { \nvec3 fdx = dFdx(pos); \nvec3 fdy = dFdy(pos); \nreturn normalize(cross(fdx, fdy)); \n} \nvoid main() { \ndiffuseColor  = vec4(1.0,1.0,1.0,1.0); \nspecularColor = vec4(0.0,0.0,0.0,0.0); \nambientColor  = vec4(0.0,0.0,0.0,0.0); \nlight         = vec4(1.0,1.0,1.0,1.0); \nnormal = normalize(varying_eyeNormal) ; \nuv_0 = varying_uv0; \n} \n",base_vs:"attribute vec3 attribute_position; \nattribute vec3 attribute_normal; \nattribute vec4 attribute_color; \nattribute vec2 attribute_uv0; \nvec3 e_position = vec3(0.0, 0.0, 0.0); \nuniform mat4 uniform_ModelMatrix ; \nuniform mat4 uniform_ViewMatrix ; \nuniform mat4 uniform_ProjectionMatrix ; \nvarying vec3 varying_eyeNormal  ; \nvarying vec2 varying_uv0; \nvarying vec4 varying_color; \nvec4 outPosition ; \nmat4 transpose(mat4 inMatrix) { \nvec4 i0 = inMatrix[0]; \nvec4 i1 = inMatrix[1]; \nvec4 i2 = inMatrix[2]; \nvec4 i3 = inMatrix[3]; \nmat4 outMatrix = mat4( \nvec4(i0.x, i1.x, i2.x, i3.x), \nvec4(i0.y, i1.y, i2.y, i3.y), \nvec4(i0.z, i1.z, i2.z, i3.z), \nvec4(i0.w, i1.w, i2.w, i3.w) \n); \nreturn outMatrix; \n} \nmat4 inverse(mat4 m) { \nfloat \na00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3], \na10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3], \na20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3], \na30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3], \nb00 = a00 * a11 - a01 * a10, \nb01 = a00 * a12 - a02 * a10, \nb02 = a00 * a13 - a03 * a10, \nb03 = a01 * a12 - a02 * a11, \nb04 = a01 * a13 - a03 * a11, \nb05 = a02 * a13 - a03 * a12, \nb06 = a20 * a31 - a21 * a30, \nb07 = a20 * a32 - a22 * a30, \nb08 = a20 * a33 - a23 * a30, \nb09 = a21 * a32 - a22 * a31, \nb10 = a21 * a33 - a23 * a31, \nb11 = a22 * a33 - a23 * a32, \ndet = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06; \nreturn mat4( \na11 * b11 - a12 * b10 + a13 * b09, \na02 * b10 - a01 * b11 - a03 * b09, \na31 * b05 - a32 * b04 + a33 * b03, \na22 * b04 - a21 * b05 - a23 * b03, \na12 * b08 - a10 * b11 - a13 * b07, \na00 * b11 - a02 * b08 + a03 * b07, \na32 * b02 - a30 * b05 - a33 * b01, \na20 * b05 - a22 * b02 + a23 * b01, \na10 * b10 - a11 * b08 + a13 * b06, \na01 * b08 - a00 * b10 - a03 * b06, \na30 * b04 - a31 * b02 + a33 * b00, \na21 * b02 - a20 * b04 - a23 * b00, \na11 * b07 - a10 * b09 - a12 * b06, \na00 * b09 - a01 * b07 + a02 * b06, \na31 * b01 - a30 * b03 - a32 * b00, \na20 * b03 - a21 * b01 + a22 * b00) / det; \n} \nvoid main(void){ \ne_position = attribute_position; \nvarying_color = attribute_color; \nvarying_uv0 = attribute_uv0; \n} \n",bezier:"vec2 quadratic_bezier(vec2 A, vec2 B, vec2 C, float t) \n{ \nvec2 D = mix(A, B, t); \nvec2 E = mix(B, C, t); \nreturn mix(D, E, t); \n} \nvec2 cubic_bezier(vec2 A, vec2 B, vec2 C, vec2 D, float t) \n{ \nvec2 E = mix(A, B, t); \nvec2 F = mix(B, C, t); \nvec2 G = mix(C, D, t); \nreturn quadratic_bezier(E, F, G, t); \n} \n",bloom_fs:"varying vec2 varying_uv0; \nuniform sampler2D diffuseTexture; \nvoid main() \n{ \nvec2 uv = vec2(varying_uv0.x,1.0-varying_uv0.y); \nfloat dx = 1.0/float(1024.0); \nfloat dy = 1.0/float(1024.0); \nvec4 outColor ; \nvec4 color = outColor = texture2D(diffuseTexture,uv.xy); \ncolor += texture2D(diffuseTexture,uv.xy+vec2(dx*3.0,0.0)); \ncolor += texture2D(diffuseTexture,uv.xy+vec2(0.0,dy)); \ncolor += texture2D(diffuseTexture,uv.xy+vec2(dx*3.0,dy)); \ncolor += texture2D(diffuseTexture,uv.xy+vec2(0.0,dy*2.0)); \ncolor += texture2D(diffuseTexture,uv.xy+vec2(dx*3.0,dy*2.0)); \ncolor += texture2D(diffuseTexture,uv.xy+vec2(0.0,dy*3.0)); \ncolor += texture2D(diffuseTexture,uv.xy+vec2(dx*3.0,dy*3.0)); \ncolor /= 8.0; \nvec4 cout = vec4(0.0,0.0,0.0,0.0); \nfloat lum = color.x * 0.3 + color.y *0.59 + color.z * 0.11; \nvec4 p = color*(lum/0.1); \np /= vec4(vec4(1.0,1.0,1.0,0.0)+p); \nfloat luml = (p.x+p.y+p.z)/3.0; \nif (luml > 0.8) \n{ \ncout = color ; \n} \ngl_FragColor = cout ; \n} \n",colorGradients_fs:"varying vec4 varying_pos; \nuniform float uniform_colorGradientsSource[10] ; \nvoid main(void){ \nvec3 posStart = vec3(uniform_colorGradientsSource[0], uniform_colorGradientsSource[1], uniform_colorGradientsSource[2]); \nvec3 posEnd = vec3(uniform_colorGradientsSource[3], uniform_colorGradientsSource[4], uniform_colorGradientsSource[5]); \nvec4 color = vec4(uniform_colorGradientsSource[6], uniform_colorGradientsSource[7], uniform_colorGradientsSource[8], uniform_colorGradientsSource[9]); \ncolor.w = color.w * clamp((varying_pos.y - posStart.y) / (posEnd.y - posStart.y), 0.0, 1.0); \ndiffuseColor.xyz = clamp(diffuseColor.xyz / diffuseColor.w,0.0,1.0); \ndiffuseColor.xyz = diffuseColor.xyz * (1.0 - color.w) + color.xyz * color.w; \n} \n  \n",colorTransform_fs:"uniform float uniform_colorTransformAlpha ; \nuniform mat4 uniform_colorTransformM44 ; \nvoid main(){ \ndiffuseColor.xyz = (uniform_colorTransformM44 * vec4(diffuseColor.xyz, 1.0)).xyz; \ndiffuseColor.w *= diffuseColor.w * uniform_colorTransformAlpha; \n} \n",color_fragment:"vec4 diffuseColor ; \nvoid main() { \nif( diffuseColor.w == 0.0 ){ \ndiscard; \n} \ndiffuseColor = vec4(1.0, 1.0, 1.0, 1.0); \nif( diffuseColor.w < materialSource.cutAlpha ){ \ndiscard; \n}else \ndiffuseColor.xyz *= diffuseColor.w ; \n} \n",combin_fs:"uniform sampler2D colorTexture; \nvoid main(void){ \n} \n",cube_fragment:"uniform samplerCube diffuseTexture ; \nvarying vec3 varying_pos; \nvec4 diffuseColor ; \nvoid main() { \nif( diffuseColor.w == 0.0 ){ \ndiscard; \n} \nvec3 uvw = normalize(varying_pos.xyz); \ndiffuseColor = vec4(textureCube(diffuseTexture, uvw.xyz)); \nif( diffuseColor.w < materialSource.cutAlpha ){ \ndiscard; \n}else \ndiffuseColor.xyz *= diffuseColor.w ; \n} \n",cube_vertex:"varying vec3 varying_pos; \nvoid main(void){ \nvarying_pos =  e_position; \n}  \n",detail_Bending_vs:"uniform float uniformTime[4] ; \nvoid main(void){ \ne_position = attribute_position; \nvarying_uv0 = attribute_uv0; \nvarying_color = attribute_color; \nvec4 curve = SmoothTriangleWave(vec4(sin(uniformTime[0]*0.001),1.0,1.0,1.0)); \ne_position.xyz += curve.x * vec3(1.0,0.5,0.0) * ( attribute_color.xyz) ; \n} \n",diffuse_fragment:"uniform sampler2D diffuseTexture; \nvec4 diffuseColor ; \nvoid main() { \ndiffuseColor = texture2D(diffuseTexture , uv_0 ); \nif( diffuseColor.w < materialSource.cutAlpha ){ \ndiscard; \n} \n} \n",diffuse_vertex:"attribute vec3 attribute_normal; \nattribute vec4 attribute_color; \nvarying vec4 varying_mvPose; \nvoid main(void){ \nmat4 mvMatrix = mat4(uniform_ViewMatrix * uniform_ModelMatrix); \nvarying_mvPose = mvMatrix * vec4( e_position , 1.0 )  ; \nmat4 normalMatrix = inverse(mvMatrix) ; \nnormalMatrix = transpose(normalMatrix); \nvarying_eyeNormal = mat3(normalMatrix) * -attribute_normal ; \noutPosition = varying_mvPose ; \nvarying_color = attribute_color; \n} \n",directLight_fragment:"const int max_directLight = 0 ; \nuniform float uniform_directLightSource[9*max_directLight] ; \nvarying vec4 varying_mvPose; \nuniform mat4 uniform_ViewMatrix; \nmat4 normalMatrix ; \nstruct DirectLight{ \nvec3 direction; \nvec3 diffuse; \nvec3 ambient; \n}; \nmat4 transpose(mat4 inMatrix) { \nvec4 i0 = inMatrix[0]; \nvec4 i1 = inMatrix[1]; \nvec4 i2 = inMatrix[2]; \nvec4 i3 = inMatrix[3]; \nmat4 outMatrix = mat4( \nvec4(i0.x, i1.x, i2.x, i3.x), \nvec4(i0.y, i1.y, i2.y, i3.y), \nvec4(i0.z, i1.z, i2.z, i3.z), \nvec4(i0.w, i1.w, i2.w, i3.w) \n); \nreturn outMatrix; \n} \nmat4 inverse(mat4 m) { \nfloat \na00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3], \na10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3], \na20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3], \na30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3], \nb00 = a00 * a11 - a01 * a10, \nb01 = a00 * a12 - a02 * a10, \nb02 = a00 * a13 - a03 * a10, \nb03 = a01 * a12 - a02 * a11, \nb04 = a01 * a13 - a03 * a11, \nb05 = a02 * a13 - a03 * a12, \nb06 = a20 * a31 - a21 * a30, \nb07 = a20 * a32 - a22 * a30, \nb08 = a20 * a33 - a23 * a30, \nb09 = a21 * a32 - a22 * a31, \nb10 = a21 * a33 - a23 * a31, \nb11 = a22 * a33 - a23 * a32, \ndet = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06; \nreturn mat4( \na11 * b11 - a12 * b10 + a13 * b09, \na02 * b10 - a01 * b11 - a03 * b09, \na31 * b05 - a32 * b04 + a33 * b03, \na22 * b04 - a21 * b05 - a23 * b03, \na12 * b08 - a10 * b11 - a13 * b07, \na00 * b11 - a02 * b08 + a03 * b07, \na32 * b02 - a30 * b05 - a33 * b01, \na20 * b05 - a22 * b02 + a23 * b01, \na10 * b10 - a11 * b08 + a13 * b06, \na01 * b08 - a00 * b10 - a03 * b06, \na30 * b04 - a31 * b02 + a33 * b00, \na21 * b02 - a20 * b04 - a23 * b00, \na11 * b07 - a10 * b09 - a12 * b06, \na00 * b09 - a01 * b07 + a02 * b06, \na31 * b01 - a30 * b03 - a32 * b00, \na20 * b03 - a21 * b01 + a22 * b00) / det; \n} \nvoid calculateDirectLight( MaterialSource materialSource ){ \nfloat lambertTerm , specular ; \nvec3 dir ,viewDir = normalize(varying_mvPose.xyz/varying_mvPose.w); \nfor(int i = 0 ; i < max_directLight ; i++){ \nDirectLight directLight ; \ndirectLight.direction = (normalMatrix * vec4(uniform_directLightSource[i*9],uniform_directLightSource[i*9+1],uniform_directLightSource[i*9+2],1.0)).xyz; \ndirectLight.diffuse = vec3(uniform_directLightSource[i*9+3],uniform_directLightSource[i*9+4],uniform_directLightSource[i*9+5]); \ndirectLight.ambient = vec3(uniform_directLightSource[i*9+6],uniform_directLightSource[i*9+7],uniform_directLightSource[i*9+8]); \ndir = normalize(directLight.direction) ; \nlight.xyzw += LightingBlinnPhong(dir,directLight.diffuse,directLight.ambient,normal,viewDir,0.5); \n} \n} \nvoid main() { \nnormalMatrix = inverse(uniform_ViewMatrix); \nnormalMatrix = transpose(normalMatrix); \ncalculateDirectLight( materialSource ); \n} \n",endShadowPass_fs:"void main() { \nif(varying_color.w<=0.0){ \ndiscard; \n} \noutColor.x =  outColor.y = outColor.z = varying_ViewPose.z/varying_ViewPose.w  ; \noutColor.w = 1.0 ; \ngl_FragColor = outColor ; \n} \n",endShadowPass_vs:"void main() { \noutPosition = uniform_ProjectionMatrix * outPosition ; \ngl_Position = outPosition ; \n} \n                       \n",end_fs:"vec4 diffuseColor ; \nvec4 specularColor ; \nvec4 ambientColor; \nvec4 light ; \nvoid main() { \noutColor.xyz = (light.xyz+materialSource.ambient) * diffuseColor.xyz * materialSource.diffuse * varying_color.xyz; \noutColor.w = materialSource.alpha * diffuseColor.w * varying_color.w; \noutColor.xyz *= outColor.w; \ngl_FragColor = outColor; \n} \n",end_vs:"vec4 endPosition ; \nuniform float uniform_materialSource[20]; \nvoid main() { \ngl_PointSize = 50.0; \ngl_PointSize = uniform_materialSource[18]; \ngl_Position = uniform_ProjectionMatrix * outPosition ; \n} \n                       \n",environmentDiffuse_vertex:"void main(){ \n} \n",environmentMapping_fragment:"uniform samplerCube environmentMapTex ; \nuniform float reflectValue; \nvoid main(){ \nvec3 r = reflect(-vec3(0.0,0.0,1.0),  normal  ); \nvec4 reflectiveColor = textureCube(environmentMapTex,r.xyz); \ndiffuseColor.xyz = mix( diffuseColor.xyz,reflectiveColor.xyz, specularColor.y + reflectValue ); \n} \n          \n",expFog_fs:"struct Fog{ \nvec3 fogColor  ; \nfloat globalDensity ; \nvec3 distance ; \n}; \nvarying vec4 varying_pos; \nuniform float uniform_globalFog[7]; \nvoid main(void){ \nFog fog; \nfog.fogColor = vec3(uniform_globalFog[0],uniform_globalFog[1],uniform_globalFog[2]); \nfog.globalDensity = uniform_globalFog[3]; \nfog.distance = vec2(uniform_globalFog[4], uniform_globalFog[5]); \nfloat d = distance(uniform_eyepos,varying_pos.xyz); \nfloat distFog = max( 0.0 , d - fog.distance.x )* fog.distance.y; \nfloat fogFactor = (1.0-exp( -distFog * 0.000001 * fog.globalDensity )) ; \ndiffuseColor.xyz = mix( diffuseColor.xyz  , fog.fogColor , min(fogFactor,1.0) ); \n} \n  \n",expHeightFog_fs:"struct Fog{ \nvec3 fogColor  ; \nfloat globalDensity ; \nfloat fogStartDistance ; \nfloat fogHeightStart ; \nfloat fogAlpha ; \n}; \nvarying vec4 varying_pos; \nuniform float uniform_globalFog[7]; \nvec3 applyFog( float yDistance, vec3  vpos , Fog fog ) \n{ \nfloat d = distance(uniform_eyepos,varying_pos.xyz); \nfloat distFog = max( 0.0 , d - fog.fogStartDistance ) ; \nfloat yFog = max(0.0, (vpos.y - fog.fogHeightStart - yDistance) )  ; \nfloat fogAmount =  1.0-(exp(-distFog * fog.globalDensity )) + (exp(-yFog * fog.globalDensity )); \nreturn mix( diffuseColor.xyz,fog.fogColor, clamp(fogAmount,0.0,fog.fogAlpha) ); \n} \nvoid main(void){ \nFog fog; \nfog.fogColor = vec3(uniform_globalFog[0],uniform_globalFog[1],uniform_globalFog[2]); \nfog.globalDensity = uniform_globalFog[3]; \nfog.fogStartDistance = uniform_globalFog[4] ; \nfog.fogHeightStart = uniform_globalFog[5] ; \nfog.fogAlpha = uniform_globalFog[6] ; \nfloat yd = uniform_eyepos.y - varying_pos.y ; \ndiffuseColor.xyz = applyFog( yd , varying_pos.xyz , fog ); \n} \n  \n",FakePBR:"",FakePBR_fs:"#extension GL_OES_standard_derivatives:enable \n#define max_directLight 1 \nstruct DirectLight{ \nvec3 direction; \nvec3 diffuse; \nvec3 ambient; \n}; \nuniform float uniform_directLightSource[9*max_directLight] ; \nvarying vec4 varying_mvPose; \nvarying vec3 varying_eyeNormal; \nvarying vec2 varying_uv0; \nuniform sampler2D albedoTex; \nuniform sampler2D normalTex; \nuniform sampler2D glossTex; \nuniform sampler2D specularTex; \nuniform sampler2D opacityTex; \nuniform mat4 uniform_ViewMatrix; \nmat3 TBN; \nmat4 normalMatrix ; \nvec3 normalDirection; \nvec3 light; \nvec3 normalTexColor ; \nvec4 opacityTexColor ; \nvec4 glossTexColor ; \nvec4 specularTexColor ; \nvec4 albedoTexColor ; \nvec2 uv_0; \nmat4 transpose(mat4 inMatrix) { \nvec4 i0 = inMatrix[0]; \nvec4 i1 = inMatrix[1]; \nvec4 i2 = inMatrix[2]; \nvec4 i3 = inMatrix[3]; \nmat4 outMatrix = mat4( \nvec4(i0.x, i1.x, i2.x, i3.x), \nvec4(i0.y, i1.y, i2.y, i3.y), \nvec4(i0.z, i1.z, i2.z, i3.z), \nvec4(i0.w, i1.w, i2.w, i3.w) \n); \nreturn outMatrix; \n} \nmat4 inverse(mat4 m) { \nfloat \na00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3], \na10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3], \na20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3], \na30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3], \nb00 = a00 * a11 - a01 * a10, \nb01 = a00 * a12 - a02 * a10, \nb02 = a00 * a13 - a03 * a10, \nb03 = a01 * a12 - a02 * a11, \nb04 = a01 * a13 - a03 * a11, \nb05 = a02 * a13 - a03 * a12, \nb06 = a20 * a31 - a21 * a30, \nb07 = a20 * a32 - a22 * a30, \nb08 = a20 * a33 - a23 * a30, \nb09 = a21 * a32 - a22 * a31, \nb10 = a21 * a33 - a23 * a31, \nb11 = a22 * a33 - a23 * a32, \ndet = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06; \nreturn mat4( \na11 * b11 - a12 * b10 + a13 * b09, \na02 * b10 - a01 * b11 - a03 * b09, \na31 * b05 - a32 * b04 + a33 * b03, \na22 * b04 - a21 * b05 - a23 * b03, \na12 * b08 - a10 * b11 - a13 * b07, \na00 * b11 - a02 * b08 + a03 * b07, \na32 * b02 - a30 * b05 - a33 * b01, \na20 * b05 - a22 * b02 + a23 * b01, \na10 * b10 - a11 * b08 + a13 * b06, \na01 * b08 - a00 * b10 - a03 * b06, \na30 * b04 - a31 * b02 + a33 * b00, \na21 * b02 - a20 * b04 - a23 * b00, \na11 * b07 - a10 * b09 - a12 * b06, \na00 * b09 - a01 * b07 + a02 * b06, \na31 * b01 - a30 * b03 - a32 * b00, \na20 * b03 - a21 * b01 + a22 * b00) / det; \n} \nvec3 unpackNormal(vec4 packednormal) \n{ \nreturn packednormal.xyz * 2.0 - 1.0; \n} \nmat3 cotangentFrame(vec3 N, vec3 p, vec2 uv) { \nvec3 dp1 = dFdx(p); \nvec3 dp2 = dFdy(p); \nvec2 duv1 = dFdx(uv); \nvec2 duv2 = dFdy(uv); \nvec3 dp2perp = cross(dp2, N); \nvec3 dp1perp = cross(N, dp1); \nvec3 T = dp2perp * duv1.x + dp1perp * duv2.x; \nvec3 B = dp2perp * duv1.y + dp1perp * duv2.y; \nfloat invmax = 1.0 / sqrt(max(dot(T,T), dot(B,B))); \nreturn mat3(T * invmax, B * invmax, N); \n} \nvec3 fakePBRLight( vec3 lightDir , vec3 viewDir , vec3 lightColor , vec3 ambient ){ \nvec3 lightDirection = mat3(uniform_ViewMatrix) * normalize(lightDir); \nvec3 halfDirection = normalize( lightDirection + viewDir) ; \nfloat attenuation = 1.0 ; \nvec3 attenColor = attenuation * lightColor; \nfloat Pi = 3.141592654; \nfloat InvPi = 0.31830988618; \nfloat gloss = glossTexColor.r; \nfloat specPow = exp2( gloss * 10.0 + 1.0 ); \nfloat NdotL = max(0.0, dot( normalDirection, lightDirection )); \nfloat specularMonochrome = max( max(specularTexColor.r, specularTexColor.g), specularTexColor.b); \nfloat normTerm = (specPow + 8.0 ) / (8.0 * Pi); \nvec3 directSpecular =  (floor(attenuation) * lightColor ) * pow(max(0.0,dot(halfDirection,normalDirection)),normTerm) * specularTexColor.xyz * normTerm ; \nvec3 specular = directSpecular; \nNdotL = max(0.0,dot( normalDirection , normalize(lightDirection) )); \nvec3 directDiffuse = max( 0.0, NdotL) * attenColor; \nvec3 indirectDiffuse = vec3(0.0,0.0,0.0); \nindirectDiffuse +=  ambient ; \nvec3 diffuseColor = albedoTexColor.rgb; \ndiffuseColor *= 1.0-specularMonochrome; \nvec3 diffuse = (directDiffuse + indirectDiffuse) * diffuseColor; \nvec3 finalColor = diffuse + specular ; \nreturn finalColor ; \n} \nvoid calculateDirectLight(  ){ \nfloat lambertTerm , specular ; \nvec3 dir ,viewDir = normalize(varying_mvPose.xyz/varying_mvPose.w); \nfor(int i = 0 ; i < max_directLight ; i++){ \nDirectLight directLight ; \ndirectLight.direction = vec3(uniform_directLightSource[i*9],uniform_directLightSource[i*9+1],uniform_directLightSource[i*9+2]); \ndirectLight.diffuse = vec3(uniform_directLightSource[i*9+3],uniform_directLightSource[i*9+4],uniform_directLightSource[i*9+5]); \ndirectLight.ambient = vec3(uniform_directLightSource[i*9+6],uniform_directLightSource[i*9+7],uniform_directLightSource[i*9+8]); \ndir = normalize(directLight.direction) ; \nlight.xyz += fakePBRLight( dir , viewDir , directLight.diffuse , directLight.ambient); \n} \n} \nvoid main(void){ \nTBN = cotangentFrame(normalize(varying_eyeNormal), normalize(-varying_mvPose.xyz) , uv_0); \nnormalTexColor = unpackNormal(texture2D(normalTex, uv_0 )) ; \nopacityTexColor = texture2D(opacityTex, uv_0 ) ; \nglossTexColor = texture2D(glossTex, uv_0 ); \nspecularTexColor = texture2D(specularTex, uv_0 ); \nalbedoTexColor = texture2D(albedoTex, uv_0 ); \nnormalDirection = TBN * normalTexColor.xyz ; \nif( (step(materialSource.cutAlpha,opacityTexColor.g) - 0.5) < 0.0 ){ \ndiscard; \n} \ncalculateDirectLight(); \nvec4 finalRGBA = vec4(light,1.0) ; \ngl_FragColor = finalRGBA; \n} \n",FakePBR_vs:"attribute vec3 attribute_position; \nattribute vec3 attribute_normal; \nattribute vec2 attribute_uv0; \nuniform mat4 uniform_ModelMatrix ; \nuniform mat4 uniform_ViewMatrix ; \nuniform mat4 uniform_ProjectionMatrix ; \nvarying vec4 varying_mvPose; \nvarying vec3 varying_eyeNormal; \nvarying vec2 varying_uv0; \nvec4 outPosition; \nmat4 transpose(mat4 inMatrix) { \nvec4 i0 = inMatrix[0]; \nvec4 i1 = inMatrix[1]; \nvec4 i2 = inMatrix[2]; \nvec4 i3 = inMatrix[3]; \nmat4 outMatrix = mat4( \nvec4(i0.x, i1.x, i2.x, i3.x), \nvec4(i0.y, i1.y, i2.y, i3.y), \nvec4(i0.z, i1.z, i2.z, i3.z), \nvec4(i0.w, i1.w, i2.w, i3.w) \n); \nreturn outMatrix; \n} \nmat4 inverse(mat4 m) { \nfloat \na00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3], \na10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3], \na20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3], \na30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3], \nb00 = a00 * a11 - a01 * a10, \nb01 = a00 * a12 - a02 * a10, \nb02 = a00 * a13 - a03 * a10, \nb03 = a01 * a12 - a02 * a11, \nb04 = a01 * a13 - a03 * a11, \nb05 = a02 * a13 - a03 * a12, \nb06 = a20 * a31 - a21 * a30, \nb07 = a20 * a32 - a22 * a30, \nb08 = a20 * a33 - a23 * a30, \nb09 = a21 * a32 - a22 * a31, \nb10 = a21 * a33 - a23 * a31, \nb11 = a22 * a33 - a23 * a32, \ndet = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06; \nreturn mat4( \na11 * b11 - a12 * b10 + a13 * b09, \na02 * b10 - a01 * b11 - a03 * b09, \na31 * b05 - a32 * b04 + a33 * b03, \na22 * b04 - a21 * b05 - a23 * b03, \na12 * b08 - a10 * b11 - a13 * b07, \na00 * b11 - a02 * b08 + a03 * b07, \na32 * b02 - a30 * b05 - a33 * b01, \na20 * b05 - a22 * b02 + a23 * b01, \na10 * b10 - a11 * b08 + a13 * b06, \na01 * b08 - a00 * b10 - a03 * b06, \na30 * b04 - a31 * b02 + a33 * b00, \na21 * b02 - a20 * b04 - a23 * b00, \na11 * b07 - a10 * b09 - a12 * b06, \na00 * b09 - a01 * b07 + a02 * b06, \na31 * b01 - a30 * b03 - a32 * b00, \na20 * b03 - a21 * b01 + a22 * b00) / det; \n} \nvoid main(void){ \nmat4 mvMatrix = mat4(uniform_ViewMatrix * uniform_ModelMatrix); \nvarying_mvPose = mvMatrix * vec4( attribute_position , 1.0 )  ; \nmat4 normalMatrix = inverse(mvMatrix) ; \nnormalMatrix = transpose(normalMatrix); \nvarying_eyeNormal = mat3(normalMatrix) * -attribute_normal ; \nvarying_uv0 = attribute_uv0 ; \noutPosition = uniform_ProjectionMatrix * varying_mvPose ; \ngl_Position = outPosition; \n} \n",flatNormal_fs:"#extension GL_OES_standard_derivatives : enable \nvec3 flatNormal(vec3 pos){ \nvec3 fdx = dFdx(pos); \nvec3 fdy = dFdy(pos); \nreturn normalize(cross(fdx, fdy)); \n} \n",gamma_fs:"const float gamma = 2.2; \nfloat toLinear_float_v1(float v) { \nreturn pow(v, gamma); \n} \nvec2 toLinear_vec2_v1(vec2 v) { \nreturn pow(v, vec2(gamma)); \n} \nvec3 toLinear_vec3_v1(vec3 v) { \nreturn pow(v, vec3(gamma)); \n} \nvec4 toLinear_vec4_v1(vec4 v) { \nreturn vec4(toLinear_vec3_v1(v.rgb), v.a); \n} \nfloat toGamma_float_v2(float v) { \nreturn pow(v, 1.0 / gamma); \n} \nvec2 toGamma_vec2_v2(vec2 v) { \nreturn pow(v, vec2(1.0 / gamma)); \n} \nvec3 toGamma_vec3_v2(vec3 v) { \nreturn pow(v, vec3(1.0 / gamma)); \n} \nvec4 toGamma_vec4_v2(vec4 v) { \nreturn vec4(toGamma_vec3_v2(v.rgb), v.a); \n} \nvec4 textureLinear(sampler2D uTex, vec2 uv) { \nreturn toLinear_vec4_v1(texture2D(uTex, uv)); \n} \n",gaussian_H_fs:"varying vec2 varying_uv0; \nuniform sampler2D diffuseTexture; \nvoid main() \n{ \nvec2 uv = vec2(varying_uv0.x,1.0-varying_uv0.y); \nfloat d = 1.0/float(1024.0); \nvec4 color = vec4(0.0,0.0,0.0,0.0); \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(-8.0*d,0.0))* 0.001; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(-7.0*d,0.0))* 0.105; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(-6.0*d,0.0))* 0.217; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(-5.0*d,0.0))* 0.344; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(-4.0*d,0.0))* 0.492; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(-3.0*d,0.0))* 0.55; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(-2.0*d,0.0))* 0.69; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(-1.0*d,0.0))* 0.70; \ncolor +=     texture2D(diffuseTexture,uv.xy) * 1.0; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(1.0*d,0.0)) * 0.70; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(2.0*d,0.0)) * 0.69; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(3.0*d,0.0)) * 0.55; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(4.0*d,0.0)) * 0.492; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(5.0*d,0.0)) * 0.344; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(6.0*d,0.0)) * 0.217; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(7.0*d,0.0)) * 0.105; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(8.0*d,0.0)) * 0.001; \ncolor /= 8.0; \ngl_FragColor = color ; \n} \n",gaussian_V_fs:"varying vec2 varying_uv0; \nuniform sampler2D diffuseTexture; \nuniform sampler2D colorTexture; \nvoid main() \n{ \nvec2 uv = vec2(varying_uv0.x,1.0-varying_uv0.y); \nfloat d = 1.0/float(1024.0); \nvec4 color = vec4(0.0,0.0,0.0,0.0); \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0,-8.0*d)) * 0.001; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0,-7.0*d)) * 0.105; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0,-6.0*d)) * 0.217; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0,-5.0*d)) * 0.344; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0,-4.0*d)) * 0.492; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0,-3.0*d)) * 0.55; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0,-2.0*d)) * 0.69; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0,-1.0*d)) * 0.70; \ncolor +=     texture2D(diffuseTexture,uv.xy) * 1.0; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0, 1.0*d)) * 0.70; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0, 2.0*d)) * 0.69; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0, 3.0*d)) * 0.55; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0, 4.0*d)) * 0.492; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0, 5.0*d)) * 0.344; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0, 6.0*d)) * 0.217; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0, 7.0*d)) * 0.105; \ncolor +=     texture2D(diffuseTexture,uv.xy+vec2(0.0, 8.0*d)) * 0.001; \ncolor /= 8.0; \ngl_FragColor = color + texture2D(colorTexture,uv.xy); \n} \n",gui_fs:"varying vec4 varying_uv; \nvarying vec4 varying_color; \nvarying vec4 varying_pos; \nvarying float varying_textureIndex; \nvec4 diffuseColor; \nuniform sampler2D uiTexture_0; \nuniform sampler2D uiTexture_1; \nuniform sampler2D uiTexture_2; \nuniform sampler2D uiTexture_3; \nuniform sampler2D uiTexture_4; \nuniform sampler2D uiTexture_5; \nuniform sampler2D uiTexture_6; \nvarying vec4 varying_mask; \nvoid main(){ \nif( varying_color.w == -1.0 ){ \ndiscard; \n} \nif(varying_mask.x>=0.0){ \nvec4 mask = varying_mask; \nif( (2.0*mask.x-1.0) > varying_pos.x){ \ndiscard; \n} \nif( (-2.0*mask.y+1.0) < varying_pos.y){ \ndiscard; \n} \nif( (2.0*mask.z-1.0) < varying_pos.x){ \ndiscard; \n} \nif( (-2.0*mask.w+1.0) > varying_pos.y){ \ndiscard; \n} \n} \nvec2 uv = varying_uv.xy ; \nint index = int(floor(varying_textureIndex)) ; \nif(index < 0){ \nif(index == -1){ \ndiffuseColor = vec4(1.0, 0.0, 0.0, 0.8); \n}else{ \ndiscard; \n} \n} \nelse{ \nif(index==0){ \ndiffuseColor.xyzw = texture2D(uiTexture_0, uv ).xyzw; \n}else if(index==1){ \ndiffuseColor.xyzw = texture2D(uiTexture_1, uv ).xyzw; \n} \nelse if(index==2){ \ndiffuseColor.xyzw = texture2D(uiTexture_2, uv ).xyzw; \n} \nelse if(index==3){ \ndiffuseColor.xyzw = texture2D(uiTexture_3, uv ).xyzw; \n} \nelse if(index==4){ \ndiffuseColor.xyzw = texture2D(uiTexture_4, uv ).xyzw; \n} \nelse if(index==5){ \ndiffuseColor.xyzw = texture2D(uiTexture_5, uv ).xyzw; \n} \nelse if(index==6){ \ndiffuseColor.xyzw = texture2D(uiTexture_6, uv ).xyzw; \n} \n} \nif(varying_pos.w==1.0){ \nint clrChannel = int(uv.x); \nuv.x -= float(clrChannel); \nfloat fontAlpha = 1.0; \nif(clrChannel == 0){ \nfontAlpha = diffuseColor.x; \n}else if(clrChannel == 1){ \nfontAlpha = diffuseColor.y; \n} else if(clrChannel == 2){ \nfontAlpha = diffuseColor.z; \n}else if(clrChannel == 3){ \nfontAlpha = diffuseColor.w; \n} \nif(fontAlpha > 0.9){ \nfontAlpha = 1.0; \n} \ndiffuseColor = vec4(1.0, 1.0, 1.0, fontAlpha); \n} \nif(diffuseColor.w < 0.01 || varying_color.w < 0.01){ \ndiscard; \n} \ndiffuseColor.xyz *= varying_color.xyz; \ndiffuseColor.w *= varying_color.w; \ndiffuseColor.xyz *= diffuseColor.w; \ndiffuseColor = clamp(diffuseColor, 0.0, 1.0); \ngl_FragColor = diffuseColor; \n} \n",gui_vs:"attribute vec4 attribute_position; \nattribute vec3 attribute_shapePosition; \nattribute vec4 attribute_uvRec; \nattribute vec4 attribute_rotate; \nattribute vec4 attribute_maskRectangle; \nattribute vec4 attribute_quad_color; \nvarying vec4 varying_uv; \nvarying vec4 varying_color; \nvarying vec4 varying_pos; \nvarying vec4 varying_mask; \nvarying float varying_textureIndex; \nvec4 outPosition; \nuniform mat4 uniform_ModelMatrix; \nuniform mat4 uniform_ViewMatrix; \nuniform mat4 uniform_ProjectionMatrix; \nuniform mat4 uniform_orthProectMatrix; \nuniform float uniform_materialSource[20]; \nmat4 buildMat4Quat(vec4 quat){ \nfloat xx = quat.x * quat.x; \nfloat xy = quat.x * quat.y; \nfloat xz = quat.x * quat.z; \nfloat xw = quat.x * quat.w; \nfloat yy = quat.y * quat.y; \nfloat yz = quat.y * quat.z; \nfloat yw = quat.y * quat.w; \nfloat zz = quat.z * quat.z; \nfloat zw = quat.z * quat.w; \nreturn mat4( \n1.0 - 2.0 * (yy + zz),		2.0 * (xy + zw),		2.0 * (xz - yw),		0, \n2.0 * (xy - zw),				1.0 - 2.0 * (xx + zz),	2.0 * (yz + xw),		0, \n2.0 * (xz + yw),				2.0 * (yz - xw),		1.0 - 2.0 * (xx + yy),	0, \n0.0,							0.0,					0.0,					1 \n); \n} \nvoid main(void){ \nfloat devicePixelRatio = 1.0; \nmat4 mvMatrix = mat4(uniform_ViewMatrix * uniform_ModelMatrix); \nmat4 po = buildMat4Quat(attribute_rotate.xyzw); \nmat4 oth = uniform_orthProectMatrix; \nfloat px = oth[0].x ; \nfloat py = oth[1].y ; \noth[0].x = oth[0].x / devicePixelRatio ; \noth[1].y = oth[1].y / devicePixelRatio ; \nvec3 pos = mat3(po) * (attribute_position.xyz * vec3(attribute_uvRec.zw,1.0) ) + vec3(attribute_shapePosition.xy,1.0) ; \nvec3 sceneWH = vec3( 1.0/ oth[0].x, -1.0/oth[1].y , 0.0 )  ; \noutPosition = mvMatrix * vec4( pos - sceneWH , 1.0 ) ; \nvarying_color = attribute_quad_color ; \nif( attribute_position.z >= 100000.0 ){ \nvarying_color.w = -1.0 ; \n} \nvarying_pos = outPosition = oth * outPosition ; \nvarying_pos.w = attribute_position.w ; \nvec4 maskk = attribute_maskRectangle; \nsceneWH = vec3(2.0/px*devicePixelRatio,2.0/py*devicePixelRatio,1.0) ; \nvarying_mask = vec4(maskk.xy/sceneWH.xy,(maskk.x+maskk.z)/sceneWH.x ,  (maskk.y+maskk.w)/(sceneWH.y)) ; \nvarying_uv = attribute_uvRec; \nvarying_textureIndex = floor(attribute_shapePosition.z); \nint texIndex = int(attribute_shapePosition.z); \nif(texIndex == -2 || texIndex == -3){ \noutPosition = vec4(0.0,0.0,0.0,0.0); \n}else{ \ngl_Position = outPosition; \n} \ngl_PointSize = uniform_materialSource[18]; \n} \n",hud_cull_fs:"varying vec2 varying_uv0; \nuniform sampler2D diffuseTexture; \nuniform vec2 uv_scale; \nvoid main(void) { \nvec2 uv_0 = varying_uv0; \nuv_0 *= uv_scale; \nvec4 color = texture2D(diffuseTexture, varying_uv0); \nfloat mask = 1.0; \nfloat f = uv_scale.y - varying_uv0.y; \nif (varying_uv0.y < uv_scale.y){ \nif(f < 0.03 && f > 0.0){ \nmask =1.0 - (f / 0.03 * 0.9 + 0.1); \n} \nelse{ \nmask = 0.1; \n} \n} \ncolor.xyz *= mask; \ngl_FragColor  = color; \n} \n",hud_H_fs:"varying vec2 varying_uv0; \nuniform sampler2D diffuseTexture; \nvoid main(void) { \nvec2 uv = vec2(varying_uv0.x ,1.0-varying_uv0.y); \nvec4 color = texture2D(diffuseTexture, uv); \ngl_FragColor  = color; \n} \n",hud_vs:"attribute vec3 attribute_position; \nattribute vec2 attribute_uv0; \nvarying  vec2 varying_uv0; \nuniform  mat4 uniform_ViewProjectionMatrix; \nvoid main(void) { \nvec4 pos = vec4(attribute_position, 1.0); \ngl_Position = uniform_ViewProjectionMatrix * pos; \nvarying_uv0 = attribute_uv0; \n} \n",hud_V_fs:"varying vec2 varying_uv0; \nuniform sampler2D diffuseTexture; \nvoid main(void) { \nvec4 color = texture2D(diffuseTexture, varying_uv0); \ngl_FragColor  = color; \n} \n",lightingBase_fs:"vec4 LightingBlinnPhong(vec3 lightDir, vec3 lightColor , vec3 lightAmbient , vec3 normal , vec3 viewDir, float atten){ \nfloat NdotL = clamp(dot (normal, lightDir),0.0,1.0); \nvec3 diffuse = lightColor.xyz * NdotL ; \nvec3 h = normalize (lightDir + normalize(viewDir)); \nfloat nh = clamp(dot (normal, h),0.0,1.0); \nfloat specPower = pow (nh, materialSource.shininess ) * materialSource.specularScale ; \nvec3 specular = lightColor.xyz * specPower * materialSource.specular ; \nspecularColor.xyz += specular; \nvec4 c; \nc.rgb = (diffuse+specular+lightAmbient) * (atten * 2.0 ); \nc.a = materialSource.alpha + (specPower * atten); \nreturn c; \n} \nvoid main(void) { \nlight.xyzw = vec4(0.0,0.0,0.0,1.0) ; \n} \n",lightMapSpecularPower_fs:"uniform sampler2D lightTexture ; \nvarying vec2 varying_uv1 ; \nvec4 decode_hdr( vec4 data ){ \nvec4 res = data ; \nres.xyz *= pow(2.2,data.w * 256.0 - 128.0); \nreturn res ; \n} \nvoid main(void){ \nvec4 lightmap = texture2D( lightTexture , varying_uv1 ); \nlightmap.xyz = decode_hdr(lightmap).xyz; \nlightmap.xyz = pow( 1.8 * lightmap.xyz, vec3(1.1)) ; \ndiffuseColor.xyz *= lightmap.xyz ; \nspecularColor.xyz *= lightmap.xyz ; \n} \n  \n",lightMap_fs:"uniform sampler2D lightTexture ; \nvarying vec2 varying_uv1 ; \nvec4 decode_hdr( vec4 data ){ \nvec4 res = data ; \nres.xyz *= pow(2.2,data.w * 256.0 - 128.0); \nreturn res ; \n} \nvoid main(void){ \nvec4 lightmap = texture2D( lightTexture , varying_uv1 ); \nlightmap.xyz = decode_hdr(lightmap).xyz; \nlightmap.xyz = pow( 1.8 * lightmap.xyz, vec3(1.1)) ; \ndiffuseColor.xyz *= lightmap.xyz ; \n} \n",lineFog:"struct Fog{ \nvec3 fogColor  ; \nfloat globalDensity ; \nfloat fogStartDistance ; \nfloat fogFarDistance ; \nfloat fogAlpha ; \n}; \nuniform float uniform_globalFog[7]; \nvarying vec4 varying_mvPose; \nvoid main(void){ \nFog fog; \nfog.fogColor = vec3(uniform_globalFog[0],uniform_globalFog[1],uniform_globalFog[2]); \nfog.globalDensity = uniform_globalFog[3]; \nfog.fogStartDistance = uniform_globalFog[4] ; \nfog.fogFarDistance = uniform_globalFog[5] ; \nfog.fogAlpha = uniform_globalFog[6] ; \nfloat d = varying_mvPose.z ; \nfloat distFog = max( 0.0 , d -  fog.fogStartDistance ) ; \ndiffuseColor.xyz = mix( diffuseColor.xyz,fog.fogColor, clamp(distFog/fog.fogFarDistance,0.0,1.0) * fog.fogAlpha ) ; \n} \n",matCapPass_vs:"varying vec2 capCoord ; \nvoid main(void){ \ncapCoord.x = dot(normalMatrix[0].xyz,normal); \ncapCoord.y = dot(normalMatrix[1].xyz,normal); \ncapCoord = capCoord * 0.5 + 0.5; \nambientColor.xyz +=  + capCoord.xyz * 2.0 - 1.0 ; \n} \n",matCap_TextureAdd_fs:"uniform sampler2D matcapTexture; \nvoid main() { \nvec4 capCoord ; \ncapCoord.x = -normal.x; \ncapCoord.y = normal.y; \ncapCoord.xy = capCoord.xy * 0.5 + 0.5; \ncapCoord = texture2D(matcapTexture , capCoord.xy ) * 2.0 - 1.0 ; \nambientColor.xyz += capCoord.xyz ; \n} \n",matCap_TextureMult_fs:"uniform sampler2D matcapTexture; \nvoid main() { \nvec4 capCoord ; \ncapCoord.x = -normal.x; \ncapCoord.y = normal.y; \ncapCoord.xy = capCoord.xy * 0.5 + 0.5; \ncapCoord = texture2D(matcapTexture , capCoord.xy ) ; \ndiffuseColor.xyz *= capCoord.xyz * 2.0 ; \n} \n",materialSource_fs:"struct MaterialSource{ \nvec3 diffuse; \nvec3 ambient; \nvec3 specular; \nfloat alpha; \nfloat cutAlpha; \nfloat shininess; \nfloat roughness; \nfloat albedo; \nvec4 uvRectangle; \nfloat specularScale; \nfloat normalScale; \n}; \nuniform float uniform_materialSource[20] ; \nMaterialSource materialSource ; \nvec2 uv_0 ; \nvoid main(){ \nmaterialSource.diffuse.x = uniform_materialSource[0]; \nmaterialSource.diffuse.y = uniform_materialSource[1]; \nmaterialSource.diffuse.z = uniform_materialSource[2]; \nmaterialSource.ambient.x = uniform_materialSource[3]; \nmaterialSource.ambient.y = uniform_materialSource[4]; \nmaterialSource.ambient.z = uniform_materialSource[5]; \nmaterialSource.specular.x = uniform_materialSource[6]; \nmaterialSource.specular.y = uniform_materialSource[7]; \nmaterialSource.specular.z = uniform_materialSource[8]; \nmaterialSource.alpha = uniform_materialSource[9]; \nmaterialSource.cutAlpha = uniform_materialSource[10]; \nmaterialSource.shininess = uniform_materialSource[11]; \nmaterialSource.specularScale = uniform_materialSource[12]; \nmaterialSource.albedo = uniform_materialSource[13]; \nmaterialSource.uvRectangle.x = uniform_materialSource[14]; \nmaterialSource.uvRectangle.y = uniform_materialSource[15]; \nmaterialSource.uvRectangle.z = uniform_materialSource[16]; \nmaterialSource.uvRectangle.w = uniform_materialSource[17]; \nmaterialSource.normalScale = uniform_materialSource[19]; \nuv_0 = varying_uv0.xy * materialSource.uvRectangle.zw + materialSource.uvRectangle.xy ; \n} \n",mulUvRoll_fs:"uniform float mulUvRoll[4] ; \nuniform sampler2D diffuseTexture; \nuniform sampler2D diffuseTexture1; \nvec4 diffuseColor ; \nvec2 uv_1; \nvoid main() { \nuv_1 = varying_uv0; \nuv_0.xy += vec2(mulUvRoll[0],mulUvRoll[1]); \nuv_1.xy += vec2(mulUvRoll[2],mulUvRoll[3]); \ndiffuseColor = texture2D(diffuseTexture , uv_0 ) * texture2D(diffuseTexture1 , uv_1 ); \ndiffuseColor.xyz = clamp(diffuseColor.xyz / diffuseColor.w,0.0,1.0); \n} \n",normalMap_fragment:"uniform sampler2D normalTexture; \nvarying vec2 varying_uv0        ; \nvarying vec4 varying_mvPose        ; \nmat3 TBN ; \nmat3 cotangentFrame(vec3 N, vec3 p, vec2 uv) { \nvec3 dp1 = dFdx(p); \nvec3 dp2 = dFdy(p); \nvec2 duv1 = dFdx(uv); \nvec2 duv2 = dFdy(uv); \nvec3 dp2perp = cross(dp2, N); \nvec3 dp1perp = cross(N, dp1); \nvec3 T = dp2perp * duv1.x + dp1perp * duv2.x; \nvec3 B = dp2perp * duv1.y + dp1perp * duv2.y; \nfloat invmax = 1.0 / sqrt(max(dot(T,T), dot(B,B))); \nreturn mat3(T * invmax, B * invmax, N); \n} \nvec3 tbn(vec3 map, vec3 N, vec3 V, vec2 texcoord) { \nmat3 TBN = cotangentFrame(N, -V, texcoord); \nreturn normalize(TBN * map); \n} \nvoid main(){ \nvec3 normalTex = texture2D(normalTexture,uv_0).xyz *2.0 - 1.0; \nnormalTex.y *= -1.0; \nnormal.xyz = tbn( normalTex.xyz , normal.xyz , varying_mvPose.xyz , uv_0 ) ; \n} \n",particle_bezier:"vec2 bzData[20]; \nconst float Tiny = 0.0001; \nvoid dcpBezier(float bezierData[22], float tTotal) \n{ \nfloat timeNow = 0.0; \nfloat time1 = bezierData[20] * tTotal; \nfloat time2 = bezierData[21] * tTotal; \nfor(int i = 0; i < 20; i ++){ \nbzData[i].x = timeNow; \nbzData[i].y = bezierData[i]; \nif(i <= 9){ \ntimeNow += time1; \n}else if(i >= 11){ \ntimeNow += time2; \n} \n} \nbzData[10].x = bzData[9].x; \n} \nfloat calcBezierArea(float tCurrent){ \nfloat res = 0.0; \nfloat v0; \nfloat v1; \nfloat t0; \nfloat t1; \nfloat deltaTime = 0.0; \nfloat a_deltaTime; \nfor(int i = 0; i < 19; i ++){ \nv0 = bzData[i].y; \nv1 = bzData[i + 1].y; \nt0 = bzData[i].x; \nt1 = bzData[i + 1].x; \ndeltaTime = t1 - t0; \nif(deltaTime > Tiny) \n{ \na_deltaTime = 0.5 * (v1 - v0); \nif(tCurrent >= t1){ \nres += deltaTime * (v0 + a_deltaTime); \n}else{ \ndeltaTime = tCurrent - t0; \nres += deltaTime * (v0 + a_deltaTime); \nbreak; \n} \n} \n} \nreturn res; \n} \nfloat calcOneBezierArea(float bezierData[22], float tCurrent, float tTotal){ \ndcpBezier(bezierData, tTotal); \nreturn calcBezierArea(tCurrent); \n} \nfloat calcBezierSize(float tCurrent){ \nfloat res = 0.0; \nfloat y0; \nfloat y1; \nfloat t0; \nfloat t1; \nfloat deltaTime = 0.0; \nfloat v; \nfor(int i = 0; i < 19; i ++){ \ny0 = bzData[i].y; \ny1 = bzData[i + 1].y; \nt0 = bzData[i].x; \nt1 = bzData[i + 1].x; \ndeltaTime = t1 - t0; \nif(deltaTime > Tiny) \n{ \nif(tCurrent <= t1){ \nv = (y1 - y0) / deltaTime; \ndeltaTime = tCurrent - t0; \nres = y0 + v * deltaTime; \nbreak; \n} \n} \n} \nreturn res; \n} \nfloat calcOneBezierSize(float bezierData[22], float tCurrent, float tTotal){ \ndcpBezier(bezierData, tTotal); \nreturn calcBezierSize(tCurrent); \n} \n",particle_color_fs:"uniform float uniform_colorTransform[40]; \nvec3 unpack_color(float rgb_data) \n{ \nvec3 res; \nres.z = fract( rgb_data ); \nrgb_data -= res.z; \nrgb_data = rgb_data/256.0; \nres.y = fract( rgb_data ); \nrgb_data -= res.y; \nres.x = rgb_data/256.0; \nreturn res; \n} \nvoid main() { \nfloat startColor ; \nfloat startSegment ; \nfloat nextColor ; \nfloat nextSegment ; \nfloat startAlpha; \nfloat nextAlpha; \nfloat progress = varying_particleData.x/varying_particleData.y; \nconst int maxColorCount = 20; \nfor( int i = 1 ; i < maxColorCount ; i++ ){ \nif( progress >= fract(uniform_colorTransform[i+maxColorCount-1]) ){ \nstartColor = uniform_colorTransform[i-1] ; \nstartSegment = fract(uniform_colorTransform[i+maxColorCount-1]) ; \nnextColor = uniform_colorTransform[i]; \nnextSegment = fract(uniform_colorTransform[i+maxColorCount]) ; \nstartAlpha = uniform_colorTransform[i+maxColorCount-1] - startSegment; \nnextAlpha = uniform_colorTransform[i+maxColorCount] - nextSegment; \n}else{ \nbreak; \n} \n} \nfloat len = nextSegment - startSegment ; \nfloat ws = ( progress - startSegment ) / len ; \nglobalColor = mix(vec4(unpack_color(startColor).xyz,startAlpha / 256.0),vec4(unpack_color(nextColor).xyz, nextAlpha / 256.0),ws) ; \nglobalColor.w = clamp(globalColor.w,0.0,1.0); \n} \n//##FilterEnd## \n",particle_color_vs:"float particle(  ParticleData curParticle ){ \n} \n//##FilterEnd## \n",particle_diffuse_fragment:"uniform sampler2D diffuseTexture; \nvec4 diffuseColor ; \nvec4 globalColor = vec4(1.0, 1.0, 1.0, 1.0); \nvoid calcUVCoord(){ \n} \nvoid main() { \nif( diffuseColor.w == 0.0 ){ \ndiscard; \n} \ncalcUVCoord(); \ndiffuseColor = texture2D(diffuseTexture , uv_0 ); \nif( diffuseColor.w < materialSource.cutAlpha ){ \ndiscard; \n} \n} \n",particle_end:"float particle( ParticleData curParticle ){ \nreturn 1.0 ; \n} \nmat4 buildModelMatrix(vec4 quat, vec3 scale, vec3 position) \n{ \nmat4 ret = mat4( \nvec4(scale.x, 0.0, 0.0, 0.0), \nvec4(0.0, scale.y, 0.0, 0.0), \nvec4(0.0, 0.0, scale.z, 0.0), \nvec4(0.0, 0.0, 0.0, 1.0) \n); \nret = buildMat4Quat(quat) * ret; \nret[3][0] = position.x; \nret[3][1] = position.y; \nret[3][2] = position.z; \nreturn ret; \n} \nvec3 calcParticleMove(vec3 distanceXYZ){ \nif(velocityLimitVec2.y > TrueOrFalse){ \nvec3 temp = distanceXYZ * distanceXYZ; \nfloat distanceCurrent = sqrt(temp.x + temp.y + temp.z); \nfloat distanceLimit = velocityLimitVec2.x; \nif(distanceLimit < 0.0001){ \nreturn vec3(0.0); \n} \nif(distanceCurrent > distanceLimit){ \ndistanceXYZ *= distanceLimit / distanceCurrent; \n} \n} \nreturn distanceXYZ; \n} \nmat4 getRenderModeMatrix(mat4 cameraMatrix, mat4 modelMatrix){ \nreturn cameraMatrix; \n} \nvoid updateStretchedBillBoard(vec4 startPos, vec4 newPos){ \n} \nvoid main(void) { \nif(discard_particle > TrueOrFalse){ \noutPosition = vec4(0.0,0.0,0.0,0.0); \n}else{ \nvec3 position_emitter = attribute_offsetPosition; \nvec3 velocityLocalVec3 = velocityBaseVec3 * currentTime; \nvec3 velocityWorldVec3 = vec3(0.0,0.0,0.0); \nvec3 velocityMultiVec3 = vec3(0.0,0.0,0.0); \nif(particleStateData.velocityOverWorldSpace < TrueOrFalse){ \nvelocityLocalVec3 += velocityOverVec3; \n}else{ \nvelocityWorldVec3 += velocityOverVec3; \n} \nif(particleStateData.velocityForceWorldSpace < TrueOrFalse){ \nvelocityLocalVec3 += velocityForceVec3; \n}else{ \nvelocityWorldVec3 += velocityForceVec3; \n} \nif(particleStateData.worldSpace > TrueOrFalse){ \n}else{ \nfollowTargetPosition.x = particleStateData.positionX; \nfollowTargetPosition.y = particleStateData.positionY; \nfollowTargetPosition.z = particleStateData.positionZ; \nfollowTargetRotation.x = particleStateData.rotationX; \nfollowTargetRotation.y = particleStateData.rotationY; \nfollowTargetRotation.z = particleStateData.rotationZ; \nfollowTargetRotation.w = particleStateData.rotationW; \n} \nmat4 followRotQuat = buildMat4Quat(followTargetRotation); \nvelocityLocalVec3 = (followRotQuat * vec4(velocityLocalVec3, 1.0)).xyz; \nmat4 modelMatrix = buildModelMatrix(followTargetRotation, followTargetScale, followTargetPosition); \nposition_emitter = (modelMatrix * vec4(position_emitter, 1.0)).xyz; \nvelocityMultiVec3 = velocityLocalVec3 + velocityWorldVec3; \nvelocityMultiVec3 = calcParticleMove(velocityMultiVec3); \nvelocityMultiVec3.y -= 4.9 * currentTime * currentTime * particleStateData.gravity; \nvec3 origPosition = position_emitter; \nposition_emitter += velocityMultiVec3; \nupdateStretchedBillBoard(vec4(origPosition, 1.0), vec4(position_emitter, 1.0)); \nmat4 billboardMatrix = getRenderModeMatrix(uniform_cameraMatrix, modelMatrix); \noutPosition = billboardMatrix * localPosition; \noutPosition.xyz += position_emitter.xyz; \noutPosition = uniform_ViewMatrix * outPosition; \n} \nvarying_posZ = outPosition.z; \ngl_Position = uniform_ProjectionMatrix * outPosition ; \n} \n//##FilterEnd## \n",particle_end_fs:"const float TrueOrFalse = 0.5; \nuniform float uniform_particleFsData[3]; \nvoid main() { \nfloat blendMode = uniform_particleFsData[2]; \noutColor.xyz = diffuseColor.xyz * materialSource.diffuse * varying_color.xyz * globalColor.xyz; \noutColor.w = diffuseColor.w * varying_color.w * globalColor.w; \nif(blendMode < TrueOrFalse){ \noutColor.xyz *= outColor.w; \n} \noutColor = clamp(outColor, 0.0, 1.0); \ngl_FragColor = outColor; \n} \n",particle_end_vs:"varying vec4 varying_pos; \nfloat particle( ParticleData curParticle ){ \nreturn 1.0 ; \n} \nmat4 buildModelMatrix(vec4 quat, vec3 scale, vec3 position) \n{ \nmat4 ret = mat4( \nvec4(scale.x, 0.0, 0.0, 0.0), \nvec4(0.0, scale.y, 0.0, 0.0), \nvec4(0.0, 0.0, scale.z, 0.0), \nvec4(0.0, 0.0, 0.0, 1.0) \n); \nret = buildMat4Quat(quat) * ret; \nret[3][0] = position.x; \nret[3][1] = position.y; \nret[3][2] = position.z; \nreturn ret; \n} \nvec3 calcParticleMove(vec3 distanceXYZ){ \nif(velocityLimitVec2.y > TrueOrFalse){ \nvec3 temp = distanceXYZ * distanceXYZ; \nfloat distanceCurrent = sqrt(temp.x + temp.y + temp.z); \nfloat distanceLimit = velocityLimitVec2.x; \nif(distanceLimit < Tiny){ \nreturn vec3(0.0); \n} \nif(distanceCurrent > distanceLimit){ \nfloat nowFrame = currentTime / 0.017; \nfloat dampen = 1.0 - particleStateData.velocityLimitDampen; \nfloat startDistance = (distanceCurrent - distanceLimit) / nowFrame; \nfloat distanceResult = 0.0; \nfloat tempDistance = startDistance; \nfor(int i = 1; i < 600; i++){ \ndistanceResult += tempDistance; \ntempDistance *= dampen; \nif(float(i) > nowFrame) \nbreak; \n} \ndistanceXYZ *= (distanceResult + distanceLimit) / distanceCurrent; \n} \n} \nreturn distanceXYZ; \n} \nmat4 getRenderModeMatrix(mat4 cameraMatrix, mat4 modelMatrix){ \nreturn cameraMatrix; \n} \nfloat updateStretchedBillBoard(vec4 startPos, vec4 newPos){ \nreturn 1.0; \n} \nvoid main(void) { \nif(discard_particle > TrueOrFalse){ \noutPosition = vec4(0.0,0.0,0.0,0.0); \n}else{ \nvec3 position_emitter = attribute_offsetPosition; \nvec3 velocityLocalVec3 = velocityBaseVec3 * currentTime; \nvec3 velocityWorldVec3 = vec3(0.0,0.0,0.0); \nvec3 velocityMultiVec3 = vec3(0.0,0.0,0.0); \nif(particleStateData.velocityOverWorldSpace < TrueOrFalse){ \nvelocityLocalVec3 += velocityOverVec3; \n}else{ \nvelocityWorldVec3 += velocityOverVec3; \n} \nif(particleStateData.velocityForceWorldSpace < TrueOrFalse){ \nvelocityLocalVec3 += velocityForceVec3; \n}else{ \nvelocityWorldVec3 += velocityForceVec3; \n} \nif(particleStateData.worldSpace > TrueOrFalse){ \n}else{ \nfollowTargetPosition.x = particleStateData.positionX; \nfollowTargetPosition.y = particleStateData.positionY; \nfollowTargetPosition.z = particleStateData.positionZ; \nfollowTargetRotation.x = particleStateData.rotationX; \nfollowTargetRotation.y = particleStateData.rotationY; \nfollowTargetRotation.z = particleStateData.rotationZ; \nfollowTargetRotation.w = particleStateData.rotationW; \n} \nmat4 followRotQuat = buildMat4Quat(followTargetRotation); \nvelocityLocalVec3 = (followRotQuat * vec4(velocityLocalVec3, 1.0)).xyz; \nmat4 modelMatrix = buildModelMatrix(followTargetRotation, followTargetScale, followTargetPosition); \nif(particleStateData.renderMode == 4.0){ \nposition_emitter.xyz += localPosition.xyz; \n} \nposition_emitter = (modelMatrix * vec4(position_emitter, 1.0)).xyz; \nvelocityMultiVec3 = velocityLocalVec3 + velocityWorldVec3; \nvelocityMultiVec3 = calcParticleMove(velocityMultiVec3); \nvelocityMultiVec3.y -= 4.9 * currentTime * currentTime * particleStateData.gravity; \nvec3 origPosition = position_emitter; \nposition_emitter += velocityMultiVec3; \nfloat dirEnable = updateStretchedBillBoard(vec4(origPosition, 1.0), vec4(position_emitter, 1.0)); \nif(dirEnable > TrueOrFalse){ \nif(particleStateData.renderMode == 4.0){ \noutPosition.xyz = position_emitter.xyz; \n}else{ \nmat4 billboardMatrix = getRenderModeMatrix(uniform_cameraMatrix, modelMatrix); \noutPosition = billboardMatrix * localPosition; \noutPosition.xyz += position_emitter.xyz; \n} \noutPosition = uniform_ViewMatrix * outPosition; \n}else{ \noutPosition = vec4(0.0,0.0,0.0,0.0); \n} \n} \ngl_Position = uniform_ProjectionMatrix * outPosition ; \nvarying_pos = gl_Position; \n} \n//##FilterEnd## \n",particle_follow_vs:"attribute vec3 attribute_followPosition ; \nattribute vec4 attribute_followRotation ; \nattribute vec3 attribute_followScale; \nfloat particle(  ParticleData curParticle ){ \nfollowTargetPosition = attribute_followPosition; \nfollowTargetRotation = attribute_followRotation; \n} \n//##FilterEnd## \n",particle_fs:"uniform vec2 uniform_fadeOutParticleData; \nvarying float varying_posZ; \nvoid fadeOutParticleByZ(){ \nif(varying_posZ > uniform_fadeOutParticleData.x){ \ndiscard; \n} \nfloat fadeAlpha = (uniform_fadeOutParticleData.x - varying_posZ) / uniform_fadeOutParticleData.x; \nfadeAlpha = clamp(fadeAlpha, 0.0, 1.0); \nfadeAlpha *= fadeAlpha; \noutColor.w *= fadeAlpha; \nif( diffuseColor.w < materialSource.cutAlpha ){ \ndiscard; \n} \n} \n",particle_rm_billboard:"mat4 getRenderModeMatrix(mat4 cameraMatrix, mat4 modelMatrix) { \nmat4 matrix = mat4( \ncameraMatrix[0], \ncameraMatrix[1], \ncameraMatrix[2], \nvec4(0.0, 0.0, 1.0, 1.0)); \nreturn matrix; \n} \n",particle_rm_mesh:"mat4 getRenderModeMatrix(mat4 cameraMatrix, mat4 modelMatrix) { \nreturn mat4( \nvec4(1.0, 0.0, 0.0, 0.0), \nvec4(0.0, 1.0, 0.0, 0.0), \nvec4(0.0, 0.0, 1.0, 0.0), \nvec4(0.0, 0.0, 0.0, 1.0) \n); \n} \n",particle_rm_stretched:"mat4 getRenderModeMatrix(mat4 cameraMatrix, mat4 modelMatrix) { \nmat4 matrix = mat4( \ncameraMatrix[0], \ncameraMatrix[1], \ncameraMatrix[2], \nvec4(0.0, 0.0, 1.0, 1.0)); \nreturn matrix; \n} \nfloat updateStretchedBillBoard(vec4 startPos, vec4 newPos){ \nvec3 dirVector = newPos.xyz - startPos.xyz; \nfloat speedScale = dot(dirVector, dirVector); \nspeedScale = sqrt(speedScale) * 0.01 / currentTime; \nlocalPosition.x *= particleStateData.lengthScale + speedScale * particleStateData.speedScale; \nmat4 temp = uniform_ViewMatrix; \nstartPos = temp * startPos; \nnewPos = temp * newPos; \nfloat scaleBefore = dot(dirVector, dirVector); \nscaleBefore = sqrt(scaleBefore); \nif(scaleBefore < Tiny){ \nreturn 0.0; \n} \ndirVector = newPos.xyz - startPos.xyz; \nfloat scaleAfter = dot(dirVector.xy, dirVector.xy); \nscaleAfter = sqrt(scaleAfter); \nscaleAfter = sqrt(scaleAfter / scaleBefore); \nlocalPosition.x *= scaleAfter; \nstartPos.xyz /= startPos.z; \nnewPos.xyz /= newPos.z; \ndirVector = newPos.xyz - startPos.xyz; \ndirVector = normalize(dirVector); \nvec3 dirStartVector = vec3(0.0, 1.0, 0.0); \nfloat added = -0.5 * PI; \nif(dirVector.x > 0.0){ \ndirVector.xy *= -1.0; \nadded += PI; \n} \nfloat acosValue = dot(dirStartVector, dirVector); \nfloat angle = acos(acosValue) + added; \ntemp = buildRotMat4(vec3(0.0, 0.0, angle)); \nlocalPosition = temp * localPosition; \nreturn 1.0; \n} \n",particle_rotationConst:"attribute float attribute_rotationZ ; \nfloat particle(  ParticleData curParticle ){ \nfloat rot = currentTime * attribute_rotationZ * (PI / 180.0); \nlocalPosition = buildRotMat4(vec3(0.0,0.0,rot)) * localPosition; \n} \n",particle_rotationOneBezier:"uniform float uniform_rotationBezier[22]; \nfloat particle(  ParticleData curParticle ){ \nif(discard_particle < TrueOrFalse){ \nfloat rot = calcOneBezierSize(uniform_rotationBezier, currentTime, curParticle.life); \nrot = currentTime * rot * (PI / 180.0); \nlocalPosition = buildRotMat4(vec3(0.0,0.0,rot)) * localPosition; \n} \n} \n",particle_rotationTwoBezier:"attribute float attribute_rotationRandomSeed; \nuniform float uniform_rotationBezier[22]; \nuniform float uniform_rotationBezier2[22]; \nfloat particle(  ParticleData curParticle ){ \nif(discard_particle < TrueOrFalse){ \nvec2 rotationTwoBezier = vec2(0.0); \nrotationTwoBezier.x = calcOneBezierArea(uniform_rotationBezier, currentTime, curParticle.life); \nrotationTwoBezier.y = calcOneBezierArea(uniform_rotationBezier2, currentTime, curParticle.life); \nfloat rot = mix(rotationTwoBezier.x, rotationTwoBezier.y, attribute_rotationRandomSeed); \nrot = currentTime * rot * (PI / 180.0); \nlocalPosition = buildRotMat4(vec3(0.0,0.0,rot)) * localPosition; \n} \n} \n",particle_size_vs:"uniform float uniform_bezierSize[22]; \nvoid main() { \nfloat bezierSize = calcOneBezierSize(uniform_bezierSize, currentTime, curParticle.life); \nlocalPosition.xyz *= bezierSize; \n} \n",particle_textureSheetConst:"varying vec3 varying_textureSheetData; \nuniform float uniform_textureSheet[5]; \nvec2 getSheetOffset(float frame, float tileX, float tileY) \n{ \nframe = floor(frame); \nvec2 ret = vec2(0.0); \nret.x = (1.0 / tileX) * mod(frame, tileX); \nret.y = frame / tileX; \nret.y = floor(ret.y); \nret.y = (1.0 / tileY) * ret.y; \nreturn ret; \n} \nvoid calcUVCoord() { \nvec2 rectUV = vec2(1.0 / uniform_textureSheet[0], 1.0 / uniform_textureSheet[1]); \nuv_0.xy *= rectUV; \nfloat frame = varying_textureSheetData.x + varying_textureSheetData.y; \nframe = clamp(frame, uniform_textureSheet[3], uniform_textureSheet[4]); \nuv_0.xy += getSheetOffset(frame, uniform_textureSheet[0], uniform_textureSheet[1]); \n} \n",particle_textureSheetOneBezier:"varying vec3 varying_textureSheetData; \nuniform float uniform_textureSheet[5]; \nuniform float uniform_frameBezier[22]; \nvec2 getSheetOffset(float frame, float tileX, float tileY) \n{ \nframe = floor(frame); \nvec2 ret = vec2(0.0); \nret.x = (1.0 / tileX) * mod(frame, tileX); \nret.y = frame / tileX; \nret.y = floor(ret.y); \nret.y = (1.0 / tileY) * ret.y; \nreturn ret; \n} \nvoid calcUVCoord() { \nvec2 rectUV = vec2(1.0 / uniform_textureSheet[0], 1.0 / uniform_textureSheet[1]); \nuv_0.xy *= rectUV; \nfloat frame = varying_textureSheetData.x + varying_textureSheetData.y; \nfloat currentTime = varying_particleData.x * uniform_textureSheet[2]; \ncurrentTime = mod(currentTime, varying_particleData.y); \nfloat bezierFrame = calcOneBezierSize(uniform_frameBezier, currentTime, varying_particleData.y); \nbezierFrame = clamp(bezierFrame, uniform_textureSheet[3], uniform_textureSheet[4]); \nframe += bezierFrame; \nuv_0.xy += getSheetOffset(frame, uniform_textureSheet[0], uniform_textureSheet[1]); \n} \n",particle_textureSheetTwoBezier:"varying vec3 varying_textureSheetData; \nuniform float uniform_textureSheet[5]; \nuniform float uniform_frameBezier1[22]; \nuniform float uniform_frameBezier2[22]; \nvec2 getSheetOffset(float frame, float tileX, float tileY) \n{ \nframe = floor(frame); \nvec2 ret = vec2(0.0); \nret.x = (1.0 / tileX) * mod(frame, tileX); \nret.y = frame / tileX; \nret.y = floor(ret.y); \nret.y = (1.0 / tileY) * ret.y; \nreturn ret; \n} \nvoid calcUVCoord() { \nvec2 rectUV = vec2(1.0 / uniform_textureSheet[0], 1.0 / uniform_textureSheet[1]); \nuv_0.xy *= rectUV; \nfloat frame = varying_textureSheetData.x + varying_textureSheetData.y; \nfloat currentTime = varying_particleData.x * uniform_textureSheet[2]; \ncurrentTime = mod(currentTime, varying_particleData.y); \nfloat b1 = calcOneBezierSize(uniform_frameBezier1, currentTime2, varying_particleData.y); \nfloat b2 = calcOneBezierSize(uniform_frameBezier2, currentTime2, varying_particleData.y); \nfloat bezierFrame = mix(b1, b2, varying_particleData.z); \nbezierFrame = clamp(bezierFrame, uniform_textureSheet[3], uniform_textureSheet[4]); \nframe += bezierFrame; \nuv_0.xy += getSheetOffset(frame, uniform_textureSheet[0], uniform_textureSheet[1]); \n} \n",particle_textureSheet_vs:"attribute vec3 attribute_textureSheetData; \nvarying vec3 varying_textureSheetData; \nfloat particle(  ParticleData curParticle ){ \nvarying_textureSheetData = attribute_textureSheetData; \n} \n",particle_time_fs:"varying vec3 varying_particleData; \nvoid main(void) { \n} \n",particle_time_vs:"attribute vec3 attribute_time ; \nfloat currentTime = 0.0; \nvarying vec3 varying_particleData; \nstruct ParticleData{ \nfloat bornTime; \nfloat life; \nfloat index; \n}; \nfloat particle( ParticleData curParticle ){ \nfloat time = particleStateData.time - particleStateData.delay; \ncurrentTime = time - curParticle.bornTime; \nif(currentTime <= 0.0){ \nreturn currentTime = 0.0; \n} \nif(particleStateData.loop < TrueOrFalse){ \nif(curParticle.bornTime >= particleStateData.duration){ \nreturn currentTime = 0.0; \n} \nif(time >= curParticle.life + curParticle.bornTime){ \nreturn currentTime = 0.0; \n} \n} \ncurrentTime = mod(currentTime, particleStateData.loopTime); \nif(currentTime >= curParticle.life){ \nreturn currentTime = 0.0; \n} \nif( currentTime <= 0.0 ) \nreturn currentTime = 0.0; \n} \nvoid main(void) { \nParticleData curParticle ; \ncurParticle.bornTime = attribute_time.x ; \ncurParticle.life = attribute_time.y ; \ncurParticle.index = attribute_time.z ; \nfloat active = particle( curParticle ) ; \nvarying_particleData.x = currentTime; \nvarying_particleData.y = curParticle.life ; \nvarying_particleData.z = curParticle.index; \nif( active < TrueOrFalse ){ \ne_discard(); \n}else{ \n} \n} \n",particle_uv_roll_fs:"uniform float uniform_particleUVRoll[2]; \nvoid calcUVCoord() { \nuv_0.xy += vec2(varying_particleData.x * uniform_particleUVRoll[0], varying_particleData.x * uniform_particleUVRoll[1]); \n} \n",particle_velocity:"attribute vec3 attribute_velocity; \nfloat particle(  ParticleData curParticle ){ \nvelocityBaseVec3 = attribute_velocity; \n} \n",particle_velocityForceConst:"attribute vec3 attribute_velocityForceConst ; \nfloat particle(   ParticleData curParticle ){ \nvelocityForceVec3 = 0.5 * attribute_velocityForceConst * currentTime * currentTime; \n} \n",particle_velocityForceOneBezier:"vec3 velocityForceOneBezier = vec3(0.0); \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \n} \nvoid main() { \nif(discard_particle < TrueOrFalse){ \nvelocityForceVec3.xyz = velocityForceOneBezier.xyz; \ncalcVelocityForceBezier(currentTime, curParticle.life); \n} \n} \n",particle_velocityForceOneBezierX:"uniform float uniform_velocityForceX[22]; \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \nvelocityForceOneBezier.x = calcOneBezierArea(uniform_velocityForceX, curTime, totalTime); \n} \n",particle_velocityForceOneBezierY:"uniform float uniform_velocityForceY[22]; \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \nvelocityForceOneBezier.y = calcOneBezierArea(uniform_velocityForceY, curTime, totalTime); \n} \n",particle_velocityForceOneBezierZ:"uniform float uniform_velocityForceZ[22]; \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \nvelocityForceOneBezier.z = calcOneBezierArea(uniform_velocityForceZ, curTime, totalTime); \n} \n",particle_velocityForceTwoBezier:"attribute float attribute_velocityForceRandomSeed; \nvec3 velocityForceTwoBezier1 = vec3(0.0); \nvec3 velocityForceTwoBezier2 = vec3(0.0); \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \n} \nvoid main() { \nif(discard_particle < TrueOrFalse){ \ncalcVelocityForceBezier(currentTime, curParticle.life); \nvelocityForceVec3.x = mix(velocityForceTwoBezier1.x, velocityForceTwoBezier2.x, attribute_velocityForceRandomSeed); \nvelocityForceVec3.y = mix(velocityForceTwoBezier1.y, velocityForceTwoBezier2.y, attribute_velocityForceRandomSeed); \nvelocityForceVec3.z = mix(velocityForceTwoBezier1.z, velocityForceTwoBezier2.z, attribute_velocityForceRandomSeed); \n} \n} \n",particle_velocityForceTwoBezierX1:"uniform float uniform_velocityForceX1[22]; \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \nvelocityForceTwoBezier1.x = calcOneBezierArea(uniform_velocityForceX1, curTime, totalTime); \n} \n",particle_velocityForceTwoBezierX2:"uniform float uniform_velocityForceX2[22]; \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \nvelocityForceTwoBezier2.x = calcOneBezierArea(uniform_velocityForceX2, curTime, totalTime); \n} \n",particle_velocityForceTwoBezierY1:"uniform float uniform_velocityForceY1[22]; \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \nvelocityForceTwoBezier1.y = calcOneBezierArea(uniform_velocityForceY1, curTime, totalTime); \n} \n",particle_velocityForceTwoBezierY2:"uniform float uniform_velocityForceY2[22]; \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \nvelocityForceTwoBezier2.y = calcOneBezierArea(uniform_velocityForceY2, curTime, totalTime); \n} \n",particle_velocityForceTwoBezierZ1:"uniform float uniform_velocityForceZ1[22]; \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \nvelocityForceTwoBezier1.z = calcOneBezierArea(uniform_velocityForceZ1, curTime, totalTime); \n} \n",particle_velocityForceTwoBezierZ2:"uniform float uniform_velocityForceZ2[22]; \nvoid calcVelocityForceBezier(float curTime, float totalTime) \n{ \nvelocityForceTwoBezier2.z = calcOneBezierArea(uniform_velocityForceZ2, curTime, totalTime); \n} \n",particle_velocityLimitConst:"attribute float attribute_velocityLimit; \nfloat particle(  ParticleData curParticle ){ \nvelocityLimitVec2.x = attribute_velocityLimit * currentTime; \nif(velocityLimitVec2.x < 0.0){ \nvelocityLimitVec2.x = 0.0; \n} \nvelocityLimitVec2.y = 1.0; \n} \n",particle_velocityLimitOneBezier:"uniform float uniform_velocityLimit[22]; \nvoid main() { \nif(discard_particle < TrueOrFalse){ \nvelocityLimitVec2.x = calcOneBezierArea(uniform_velocityLimit, currentTime, curParticle.life); \nvelocityLimitVec2.y = 1.0; \n} \n} \n",particle_velocityLimitTwoBezier:"uniform float uniform_velocityLimit[22]; \nuniform float uniform_velocityLimit2[22]; \nattribute float attribute_velocityLimitRandomSeed; \nvoid main() { \nif(discard_particle < TrueOrFalse){ \nfloat velocity2Limit1 = calcOneBezierArea(uniform_velocityLimit, currentTime, curParticle.life); \nfloat velocity2Limit2 = calcOneBezierArea(uniform_velocityLimit2, currentTime, curParticle.life); \nvelocityLimitVec2.x = mix(velocity2Limit1, velocity2Limit1, attribute_velocityLimitRandomSeed); \nif(velocityLimitVec2.x < 0.0){ \nvelocityLimitVec2.x = 0.0; \n} \nvelocityLimitVec2.y = 1.0; \n} \n} \n",particle_velocityOverConst:"attribute vec3 attribute_velocityOverConst; \nfloat particle(  ParticleData curParticle ){ \nvelocityOverVec3 = attribute_velocityOverConst * currentTime; \n} \n",particle_velocityOverOneBezier:"vec3 velocityTwoBezier = vec3(0.0); \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \n} \nvoid main() { \nif(discard_particle < TrueOrFalse){ \ncalcVelocityOverBezier(currentTime, curParticle.life); \nvelocityOverVec3.xyz = velocityTwoBezier.xyz; \n} \n} \n",particle_velocityOverOneBezierX:"uniform float uniform_velocityOverX[22]; \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \nvelocityTwoBezier.x = calcOneBezierArea(uniform_velocityOverX, curTime, totalTime); \n} \n",particle_velocityOverOneBezierY:"uniform float uniform_velocityOverY[22]; \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \nvelocityTwoBezier.y = calcOneBezierArea(uniform_velocityOverY, curTime, totalTime); \n} \n",particle_velocityOverOneBezierZ:"uniform float uniform_velocityOverZ[22]; \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \nvelocityTwoBezier.z = calcOneBezierArea(uniform_velocityOverZ, curTime, totalTime); \n} \n",particle_velocityOverTwoBezier:"attribute float attribute_velocityOverRandomSeed; \nvec3 velocityOverTwoBezier1 = vec3(0.0); \nvec3 velocityOverTwoBezier2 = vec3(0.0); \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \n} \nvoid main() { \nif(discard_particle < TrueOrFalse){ \ncalcVelocityOverBezier(currentTime, curParticle.life); \nvelocityOverVec3.x = mix(velocityOverTwoBezier1.x, velocityOverTwoBezier2.x, attribute_velocityOverRandomSeed); \nvelocityOverVec3.y = mix(velocityOverTwoBezier1.y, velocityOverTwoBezier2.y, attribute_velocityOverRandomSeed); \nvelocityOverVec3.z = mix(velocityOverTwoBezier1.z, velocityOverTwoBezier2.z, attribute_velocityOverRandomSeed); \n} \n} \n",particle_velocityOverTwoBezierX1:"uniform float uniform_velocityOverX1[22]; \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \nvelocityOverTwoBezier1.x = calcOneBezierArea(uniform_velocityOverX1, curTime, totalTime); \n} \n",particle_velocityOverTwoBezierX2:"uniform float uniform_velocityOverX2[22]; \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \nvelocityOverTwoBezier2.x = calcOneBezierArea(uniform_velocityOverX2, curTime, totalTime); \n} \n",particle_velocityOverTwoBezierY1:"uniform float uniform_velocityOverY1[22]; \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \nvelocityOverTwoBezier1.y = calcOneBezierArea(uniform_velocityOverY1, curTime, totalTime); \n} \n",particle_velocityOverTwoBezierY2:"uniform float uniform_velocityOverY2[22]; \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \nvelocityOverTwoBezier2.y = calcOneBezierArea(uniform_velocityOverY2, curTime, totalTime); \n} \n",particle_velocityOverTwoBezierZ1:"uniform float uniform_velocityOverZ1[22]; \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \nvelocityOverTwoBezier1.z = calcOneBezierArea(uniform_velocityOverZ1, curTime, totalTime); \n} \n",particle_velocityOverTwoBezierZ2:"uniform float uniform_velocityOverZ2[22]; \nvoid calcVelocityOverBezier(float curTime, float totalTime) \n{ \nvelocityOverTwoBezier2.z = calcOneBezierArea(uniform_velocityOverZ2, curTime, totalTime); \n} \n",particle_vs:"attribute vec4 attribute_color; \nattribute vec3 attribute_offsetPosition; \nuniform mat4 uniform_cameraMatrix; \nuniform float uniform_particleState[24]; \nuniform mat4 uniform_ViewMatrix; \nconst float PI = 3.1415926 ; \nfloat currentTime = 0.0; \nfloat totalTime = 0.0; \nconst float TrueOrFalse = 0.5; \nconst float Tiny = 0.0001; \nvec4 localPosition = vec4(0.0,0.0,0.0,1.0); \nvec3 velocityBaseVec3 = vec3(0.0,0.0,0.0); \nvec3 velocityOverVec3 = vec3(0.0,0.0,0.0); \nvec3 velocityForceVec3 = vec3(0.0,0.0,0.0); \nvec2 velocityBezierWeightVec2 = vec2(1.0, 1.0); \nvec2 velocityLimitVec2 = vec2(0.0,0.0); \nvec3 followTargetPosition = vec3(0.0,0.0,0.0); \nvec3 followTargetScale = vec3(1.0,1.0,1.0); \nvec4 followTargetRotation = vec4(0.0,0.0,0.0,0.0); \nvarying vec3 varyingViewDir ; \nfloat discard_particle = 0.0; \nParticleStateData particleStateData; \nvoid e_discard(){ \ndiscard_particle = 1.0; \n} \nstruct ParticleStateData{ \nfloat time; \nfloat loop; \nfloat worldSpace; \nfloat scaleX; \nfloat scaleY; \nfloat scaleZ; \nfloat rotationX; \nfloat rotationY; \nfloat rotationZ; \nfloat rotationW; \nfloat positionX; \nfloat positionY; \nfloat positionZ; \nfloat loopTime; \nfloat delay; \nfloat duration; \nfloat gravity; \nfloat velocityOverWorldSpace; \nfloat velocityForceWorldSpace; \nfloat velocityLimitDampen; \nfloat cameraScale; \nfloat speedScale; \nfloat lengthScale; \nfloat renderMode; \n}; \nmat4 buildRotMat4(vec3 rot) \n{ \nfloat s; \nfloat c; \ns = sin(rot.x); \nc = cos(rot.x); \nmat4 ret = mat4( \nvec4(1.0, 0.0, 0.0, 0.0), \nvec4(0.0, c, s, 0.0), \nvec4(0.0, -s, c, 0.0), \nvec4(0.0, 0.0, 0.0, 1.0) \n); \ns = sin(rot.y); \nc = cos(rot.y); \nret = mat4( \nvec4(c, 0.0, -s, 0.0), \nvec4(0.0, 1.0, 0.0, 0.0), \nvec4(s, 0.0, c, 0.0), \nvec4(0.0, 0.0, 0.0, 1.0) \n) * ret; \ns = sin(rot.z); \nc = cos(rot.z); \nret = mat4( \nvec4(c, s, 0.0, 0.0), \nvec4(-s, c, 0.0, 0.0), \nvec4(0.0, 0.0, 1.0, 0.0), \nvec4(0.0, 0.0, 0.0, 1.0) \n) * ret; \nreturn ret; \n} \nmat4 buildMat4Quat(vec4 quat){ \nfloat xx = quat.x * quat.x; \nfloat xy = quat.x * quat.y; \nfloat xz = quat.x * quat.z; \nfloat xw = quat.x * quat.w; \nfloat yy = quat.y * quat.y; \nfloat yz = quat.y * quat.z; \nfloat yw = quat.y * quat.w; \nfloat zz = quat.z * quat.z; \nfloat zw = quat.z * quat.w; \nreturn mat4( \n1.0 - 2.0 * (yy + zz),		2.0 * (xy + zw),		2.0 * (xz - yw),		0, \n2.0 * (xy - zw),				1.0 - 2.0 * (xx + zz),	2.0 * (yz + xw),		0, \n2.0 * (xz + yw),				2.0 * (yz - xw),		1.0 - 2.0 * (xx + yy),	0, \n0.0,							0.0,					0.0,					1 \n); \n} \nvoid main(void) { \nparticleStateData.time							= uniform_particleState[0]; \nparticleStateData.loop							= uniform_particleState[1]; \nparticleStateData.worldSpace					= uniform_particleState[2]; \nparticleStateData.scaleX						= uniform_particleState[3]; \nparticleStateData.scaleY						= uniform_particleState[4]; \nparticleStateData.scaleZ						= uniform_particleState[5]; \nparticleStateData.rotationX						= uniform_particleState[6]; \nparticleStateData.rotationY						= uniform_particleState[7]; \nparticleStateData.rotationZ						= uniform_particleState[8]; \nparticleStateData.rotationW						= uniform_particleState[9]; \nparticleStateData.positionX						= uniform_particleState[10]; \nparticleStateData.positionY						= uniform_particleState[11]; \nparticleStateData.positionZ						= uniform_particleState[12]; \nparticleStateData.loopTime						= uniform_particleState[13]; \nparticleStateData.delay							= uniform_particleState[14]; \nparticleStateData.duration						= uniform_particleState[15]; \nparticleStateData.gravity						= uniform_particleState[16]; \nparticleStateData.velocityOverWorldSpace		= uniform_particleState[17]; \nparticleStateData.velocityForceWorldSpace		= uniform_particleState[18]; \nparticleStateData.velocityLimitDampen			= uniform_particleState[19]; \nparticleStateData.cameraScale					= uniform_particleState[20]; \nparticleStateData.speedScale					= uniform_particleState[21]; \nparticleStateData.lengthScale					= uniform_particleState[22]; \nparticleStateData.renderMode					= uniform_particleState[23]; \nmat4 modeViewMatrix = mat4(uniform_ViewMatrix * uniform_ModelMatrix); \noutPosition = localPosition = vec4(e_position, 1.0); \n} \n",pickPass_fs:"void main() { \ngl_FragColor = vec4(1.0, 0.0, 0.0, 1.0); \n} \n",pickPass_skeleton_vs:"attribute vec3 attribute_position; \nattribute vec3 attribute_normal; \nattribute vec4 attribute_color; \nattribute vec2 attribute_uv0; \nattribute vec4 attribute_boneIndex; \nattribute vec4 attribute_boneWeight; \nuniform mat4 uniform_ModelMatrix ; \nuniform mat4 uniform_ViewMatrix ; \nuniform mat4 uniform_ProjectionMatrix ; \nvec3 e_position = vec3(0.0, 0.0, 0.0); \nvec4 e_boneIndex = vec4(0.0, 0.0, 0.0, 0.0); \nvec4 e_boneWeight = vec4(0.0, 0.0, 0.0, 0.0); \nvec4 outPosition = vec4(0.0, 0.0, 0.0, 0.0); \nconst int bonesNumber = 0; \nuniform vec4 uniform_PoseMatrix[bonesNumber]; \nmat4 buildMat4(int index){ \nvec4 quat = uniform_PoseMatrix[index * 2 + 0]; \nvec4 translation = uniform_PoseMatrix[index * 2 + 1]; \nfloat xy2 = 2.0 * quat.x * quat.y; \nfloat xz2 = 2.0 * quat.x * quat.z; \nfloat xw2 = 2.0 * quat.x * quat.w; \nfloat yz2 = 2.0 * quat.y * quat.z; \nfloat yw2 = 2.0 * quat.y * quat.w; \nfloat zw2 = 2.0 * quat.z * quat.w; \nfloat xx = quat.x * quat.x; \nfloat yy = quat.y * quat.y; \nfloat zz = quat.z * quat.z; \nfloat ww = quat.w * quat.w; \nmat4 matrix = mat4( \nxx - yy - zz + ww, xy2 + zw2, xz2 - yw2, 0, \nxy2 - zw2, -xx + yy - zz + ww, yz2 + xw2, 0, \nxz2 + yw2, yz2 - xw2, -xx - yy + zz + ww, 0, \ntranslation.x, translation.y, translation.z, 1 \n); \nreturn matrix; \n} \nvoid main(void){ \ne_boneIndex = attribute_boneIndex; \ne_boneWeight = attribute_boneWeight; \nvec4 temp_position = vec4(attribute_position, 1.0) ; \nmat4 m0 = buildMat4(int(e_boneIndex.x)); \nmat4 m1 = buildMat4(int(e_boneIndex.y)); \nmat4 m2 = buildMat4(int(e_boneIndex.z)); \nmat4 m3 = buildMat4(int(e_boneIndex.w)); \noutPosition = m0 * temp_position * e_boneWeight.x; \noutPosition += m1 * temp_position * e_boneWeight.y; \noutPosition += m2 * temp_position * e_boneWeight.z; \noutPosition += m3 * temp_position * e_boneWeight.w; \ne_position = outPosition.xyz; \ngl_Position = uniform_ProjectionMatrix * uniform_ViewMatrix * uniform_ModelMatrix * vec4(e_position, 1.0); \n} \n",pickPass_vs:"attribute vec3 attribute_position; \nattribute vec4 attribute_color; \nattribute vec2 attribute_uv0; \nuniform mat4 uniform_ModelMatrix ; \nuniform mat4 uniform_ViewMatrix ; \nuniform mat4 uniform_ProjectionMatrix ; \nvoid main(void){ \ngl_Position = uniform_ProjectionMatrix * uniform_ViewMatrix * uniform_ModelMatrix * vec4(attribute_position, 1.0); \n} \n",pointLight_fragment:"const int max_pointLight = 0 ; \nuniform float uniform_pointLightSource[12*max_pointLight] ; \nvarying vec4 varying_mvPose; \nstruct PointLight{ \nvec3 position ; \nvec3 diffuse ; \nvec3 ambient ; \nfloat intensity; \nfloat radius; \nfloat cutoff; \n}; \nvoid calculatePointLight(MaterialSource materialSource){ \nvec3 N = normal; \nvec3 viewDir = normalize(varying_mvPose.xyz/varying_mvPose.w); \nfor(int i = 0 ; i < max_pointLight ; i++){ \nPointLight pointLight; \npointLight.position = vec3(uniform_pointLightSource[i*12],uniform_pointLightSource[i*12+1],uniform_pointLightSource[i*12+2]); \npointLight.diffuse = vec3(uniform_pointLightSource[i*12+3],uniform_pointLightSource[i*12+4],uniform_pointLightSource[i*12+5]); \npointLight.ambient = vec3(uniform_pointLightSource[i*12+6],uniform_pointLightSource[i*12+7],uniform_pointLightSource[i*12+8]); \npointLight.intensity = uniform_pointLightSource[i*12+9]; \npointLight.radius = uniform_pointLightSource[i*12+10]; \npointLight.cutoff = uniform_pointLightSource[i*12+11]; \nvec3 lightCentre = (mat4(uniform_ViewMatrix) * vec4(pointLight.position.xyz,1.0) ).xyz ; \nfloat r = pointLight.radius * 0.5 ; \nvec3 ldir = varying_mvPose.xyz - lightCentre ; \nfloat distance = length(ldir); \nfloat d = max(distance - r, 0.0); \nvec3 L = ldir / distance; \nfloat denom = d/r + 1.0; \nfloat attenuation = 1.0 / (denom*denom); \nfloat cutoff = pointLight.cutoff ; \nattenuation = (attenuation - cutoff) / (1.0 - cutoff); \nattenuation = max(attenuation*pointLight.intensity, 0.0); \nlight.xyzw += LightingBlinnPhong(normalize(ldir),pointLight.diffuse,pointLight.ambient,N,(viewDir),attenuation); \n}; \n} \nvoid main() { \ncalculatePointLight(materialSource); \n} \n",secondaryUV_vs:"attribute vec2 attribute_uv1; \nvarying vec2 varying_uv1 ; \nvoid main(void){ \nvarying_uv1 = attribute_uv1 ; \n} \n",shadowMapping_fs:"uniform sampler2D shadowMapTexture; \nuniform vec4 uniform_ShadowColor; \nvarying vec4 varying_ShadowCoord; \nfloat unpackDepth(vec4 rgbaDepth){ \nvec4 bitShift = vec4( 1.0 , 1.0/256.0 , 1.0/(256.0*256.0) , 1.0/(256.0*256.0*256.0) ); \nfloat depth = dot(rgbaDepth,bitShift); \nreturn depth ; \n} \nvoid main() { \nvec3 shadowColor = vec3(1.0,1.0,1.0); \nfloat offset = uniform_ShadowColor.w; \nvec2 sample = varying_ShadowCoord.xy / varying_ShadowCoord.w * 0.5 + 0.5; \nsample = clamp(sample,0.0,1.0); \nvec4 sampleDepth = texture2D(shadowMapTexture, sample).xyzw; \nfloat depth = varying_ShadowCoord.z; \nif (sampleDepth.z != 0.0) { \nif( sampleDepth.z < depth - offset) { \nshadowColor = uniform_ShadowColor.xyz; \n} \n} \ndiffuseColor.xyz = diffuseColor.xyz * shadowColor; \n} \n",shadowMapping_vs:"uniform mat4 uniform_ShadowMatrix; \nuniform mat4 uniform_ModelMatrix; \nvarying vec4 varying_ShadowCoord; \nvoid main() { \nvarying_ShadowCoord = uniform_ShadowMatrix * uniform_ModelMatrix * vec4(e_position, 1.0); \n} \n",shadowPass_fs:"uniform sampler2D diffuseTexture; \nvec4 diffuseColor ; \nvarying vec2 varying_uv0; \nvarying vec4 varying_color; \nvarying vec4 varying_pos; \nfloat unpackDepth(vec4 rgbaDepth){ \nvec4 bitShift = vec4( 1.0 , 1.0/256.0 , 1.0/(256.0*256.0) , 1.0/(256.0*256.0*256.0) ); \nfloat depth = dot(rgbaDepth,bitShift); \nreturn depth ; \n} \nvoid main() { \ndiffuseColor = varying_color ; \nif( diffuseColor.w == 0.0 ){ \ndiscard; \n} \ndiffuseColor = texture2D(diffuseTexture , varying_uv0 ); \nif( diffuseColor.w <= 0.3 ){ \ndiscard; \n} \ngl_FragColor = vec4(varying_pos.zzz, 1.0); \n} \n",shadowPass_skeleton_vs:"attribute vec3 attribute_position; \nattribute vec3 attribute_normal; \nattribute vec4 attribute_color; \nattribute vec2 attribute_uv0; \nattribute vec4 attribute_boneIndex; \nattribute vec4 attribute_boneWeight; \nuniform mat4 uniform_ModelMatrix ; \nuniform mat4 uniform_ViewMatrix ; \nuniform mat4 uniform_ProjectionMatrix ; \nvec3 e_position = vec3(0.0, 0.0, 0.0); \nvec4 e_boneIndex = vec4(0.0, 0.0, 0.0, 0.0); \nvec4 e_boneWeight = vec4(0.0, 0.0, 0.0, 0.0); \nvec4 outPosition = vec4(0.0, 0.0, 0.0, 0.0); \nconst int bonesNumber = 0; \nuniform vec4 uniform_PoseMatrix[bonesNumber]; \nvarying vec2 varying_uv0; \nvarying vec4 varying_color; \nvarying vec4 varying_pos; \nmat4 buildMat4(int index){ \nvec4 quat = uniform_PoseMatrix[index * 2 + 0]; \nvec4 translation = uniform_PoseMatrix[index * 2 + 1]; \nfloat xy2 = 2.0 * quat.x * quat.y; \nfloat xz2 = 2.0 * quat.x * quat.z; \nfloat xw2 = 2.0 * quat.x * quat.w; \nfloat yz2 = 2.0 * quat.y * quat.z; \nfloat yw2 = 2.0 * quat.y * quat.w; \nfloat zw2 = 2.0 * quat.z * quat.w; \nfloat xx = quat.x * quat.x; \nfloat yy = quat.y * quat.y; \nfloat zz = quat.z * quat.z; \nfloat ww = quat.w * quat.w; \nmat4 matrix = mat4( \nxx - yy - zz + ww, xy2 + zw2, xz2 - yw2, 0, \nxy2 - zw2, -xx + yy - zz + ww, yz2 + xw2, 0, \nxz2 + yw2, yz2 - xw2, -xx - yy + zz + ww, 0, \ntranslation.x, translation.y, translation.z, 1 \n); \nreturn matrix; \n} \nvoid main(void){ \ne_boneIndex = attribute_boneIndex; \ne_boneWeight = attribute_boneWeight; \nvec4 temp_position = vec4(attribute_position, 1.0) ; \nmat4 m0 = buildMat4(int(e_boneIndex.x)); \nmat4 m1 = buildMat4(int(e_boneIndex.y)); \nmat4 m2 = buildMat4(int(e_boneIndex.z)); \nmat4 m3 = buildMat4(int(e_boneIndex.w)); \noutPosition = m0 * temp_position * e_boneWeight.x; \noutPosition += m1 * temp_position * e_boneWeight.y; \noutPosition += m2 * temp_position * e_boneWeight.z; \noutPosition += m3 * temp_position * e_boneWeight.w; \ne_position = outPosition.xyz; \nmat4 mvMatrix = mat4(uniform_ViewMatrix * uniform_ModelMatrix); \nvarying_color = attribute_color; \nvarying_uv0 = attribute_uv0 ; \nvarying_pos = uniform_ProjectionMatrix * uniform_ViewMatrix * uniform_ModelMatrix * vec4(e_position, 1.0); \ngl_Position = varying_pos; \n} \n",shadowPass_vs:"attribute vec3 attribute_position; \nattribute vec4 attribute_color; \nattribute vec2 attribute_uv0; \nuniform mat4 uniform_ModelMatrix ; \nuniform mat4 uniform_ViewMatrix ; \nuniform mat4 uniform_ProjectionMatrix ; \nvarying vec2 varying_uv0; \nvarying vec4 varying_color; \nvarying vec4 varying_pos; \nvoid main(void){ \nmat4 mvMatrix = mat4(uniform_ViewMatrix * uniform_ModelMatrix); \nvarying_color = attribute_color; \nvarying_uv0 = attribute_uv0 ; \nvarying_pos = uniform_ProjectionMatrix * uniform_ViewMatrix * uniform_ModelMatrix * vec4(attribute_position, 1.0); \ngl_Position = varying_pos; \n} \n",skeletonShadowPass_vs:"attribute vec4 attribute_boneIndex; \nattribute vec4 attribute_boneWeight; \nattribute vec4 attribute_color; \nvec4 e_boneIndex = vec4(0.0, 0.0, 0.0, 0.0); \nvec4 e_boneWeight = vec4(0.0, 0.0, 0.0, 0.0); \nconst int bonesNumber = 0; \nuniform vec4 uniform_PoseMatrix[bonesNumber]; \nmat4 buildMat4(int index){ \nvec4 quat = uniform_PoseMatrix[index * 2 + 0]; \nvec4 translation = uniform_PoseMatrix[index * 2 + 1]; \nfloat xx = quat.x * quat.x; \nfloat xy = quat.x * quat.y; \nfloat xz = quat.x * quat.z; \nfloat xw = quat.x * quat.w; \nfloat yy = quat.y * quat.y; \nfloat yz = quat.y * quat.z; \nfloat yw = quat.y * quat.w; \nfloat zz = quat.z * quat.z; \nfloat zw = quat.z * quat.w; \nreturn mat4( \n1.0 - 2.0 * (yy + zz),		2.0 * (xy + zw),		2.0 * (xz - yw),		0, \n2.0 * (xy - zw),				1.0 - 2.0 * (xx + zz),	2.0 * (yz + xw),		0, \n2.0 * (xz + yw),				2.0 * (yz - xw),		1.0 - 2.0 * (xx + yy),	0, \ntranslation.x,				translation.y,			translation.z,			1 \n); \n} \nvoid main(void){ \nvarying_color = attribute_color; \ne_boneIndex = attribute_boneIndex; \ne_boneWeight = attribute_boneWeight; \nvec4 temp_position = vec4(attribute_position, 1.0) ; \nmat4 m0 = buildMat4(int(e_boneIndex.x)); \nmat4 m1 = buildMat4(int(e_boneIndex.y)); \nmat4 m2 = buildMat4(int(e_boneIndex.z)); \nmat4 m3 = buildMat4(int(e_boneIndex.w)); \noutPosition = m0 * temp_position * e_boneWeight.x; \noutPosition += m1 * temp_position * e_boneWeight.y; \noutPosition += m2 * temp_position * e_boneWeight.z; \noutPosition += m3 * temp_position * e_boneWeight.w; \ne_position = outPosition.xyz; \noutPosition = uniform_modelMatrix * uniform_viewMatrix *  outPosition; \n} \n",skeleton_vs:"attribute vec4 attribute_boneIndex; \nattribute vec4 attribute_boneWeight; \nattribute vec3 attribute_normal; \nattribute vec4 attribute_color; \nvec4 e_boneIndex = vec4(0.0, 0.0, 0.0, 0.0); \nvec4 e_boneWeight = vec4(0.0, 0.0, 0.0, 0.0); \nconst int bonesNumber = 0; \nuniform vec4 uniform_PoseMatrix[bonesNumber]; \nvarying vec4 varying_mvPose  ; \nmat4 buildMat4(int index){ \nvec4 quat = uniform_PoseMatrix[index * 2 + 0]; \nvec4 translation = uniform_PoseMatrix[index * 2 + 1]; \nfloat xy2 = 2.0 * quat.x * quat.y; \nfloat xz2 = 2.0 * quat.x * quat.z; \nfloat xw2 = 2.0 * quat.x * quat.w; \nfloat yz2 = 2.0 * quat.y * quat.z; \nfloat yw2 = 2.0 * quat.y * quat.w; \nfloat zw2 = 2.0 * quat.z * quat.w; \nfloat xx = quat.x * quat.x; \nfloat yy = quat.y * quat.y; \nfloat zz = quat.z * quat.z; \nfloat ww = quat.w * quat.w; \nmat4 matrix = mat4( \nxx - yy - zz + ww, xy2 + zw2, xz2 - yw2, 0, \nxy2 - zw2, -xx + yy - zz + ww, yz2 + xw2, 0, \nxz2 + yw2, yz2 - xw2, -xx - yy + zz + ww, 0, \ntranslation.x, translation.y, translation.z, 1 \n); \nreturn matrix; \n} \nvoid main(void){ \ne_boneIndex = attribute_boneIndex; \ne_boneWeight = attribute_boneWeight; \nvec4 temp_position = vec4(attribute_position, 1.0) ; \nvec4 temp_normal = vec4(attribute_normal, 0.0) ; \nmat4 m0 = buildMat4(int(e_boneIndex.x)); \nmat4 m1 = buildMat4(int(e_boneIndex.y)); \nmat4 m2 = buildMat4(int(e_boneIndex.z)); \nmat4 m3 = buildMat4(int(e_boneIndex.w)); \noutPosition = m0 * temp_position * e_boneWeight.x; \noutPosition += m1 * temp_position * e_boneWeight.y; \noutPosition += m2 * temp_position * e_boneWeight.z; \noutPosition += m3 * temp_position * e_boneWeight.w; \ne_position = outPosition.xyz; \nvec4 temp_n ; \ntemp_n = m0 * temp_normal * e_boneWeight.x; \ntemp_n += m1 * temp_normal * e_boneWeight.y; \ntemp_n += m2 * temp_normal * e_boneWeight.z; \ntemp_n += m3 * temp_normal * e_boneWeight.w; \nmat4 mvMatrix = mat4(uniform_ViewMatrix * uniform_ModelMatrix); \nvarying_mvPose = mvMatrix * vec4( e_position , 1.0 ) ; \nmat4 normalMatrix = inverse(mvMatrix) ; \nnormalMatrix = transpose(normalMatrix); \nvarying_eyeNormal = mat3(normalMatrix) * -attribute_normal ; \noutPosition.xyzw = varying_mvPose.xyzw ; \nvarying_color = attribute_color; \n} \n",specularMap_fragment:"uniform sampler2D specularTexture; \nvoid main(void){ \nspecularColor.xyz *= texture2D( specularTexture , uv_0 ).xyz ; \n} \n",tangent_vs:"attribute vec3 attribute_tangent; \nvoid main(void){ \n}  \n",terrainRGBA_fragment:"uniform sampler2D blendMaskTexture ; \nuniform sampler2D splat_0Tex ; \nuniform sampler2D splat_1Tex ; \nuniform sampler2D splat_2Tex ; \nuniform sampler2D splat_3Tex ; \nuniform float uvs[8]; \nvoid main() { \nvec4 splat_control = texture2D ( blendMaskTexture , varying_uv0 ); \nvec4 cc = vec4(0.0,0.0,0.0,1.0); \nvec2 uv = varying_uv0 ; \ncc.xyz = splat_control.x * texture2D (splat_0Tex, uv * vec2(uvs[0],uvs[1])).xyz ; \ncc.xyz += splat_control.y * texture2D (splat_1Tex, uv * vec2(uvs[2],uvs[3]) ).xyz; \ncc.xyz += splat_control.z * vec4(texture2D (splat_2Tex, uv* vec2(uvs[4],uvs[5]))).xyz; \ncc.xyz += (1.0-length(splat_control.xyz)) * vec4(texture2D (splat_3Tex, uv* vec2(uvs[6],uvs[7]))).xyz; \ndiffuseColor.xyz = cc.xyz ; \n} \n",uvRoll_fs:"uniform float uvRoll[2] ; \nuniform sampler2D diffuseTexture; \nvec4 diffuseColor ; \nvoid main() { \nuv_0.xy += vec2(uvRoll[0],uvRoll[1]); \ndiffuseColor = texture2D(diffuseTexture , uv_0 ); \n} \n",uvSpriteSheet_fs:"uniform float uvSpriteSheet[4] ; \nuniform sampler2D diffuseTexture; \nvec4 diffuseColor ; \nvoid main() { \nuv_0.xy *= vec2(uvSpriteSheet[2],uvSpriteSheet[3]); \nuv_0.xy += vec2(uvSpriteSheet[0],uvSpriteSheet[1]); \ndiffuseColor = texture2D(diffuseTexture , uv_0 ); \n} \n",uvStreamerRoll_fs:"uniform float uvRoll[3] ; \nuniform sampler2D diffuseTexture; \nuniform sampler2D streamerTexture; \nvec4 diffuseColor ; \nvoid main() { \ndiffuseColor = texture2D(diffuseTexture , varying_uv0 ); \nvec2 rollUV = varying_uv0 + vec2(uvRoll[0],uvRoll[1]) + vec2(normal.xz) * 0.5 ; \ndiffuseColor.xyz += texture2D(streamerTexture , rollUV ).xyz * uvRoll[2] ; \n} \n",varyingViewDir_vs:"varying vec3 varying_ViewDir; \nuniform vec3 uniform_eyepos; \nvoid main(void){ \nvarying_ViewDir = (uniform_eyepos.xyz - e_position) ; \n} \n",vertexPos_vs:"uniform mat4 uniform_modelMatrix; \nuniform mat4 uniform_viewMatrix; \nvarying vec4 varying_mvPose; \nvoid main() { \nvarying_mvPose = uniform_modelMatrix * uniform_viewMatrix * vec4(e_position, 1.0) ; \n} \n                       \n",waterDiffuse_fs:"uniform sampler2D diffuseTexture; \nvec4 diffuseColor ; \nvoid main() { \ndiffuseColor.xyz *= diffuseColor.w ; \n} \n",waterNormal_fs:"uniform vec2 waterNormalData[4]; \nuniform float time ; \nuniform sampler2D normalTextureA; \nuniform sampler2D normalTextureB; \nvarying vec2 varying_uv0        ; \nmat3 TBN ; \nmat3 cotangentFrame(vec3 N, vec3 p, vec2 uv) { \nvec3 dp1 = dFdx(p); \nvec3 dp2 = dFdy(p); \nvec2 duv1 = dFdx(uv); \nvec2 duv2 = dFdy(uv); \nvec3 dp2perp = cross(dp2, N); \nvec3 dp1perp = cross(N, dp1); \nvec3 T = dp2perp * duv1.x + dp1perp * duv2.x; \nvec3 B = dp2perp * duv1.y + dp1perp * duv2.y; \nfloat invmax = 1.0 / sqrt(max(dot(T,T), dot(B,B))); \nreturn mat3(T * invmax, B * invmax, N); \n} \nvec3 tbn(vec3 map, vec3 N, vec3 V, vec2 texcoord) { \nmat3 TBN = cotangentFrame(N, -V, texcoord); \nreturn normalize(TBN * map); \n} \nvoid main(void){ \nfloat tempTime = mod(time,100000.0); \nvec2 uvA = uv_0 * waterNormalData[3].x + waterNormalData[0] * tempTime ; \nvec2 uvB = uv_0 * waterNormalData[3].y + waterNormalData[1] * tempTime  ; \nnormal = flatNormals(varying_mvPose.xyz) ; \nTBN = cotangentFrame(normal, -varying_mvPose.xyz, uv_0 ); \nvec3 bump1 = texture2D( normalTextureA, uvA ).rgb; \nvec3 bump2 = texture2D( normalTextureB, uvB ).rgb; \nvec3 bump = bump1 + bump2 - 1.0; \nnormal = normalize(TBN * bump) ; \nnormal.y *= -1.0; \n}  \n",wave_fs:"uniform sampler2D diffuseTexture; \nuniform vec3 uniform_eyepos; \nuniform vec4 waveFSData[2]; \nvarying vec4 varying_mvPose; \nvec4 diffuseColor ; \nvoid main(void){ \nvec3 viewDir = normalize(varying_mvPose.xyz/varying_mvPose.w); \ndiffuseColor.xyz = vec3(1.0,1.0,1.0) ; \nvec3 shallowWaterColor = waveFSData[0].xyz * waveFSData[0].w ; \nvec3 deepWaterColor = waveFSData[1].xyz * waveFSData[1].w; \nfloat facing = clamp(dot( -normalize(viewDir),normal),0.0,1.0); \nvec3 waterColor = mix(shallowWaterColor,deepWaterColor,facing); \ndiffuseColor.xyz *= waterColor ; \n}  \n",wave_vs:"#define VERTEX_TEXTURES \nattribute vec3 attribute_normal; \nattribute vec4 attribute_color; \nuniform mat4 uniform_modelMatrix; \nuniform mat4 uniform_viewMatrix; \nvarying vec4 varying_mvPose; \nuniform vec3 waveVSData[4]; \nuniform float time ; \nstruct wave{ \nvec3 wave_xyz_intensity_0 ; \nvec3 wave_xyz_intensity_1 ; \nvec3 wave_xyz_speed_0 ; \nvec3 wave_xyz_speed_1 ; \n}; \nconst float pi = 3.14 ; \nvec3 calcWave2( float t , vec3 x, float amplitude, float waveLength ,float angularVelocity ,  vec3 waveDir ){ \nangularVelocity = angularVelocity * 0.1; \nvec3 waveVector = waveDir ; \nfloat waveNumber = pi / waveLength; \nwaveVector *= waveNumber ; \nvec3 temp ; \nfloat kDotX0SubWt = dot(waveVector , x ) - angularVelocity * t  * 0.001; \nfloat A = amplitude * sin(kDotX0SubWt) ; \ntemp.xz = waveDir.xz * A ; \ntemp.y += amplitude * cos(kDotX0SubWt); \ntemp = x - temp ; \nreturn temp ; \n} \nvoid main(void){ \nwave wa ; \nwa.wave_xyz_intensity_0 = vec3(waveVSData[0]) ; \nwa.wave_xyz_intensity_1 = vec3(waveVSData[1]) ; \nwa.wave_xyz_speed_0 = vec3(waveVSData[2]) ; \nwa.wave_xyz_speed_1 = vec3(waveVSData[3]) ; \nfloat tempTime = mod( time , 1000000.0 ); \nvec3 newPose1 = calcWave2(tempTime,e_position,40.0, 20.0, 10.0,vec3(1.0,0.0,1.0)); \nnewPose1 += calcWave2(tempTime,e_position,20.0, 10.0, 10.0,vec3(1.0,0.0,-0.5)); \nnewPose1 += calcWave2(tempTime,e_position,1.0, 1.0, 10.0,vec3(1.0,0.0,-1.5)); \ne_position = newPose1 ; \nmat4 mvMatrix = mat4(uniform_ViewMatrix * uniform_ModelMatrix); \nvarying_mvPose = mvMatrix * vec4( e_position , 1.0 )  ; \nmat4 normalMatrix = inverse(mvMatrix) ; \nnormalMatrix = transpose(normalMatrix); \nvarying_eyeNormal = mat3(normalMatrix) * -attribute_normal ; \noutPosition = varying_mvPose ; \nvarying_color = attribute_color; \n}  \n"},t
}();t.ShaderLib=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.register=function(t){this.context=t},e.getGPUShader=function(e,i,r){var a=this.vsShaderHashMap.getValue(i);return a||(a=this.fsShaderHashMap.getValue(i)),a||(e==t.Shader.vertex?(a=this.context.creatVertexShader(r),a.id=i,this.vsShaderHashMap.add(i,a)):e==t.Shader.fragment&&(a=this.context.creatFragmentShader(r),a.id=i,this.fsShaderHashMap.add(i,a))),a},e.getProgram=function(t,e){var i,r=this.vsShaderHashMap.getValue(t),a=this.fsShaderHashMap.getValue(e),n=r.id+"_"+a.id;return this.programlib.isHas(n)?i=this.programlib.getValue(n):(i=this.registerProgram(r,a),this.programlib.add(n,i)),this.programlib.getValue(n)},e.unRegisterShader=function(){},e.registerProgram=function(t,e){var i=this.context.creatProgram(t,e);return i},e.unRegisterProgram=function(){},e.programlib=new t.HashMap,e.vsShaderHashMap=new t.HashMap,e.fsShaderHashMap=new t.HashMap,e}();t.ShaderPool=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(){function t(){this.name="",this.source="",this.funcNames=new Array,this.funcDict={},this.structDict={},this.structNames=new Array,this.attributeList=new Array,this.varyingList=new Array,this.uniformList=new Array,this.constList=new Array,this.tempList=new Array,this.sampler2DList=new Array,this.sampler3DList=new Array,this.extensionList=new Array,this.defineList=new Array}return t.prototype.addVar=function(t){"attribute"==t.key?this.attributeList.push(t):"varying"==t.key?this.varyingList.push(t):"uniform"==t.key?this.uniformList.push(t):"const"==t.key?this.constList.push(t):"sampler2D"==t.key?this.sampler2DList.push(t):"samplerCube"==t.key?this.sampler3DList.push(t):"#extension"==t.key?this.extensionList.push(t):"#define"==t.key?this.defineList.push(t):this.tempList.push(t)},t.prototype.addFunc=function(t,e){if(this.funcDict[t]){var i=this.mergeMainFunc(this.funcDict[t],e);this.funcDict[t]=i}else this.funcDict[t]=e,this.funcNames.push(t);if(this.funcDict.main){var r=this.funcNames.indexOf("main");this.funcNames.splice(r,1),this.funcNames.push("main")}},t.prototype.addStruct=function(t,e){this.structDict[t]?console.log("<"+t+">struct"):(this.structDict[t]=e,this.structNames.push(t))},t.prototype.addContent=function(t){for(var e=0;e<t.structNames.length;++e)this.addStruct(t.structNames[e],t.structDict[t.structNames[e]]);for(var e=0;e<t.funcNames.length;++e)this.addFunc(t.funcNames[e],t.funcDict[t.funcNames[e]]);for(var e=0;e<t.attributeList.length;++e){for(var i=!0,r=0;r<this.attributeList.length;++r)if(t.attributeList[e].name==this.attributeList[r].name){t.attributeList[e].valueType!=this.attributeList[r].valueType||t.attributeList[e].key!=this.attributeList[r].key,i=!1;break}i&&this.attributeList.push(t.attributeList[e].clone())}for(var e=0;e<t.varyingList.length;++e){for(var i=!0,r=0;r<this.varyingList.length;++r)if(t.varyingList[e].name==this.varyingList[r].name){t.varyingList[e].valueType!=this.varyingList[r].valueType||t.varyingList[e].key!=this.varyingList[r].key,i=!1;break}i&&this.varyingList.push(t.varyingList[e].clone())}for(var e=0;e<t.uniformList.length;++e){for(var i=!0,r=0;r<this.uniformList.length;++r)if(t.uniformList[e].name==this.uniformList[r].name){t.uniformList[e].valueType!=this.uniformList[r].valueType||t.uniformList[e].key!=this.uniformList[r].key,i=!1;break}i&&this.uniformList.push(t.uniformList[e].clone())}for(var e=0;e<t.constList.length;++e){for(var i=!0,r=0;r<this.constList.length;++r)if(t.constList[e].name==this.constList[r].name){t.constList[e].valueType!=this.constList[r].valueType||t.constList[e].key!=this.constList[r].key,i=!1;break}i&&this.constList.push(t.constList[e].clone())}for(var e=0;e<t.tempList.length;++e){for(var i=!0,r=0;r<this.tempList.length;++r)if(t.tempList[e].name==this.tempList[r].name){t.tempList[e].valueType!=this.tempList[r].valueType||t.tempList[e].key!=this.tempList[r].key,i=!1;break}i&&this.tempList.push(t.tempList[e].clone())}for(var e=0;e<t.sampler2DList.length;++e){for(var i=!0,r=0;r<this.sampler2DList.length;++r)if(t.sampler2DList[e].name==this.sampler2DList[r].name){t.sampler2DList[e].valueType!=this.sampler2DList[r].valueType||t.sampler2DList[e].key!=this.sampler2DList[r].key,i=!1;break}i&&this.sampler2DList.push(t.sampler2DList[e].clone())}for(var e=0;e<t.sampler3DList.length;++e){for(var i=!0,r=0;r<this.sampler3DList.length;++r)if(t.sampler3DList[e].name==this.sampler3DList[r].name){t.sampler2DList[e].valueType!=this.sampler3DList[r].valueType||t.sampler3DList[e].key!=this.sampler3DList[r].key,i=!1;break}i&&this.sampler3DList.push(t.sampler3DList[e].clone())}for(var e=0;e<t.extensionList.length;++e){for(var i=!0,r=0;r<this.extensionList.length;++r)if(t.extensionList[e].name==this.extensionList[r].name){i=!1;break}i&&this.extensionList.push(t.extensionList[e].clone())}for(var e=0;e<t.defineList.length;++e){for(var i=!0,r=0;r<this.defineList.length;++r)if(t.defineList[e].name==this.defineList[r].name){i=!1;break}i&&this.defineList.push(t.defineList[e].clone())}},t.prototype.mergeMainFunc=function(t,e){var i=t,r="",a=e.indexOf("{"),n=e.lastIndexOf("}");a++,r=e.slice(a,n),a=i.lastIndexOf("}");var o=i.substr(0,a),s=i.substr(a,i.length-a);i=o,i+=r;var h="";return i+=h,i+=s},t.prototype.clone=function(){var e=new t;e.name=this.name,e.source=this.source;for(var i=0;i<this.funcNames.length;++i)e.funcNames.push(this.funcNames[i]);for(var r in this.funcDict)e.funcDict[r]=this.funcDict[r];for(var i=0;i<this.structNames.length;++i)e.structNames.push(this.structNames[i]);for(var r in this.structDict)e.structDict[r]=this.structDict[r];for(var i=0;i<this.attributeList.length;++i)e.attributeList.push(this.attributeList[i].clone());for(var i=0;i<this.varyingList.length;++i)e.varyingList.push(this.varyingList[i].clone());for(var i=0;i<this.uniformList.length;++i)e.uniformList.push(this.uniformList[i].clone());for(var i=0;i<this.constList.length;++i)e.constList.push(this.constList[i].clone());for(var i=0;i<this.tempList.length;++i)e.tempList.push(this.tempList[i].clone());for(var i=0;i<this.sampler2DList.length;++i)e.sampler2DList.push(this.sampler2DList[i].clone());for(var i=0;i<this.sampler3DList.length;++i)e.sampler3DList.push(this.sampler3DList[i].clone());for(var i=0;i<this.attributeList.length;++i)e.attributeList.push(this.attributeList[i].clone());for(var i=0;i<this.extensionList.length;++i)e.extensionList.push(this.extensionList[i].clone());for(var i=0;i<this.defineList.length;++i)e.defineList.push(this.defineList[i].clone());return e},t}();t.ShaderContent=e}(e=t.GLSL||(t.GLSL={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this._shaderContentDict=[],this.vs_begin="##define vs begin##",this.vs_end="##define vs end##",this.fs_begin="##define fs begin##",this.fs_end="##define fs end##"}return Object.defineProperty(e,"instance",{get:function(){return this._instance||(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.load=function(){var e=[],i=[];for(var r in t.ShaderLib.lib){var a=t.ShaderLib.lib[r].indexOf(this.vs_begin),n=t.ShaderLib.lib[r].indexOf(this.vs_end),o=!1;-1!=a&&(o=!0,a+=this.vs_begin.length,e.push(r),i[r+"vs"]=t.ShaderLib.lib[r].substr(a,n-a)),a=t.ShaderLib.lib[r].indexOf(this.fs_begin),n=t.ShaderLib.lib[r].indexOf(this.fs_end),-1!=a&&(a+=this.fs_begin.length,o&&e.push(r),i[r+"fs"]=t.ShaderLib.lib[r].substr(a,n-a))}for(var r in e)delete t.ShaderLib.lib[e[r]];for(var r in i)t.ShaderLib.lib[r]=i[r];for(var r in t.ShaderLib.lib){var s=this.readShader(t.ShaderLib.lib[r]);this._shaderContentDict[r]=s,s.name=r}},e.prototype.readShader=function(e){for(var i=new t.GLSL.ShaderContent,r=t.StringUtil.processShaderFile(e),a=t.StringUtil.parseContent(r),n=a.concat();n.length>0;){var o=n[0];n.shift();var s=t.StringUtil.getLineType(o),h=-1;if(h=s.indexOf("struct"),-1==h)if(h=s.indexOf("function"),-1==h)if(h=s.indexOf("unknown"),-1==h);else{var l=t.StringUtil.parseLines(o),u=t.StringUtil.getVarKey(l),c=t.StringUtil.getVarType(l);if("sampler2D"==c){var d=t.StringUtil.getSampler2D(o);d&&i.addVar(d)}else if("samplerCube"==c){var p=t.StringUtil.getSampler3D(o);p&&i.addVar(p)}else if("attribute"==u){var f=t.StringUtil.getAttribute(o);f&&i.addVar(f)}else if("varying"==u){var _=t.StringUtil.getVarying(o);_&&i.addVar(_)}else if("uniform"==u){var m=t.StringUtil.getUniform(o);m&&i.addVar(m)}else if("const"==u){var g=t.StringUtil.getConst(o);g&&i.addVar(g)}else if("#extension"==u){var v=t.StringUtil.getExtension(o);v&&i.addVar(v)}else if("#define"==u){var y=t.StringUtil.getDefine(o);y&&i.addVar(y)}else i.addVar(t.StringUtil.getTemper(o))}else{var l=s.split(" "),x=o;i.addFunc(l[1],x)}else{var l=s.split(" "),b=o;i.addStruct(l[1],b),t.StringUtil.processStruct(l[1],b,i)}}return i},e.prototype.fillShaderContent=function(i,r,a){var n,o=0,s="";for(o=0;o<r.length;++o)""!=s&&(s+="/"),s+=r[o];if(s+="/d"+a.maxDirectLight,s+="/s"+a.maxSpotLight,s+="/p"+a.maxPointLight,s+="/b"+a.maxBone,this._shaderContentDict[s])n=this._shaderContentDict[s].clone();else for(n=new t.GLSL.ShaderContent,n.name=s,o=0;o<r.length;++o){var h=this._shaderContentDict[r[o]];n.addContent(h)}for(o=0;o<n.attributeList.length;o++)s=n.attributeList[o].varName,a[s]=n.attributeList[o];for(o=0;o<n.varyingList.length;o++)s=n.varyingList[o].varName,a[s]||(a[s]=n.varyingList[o]);for(o=0;o<n.tempList.length;o++)s=n.tempList[o].varName,a[s]=n.tempList[o];for(o=0;o<n.uniformList.length;o++)s=n.uniformList[o].varName,a[s]=n.uniformList[o];var l;for(o=0;o<n.constList.length;o++)switch(s=n.constList[o].varName,l=n.constList[o],a[s]=l,s){case"max_directLight":l.value=a.maxDirectLight;break;case"max_spotLight":l.value=a.maxSpotLight;break;case"max_pointLight":l.value=a.maxPointLight;break;case"bonesNumber":i.maxBone=a.maxBone,l.value=a.maxBone}for(o=0;o<n.sampler2DList.length;o++){var u=n.sampler2DList[o];u.index=o,a.sampler2DList.push(u),u.activeTextureIndex=e.getTexture2DIndex(o)}for(o=0;o<n.sampler3DList.length;o++){var c=n.sampler3DList[o];c.activeTextureIndex=e.getTexture2DIndex(n.sampler2DList.length+o),c.index=n.sampler2DList.length+o,a.sampler3DList.push(c)}return this.synthesisShader(n,i),t.ShaderPool.getGPUShader(i.shaderType,n.name,n.source)},e.prototype.synthesisShader=function(t){var i,r="";for(i=0;i<t.extensionList.length;i++)r+=e.connectExtension(t.extensionList[i]);for(r+="precision highp float;            	\n",i=0;i<t.defineList.length;i++)r+=e.connectDefine(t.defineList[i]);for(i=0;i<t.attributeList.length;i++)r+=e.connectAtt(t.attributeList[i]);for(i=0;i<t.structNames.length;i++)r+=e.connectStruct(t.structDict[t.structNames[i]]);for(i=0;i<t.varyingList.length;i++)r+=e.connectVarying(t.varyingList[i]);for(i=0;i<t.tempList.length;i++)r+=e.connectTemp(t.tempList[i]);for(i=0;i<t.constList.length;i++)r+=e.connectConst(t.constList[i]);for(i=0;i<t.uniformList.length;i++)r+=e.connectUniform(t.uniformList[i]);for(i=0;i<t.sampler2DList.length;i++){var a=t.sampler2DList[i];r+=e.connectSampler(a)}for(i=0;i<t.sampler3DList.length;i++){var n=t.sampler3DList[i];r+=e.connectSampler3D(n)}for(i=0;i<t.funcNames.length;i++)r+=t.funcDict[t.funcNames[i]];t.source=r},e.connectAtt=function(t){return"attribute "+t.valueType+" "+t.name+"; \r\n"},e.connectTemp=function(t){return""!=t.value?t.valueType+" "+t.name+" = "+t.value+"; \r\n":t.valueType+" "+t.name+"; \r\n"},e.connectStruct=function(t){return t+" \r\n"},e.connectConst=function(t){return"const "+t.valueType+" "+t.name+" = "+t.value+"; \r\n"},e.connectVarying=function(t){return"varying "+t.valueType+" "+t.name+"; \r\n"},e.connectUniform=function(t){return"uniform "+t.valueType+" "+t.name+"; \r\n"},e.connectSampler=function(t){return"uniform sampler2D "+t.name+"; \r\n"},e.connectSampler3D=function(t){return"uniform samplerCube "+t.name+"; \r\n"},e.connectExtension=function(t){return"#extension "+t.name+":"+t.value+"\r\n"},e.connectDefine=function(t){return t.key+" "+t.name+" "+t.value+"\r\n"},e.getTexture2DIndex=function(e){switch(e){case 0:return t.ContextSamplerType.TEXTURE_0;case 1:return t.ContextSamplerType.TEXTURE_1;case 2:return t.ContextSamplerType.TEXTURE_2;case 3:return t.ContextSamplerType.TEXTURE_3;case 4:return t.ContextSamplerType.TEXTURE_4;case 5:return t.ContextSamplerType.TEXTURE_5;case 6:return t.ContextSamplerType.TEXTURE_6;case 7:return t.ContextSamplerType.TEXTURE_7;case 8:return t.ContextSamplerType.TEXTURE_8}throw new Error("texture not big then 8")},e._shaderLibs={},e._methodLibs={},e}();t.ShaderUtil=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this._boundBox=new t.BoundBox,this.shadowCamera=new t.Camera3D(t.CameraType.orthogonal),this.shadowRender=new t.MultiRender(t.PassType.shadowPass),this.shadowRender.setRenderToTexture(e.textureSizeWidth,e.textureSizeHeight,t.FrameBufferFormat.UNSIGNED_BYTE_RGBA),this.castShadowLight(new t.DirectLight(new t.Vector3D(0,-1,1)));var i=t.MathUtil.CALCULATION_VECTOR3D;i.copyFrom(this.directLight.dir),i.negate(),i.scaleBy(1e3),this.shadowCamera.globalPosition=i}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e.prototype.setTextureSize=function(i,r){e.textureSizeWidth=i,e.textureSizeHeight=r,this.shadowRender.setRenderToTexture(e.textureSizeWidth,e.textureSizeHeight,t.FrameBufferFormat.UNSIGNED_BYTE_RGBA)},e.prototype.castShadowLight=function(t){this.directLight=t,this.shadowCamera.updateViewport(0,0,2048,2048),this.shadowCamera.near=1,this.shadowCamera.far=3e3,t.addChild(this.shadowCamera)},e.prototype.update=function(e,i,r,a,n){this.calculateBoundBox(e),t.Egret3DCanvas.context3DProxy.clearColor(1,1,1,1),t.Egret3DCanvas.context3DProxy.clear(t.Context3DProxy.gl.COLOR_BUFFER_BIT|t.Context3DProxy.gl.DEPTH_BUFFER_BIT),this.shadowRender.draw(r,a,t.Egret3DCanvas.context3DProxy,e,this.shadowCamera,n)},e.prototype.calculateBoundBox=function(e){this._boundBox.min.copyFrom(new t.Vector3D(99999999,99999999,99999999)),this._boundBox.max.copyFrom(new t.Vector3D(-99999999,-99999999,-99999999));for(var i=0;i<e.renderList.length;i++){var r=e.renderList[i];if(r.material&&r.material.castShadow){var a=r.bound;this._boundBox.max.x<a.max.x+r.globalX&&(this._boundBox.max.x=a.max.x+r.globalX),this._boundBox.max.y<a.max.y+r.globalY&&(this._boundBox.max.y=a.max.y+r.globalY),this._boundBox.max.z<a.max.z+r.globalZ&&(this._boundBox.max.z=a.max.z+r.globalZ),this._boundBox.min.x>a.min.x+r.globalX&&(this._boundBox.min.x=a.min.x+r.globalX),this._boundBox.min.y>a.min.y+r.globalY&&(this._boundBox.min.y=a.min.y+r.globalY),this._boundBox.min.z>a.min.z+r.globalZ&&(this._boundBox.min.z=a.min.z+r.globalZ)}}this._boundBox.fillBox(this._boundBox.min,this._boundBox.max);var n=t.MathUtil.CALCULATION_VECTOR3D;n.copyFrom(this.directLight.dir),n.negate(),n.scaleBy(this._boundBox.radius),n.add(this._boundBox.center,n),this.shadowCamera.globalPosition=n,this.shadowCamera.updateViewport(0,0,2*this._boundBox.radius,2*this._boundBox.radius),this.shadowCamera.far=2*this._boundBox.radius},e.enableShadow=!1,e.textureSizeWidth=4096,e.textureSizeHeight=4096,e}();t.ShadowCast=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(t){function e(){t.apply(this,arguments),this.vertex_ShaderName={},this.fragment_ShaderName={},this.attributes=new Array}return __extends(e,t),e.prototype.build=function(){},e.prototype.afterBuild=function(){},e.prototype.initNode=function(){},e.prototype.update=function(){},e.prototype.activeState=function(){},e.prototype.upload=function(){},e.prototype.dispose=function(){},e}(t.EventDispatcher);t.AnimationNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){}return t}();t.AnimationCurve=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this._timeEvent=new t.Event3D,this._times=new Array,this._processTimes=new Array,this._timer=0,this._start=!1}return __extends(i,e),i.prototype.start=function(){this._timer=0,this._start=!0,this._processTimes.length=0;for(var t=0;t<this._times.length;++t)this._processTimes[t]=this._times[t]},i.prototype.addTimerAxis=function(t){this._times.push(t)},i.prototype.clearTimerAxis=function(){this._times.length=0,this._processTimes.length=0},i.prototype.reset=function(){this._processTimes.length=0,this._timer=0,this._start=!1;for(var t=0;t<this._times.length;++t)this._processTimes[t]=this._times[t]},i.prototype.update=function(t){if(this._start){this._timer+=t,console.log(this._timer+"update");for(var e=0;e<this._processTimes.length;++e)if(this._timer>=this._processTimes[e]){this._timeEvent.eventType=i.TIME_EVENT,this._timeEvent.data=this._processTimes[e],this.dispatchEvent(this._timeEvent),this._processTimes.splice(e,1);break}}},i.TIME_EVENT="TimeEvent",i}(t.EventDispatcher);t.TimerAxis=e}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t.Line=0]="Line",t[t.BesselCurve=1]="BesselCurve"}(t.CurveType||(t.CurveType={}));var e=t.CurveType,i=function(){function i(){this.type=e.Line,this.start=new t.Point,this.end=new t.Point,this.c1=new t.Point,this.c2=new t.Point,this.cache=null,this.useCache=!1}return i.prototype.calculateValue=function(t){if(t<this.start.x||t>this.end.x)return 0;if(this.useCache)return this.cache[Math.floor(t-this.start.x)];switch(this.type){case e.Line:return this.valueFromLine(t);case e.BesselCurve:return this.valueFromBesselCurve(t)}return 0},i.prototype.valueFromLine=function(t){var e=(t-this.start.x)/(this.end.x-this.start.x);return this.start.y+e*(this.end.y-this.start.y)},i.prototype.valueFromBesselCurve=function(t){var e=(t-this.start.x)/(this.end.x-this.start.x),i=1-e,r=i*i,a=r*i;return this.start.y*a+3*this.c1.y*e*r+3*this.c2.x*e*e*i+this.end.y*e*e*e},i.prototype.cacheCurveData=function(){this.cache=[];for(var t=this.start.x;t<this.end.x;t++)this.cache.push(this.calculateValue(t));this.useCache=!0},i}();t.AnimCurve=i}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function r(){e.call(this),this.speed=1,this.isLoop=!0,this._propertyArray=[],this._play=!1,this._timePosition=0,this._totalTime=0,this._changeFrameTime=0,this._oldFrameIndex=0,this._event3D=new t.Event3D}return __extends(r,e),r.prototype.IsExist=function(t){for(var e=0;e<this._propertyArray.length;e++)if(this._propertyArray[e].property==t)return!0;return!1},r.prototype.addAnimCurve=function(t,e){if(this.IsExist(t))return!1;if(null==e||e.length<=0)return!1;var r=new i;r.keyFrames=e,r.property=t,r.target=this._target,r.isLoop=!0,r.timePosition=0,this._propertyArray.push(r);for(var a=0;a<e.length;a++)e[a].end.x>this._totalTime&&(this._totalTime=e[a].end.x,e[a].cacheCurveData());this.updateBindData(r)},r.prototype.removeAnimCurve=function(t){for(var e=null,i=0;i<this._propertyArray.length;i++)if(this._propertyArray[i].property==t)return e=this._propertyArray[i],this._propertyArray.splice(i,1),e.keyFrames},r.prototype.setPropertyLoop=function(t,e){for(var i=null,r=0;r<this._propertyArray.length;r++)if(this._propertyArray[r].property==t){i=this._propertyArray[r],i.isLoop=e;break}},r.prototype.bindObject3D=function(t){this._target=t;for(var e=0;e<this._propertyArray.length;e++)this.updateBindData(this._propertyArray[e])},r.prototype.updateBindData=function(t){if(this._target){t.target=this._target;for(var e=t.property.split("."),i=0;i<e.length-1;i++)t.target=t.target[e[i]];t.name=e[e.length-1]}},r.prototype.play=function(){if(!this._play){this._play=!0,this._timePosition=0;for(var t=0;t<this._propertyArray.length;t++)this._propertyArray[t].timePosition=0}},r.prototype.stop=function(){this._play=!1},Object.defineProperty(r.prototype,"timePosition",{get:function(){return this._timePosition},set:function(e){if(e!=this._timePosition){var i=e-this._timePosition;if(this._timePosition=e,this.isLoop?(this._timePosition=e%this._totalTime,this._timePosition<0&&(this._timePosition+=this._totalTime)):this._timePosition<0?(this._timePosition=0,this._event3D.eventType=t.PropertyAnimEvent3D.EVENT_PLAY_COMPLETE,this._event3D.target=this,this.dispatchEvent(this._event3D),this.stop()):this._timePosition>this._totalTime&&(this._timePosition=this._totalTime,this._event3D.eventType=t.PropertyAnimEvent3D.EVENT_PLAY_COMPLETE,this._event3D.target=this,this.dispatchEvent(this._event3D),this.stop()),this._target)for(var r,a,n=0;n<this._propertyArray.length;n++){r=this._propertyArray[n],a=r.keyFrames;var o=r.timePosition+i;if(o!=r.timePosition){var s=a[a.length-1].end.x;if(r.timePosition=o,r.isLoop)r.timePosition=e%s,r.timePosition<0&&(r.timePosition+=s);else{if(r.timePosition<0){r.timePosition=0;continue}if(r.timePosition>s){r.timePosition=s;continue}}for(var h=0;h<a.length-1;h++)if(a[h].start.x<=r.timePosition&&a[h].end.x>r.timePosition){r.target[r.name]=a[h].calculateValue(r.timePosition);break}}}}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"totalTime",{get:function(){return this._totalTime},enumerable:!0,configurable:!0}),r.prototype.update=function(e){if(this._play){var i=this.timePosition;this.timePosition+=e*this.speed,this.timePosition<i&&(this._event3D.eventType=t.PropertyAnimEvent3D.EVENT_PLAY_COMPLETE,this._event3D.target=this,this.dispatchEvent(this._event3D))}},r.prototype.clone=function(){var t=new r;return t._propertyArray=this._propertyArray,t._totalTime=this._totalTime,t},r}(t.EventDispatcher);t.PropertyAnim=e;var i=function(){function t(){}return t}()}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e){this.parent=null,this.name=e,this.parentIndex=-1,this.scale=new t.Vector3D(1,1,1),this.orientation=new t.Quaternion,this.translation=new t.Vector3D,this.localMatrix=new t.Matrix4_4,this.worldMatrix=new t.Matrix4_4,this.worldMatrixValid=!1}return e.prototype.clone=function(){var t=new e(this.name);return t.parent=this.parent,t.parentIndex=this.parentIndex,t.scale.copyFrom(this.scale),t.orientation.copyFrom(this.orientation),t.translation.copyFrom(this.translation),t.localMatrix.copyFrom(this.localMatrix),t.worldMatrix.copyFrom(this.worldMatrix),t.worldMatrixValid=this.worldMatrixValid,t},e.prototype.buildLocalMatrix=function(e,i,r){this.scale.copyFrom(e),this.translation.copyFrom(r),i instanceof t.Vector3D?this.orientation.fromEulerAngles(i.x,i.y,i.z):this.orientation.copyFrom(i),this.localMatrix.makeTransform(this.translation,this.scale,this.orientation),this.worldMatrixValid=!1},e.prototype.buildInverseMatrix=function(e,i,r){this.inverseMatrix||(this.inverseMatrix=new t.Matrix4_4),i instanceof t.Vector3D?this.inverseMatrix.recompose([r,i,e]):this.inverseMatrix.makeTransform(r,e,i)},e}();t.Joint=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){this.joints=[]}return t.prototype.clone=function(){for(var e=new t,i=0;i<this.joints.length;i++)e.joints.push(this.joints[i].clone());return e},Object.defineProperty(t.prototype,"jointNum",{get:function(){return this.joints.length},enumerable:!0,configurable:!0}),t.prototype.findJoint=function(t){for(var e=0;e<this.joints.length;e++)if(this.joints[e].name==t)return this.joints[e];return null},t.prototype.findJointIndex=function(t){for(var e=0;e<this.joints.length;e++)if(this.joints[e].name==t)return e;return-1},t}();t.Skeleton=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.joints=[]}return e.prototype.clone=function(){var t=new e;t.frameTime=this.frameTime;for(var i=0;i<this.joints.length;i++)t.joints.push(this.joints[i].clone());return t},e.prototype.lerp=function(i,r,a){if(i.joints.length!=r.joints.length)throw Error("Bone number does not match!");if(this.joints.length<i.joints.length)for(var n=this.joints.length;n<=i.joints.length;++n)this.joints.push(new t.Joint(""));this.frameTime=(r.frameTime-i.frameTime)*a+i.frameTime;for(var n=0;n<i.joints.length;++n){var o=i.joints[n],s=r.joints[n],h=this.joints[n];if(h.name=o.name,h.parent=o.parent,h.parentIndex=o.parentIndex,h.scale.lerp(o.scale,s.scale,a),h.orientation.slerp(o.orientation,s.orientation,a),h.translation.slerp(o.translation,s.translation,a),h.buildLocalMatrix(h.scale,h.orientation,h.translation),h.worldMatrixValid=o.worldMatrixValid,h.worldMatrixValid){var l=o.worldMatrix.decompose(t.Orientation3D.QUATERNION,e._temp_matrixDecomposeA),u=s.worldMatrix.decompose(t.Orientation3D.QUATERNION,e._temp_matrixDecomposeB);e._temp_v0.slerp(l[0],u[0],a),e._temp_q1.x=l[1].x,e._temp_q1.y=l[1].y,e._temp_q1.z=l[1].z,e._temp_q1.w=l[1].w,e._temp_q2.x=u[1].x,e._temp_q2.y=u[1].y,e._temp_q2.z=u[1].z,e._temp_q2.w=u[1].w,e._temp_q0.slerp(e._temp_q1,e._temp_q2,a),e._temp_v1.lerp(l[2],u[2],a),h.worldMatrix.makeTransform(e._temp_v0,e._temp_v1,e._temp_q0)}}return this},e.prototype.calculateJointWorldMatrix=function(){for(var t=0;t<this.joints.length;++t)this.calculateAbsoluteMatrix(t)},e.prototype.calculateAbsoluteMatrix=function(t){var e=this.joints[t];e.parentIndex>=0&&this.calculateAbsoluteMatrix(e.parentIndex),e.worldMatrixValid||(e.worldMatrix.copyFrom(e.localMatrix),e.parentIndex>=0&&e.worldMatrix.append(this.joints[e.parentIndex].worldMatrix),e.worldMatrixValid=!0)},e.prototype.updateGPUCacheData=function(i,r,a){for(var n=0;n<i.joints.length;++n)for(var o=0;o<this.joints.length;++o)if(i.joints[n].name==this.joints[o].name){e._temp_jointMatrix.copyFrom(i.joints[n].inverseMatrix),e._temp_jointMatrix.append(this.joints[o].worldMatrix);var s=e._temp_jointMatrix.decompose(t.Orientation3D.QUATERNION,e._temp_matrixDecomposeA);r[8*n+0]=s[1].x,r[8*n+1]=s[1].y,r[8*n+2]=s[1].z,r[8*n+3]=s[1].w,r[8*n+4]=s[0].x-a.x,r[8*n+5]=s[0].y-a.y,r[8*n+6]=s[0].z-a.z,r[8*n+7]=1;break}return r},e.prototype.findJoint=function(t){for(var e=0;e<this.joints.length;e++)if(this.joints[e].name==t)return this.joints[e];return null},e.prototype.findJointIndex=function(t){if(""==t)return-1;for(var e=0;e<this.joints.length;e++)if(this.joints[e].name==t)return e;return-1},e.prototype.resetWorldMatrix=function(){for(var t=0;t<this.joints.length;t++)this.joints[t].worldMatrixValid=!1},e._temp_v0=new t.Vector3D,e._temp_v1=new t.Vector3D,e._temp_v2=new t.Vector3D,e._temp_q0=new t.Quaternion,e._temp_q1=new t.Quaternion,e._temp_q2=new t.Quaternion,e._temp_jointMatrix=new t.Matrix4_4,e._temp_matrixDecomposeA=[new t.Vector3D,new t.Vector3D,new t.Vector3D],e._temp_matrixDecomposeB=[new t.Vector3D,new t.Vector3D,new t.Vector3D],e}();t.SkeletonPose=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.poseArray=[],this.animationName="",this.sampling=0,this.boneCount=0,this.frameDataOffset=0,this.sourceData=null,this._frameCount=0,this._timeLength=0,this._skeletonPose=null,this._temp_scale=new t.Vector3D,this._temp_translation=new t.Vector3D,this._temp_orientation=new t.Quaternion}return Object.defineProperty(e.prototype,"currentSkeletonPose",{get:function(){return this._skeletonPose},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameCount",{get:function(){return this.poseArray.length>0?this.poseArray.length:this._frameCount},enumerable:!0,configurable:!0}),e.prototype.findJointIndex=function(t){return this._skeletonPose?this._skeletonPose.findJointIndex(t):this.poseArray.length<=0?-1:this.poseArray[0].findJointIndex(t)},e.prototype.addSkeletonPose=function(t){this.poseArray.push(t)},e.prototype.buildInitialSkeleton=function(e,i,r){if(!this._skeletonPose){this._frameCount=r,this._skeletonPose=new t.SkeletonPose;for(var a=0;a<this.boneCount;a++){var n=new t.Joint(e[a]);n.parent=i[a],n.parentIndex=this._skeletonPose.findJointIndex(n.parent),this._skeletonPose.joints.push(n)}this.sourceData.position=this.frameDataOffset+(40*this.boneCount+4)*(this.frameCount-1),this._timeLength=this.sourceData.readInt()/60/80*1e3}},e.prototype.getSkeletonPose=function(t){return this.poseArray.length>0?this.poseArray[t]:0>t||t>=2*this.frameCount?null:(t=Math.floor(t/2),this.readSkeletonPose(t,this._skeletonPose))},e.prototype.readSkeletonPose=function(t,e){this.sourceData.position=this.frameDataOffset+(40*this.boneCount+4)*t,e.frameTime=this.sourceData.readInt()/60/80*1e3;for(var i=0;i<this.boneCount;i++)this._temp_orientation.x=this.sourceData.readFloat(),this._temp_orientation.y=this.sourceData.readFloat(),this._temp_orientation.z=this.sourceData.readFloat(),this._temp_orientation.w=this.sourceData.readFloat(),this._temp_scale.x=this.sourceData.readFloat(),this._temp_scale.y=this.sourceData.readFloat(),this._temp_scale.z=this.sourceData.readFloat(),this._temp_translation.x=this.sourceData.readFloat(),this._temp_translation.y=this.sourceData.readFloat(),this._temp_translation.z=this.sourceData.readFloat(),e.joints[i].worldMatrixValid=!1,e.joints[i].buildLocalMatrix(this._temp_scale,this._temp_orientation,this._temp_translation);return e.calculateJointWorldMatrix(),e},Object.defineProperty(e.prototype,"timeLength",{get:function(){return this.poseArray.length>0?this.poseArray[this.poseArray.length-1].frameTime:this._timeLength},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"jointNum",{get:function(){return this.poseArray.length>0?this.poseArray[0].joints.length:this.boneCount},enumerable:!0,configurable:!0}),e.prototype.clone=function(){var t=new e;return t.animationName=this.animationName,t.poseArray=this.poseArray,t.sampling=this.sampling,t.boneCount=this.boneCount,t._frameCount=this._frameCount,t.frameDataOffset=this.frameDataOffset,t.sourceData=this.sourceData,t._timeLength=this._timeLength,t._skeletonPose=this._skeletonPose,this._skeletonPose&&(t._skeletonPose=this._skeletonPose.clone()),t},e}();t.SkeletonAnimationClip=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(t){this.name="",this.weight=1,this._timeLength=0,this._timePosition=0,this._skeletonAnimation=null,this._skeletonAnimationClip=null,this.name=t}return Object.defineProperty(e.prototype,"skeletonAnimation",{get:function(){return this._skeletonAnimation},set:function(t){this._skeletonAnimation=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skeletonAnimationClip",{get:function(){return this._skeletonAnimationClip},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeLength",{get:function(){return this._timeLength},enumerable:!0,configurable:!0}),e.prototype.addAnimationClip=function(e){if(e.sourceData)this._skeletonAnimationClip=e,this._timeLength=this._skeletonAnimationClip.timeLength;else{if(this._skeletonAnimationClip?this._skeletonAnimationClip.poseArray=[]:this._skeletonAnimationClip=new t.SkeletonAnimationClip,e.poseArray.length<2)this._skeletonAnimationClip.poseArray=e.poseArray;else{var i=e.poseArray[0],r=e.poseArray[1],a=Math.round((r.frameTime-i.frameTime)/t.SkeletonAnimation.fps);if(1>=a)this._skeletonAnimationClip.poseArray=e.poseArray;else{for(var n=1;n<e.poseArray.length;++n){i=e.poseArray[n-1],r=e.poseArray[n];for(var o=0;a>o;o++){var s=new t.SkeletonPose;s.lerp(i,r,o/a),this._skeletonAnimationClip.poseArray.push(s)}}this._skeletonAnimationClip.poseArray.push(e.poseArray[e.poseArray.length-1].clone())}}this._timeLength=this._skeletonAnimationClip.poseArray[this._skeletonAnimationClip.poseArray.length-1].frameTime}},Object.defineProperty(e.prototype,"timePosition",{get:function(){return this._timePosition},set:function(e){e!=this._timePosition&&(this._timePosition=e,this._skeletonAnimation.isLoop?(this._timePosition=e%this._timeLength,this._timePosition<0&&(this._timePosition+=this._timeLength)):this._timePosition<0?(this._timePosition=0,this.name==this._skeletonAnimation.currentAnimName&&(this._skeletonAnimation.stop(),this._skeletonAnimation.event3D.target=this._skeletonAnimation,this._skeletonAnimation.event3D.eventType=t.SkeletonAnimationEvent3D.EVENT_PLAY_COMPLETE,this._skeletonAnimation.dispatchEvent(this._skeletonAnimation.event3D))):this._timePosition>this._timeLength&&(this._timePosition=this._timeLength,this.name==this._skeletonAnimation.currentAnimName&&(this._skeletonAnimation.stop(),this._skeletonAnimation.event3D.target=this._skeletonAnimation,this._skeletonAnimation.event3D.eventType=t.SkeletonAnimationEvent3D.EVENT_PLAY_COMPLETE,this._skeletonAnimation.dispatchEvent(this._skeletonAnimation.event3D))))
},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentSkeletonPose",{get:function(){return this._skeletonAnimationClip.getSkeletonPose(this.currentFrameIndex)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"previousSkeletonPose",{get:function(){var t=this.currentFrameIndex;return this._skeletonAnimation.speed>0?(t--,0>t&&(t=this.frameNum-t)):t=(t+1)%this.frameNum,this._skeletonAnimationClip.getSkeletonPose(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentFrameIndex",{get:function(){return Math.floor(this._timePosition/t.SkeletonAnimation.fps)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameNum",{get:function(){return this._skeletonAnimationClip?this._skeletonAnimationClip.frameCount:0},enumerable:!0,configurable:!0}),e.prototype.getSkeletonPose=function(t){return this._skeletonAnimationClip.getSkeletonPose(t)},e.prototype.clone=function(){var t=new e(this.name);return t._timeLength=this._timeLength,t._skeletonAnimation=this._skeletonAnimation,t._skeletonAnimationClip=this._skeletonAnimationClip,t},e}();t.SkeletonAnimationState=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.speed=1,this.event3D=new t.Event3D,this.isLoop=!0,this._isPlay=!1,this._animTime=0,this._animStateNames=[],this._animStates=[],this._blendSpeed=0,this._blendSkeleton=null,this._blendList=[],this._bindList={},this._temp_quat=new t.Quaternion,this._temp_vec3=new t.Vector3D,this._currentFrame=0,this._changeFrameTime=0,this._oldFrameIndex=0,this._movePosIndex=-1,this._movePosObject3D=null,this._movePosition=new t.Vector3D,this._resetMovePos=!0,this._currentSkeletonPose=null,this._oldTime=0,this._isPlay=!1}return __extends(i,e),i.prototype.addSkeletonAnimationClip=function(e){var i=new t.SkeletonAnimationState(e.animationName);i.skeletonAnimation=this,i.addAnimationClip(e),this.addAnimState(i)},Object.defineProperty(i.prototype,"skeletonAnimationController",{get:function(){return this},enumerable:!0,configurable:!0}),i.prototype.addAnimState=function(t){for(var e=0;e<this._animStates.length;e++)if(this._animStates[e].name==t.name)return;this._animStates.push(t),this._animStateNames.push(t.name)},i.prototype.removeAnimState=function(t){for(var e=0;e<this._animStates.length;e++)if(this._animStates[e].name==t.name)return this._animStates.slice(e,1),void this._animStateNames.slice(e,1)},i.prototype.play=function(t,e,r,a){if(void 0===e&&(e=1),void 0===r&&(r=!0),void 0===a&&(a=!0),!(this._animStates.length<=0)){t||(t=this._animStates[0].name);for(var n=null,o=0;o<this._animStates.length;o++)if(this._animStates[o].name==t){n=this._animStates[o];break}n&&(this._currentAnimName=t,this._blendList.push(n),this._blendSpeed<=0&&this._blendList.length>1&&this._blendList.splice(0,this._blendList.length-1),n.weight=this._blendList.length>1?0:1,r&&(this._animTime=n.timePosition=0),this._changeFrameTime=n.timePosition,this._oldFrameIndex=Math.floor(this._changeFrameTime/i.fps),this.speed=e,this._isPlay=!0,this._resetMovePos=!0,-1!=this._movePosIndex&&this._movePosition.copyFrom(n.getSkeletonPose(0).joints[this._movePosIndex].worldMatrix.position))}},i.prototype.pause=function(){this._isPlay=!1},i.prototype.stop=function(){this._isPlay=!1},i.prototype.update=function(e,r){if(this._oldTime!=e&&(this._oldTime=e,this._isPlay&&!(this._blendList.length<=0))){var a=this._blendList[this._blendList.length-1],n=r*this.speed;this._changeFrameTime+=n;for(var o=Math.floor(Math.abs(this._changeFrameTime/i.fps)),s=this.currentAnimName,h=0;o>h;++h){if(this.event3D.eventType=t.SkeletonAnimationEvent3D.EVENT_FRAME_CHANGE,this.event3D.target=this,0>n?(this.event3D.data=(this._oldFrameIndex-1-h)%a.frameNum,this.event3D.data<0&&(this.event3D.data+=a.frameNum)):this.event3D.data=(this._oldFrameIndex+1+h)%a.frameNum,this.dispatchEvent(this.event3D),this.currentAnimName!=s){this.event3D.data=Math.floor(this._changeFrameTime/i.fps);break}this._changeFrameTime+=n>0?-i.fps:i.fps}this._oldFrameIndex=this.event3D.data,this.animTime+=r*this.speed}},i.prototype.activeState=function(t,e,i,r,a){this._currentSkeletonPose&&this._currentSkeletonPose.updateGPUCacheData(r.geometry.skeleton,r.geometry.skeletonGPUData,this._movePosition),i.uniform_time&&a.uniform1f(i.uniform_time.uniformIndex,this.animTime),a.uniform4fv(i.uniform_PoseMatrix.uniformIndex,r.geometry.skeletonGPUData)},i.prototype.clone=function(){var t=new i;t._blendSpeed=this._blendSpeed,t.isLoop=this.isLoop,t._animStateNames=this._animStateNames.concat([]);for(var e=0;e<this._animStates.length;e++)t._animStates.push(this._animStates[e].clone());return t},Object.defineProperty(i.prototype,"jointNum",{get:function(){return 48},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animStateNames",{get:function(){return this._animStateNames},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animStates",{get:function(){return this._animStates},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animTime",{get:function(){return this._animTime},set:function(t){if(!(this._blendList.length<=0)&&this._blendList[this._blendList.length-1].timePosition!=t){var e=t-this._animTime;if(this._blendSpeed<=0)this._blendList.length>1&&this._blendList.splice(0,this._blendList.length-1),this._blendList[0].weight=1,this._blendList[0].timePosition+=e;else{for(var i=Math.abs(e/this._blendSpeed),r=0;r<this._blendList.length;++r){var a=this._blendList[r];if(r!=this._blendList.length-1){if(a.weight=Math.max(0,a.weight-i),a.weight<=0){this._blendList.splice(r,1),--r;continue}}else a.weight=Math.min(1,a.weight+i)}this._blendList[this._blendList.length-1].timePosition+=e}this._animTime=this._blendList[this._blendList.length-1].timePosition;var n=this._blendList[0],o=n.currentSkeletonPose;if(this._blendList.length<=1)this._blendSkeleton||(this._blendSkeleton=o.clone()),this.updateBindList(o),this.updateMovePos(o),this._currentSkeletonPose=o;else{var s=this._blendList[1],h=s.currentSkeletonPose;this._blendSkeleton||(this._blendSkeleton=o.clone()),this._blendSkeleton.lerp(o,h,s.weight),this._blendSkeleton.resetWorldMatrix(),this._blendSkeleton.calculateJointWorldMatrix(),this.updateBindList(this._blendSkeleton),this.updateMovePos(this._blendSkeleton),this._currentSkeletonPose=this._blendSkeleton}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"timeLength",{get:function(){return this._blendList.length<=0?0:this._blendList[this._blendList.length-1].timeLength},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"frameIndex",{get:function(){return this.animTime/i.fps},set:function(t){this.animTime=t*i.fps},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"blendSpeed",{get:function(){return this._blendSpeed},set:function(t){this._blendSpeed=Math.max(t,0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentAnimName",{get:function(){return this._currentAnimName},enumerable:!0,configurable:!0}),i.prototype.isPlay=function(){return this._isPlay},i.prototype.bindToJointPose=function(t,e){var i=this._animStates[0].skeletonAnimationClip.findJointIndex(t);if(0>i)return!1;var r=null;return this._bindList[i]?r=this._bindList[i]:(r=new Array,this._bindList[i]=r),r.push(e),!0},i.prototype.setMovePosJointName=function(t,e){var i=this._animStates[0].skeletonAnimationClip.findJointIndex(t);return 0>i?!1:(this._movePosIndex=i,this._movePosObject3D=e,this._resetMovePos=!0,!0)},i.prototype.updateBindList=function(t){var e=null,i=null,r=null;for(var a in this._bindList)if(e=this._bindList[a],!(e.length<=0)&&(i=t.joints[a]))for(var n=0;n<e.length;n++)r=e[n],this._temp_quat.fromMatrix(i.worldMatrix),r.orientation=this._temp_quat,r.x=i.worldMatrix.position.x-this._movePosition.x,r.y=i.worldMatrix.position.y-this._movePosition.y,r.z=i.worldMatrix.position.z-this._movePosition.z},i.prototype.updateMovePos=function(t){var e=null;-1!=this._movePosIndex&&(e=t.joints[this._movePosIndex],this._movePosObject3D&&(this._movePosition.x=e.worldMatrix.position.x-this._movePosition.x,this._movePosition.y=e.worldMatrix.position.y-this._movePosition.y,this._movePosition.z=e.worldMatrix.position.z-this._movePosition.z,this._movePosObject3D.orientation.transformVector(this._movePosition,this._movePosition),this._movePosObject3D.x+=this._movePosition.x,this._movePosObject3D.y+=this._movePosition.y,this._movePosObject3D.z+=this._movePosition.z,this._resetMovePos&&(this._resetMovePos=!1,this._movePosObject3D.x-=this._movePosition.x,this._movePosObject3D.y+=this._movePosition.y,this._movePosObject3D.z-=this._movePosition.z)),this._movePosition.copyFrom(e.worldMatrix.position))},i.fps=1e3/60,i}(t.EventDispatcher);t.SkeletonAnimation=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e,i){this.volume=1,this.loop=!1,this.pitch=1,i=i||{},i.volume&&(this.volume=i.volume),i.loop&&(this.loop=i.loop),i.pitch&&(this.pitch=i.pitch),this.sound=e,this.paused=!1,t.AudioManager.instance.hasAudioContext()?(this.context=t.AudioManager.instance.context,this.startTime=0,this.startOffset=0,this.source=null,this.gain=this.context.createGain()):t.AudioManager.instance.hasAudio()&&this.sound.audio&&(this.source=this.sound.audio.cloneNode(!1),this.source.pause())}return e.prototype.play=function(){if(t.AudioManager.instance.hasAudioContext()){if(this.source)throw new Error("Call stop() before calling play()");if(this.createSource(),!this.source)return;this.startTime=this.context.currentTime,this.source.start(0,this.startOffset%this.source.buffer.duration)}else t.AudioManager.instance.hasAudio&&(this.paused=!1,this.source.play());this.setVolume(this.volume),this.setLoop(this.loop),this.setPitch(this.pitch)},e.prototype.pause=function(){t.AudioManager.instance.hasAudioContext()?this.source&&(this.startOffset+=this.context.currentTime-this.startTime,this.source.stop(0),this.source=null):t.AudioManager.instance.hasAudio()&&this.source&&this.source.pause(),this.paused=!0},e.prototype.unpause=function(){if(t.AudioManager.instance.hasAudioContext()){if(this.source||!this.paused)throw new Error("Call pause() before unpausing.");if(this.createSource(),!this.source)return;this.startTime=this.context.currentTime,this.source.start(0,this.startOffset%this.source.buffer.duration),this.setVolume(this.volume),this.setLoop(this.loop),this.setPitch(this.pitch)}else t.AudioManager.instance.hasAudio()&&this.source.play();this.paused=!1},e.prototype.stop=function(){t.AudioManager.instance.hasAudioContext()?this.source&&(this.source.stop(0),this.startOffset=0,this.source=null):t.AudioManager.instance.hasAudio()&&this.source&&(this.source.pause(),this.source.currentTime=0)},e.prototype.setLoop=function(t){this.source&&(this.source.loop=t)},e.prototype.setVolume=function(e){this.gain?this.gain.gain.value=e*t.AudioManager.instance.volume:this.source&&(this.source.volume=e*t.AudioManager.instance.volume)},e.prototype.setPitch=function(e){t.AudioManager.instance.hasAudioContext()?this.source&&(this.source.playbackRate.value=e):t.AudioManager.instance.hasAudio()&&this.source&&(this.source.playbackRate=e)},e.prototype.isPlaying=function(){return t.AudioManager.instance.hasAudioContext()?!this.paused:t.AudioManager.instance.hasAudio()?!this.source.paused:void 0},e.prototype.getDuration=function(){if(t.AudioManager.instance.hasAudioContext()){if(this.source)return this.source.buffer.duration}else if(t.AudioManager.instance.hasAudio()&&this.source){var e=this.source.duration;if(e===e)return e}return 0},e.prototype.createSource=function(){var t=this;this.sound.buffer&&(this.source=this.context.createBufferSource(),this.source.buffer=this.sound.buffer,this.source.connect(this.gain),this.gain.connect(this.context.destination),this.loop&&(this.source.onended=function(){return t.play()}))},e}();t.Channel=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r){e.call(this,i,r),this._position=new t.Vector3D,this._velocity=new t.Vector3D,t.AudioManager.instance.hasAudioContext()&&(this._panner=this.context.createPanner()),this._maxDistance=1e4,this._minDistance=1,this._rollOffFactor=1,this._listener=new t.Vector3D}return __extends(i,e),Object.defineProperty(i.prototype,"listener",{get:function(){return this._listener},set:function(e){if(this._listener.copyFrom(e),t.AudioManager.instance.hasAudio()&&this.source){var i=this.fallOff(this._listener,this.position,this.minDistance,this.maxDistance,this.rollOffFactor);this.source.volume=this.volume*i}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return this._position},set:function(e){if(this._position.copyFrom(e),t.AudioManager.instance.hasAudioContext()&&this._panner.setPosition(e.x,e.y,e.z),t.AudioManager.instance.hasAudio()&&this.source){var i=this.fallOff(this._listener,this.position,this.minDistance,this.maxDistance,this.rollOffFactor);this.source.volume=this.volume*i}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"velocity",{get:function(){return this._velocity},set:function(e){this._velocity.copyFrom(e),t.AudioManager.instance.hasAudioContext()&&this._panner.setVelocity(e.x,e.y,e.z)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maxDistance",{get:function(){return this._maxDistance},set:function(e){this._maxDistance=e,t.AudioManager.instance.hasAudioContext()&&(this._panner.maxDistance=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"minDistance",{get:function(){return this._minDistance},set:function(e){this._minDistance=e,t.AudioManager.instance.hasAudioContext()&&(this._panner.refDistance=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rollOffFactor",{get:function(){return this._rollOffFactor},set:function(t){this._rollOffFactor=t,this._panner&&(this._panner.rolloffFactor=t)},enumerable:!0,configurable:!0}),i.prototype.createSource=function(){this.sound.buffer&&(this.source=this.context.createBufferSource(),this.source.buffer=this.sound.buffer,this.source.connect(this._panner),this._panner.connect(this.gain),this.gain.connect(this.context.destination))},i.prototype.fallOff=function(e,i,r,a){var n=t.Vector3D.distance(e,i);return r>n?1:n>a?0:1-n/(a-r)},i}(t.Channel);t.Channel3d=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(r,a,n){var o=this;if(void 0===a&&(a=null),void 0===n&&(n=null),e.call(this),this.audio=null,this._event=new t.Event3D,this._success=a,this._error=n,this.isLoaded=!1,t.AudioManager.instance.hasAudioContext())t.AudioManager.instance.isSupported(r,this.audio)?(console.warn("Audio format not supported"),this._event.eventType=i.SOUND_ERROR,this._event.target=this,this.dispatchEvent(this._event),n(this)):t.AudioManager.instance.context&&this.loadAudioFile(r);else if(t.AudioManager.instance.hasAudio()){try{this.audio=new Audio}catch(s){return console.warn("No support for Audio element"),this._event.eventType=i.SOUND_ERROR,this._event.target=this,this.dispatchEvent(this._event),void(n&&n(this))}t.AudioManager.instance.isSupported(r,this.audio)?(console.warn("Audio format not supported"),this._event.eventType=i.SOUND_ERROR,this._event.target=this,this.dispatchEvent(this._event),n&&n(this)):(this.audio.src=r,this.audio.addEventListener("canplaythrough",function(t){return o.oncanplaythrough(t)}),this.audio.addEventListener("ended",function(t){return o.onended(t)}),this.audio.load())}}return __extends(i,e),Object.defineProperty(i.prototype,"buffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0}),i.prototype.loadAudioFile=function(t){var e=this;null==this.xhr&&(this.xhr=new XMLHttpRequest),this.xhr.open("GET",t,!0),this.xhr.responseType="arraybuffer",this.xhr.onload=function(t){return e.audioLoadend(t)},this.xhr.send()},i.prototype.audioLoadend=function(){var e=this;t.AudioManager.instance.context.decodeAudioData(this.xhr.response,function(t){return e.decodeSuccessCallback(t)})},i.prototype.decodeSuccessCallback=function(t){this._buffer=t,this._event.eventType=i.SOUND_SUCCESS,this._event.target=this,this._event.data=t,this.dispatchEvent(this._event),this._success&&this._success(this)},i.prototype.onended=function(){},i.prototype.oncanplaythrough=function(t){this.isLoaded||(this.isLoaded=!0,this._event.eventType=i.SOUND_SUCCESS,this._event.target=this,this._event.data=t,this.dispatchEvent(this._event),this._success&&this._success(this))},i.SOUND_SUCCESS="SoundSuccess",i.SOUND_ERROR="SoundError",i}(t.EventDispatcher);t.Sound=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.volume=1,this.codecs={},this.hasAudioContext()&&"undefined"!=typeof AudioContext&&(this.context=new AudioContext)}return e.prototype.hasAudio=function(){return"undefined"!=typeof Audio},e.prototype.hasAudioContext=function(){return!("undefined"==typeof AudioContext)},e.prototype.isSupported=function(t,e){null==this.codecs&&(null==e&&(e=new Audio),this.codecs={mp3:!!e.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!e.canPlayType("audio/aac;").replace(/^no$/,""),m4a:!!(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(e.canPlayType("audio/x-mp4;")||e.canPlayType("audio/mp4;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")});var i=t.match(/^data:audio\/([^;,]+);/i);return i||(i=t.split("?",1)[0].match(/\.([^.]+)$/)),i&&(i=i[1].toLowerCase()),this.codecs[i]},e.prototype.createSound=function(e,i,r){return void 0===i&&(i=null),void 0===r&&(r=null),new t.Sound(e,i,r)},e.prototype.playSound=function(e,i){i=i||{};var r=new t.Channel(e,i);return r.play(),r},e.prototype.playSound3d=function(e,i,r){r=r||{};var a=new t.Channel3d(e,r);return a.position=i,r.volume&&(a.volume=r.volume),r.loop&&(a.loop=r.loop),r.maxDistance&&(a.maxDistance=r.maxDistance),r.minDistance&&(a.minDistance=r.minDistance),r.rollOffFactor&&(a.rollOffFactor=r.rollOffFactor),a.play(),a},Object.defineProperty(e,"instance",{get:function(){return null==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e}();t.AudioManager=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null),this._autoUpdate=!0,this._origin=new t.Vector3D(0,0,0),this._target=e,this._lookAtObject=i}return Object.defineProperty(e.prototype,"target",{get:function(){return this._target},set:function(t){this._target!=t&&(this._target=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){this._autoUpdate!=t&&(this._autoUpdate=t)},enumerable:!0,configurable:!0}),e.prototype.notifyUpdate=function(){},e.prototype.update=function(){},e}();t.ControllerBase=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r,a,n){void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=!1),void 0===n&&(n=!1),e.call(this,i),this._origin=new t.Vector3D(0,0,0),this._lookAtPosition=new t.Vector3D,this._eyesPos=new t.Vector3D,this._up=t.Vector3D.Y_AXIS,this._eyesLength=0,this._rotaEyesLine=new t.Vector3D(0,0,1),this._rotaAngle=new t.Vector3D,this._matRot=new t.Matrix4_4,this._quaRot=new t.Quaternion,this._tempVec=new t.Vector3D,this._matTemp=new t.Matrix4_4,this._mouseDown=!1,this._mouseRightDown=!1,this._screenMoveStartDetail=new t.Point,this._screenMoveDelay=new t.Point,this._isUpdate=!1,this._elapsed=0,this._speed=3,this._xAngle=0,this._ctl=!1,this._alt=!1,this._shift=!1,this._needctl=!1,this._needalt=!1,this._needshift=!1,this._keyArray=new Array,this.lookAtOffset=new t.Vector3D(0,0,0),this.firstCamera=!1,this._needctl=a,this._needalt=n,this._keyArray.push(!1),this._keyArray.push(!1),this._keyArray.push(!1),this._keyArray.push(!1),r?this.lookAtObject=r:this.lookAtPosition=new t.Vector3D,this._eyesPos.copyFrom(i.position),this._lookAtPosition.copyFrom(r.position.add(this.lookAtOffset)),this._target.lookAt(this._eyesPos,this._lookAtPosition),t.Input.addEventListener(t.MouseEvent3D.MOUSE_MOVE,this.mouseMove,this),t.Input.addEventListener(t.MouseEvent3D.MOUSE_WHEEL,this.mouseWheel,this),t.Input.addEventListener(t.MouseEvent3D.MOUSE_UP,this.mouseUp,this),t.Input.addEventListener(t.MouseEvent3D.MOUSE_DOWN,this.mouseDown,this),t.Input.addEventListener(t.KeyEvent3D.KEY_UP,this.keyUp,this),t.Input.addEventListener(t.KeyEvent3D.KEY_DOWN,this.keyDown,this),t.Input.addEventListener(t.TouchEvent3D.TOUCH_END,this.touchUp,this),t.Input.addEventListener(t.TouchEvent3D.TOUCH_START,this.touchDown,this),t.Input.addEventListener(t.TouchEvent3D.TOUCH_MOVE,this.touchMove,this)}return __extends(i,e),i.prototype.scaleSpeed=function(t){this._speed*=t},i.prototype.mouseMove=function(){this._mouseDown&&(this._needctl?this._ctl:!0)&&(this._rotaAngle.y+=t.Input.mouseOffsetX,this._rotaAngle.x+=t.Input.mouseOffsetY,this._rotaAngle.y%=360,this._rotaAngle.x%=360)},i.prototype.mouseWheel=function(){if(this._target){var e=this._target;if(e){var i=.1*t.Input.wheelDelta,r=e.viewPort;switch(e.cameraType){case t.CameraType.orthogonal:var a=r.width-i,n=r.height-i;e.updateViewport(0,0,a,n);break;case t.CameraType.orthogonalToCenter:var o=r.x-i,s=r.y-i,a=r.width-i,n=r.height-i;e.updateViewport(o,s,a,n);break;case t.CameraType.perspective:this.distance=this._eyesLength-i}}}},i.prototype.mouseUp=function(e){switch(e.mouseCode){case t.MouseCode.Mouse_Left:this._mouseDown=!1;break;case t.MouseCode.Mouse_Right:this._mouseRightDown=!1}},i.prototype.mouseDown=function(e){switch(e.mouseCode){case t.MouseCode.Mouse_Left:this._mouseDown=!0;break;case t.MouseCode.Mouse_Right:this._mouseRightDown=!0}},i.prototype.touchMove=function(t){1==t.targetTouches.length?this.mouseMove(null):this.mouseWheel(null)},i.prototype.touchUp=function(){this._mouseDown=!1},i.prototype.touchDown=function(){this._mouseDown=!0},i.prototype.keyDown=function(e){switch(e.keyCode){case t.KeyCode.Key_W:this._keyArray[0]=!0;break;case t.KeyCode.Key_A:this._keyArray[1]=!0;break;case t.KeyCode.Key_S:this._keyArray[2]=!0;break;case t.KeyCode.Key_D:this._keyArray[3]=!0;break;case t.KeyCode.Key_Q:this._keyArray[4]=!0;break;case t.KeyCode.Key_E:this._keyArray[5]=!0;break;case t.KeyCode.Key_Control_L:this._ctl=!0;break;case t.KeyCode.Key_Alt_L:this._alt=!0}},i.prototype.keyUp=function(e){switch(e.keyCode){case t.KeyCode.Key_W:this._keyArray[0]=!1;break;case t.KeyCode.Key_A:this._keyArray[1]=!1;break;case t.KeyCode.Key_S:this._keyArray[2]=!1;break;case t.KeyCode.Key_D:this._keyArray[3]=!1;break;case t.KeyCode.Key_Q:this._keyArray[4]=!1;break;case t.KeyCode.Key_E:this._keyArray[5]=!1;break;case t.KeyCode.Key_Control_L:this._ctl=!1;break;case t.KeyCode.Key_Alt_L:this._alt=!1}},Object.defineProperty(i.prototype,"lookAtPosition",{get:function(){return this._lookAtPosition},set:function(t){this._lookAtObject&&(this._lookAtObject=null),this._lookAtPosition.copyFrom(t.add(this.lookAtOffset)),this.notifyUpdate()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lookAtObject",{get:function(){return this._lookAtObject},set:function(t){this._lookAtObject!=t&&(this._lookAtObject=t,this._lookAtPosition.copyFrom(this._lookAtObject.position.add(this.lookAtOffset)),this.notifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"distance",{get:function(){return this._eyesLength},set:function(t){this._eyesLength=t,this._eyesLength<1&&(this._eyesLength=1)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotationX",{get:function(){return this._rotaAngle.x},set:function(t){this._rotaAngle.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotationY",{get:function(){return this._rotaAngle.y},set:function(t){this._rotaAngle.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotationZ",{get:function(){return this._rotaAngle.z},set:function(t){this._rotaAngle.z=t},enumerable:!0,configurable:!0}),i.prototype.update=function(){if(this._target){if(0==this._target.isController)return;this._quaRot.fromEulerAngles(this._rotaAngle.x,this._rotaAngle.y,0),this._rotaEyesLine.copyFrom(this._quaRot.transformVector(t.Vector3D.Z_AXIS)),this._rotaEyesLine.normalize(),this._keyArray[0]&&(this._tempVec.copyFrom(this._rotaEyesLine),this._tempVec.y=0,this._tempVec.normalize(),this._tempVec.scaleBy(this._speed),this._tempVec.copyFrom(this._lookAtObject.position.add(this._tempVec)),this._lookAtObject.position=this._tempVec),this._keyArray[1]&&(this._tempVec.copyFrom(this._rotaEyesLine),this._matTemp.identity(),this._matTemp.appendRotation(90,t.Vector3D.Y_AXIS),this._tempVec.copyFrom(this._matTemp.transformVector(this._tempVec)),this._tempVec.y=0,this._tempVec.normalize(),this._tempVec.scaleBy(this._speed),this._tempVec.copyFrom(this._lookAtObject.position.subtract(this._tempVec)),this._lookAtObject.position=this._tempVec),this._keyArray[2]&&(this._tempVec.copyFrom(this._rotaEyesLine),this._tempVec.y=0,this._tempVec.normalize(),this._tempVec.scaleBy(this._speed),this._tempVec.copyFrom(this._lookAtObject.position.subtract(this._tempVec)),this._lookAtObject.position=this._tempVec),this._keyArray[3]&&(this._tempVec.copyFrom(this._rotaEyesLine),this._matTemp.identity(),this._matTemp.appendRotation(90,t.Vector3D.Y_AXIS),this._tempVec.copyFrom(this._matTemp.transformVector(this._tempVec)),this._tempVec.y=0,this._tempVec.normalize(),this._tempVec.scaleBy(this._speed),this._tempVec.copyFrom(this._lookAtObject.position.add(this._tempVec)),this._lookAtObject.position=this._tempVec),this._keyArray[4]&&(this._quaRot.fromEulerAngles(this._rotaAngle.x,this._rotaAngle.y,0),this._tempVec.copyFrom(this._quaRot.transformVector(t.Vector3D.Y_AXIS)),this._tempVec.normalize(),this._tempVec.scaleBy(this._speed),this._tempVec.copyFrom(this._lookAtObject.position.add(this._tempVec)),this._lookAtObject.position=this._tempVec),this._keyArray[5]&&(this._quaRot.fromEulerAngles(this._rotaAngle.x,this._rotaAngle.y,0),this._tempVec.copyFrom(this._quaRot.transformVector(t.Vector3D.Y_AXIS)),this._tempVec.normalize(),this._tempVec.scaleBy(this._speed),this._tempVec.copyFrom(this._lookAtObject.position.subtract(this._tempVec)),this._lookAtObject.position=this._tempVec),this._lookAtPosition.copyFrom(this._lookAtObject.position),this._tempVec.copyFrom(this._rotaEyesLine),this._tempVec.scaleBy(this._eyesLength),this._eyesPos.copyFrom(this._lookAtPosition.subtract(this._tempVec)),this._lookAtObject&&this._lookAtPosition.copyFrom(this._lookAtObject.position.add(this.lookAtOffset)),this._quaRot.fromEulerAngles(this._rotaAngle.x,this._rotaAngle.y,this._rotaAngle.z),this._tempVec.copyFrom(this._up),this._tempVec.copyFrom(this._quaRot.transformVector(this._tempVec)),this._tempVec.normalize(),this.firstCamera&&(this._lookAtObject.rotationY=this._rotaAngle.y,this._lookAtObject.rotationX=this._rotaAngle.x),this._target.lookAt(this._eyesPos,this._lookAtPosition,this._tempVec)}},i}(t.ControllerBase);t.LookAtController=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r,a,n,o,s,h,l,u,c,d,p){void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=0),void 0===n&&(n=90),void 0===o&&(o=100),void 0===s&&(s=-90),void 0===h&&(h=90),void 0===l&&(l=0/0),void 0===u&&(u=0/0),void 0===c&&(c=8),void 0===d&&(d=2),void 0===p&&(p=!1),e.call(this,i,r),this._currentPanAngle=0,this._currentTiltAngle=90,this._panAngle=0,this._tiltAngle=90,this._distance=1e3,this._minPanAngle=-(1/0),this._maxPanAngle=1/0,this._minTiltAngle=-90,this._maxTiltAngle=90,this._maxDistance=5e3,this._minDistance=-5e3,this._steps=8,this._yFactor=2,this._wrapPanAngle=!1,this._lookAtPosition=new t.Vector3D(0,0,0),this._mouseDown=!1,this._mouseRightDown=!1,this._keyArray=new Array,this.distance=o,this.panAngle=a,this.tiltAngle=n,this.minPanAngle=l||-(1/0),this.maxPanAngle=u||1/0,this.minTiltAngle=s,this.maxTiltAngle=h,this.steps=c,this.yFactor=d,this.wrapPanAngle=p,this._currentPanAngle=this._panAngle,this._currentTiltAngle=this._tiltAngle,t.Input.addEventListener(t.MouseEvent3D.MOUSE_MOVE,this.mouseMove,this),t.Input.addEventListener(t.MouseEvent3D.MOUSE_WHEEL,this.mouseWheel,this),t.Input.addEventListener(t.MouseEvent3D.MOUSE_UP,this.mouseUp,this),t.Input.addEventListener(t.MouseEvent3D.MOUSE_DOWN,this.mouseDown,this),t.Input.addEventListener(t.KeyEvent3D.KEY_UP,this.keyUp,this),t.Input.addEventListener(t.KeyEvent3D.KEY_DOWN,this.keyDown,this),t.Input.addEventListener(t.TouchEvent3D.TOUCH_END,this.touchUp,this),t.Input.addEventListener(t.TouchEvent3D.TOUCH_START,this.touchDown,this),t.Input.addEventListener(t.TouchEvent3D.TOUCH_MOVE,this.touchMove,this)}return __extends(i,e),i.prototype.mouseMove=function(){this._mouseDown&&(this._tiltAngle+=.1*t.Input.mouseOffsetY,this._tiltAngle=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,this._tiltAngle)),this._panAngle+=.1*t.Input.mouseOffsetX,this._panAngle=Math.max(this._minPanAngle,Math.min(this._maxPanAngle,this._panAngle)))},i.prototype.mouseWheel=function(){var e=this._target;if(e){var i=.1*t.Input.wheelDelta,r=e.viewPort;switch(e.cameraType){case t.CameraType.orthogonal:var a=r.width-i,n=r.height-i;e.updateViewport(0,0,a,n);break;case t.CameraType.orthogonalToCenter:var o=r.x-i,s=r.y-i,a=r.width-i,n=r.height-i;e.updateViewport(o,s,a,n);break;case t.CameraType.perspective:this._distance-=i,this._distance=Math.max(this._minDistance,Math.min(this._maxDistance,this._distance))}}},i.prototype.mouseUp=function(e){switch(e.mouseCode){case t.MouseCode.Mouse_Left:this._mouseDown=!1;break;case t.MouseCode.Mouse_Right:this._mouseRightDown=!1}},i.prototype.mouseDown=function(e){switch(e.mouseCode){case t.MouseCode.Mouse_Left:this._mouseDown=!0;break;case t.MouseCode.Mouse_Right:this._mouseRightDown=!0}},i.prototype.touchMove=function(t){1==t.targetTouches.length?this.mouseMove(null):this.mouseWheel(null)},i.prototype.touchUp=function(){this._mouseDown=!1},i.prototype.touchDown=function(){this._mouseDown=!0},i.prototype.keyDown=function(e){switch(e.keyCode){case t.KeyCode.Key_W:this._keyArray[0]=!0;break;case t.KeyCode.Key_A:this._keyArray[1]=!0;break;case t.KeyCode.Key_S:this._keyArray[2]=!0;break;case t.KeyCode.Key_D:this._keyArray[3]=!0}},i.prototype.keyUp=function(e){switch(e.keyCode){case t.KeyCode.Key_W:this._keyArray[0]=!1;break;case t.KeyCode.Key_A:this._keyArray[1]=!1;break;case t.KeyCode.Key_S:this._keyArray[2]=!1;break;case t.KeyCode.Key_D:this._keyArray[3]=!1}},Object.defineProperty(i.prototype,"lookAtPosition",{get:function(){return this._lookAtPosition},set:function(t){this._lookAtPosition=t,this.notifyUpdate()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"steps",{get:function(){return this._steps},set:function(t){t=1>t?1:t,this._steps!=t&&(this._steps=t,this.notifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"panAngle",{get:function(){return this._panAngle},set:function(t){t=Math.max(this._minPanAngle,Math.min(this._maxPanAngle,t)),this._panAngle!=t&&(this._panAngle=t,this.notifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tiltAngle",{get:function(){return this._tiltAngle},set:function(t){t=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,t)),this._tiltAngle!=t&&(this._tiltAngle=t,this.notifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"distance",{get:function(){return this._distance},set:function(t){this._distance!=t&&(this._distance=this._distance=Math.max(this._minDistance,Math.min(this._maxDistance,t)),this.notifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"minPanAngle",{get:function(){return this._minPanAngle},set:function(t){this._minPanAngle!=t&&(this._minPanAngle=t,this.panAngle=Math.max(this._minPanAngle,Math.min(this._maxPanAngle,this._panAngle)))
},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maxPanAngle",{get:function(){return this._maxPanAngle},set:function(t){this._maxPanAngle!=t&&(this._maxPanAngle=t,this.panAngle=Math.max(this._minPanAngle,Math.min(this._maxPanAngle,this._panAngle)))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"minTiltAngle",{get:function(){return this._minTiltAngle},set:function(t){this._minTiltAngle!=t&&(this._minTiltAngle=t,this.tiltAngle=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,this._tiltAngle)))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maxTiltAngle",{get:function(){return this._maxTiltAngle},set:function(t){this._maxTiltAngle!=t&&(this._maxTiltAngle=t,this.tiltAngle=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,this._tiltAngle)))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maxDistance",{get:function(){return this._maxDistance},set:function(t){this._maxDistance!=t&&(this._maxDistance=t,this._distance=Math.max(this._minDistance,Math.min(this._maxDistance,this._distance)))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"minDistance",{get:function(){return this._maxDistance},set:function(t){this._minDistance!=t&&(this._minDistance=t,this._distance=Math.max(this._minDistance,Math.min(this._maxDistance,this._distance)))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"yFactor",{get:function(){return this._yFactor},set:function(t){this._yFactor!=t&&(this._yFactor=t,this.notifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"wrapPanAngle",{get:function(){return this._wrapPanAngle},set:function(t){this._wrapPanAngle!=t&&(this._wrapPanAngle=t,this.notifyUpdate())},enumerable:!0,configurable:!0}),i.prototype.update=function(e){void 0===e&&(e=!0),(this._tiltAngle!=this._currentTiltAngle||this._panAngle!=this._currentPanAngle)&&(this.notifyUpdate(),this._wrapPanAngle&&(this._panAngle=this._panAngle<0?this._panAngle%360+360:this._panAngle%360,this._panAngle-this._currentPanAngle<-180?this._currentPanAngle-=360:this._panAngle-this._currentPanAngle>180&&(this._currentPanAngle+=360)),e?(this._currentTiltAngle+=(this._tiltAngle-this._currentTiltAngle)/(this.steps+1),this._currentPanAngle+=(this._panAngle-this._currentPanAngle)/(this.steps+1)):(this._currentPanAngle=this._panAngle,this._currentTiltAngle=this._tiltAngle),Math.abs(this._tiltAngle-this._currentTiltAngle)<.01&&Math.abs(this._panAngle-this._currentPanAngle)<.01&&(this._currentTiltAngle=this._tiltAngle,this._currentPanAngle=this._panAngle));var i=this._lookAtObject?this._lookAtObject.position:this._lookAtPosition?this._lookAtPosition:this._origin,r=new t.Vector3D;r.x=i.x+this.distance*Math.sin(this._currentPanAngle*t.MathUtil.DEGREES_TO_RADIANS)*Math.cos(this._currentTiltAngle*t.MathUtil.DEGREES_TO_RADIANS),r.z=i.z+this.distance*Math.cos(this._currentPanAngle*t.MathUtil.DEGREES_TO_RADIANS)*Math.cos(this._currentTiltAngle*t.MathUtil.DEGREES_TO_RADIANS),r.y=i.y+this.distance*Math.sin(this._currentTiltAngle*t.MathUtil.DEGREES_TO_RADIANS)*this.yFactor,this._target&&this._lookAtPosition&&this._target.lookAt(r,this._lookAtPosition)},i}(t.ControllerBase);t.HoverController=e}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t.PixelArray=0]="PixelArray",t[t.CompressData=1]="CompressData",t[t.ImageData=2]="ImageData"}(t.InternalFormat||(t.InternalFormat={})),t.InternalFormat,!function(t){t[t.shadowFrameBufrfer=0]="shadowFrameBufrfer",t[t.defaultFrameBuffer=1]="defaultFrameBuffer",t[t.positionFrameBuffer=2]="positionFrameBuffer",t[t.normalFrameBuffer=3]="normalFrameBuffer",t[t.specularFrameBuffer=4]="specularFrameBuffer",t[t.leftEyeFrameBuffer=5]="leftEyeFrameBuffer",t[t.rightEyeFrameBuffer=6]="rightEyeFrameBuffer",t[t.nextFrameBuffer=7]="nextFrameBuffer"}(t.FrameBufferType||(t.FrameBufferType={})),t.FrameBufferType,!function(t){t[t.FLOAT_RGB=0]="FLOAT_RGB",t[t.FLOAT_RGBA=1]="FLOAT_RGBA",t[t.UNSIGNED_BYTE_RGB=2]="UNSIGNED_BYTE_RGB",t[t.UNSIGNED_BYTE_RGBA=3]="UNSIGNED_BYTE_RGBA"}(t.FrameBufferFormat||(t.FrameBufferFormat={})),t.FrameBufferFormat,!function(t){t[t.ALPHA=0]="ALPHA",t[t.LAYER=1]="LAYER",t[t.NORMAL=2]="NORMAL",t[t.MULTIPLY=3]="MULTIPLY",t[t.ADD=4]="ADD",t[t.SUB=5]="SUB",t[t.DIV=6]="DIV",t[t.SCREEN=7]="SCREEN",t[t.SOFT_ADD=8]="SOFT_ADD"}(t.BlendMode||(t.BlendMode={}));var e=(t.BlendMode,function(){function t(){}return t}());t.ContextSamplerType=e;var i=function(){function t(){}return t}();t.DrawMode=i;var r=function(){function t(){}return t.Direct3D_Opengl_Auto="Direct3D_Opengl_Auto",t.Direct3D_9_0="Direct3D_9_0",t.Direct3D_10_0="Direct3D_10_0",t.Direct3D_11_0="Direct3D_11_0",t.OpenGLES_2_0="OpenGLES_2_0",t.OpenGLES_3_0="OpenGLES_3_0",t.OpenGL="OpenGL",t.ColorFormat_DXT1_RGB=0,t.ColorFormat_DXT1_RGBA=0,t.ColorFormat_DXT3_RGBA=0,t.ColorFormat_DXT5_RGBA=0,t}();t.ContextConfig=r}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.isLost=!1,this.DEPTH_TEST=!1,this.CULL_FACE=!1,this.BLEND=!1,this.blend_Factors_src=-1,this.blend_Factors_dst=-1,this.cullingMode=-1,this.depthCompareMode=-1,this.cacheVertexPoint=[],this.cacheVertexFormat=0}return e.prototype.register=function(){var i;e.gl.getExtension("WEBGL_depth_texture")||e.gl.getExtension("MOZ_WEBGL_depth_texture")||e.gl.getExtension("WEBKIT_WEBGL_depth_texture"),e.gl.getExtension("EXT_texture_filter_anisotropic")||e.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),e.gl.getExtension("WEBGL_compressed_texture_pvrtc")||e.gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),e.gl.getExtension("WEBGL_compressed_texture_etc1"),e.gl.getExtension("OES_element_index_uint"),e.gl.getExtension("OES_texture_float_linear"),e.gl.getExtension("OES_texture_float"),e.gl.getExtension("OES_texture_half_float"),e.gl.getExtension("OES_texture_half_float_linear"),e.gl.getExtension("OES_standard_derivatives"),e.gl.getExtension("GL_OES_standard_derivatives"),e.gl.getExtension("WEBGL_draw_buffers"),e.gl.getExtension("WEBGL_depth_texture"),e.gl.getExtension("WEBGL_lose_context"),i=e.gl.getExtension("WEBGL_compressed_texture_s3tc")||e.gl.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),i&&(t.ContextConfig.ColorFormat_DXT1_RGB=i.COMPRESSED_RGB_S3TC_DXT1_EXT,t.ContextConfig.ColorFormat_DXT1_RGBA=i.COMPRESSED_RGBA_S3TC_DXT1_EXT,t.ContextConfig.ColorFormat_DXT3_RGBA=i.COMPRESSED_RGBA_S3TC_DXT3_EXT,t.ContextConfig.ColorFormat_DXT5_RGBA=i.COMPRESSED_RGBA_S3TC_DXT5_EXT),t.ContextConfig.BLEND=e.gl.BLEND,t.DrawMode.TRIANGLES=e.gl.TRIANGLES,t.DrawMode.POINTS=e.gl.POINTS,t.DrawMode.LINES=e.gl.LINES,t.DrawMode.LINE_STRIP=e.gl.LINE_STRIP,t.ContextConfig.FLOAT=e.gl.FLOAT,t.ContextConfig.VERTEX_SHADER=e.gl.VERTEX_SHADER,t.ContextConfig.FRAGMENT_SHADER=e.gl.FRAGMENT_SHADER,t.ContextConfig.FRONT=e.gl.FRONT,t.ContextConfig.BACK=e.gl.BACK,t.ContextConfig.FRONT_AND_BACK=e.gl.FRONT_AND_BACK,t.ContextConfig.DEPTH_BUFFER_BIT=e.gl.DEPTH_BUFFER_BIT,t.ContextConfig.ELEMENT_ARRAY_BUFFER=e.gl.ELEMENT_ARRAY_BUFFER,t.ContextConfig.UNSIGNED_SHORT=e.gl.UNSIGNED_SHORT,t.ContextConfig.NEAREST=e.gl.NEAREST,t.ContextConfig.REPEAT=e.gl.REPEAT,t.ContextConfig.ONE=e.gl.ONE,t.ContextConfig.ZERO=e.gl.ZERO,t.ContextConfig.SRC_ALPHA=e.gl.SRC_ALPHA,t.ContextConfig.ONE_MINUS_SRC_ALPHA=e.gl.ONE_MINUS_SRC_ALPHA,t.ContextConfig.SRC_COLOR=e.gl.SRC_COLOR,t.ContextConfig.ONE_MINUS_SRC_COLOR=e.gl.ONE_MINUS_SRC_COLOR,t.ContextConfig.ColorFormat_RGB565=e.gl.RGB565,t.ContextConfig.ColorFormat_RGBA5551=e.gl.RGB5_A1,t.ContextConfig.ColorFormat_RGBA4444=e.gl.RGBA4,t.ContextConfig.ColorFormat_RGBA8888=e.gl.RGBA,t.ContextConfig.DEPTH_TEST=e.gl.DEPTH_TEST,t.ContextConfig.CULL_FACE=e.gl.CULL_FACE,t.ContextConfig.BLEND=e.gl.BLEND,t.ContextConfig.LEQUAL=e.gl.LEQUAL,t.ContextSamplerType.TEXTURE_0=e.gl.TEXTURE0,t.ContextSamplerType.TEXTURE_1=e.gl.TEXTURE1,t.ContextSamplerType.TEXTURE_2=e.gl.TEXTURE2,t.ContextSamplerType.TEXTURE_3=e.gl.TEXTURE3,t.ContextSamplerType.TEXTURE_4=e.gl.TEXTURE4,t.ContextSamplerType.TEXTURE_5=e.gl.TEXTURE5,t.ContextSamplerType.TEXTURE_6=e.gl.TEXTURE6,t.ContextSamplerType.TEXTURE_7=e.gl.TEXTURE7,t.ContextSamplerType.TEXTURE_8=e.gl.TEXTURE8,console.log("requst GPU Config",e.gl),t.ShaderPool.register(this)},e.prototype.viewPort=function(i,r,a,n){e.gl.viewport(i,t.ContextConfig.canvasRectangle.height-n-r,a,n)},e.prototype.creatProgram=function(i,r){var a=e.gl.createProgram();e.gl.attachShader(a,i.shader),e.gl.attachShader(a,r.shader),e.gl.linkProgram(a);var n=e.gl.getProgramParameter(a,e.gl.LINK_STATUS);n||(alert("vsShader error"+e.gl.getShaderInfoLog(i.shader)),alert("fsShader error"+e.gl.getShaderInfoLog(r.shader)));var o=new t.Program3D(a);return o},e.prototype.creatIndexBuffer=function(i){var r=e.gl.createBuffer();e.gl.bindBuffer(e.gl.ELEMENT_ARRAY_BUFFER,r),e.gl.bufferData(e.gl.ELEMENT_ARRAY_BUFFER,i,e.gl.STATIC_DRAW);var a=new t.IndexBuffer3D(r);return a.arrayBuffer=i,a},e.prototype.uploadIndexBuffer=function(t){e.gl.bindBuffer(e.gl.ELEMENT_ARRAY_BUFFER,t.buffer),e.gl.bufferData(e.gl.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,e.gl.DYNAMIC_DRAW)},e.prototype.creatVertexBuffer=function(i,r){void 0===r&&(r=e.gl.STATIC_DRAW);var a=e.gl.createBuffer();e.gl.bindBuffer(e.gl.ARRAY_BUFFER,a),e.gl.bufferData(e.gl.ARRAY_BUFFER,i,r);var n=new t.VertexBuffer3D(a);return n.arrayBuffer=i,n},e.prototype.uploadVertexBuffer=function(t){e.gl.bindBuffer(e.gl.ARRAY_BUFFER,t.buffer),e.gl.bufferData(e.gl.ARRAY_BUFFER,t.arrayBuffer,e.gl.DYNAMIC_DRAW)},e.prototype.texParameteri=function(t,i,r){e.gl.texParameteri(t,i,r)},e.prototype.upLoadTextureData=function(i,r){e.gl.bindTexture(e.gl.TEXTURE_2D,r.texture2D.textureBuffer),r.texture2D.internalFormat==t.InternalFormat.ImageData?e.gl.texImage2D(e.gl.TEXTURE_2D,0,e.gl.RGBA,e.gl.RGBA,r.texture2D.dataFormat,r.texture2D.imageData):r.texture2D.internalFormat==t.InternalFormat.CompressData?this.upLoadCompressedTexture2D(i,r.texture2D):r.texture2D.internalFormat==t.InternalFormat.PixelArray&&e.gl.texImage2D(e.gl.TEXTURE_2D,i,r.texture2D.colorFormat,r.texture2D.mimapData[i].width,r.texture2D.mimapData[i].height,r.texture2D.border,r.texture2D.colorFormat,r.texture2D.dataFormat,r.texture2D.mimapData[i].data),r.useMipmap&&e.gl.generateMipmap(e.gl.TEXTURE_2D)},e.prototype.upLoadCompressedTexture2D=function(t,i){e.gl.compressedTexImage2D(e.gl.TEXTURE_2D,t,i.colorFormat,i.mimapData[t].width,i.mimapData[t].height,i.border,i.mimapData[t].data)},e.prototype.creatTexture=function(){return e.gl.createTexture()},e.prototype.uploadCubetexture=function(t){e.gl.bindTexture(e.gl.TEXTURE_CUBE_MAP,t.texture),t.image_right.mimapData&&t.image_right.mimapData.length>0?e.gl.texImage2D(e.gl.TEXTURE_CUBE_MAP_POSITIVE_X,0,e.gl.RGB,t.image_right.mimapData[0].width,t.image_right.mimapData[0].height,0,e.gl.RGB,e.gl.UNSIGNED_BYTE,t.image_right.mimapData[0].data):e.gl.texImage2D(e.gl.TEXTURE_CUBE_MAP_POSITIVE_X,0,e.gl.RGB,e.gl.RGB,e.gl.UNSIGNED_BYTE,t.image_right.imageData),t.image_left.mimapData&&t.image_left.mimapData.length>0?e.gl.texImage2D(e.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,0,e.gl.RGB,t.image_right.mimapData[0].width,t.image_right.mimapData[0].height,0,e.gl.RGB,e.gl.UNSIGNED_BYTE,t.image_right.mimapData[0].data):e.gl.texImage2D(e.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,0,e.gl.RGB,e.gl.RGB,e.gl.UNSIGNED_BYTE,t.image_left.imageData),t.image_left.mimapData&&t.image_left.mimapData.length>0?e.gl.texImage2D(e.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,0,e.gl.RGB,t.image_up.mimapData[0].width,t.image_up.mimapData[0].height,0,e.gl.RGB,e.gl.UNSIGNED_BYTE,t.image_up.mimapData[0].data):e.gl.texImage2D(e.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,0,e.gl.RGB,e.gl.RGB,e.gl.UNSIGNED_BYTE,t.image_up.imageData),t.image_left.mimapData&&t.image_left.mimapData.length>0?e.gl.texImage2D(e.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,e.gl.RGB,t.image_down.mimapData[0].width,t.image_down.mimapData[0].height,0,e.gl.RGB,e.gl.UNSIGNED_BYTE,t.image_down.mimapData[0].data):e.gl.texImage2D(e.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,e.gl.RGB,e.gl.RGB,e.gl.UNSIGNED_BYTE,t.image_down.imageData),t.image_left.mimapData&&t.image_left.mimapData.length>0?e.gl.texImage2D(e.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,0,e.gl.RGB,t.image_back.mimapData[0].width,t.image_back.mimapData[0].height,0,e.gl.RGB,e.gl.UNSIGNED_BYTE,t.image_back.mimapData[0].data):e.gl.texImage2D(e.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,0,e.gl.RGB,e.gl.RGB,e.gl.UNSIGNED_BYTE,t.image_back.imageData),t.image_left.mimapData&&t.image_left.mimapData.length>0?e.gl.texImage2D(e.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,e.gl.RGB,t.image_front.mimapData[0].width,t.image_front.mimapData[0].height,0,e.gl.RGB,e.gl.UNSIGNED_BYTE,t.image_front.mimapData[0].data):e.gl.texImage2D(e.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,e.gl.RGB,e.gl.RGB,e.gl.UNSIGNED_BYTE,t.image_front.imageData),e.gl.texParameteri(e.gl.TEXTURE_CUBE_MAP,e.gl.TEXTURE_MAG_FILTER,e.gl.LINEAR),e.gl.texParameteri(e.gl.TEXTURE_CUBE_MAP,e.gl.TEXTURE_MIN_FILTER,e.gl.LINEAR),e.gl.texParameteri(e.gl.TEXTURE_CUBE_MAP,e.gl.TEXTURE_WRAP_S,e.gl.CLAMP_TO_EDGE),e.gl.texParameteri(e.gl.TEXTURE_CUBE_MAP,e.gl.TEXTURE_WRAP_T,e.gl.CLAMP_TO_EDGE)},e.prototype.createFramebuffer=function(i,r,a){var n=e.gl.createFramebuffer(),o=new t.ContextTexture2D,s=e.gl.createRenderbuffer();switch(o.textureBuffer=o.textureBuffer||e.gl.createTexture(),e.gl.bindTexture(e.gl.TEXTURE_2D,o.textureBuffer),a){case t.FrameBufferFormat.UNSIGNED_BYTE_RGB:e.gl.texImage2D(e.gl.TEXTURE_2D,0,e.gl.RGB,i,r,0,e.gl.RGB,e.gl.UNSIGNED_BYTE,null);break;case t.FrameBufferFormat.UNSIGNED_BYTE_RGBA:e.gl.texImage2D(e.gl.TEXTURE_2D,0,e.gl.RGBA,i,r,0,e.gl.RGBA,e.gl.UNSIGNED_BYTE,null);break;case t.FrameBufferFormat.FLOAT_RGB:for(var h=new Float32Array(i*r*4),l=0;i*r>l;l++)h[l]=Math.random(),h[l+1]=Math.random(),h[l+2]=Math.random();e.gl.texImage2D(e.gl.TEXTURE_2D,0,e.gl.RGB,i,r,0,e.gl.RGB,e.gl.FLOAT,h);break;case t.FrameBufferFormat.FLOAT_RGBA:for(var h=new Float32Array(i*r*4),l=0;i*r>l;l++)h[l]=Math.random(),h[l+1]=Math.random(),h[l+2]=Math.random(),h[l+3]=Math.random();e.gl.texImage2D(e.gl.TEXTURE_2D,0,e.gl.RGBA,i,r,0,e.gl.RGBA,e.gl.FLOAT,h)}return e.gl.texParameteri(e.gl.TEXTURE_2D,e.gl.TEXTURE_MAG_FILTER,e.gl.NEAREST),e.gl.texParameteri(e.gl.TEXTURE_2D,e.gl.TEXTURE_MIN_FILTER,e.gl.NEAREST),e.gl.texParameteri(e.gl.TEXTURE_2D,e.gl.TEXTURE_WRAP_S,e.gl.CLAMP_TO_EDGE),e.gl.texParameteri(e.gl.TEXTURE_2D,e.gl.TEXTURE_WRAP_T,e.gl.CLAMP_TO_EDGE),e.gl.bindFramebuffer(e.gl.FRAMEBUFFER,n),e.gl.framebufferTexture2D(e.gl.FRAMEBUFFER,e.gl.COLOR_ATTACHMENT0,e.gl.TEXTURE_2D,o.textureBuffer,0),e.gl.bindRenderbuffer(e.gl.RENDERBUFFER,s),e.gl.renderbufferStorage(e.gl.RENDERBUFFER,e.gl.DEPTH_COMPONENT16,i,r),o.width=i,o.height=r,o.frameBuffer=n,o.renderbuffer=s,e.gl.bindFramebuffer(e.gl.FRAMEBUFFER,null),e.gl.bindTexture(e.gl.TEXTURE_2D,null),e.gl.bindRenderbuffer(e.gl.RENDERBUFFER,null),o},e.prototype.setRenderToTexture=function(t,i,r){void 0===i&&(i=!1),void 0===r&&(r=0),e.gl.viewport(0,0,t.width,t.height),e.gl.scissor(0,0,t.width,t.height),e.gl.bindFramebuffer(e.gl.FRAMEBUFFER,t.frameBuffer),e.gl.clearColor(0,0,0,1),e.gl.clear(e.gl.COLOR_BUFFER_BIT|e.gl.DEPTH_BUFFER_BIT),e.gl.framebufferTexture2D(e.gl.FRAMEBUFFER,e.gl.COLOR_ATTACHMENT0,e.gl.TEXTURE_2D,t.textureBuffer,0),e.gl.framebufferRenderbuffer(e.gl.FRAMEBUFFER,e.gl.DEPTH_ATTACHMENT,e.gl.RENDERBUFFER,t.renderbuffer)},e.prototype.setRenderToBackBuffer=function(){e.gl.bindTexture(e.gl.TEXTURE_2D,null),e.gl.bindFramebuffer(e.gl.FRAMEBUFFER,null),e.gl.bindRenderbuffer(e.gl.RENDERBUFFER,null)},e.prototype.creatVertexShader=function(i){var r=e.gl.createShader(e.gl.VERTEX_SHADER);e.gl.shaderSource(r,i),e.gl.compileShader(r);var a=new t.Shader(r);return a.id=(t.Shader.ID_COUNT++).toString(),a},e.prototype.creatFragmentShader=function(i){var r=e.gl.createShader(e.gl.FRAGMENT_SHADER);e.gl.shaderSource(r,i),e.gl.compileShader(r);var a=new t.Shader(r);return a.id=(t.Shader.ID_COUNT++).toString(),a},e.prototype.clear=function(t){e.gl.clear(t)},e.prototype.clearColor=function(t,i,r,a){e.gl.clearColor(t,i,r,a)},e.prototype.clearStencil=function(t){e.gl.clearStencil(t)},e.prototype.setProgram=function(t){this.programChange=!1,this.program!=t&&(this.programChange=!0,this.program=t,e.gl.useProgram(t.program))},e.prototype.getUniformLocation=function(t,i){return e.gl.getUniformLocation(t.program,i)},e.prototype.uniform1f=function(t,i){e.gl.uniform1f(t,i)},e.prototype.uniform1fv=function(t,i){e.gl.uniform1fv(t,i)},e.prototype.uniform1i=function(t,i){e.gl.uniform1i(t,i)},e.prototype.uniform1iv=function(t,i){e.gl.uniform1iv(t,i)},e.prototype.uniform2f=function(t,i,r){e.gl.uniform2f(t,i,r)},e.prototype.uniform2fv=function(t,i){e.gl.uniform2fv(t,i)},e.prototype.uniform2i=function(t,i,r){e.gl.uniform2i(t,i,r)},e.prototype.uniform2iv=function(t,i){e.gl.uniform2iv(t,i)},e.prototype.uniform3f=function(t,i,r,a){e.gl.uniform3f(t,i,r,a)},e.prototype.uniform3fv=function(t,i){e.gl.uniform3fv(t,i)},e.prototype.uniform3i=function(t,i,r,a){e.gl.uniform3i(t,i,r,a)},e.prototype.uniform3iv=function(t,i){e.gl.uniform3iv(t,i)},e.prototype.uniform4f=function(t,i,r,a,n){e.gl.uniform4f(t,i,r,a,n)},e.prototype.uniform4fv=function(t,i){e.gl.uniform4fv(t,i)},e.prototype.uniform4i=function(t,i,r,a,n){e.gl.uniform4i(t,i,r,a,n)},e.prototype.uniform4iv=function(t,i){e.gl.uniform4iv(t,i)},e.prototype.uniformMatrix2fv=function(t,i,r){e.gl.uniformMatrix2fv(t,i,r)},e.prototype.uniformMatrix3fv=function(t,i,r){e.gl.uniformMatrix3fv(t,i,r)},e.prototype.uniformMatrix4fv=function(t,i,r){e.gl.uniformMatrix4fv(t,i,r)},e.prototype.setBlendFactors=function(t,i){(this.blend_Factors_src!=t||this.blend_Factors_dst!=i)&&(this.blend_Factors_src=t,this.blend_Factors_dst=i,e.gl.blendFunc(t,i))},e.prototype.setCulling=function(t){this.cullingMode!=t&&(this.cullingMode=t,e.gl.cullFace(t))},e.prototype.enableDepth=function(){this.DEPTH_TEST||(this.DEPTH_TEST=!0,e.gl.enable(t.ContextConfig.DEPTH_TEST))},e.prototype.disableDepth=function(){this.DEPTH_TEST&&(this.DEPTH_TEST=!1,e.gl.disable(t.ContextConfig.DEPTH_TEST))},e.prototype.enableCullFace=function(){this.CULL_FACE||(this.CULL_FACE=!0,e.gl.enable(t.ContextConfig.CULL_FACE))},e.prototype.disableCullFace=function(){this.CULL_FACE&&(this.CULL_FACE=!1,e.gl.disable(t.ContextConfig.CULL_FACE))},e.prototype.enableBlend=function(){e.gl.enable(t.ContextConfig.BLEND)},e.prototype.disableBlend=function(){e.gl.disable(t.ContextConfig.BLEND)},e.prototype.depthFunc=function(t){void 0===t&&(t=0),this.depthCompareMode!=t&&(this.depthCompareMode=t,e.gl.depthFunc(t))},e.prototype.enableDepthTest=function(t,i){void 0===i&&(i=0),t&&e.gl.enable(e.gl.DEPTH_TEST)},e.prototype.getShaderAttribLocation=function(t,i){return e.gl.getAttribLocation(t.program,i)},e.prototype.vertexAttribPointer=function(t,i,r,a,n,o){e.gl.vertexAttribPointer(t,i,r,a,n,o),e.gl.enableVertexAttribArray(t)},e.prototype.activeAttribPointer=function(t){for(var i=0;8>i;i++)e.gl.disableVertexAttribArray(i);return this.cacheVertexFormat=t,this.cacheVertexFormat==t},e.prototype.setVertexShaderConstData=function(t,i,r){e.gl.vertexAttrib4fv(i,t.subarray(i,r))},e.prototype.setFragmentShaderConstData=function(){},e.prototype.setTexture2DAt=function(t,i,r,a){e.gl.activeTexture(t),e.gl.bindTexture(e.gl.TEXTURE_2D,a.textureBuffer),e.gl.uniform1i(i,r)},e.prototype.disableTexture2DAt=function(){},e.prototype.setCubeTextureAt=function(t,i,r,a){a&&(e.gl.activeTexture(t),e.gl.bindTexture(e.gl.TEXTURE_CUBE_MAP,a.texture),e.gl.uniform1i(i,r))},e.prototype.setScissorRectangle=function(i,r,a,n){e.gl.scissor(i,t.ContextConfig.canvasRectangle.height-n-r,a,n)},e.prototype.setStencilReferenceValue=function(){},e.prototype.setStencilActions=function(){},e.prototype.bindVertexBuffer=function(t){e.gl.bindBuffer(e.gl.ARRAY_BUFFER,t.buffer)},e.prototype.bindIndexBuffer=function(t){e.gl.bindBuffer(e.gl.ELEMENT_ARRAY_BUFFER,t.buffer)},e.prototype.drawArrays=function(t,i,r){e.gl.drawArrays(t,i,r)},e.prototype.drawElement=function(t,i,r){e.gl.drawElements(t,r,e.gl.UNSIGNED_SHORT,i)},e.prototype.flush=function(){e.gl.flush()},e}();t.Context3DProxy=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){}return t}();t.FrameBuffer=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(t){this.buffer=t}return e.prototype.dispose=function(){this.buffer&&(t.Context3DProxy.gl.deleteBuffer(this.buffer),this.buffer=null),this.arrayBuffer&&(this.arrayBuffer.length=0)},e}();t.IndexBuffer3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(t){this.buffer=t}return e.prototype.dispose=function(){this.buffer&&(t.Context3DProxy.gl.deleteBuffer(this.buffer),this.buffer=null),this.arrayBuffer&&(this.arrayBuffer.length=0)},e}();t.VertexBuffer3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(t,e,i){this.data=t,this.width=e,this.height=i}return t}();t.MipmapData=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(t){this.program=t}return t}();t.Program3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(t){this._shader=t}return Object.defineProperty(t.prototype,"shader",{get:function(){return this._shader},enumerable:!0,configurable:!0}),t.vertex=0,t.fragment=1,t.ID_COUNT=0,t}();t.Shader=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.border=0,this.imageData=null}return e.prototype.dispose=function(){this.textureBuffer&&(t.Context3DProxy.gl.deleteTexture(this.textureBuffer),this.textureBuffer=null),this.frameBuffer&&(t.Context3DProxy.gl.deleteFramebuffer(this.frameBuffer),this.frameBuffer=null),this.renderbuffer&&(t.Context3DProxy.gl.deleteRenderbuffer(this.renderbuffer),this.renderbuffer=null)},e}();t.ContextTexture2D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.border=0,this.useMipmap=!0,this.colorformat=t.ContextConfig.ColorFormat_RGBA8888,this.internalformat=t.InternalFormat.PixelArray,this.mimapData=new Array}return e.prototype.dispose=function(){this.texture&&(t.Context3DProxy.gl.deleteTexture(this.texture),this.texture=null),this.image_front&&(this.image_front.dispose(),this.image_front=null),this.image_back&&(this.image_back.dispose(),this.image_back=null),this.image_left&&(this.image_left.dispose(),this.image_left=null),this.image_right&&(this.image_right.dispose(),this.image_right=null),this.image_up&&(this.image_up.dispose(),this.image_up=null),this.image_down&&(this.image_down.dispose(),this.image_down=null)},e}();t.ContextTexture3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t.BoundPick=0]="BoundPick",t[t.PositionPick=1]="PositionPick",t[t.UVPick=2]="UVPick"}(t.PickType||(t.PickType={}));var e=t.PickType,i=function(i){function r(){i.call(this),this._modelMatrix3D=new t.Matrix4_4,this._transformChange=!0,this._pos=new t.Vector3D,this._rot=new t.Vector3D,this._sca=new t.Vector3D(1,1,1),this._orientation=new t.Quaternion,this._axis=new t.Vector3D,this._angle=0,this._globalPos=new t.Vector3D,this._globalRot=new t.Vector3D,this._globalSca=new t.Vector3D(1,1,1),this._globalOrientation=new t.Quaternion,this._qut=new t.Quaternion,this._vec=new t.Vector3D,this._active=!1,this._isRoot=!0,this.canPick=!1,this.renderLayer=0,this.name="",this.id=0,this.layer=0,this.tag=new t.Tag,this.parent=null,this.childs=new Array,this.isController=!0,this.visible=!0,this.pickType=e.BoundPick,this.pickResult=new t.PickResult,this.enablePick=!1,this.mouseChildren=!1,this.enableCulling=!0,this.id=++r.s_id}return __extends(r,i),Object.defineProperty(r.prototype,"bound",{get:function(){return this._bound},set:function(t){this._bound=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"currentBound",{get:function(){return this.mouseChildren?this.bound.childBound:this.bound},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"position",{get:function(){return this._pos},set:function(t){(this._pos.x!=t.x||this._pos.y!=t.y||this._pos.z!=t.z)&&(this.updateTransformChange(!0),this._pos.copyFrom(t))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rotation",{get:function(){return this._rot},set:function(t){(this._rot.x!=t.x||this._rot.y!=t.y||this._rot.z!=t.z)&&(this._rot.x=t.x,this._rot.y=t.y,this._rot.z=t.z,this._orientation.fromEulerAngles(this._rot.x,this._rot.y,this._rot.z),this._angle=this._orientation.toAxisAngle(this._axis),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"orientation",{get:function(){return this._orientation},set:function(t){(this._orientation.x!=t.x||this._orientation.y!=t.y||this._orientation.z!=t.z||this._orientation.w!=t.w)&&(this._orientation.copyFrom(t),this._orientation.toEulerAngles(this._rot),this._angle=this._orientation.toAxisAngle(this._axis),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"orientationX",{set:function(t){this._orientation.x!=t&&(this._orientation.x=t,this._orientation.toEulerAngles(this._rot),this._angle=this._orientation.toAxisAngle(this._axis),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"orientationY",{set:function(t){this._orientation.y!=t&&(this._orientation.y=t,this._orientation.toEulerAngles(this._rot),this._angle=this._orientation.toAxisAngle(this._axis),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"orientationZ",{set:function(t){this._orientation.z!=t&&(this._orientation.z=t,this._orientation.toEulerAngles(this._rot),this._angle=this._orientation.toAxisAngle(this._axis),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"orientationW",{set:function(t){this._orientation.w!=t&&(this._orientation.w=t,this._orientation.toEulerAngles(this._rot),this._angle=this._orientation.toAxisAngle(this._axis),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scale",{get:function(){return this._sca},set:function(t){(this._sca.x!=t.x||this._sca.y!=t.y||this._sca.z!=t.z)&&(this.updateTransformChange(!0),this._sca=t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"x",{get:function(){return this._pos.x},set:function(t){this._pos.x!=t&&(this._pos.x=t,this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._pos.y},set:function(t){this._pos.y!=t&&(this._pos.y=t,this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"z",{get:function(){return this._pos.z},set:function(t){this._pos.z!=t&&(this._pos.z=t,this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rotationX",{get:function(){return this._rot.x},set:function(t){this._rot.x!=t&&(this._rot.x=t,this._orientation.fromEulerAngles(this._rot.x,this._rot.y,this._rot.z),this._angle=this._orientation.toAxisAngle(this._axis),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rotationY",{get:function(){return this._rot.y},set:function(t){this._rot.y!=t&&(this._rot.y=t,this._orientation.fromEulerAngles(this._rot.x,this._rot.y,this._rot.z),this._angle=this._orientation.toAxisAngle(this._axis),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rotationZ",{get:function(){return this._rot.z},set:function(t){this._rot.z!=t&&(this._rot.z=t,this._orientation.fromEulerAngles(this._rot.x,this._rot.y,this._rot.z),this._angle=this._orientation.toAxisAngle(this._axis),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleX",{get:function(){return this._sca.x},set:function(t){this._sca.x!=t&&(this._sca.x=t,this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleY",{get:function(){return this._sca.y},set:function(t){this._sca.y!=t&&(this._sca.y=t,this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleZ",{get:function(){return this._sca.z},set:function(t){this._sca.z!=t&&(this._sca.z=t,this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),r.prototype.setRotationFromAxisAngle=function(t,e){t.normalize(),this.updateTransformChange(!0),this._orientation.fromAxisAngle(t,e),this._orientation.toEulerAngles(this._rot),this._axis.copyFrom(t),this._angle=e},Object.defineProperty(r.prototype,"modelMatrix",{get:function(){return this._transformChange&&this.updateModelMatrix(),this._modelMatrix3D},set:function(e){var i=e.decompose(t.Orientation3D.QUATERNION);this.globalPosition=i[0],t.MathUtil.CALCULATION_QUATERNION.x=i[1].x,t.MathUtil.CALCULATION_QUATERNION.y=i[1].y,t.MathUtil.CALCULATION_QUATERNION.z=i[1].z,t.MathUtil.CALCULATION_QUATERNION.w=i[1].w,this.globalOrientation=t.MathUtil.CALCULATION_QUATERNION,this.globalScale=i[2]},enumerable:!0,configurable:!0}),r.prototype.updateModelMatrix=function(){if(null!=this.parent){var t=this.parent.globalOrientation;this._globalOrientation.multiply(t,this._orientation),this._globalOrientation.toEulerAngles(this._globalRot);var e=this.parent.globalScale;this._globalSca.copyFrom(e.multiply(this._sca)),t.transformVector(e.multiply(this._pos),this._globalPos),this._globalPos.copyFrom(this._globalPos.add(this.parent.globalPosition))}else this._globalOrientation.copyFrom(this._orientation),this._globalPos.copyFrom(this._pos),this._globalSca.copyFrom(this._sca),this._globalRot.copyFrom(this._rot);this.onMakeTransform(),this._transformChange=!1,this.onUpdateTransform()},r.prototype.onUpdateTransform=function(){},r.prototype.onMakeTransform=function(){this._modelMatrix3D.makeTransform(this._globalPos,this._globalSca,this._globalOrientation)},Object.defineProperty(r.prototype,"globalX",{get:function(){return this.globalPosition.x},set:function(t){this._vec.copyFrom(this.globalPosition),this._vec.x=t,this.globalPosition=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"globalY",{get:function(){return this.globalPosition.y},set:function(t){this._vec.copyFrom(this.globalPosition),this._vec.y=t,this.globalPosition=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"globalZ",{get:function(){return this.globalPosition.z},set:function(t){this._vec.copyFrom(this.globalPosition),this._vec.z=t,this.globalPosition=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"globalPosition",{get:function(){return this._transformChange&&this.modelMatrix,this._globalPos},set:function(t){this.parent?(this.parent.globalOrientation.inverse(this._qut),t.subtract(this.parent.globalPosition,this._vec),this._qut.transformVector(this._vec,this._vec),this._vec.divided(this.parent.globalScale,this._vec),this.position=this._vec):this.position=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"globalRotationX",{get:function(){return this.globalRotation.x},set:function(t){this._vec.copyFrom(this.globalRotation),this._vec.x=t,this.globalRotation=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"globalRotationY",{get:function(){return this.globalRotation.y},set:function(t){this._vec.copyFrom(this.globalRotation),this._vec.y=t,this.globalRotation=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"globalRotationZ",{get:function(){return this.globalRotation.z},set:function(t){this._vec.copyFrom(this.globalRotation),this._vec.z=t,this.globalRotation=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"globalRotation",{get:function(){return this._transformChange&&this.modelMatrix,this._globalRot},set:function(t){this._qut.fromEulerAngles(t.x,t.y,t.z),this.globalOrientation=this._qut},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"globalScale",{get:function(){return this._transformChange&&this.modelMatrix,this._globalSca},set:function(t){this.parent?(t.divided(this.parent.globalScale,this._vec),this.scale=this._vec):this.scale=t
},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"globalScaleX",{get:function(){return this.globalScale.x},set:function(t){this._vec.copyFrom(this.globalScale),this._vec.x=t,this.globalScale=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"globalScaleY",{get:function(){return this.globalScale.y},set:function(t){this._vec.copyFrom(this.globalScale),this._vec.y=t,this.globalScale=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"globalScaleZ",{get:function(){return this.globalScale.z},set:function(t){this._vec.copyFrom(this.globalScale),this._vec.z=t,this.globalScale=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"globalOrientation",{get:function(){return this._transformChange&&this.modelMatrix,this._globalOrientation},set:function(t){this.parent?(this.parent.globalOrientation.inverse(this._qut),this._qut.multiply(this._qut,t),this.orientation=this._qut):this.orientation=t},enumerable:!0,configurable:!0}),r.prototype.addChild=function(t){return t.parent&&t.parent.removeChild(t),this.childs.indexOf(t)>=0&&this.removeChild(t),this.childs.push(t),t.parent=this,t._isRoot=!1,t.updateTransformChange(!0),t},r.prototype.addChildAt=function(t,e){return 0>e?this.childs.splice(0,0,t):e>=this.childs.length?this.childs.push(t):this.childs.splice(e,0,t),t.parent=this,t.updateTransformChange(!0),t},r.prototype.getChildAt=function(t){return 0>t||t>=this.childs.length?null:this.childs[t]},r.prototype.getChildIndex=function(t){for(var e=0;e<this.childs.length;++e)if(this.childs[e]==t)return e;return-1},r.prototype.removeChild=function(t){var e=this.childs.indexOf(t);return 0>e?null:(t.parent=null,this.childs.splice(e,1),t.updateTransformChange(!0),t)},r.prototype.removeChildAt=function(t){if(0>t||t>=this.childs.length)return null;var e=this.childs[t];return e.parent=null,this.childs.splice(t,1),e.updateTransformChange(!0),e},r.prototype.setChildIndex=function(t,e){for(var i=0;i<this.childs.length;++i)if(this.childs[i]==t){if(i==e)return;if(e>i)for(var r=i;r>e;--r)this.childs[r]=this.childs[r-1];else if(i>e)for(var r=i;e>r;++r)this.childs[r]=this.childs[r+1];return void(this.childs[e]=t)}},r.prototype.swapObject=function(t){for(var e=t.parent,i=new Array,r=0;r<t.childs.length;++r)i[r]=t.childs[r];if(this.parent){var a=this.parent.getChildIndex(this);this.parent.childs[a]=t}if(t.parent){var a=t.parent.getChildIndex(t);t.parent.childs[a]=this}t.parent=this.parent,this.parent=e,t.childs.length=0;for(var r=0;r<this.childs.length;++r)t.childs[r]=this.childs[r],t.childs[r].parent=t;this.childs.length=0;for(var r=0;r<i.length;++r)this.childs[r]=i[r],this.childs[r].parent=this;this.updateTransformChange(!0),t.updateTransformChange(!0)},r.prototype.swapChildren=function(t,e){for(var i=0,r=0;i<this.childs.length;++i)if(this.childs[i]==t){for(;r<this.childs.length;++r)if(this.childs[r]==e){var a=this.childs[i];this.childs[i]=this.childs[r],this.childs[r]=a;break}return}},r.prototype.swapChildrenAt=function(t,e){if(!(0>t||t>=this.childs.length||0>e||e>=this.childs.length)){var i=this.childs[t];this.childs[t]=this.childs[e],this.childs[e]=i}},r.prototype.lookAt=function(e,i,r){void 0===r&&(r=t.Vector3D.Y_AXIS)},Object.defineProperty(r.prototype,"lookAtPosition",{get:function(){return new t.Vector3D},enumerable:!0,configurable:!0}),r.prototype.findObject3D=function(t){for(var e=null,i=0;i<this.childs.length;++i){if(this.childs[i].name==t)return e=this.childs[i];if(e=this.childs[i].findObject3D(t))return e}return e},r.prototype.findObject3DToID=function(t){for(var e=null,i=0;i<this.childs.length;++i){if(this.childs[i].id==t)return e=this.childs[i];if(e=this.childs[i].findObject3DToID(t))return e}return e},r.prototype.updateTransformChange=function(t){this._transformChange=t;for(var e=0;e<this.childs.length;++e)this.childs[e].updateTransformChange(t)},r.prototype.bindAnimation=function(t){this.proAnimation=t,this.proAnimation.bindObject3D(this)},r.prototype.update=function(t,e){this.proAnimation&&this.proAnimation.update(e)},r.prototype.dispose=function(){this.parent&&this.parent.removeChild(this);for(var t=0;t<this.childs.length;t++)this.childs[t].dispose();this.childs.length=0},Object.defineProperty(r.prototype,"root",{get:function(){return this.parent?this.parent.root:this},enumerable:!0,configurable:!0}),r.s_id=0,r}(t.EventDispatcher);t.Object3D=i}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(t){function e(){t.call(this),this.type="",this.multiMaterial={},this._materialCount=0,this.animation=null}return __extends(e,t),Object.defineProperty(e.prototype,"drawOrder",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lightGroup",{get:function(){return this._lightGroup},set:function(t){this._lightGroup=t;for(var e in this.multiMaterial)this.multiMaterial[e].lightGroup=this._lightGroup},enumerable:!0,configurable:!0}),e.prototype.addSubMaterial=function(t,e){this.multiMaterial[t]||this._materialCount++,this.multiMaterial[t]=e,e.lightGroup=this._lightGroup},e.prototype.removeSubMaterial=function(t){this.multiMaterial[t]&&(delete this.multiMaterial[t],this._materialCount--)},e.prototype.getMaterial=function(t){return this.multiMaterial[t]},e.prototype.materialCount=function(){return this._materialCount},e.prototype.update=function(e,i,r){t.prototype.update.call(this,e,i,r),this.animation&&this.animation.update(e,i,this.geometry),this.geometry.subGeometrys.length<=0&&this.geometry.buildDefaultSubGeometry()},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.geometry&&(this.geometry.dispose(),this.geometry=null)},e}(t.Object3D);t.IRender=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e}(t.Object3D);t.Entity=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r,a){void 0===r&&(r=null),void 0===a&&(a=null),e.call(this),this.type="mesh",this.geometry=i,a?this.animation=a:i&&this.geometry.vertexFormat&t.VertexFormat.VF_SKIN&&(this.animation=new t.SkeletonAnimation),this.material=r?r:new t.TextureMaterial,this.addSubMaterial(0,this.material),this.bound=this.buildBoundBox()}return __extends(i,e),Object.defineProperty(i.prototype,"aabb",{get:function(){return this._aabbBox},enumerable:!0,configurable:!0}),i.prototype.initAABB=function(){this._aabbBox=new t.QuadAABB,this.calcGlobalQuadAABB()},i.prototype.calcGlobalQuadAABB=function(){var t=this.bound,e=this.modelMatrix;i.AABB_BL_2.setTo(t.min.x,t.min.y,t.min.z),i.AABB_BR_2.setTo(t.max.x,t.min.y,t.min.z),i.AABB_TL_2.setTo(t.min.x,t.max.y,t.min.z),i.AABB_TR_2.setTo(t.max.x,t.max.y,t.min.z),i.AABB_BL_1.setTo(t.min.x,t.min.y,t.max.z),i.AABB_BR_1.setTo(t.max.x,t.min.y,t.max.z),i.AABB_TL_1.setTo(t.min.x,t.max.y,t.max.z),i.AABB_TR_1.setTo(t.max.x,t.max.y,t.max.z),e.transformVector(i.AABB_BL_2,i.AABB_BL_2),e.transformVector(i.AABB_BR_2,i.AABB_BR_2),e.transformVector(i.AABB_TL_2,i.AABB_TL_2),e.transformVector(i.AABB_TR_2,i.AABB_TR_2),e.transformVector(i.AABB_BL_1,i.AABB_BL_1),e.transformVector(i.AABB_BR_1,i.AABB_BR_1),e.transformVector(i.AABB_TL_1,i.AABB_TL_1),e.transformVector(i.AABB_TR_1,i.AABB_TR_1),this._aabbBox.maxPosX=Math.max(i.AABB_TL_2.x,i.AABB_TR_2.x,i.AABB_BL_2.x,i.AABB_BR_2.x,i.AABB_TL_1.x,i.AABB_TR_1.x,i.AABB_BL_1.x,i.AABB_BR_1.x),this._aabbBox.maxPosY=Math.max(i.AABB_TL_2.y,i.AABB_TR_2.y,i.AABB_BL_2.y,i.AABB_BR_2.y,i.AABB_TL_1.y,i.AABB_TR_1.y,i.AABB_BL_1.y,i.AABB_BR_1.y),this._aabbBox.minPosX=Math.min(i.AABB_TL_2.x,i.AABB_TR_2.x,i.AABB_BL_2.x,i.AABB_BR_2.x,i.AABB_TL_1.x,i.AABB_TR_1.x,i.AABB_BL_1.x,i.AABB_BR_1.x),this._aabbBox.minPosY=Math.min(i.AABB_TL_2.y,i.AABB_TR_2.y,i.AABB_BL_2.y,i.AABB_BR_2.y,i.AABB_TL_1.y,i.AABB_TR_1.y,i.AABB_BL_1.y,i.AABB_BR_1.y)},Object.defineProperty(i.prototype,"isTriangle",{get:function(){return!1},enumerable:!0,configurable:!0}),i.prototype.onUpdateTransform=function(){this._aabbBox.setOffset(this._pos)},i.prototype.clone=function(){var t=null;this.animation&&(t=this.animation.clone());var e=new i(this.geometry,this.material,t);return e.multiMaterial=this.multiMaterial,e},i.prototype.buildBoundBox=function(){var e=new t.BoundBox(this);if(this.geometry&&this.geometry.vertexArray){e.min.copyFrom(new t.Vector3D(t.MathUtil.MAX_VALUE,t.MathUtil.MAX_VALUE,t.MathUtil.MAX_VALUE)),e.max.copyFrom(new t.Vector3D(-t.MathUtil.MAX_VALUE,-t.MathUtil.MAX_VALUE,-t.MathUtil.MAX_VALUE));for(var i=0;i<this.geometry.vertexArray.length;i+=this.geometry.vertexAttLength)e.max.x<this.geometry.vertexArray[i]&&(e.max.x=this.geometry.vertexArray[i]),e.max.y<this.geometry.vertexArray[i+1]&&(e.max.y=this.geometry.vertexArray[i+1]),e.max.z<this.geometry.vertexArray[i+2]&&(e.max.z=this.geometry.vertexArray[i+2]),e.min.x>this.geometry.vertexArray[i]&&(e.min.x=this.geometry.vertexArray[i]),e.min.y>this.geometry.vertexArray[i+1]&&(e.min.y=this.geometry.vertexArray[i+1]),e.min.z>this.geometry.vertexArray[i+2]&&(e.min.z=this.geometry.vertexArray[i+2])}return e.fillBox(e.min,e.max),e.createChild(),this.bound=e,this.initAABB(),e},i.AABB_TL_1=new t.Vector3D,i.AABB_TR_1=new t.Vector3D,i.AABB_BL_1=new t.Vector3D,i.AABB_BR_1=new t.Vector3D,i.AABB_TL_2=new t.Vector3D,i.AABB_TR_2=new t.Vector3D,i.AABB_BL_2=new t.Vector3D,i.AABB_BR_2=new t.Vector3D,i}(t.IRender);t.Mesh=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r,a,n){void 0===r&&(r=null),void 0===a&&(a=100),void 0===n&&(n=100),null==r&&(r=new t.PlaneGeometry(a,n,1,1,1,1,t.Vector3D.Z_AXIS)),e.call(this,r,i),this.bound||(this.bound=this.buildBoundBox())}return __extends(i,e),i.prototype.update=function(t,e,i){this.globalOrientation=i.globalOrientation},i}(t.Mesh);t.Billboard=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r,a){void 0===a&&(a=null),e.call(this,i,r),this.camera=a,r.cullMode=t.ContextConfig.FRONT,this.bound||(this.bound=this.buildBoundBox())}return __extends(i,e),i.prototype.update=function(t,i,r){e.prototype.update.call(this,t,i,r),this.camera&&(this.position=this.camera.globalPosition)},i}(t.Mesh);t.Sky=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.type="wireframe",this.geometry=new t.Geometry,this.material=new t.ColorMaterial(16711680),this.addSubMaterial(0,this.material),this.material.drawMode=t.DrawMode.LINES,this.geometry.vertexFormat=t.VertexFormat.VF_POSITION|t.VertexFormat.VF_NORMAL|t.VertexFormat.VF_COLOR|t.VertexFormat.VF_UV0}return __extends(i,e),i}(t.IRender);t.Wireframe=e}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t.LT=0]="LT",t[t.RT=1]="RT",t[t.LB=2]="LB",t[t.RB=3]="RB",t[t.TC=4]="TC",t[t.BC=5]="BC",t[t.LC=6]="LC",t[t.RC=7]="RC",t[t.OC=8]="OC"}(t.NP||(t.NP={}));var e=t.NP,i=function(){function t(){this.c1=100,this.c2=20}return t}();t.LODTree=i;var r=function(){function i(e,i,r,a){void 0===e&&(e=null),void 0===i&&(i=null),void 0===r&&(r=0),void 0===a&&(a=0),this.content=[],this.chlids=[],this.level=0,this.center=new t.Vector3D,this.radius=0,this.parent=e,this.vertexDatas=i,this.parent&&(this.level=this.parent.level+1),0!=r&&0!=a&&this.createNode(0,r,(a+1)*r,(a+1)*(r+1)-1),this.parent||this.findNeighbour(this,r,a)}return i.prototype.createNode=function(t,r,a,n){if(this.content[e.LT]=t,this.content[e.RT]=r,this.content[e.LB]=a,this.content[e.RB]=n,this.vertexDatas&&this.processSphere(),this.content[e.RT]-this.content[e.LT]>1){var o=null,s=Math.floor((this.content[e.LT]+this.content[e.RT])/2),h=Math.floor((this.content[e.LB]+this.content[e.RB])/2),l=Math.floor((this.content[e.LT]+this.content[e.LB])/2),u=Math.floor((this.content[e.RT]+this.content[e.RB])/2),c=Math.floor((this.content[e.LT]+this.content[e.RB])/2);this.content[e.TC]=s,this.content[e.BC]=h,this.content[e.LC]=l,this.content[e.RC]=u,this.content[e.OC]=c,o=new i(this,this.vertexDatas),this.chlids[e.LT]=o,o.createNode(t,s,l,c),o=new i(this,this.vertexDatas),this.chlids[e.RT]=o,o.createNode(s,r,c,u),o=new i(this,this.vertexDatas),this.chlids[e.LB]=o,o.createNode(l,c,a,h),o=new i(this,this.vertexDatas),this.chlids[e.RB]=o,o.createNode(c,u,h,n)}},i.prototype.createIndex=function(t,i,r,a){if(void 0===a&&(a=10),!this.isVisable(r.frustum))return t;if(this.content[e.RT]-this.content[e.LT]<=1)return i[t++]=this.content[e.LT],i[t++]=this.content[e.RB],i[t++]=this.content[e.LB],i[t++]=this.content[e.LT],i[t++]=this.content[e.RT],i[t++]=this.content[e.RB],t;if(!this.isDivide(r,a)){var n=!1,o=!1,s=!1,h=!1,l=0;return this.chlids[4]&&(n=this.chlids[4].isDivide(r,a)),this.chlids[5]&&(o=this.chlids[5].isDivide(r,a)),this.chlids[6]&&(s=this.chlids[6].isDivide(r,a)),this.chlids[7]&&(h=this.chlids[7].isDivide(r,a)),i[t++]=this.content[e.LT],i[t++]=this.content[e.RB],i[t++]=this.content[e.LB],i[t++]=this.content[e.LT],i[t++]=this.content[e.RT],i[t++]=this.content[e.RB],n||o||s||h?(n&&(l=(this.content[e.LT]+this.content[e.RT])/2,i[t++]=this.content[e.LT],i[t++]=l,i[t++]=this.content[e.RT]),o&&(l=(this.content[e.LB]+this.content[e.RB])/2,i[t++]=l,i[t++]=this.content[e.LB],i[t++]=this.content[e.RB]),s&&(l=(this.content[e.LT]+this.content[e.LB])/2,i[t++]=this.content[e.LB],i[t++]=l,i[t++]=this.content[e.LT]),h&&(l=(this.content[e.RT]+this.content[e.RB])/2,i[t++]=this.content[e.RT],i[t++]=l,i[t++]=this.content[e.RB]),t):t}return this.chlids[0]&&(t=this.chlids[e.LT].createIndex(t,i,r,a),t=this.chlids[e.RT].createIndex(t,i,r,a),t=this.chlids[e.LB].createIndex(t,i,r,a),t=this.chlids[e.RB].createIndex(t,i,r,a)),t},i.prototype.isVisable=function(t){return t.inSphere(this.center,this.radius)},i.prototype.getVertex=function(t,e){e[0]=this.vertexDatas[3*t+0],e[1]=this.vertexDatas[3*t+1],e[2]=this.vertexDatas[3*t+2]},i.prototype.processSphere=function(){i.v0.length=0,i.v1.length=0,i.v2.length=0,i.v3.length=0,this.getVertex(this.content[e.LT],i.v0),this.getVertex(this.content[e.RT],i.v1),this.getVertex(this.content[e.LB],i.v2),this.getVertex(this.content[e.RB],i.v3),i.v4[0]=Math.min(i.v0[0],i.v1[0]),i.v4[0]=Math.min(i.v4[0],i.v2[0]),i.v4[0]=Math.min(i.v4[0],i.v3[0]),i.v4[1]=Math.min(i.v0[1],i.v1[1]),i.v4[1]=Math.min(i.v4[1],i.v2[1]),i.v4[1]=Math.min(i.v4[1],i.v3[1]),i.v4[2]=Math.min(i.v0[2],i.v1[2]),i.v4[2]=Math.min(i.v4[2],i.v2[2]),i.v4[2]=Math.min(i.v4[2],i.v3[2]),i.v5[0]=Math.max(i.v0[0],i.v1[0]),i.v5[0]=Math.max(i.v5[0],i.v2[0]),i.v5[0]=Math.max(i.v5[0],i.v3[0]),i.v5[1]=Math.max(i.v0[1],i.v1[1]),i.v5[1]=Math.max(i.v5[1],i.v2[1]),i.v5[1]=Math.max(i.v5[1],i.v3[1]),i.v5[2]=Math.max(i.v0[2],i.v1[2]),i.v5[2]=Math.max(i.v5[2],i.v2[2]),i.v5[2]=Math.max(i.v5[2],i.v3[2]);var t=i.v5[0]-i.v4[0],r=i.v5[1]-i.v4[1],a=i.v5[2]-i.v4[2];this.radius=Math.sqrt(t*t+r*r+a*a)/2,this.center.x=i.v4[0]+t/2,this.center.y=i.v4[1]+r/2,this.center.z=i.v4[2]+a/2},i.prototype.findNeighbour=function(t,i,r){var a=this.content[e.RT]-this.content[e.LT];if(!(1>=a)){18==this.content[0]&&20==this.content[1]&&148==this.content[2]&&150==this.content[3];for(var n=this.content[e.RT]-this.content[e.LT],o=0,s=0,h=0,l=0,u=0,c=0;4>c;++c){switch(c){case 0:o=this.content[e.LT]-n*(i+1),s=this.content[e.RT]-n*(i+1),h=this.content[e.LT],l=this.content[e.RT];break;case 1:o=this.content[e.LB],s=this.content[e.RB],h=this.content[e.LB]+n*(i+1),l=this.content[e.RB]+n*(i+1);break;case 2:o=this.content[e.LT]-n,s=this.content[e.LT],h=this.content[e.LB]-n,l=this.content[e.LB];break;case 3:o=this.content[e.RT],s=this.content[e.RT]+n,h=this.content[e.RB],l=this.content[e.RB]+n}u=(o+s+h+l)/4,u>=0&&i*r-1>=u&&(this.chlids[c+4]=t.isNeighbour(o,s,h,l))}this.chlids[0]&&(this.chlids[e.LT].findNeighbour(t,i,r),this.chlids[e.RT].findNeighbour(t,i,r),this.chlids[e.LB].findNeighbour(t,i,r),this.chlids[e.RB].findNeighbour(t,i,r))}},i.prototype.isNeighbour=function(r,a,n,o){if(this.content[e.LT]==r&&this.content[e.RT]==a&&this.content[e.LB]==n&&this.content[e.RB]==o)return this;if(this.chlids[0]){var s=(r+a+n+o)/4;if(i.v0.length=0,this.getVertex(s,i.v0),i.v1.length=0,i.v2.length=0,this.getVertex(this.chlids[e.LT].content[e.LT],i.v1),this.getVertex(this.chlids[e.LT].content[e.RB],i.v2),t.Rectangle.pointInRect(i.v0[0],i.v0[2],i.v1[0],i.v1[2],i.v2[0],i.v2[2]))return this.chlids[e.LT].isNeighbour(r,a,n,o);if(i.v1.length=0,i.v2.length=0,this.getVertex(this.chlids[e.RT].content[e.LT],i.v1),this.getVertex(this.chlids[e.RT].content[e.RB],i.v2),t.Rectangle.pointInRect(i.v0[0],i.v0[2],i.v1[0],i.v1[2],i.v2[0],i.v2[2]))return this.chlids[e.RT].isNeighbour(r,a,n,o);if(i.v1.length=0,i.v2.length=0,this.getVertex(this.chlids[e.LB].content[e.LT],i.v1),this.getVertex(this.chlids[e.LB].content[e.RB],i.v2),t.Rectangle.pointInRect(i.v0[0],i.v0[2],i.v1[0],i.v1[2],i.v2[0],i.v2[2]))return this.chlids[e.LB].isNeighbour(r,a,n,o);if(i.v1.length=0,i.v2.length=0,this.getVertex(this.chlids[e.RB].content[e.LT],i.v1),this.getVertex(this.chlids[e.RB].content[e.RB],i.v2),t.Rectangle.pointInRect(i.v0[0],i.v0[2],i.v1[0],i.v1[2],i.v2[0],i.v2[2]))return this.chlids[e.RB].isNeighbour(r,a,n,o)}return null},i.prototype.isDivide=function(t,r){i.v0.length=0,i.v1.length=0,i.v2.length=0,i.v3.length=0,i.v4.length=0,i.v5.length=0,i.v6.length=0,i.v7.length=0,i.v8.length=0,this.getVertex(this.content[e.LT],i.v0),this.getVertex(this.content[e.RT],i.v1),this.getVertex(this.content[e.LB],i.v2),this.getVertex(this.content[e.RB],i.v3);var a=(this.content[e.LT]+this.content[e.RT])/2,n=(this.content[e.LB]+this.content[e.RB])/2,o=(this.content[e.LT]+this.content[e.LB])/2,s=(this.content[e.RT]+this.content[e.RB])/2,h=(this.content[e.LT]+this.content[e.RB])/2;this.getVertex(a,i.v4),this.getVertex(n,i.v5),this.getVertex(o,i.v6),this.getVertex(s,i.v7),this.getVertex(h,i.v8);var l=(i.v0[2]+i.v1[2])/2-i.v4[2],u=(i.v2[2]+i.v3[2])/2-i.v5[2],c=(i.v0[2]+i.v2[2])/2-i.v6[2],d=(i.v1[2]+i.v3[2])/2-i.v7[2],p=(i.v0[2]+i.v3[2])/2-i.v8[2],f=(i.v1[2]+i.v2[2])/2-i.v8[2],_=l;_=Math.max(_,u),_=Math.max(_,c),_=Math.max(_,d),_=Math.max(_,p),_=Math.max(_,f),_=Math.max(_,1);var m=t.globalX-i.v8[0],g=t.globalY-i.v8[1],v=t.globalZ-i.v8[2],y=Math.sqrt(m*m+g*g+v*v);m=i.v1[0]-i.v0[0],g=i.v1[1]-i.v0[1],v=i.v1[2]-i.v0[2];var x=Math.sqrt(m*m+g*g+v*v);return 1>y/(x*r*_)?!0:!1},i.nodeCount=0,i.v0=[],i.v1=[],i.v2=[],i.v3=[],i.v4=[],i.v5=[],i.v6=[],i.v7=[],i.v8=[],i}();t.LODQuad=r}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r){void 0===r&&(r=null),e.call(this,i,r),this.wireframe=new t.Wireframe,this.bbb=!0,this.vertex=i.getVertexForIndex(0,t.VertexFormat.VF_POSITION,null,i.vertexCount),this.lodQuad=new t.LODQuad(null,this.vertex,i.segmentsW,i.segmentsH),this.wireframe.geometry.setVerticesForIndex(0,t.VertexFormat.VF_POSITION,this.vertex,i.vertexCount),this.wireframe.geometry.indexCount=6*i.faceCount,this.addChild(this.wireframe)}return __extends(i,e),i.prototype.update=function(t,i,r){e.prototype.update.call(this,t,i,r);var a=0;if(this.bbb,!0){a=this.lodQuad.createIndex(a,this.geometry.indexArray,this.camera,20),this.bbb=!1,this.geometry.indexCount=a,this.geometry.bufferDiry=!0,this.geometry.subGeometrys[0].count=this.geometry.indexCount;for(var n=0;n<this.geometry.faceCount;++n)this.wireframe.geometry.indexArray[6*n+0]=this.geometry.indexArray[3*n+0],this.wireframe.geometry.indexArray[6*n+1]=this.geometry.indexArray[3*n+1],this.wireframe.geometry.indexArray[6*n+2]=this.geometry.indexArray[3*n+1],this.wireframe.geometry.indexArray[6*n+3]=this.geometry.indexArray[3*n+2],this.wireframe.geometry.indexArray[6*n+4]=this.geometry.indexArray[3*n+2],this.wireframe.geometry.indexArray[6*n+5]=this.geometry.indexArray[3*n+0];this.wireframe.geometry.indexCount=6*this.geometry.faceCount,this.wireframe.geometry.bufferDiry=!0,this.wireframe.geometry.subGeometrys[0]&&(this.wireframe.geometry.subGeometrys[0].count=this.wireframe.geometry.indexCount)}},i}(t.Mesh);t.Terrain=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(){function t(){}return t.load=function(t){this._fontTextures=t},t.getTexture=function(t){var e=this._fontTextures[t];return e},t}();t.BitmapFont=e}(e=t.gui||(t.gui={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.aabb=new t.Rectangle,this.mouseEnable=!0,this.mouseChildern=!0,this.hasMouseMove=!1,this.hasMouseDown=!1,this.hasMouseUp=!1,this.hasMouseClick=!1,this.hasMouseOut=!1,this.mouseInState=!1,this._renderType=0,this._childs=[],this._rgbNumber=16777215,this._alphaNumber=1,this._color=new t.ColorTransform,this._pivot=new t.Vector3D,this._pos=new t.Vector3D,this._rot=new t.Vector3D,this._sca=new t.Vector3D(1,1,100,100),this._globalColor=new t.ColorTransform,this._globalPos=new t.Vector3D,this._globalRot=new t.Vector3D,this._globalSca=new t.Vector3D(1,1,100,100),this._orientation=new t.Quaternion,this._globalOrientation=new t.Quaternion,this._localVisible=!0,this._globalVisible=!0,this._visibleChange=!0,this._colorChange=!0,this._transformChange=!0,this._maskRectChange=!0,this._transformInvalid=!0,this._renderTypeInvalid=!0,this._maskRectInvalid=!0,this._colorInvalid=!0,this._textureInvalid=!0,this._visibleInvalid=!0,this._qut=new t.Quaternion,this._vec=new t.Vector3D}return __extends(i,e),Object.defineProperty(i.prototype,"stage",{get:function(){return this._stage},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"childs",{get:function(){return this._childs},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"renderType",{set:function(t){t!=this._renderType&&(this._renderTypeInvalid=!0,this._renderType=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this._sca.z},set:function(t){t!=this._sca.z&&(this._sca.z=t,this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._sca.w},set:function(t){t!=this._sca.w&&(this._sca.w=t,this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pivotX",{get:function(){return this._pivot.x},set:function(t){t!=this._pivot.x&&(this._pivot.x=t,this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pivotY",{get:function(){return this._pivot.y},set:function(t){t!=this._pivot.y&&(this._pivot.y=t,this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pivotZ",{get:function(){return this._pivot.z},set:function(t){t!=this._pivot.z&&(this._pivot.z=t,this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mask",{get:function(){return this._localMaskRect},set:function(e){(null!=e||null!=this._localMaskRect)&&(this._localMaskRect=this._localMaskRect||new t.Rectangle,this._localMaskRect.copyFrom(e),this.updateMaskChange(!0))},enumerable:!0,configurable:!0}),i.prototype.calculateTransform=function(){if(this._transformChange){if(null!=this._parent){var t=this._parent.globalOrientation;this._globalOrientation.multiply(t,this._orientation),this._globalOrientation.toEulerAngles(this._globalRot);var e=this._parent.globalScale;this._globalSca.copyFrom(e.multiply(this._sca)),t.transformVector(e.multiply(this._pos),this._globalPos),this._globalPos.copyFrom(this._globalPos.add(this._parent.globalPosition))}else this._globalOrientation.copyFrom(this._orientation),this._globalPos.copyFrom(this._pos),this._globalSca.copyFrom(this._sca),this._globalRot.copyFrom(this._rot);this._transformChange=!1,this.calculateMask(),this.onUpdateTransform()}},i.prototype.calculateMask=function(){this.calculateTransform(),this._maskRectChange&&(this._parent?this._localMaskRect?(this._globalMaskRect=this._globalMaskRect||new t.Rectangle,this._globalMaskRect.x=this._localMaskRect.x*this._globalSca.x+this._globalPos.x,this._globalMaskRect.y=this._localMaskRect.y*this._globalSca.y+this._globalPos.y,this._globalMaskRect.width=this._localMaskRect.width*this._globalSca.x,this._globalMaskRect.height=this._localMaskRect.height*this._globalSca.y,this._parent.globalMask&&this._globalMaskRect.innerArea(this._parent.globalMask,this._globalMaskRect)):this._parent.globalMask?(this._globalMaskRect=this._globalMaskRect||new t.Rectangle,this._globalMaskRect.copyFrom(this._parent.globalMask)):this._globalMaskRect=null:this._localMaskRect?(this._globalMaskRect=this._globalMaskRect||new t.Rectangle,this._globalMaskRect.x=this._localMaskRect.x*this._globalSca.x+this._globalPos.x,this._globalMaskRect.y=this._localMaskRect.y*this._globalSca.y+this._globalPos.y,this._globalMaskRect.width=this._localMaskRect.width*this._globalSca.x,this._globalMaskRect.height=this._localMaskRect.height*this._globalSca.y):this._globalMaskRect=null,this._maskRectChange=!1)},i.prototype.onUpdateTransform=function(){},i.prototype.dispatchMuseDown=function(){if(this.hasEventListener(t.MouseEvent3D.MOUSE_DOWN)){var e=new t.MouseEvent3D(t.MouseEvent3D.MOUSE_DOWN);e.target=this,this.dispatchEvent(e)}},i.prototype.dispatchMuseUp=function(){if(this.hasEventListener(t.MouseEvent3D.MOUSE_UP)){var e=new t.MouseEvent3D(t.MouseEvent3D.MOUSE_UP);e.target=this,this.dispatchEvent(e)}},i.prototype.dispatchMuseClick=function(){if(this.hasEventListener(t.MouseEvent3D.MOUSE_CLICK)){var e=new t.MouseEvent3D(t.MouseEvent3D.MOUSE_CLICK);e.target=this,this.dispatchEvent(e)}},i.prototype.dispatchMuseMove=function(){if(this.hasEventListener(t.MouseEvent3D.MOUSE_MOVE)){var e=new t.MouseEvent3D(t.MouseEvent3D.MOUSE_MOVE);e.target=this,this.dispatchEvent(e)}},i.prototype.dispatchMuseOut=function(){if(this.hasEventListener(t.MouseEvent3D.MOUSE_OUT)){var e=new t.MouseEvent3D(t.MouseEvent3D.MOUSE_OUT);e.target=this,this.dispatchEvent(e)}},i.prototype.addChild=function(e){return this.doAddChildAt(e,t.MathUtil.MAX_VALUE)},i.prototype.addChildAt=function(t,e){return this.doAddChildAt(t,e)},i.prototype.doAddChildAt=function(t,e){if(null==t)return null;if(t.parent)throw Error("This object is already the other child object.");if(this._childs.indexOf(t)>=0)throw Error("The same child object has been added.");if(0>e)throw Error("Child index can not be small than 0 !");return e>=this._childs.length?this._childs.push(t):this._childs.splice(e,0,t),t._parent=this,this._stage&&this._stage.setRenderListInvalid(),t.activeStage(this._stage),t},i.prototype.removeChild=function(t){return this.doRemoveChild(t)},i.prototype.removeChildAt=function(t){return this.doRemoveChild(this._childs[t])},i.prototype.doRemoveChild=function(t){if(null==t)return null;var e=this._childs.indexOf(t);if(-1==e)throw Error("The display isn't a child of this container!");return this._childs.splice(e,1),t._parent=null,this._stage&&this._stage.setRenderListInvalid(),t.activeStage(null),t},i.prototype.swapChildIndex=function(){},i.prototype.activeStage=function(t){if(this._stage!=t){this._stage=t,this.updateMaskChange(!0),this.updateTransformChange(!0),this.updateColorChange(!0),this.updateVisibleChange(!0);for(var e=0,i=this._childs.length;i>e;e++)this._childs[e].activeStage(t)}},i.prototype.hasChild=function(){return-1},i.prototype.getChildByIndex=function(){return null},i.prototype.getChildByName=function(){return null},i.prototype.update=function(){this.globalPosition,this.globalRotation,this.globalScale,this.globalColor,this.globalVisible,this.globalMask,this.updateMouseAABB()},i.prototype.updateMouseAABB=function(){if(this.mouseEnable){var t=this.globalPosition,e=this.globalScale;(this._maskRectInvalid||this._transformInvalid)&&(this.aabb.x=t.x,this.aabb.y=t.y,this.aabb.width=this.width*e.x,this.aabb.height=this.height*e.y,this.globalMask&&this.aabb.innerArea(this.globalMask,this.aabb))}else this.aabb.setTo(0,0,0,0)},i.prototype.updateMaskChange=function(t){if(this._maskRectChange!=t){this._maskRectChange=t,this._maskRectInvalid=t;for(var e=0;e<this._childs.length;++e)this._childs[e].updateMaskChange(t)}},i.prototype.updateTransformChange=function(t){if(this._transformChange!=t){this._transformChange=t,this._transformInvalid=t;for(var e=0;e<this._childs.length;++e)this._childs[e].updateTransformChange(t);this.updateMaskChange(t)}},i.prototype.updateVisibleChange=function(t){if(this._visibleChange!=t){this._visibleChange=t,this._visibleInvalid=t;for(var e=0;e<this._childs.length;++e)this._childs[e].updateVisibleChange(t)}},Object.defineProperty(i.prototype,"globalVisible",{get:function(){return this._visibleChange&&(this._globalVisible=this._parent?this._localVisible&&this._parent.globalVisible:this._localVisible,this._visibleChange=!1),this._globalVisible},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visible",{get:function(){return this._localVisible},set:function(t){this._localVisible!=t&&(this._localVisible=t,this.updateVisibleChange(!0))},enumerable:!0,configurable:!0}),i.prototype.updateColorChange=function(t){if(this._colorChange!=t){this._colorChange=t,this._colorInvalid=t;for(var e=0;e<this._childs.length;++e)this._childs[e].updateColorChange(t)}},Object.defineProperty(i.prototype,"globalX",{get:function(){return this.globalPosition.x},set:function(t){this._vec.copyFrom(this.globalPosition),this._vec.x=t,this.globalPosition=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalY",{get:function(){return this.globalPosition.y},set:function(t){this._vec.copyFrom(this.globalPosition),this._vec.y=t,this.globalPosition=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalZ",{get:function(){return this.globalPosition.z},set:function(t){this._vec.copyFrom(this.globalPosition),this._vec.z=t,this.globalPosition=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalPosition",{get:function(){return this._transformChange&&this.calculateTransform(),this._globalPos},set:function(t){this._parent?(this._parent.globalOrientation.inverse(this._qut),t.subtract(this._parent.globalPosition,this._vec),this._qut.transformVector(this._vec,this._vec),this._vec.divided(this._parent.globalScale,this._vec),this.position=this._vec):this.position=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalRotationX",{get:function(){return this.globalRotation.x},set:function(t){this._vec.copyFrom(this.globalRotation),this._vec.x=t,this.globalRotation=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalRotationY",{get:function(){return this.globalRotation.y},set:function(t){this._vec.copyFrom(this.globalRotation),this._vec.y=t,this.globalRotation=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalRotationZ",{get:function(){return this.globalRotation.z},set:function(t){this._vec.copyFrom(this.globalRotation),this._vec.z=t,this.globalRotation=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalRotation",{get:function(){return this._transformChange&&this.calculateTransform(),this._globalRot},set:function(t){this._qut.fromEulerAngles(t.x,t.y,t.z),this.globalOrientation=this._qut},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalScale",{get:function(){return this._transformChange&&this.calculateTransform(),this._globalSca},set:function(t){this._parent?(t.divided(this._parent.globalScale,this._vec),this.scale=this._vec):this.scale=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalScaleX",{get:function(){return this.globalScale.x},set:function(t){this._vec.copyFrom(this.globalScale),this._vec.x=t,this.globalScale=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalScaleY",{get:function(){return this.globalScale.y},set:function(t){this._vec.copyFrom(this.globalScale),this._vec.y=t,this.globalScale=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalScaleZ",{get:function(){return this.globalScale.z},set:function(t){this._vec.copyFrom(this.globalScale),this._vec.z=t,this.globalScale=this._vec},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalOrientation",{get:function(){return this._transformChange&&this.calculateTransform(),this._globalOrientation
},set:function(t){this._parent?(this._parent.globalOrientation.inverse(this._qut),this._qut.multiply(this._qut,t),this.orientation=this._qut):this.orientation=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalMask",{get:function(){return this._maskRectChange&&this.calculateMask(),this._globalMaskRect},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return this._pos},set:function(t){this._pos.copyFrom(t),this.updateTransformChange(!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this._rot},set:function(t){this._rot.x=t.x,this._rot.y=t.y,this._rot.z=t.z,this._orientation.fromEulerAngles(this._rot.x,this._rot.y,this._rot.z),this.updateTransformChange(!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"orientation",{get:function(){return this._orientation},set:function(t){this._orientation.copyFrom(t),this._orientation.toEulerAngles(this._rot),this.updateTransformChange(!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"orientationX",{set:function(t){this._orientation.x!=t&&(this._orientation.x=t,this._orientation.toEulerAngles(this._rot),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"orientationY",{set:function(t){this._orientation.y!=t&&(this._orientation.y=t,this._orientation.toEulerAngles(this._rot),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"orientationZ",{set:function(t){this._orientation.z!=t&&(this._orientation.z=t,this._orientation.toEulerAngles(this._rot),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"orientationW",{set:function(t){this._orientation.w!=t&&(this._orientation.w=t,this._orientation.toEulerAngles(this._rot),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scale",{get:function(){return this._sca},set:function(t){this._sca=t,this.updateTransformChange(!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"x",{get:function(){return this._pos.x},set:function(t){this._pos.x!=t&&(this._pos.x=t,this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this._pos.y},set:function(t){this._pos.y!=t&&(this.updateTransformChange(!0),this._pos.y=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"z",{get:function(){return this._pos.z},set:function(t){this._pos.z!=t&&(this._pos.z=t,this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotationX",{get:function(){return this._rot.x},set:function(t){this._rot.x!=t&&(this._rot.x=t,this._orientation.fromEulerAngles(this._rot.x,this._rot.y,this._rot.z),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotationY",{get:function(){return this._rot.y},set:function(t){this._rot.y!=t&&(this._rot.y=t,this._orientation.fromEulerAngles(this._rot.x,this._rot.y,this._rot.z),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotationZ",{get:function(){return this._rot.z},set:function(t){this._rot.z!=t&&(this._rot.z=t,this._orientation.fromEulerAngles(this._rot.x,this._rot.y,this._rot.z),this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleX",{get:function(){return this._sca.x},set:function(t){this._sca.x!=t&&(this._sca.x=t,this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleY",{get:function(){return this._sca.y},set:function(t){this._sca.y!=t&&(this.updateTransformChange(!0),this._sca.y=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleZ",{get:function(){return this._sca.z},set:function(t){this._sca.z!=t&&(this._sca.z=t,this.updateTransformChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalColor",{get:function(){return this._colorChange&&(this._color.alpha=this._alphaNumber,this._color.setColorRGB(this._rgbNumber),this._parent?this._globalColor.multiply(this._parent.globalColor):this._globalColor.copyFrom(this._color),this._colorChange=!1),this._color},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"color",{get:function(){return this._rgbNumber},set:function(t){this._rgbNumber!=t&&(this._rgbNumber=t,this.updateColorChange(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"alpha",{get:function(){return this._alphaNumber},set:function(t){this._alphaNumber=t,this._alphaNumber!=t&&(this._alphaNumber=t,this.updateColorChange(!0))},enumerable:!0,configurable:!0}),i}(t.EventDispatcher);t.DisplayObject=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.buildGeometry=function(i,r,a){var i=i;i.vertexFormat=t.VertexFormat.VF_QUADPOS|t.VertexFormat.VF_QUADOFFSET|t.VertexFormat.VF_UVREC|t.VertexFormat.VF_ROTATION|t.VertexFormat.VF_SCALE|t.VertexFormat.VF_QUAD_COLOR;var n=new t.SubGeometry;i.vertexCount=4*a,i.indexCount=e.singleQuadIndex.length*a;for(var o=0,s=0,h=0;a>h;h++){o=h+r,e.singleQuadData[0*e.vertexLen+2]=o,e.singleQuadData[1*e.vertexLen+2]=o,e.singleQuadData[2*e.vertexLen+2]=o,e.singleQuadData[3*e.vertexLen+2]=o,s=4*h*i.vertexAttLength;for(var l=0;l<e.singleQuadData.length;l++)i.vertexArray[s+l]=e.singleQuadData[l];for(var u=0;u<e.singleQuadIndex.length;u++)i.indexArray[h*e.singleQuadIndex.length+u]=e.singleQuadIndex[u]+4*h}n.geometry=i,n.start=0,n.count=i.indexCount,i.subGeometrys.push(n),i.vertexAttLength=e.vertexLen},e.singleQuadData=[0,0,1e5,0,0,0,0,0,0,1,1,0,0,0,1,-1,0,1,1,0,0,1,1,0,0,1e5,0,0,0,0,1,0,1,1,0,0,0,1,-1,0,1,1,0,0,1,1,0,0,1e5,0,0,0,0,1,1,1,1,0,0,0,1,-1,0,1,1,0,0,1,1,0,0,1e5,0,0,0,0,0,1,1,1,0,0,0,1,-1,0,1,1,0,0,1,1],e.vertexLen=23,e.posOffest=0,e.posSize=4,e.offsetOffest=4,e.offsetSize=3,e.uvRectangleOffest=7,e.uvRectangleSize=4,e.rotationOffest=11,e.rotationSize=4,e.scaleOffest=15,e.scaleSize=4,e.colorOffest=19,e.colorSize=4,e.singleQuadIndex=[0,2,1,0,3,2],e.vertexBytes=4*e.vertexLen,e.quadVertexLen=4*e.vertexLen,e}();t.QuadData=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){}return t.NULL_TEXTURE=-1,t.NULL_QUAD=-2,t.NULL_INVISIBLE=-3,t}();t.QuadNullType=e;var i=function(i){function r(){i.call(this),this._globalIndex=-1}return __extends(r,i),Object.defineProperty(r.prototype,"texture",{set:function(t){t!=this._texture&&(this._texture=t,this._textureInvalid=!0)},enumerable:!0,configurable:!0}),r.prototype.updateVertices=function(i,a,n){if(a.sharedVertexBuffer&&a.sharedVertexBuffer.arrayBuffer){var o=this.globalPosition,s=(this.globalRotation,this.globalScale);this._globalIndex!=n&&(this._globalIndex=n,this._colorInvalid=this._transformInvalid=this._renderTypeInvalid=this._textureInvalid=this._visibleInvalid=this._maskRectInvalid=!0);var h,l=0,u=a.vertexAttLength,c=a.sharedVertexBuffer.arrayBuffer;if(this._transformInvalid){this._transformInvalid=!1,h=i*t.QuadData.quadVertexLen+t.QuadData.offsetOffest;for(var d=0;4>d;d++)l=h+d*u,c[l]=o.x,c[l+1]=-o.y;h=i*t.QuadData.quadVertexLen+t.QuadData.posOffest,l=h+0*u,c[l]=0,c[l+1]=0,l=h+1*u,c[l]=this.width,c[l+1]=0,l=h+2*u,c[l]=this.width,c[l+1]=-this.height,l=h+3*u,c[l]=0,c[l+1]=-this.height,h=i*t.QuadData.quadVertexLen+t.QuadData.uvRectangleOffest;for(var d=0;4>d;d++)l=h+d*u,c[l+2]=s.x,c[l+3]=s.y;var p=t.Quaternion.HELP_0;p.fromEulerAngles(this._globalRot.x,this._globalRot.y,this._globalRot.z),h=i*t.QuadData.quadVertexLen+t.QuadData.rotationOffest;for(var d=0;4>d;d++)l=h+d*u,c[l]=p.x,c[l+1]=p.y,c[l+2]=p.z,c[l+3]=p.w}if(this._renderTypeInvalid){this._renderTypeInvalid=!1,h=i*t.QuadData.quadVertexLen+t.QuadData.posOffest;for(var d=0;4>d;d++)l=h+d*u,c[l+3]=this._renderType}if(this._textureInvalid||this._visibleInvalid){this._textureInvalid=!1,this._visibleInvalid=!1;var f,_=e.NULL_TEXTURE;this._texture?(f=this._texture.uvRectangle,_=this._texture.guiIndex):(_=e.NULL_TEXTURE,f=r.DefaultUVRect),0==this.visible&&(_=e.NULL_INVISIBLE),h=i*t.QuadData.quadVertexLen+t.QuadData.uvRectangleOffest,l=h+0*u,c[l]=f.x,c[l+1]=f.y,l=h+1*u,c[l]=f.x+f.width,c[l+1]=f.y,l=h+2*u,c[l]=f.x+f.width,c[l+1]=f.y+f.height,l=h+3*u,c[l]=f.x,c[l+1]=f.y+f.height,h=i*t.QuadData.quadVertexLen+t.QuadData.offsetOffest;for(var d=0;4>d;d++)l=h+d*u,c[l+2]=_}if(this._maskRectInvalid){this._maskRectInvalid=!1;var m=this.globalMask;if(m){var g,v,y,x;g=m.x,v=m.y,y=m.width,x=m.height,h=i*t.QuadData.quadVertexLen+t.QuadData.scaleOffest;for(var d=0;4>d;d++)l=h+d*u,c[l+0]=g,c[l+1]=v,c[l+2]=y,c[l+3]=x}}if(this._colorInvalid){var b=this.globalColor.alpha,D=r.TempVector;this.globalColor.m44.transformVector(r.IdentityVector,D),h=i*t.QuadData.quadVertexLen+t.QuadData.colorOffest;for(var d=0;4>d;d++)l=h+d*u,c[l]=D.x,c[l+1]=D.y,c[l+2]=D.z,c[l+3]=b;this._colorInvalid=!1}}},r.clear=function(i,r){if(r.sharedVertexBuffer&&r.sharedVertexBuffer.arrayBuffer)for(var a,n=r.sharedVertexBuffer.arrayBuffer,o=i*t.QuadData.quadVertexLen+t.QuadData.offsetOffest,s=0;4>s;s++)a=o+s*r.vertexAttLength,n[a+2]=e.NULL_QUAD},r.IdentityVector=new t.Vector3D(1,1,1,1),r.TempVector=new t.Vector3D,r.DefaultUVRect=new t.Rectangle(0,0,1,1),r}(t.DisplayObject);t.Quad=i}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e){this._mouseList=[],this._quadStage=e,t.Input.addEventListener(t.MouseEvent3D.MOUSE_DOWN,this.mouseDown,this),t.Input.addEventListener(t.MouseEvent3D.MOUSE_UP,this.mouseUp,this),t.Input.addEventListener(t.MouseEvent3D.MOUSE_OVER,this.mouseOver,this),t.Input.addEventListener(t.MouseEvent3D.MOUSE_CLICK,this.mouseClick,this),t.Input.addEventListener(t.MouseEvent3D.MOUSE_MOVE,this.mouseMove,this),t.Input.addEventListener(t.MouseEvent3D.MOUSE_OUT,this.mouseOut,this),t.Input.addEventListener(t.TouchEvent3D.TOUCH_START,this.mouseDown,this),t.Input.addEventListener(t.TouchEvent3D.TOUCH_END,this.mouseUp,this),t.Input.addEventListener(t.TouchEvent3D.TOUCH_MOVE,this.mouseMove,this)}return e.prototype.mouseOut=function(){var e=this.getMousePickList();if(e.length>0){var i=e[0];i.pickResult=i.pickResult||new t.PickResult,i.pickResult.pickList=e,i.dispatchMuseOut()}this._quadStage.dispatchMouseOut()},e.prototype.mouseDown=function(){var e=this.getMousePickList();if(e.length>0){var i=e[0];i.pickResult=i.pickResult||new t.PickResult,i.pickResult.pickList=e,i.dispatchMuseDown()}this._quadStage.dispatchMuseDown()},e.prototype.mouseUp=function(){var e=this.getMousePickList();if(e.length>0){var i=e[0];i.pickResult=i.pickResult||new t.PickResult,i.pickResult.pickList=e,i.dispatchMuseUp()}this._quadStage.dispatchMuseUp()},e.prototype.mouseOver=function(){var e=this.getMousePickList();if(e.length>0){var i=e[0];i.mouseInState=!0,i.pickResult=i.pickResult||new t.PickResult,i.pickResult.pickList=e,i.dispatchMuseUp()}this._quadStage.dispatchMouseOver()},e.prototype.mouseMove=function(){var e=this.getMousePickList();if(e.length>0){var i=e[0];i.mouseInState=!0,i.pickResult=i.pickResult||new t.PickResult,i.pickResult.pickList=e,i.dispatchMuseMove()}this._quadStage.dispatchMuseMove()},e.prototype.mouseClick=function(){var e=this.getMousePickList();if(e.length>0){var i=e[0];i.mouseInState=!0,i.pickResult=i.pickResult||new t.PickResult,i.pickResult.pickList=e,i.dispatchMuseClick()}this._quadStage.dispatchMuseClick()},e.prototype.fire=function(){this._finalist=this._quadStage.quadList},e.prototype.getMousePickList=function(){var e;this._mouseList.length=0;var i;if(this._finalist)for(e=0;e<this._finalist.length;e++)i=this._finalist[e],i.globalVisible&&i.mouseEnable&&i.aabb.inner(t.Input.mouseX,t.Input.mouseY)&&this._mouseList.push(i);return this._mouseList.reverse(),this._mouseList},e}();t.GUIEventFire=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){}return t.sortZindex=function(t,e){return e.z-t.z},t.sortAB=function(e){return e.sort(function(e,i){return t.sortZindex(e,i)})},t.sortBA=function(e){return e.sort(function(e,i){return t.sortZindex(i,e)})},t}();t.SortUtil=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this,new t.Geometry,new t.TextureMaterial),this.startQuad=0,this.numberQuad=0,this.quadList=[],this.startQuad=i,this.numberQuad=t.QuadStage.moreQuad,this.geometry.drawType=t.Context3DProxy.gl.DYNAMIC_DRAW,t.QuadData.buildGeometry(this.geometry,i,t.QuadStage.moreQuad),this.guiMethod=new t.GUIMethod,this.enableCulling=!1,this.uiMaterial=this.material,this.uiMaterial.blendMode=t.BlendMode.ALPHA,this.uiMaterial.repeat=!0,this.uiMaterial.diffusePass.addMethod(this.guiMethod),this.canPick=!1,this.tag.name="gui"}return __extends(i,e),i.prototype.setTexture=function(t,e){this.guiMethod.setTextures(t,e)},i}(t.Mesh);t.QuadMesh=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this._nextIndex=0,this._textures=[];for(var i=0;i<e.MAX_COUNT;i++)this._textures[i]=t.CheckerboardTexture.texture}return e.prototype.register=function(t){return this._nextIndex>=e.MAX_COUNT?!1:this._textures.indexOf(t)>=0?!1:(this._textures[this._nextIndex]=t,t.guiIndex=this._nextIndex,this._nextIndex++,!0)},e.prototype.replace=function(t,i){if(0>i||i>=e.MAX_COUNT)throw new Error("index error");var r=this._textures[i];return this._textures[i]=t,r},e.prototype.activeTexture=function(t){for(var i=0;i<e.MAX_COUNT;i++)t.setTexture(i,this._textures[i])},e.MAX_COUNT=7,e}();t.GUITextureGroup=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this),this._childList=[],this._quadMeshs=[],this._quadCurHistory=[],this._quadLastHistory=[],this._renderListInvalid=!1,this.quadList=[],this._view3D=i,this._guiEventFire=new t.GUIEventFire(this),this._textureGroup=new t.GUITextureGroup,this._guiContainer=new t.Object3D,this.changeCamera()}return __extends(i,e),i.prototype.registerTexture=function(t){return this._textureGroup.register(t)},i.prototype.changeCamera=function(){this._guiContainer.parent&&this._guiContainer.parent.removeChild(this._guiContainer),this._view3D.camera3D.addChild(this._guiContainer)},i.prototype.creatQuadMesh=function(){var e=new t.QuadMesh(this._quadMeshs.length*i.moreQuad);this._quadMeshs.push(e),this._guiContainer.addChild(e)},i.prototype.getChildQuads=function(e,i){var r,a,n=0;for(e instanceof t.Quad&&(a=e,i.push(a));n<e.childs.length;)r=e.childs[n++],this.getChildQuads(r,i)},i.prototype.addChild=function(t){if(!t)throw Error("This object is null");if(t.parent)throw Error("parent isn't null");this._childList.push(t),t.activeStage(this),this.setRenderListInvalid()},i.prototype.setRenderListInvalid=function(){this._renderListInvalid=!0},i.prototype.updateRenderList=function(){this.quadList.length=0;for(var t=0;t<this._childList.length;t++)this.getChildQuads(this._childList[t],this.quadList);if(this.quadList.length>this._quadMeshs.length*i.moreQuad)for(var e=Math.ceil(this.quadList.length/i.moreQuad)-this._quadMeshs.length,t=0;e>t;t++)this.creatQuadMesh()},i.prototype.removeChild=function(t){var e=this._childList.indexOf(t);-1!=e&&this._childList.splice(e,1),t.activeStage(null),this.setRenderListInvalid()},i.prototype.update=function(e,r,a){this._renderListInvalid&&(this._renderListInvalid=!1,this.updateRenderList()),t.Context3DProxy.gl.disable(t.Context3DProxy.gl.DEPTH_TEST);var n,o=this.quadList.length;for(n=0;o>n;n++)this.quadList[n].update(e,r);this._guiEventFire.fire();var s;for(n=0;o>n;n++)s=Math.floor(n/i.moreQuad),this.quadList[n].updateVertices(n%i.moreQuad,this._quadMeshs[s].geometry,n);this.clearInvalidVertices(o);var h;for(n=0;n<this._quadMeshs.length;n++)h=this._quadMeshs[n],h.geometry.upload(a,t.Context3DProxy.gl.DYNAMIC_DRAW),this._textureGroup.activeTexture(h);t.Context3DProxy.gl.enable(t.Context3DProxy.gl.DEPTH_TEST)},i.prototype.clearInvalidVertices=function(e){this._quadCurHistory.length=0;for(var r=0;e>=i.moreQuad;)this._quadCurHistory[r]=i.moreQuad,e-=i.moreQuad,r++;e>0&&(this._quadCurHistory[r]=e),e=this._quadMeshs.length;var a=0,n=0;for(r=0;e>r;r++)if(a=this._quadLastHistory[r]||0,n=this._quadCurHistory[r]||0,a>n)for(var o=n;a>o;o++)t.Quad.clear(o,this._quadMeshs[r].geometry);var s=this._quadCurHistory;this._quadCurHistory=this._quadLastHistory,this._quadLastHistory=s},i.prototype.dispatchMuseDown=function(){if(this.hasEventListener(t.MouseEvent3D.MOUSE_DOWN)){var e=new t.MouseEvent3D(t.MouseEvent3D.MOUSE_DOWN);e.target=this,this.dispatchEvent(e)}},i.prototype.dispatchMuseUp=function(){if(this.hasEventListener(t.MouseEvent3D.MOUSE_UP)){var e=new t.MouseEvent3D(t.MouseEvent3D.MOUSE_UP);e.target=this,this.dispatchEvent(e)}},i.prototype.dispatchMuseClick=function(){if(this.hasEventListener(t.MouseEvent3D.MOUSE_CLICK)){var e=new t.MouseEvent3D(t.MouseEvent3D.MOUSE_CLICK);e.target=this,this.dispatchEvent(e)}},i.prototype.dispatchMuseMove=function(){if(this.hasEventListener(t.MouseEvent3D.MOUSE_MOVE)){var e=new t.MouseEvent3D(t.MouseEvent3D.MOUSE_MOVE);e.target=this,this.dispatchEvent(e)}},i.prototype.dispatchMouseOut=function(){if(this.hasEventListener(t.MouseEvent3D.MOUSE_OUT)){var e=new t.MouseEvent3D(t.MouseEvent3D.MOUSE_OUT);e.target=this,this.dispatchEvent(e)}},i.prototype.dispatchMouseOver=function(){if(this.hasEventListener(t.MouseEvent3D.MOUSE_OVER)){var e=new t.MouseEvent3D(t.MouseEvent3D.MOUSE_OVER);e.target=this,this.dispatchEvent(e)}},i.moreQuad=500,i}(t.EventDispatcher);t.QuadStage=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var i=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.onRender=function(){},e.prototype.onUpdate=function(){},e.prototype.onEvent=function(){},e}(t.DisplayObject);e.UILayout=i}(e=t.gui||(t.gui={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this),this.instanceStyles={}}return __extends(e,t),e.prototype.onRender=function(){},e.prototype.onUpdate=function(){},e.prototype.onEvent=function(){},e.prototype.setStyle=function(t,e){this.instanceStyles[t]!==e&&(this.instanceStyles[t]=e)},e.prototype.getStyle=function(t){return this.instanceStyles[t]},e.getStyleDefinition=function(){return this.defaultStyles},e.mergeStyles=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];for(var i={},r=t.length,a=0;r>a;a++){var n=t[a];for(var o in n)null==i[o]&&(i[o]=t[a][o])}return i},e.defaultStyles={},e}(t.UILayout);t.UIElement=e}(e=t.gui||(t.gui={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this),this._skin=new t.Quad,this.addChild(this._skin),this._state=i.STATE_UP,this._enable=!0,this._isDowning=!1,this._skin.addEventListener(t.MouseEvent3D.MOUSE_DOWN,this.mouseEventHandler,this),this._skin.addEventListener(t.MouseEvent3D.MOUSE_OUT,this.mouseEventHandler,this),this._skin.addEventListener(t.MouseEvent3D.MOUSE_OVER,this.mouseEventHandler,this)}return __extends(i,e),Object.defineProperty(i.prototype,"width",{get:function(){return this._skin.width},set:function(t){this._skin.width=t,this.onRender()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._skin.height},set:function(t){this._skin.height=t,this.onRender()},enumerable:!0,configurable:!0}),i.prototype.setStyle=function(t,i){e.prototype.setStyle.call(this,t,i),this.onRender()},i.prototype.mouseEventHandler=function(e){this._enable&&(e.eventType===t.MouseEvent3D.MOUSE_DOWN?this.startPress():e.eventType===t.MouseEvent3D.MOUSE_UP?this.endPress():e.eventType===t.MouseEvent3D.MOUSE_OUT?this.mouseOut():e.eventType===t.MouseEvent3D.MOUSE_OVER&&this.mouseOver())},i.prototype.mouseOut=function(){this.setMouseState(i.STATE_UP)},i.prototype.mouseOver=function(){this._isDowning&&this.setMouseState(i.STATE_DOWN)},i.prototype.startPress=function(){this._skin.addEventListener(t.MouseEvent3D.MOUSE_UP,this.mouseEventHandler,this),this.stage.addEventListener(t.MouseEvent3D.MOUSE_UP,this.onStageEnd,this),this._isDowning=!0,this.setMouseState(i.STATE_DOWN),this.dispatchEvent(new t.MouseEvent3D(t.MouseEvent3D.MOUSE_DOWN,this))},i.prototype.onStageEnd=function(){console.log("stage up"),this.stage.removeEventListener(t.MouseEvent3D.MOUSE_UP,this.onStageEnd,this),this._skin.removeEventListener(t.MouseEvent3D.MOUSE_UP,this.mouseEventHandler,this),this.setMouseState(i.STATE_UP),this._isDowning=!1},i.prototype.endPress=function(){this.dispatchEvent(new t.MouseEvent3D(t.MouseEvent3D.MOUSE_UP,this)),this.dispatchEvent(new t.MouseEvent3D(t.MouseEvent3D.MOUSE_CLICK,this)),this.setMouseState(i.STATE_UP),this._isDowning=!1,this.stage.removeEventListener(t.MouseEvent3D.MOUSE_UP,this.onStageEnd,this),this._skin.removeEventListener(t.MouseEvent3D.MOUSE_UP,this.mouseEventHandler,this),console.log("btn up")},Object.defineProperty(i.prototype,"enable",{get:function(){return this._enable},set:function(t){this._enable=t,this.mouseEnable=t},enumerable:!0,configurable:!0}),i.prototype.setMouseState=function(t){this._state!==t&&(this._state=t,this.onRender())},i.prototype.onRender=function(){this.drawBackground()},i.prototype.drawBackground=function(){var t=this.getStyle(this.enable?this._state:i.STATE_DISABLE);this._skin.texture=t},i.STATE_DOWN="down",i.STATE_UP="up",i.STATE_DISABLE="disable",i}(e.UIElement);e.UIButton=i;var r=function(){function t(){}return t.BOTTOM="bottom",t.TOP="top",t.LEFT="left",t.RIGHT="right",t}();e.ButtonLabelPlacement=r}(e=t.gui||(t.gui={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){!function(t){t[t.NONE=0]="NONE",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.CENTER=3]="CENTER"}(e.UITextFieldAutoSize||(e.UITextFieldAutoSize={}));var i=e.UITextFieldAutoSize;!function(t){t[t.DYNAMIC=0]="DYNAMIC",t[t.INPUT=1]="INPUT"}(e.UITextFieldType||(e.UITextFieldType={}));var r=e.UITextFieldType,a=function(){function t(){}return t}();!function(t){t[t.CENTER=0]="CENTER",t[t.JUSTIFY=1]="JUSTIFY",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT"}(e.UITextFormatAlign||(e.UITextFormatAlign={}));var n=(e.UITextFormatAlign,function(){function t(){}return t}());e.UITextFormat=n;var o=function(n){function o(e){void 0===e&&(e=r.DYNAMIC),n.call(this),this._textLineInfo=[],this._text="",this._maxChars=0,this._restrict="",this._textWidth=0,this._textLine=[],this._quadPool=[],this._textHeight=0,this._fontQuadLine=[],this._multiline=!1,this._selectable=!1,this._type=e,this._textColor=52224,this._selectionEndIndex=-1,this._selectionBeginIndex=-1,this._displayAsPassword=!1,this._autoSize=i.LEFT,this._fontQuadPanel=new t.DisplayObject,this._blankQuad=this.createFontQuad("b".charCodeAt(0),!1),o.sharedHTMLInputElement||(o.sharedHTMLInputElement=document.createElement("input"),o.sharedHTMLInputElement.style.width=this.width+"px",o.sharedHTMLInputElement.style.height=this.height+"px",o.sharedHTMLInputElement.hidden=!0,o.sharedHTMLInputElement.style.color="#00ff00",o.sharedHTMLInputElement.style.border="0px",o.sharedHTMLInputElement.style.backgroundColor="transparent",document.getElementById("egret3D").parentElement.appendChild(o.sharedHTMLInputElement)),o.sharedHTMLTextAreaElement||(o.sharedHTMLTextAreaElement=document.createElement("textarea"),o.sharedHTMLTextAreaElement.style.width=this.width+"px",o.sharedHTMLTextAreaElement.style.height=this.height+"px",o.sharedHTMLTextAreaElement.hidden=!0,o.sharedHTMLTextAreaElement.style.color="#00ff00",o.sharedHTMLTextAreaElement.style.paddingLeft="0px",o.sharedHTMLTextAreaElement.style.paddingTop="0px",o.sharedHTMLTextAreaElement.style.margin="0px",o.sharedHTMLTextAreaElement.style.backgroundColor="transparent",document.getElementById("egret3D").parentElement.appendChild(o.sharedHTMLTextAreaElement)),this._bgQuad=new t.Quad,r.INPUT==this._type&&(this._bgQuad.mouseEnable=!0,this._bgQuad.width=this.width,this._bgQuad.height=this.height,this.addChild(this._bgQuad),this._bgQuad.addEventListener(t.TouchEvent3D.TOUCH_START,this.onShowInputAgent,this),this._bgQuad.addEventListener(t.MouseEvent3D.MOUSE_CLICK,this.onShowInputAgent,this)),this.width=100,this.height=20,this.addChild(this._fontQuadPanel)}return __extends(o,n),o.prototype.onShowInputAgent=function(){var t=this;this._multiline?(o.sharedHTMLTextAreaElement.hidden=!1,o.sharedHTMLTextAreaElement.style.position="absolute",o.sharedHTMLTextAreaElement.style.left=this.x+"px",o.sharedHTMLTextAreaElement.style.top=this.y+"px",o.sharedHTMLTextAreaElement.style.width=this.width+"px",o.sharedHTMLTextAreaElement.style.height=this.height+"px",o.sharedHTMLTextAreaElement.value=this._text,o.sharedHTMLTextAreaElement.focus(),o.sharedHTMLTextAreaElement.onblur=function(e){return t.onSharedHTMLTextLoseFocus(e)}):(o.sharedHTMLInputElement.hidden=!1,o.sharedHTMLInputElement.style.position="absolute",o.sharedHTMLInputElement.style.left=this.x+"px",o.sharedHTMLInputElement.style.top=this.y+"px",o.sharedHTMLInputElement.style.width=this.width+"px",o.sharedHTMLInputElement.style.height=this.height+"px",o.sharedHTMLInputElement.value=this._text,o.sharedHTMLInputElement.focus(),o.sharedHTMLInputElement.onblur=function(e){return t.onSharedHTMLTextLoseFocus(e)}),this._fontQuadPanel.visible=!1},o.prototype.onSharedHTMLTextLoseFocus=function(){this.text=this._multiline?o.sharedHTMLTextAreaElement.value:o.sharedHTMLInputElement.value,o.sharedHTMLInputElement.onblur=o.sharedHTMLTextAreaElement.onblur=null,o.sharedHTMLInputElement.hidden=o.sharedHTMLTextAreaElement.hidden=!0,this._fontQuadPanel.visible=!0},Object.defineProperty(o.prototype,"width",{get:function(){return this._sca.z},set:function(t){t!=this._sca.z&&(this._fontQuadPanel.width=t,this._sca.z=t,this._transformChange=!0,this._bgQuad.width=t,this.refreshAlign())},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"height",{get:function(){return this._sca.w},set:function(t){t!=this._sca.w&&(this._fontQuadPanel.height=t,this._sca.w=t,this._transformChange=!0,this._bgQuad.height=t,this.refreshAlign())},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"displayAsPassword",{get:function(){return this._displayAsPassword},set:function(t){this._displayAsPassword=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"length",{get:function(){return this._text.length},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"maxChars",{get:function(){return this._maxChars},set:function(t){this._maxChars=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"multiline",{get:function(){return this._multiline},set:function(t){this._multiline=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"restrict",{get:function(){return this._restrict},set:function(t){this._restrict=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"selectable",{get:function(){return this._selectable},set:function(t){this._selectable=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"selectionBeginIndex",{get:function(){return this._selectionBeginIndex},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"selectionEndIndex",{get:function(){return this._selectionEndIndex},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"textColor",{get:function(){return this._textColor},set:function(t){this._textColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"textWidth",{get:function(){return this._textWidth},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"textHeight",{get:function(){return this._textHeight},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"text",{get:function(){return this._text},set:function(t){this.clearText(),this._text=t,this._textLine=t.split("\n"),this._multiline||(this._textLine[0]=this._textLine.join(""),this._textLine.length=1);for(var e=null,i=0;i<this._textLine.length;++i){var r=this._textLine[i];e=this.buildTextLineInfo(r),this._textLineInfo.push(e)}this.refreshAlign()},enumerable:!0,configurable:!0}),o.prototype.clearText=function(){for(var t=null,e=0;e<this._textLineInfo.length;++e){t=this._textLineInfo[e];for(var i=0;i<t.lineQuads.length;++i)this.deleteFontQuad(t.lineQuads[i]);t.lineQuads=null}this._textLineInfo=[]},Object.defineProperty(o.prototype,"autoSize",{get:function(){return this._autoSize},set:function(t){this._autoSize=t},enumerable:!0,configurable:!0}),o.prototype.refreshAlign=function(){var t,e,r=null,a=null;if(this._autoSize==i.LEFT){e=0,!this.multiline&&this._textLineInfo.length>=1&&(e=this.height/2-this._textLineInfo[0].lineHeight/2);for(var n=0;n<this._textLineInfo.length;++n){a=this._textLineInfo[n],t=0;for(var o=0;o<a.lineQuads.length;++o)r=a.lineQuads[o],r.x=t,r.y=e,t+=r.width,r.visible=r.x+r.width<=this.width;e+=a.lineHeight}}else if(this._autoSize==i.RIGHT){e=0,!this.multiline&&this._textLineInfo.length>=1&&(e=this.height/2-this._textLineInfo[0].lineHeight/2);for(var n=0;n<this._textLineInfo.length;++n){a=this._textLineInfo[n],t=this.width;for(var o=a.lineQuads.length-1;o>=0;--o)r=a.lineQuads[o],r.x=t-=r.width,r.y=e,r.visible=r.x+r.width>0;e+=a.lineHeight}}else if(this._autoSize==i.CENTER){e=0,!this.multiline&&this._textLineInfo.length>=1&&(e=this.height/2-this._textLineInfo[0].lineHeight/2);for(var n=0;n<this._textLineInfo.length;++n){a=this._textLineInfo[n],t=.5*this.width-.5*a.lineWidth;for(var o=0;o<a.lineQuads.length;++o)r=a.lineQuads[o],r.x=t,r.y=e,t+=r.width,r.visible=r.x+r.width<=this.width&&r.x+r.width>0;e+=a.lineHeight}}},o.prototype.buildTextLineInfo=function(t){var e=new a;e.lineText=t,e.lineWidth=0,e.lineHeight=0,e.lineQuads=[];for(var i=0;i<t.length;++i){var r=null,n=t.charCodeAt(i);r=32!=n?this.createFontQuad(n):this._blankQuad,e.lineQuads.push(r),e.lineWidth+=r.width,e.lineHeight<r.height&&(e.lineHeight=r.height)}return e},o.prototype.appendText=function(){},o.prototype.getCharBoundaries=function(){return null},o.prototype.getCharIndexAtPoint=function(){return 0},o.prototype.replaceSelectedText=function(){},o.prototype.replaceText=function(){},o.prototype.setSelection=function(){},o.prototype.onUpdate=function(){this.x+=1},o.prototype.createFontQuad=function(i,r){void 0===r&&(r=!0);var a;this._quadPool.length>0?(a=this._quadPool[this._quadPool.length-1],this._quadPool.splice(this._quadPool.length-1,1)):(a=new t.Quad,a.renderType=1);var n=e.BitmapFont.getTexture(i);return n||(n=e.BitmapFont.getTexture("?".charCodeAt(0))),a.width=n.width,a.height=n.height,a.texture=n,a.color=this._textColor,r&&this._fontQuadPanel.addChild(a),a},o.prototype.deleteFontQuad=function(t){this._blankQuad!=t&&(this._fontQuadPanel.removeChild(t),this._quadPool.push(t))},o}(t.DisplayObject);e.UITextField=o}(e=t.gui||(t.gui={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(e){function i(){e.call(this),this._label="",this._textField=new t.UITextField,this._textField.autoSize=t.UITextFieldAutoSize.CENTER,this.addChild(this._textField),this.onRender(),this._textHeight=-1,this._textWidth=-1}return __extends(i,e),Object.defineProperty(i.prototype,"textHeight",{get:function(){return this._textHeight},set:function(t){this._textHeight=t,this.onRender()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"textWidth",{get:function(){return this._textWidth},set:function(t){this._textWidth=t,this.onRender()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"textField",{get:function(){return this._textField},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"label",{get:function(){return this._label},set:function(t){this._label=t,this._textField.text=this._label},enumerable:!0,configurable:!0}),i.prototype.onRender=function(){e.prototype.onRender.call(this),this._textHeight>0?this.textField.textHeight=this._textHeight:this._textField.height=this._skin.height,this._textWidth>0?this.textField.textWidth=this._textWidth:this._textField.width=this._skin.width
},i}(t.UIButton);t.UILabelButton=e}(e=t.gui||(t.gui={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var i=function(i){function r(){i.call(this),this._selected=!1,this._textPadding=5,this.textField.autoSize=e.UITextFieldAutoSize.LEFT,this.textWidth=45,this.onRender()}return __extends(r,i),Object.defineProperty(r.prototype,"buttonAndLabelWidth",{get:function(){return this._skin.width+this.textPadding+this.textWidth},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"textPadding",{get:function(){return this._textPadding},set:function(t){this._textPadding=t,this.onRender()},enumerable:!0,configurable:!0}),r.prototype.onRender=function(){i.prototype.onRender.call(this),this.textField.x=this._skin.width+this._textPadding},Object.defineProperty(r.prototype,"selected",{get:function(){return this._selected},set:function(i){if(this._selected!==i){this._selected=i,this.setMouseState(this._selected?r.STATE_UP_AND_SELECTED:e.UIButton.STATE_UP);var a=new t.Event3D(t.Event3D.CHANGE);a.target=this,this.dispatchEvent(a)}},enumerable:!0,configurable:!0}),r.prototype.setMouseState=function(t){t===e.UIButton.STATE_DOWN?this._selected?i.prototype.setMouseState.call(this,r.STATE_DOWN_AND_SELECTED):i.prototype.setMouseState.call(this,e.UIButton.STATE_DOWN):t===e.UIButton.STATE_UP?this._selected?i.prototype.setMouseState.call(this,r.STATE_UP_AND_SELECTED):i.prototype.setMouseState.call(this,e.UIButton.STATE_UP):i.prototype.setMouseState.call(this,t)},r.prototype.startPress=function(){i.prototype.startPress.call(this),this.setMouseState(this._selected?r.STATE_DOWN_AND_SELECTED:e.UIButton.STATE_DOWN)},r.prototype.endPress=function(){i.prototype.endPress.call(this),this.selected=!this.selected,this.setMouseState(this._selected?r.STATE_UP_AND_SELECTED:e.UIButton.STATE_UP)},r.STATE_DOWN_AND_SELECTED="downAndSelected",r.STATE_UP_AND_SELECTED="upAndSelected",r}(e.UILabelButton);e.UIToggleButtonBase=i}(e=t.gui||(t.gui={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var i=function(i){function r(){i.call(this),this._background=new t.Quad,this._container=new e.UIElement,i.prototype.addChild.call(this,this._background),i.prototype.addChild.call(this,this._container),this._w=100,this._h=100,this.updateMask()}return __extends(r,i),r.prototype.updateMask=function(){this.mask=new t.Rectangle(0,0,this._w,this._h)},Object.defineProperty(r.prototype,"background",{get:function(){return this._background},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"width",{get:function(){return this._w},set:function(t){this._w=t,this._background.width=t,this.updateMask()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._h},set:function(t){this._h=t,this._background.height=t,this.updateMask()},enumerable:!0,configurable:!0}),r.prototype.onRender=function(){i.prototype.onRender.call(this),this.drawBackground(),this.updateMask()},r.prototype.drawBackground=function(){var t=this.getStyle("background");this._background.texture=t},r.prototype.setStyle=function(t,e){i.prototype.setStyle.call(this,t,e),this.onRender()},r.prototype.addChild=function(t){return this._container.addChild(t)},r.prototype.addChildAt=function(t,e){return this._container.addChildAt(t,e)},r.prototype.removeChild=function(t){return this._container.removeChild(t)},r.prototype.removeChildAt=function(t){return this._container.removeChildAt(t)},r.prototype.swapChildIndex=function(t,e){this._container.swapChildIndex(t,e)},r.prototype.hasChild=function(t){return this._container.hasChild(t)},r.prototype.getChildByIndex=function(t){return this._container.getChildByIndex(t)},r.prototype.getChildByName=function(t){return this._container.getChildByName(t)},r}(e.UIElement);e.UIPanel=i}(e=t.gui||(t.gui={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this),this._items=[],this._gap=5,this._selectedIndex=-1,this._selectedItem=null,this._background.addEventListener(t.MouseEvent3D.MOUSE_DOWN,this.onMouseDown,this),this._background.addEventListener(t.MouseEvent3D.MOUSE_UP,this.onMouseUp,this),this._background.addEventListener(t.MouseEvent3D.MOUSE_MOVE,this.onMouseMove,this),this._startDrag=!1,this._container.height=0}return __extends(i,e),i.prototype.onMouseDown=function(){this._startDrag=!0,console.log("mousedown")},i.prototype.onMouseUp=function(){this._startDrag=!1,console.log("mouseup")},i.prototype.onMouseMove=function(){this._startDrag&&(this._container.y+=t.Input.mouseOffsetY,this._container.y>0?this._container.y=0:this._containerHeight<this.height?this._container.y=0:this._container.y<this.height-this._containerHeight&&(this._container.y=this.height-this._containerHeight))},i.prototype.updateView=function(){for(var t=0,e=0;e<this._items.length;e++){var i=this._items[e];i.y=t,t=i.y+i.height+this._gap}this._containerHeight=t},Object.defineProperty(i.prototype,"gap",{get:function(){return this._gap},set:function(t){this._gap=t,this.updateView()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"selectedIndex",{get:function(){return this._selectedIndex},set:function(t){this._selectedIndex=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"selectedItem",{get:function(){return this._selectedItem},set:function(t){this._selectedItem=t},enumerable:!0,configurable:!0}),i.prototype.addItem=function(e){this._items.push(e),this.addChildAt(e,this._container.childs.length),e.addEventListener(t.MouseEvent3D.MOUSE_DOWN,function(){console.log("aaaaaa")},this),e.addEventListener(t.MouseEvent3D.MOUSE_DOWN,this.onMouseDown,this),e.addEventListener(t.MouseEvent3D.MOUSE_UP,this.onMouseUp,this),e.addEventListener(t.MouseEvent3D.MOUSE_MOVE,this.onMouseMove,this),this.updateView()},i.prototype.removeItem=function(e){this.removeChild(e),this._items.splice(this._items.indexOf(e),1),e.removeEventListener(t.MouseEvent3D.MOUSE_DOWN,this.onMouseDown,this),e.removeEventListener(t.MouseEvent3D.MOUSE_UP,this.onMouseUp,this),e.removeEventListener(t.MouseEvent3D.MOUSE_MOVE,this.onMouseMove,this),this.updateView()},i}(t.gui.UIPanel);e.UIList=i}(e=t.gui||(t.gui={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var i=function(t){function e(){t.call(this)}return __extends(e,t),e}(t.gui.UILabelButton);e.UIToggleButton=i}(e=t.gui||(t.gui={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e}(t.UIToggleButtonBase);t.UICheckBox=e}(e=t.gui||(t.gui={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),Object.defineProperty(e.prototype,"group",{set:function(t){this._group=t},enumerable:!0,configurable:!0}),e}(t.UIToggleButtonBase);t.UIRadioButton=e}(e=t.gui||(t.gui={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this),this._items=[],this._enable=!0}return __extends(i,e),Object.defineProperty(i.prototype,"enable",{get:function(){return this._enable},set:function(t){if(this._enable!==t){this._enable=t;for(var e=0;e<this._items.length;e++){var i=this._items[e];i.enable=t}}},enumerable:!0,configurable:!0}),i.prototype.addItem=function(e){this._items.push(e),e.enable=this._enable,e.addEventListener(t.Event3D.CHANGE,this.onItemChange,this)},i.prototype.removeItem=function(e){var i=this._items.indexOf(e);-1!==i&&(e.removeEventListener(t.Event3D.CHANGE,this.onItemChange,this),this._items.splice(i,1))},i.prototype.getRadioButtonAt=function(t){return this._items[t]},i.prototype.onItemChange=function(e){var i=e.target;if(i.selected!==!1&&this._selection!==i){this._selection&&(this._selection.selected=!1),this._selection=i;var r=new t.Event3D(t.Event3D.CHANGE);r.target=this,this.dispatchEvent(r)}},i}(t.EventDispatcher);e.UIRadioButtonGroup=i}(e=t.gui||(t.gui={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this),this._mask=new t.Rectangle,this._background=new t.Quad,this.addChild(this._background),this._bar=new t.Quad,this.addChild(this._bar),this._ratio=.5}return __extends(i,e),Object.defineProperty(i.prototype,"ratio",{get:function(){return this._ratio},set:function(t){t>1?t=1:0>t&&(t=0),this._ratio=t,this.updateBar()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{set:function(t){this._background.width=this._bar.width=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{set:function(t){this._background.height=this._bar.height=t},enumerable:!0,configurable:!0}),i.prototype.setBarRect=function(t,e,i,r){this._bar.x=t,this._bar.y=e,this._bar.width=i,this._bar.height=r},Object.defineProperty(i.prototype,"bar",{get:function(){return this._bar},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"background",{get:function(){return this._background},enumerable:!0,configurable:!0}),i.prototype.updateBar=function(){this._mask.width=this._ratio*this._bar.width,this._mask.height=this._bar.height,this._bar.mask=this._mask},i.prototype.setStyle=function(t,i){e.prototype.setStyle.call(this,t,i),this.updateStyle(),this.updateBar()},i.prototype.updateStyle=function(){this._background.texture=this.getStyle("background"),this._bar.texture=this.getStyle("bar")},i}(e.UIElement);e.UIProgressBar=i}(e=t.gui||(t.gui={}))}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t.pointlight=0]="pointlight",t[t.directlight=1]="directlight",t[t.spotLightlight=2]="spotLightlight"}(t.LightType||(t.LightType={}));var e=(t.LightType,function(e){function i(){e.call(this),this.lightId=-1,this.lightType=-1,this._ambient=new t.Vector3D(0,0,0),this._diffuse=new t.Vector3D(1,1,1),this._specular=new t.Vector3D(1,1,1),this._halfVector=new t.Vector3D(1,1,1),this._intensity=1,this._radius=100,this._cutoff=.01,this._halfIntensity=0,this._spotExponent=1.1,this._spotCutoff=.7,this._spotCosCutoff=.1,this._constantAttenuation=.1,this._linearAttenuation=.1,this._quadraticAttenuation=.1,this._lightIndex=-1,this.len=25,this._change=!0,this.lightViewPos=new t.Vector3D}return __extends(i,e),Object.defineProperty(i.prototype,"intensity",{get:function(){return this._intensity},set:function(t){this._intensity!=t&&(this._intensity=t,this._change=!1)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"halfIntensity",{get:function(){return this._halfIntensity},set:function(t){this._halfIntensity!=t&&(this._halfIntensity=t,this._change=!1)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"ambient",{get:function(){return 0},set:function(t){this._ambient.w=(t>>24&255)/255,this._ambient.x=(t>>16&255)/255,this._ambient.y=(t>>8&255)/255,this._ambient.z=(255&t)/255,this._change=!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"diffuse",{get:function(){return 0},set:function(t){this._diffuse.w=(t>>24&255)/255,this._diffuse.x=(t>>16&255)/255,this._diffuse.y=(t>>8&255)/255,this._diffuse.z=(255&t)/255,this._change=!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"specular",{get:function(){return 0},set:function(t){this._specular.w=(t>>24&255)/255,this._specular.x=(t>>16&255)/255,this._specular.y=(t>>8&255)/255,this._specular.z=(255&t)/255,this._change=!1},enumerable:!0,configurable:!0}),i.prototype.init=function(){},i.prototype.updateLightData=function(){},i}(t.Object3D));t.LightBase=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this),this.scenePosMat=new t.Matrix4_4,this.lightType=t.LightType.pointlight,this.diffuse=i}return __extends(i,e),Object.defineProperty(i.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cutoff",{get:function(){return this._cutoff},set:function(t){this._cutoff=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"ambient",{set:function(t){this._ambient.w=(t>>24&255)/255,this._ambient.x=(t>>16&255)/255,this._ambient.y=(t>>8&255)/255,this._ambient.z=(255&t)/255,this._change=!1},enumerable:!0,configurable:!0}),i.prototype.updateLightData=function(t,e,r){r[e*i.stride]=this.globalPosition.x,r[e*i.stride+1]=this.globalPosition.y,r[e*i.stride+2]=this.globalPosition.z,r[e*i.stride+3]=this._diffuse.x*this._intensity,r[e*i.stride+4]=this._diffuse.y*this._intensity,r[e*i.stride+5]=this._diffuse.z*this._intensity,r[e*i.stride+6]=this._ambient.x,r[e*i.stride+7]=this._ambient.y,r[e*i.stride+8]=this._ambient.z,r[e*i.stride+9]=this._intensity,r[e*i.stride+10]=this._radius,r[e*i.stride+11]=this._cutoff},i.scenePos=new t.Vector3D,i.stride=12,i}(t.LightBase);t.PointLight=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this),this.diffuse=i,this.lightType=t.LightType.spotLightlight}return __extends(i,e),Object.defineProperty(i.prototype,"spotCosCutoff",{get:function(){return this._spotCosCutoff},set:function(t){this._spotCosCutoff=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"spotExponent",{get:function(){return this._spotExponent},set:function(t){this._spotExponent=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"constantAttenuation",{get:function(){return this._constantAttenuation},set:function(t){this._constantAttenuation=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"linearAttenuation",{get:function(){return this._linearAttenuation},set:function(t){this._linearAttenuation=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"quadraticAttenuation",{get:function(){return this._quadraticAttenuation},set:function(t){this._quadraticAttenuation=t},enumerable:!0,configurable:!0}),i.prototype.updateLightData=function(e,r,a){a[r*i.stride]=this.globalPosition.x,a[r*i.stride+1]=this.globalPosition.y,a[r*i.stride+2]=this.globalPosition.z,a[r*i.stride+3]=this.globalRotation.x*t.MathUtil.DEGREES_TO_RADIANS,a[r*i.stride+4]=this.globalRotation.y*t.MathUtil.DEGREES_TO_RADIANS,a[r*i.stride+5]=this.globalRotation.z*t.MathUtil.DEGREES_TO_RADIANS,a[r*i.stride+6]=this._diffuse.x,a[r*i.stride+7]=this._diffuse.y,a[r*i.stride+8]=this._diffuse.z,a[r*i.stride+9]=this._spotExponent,a[r*i.stride+10]=this._spotCosCutoff,a[r*i.stride+11]=this._constantAttenuation,a[r*i.stride+12]=this._linearAttenuation,a[r*i.stride+13]=this._quadraticAttenuation},i.stride=14,i}(t.LightBase);t.SpotLight=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this),this._dir=new t.Vector3D(0,0,1),this._dir.copyFrom(i),this._dir.normalize(),t.Quaternion.fromToRotation(t.Vector3D.Z_AXIS,this._dir,t.Quaternion.HELP_0),this.orientation=t.Quaternion.HELP_0;var r=new t.Vector3D;this.orientation.transformVector(t.Vector3D.Z_AXIS,r),this.lightType=t.LightType.directlight}return __extends(i,e),Object.defineProperty(i.prototype,"ambient",{set:function(t){this._ambient.w=(t>>24&255)/255,this._ambient.x=(t>>16&255)/255,this._ambient.y=(t>>8&255)/255,this._ambient.z=(255&t)/255,this._change=!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"dir",{get:function(){return this._transformChange&&this.modelMatrix,this._dir},set:function(e){this._dir.copyFrom(e),this._dir.normalize(),t.Quaternion.fromToRotation(t.Vector3D.Z_AXIS,this._dir,t.Quaternion.HELP_0),this.orientation=t.Quaternion.HELP_0},enumerable:!0,configurable:!0}),i.prototype.onUpdateTransform=function(){e.prototype.onUpdateTransform.call(this),this.orientation.transformVector(t.Vector3D.Z_AXIS,this._dir),this._dir.normalize(),this.parent&&(this.parent.globalOrientation.transformVector(this._dir,this._dir),this._dir.normalize())},i.prototype.updateLightData=function(t,e,r){r[e*i.stride+0]=this._dir.x,r[e*i.stride+1]=this._dir.y,r[e*i.stride+2]=this._dir.z,r[e*i.stride+3]=this._diffuse.x*this._intensity,r[e*i.stride+4]=this._diffuse.y*this._intensity,r[e*i.stride+5]=this._diffuse.z*this._intensity,r[e*i.stride+6]=this._ambient.x,r[e*i.stride+7]=this._ambient.y,r[e*i.stride+8]=this._ambient.z},i.stride=9,i}(t.LightBase);t.DirectLight=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.lightNum=0,this.directLightList=new Array,this.spotLightList=new Array,this.pointLightList=new Array}return e.prototype.addLight=function(e){switch(e.lightType){case t.LightType.directlight:this.directLightList.push(e),this.lightNum++;break;case t.LightType.pointlight:this.pointLightList.push(e),this.lightNum++;break;case t.LightType.spotLightlight:this.spotLightList.push(e),this.lightNum++}},e.prototype.removeLight=function(e){switch(e.lightType){case t.LightType.directlight:var i=this.directLightList.indexOf(e);i>=0&&i<this.directLightList.length&&(this.directLightList.splice(i,1),this.lightNum--);break;case t.LightType.pointlight:var i=this.pointLightList.indexOf(e);i>=0&&i<this.pointLightList.length&&(this.pointLightList.splice(i,1),this.lightNum--);break;case t.LightType.spotLightlight:var i=this.spotLightList.indexOf(e);i>=0&&i<this.spotLightList.length&&(this.spotLightList.splice(i,1),this.lightNum--)}},e}();t.LightGroup=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){this._num=0,this._objDict={},this.renderList=new Array,this.mousePickList=new Array,this._nodes=new Array}return Object.defineProperty(t.prototype,"root",{get:function(){return this.rootScene},set:function(t){this.rootScene=t},enumerable:!0,configurable:!0}),t.prototype.update=function(t){t.modelMatrix,this.renderList=this._nodes,this.renderList.length=0},t.prototype.findRenderObject=function(t){for(var e=0;e<this.renderList.length;++e)if(this.renderList[e]===t)return e;return-1},t}();t.CollectBase=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.softRenderItems={},this.numberVertex=0,this.numberFace=0,this.numberDraw=0,this.numberSkin=0,this.numberAnimation=0,this.numberParticle=0}return __extends(i,e),i.prototype.applyRender=function(t,e){if(t.visible){t.material&&this.addRenderList(t,e);for(var i=0;i<t.childs.length;i++)this.applyRender(t.childs[i],e)}},i.prototype.addRenderList=function(e,i,r){if(void 0===r&&(r=!0),!e.enableCulling||!r||i.isVisibleToCamera(e)){if(e.material){if("normalObject"==e.tag.name&&e.material.materialData.alphaBlending)this.softRenderItems.alphaObject.push(e);else for(var a=0;a<t.Layer.layerType.length;a++)e.tag.name==t.Layer.layerType[a]&&this.softRenderItems[t.Layer.layerType[a]].push(e);t.Egret3DEngine.instance.debug&&(this.numberFace+=e.geometry.faceCount,this.numberVertex+=e.geometry.vertexCount,this.numberDraw+=1,e.animation&&(this.numberSkin+=1),e.proAnimation&&(this.numberAnimation+=1),"particleEmit"==e.type&&(this.numberParticle+=1))}e.enablePick&&this.mousePickList.push(e)}},i.prototype.update=function(i){if(e.prototype.update.call(this,i),this.numberFace=0,this.numberVertex=0,this.numberDraw=0,this.numberSkin=0,this.numberAnimation=0,this.numberParticle=0,this.clearLayerList(),this.renderList.length=0,this.mousePickList.length=0,this.rootScene.quad){var r=i.frustum.box,a=this.rootScene.quad.getNodesByAABB(r.min.x,r.min.y,r.max.x,r.max.y);this.appendQuadList(a,i)}else this.applyRender(this.rootScene.root,i);for(var n,o=0;o<t.Layer.layerType.length;o++){n=this.softRenderItems[t.Layer.layerType[o]].length,this.softRenderItems[t.Layer.layerType[o]].sort(this.sortByOrder);for(var s=0;n>s;s++)this.renderList.push(this.softRenderItems[t.Layer.layerType[o]][s])}},i.prototype.appendQuadList=function(e,i){for(var r,a,n=0,o=e;n<o.length;n++)a=o[n],a instanceof t.Mesh&&(r=a,r&&r.visible&&r.material&&this.addRenderList(r,i,!1))},i.prototype.clearLayerList=function(){for(var e=0;e<t.Layer.layerType.length;e++)this.softRenderItems[t.Layer.layerType[e]]?this.softRenderItems[t.Layer.layerType[e]].length=0:this.softRenderItems[t.Layer.layerType[e]]=[]},i.prototype.sort=function(e,i,r){var a=t.Vector3D.distance(e.globalPosition,r.position),n=t.Vector3D.distance(i.globalPosition,r.position);return a>n?-1:n>a?1:0},i.prototype.sortByOrder=function(t,e){return e.drawOrder-t.drawOrder},i}(t.CollectBase);t.EntityCollect=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e){void 0===e&&(e=null),this._vtxNum=8,this._planeNum=6,this._frustum=new t.Wireframe,this.nearCenter=new t.Vector3D,this.farCenter=new t.Vector3D,this._tempVector=new t.Vector3D,this.camera=e,this._vertex=new Array;for(var i=0;i<this._vtxNum;++i)this._vertex.push(new t.Vector3D);this._tempVertices=new Array;for(var i=0;i<this._vtxNum;++i)this._tempVertices.push(new t.Vector3D);this._pos=new t.Vector3D,this._plane=new Array;for(var i=0;6>i;++i)this._plane.push(new t.Plane3D);this.box=new t.BoundBox(null,new t.Vector3D,new t.Vector3D),this.center=new t.Vector3D,this._frustum.material.diffuseColor=16777215,this._frustum.name="CameraFrustum",this._frustum.geometry.vertexCount=8,this._frustum.geometry.indexCount=24,this._frustum.geometry.setVertexIndices(0,[0,1,1,2,2,3,0,3,4,5,5,6,6,7,4,7,0,4,1,5,3,7,2,6])}return Object.defineProperty(e.prototype,"vertices",{get:function(){return this._vertex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wireframe",{get:function(){return this._frustum},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return this._frustum.parent?!0:!1},set:function(t){t?this._frustum.parent||this.camera.addChild(this._frustum):this._frustum.parent&&this._frustum.parent.removeChild(this._frustum)},enumerable:!0,configurable:!0}),e.prototype.makeFrustum=function(t,e,i,r){var a=Math.tan(t/2*(Math.PI/180)),n=i*a,o=n*e,s=r*a,h=s*e;this._vertex[0].x=o,this._vertex[0].y=n,this._vertex[0].z=i,this._vertex[1].x=-o,this._vertex[1].y=n,this._vertex[1].z=i,this._vertex[2].x=-o,this._vertex[2].y=-n,this._vertex[2].z=i,this._vertex[3].x=o,this._vertex[3].y=-n,this._vertex[3].z=i,this._vertex[4].x=h,this._vertex[4].y=s,this._vertex[4].z=r,this._vertex[5].x=-h,this._vertex[5].y=s,this._vertex[5].z=r,this._vertex[6].x=-h,this._vertex[6].y=-s,this._vertex[6].z=r,this._vertex[7].x=h,this._vertex[7].y=-s,this._vertex[7].z=r},e.prototype.makeOrthoFrustum=function(t,e,i,r){this._vertex[0].x=t/2,this._vertex[0].y=e/2,this._vertex[0].z=i,this._vertex[1].x=-t/2,this._vertex[1].y=e/2,this._vertex[1].z=i,this._vertex[2].x=-t/2,this._vertex[2].y=-e/2,this._vertex[2].z=i,this._vertex[3].x=t/2,this._vertex[3].y=-e/2,this._vertex[3].z=i,this._vertex[4].x=t/2,this._vertex[4].y=e/2,this._vertex[4].z=r,this._vertex[5].x=-t/2,this._vertex[5].y=e/2,this._vertex[5].z=r,this._vertex[6].x=-t/2,this._vertex[6].y=-e/2,this._vertex[6].z=r,this._vertex[7].x=t/2,this._vertex[7].y=-e/2,this._vertex[7].z=r},e.prototype.makeOrthoToCenterFrustum=function(t,e,i,r,a,n){this._vertex[0].x=e,this._vertex[0].y=r,this._vertex[0].z=a,this._vertex[1].x=t,this._vertex[1].y=r,this._vertex[1].z=a,this._vertex[2].x=t,this._vertex[2].y=i,this._vertex[2].z=a,this._vertex[3].x=e,this._vertex[3].y=i,this._vertex[3].z=a,this._vertex[4].x=e,this._vertex[4].y=r,this._vertex[4].z=n,this._vertex[5].x=t,this._vertex[5].y=r,this._vertex[5].z=n,this._vertex[6].x=t,this._vertex[6].y=i,this._vertex[6].z=n,this._vertex[7].x=e,this._vertex[7].y=i,this._vertex[7].z=n},e.prototype.updateFrustum=function(){switch(this.camera.cameraType){case t.CameraType.perspective:this.makeFrustum(this.camera.fieldOfView,this.camera.aspectRatio,this.camera.near,this.camera.far);break;case t.CameraType.orthogonal:this.makeOrthoFrustum(this.camera.viewPort.width,this.camera.viewPort.height,this.camera.near,this.camera.far);break;case t.CameraType.orthogonalToCenter:this.makeOrthoToCenterFrustum(this.camera.viewPort.x,this.camera.viewPort.y,this.camera.viewPort.width,this.camera.viewPort.height,this.camera.near,this.camera.far)}for(var e=0;e<this.vertices.length;++e)this._frustum.geometry.setVerticesForIndex(e,t.VertexFormat.VF_POSITION,[this.vertices[e].x,this.vertices[e].y,this.vertices[e].z],1)},e.prototype.update=function(){var e=t.Matrix4_4.helpMatrix;e.copyFrom(this.camera.modelMatrix);for(var i=0;i<this._vtxNum;++i)e.transformVector(this._vertex[i],this._tempVertices[i]);this.box.max.x=this.box.max.y=this.box.max.z=-t.MathUtil.MAX_VALUE,this.box.min.x=this.box.min.y=this.box.min.z=t.MathUtil.MAX_VALUE;for(var i=0;i<this._tempVertices.length;++i)this.box.max.x<this._tempVertices[i].x&&(this.box.max.x=this._tempVertices[i].x),this.box.max.y<this._tempVertices[i].y&&(this.box.max.y=this._tempVertices[i].y),this.box.max.z<this._tempVertices[i].z&&(this.box.max.z=this._tempVertices[i].z),this.box.min.x>this._tempVertices[i].x&&(this.box.min.x=this._tempVertices[i].x),this.box.min.y>this._tempVertices[i].y&&(this.box.min.y=this._tempVertices[i].y),this.box.min.z>this._tempVertices[i].z&&(this.box.min.z=this._tempVertices[i].z);this.box.calculateBox(),this._plane[0].fromPoints(this._tempVertices[4],this._tempVertices[5],this._tempVertices[6]),this._plane[1].fromPoints(this._tempVertices[1],this._tempVertices[6],this._tempVertices[5]),this._plane[2].fromPoints(this._tempVertices[0],this._tempVertices[4],this._tempVertices[7]),this._plane[3].fromPoints(this._tempVertices[1],this._tempVertices[0],this._tempVertices[3]),this._plane[4].fromPoints(this._tempVertices[1],this._tempVertices[5],this._tempVertices[4]),this._plane[5].fromPoints(this._tempVertices[3],this._tempVertices[7],this._tempVertices[6]);for(var i=0;i<this._planeNum;i++)this._plane[i].normalize();this.nearCenter.copyFrom(this._tempVertices[0].subtract(this._tempVertices[2])),this.nearCenter.scaleBy(.5),this.nearCenter.copyFrom(this._tempVertices[2].add(this.nearCenter)),this.farCenter.copyFrom(this._tempVertices[4].subtract(this._tempVertices[6])),this.farCenter.scaleBy(.5),this.farCenter.copyFrom(this._tempVertices[6].add(this.farCenter)),this.center.copyFrom(this.farCenter.subtract(this.nearCenter)),this.center.scaleBy(.5),this.center.copyFrom(this.nearCenter.add(this.center))},e.prototype.inPoint=function(t){for(var e=0,i=0;i<this._plane.length;++i)if(e=this._plane[i].distance(t),e>0)return!1;return!0},e.prototype.inSphere=function(t,e){for(var i=0,r=0;r<this._plane.length;++r)if(i=this._plane[r].distance(t),i>e)return!1;return!0},e.prototype.inBox=function(t){for(var e=0,i=this._plane.length,r=0;i>r;++r){for(var a=t.vexData.length/3,n=t.vexData.length,o=0;n>o;o+=3)this._tempVector.setTo(t.vexData[o],t.vexData[o+1],t.vexData[o+2]),this._tempVector.copyFrom(t.transform.transformVector(this._tempVector)),e=this._plane[r].distance(this._tempVector),e>0&&a--;if(0>=a)return!1}return!0},e}();t.Frustum=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){}return t.layerType=["normalObject","normalAlphaObject","alphaObject","decal","effect","gui"],t.layerTypeThan=[3,2,1,0],t.layerNumber=5,t}();t.Layer=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){this.name="normalObject",this.clearDepth=!1}return t}();t.Tag=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.pickObject3DList=function(e,i,r,a,n){void 0===a&&(a=!1),void 0===n&&(n=null),n||(n=new Array),n.length=0;var o=this.ray;if(t.Input.mouseX<i.x||t.Input.mouseX>s+i.width||t.Input.mouseY<i.y||t.Input.mouseY>h+i.height)return n;var s=t.Input.mouseX-i.x,h=t.Input.mouseY-i.y;o.CalculateAndTransformRay(i.width,i.height,i.camera3D.modelMatrix,i.camera3D.projectMatrix,s,h);for(var l=0;l<r.length;++l){var u=r[l];switch(new t.Vector3D,u.pickType){case t.PickType.BoundPick:if(null!=u.bound){var c=u.bound;a?(c=u.currentBound,c&&o.IntersectMesh(c.vexData,c.indexData,c.vexLength,c.indexData.length/3,0,u.modelMatrix,u.pickResult)&&n.push(r[l])):o.IntersectMesh(c.vexData,c.indexData,c.vexLength,c.indexData.length/3,0,u.modelMatrix,u.pickResult)&&n.push(r[l])}break;case t.PickType.PositionPick:var d=0;u.geometry.vertexFormat&t.VertexFormat.VF_POSITION&&(d+=t.Geometry.positionSize),u.geometry.vertexFormat&t.VertexFormat.VF_NORMAL&&(d+=t.Geometry.normalSize),u.geometry.vertexFormat&t.VertexFormat.VF_TANGENT&&(d+=t.Geometry.tangentSize),u.geometry.vertexFormat&t.VertexFormat.VF_COLOR&&(d+=t.Geometry.colorSize),o.IntersectMeshEx(u,d,u.pickResult)&&n.push(r[l]);break;case t.PickType.UVPick:var d=0;u.geometry.vertexFormat&t.VertexFormat.VF_POSITION&&(d+=t.Geometry.positionSize),u.geometry.vertexFormat&t.VertexFormat.VF_NORMAL&&(d+=t.Geometry.normalSize),u.geometry.vertexFormat&t.VertexFormat.VF_TANGENT&&(d+=t.Geometry.tangentSize),u.geometry.vertexFormat&t.VertexFormat.VF_COLOR&&(d+=t.Geometry.colorSize),o.IntersectMeshEx(u,d,u.pickResult)&&n.push(r[l])}}return n},e.ray=new t.Ray,e}();t.Picker=e}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t.normal_geometry=0]="normal_geometry",t[t.skin_geometry=1]="skin_geometry",t[t.particle_geometry=2]="particle_geometry"}(t.GeometryType||(t.GeometryType={})),t.GeometryType,!function(t){t[t.VF_POSITION=1]="VF_POSITION",t[t.VF_NORMAL=2]="VF_NORMAL",t[t.VF_TANGENT=4]="VF_TANGENT",t[t.VF_COLOR=8]="VF_COLOR",t[t.VF_UV0=16]="VF_UV0",t[t.VF_UV1=32]="VF_UV1",t[t.VF_SKIN=64]="VF_SKIN",t[t.VF_UVREC=128]="VF_UVREC",t[t.VF_ROTATION=256]="VF_ROTATION",t[t.VF_SIZE=512]="VF_SIZE",t[t.VF_SCALE=1024]="VF_SCALE",t[t.VF_QUADPOS=2048]="VF_QUADPOS",t[t.VF_QUADOFFSET=4096]="VF_QUADOFFSET",t[t.VF_QUAD_COLOR=8192]="VF_QUAD_COLOR"}(t.VertexFormat||(t.VertexFormat={}));var e=t.VertexFormat,i=function(){function i(){this.geomtryType=-1,this.drawType=t.Context3DProxy.gl.STATIC_DRAW,this._vertexFormat=0,this.vertexAttLength=0,this.faceOrBack=!1,this.subGeometrys=new Array,this._bufferDiry=!0,this._vertexCount=0,this._indexCount=0,this._totalIndexCount=0,this._faceCount=0}return Object.defineProperty(i.prototype,"bufferDiry",{get:function(){return this._bufferDiry},set:function(t){this._bufferDiry=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"skeleton",{get:function(){return this._skeleton},set:function(t){if(t){this._skeleton=t,this.skeletonGPUData=new Float32Array(8*t.jointNum);for(var e=0;e<t.jointNum;++e)this.skeletonGPUData[8*e+3]=1,this.skeletonGPUData[8*e+7]=1}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vertexCount",{get:function(){return this._vertexCount},set:function(t){if(this._vertexCount!=t){var e=t*this.vertexAttLength,i=null;this.vertexArray?this.vertexCount<t?(i=new Float32Array(e),i.set(this.vertexArray),delete this.vertexArray):i=this.vertexArray:i=new Float32Array(e),this.vertexArray=i,this._vertexCount=t}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"indexCount",{get:function(){return this._indexCount},set:function(t){if(this._indexCount=t,this._faceCount=t/3,!(this._totalIndexCount>=t)){var e=new Uint16Array(t);this.indexArray&&(e.set(this.indexArray),delete this.indexArray),this.indexArray=e,this._totalIndexCount=t}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"faceCount",{get:function(){return this._faceCount},set:function(t){this._faceCount!=t&&(this.indexCount=3*t,this._faceCount=t)},enumerable:!0,configurable:!0}),i.prototype.buildDefaultSubGeometry=function(){var e=new t.SubGeometry;e.matID=0,e.geometry=this,e.start=0,e.count=this.indexCount,this.subGeometrys.push(e)},Object.defineProperty(i.prototype,"vertexFormat",{get:function(){return this._vertexFormat},set:function(r){this._vertexFormat=r,this.vertexFormat&e.VF_POSITION&&(this.vertexAttLength+=i.positionSize),this.vertexFormat&e.VF_NORMAL&&(this.vertexAttLength+=i.normalSize),this.vertexFormat&e.VF_TANGENT&&(this.vertexAttLength+=i.tangentSize),this.vertexFormat&e.VF_COLOR&&(this.vertexAttLength+=i.colorSize),this.vertexFormat&e.VF_UV0&&(this.vertexAttLength+=i.uvSize),this.vertexFormat&e.VF_UV1&&(this.vertexAttLength+=i.uv2Size),this.vertexFormat&e.VF_SKIN&&(this.vertexAttLength+=i.skinSize),this.vertexFormat&e.VF_UVREC&&(this.vertexAttLength+=t.QuadData.uvRectangleSize),this.vertexFormat&e.VF_ROTATION&&(this.vertexAttLength+=t.QuadData.rotationSize),this.vertexFormat&e.VF_SIZE&&(this.vertexAttLength+=t.QuadData.offsetSize),this.vertexFormat&e.VF_SCALE&&(this.vertexAttLength+=t.QuadData.scaleSize),this.vertexFormat&e.VF_QUADPOS&&(this.vertexAttLength+=t.QuadData.posSize),this.vertexFormat&e.VF_QUADOFFSET&&(this.vertexAttLength+=t.QuadData.offsetSize),this.vertexFormat&e.VF_QUAD_COLOR&&(this.vertexAttLength+=t.QuadData.colorSize),this.vertexSizeInBytes=4*this.vertexAttLength
},enumerable:!0,configurable:!0}),i.prototype.activeState=function(t,e,i){this._bufferDiry&&(this._bufferDiry=!1,this.upload(i,this.drawType)),i.bindVertexBuffer(this.sharedVertexBuffer),i.bindIndexBuffer(this.sharedIndexBuffer)},i.prototype.upload=function(e,i){void 0===i&&(i=t.Context3DProxy.gl.STATIC_DRAW),this.sharedIndexBuffer||this.sharedVertexBuffer?(e.uploadVertexBuffer(this.sharedVertexBuffer),e.uploadIndexBuffer(this.sharedIndexBuffer)):(this.sharedIndexBuffer=e.creatIndexBuffer(this.indexArray),this.sharedVertexBuffer=e.creatVertexBuffer(this.vertexArray,i))},i.prototype.getVertexForIndex=function(t,r,a,n){if(void 0===a&&(a=null),void 0===n&&(n=1),a||(a=new Array),0>t||t>=this.vertexCount)return a;for(var o=0;n>o;++o){var s=0;if(r&e.VF_POSITION&&(this.vertexFormat&e.VF_POSITION?(a.push(this.vertexArray[t*this.vertexAttLength+s+0]),a.push(this.vertexArray[t*this.vertexAttLength+s+1]),a.push(this.vertexArray[t*this.vertexAttLength+s+2])):a.push(0,0,0)),this.vertexFormat&e.VF_POSITION&&(s+=i.positionSize),r&e.VF_NORMAL&&(this.vertexFormat&e.VF_NORMAL?(a.push(this.vertexArray[t*this.vertexAttLength+s+0]),a.push(this.vertexArray[t*this.vertexAttLength+s+1]),a.push(this.vertexArray[t*this.vertexAttLength+s+2])):a.push(0,0,0)),this.vertexFormat&e.VF_NORMAL&&(s+=i.normalSize),r&e.VF_TANGENT&&(this.vertexFormat&e.VF_TANGENT?(a.push(this.vertexArray[t*this.vertexAttLength+s+0]),a.push(this.vertexArray[t*this.vertexAttLength+s+1]),a.push(this.vertexArray[t*this.vertexAttLength+s+2])):a.push(0,0,0)),this.vertexFormat&e.VF_TANGENT&&(s+=i.tangentSize),r&e.VF_COLOR&&(this.vertexFormat&e.VF_COLOR?(a.push(this.vertexArray[t*this.vertexAttLength+s+0]),a.push(this.vertexArray[t*this.vertexAttLength+s+1]),a.push(this.vertexArray[t*this.vertexAttLength+s+2]),a.push(this.vertexArray[t*this.vertexAttLength+s+3])):a.push(0,0,0,0)),this.vertexFormat&e.VF_COLOR&&(s+=i.colorSize),r&e.VF_UV0&&(this.vertexFormat&e.VF_UV0?(a.push(this.vertexArray[t*this.vertexAttLength+s+0]),a.push(this.vertexArray[t*this.vertexAttLength+s+1])):a.push(0,0)),this.vertexFormat&e.VF_UV0&&(s+=i.uvSize),r&e.VF_UV1&&(this.vertexFormat&e.VF_UV1?(a.push(this.vertexArray[t*this.vertexAttLength+s+0]),a.push(this.vertexArray[t*this.vertexAttLength+s+1])):a.push(0,0)),this.vertexFormat&e.VF_UV1&&(s+=i.uv2Size),r&e.VF_SKIN)if(this.vertexFormat&e.VF_SKIN)for(var h=0;h<i.skinSize;++h)a.push(this.vertexArray[t*this.vertexAttLength+s+h]);else a.push(0,0,0,0,0,0,0,0);this.vertexFormat&e.VF_SKIN&&(s+=i.skinSize),t++}return a},i.prototype.setVerticesForIndex=function(t,r,a,n){void 0===n&&(n=1),t+n>this.vertexCount&&(this.vertexCount=t+n),this._bufferDiry=!0;for(var o=0,s=0,h=0;n>h;++h){if(o=0,this.vertexFormat&e.VF_POSITION&&(r&e.VF_POSITION?(this.vertexArray[t*this.vertexAttLength+o+0]=a[s+0],this.vertexArray[t*this.vertexAttLength+o+1]=a[s+1],this.vertexArray[t*this.vertexAttLength+o+2]=a[s+2]):(this.vertexArray[t*this.vertexAttLength+o+0]=0,this.vertexArray[t*this.vertexAttLength+o+1]=0,this.vertexArray[t*this.vertexAttLength+o+2]=0),o+=i.positionSize),r&e.VF_POSITION&&(s+=i.positionSize),this.vertexFormat&e.VF_NORMAL&&(r&e.VF_NORMAL?(this.vertexArray[t*this.vertexAttLength+o+0]=a[s+0],this.vertexArray[t*this.vertexAttLength+o+1]=a[s+1],this.vertexArray[t*this.vertexAttLength+o+2]=a[s+2]):(this.vertexArray[t*this.vertexAttLength+o+0]=0,this.vertexArray[t*this.vertexAttLength+o+1]=0,this.vertexArray[t*this.vertexAttLength+o+2]=0),o+=i.normalSize),r&e.VF_NORMAL&&(s+=i.normalSize),this.vertexFormat&e.VF_TANGENT&&(r&e.VF_TANGENT?(this.vertexArray[t*this.vertexAttLength+o+0]=a[s+0],this.vertexArray[t*this.vertexAttLength+o+1]=a[s+1],this.vertexArray[t*this.vertexAttLength+o+2]=a[s+2]):(this.vertexArray[t*this.vertexAttLength+o+0]=0,this.vertexArray[t*this.vertexAttLength+o+1]=0,this.vertexArray[t*this.vertexAttLength+o+2]=0),o+=i.tangentSize),r&e.VF_TANGENT&&(s+=i.tangentSize),this.vertexFormat&e.VF_COLOR&&(r&e.VF_COLOR?(this.vertexArray[t*this.vertexAttLength+o+0]=a[s+0],this.vertexArray[t*this.vertexAttLength+o+1]=a[s+1],this.vertexArray[t*this.vertexAttLength+o+2]=a[s+2],this.vertexArray[t*this.vertexAttLength+o+3]=a[s+3]):(this.vertexArray[t*this.vertexAttLength+o+0]=1,this.vertexArray[t*this.vertexAttLength+o+1]=1,this.vertexArray[t*this.vertexAttLength+o+2]=1,this.vertexArray[t*this.vertexAttLength+o+3]=1),o+=i.colorSize),r&e.VF_COLOR&&(s+=i.colorSize),this.vertexFormat&e.VF_UV0&&(r&e.VF_UV0?(this.vertexArray[t*this.vertexAttLength+o+0]=a[s+0],this.vertexArray[t*this.vertexAttLength+o+1]=a[s+1]):(this.vertexArray[t*this.vertexAttLength+o+0]=0,this.vertexArray[t*this.vertexAttLength+o+1]=0),o+=i.uvSize),r&e.VF_UV0&&(s+=i.uvSize),this.vertexFormat&e.VF_UV1&&(r&e.VF_UV1?(this.vertexArray[t*this.vertexAttLength+o+0]=a[s+0],this.vertexArray[t*this.vertexAttLength+o+1]=a[s+1]):(this.vertexArray[t*this.vertexAttLength+o+0]=0,this.vertexArray[t*this.vertexAttLength+o+1]=0),o+=i.uv2Size),r&e.VF_UV1&&(s+=i.uv2Size),this.vertexFormat&e.VF_SKIN){if(r&e.VF_SKIN)for(var l=0;l<i.skinSize;++l)this.vertexArray[t*this.vertexAttLength+o+l]=a[s+l];else for(var l=0;l<i.skinSize;++l)this.vertexArray[t*this.vertexAttLength+o+l]=0;o+=i.skinSize}r&e.VF_SKIN&&(s+=i.skinSize),t++}},i.prototype.getVertexIndices=function(t,e,i){if(void 0===e&&(e=-1),void 0===i&&(i=null),i||(i=new Array),t>=this.indexCount)return i;-1==e?e=this.indexCount:e,t+e>this.indexCount&&(e=this.indexCount-t);for(var r=0;e-t>r;++r)i[r]=this.indexArray[r+t];return i},i.prototype.setVertexIndices=function(t,e){t+e.length>this.indexCount&&(this.indexCount=t+e.length);for(var i=0;i<e.length;++i)this.indexArray[t+i]=e[i]},i.prototype.dispose=function(){this.sharedIndexBuffer&&(this.sharedIndexBuffer.dispose(),this.sharedIndexBuffer=null),this.sharedVertexBuffer&&(this.sharedVertexBuffer.dispose(),this.sharedVertexBuffer=null)},i.positionSize=3,i.normalSize=3,i.tangentSize=3,i.colorSize=4,i.uvSize=2,i.uv2Size=2,i.skinSize=8,i}();t.Geometry=i}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.vertexAttLength=17,this.vertLen=0,this.faces=0,this.source_indexData=new Array,this.source_vertexData=new Array,this.source_vertexColorData=new Array,this.source_normalData=new Array,this.source_tangtData=new Array,this.source_uvData=new Array,this.source_uv2Data=new Array,this.source_skinData=new Array,this.vertexIndex=0,this.indices=new Array,this.vertices=new Array,this.normals=new Array,this.tangts=new Array,this.verticesColor=new Array,this.uvs=new Array,this.uv2s=new Array,this.skinMesh=new Array,this.faceNormals=new Array,this.faceWeights=new Array,this.vertexIndices=new Array,this.uvIndices=new Array,this.uv2Indices=new Array,this.normalIndices=new Array,this.colorIndices=new Array,this.indexIds=new Array,this.matCount=0,this.material={}}return e.buildGeomtry=function(e,i){var r=new t.Geometry;r.vertexFormat=i,r.vertexCount=3*e.faces,r.indexCount=3*e.faces,r.faceCount=e.faces,r.skeleton=e.skeleton;for(var a=new t.Vector3D,n=new t.Vector3D(1,1,1),o=new t.Vector3D(1,1,1,1),s=new t.UV(1,0),h=new t.UV(1,0),l=0,u=0,c=0,d=0;d<e.faces;d++){r.indexArray[3*d+0]=3*d+0,r.indexArray[3*d+1]=3*d+2,r.indexArray[3*d+2]=3*d+1;for(var p=0;3>p;p++)u=3*d+p,u*=r.vertexAttLength,c=0,l=e.vertexIndices[3*d+p]*t.Geometry.positionSize,i&t.VertexFormat.VF_POSITION&&(a.x=e.source_vertexData[l+0],a.y=e.source_vertexData[l+1],a.z=e.source_vertexData[l+2],r.vertexArray[u+c+0]=a.x,r.vertexArray[u+c+1]=a.y,r.vertexArray[u+c+2]=a.z,c+=t.Geometry.positionSize),i&t.VertexFormat.VF_NORMAL&&(e.normalIndices&&e.source_normalData&&e.source_normalData.length>0&&(l=e.normalIndices[3*d+p]*t.Geometry.normalSize,n.x=e.source_normalData[l+0],n.y=e.source_normalData[l+1],n.z=e.source_normalData[l+2]),r.vertexArray[u+c+0]=n.x,r.vertexArray[u+c+1]=n.y,r.vertexArray[u+c+2]=n.z,c+=t.Geometry.normalSize),i&t.VertexFormat.VF_TANGENT&&(r.vertexArray[u+c+0]=0,r.vertexArray[u+c+1]=0,r.vertexArray[u+c+2]=0,c+=t.Geometry.tangentSize),i&t.VertexFormat.VF_COLOR&&(e.colorIndices&&e.source_vertexColorData&&e.source_vertexColorData.length>0&&(l=e.colorIndices[3*d+p]*t.Geometry.colorSize,o.x=e.source_vertexColorData[l+0],o.y=e.source_vertexColorData[l+1],o.z=e.source_vertexColorData[l+2],o.w=e.source_vertexColorData[l+3]),r.vertexArray[u+c+0]=o.x,r.vertexArray[u+c+1]=o.y,r.vertexArray[u+c+2]=o.z,r.vertexArray[u+c+3]=o.w,c+=t.Geometry.colorSize),i&t.VertexFormat.VF_UV0&&(e.uvIndices&&e.source_uvData&&e.source_uvData.length>0&&(l=e.uvIndices[3*d+p]*t.Geometry.uvSize,s.u=e.source_uvData[l+0],s.v=e.source_uvData[l+1]),r.vertexArray[u+c+0]=s.u,r.vertexArray[u+c+1]=s.v,c+=t.Geometry.uvSize),i&t.VertexFormat.VF_UV1&&(e.uv2Indices&&e.source_uv2Data&&e.source_uv2Data.length>0&&(l=e.uv2Indices[3*d+p]*t.Geometry.uv2Size,h.u=e.source_uv2Data[l+0],h.v=e.source_uv2Data[l+1]),r.vertexArray[u+c+0]=h.u,r.vertexArray[u+c+1]=h.v,c+=t.Geometry.uv2Size),i&t.VertexFormat.VF_SKIN&&(null!=e.source_skinData&&e.source_skinData.length>0?(l=e.vertexIndices[3*d+p]*t.Geometry.skinSize,r.vertexArray[u+c+0]=e.source_skinData[l+0],r.vertexArray[u+c+1]=e.source_skinData[l+2],r.vertexArray[u+c+2]=e.source_skinData[l+4],r.vertexArray[u+c+3]=e.source_skinData[l+6],r.vertexArray[u+c+4]=e.source_skinData[l+1],r.vertexArray[u+c+5]=e.source_skinData[l+3],r.vertexArray[u+c+6]=e.source_skinData[l+5],r.vertexArray[u+c+7]=e.source_skinData[l+7]):(r.vertexArray[u+c+0]=0,r.vertexArray[u+c+1]=0,r.vertexArray[u+c+2]=0,r.vertexArray[u+c+3]=0,r.vertexArray[u+c+4]=0,r.vertexArray[u+c+5]=0,r.vertexArray[u+c+6]=0,r.vertexArray[u+c+7]=0))}for(var p=0;p<e.matCount;++p){var f=new t.SubGeometry;f.matID=p,f.geometry=r,f.start=3*e.material[p].start*Uint16Array.BYTES_PER_ELEMENT,f.count=3*e.material[p].count,f.textureDiffuse=e.material[p].textureDiffuse,f.textureNormal=e.material[p].textureNormal,f.textureSpecular=e.material[p].textureSpecular,r.subGeometrys.push(f)}return r},e.combinGeomtryData=function(t,e){void 0===e&&(e=!0);for(var i=0,r=0,a=0,n=0,o=0,s=0,h=0,l=t.vertexDatas;i<t.vertLen;)l[i++]=t.vertices[r++],l[i++]=t.vertices[r++],l[i++]=t.vertices[r++],t.normals&&t.normals.length?(l[i++]=t.normals[a++],l[i++]=t.normals[a++],l[i++]=t.normals[a++]):(l[i++]=0,l[i++]=0,l[i++]=0),t.tangts?(i++,i++,i++):(l[i++]=0,l[i++]=0,l[i++]=0),t.source_vertexColorData&&t.source_vertexColorData.length?(l[i++]=t.verticesColor[s++],l[i++]=t.verticesColor[s++],l[i++]=t.verticesColor[s++],l[i++]=t.verticesColor[s++]):(l[i++]=1,l[i++]=1,l[i++]=1,l[i++]=1),t.uvs&&t.uvs.length?(l[i++]=t.uvs[n++],l[i++]=t.uvs[n++],t.uv2s&&t.uv2s.length?(l[i++]=t.uv2s[o++],l[i++]=t.uv2s[o++]):(l[i++]=t.uvs[o++],l[i++]=t.uvs[o++])):(l[i++]=0,l[i++]=0,l[i++]=0,l[i++]=0),t.skinMesh&&t.skinMesh.length&&(l[i++]=t.skinMesh[h++],l[i++]=t.skinMesh[h++],l[i++]=t.skinMesh[h++],l[i++]=t.skinMesh[h++],l[i++]=t.skinMesh[h++],l[i++]=t.skinMesh[h++],l[i++]=t.skinMesh[h++],l[i++]=t.skinMesh[h++])},e.updateFaceNormals=function(t){for(var e,i,r,a,n,o,s,h,l,u,c,d,p,f,_,m,g,v,y,x,b=0,D=0,T=0,w=t.indices.length,P=t.vertexDatas,S=17,A=3;w>b;){e=A+t.indices[b++]*S,i=P[e],n=P[e+1],h=P[e+2],e=A+t.indices[b++]*S,r=P[e],o=P[e+1],l=P[e+2],e=A+t.indices[b++]*S,a=P[e],s=P[e+1],u=P[e+2],c=a-i,d=s-n,p=u-h,f=r-i,_=o-n,m=l-h,g=p*_-d*m,v=c*m-p*f,y=d*f-c*_,x=Math.sqrt(g*g+v*v+y*y);var C=1e4*x;1>C&&(C=1),t.faceWeights[T++]=C,x=1/x,t.faceNormals[D++]=g*x,t.faceNormals[D++]=v*x,t.faceNormals[D++]=y*x}},e.updateVertexNormals=function(t){this.updateFaceNormals(t);for(var e,i,r=0,a=1,n=2,o=(t.vertexDatas.length,17),s=3,h=0,l=0,u=t.indices.length;u>h;)i=t.faceWeights[l++],e=s+t.indices[h++]*o,t.vertexDatas[e]+=t.faceNormals[r]*i,t.vertexDatas[e++]+=t.faceNormals[a]*i,t.vertexDatas[e++]+=t.faceNormals[n]*i,e=s+t.indices[h++]*o,t.vertexDatas[e]+=t.faceNormals[r]*i,t.vertexDatas[e++]+=t.faceNormals[a]*i,t.vertexDatas[e++]+=t.faceNormals[n]*i,e=s+t.indices[h++]*o,t.vertexDatas[e]+=t.faceNormals[r]*i,t.vertexDatas[e++]+=t.faceNormals[a]*i,t.vertexDatas[e++]+=t.faceNormals[n]*i,r+=3,a+=3,n+=3},e}();t.GeometryData=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.useVertexAttributeList=[],this.start=0,this.count=0,this.matID=0,this.preAttList=new Array,this.localActive=!1}return e.prototype.upload=function(e,i){e.attributeDiry=!1;var r=0;e.attributeList=[],this.geometry.vertexFormat&t.VertexFormat.VF_POSITION&&(e.attribute_position&&(e.attribute_position.uniformIndex||(e.attribute_position.uniformIndex=i.getShaderAttribLocation(e.program3D,e.attribute_position.varName)),e.attribute_position.size=t.Geometry.positionSize,e.attribute_position.dataType=t.ContextConfig.FLOAT,e.attribute_position.normalized=!1,e.attribute_position.stride=this.geometry.vertexSizeInBytes,e.attribute_position.offsetBytes=r,e.attributeList.push(e.attribute_position),this.useVertexAttributeList[e.attribute_position.uniformIndex]=e.attribute_position.uniformIndex),r+=t.Geometry.positionSize*Float32Array.BYTES_PER_ELEMENT),this.geometry.vertexFormat&t.VertexFormat.VF_NORMAL&&(e.attribute_normal&&(e.attribute_normal.uniformIndex||(e.attribute_normal.uniformIndex=i.getShaderAttribLocation(e.program3D,e.attribute_normal.varName)),e.attribute_normal.size=t.Geometry.normalSize,e.attribute_normal.dataType=t.ContextConfig.FLOAT,e.attribute_normal.normalized=!1,e.attribute_normal.stride=this.geometry.vertexSizeInBytes,e.attribute_normal.offsetBytes=r,e.attributeList.push(e.attribute_normal),this.useVertexAttributeList[e.attribute_normal.uniformIndex]=e.attribute_normal.uniformIndex),r+=t.Geometry.normalSize*Float32Array.BYTES_PER_ELEMENT),this.geometry.vertexFormat&t.VertexFormat.VF_TANGENT&&(e.attribute_tangent&&(e.attribute_tangent.uniformIndex||(e.attribute_tangent.uniformIndex=i.getShaderAttribLocation(e.program3D,e.attribute_tangent.varName)),e.attribute_tangent.size=t.Geometry.tangentSize,e.attribute_tangent.dataType=t.ContextConfig.FLOAT,e.attribute_tangent.normalized=!1,e.attribute_tangent.stride=this.geometry.vertexSizeInBytes,e.attribute_tangent.offsetBytes=r,e.attributeList.push(e.attribute_tangent),this.useVertexAttributeList[e.attribute_tangent.uniformIndex]=e.attribute_tangent.uniformIndex),r+=t.Geometry.tangentSize*Float32Array.BYTES_PER_ELEMENT),this.geometry.vertexFormat&t.VertexFormat.VF_COLOR&&(e.attribute_color&&(e.attribute_color.uniformIndex||(e.attribute_color.uniformIndex=i.getShaderAttribLocation(e.program3D,e.attribute_color.varName)),e.attribute_color.size=t.Geometry.colorSize,e.attribute_color.dataType=t.ContextConfig.FLOAT,e.attribute_color.normalized=!1,e.attribute_color.stride=this.geometry.vertexSizeInBytes,e.attribute_color.offsetBytes=r,e.attributeList.push(e.attribute_color),this.useVertexAttributeList[e.attribute_color.uniformIndex]=e.attribute_color.uniformIndex),r+=t.Geometry.colorSize*Float32Array.BYTES_PER_ELEMENT),this.geometry.vertexFormat&t.VertexFormat.VF_UV0&&(e.attribute_uv0&&(e.attribute_uv0.uniformIndex||(e.attribute_uv0.uniformIndex=i.getShaderAttribLocation(e.program3D,e.attribute_uv0.varName)),e.attribute_uv0.size=t.Geometry.uvSize,e.attribute_uv0.dataType=t.ContextConfig.FLOAT,e.attribute_uv0.normalized=!1,e.attribute_uv0.stride=this.geometry.vertexSizeInBytes,e.attribute_uv0.offsetBytes=r,e.attributeList.push(e.attribute_uv0),this.useVertexAttributeList[e.attribute_uv0.uniformIndex]=e.attribute_uv0.uniformIndex),r+=t.Geometry.uvSize*Float32Array.BYTES_PER_ELEMENT),this.geometry.vertexFormat&t.VertexFormat.VF_UV1&&(e.attribute_uv1&&(e.attribute_uv1.uniformIndex||(e.attribute_uv1.uniformIndex=i.getShaderAttribLocation(e.program3D,e.attribute_uv1.varName)),e.attribute_uv1.size=t.Geometry.uv2Size,e.attribute_uv1.dataType=t.ContextConfig.FLOAT,e.attribute_uv1.normalized=!1,e.attribute_uv1.stride=this.geometry.vertexSizeInBytes,e.attribute_uv1.offsetBytes=r,e.attributeList.push(e.attribute_uv1),this.useVertexAttributeList[e.attribute_uv1.uniformIndex]=e.attribute_uv1.uniformIndex),r+=t.Geometry.uv2Size*Float32Array.BYTES_PER_ELEMENT),this.geometry.vertexFormat&t.VertexFormat.VF_SKIN&&(e.attribute_boneIndex&&(e.attribute_boneIndex.uniformIndex||(e.attribute_boneIndex.uniformIndex=i.getShaderAttribLocation(e.program3D,e.attribute_boneIndex.varName)),e.attribute_boneIndex.size=t.Geometry.skinSize/2,e.attribute_boneIndex.dataType=t.ContextConfig.FLOAT,e.attribute_boneIndex.normalized=!1,e.attribute_boneIndex.stride=this.geometry.vertexSizeInBytes,e.attribute_boneIndex.offsetBytes=r,e.attributeList.push(e.attribute_boneIndex),this.useVertexAttributeList[e.attribute_boneIndex.uniformIndex]=e.attribute_boneIndex.uniformIndex),r+=t.Geometry.skinSize/2*Float32Array.BYTES_PER_ELEMENT,e.attribute_boneWeight&&(e.attribute_boneWeight.uniformIndex||(e.attribute_boneWeight.uniformIndex=i.getShaderAttribLocation(e.program3D,e.attribute_boneWeight.varName)),e.attribute_boneWeight.size=t.Geometry.skinSize/2,e.attribute_boneWeight.dataType=t.ContextConfig.FLOAT,e.attribute_boneWeight.normalized=!1,e.attribute_boneWeight.stride=this.geometry.vertexSizeInBytes,e.attribute_boneWeight.offsetBytes=r,e.attributeList.push(e.attribute_boneWeight),this.useVertexAttributeList[e.attribute_boneWeight.uniformIndex]=e.attribute_boneWeight.uniformIndex),r+=t.Geometry.skinSize/2*Float32Array.BYTES_PER_ELEMENT),this.geometry.vertexFormat&t.VertexFormat.VF_QUADPOS&&(e.attribute_position&&(e.attribute_position.uniformIndex||(e.attribute_position.uniformIndex=i.getShaderAttribLocation(e.program3D,e.attribute_position.varName)),e.attribute_position.size=t.QuadData.posSize,e.attribute_position.dataType=t.ContextConfig.FLOAT,e.attribute_position.normalized=!1,e.attribute_position.stride=t.QuadData.vertexBytes,e.attribute_position.offsetBytes=r,e.attributeList.push(e.attribute_position),this.useVertexAttributeList[e.attribute_position.uniformIndex]=e.attribute_position.uniformIndex),r+=t.QuadData.posSize*Float32Array.BYTES_PER_ELEMENT),this.geometry.vertexFormat&t.VertexFormat.VF_QUADOFFSET&&(e.attribute_shapePosition&&(e.attribute_shapePosition.uniformIndex||(e.attribute_shapePosition.uniformIndex=i.getShaderAttribLocation(e.program3D,e.attribute_shapePosition.varName)),e.attribute_shapePosition.size=t.QuadData.offsetSize,e.attribute_shapePosition.dataType=t.ContextConfig.FLOAT,e.attribute_shapePosition.normalized=!1,e.attribute_shapePosition.stride=t.QuadData.vertexBytes,e.attribute_shapePosition.offsetBytes=r,e.attributeList.push(e.attribute_shapePosition),this.useVertexAttributeList[e.attribute_shapePosition.uniformIndex]=e.attribute_shapePosition.uniformIndex),r+=t.QuadData.offsetSize*Float32Array.BYTES_PER_ELEMENT),this.geometry.vertexFormat&t.VertexFormat.VF_UVREC&&(e.attribute_uvRec&&(e.attribute_uvRec.uniformIndex||(e.attribute_uvRec.uniformIndex=i.getShaderAttribLocation(e.program3D,e.attribute_uvRec.varName)),e.attribute_uvRec.size=t.QuadData.uvRectangleSize,e.attribute_uvRec.dataType=t.ContextConfig.FLOAT,e.attribute_uvRec.normalized=!1,e.attribute_uvRec.stride=t.QuadData.vertexBytes,e.attribute_uvRec.offsetBytes=r,e.attributeList.push(e.attribute_uvRec),this.useVertexAttributeList[e.attribute_uvRec.uniformIndex]=e.attribute_uvRec.uniformIndex),r+=t.QuadData.uvRectangleSize*Float32Array.BYTES_PER_ELEMENT),this.geometry.vertexFormat&t.VertexFormat.VF_ROTATION&&(e.attribute_rotate&&(e.attribute_rotate.uniformIndex||(e.attribute_rotate.uniformIndex=i.getShaderAttribLocation(e.program3D,e.attribute_rotate.varName)),e.attribute_rotate.size=t.QuadData.rotationSize,e.attribute_rotate.dataType=t.ContextConfig.FLOAT,e.attribute_rotate.normalized=!1,e.attribute_rotate.stride=t.QuadData.vertexBytes,e.attribute_rotate.offsetBytes=r,e.attributeList.push(e.attribute_rotate),this.useVertexAttributeList[e.attribute_rotate.uniformIndex]=e.attribute_rotate.uniformIndex),r+=t.QuadData.rotationSize*Float32Array.BYTES_PER_ELEMENT),this.geometry.vertexFormat&t.VertexFormat.VF_SCALE&&(e.attribute_maskRectangle&&(e.attribute_maskRectangle.uniformIndex||(e.attribute_maskRectangle.uniformIndex=i.getShaderAttribLocation(e.program3D,e.attribute_maskRectangle.varName)),e.attribute_maskRectangle.size=t.QuadData.scaleSize,e.attribute_maskRectangle.dataType=t.ContextConfig.FLOAT,e.attribute_maskRectangle.normalized=!1,e.attribute_maskRectangle.stride=t.QuadData.vertexBytes,e.attribute_maskRectangle.offsetBytes=r,e.attributeList.push(e.attribute_maskRectangle),this.useVertexAttributeList[e.attribute_maskRectangle.uniformIndex]=e.attribute_maskRectangle.uniformIndex),r+=t.QuadData.scaleSize*Float32Array.BYTES_PER_ELEMENT),this.geometry.vertexFormat&t.VertexFormat.VF_QUAD_COLOR&&(e.attribute_quad_color&&(e.attribute_quad_color.uniformIndex||(e.attribute_quad_color.uniformIndex=i.getShaderAttribLocation(e.program3D,e.attribute_quad_color.varName)),e.attribute_quad_color.size=t.QuadData.colorSize,e.attribute_quad_color.dataType=t.ContextConfig.FLOAT,e.attribute_quad_color.normalized=!1,e.attribute_quad_color.stride=t.QuadData.vertexBytes,e.attribute_quad_color.offsetBytes=r,e.attributeList.push(e.attribute_quad_color),this.useVertexAttributeList[e.attribute_quad_color.uniformIndex]=e.attribute_quad_color.uniformIndex),r+=t.QuadData.colorSize*Float32Array.BYTES_PER_ELEMENT);for(var a=0;a<this.preAttList.length;++a){var n=this.preAttList[a],o=e[n.name];o&&(o.uniformIndex||(o.uniformIndex=i.getShaderAttribLocation(e.program3D,o.varName),o.size=n.size,o.dataType=t.ContextConfig.FLOAT,o.normalized=!1,o.stride=this.geometry.vertexSizeInBytes,o.offsetBytes=r,e.attributeList.push(o),this.useVertexAttributeList[o.uniformIndex]=o.uniformIndex)),r+=n.size*Float32Array.BYTES_PER_ELEMENT}},e.prototype.activeState=function(t,e,i,r){i.attributeDiry&&this.upload(i,r);for(var a=(r.activeAttribPointer(this.geometry.vertexFormat,i.attributeList.length),0);a<i.attributeList.length;a++){var n=i.attributeList[a];n.uniformIndex>=0&&r.vertexAttribPointer(n.uniformIndex,n.size,n.dataType,n.normalized,n.stride,n.offsetBytes)}},e.use=!1,e}();t.SubGeometry=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(t,i,r){void 0===t&&(t=80),void 0===i&&(i=80),void 0===r&&(r=80),e.call(this),this._width=80,this._height=80,this._depth=80,this._width=t,this._height=i,this._depth=r,this.buildGeomtry(!0)}return __extends(i,e),Object.defineProperty(i.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"depth",{get:function(){return this._depth},enumerable:!0,configurable:!0}),i.prototype.buildGeomtry=function(e){this.vertexFormat=t.VertexFormat.VF_POSITION|t.VertexFormat.VF_NORMAL|t.VertexFormat.VF_TANGENT|t.VertexFormat.VF_COLOR|t.VertexFormat.VF_UV0|t.VertexFormat.VF_UV1,this.vertexCount=36,this.indexCount=36,this.vertexArray.set([.5*-this._width,.5*-this._height,.5*-this._depth,0,0,-10,1,0,0,1,1,1,1,1,0,0,0,.5*-this._width,.5*this._height,.5*-this._depth,0,0,-10,1,0,0,1,1,1,1,1,1,0,0,.5*this._width,.5*this._height,.5*-this._depth,0,0,-10,1,0,0,1,1,1,1,0,1,0,0,.5*this._width,.5*this._height,.5*-this._depth,0,0,-10,1,0,0,1,1,1,1,0,1,0,0,.5*this._width,.5*-this._height,.5*-this._depth,0,0,-10,1,0,0,1,1,1,1,0,0,0,0,.5*-this._width,.5*-this._height,.5*-this._depth,0,0,-10,1,0,0,1,1,1,1,1,0,0,0,.5*-this._width,.5*-this._height,.5*this._depth,0,0,10,1,0,0,1,1,1,1,0,0,0,0,.5*this._width,.5*-this._height,.5*this._depth,0,0,10,1,0,0,1,1,1,1,1,0,0,0,.5*this._width,.5*this._height,.5*this._depth,0,0,10,1,0,0,1,1,1,1,1,1,0,0,.5*this._width,.5*this._height,.5*this._depth,0,0,10,1,0,0,1,1,1,1,1,1,0,0,.5*-this._width,.5*this._height,.5*this._depth,0,0,10,1,0,0,1,1,1,1,0,1,0,0,.5*-this._width,.5*-this._height,.5*this._depth,0,0,10,1,0,0,1,1,1,1,0,0,0,0,.5*-this._width,.5*-this._height,.5*-this._depth,0,-10,0,1,0,0,1,1,1,1,0,0,0,0,.5*this._width,.5*-this._height,.5*-this._depth,0,-10,0,1,0,0,1,1,1,1,1,0,0,0,.5*this._width,.5*-this._height,.5*this._depth,0,-10,0,1,0,0,1,1,1,1,1,1,0,0,.5*this._width,.5*-this._height,.5*this._depth,0,-10,0,1,0,0,1,1,1,1,1,1,0,0,.5*-this._width,.5*-this._height,.5*this._depth,0,-10,0,1,0,0,1,1,1,1,0,1,0,0,.5*-this._width,.5*-this._height,.5*-this._depth,0,-10,0,1,0,0,1,1,1,1,0,0,0,0,.5*this._width,.5*-this._height,.5*-this._depth,10,0,0,1,0,0,1,1,1,1,0,0,0,0,.5*this._width,.5*this._height,.5*-this._depth,10,0,0,1,0,0,1,1,1,1,1,0,0,0,.5*this._width,.5*this._height,.5*this._depth,10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*this._width,.5*this._height,.5*this._depth,10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*this._width,.5*-this._height,.5*this._depth,10,0,0,1,0,0,1,1,1,1,0,1,0,0,.5*this._width,.5*-this._height,.5*-this._depth,10,0,0,1,0,0,1,1,1,1,0,0,0,0,.5*this._width,.5*this._height,.5*-this._depth,0,10,0,1,0,0,1,1,1,1,0,0,0,0,.5*-this._width,.5*this._height,.5*-this._depth,0,10,0,1,0,0,1,1,1,1,1,0,0,0,.5*-this._width,.5*this._height,.5*this._depth,0,10,0,1,0,0,1,1,1,1,1,1,0,0,.5*-this._width,.5*this._height,.5*this._depth,0,10,0,1,0,0,1,1,1,1,1,1,0,0,.5*this._width,.5*this._height,.5*this._depth,0,10,0,1,0,0,1,1,1,1,0,1,0,0,.5*this._width,.5*this._height,.5*-this._depth,0,10,0,1,0,0,1,1,1,1,0,0,0,0,.5*-this._width,.5*this._height,.5*-this._depth,-10,0,0,1,0,0,1,1,1,1,0,0,0,0,.5*-this._width,.5*-this._height,.5*-this._depth,-10,0,0,1,0,0,1,1,1,1,1,0,0,0,.5*-this._width,.5*-this._height,.5*this._depth,-10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*-this._width,.5*-this._height,.5*this._depth,-10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*-this._width,.5*this._height,.5*this._depth,-10,0,0,1,0,0,1,1,1,1,0,1,0,0,.5*-this._width,.5*this._height,.5*-this._depth,-10,0,0,1,0,0,1,1,1,1,0,0,0,0]),this.indexArray.set(e?[0,2,1,3,5,4,6,8,7,9,11,10,12,14,13,15,17,16,18,20,19,21,23,22,24,26,25,27,29,28,30,32,31,33,35,34]:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35]),this.buildDefaultSubGeometry()},i}(t.Geometry);t.CubeGeometry=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(t,i){void 0===t&&(t=100),void 0===i&&(i=200),e.call(this),this._height=t,this._radius=i,this.buildGeomtry()}return __extends(i,e),Object.defineProperty(i.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"radius",{get:function(){return this._radius},enumerable:!0,configurable:!0}),i.prototype.buildGeomtry=function(){this.vertexFormat=t.VertexFormat.VF_POSITION|t.VertexFormat.VF_NORMAL|t.VertexFormat.VF_TANGENT|t.VertexFormat.VF_COLOR|t.VertexFormat.VF_UV0|t.VertexFormat.VF_UV1;var e=[],i=[],r=20,a=20,n=2*Math.PI/r;for(a=0;r>a;a++){var o=this._radius*Math.sin(a*n),s=this._radius*Math.cos(a*n);e.push(o,0+this._height/2,s,o,0,s,1,0,0,1,1,1,1,1,0,0,0,o,0-this._height/2,s,o,0,s,1,0,0,1,1,1,1,1,0,0,0)}var h=e.length/this.vertexAttLength,l=h;e.push(0,0-this._height/2,0,0,-1,0,1,0,0,1,1,1,1,1,0,0,0);var u=h+1;e.push(0,0+this._height/2,0,0,1,0,1,0,0,1,1,1,1,1,0,0,0);for(var c=0;h>c;c++)0!=(1&c)?i.push(c,c+1>=h?c+1-h:c+1,c+2>=h?c+2-h:c+2,l,c,c+2>=h?c+2-h:c+2):i.push(c+1>=h?c+1-h:c+1,c,c+2>=h?c+2-h:c+2,c,u,c+2>=h?c+2-h:c+2);this.setVerticesForIndex(0,this.vertexFormat,e,e.length/this.vertexAttLength),this.setVertexIndices(0,i);var d=new t.SubGeometry;d.geometry=this,d.start=0,d.count=this.indexCount,this.subGeometrys.push(d)},i}(t.Geometry);t.CylinderGeometry=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r,a,n,o,s,h,l,u){void 0===i&&(i=500),void 0===r&&(r=500),void 0===a&&(a=1),void 0===n&&(n=1),void 0===o&&(o=1),void 0===s&&(s=1),void 0===h&&(h=t.Vector3D.Y_AXIS),void 0===l&&(l=!0),void 0===u&&(u=!0),e.call(this),this._segmentsW=1,this._segmentsH=1,this._width=500,this._height=500,this._scaleU=1,this._scaleV=1,this._width=i,this._height=r,this._segmentsW=a,this._segmentsH=n,this._scaleU=o,this._scaleV=s,this._wCenter=l,this._hCenter=u,this.buildGeometry(h)}return __extends(i,e),Object.defineProperty(i.prototype,"segmentsW",{get:function(){return this._segmentsW},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"segmentsH",{get:function(){return this._segmentsH},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleU",{get:function(){return this._scaleU},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleV",{get:function(){return this._scaleV},enumerable:!0,configurable:!0}),i.prototype.buildGeometry=function(e){this.vertexFormat=t.VertexFormat.VF_POSITION|t.VertexFormat.VF_NORMAL|t.VertexFormat.VF_TANGENT|t.VertexFormat.VF_COLOR|t.VertexFormat.VF_UV0;var i,r,a,n,o=this._segmentsW+1,s=(this._segmentsH+1)*o,h=this.vertexAttLength,l=h-15;a=this._segmentsH*this._segmentsW*6,this.vertexCount=s,this.indexCount=a,a=0;for(var u=(new t.Vector3D,0),c=0;c<=this._segmentsH;++c)for(var d=0;d<=this._segmentsW;++d){switch(i=(d/this._segmentsW-.5)*this._width,r=(c/this._segmentsH-.5)*this._height,0==this._wCenter&&(i+=this._width/2),0==this._hCenter&&(r+=this._height/2),e){case t.Vector3D.Y_AXIS:this.vertexArray[u++]=i,this.vertexArray[u++]=0,this.vertexArray[u++]=r,this.vertexArray[u++]=0,this.vertexArray[u++]=1,this.vertexArray[u++]=0;break;case t.Vector3D.Z_AXIS:this.vertexArray[u++]=i,this.vertexArray[u++]=r,this.vertexArray[u++]=0,this.vertexArray[u++]=0,this.vertexArray[u++]=0,this.vertexArray[u++]=-1;break;case t.Vector3D.X_AXIS:this.vertexArray[u++]=0,this.vertexArray[u++]=i,this.vertexArray[u++]=r,this.vertexArray[u++]=1,this.vertexArray[u++]=0,this.vertexArray[u++]=0;break;default:this.vertexArray[u++]=i,this.vertexArray[u++]=0,this.vertexArray[u++]=r,this.vertexArray[u++]=0,this.vertexArray[u++]=1,this.vertexArray[u++]=0}if(this.vertexArray[u++]=1,this.vertexArray[u++]=0,this.vertexArray[u++]=0,this.vertexArray[u++]=1,this.vertexArray[u++]=1,this.vertexArray[u++]=1,this.vertexArray[u++]=1,this.vertexArray[u++]=d/this._segmentsW*this._scaleU,this.vertexArray[u++]=(1-c/this._segmentsH)*this._scaleV,u+=l,d!=this._segmentsW&&c!=this._segmentsH){n=d+c*o;var p=1;this.indexArray[a++]=n*p,this.indexArray[a++]=(n+o+1)*p,this.indexArray[a++]=(n+o)*p,this.indexArray[a++]=n*p,this.indexArray[a++]=(n+1)*p,this.indexArray[a++]=(n+o+1)*p}}var f=new t.SubGeometry;f.geometry=this,f.start=0,f.count=this.indexCount,this.subGeometrys.push(f)},i}(t.Geometry);t.PlaneGeometry=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(t,i,r){void 0===t&&(t=100),void 0===i&&(i=15),void 0===r&&(r=15),e.call(this),this._segmentsW=50,this._segmentsH=50,this._radius=100,this._radius=t,this._segmentsW=i,this._segmentsH=r,this.buildSphere(!0)}return __extends(i,e),Object.defineProperty(i.prototype,"segmentsW",{get:function(){return this._segmentsW},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"segmentsH",{get:function(){return this._segmentsH},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"radius",{get:function(){return this._radius},enumerable:!0,configurable:!0}),i.prototype.buildSphere=function(e){void 0===e&&(e=!0),this.vertexFormat=t.VertexFormat.VF_POSITION|t.VertexFormat.VF_NORMAL|t.VertexFormat.VF_TANGENT|t.VertexFormat.VF_COLOR|t.VertexFormat.VF_UV0|t.VertexFormat.VF_UV1;var i=0,r=0,a=0,n=(this._segmentsH+1)*(this._segmentsW+1),o=this.vertexAttLength,s=o-9;this.vertexCount=n,this.indexCount=(this._segmentsH-1)*this._segmentsW*6;var h=0,l=0,u=0,c=0,d=0,p=0;for(r=0;r<=this._segmentsH;++r){h=l;var f=Math.PI*r/this._segmentsH,_=-this._radius*Math.cos(f),m=this._radius*Math.sin(f);for(i=0;i<=this._segmentsW;++i){var g=2*Math.PI*i/this._segmentsW,v=m*Math.cos(g),y=m*Math.sin(g),x=1/Math.sqrt(v*v+y*y+_*_),b=Math.sqrt(y*y+v*v);if(d=0,p=b>.007?v/b:0,u=-_,c=y,i==this._segmentsW?(this.vertexArray[l++]=this.vertexArray[h],this.vertexArray[l++]=this.vertexArray[h+1],this.vertexArray[l++]=this.vertexArray[h+2],this.vertexArray[l++]=v*x,this.vertexArray[l++]=u*x,this.vertexArray[l++]=c*x,this.vertexArray[l++]=b>.007?-y/b:1,this.vertexArray[l++]=d,this.vertexArray[l++]=p,this.vertexArray[l+0]=1,this.vertexArray[l+1]=1,this.vertexArray[l+2]=1,this.vertexArray[l+3]=1):(this.vertexArray[l++]=v,this.vertexArray[l++]=u,this.vertexArray[l++]=c,this.vertexArray[l++]=v*x,this.vertexArray[l++]=u*x,this.vertexArray[l++]=c*x,this.vertexArray[l++]=b>.007?-y/b:1,this.vertexArray[l++]=d,this.vertexArray[l++]=p,this.vertexArray[l]=1,this.vertexArray[l+1]=1,this.vertexArray[l+2]=1,this.vertexArray[l+3]=1),i>0&&r>0){var D=(this._segmentsW+1)*r+i,T=(this._segmentsW+1)*r+i-1,w=(this._segmentsW+1)*(r-1)+i-1,P=(this._segmentsW+1)*(r-1)+i;
r==this._segmentsH?(this.vertexArray[l-9]=this.vertexArray[h],this.vertexArray[l-8]=this.vertexArray[h+1],this.vertexArray[l-7]=this.vertexArray[h+2],e?(this.indexArray[a++]=D,this.indexArray[a++]=P,this.indexArray[a++]=w):(this.indexArray[a++]=D,this.indexArray[a++]=w,this.indexArray[a++]=P)):1==r?e?(this.indexArray[a++]=D,this.indexArray[a++]=w,this.indexArray[a++]=T):(this.indexArray[a++]=D,this.indexArray[a++]=T,this.indexArray[a++]=w):e?(this.indexArray[a++]=D,this.indexArray[a++]=P,this.indexArray[a++]=w,this.indexArray[a++]=D,this.indexArray[a++]=w,this.indexArray[a++]=T):(this.indexArray[a++]=D,this.indexArray[a++]=w,this.indexArray[a++]=P,this.indexArray[a++]=D,this.indexArray[a++]=T,this.indexArray[a++]=w)}l+=s}}var o=17,s=((this._segmentsH+1)*(this._segmentsW+1)*o,o-2),l=13;for(r=0;r<=this._segmentsH;++r)for(i=0;i<=this._segmentsW;++i)this.vertexArray[l++]=i/this._segmentsW,this.vertexArray[l++]=r/this._segmentsH,l+=s;var S=new t.SubGeometry;S.geometry=this,S.start=0,S.count=this.indexCount,this.subGeometrys.push(S)},i}(t.Geometry);t.SphereGeometry=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.createGeometry=function(e){void 0===e&&(e=t.VertexFormat.VF_POSITION|t.VertexFormat.VF_NORMAL|t.VertexFormat.VF_TANGENT|t.VertexFormat.VF_COLOR|t.VertexFormat.VF_UV0|t.VertexFormat.VF_UV1);var i=new t.Geometry;return i.vertexFormat=e,i},e.createGemetryForType=function(e,i){switch(e){case"CubeGeometry":return new t.CubeGeometry(i.width,i.height,i.depth);case"CylinderGeometry":return new t.CylinderGeometry(i.height,i.radius);case"ElevationGeometry":return new t.ElevationGeometry(i.heightmap,i.width,i.height,i.depth,i.segmentsW,i.segmentsH);case"PlaneGeometry":return new t.PlaneGeometry(i.width,i.height,i.segmentsW,i.segmentsH,i.uScale,i.vScale);case"SphereGeometry":return new t.SphereGeometry(i.r,i.segmentsW,i.segmentsH)}return null},e}();t.GeometryUtil=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(t,i,r,a,n,o,s,h){void 0===i&&(i=1e3),void 0===r&&(r=100),void 0===a&&(a=1e3),void 0===n&&(n=30),void 0===o&&(o=30),void 0===s&&(s=255),void 0===h&&(h=0),e.call(this),this._width=100,this._height=100,this._segmentsW=100,this._segmentsH=100,this._depth=100,this._minElevation=100,this._maxElevation=100,this._scaleU=1,this._scaleV=1,this._segmentsW=n,this._segmentsH=o,this._width=i,this._height=r,this._depth=a,this._minElevation=h,this._maxElevation=s,this._heightmap=t,this._canvas=document.createElement("canvas");var l=this._canvas.getContext("2d");this._canvas.width=t.imageData.width,this._canvas.height=t.imageData.height,l.drawImage(t.imageData,0,0,t.width,t.height),document.body.appendChild(this._canvas),this._canvas.hidden=!0,this.imageData=l.getImageData(0,0,this._heightmap.imageData.width,this._heightmap.imageData.height),document.body.removeChild(this._canvas),this.buildGeomtry(!0)}return __extends(i,e),Object.defineProperty(i.prototype,"segmentsW",{get:function(){return this._segmentsW},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"segmentsH",{get:function(){return this._segmentsH},enumerable:!0,configurable:!0}),i.prototype.buildGeomtry=function(){this.vertexFormat=t.VertexFormat.VF_POSITION|t.VertexFormat.VF_NORMAL|t.VertexFormat.VF_TANGENT|t.VertexFormat.VF_COLOR|t.VertexFormat.VF_UV0|t.VertexFormat.VF_UV1;var e,i,r,a,n,o,s,h=this._segmentsW+1,l=(this._segmentsH+1)*h,u=(this._heightmap.width-1)/this._segmentsW,c=(this._heightmap.height-1)/this._segmentsH;this.vertexCount=l,this.indexCount=this._segmentsH*this._segmentsW*6,l=0,r=0;for(var d=0;d<=this._segmentsH;++d)for(var p=0;p<=this._segmentsW;++p)e=(p/this._segmentsW-.5)*this._width,i=(d/this._segmentsH-.5)*this._depth,n=Math.floor(p*u),o=Math.floor((this._segmentsH-d)*c),s=this.getHeightBypos(n,o),this.vertexArray[l++]=e,this.vertexArray[l++]=s,this.vertexArray[l++]=i,this.vertexArray[l++]=1,this.vertexArray[l++]=1,this.vertexArray[l++]=1,this.vertexArray[l++]=-1,this.vertexArray[l++]=0,this.vertexArray[l++]=0,this.vertexArray[l++]=1,this.vertexArray[l++]=1,this.vertexArray[l++]=1,this.vertexArray[l++]=1,this.vertexArray[l++]=p/this._segmentsW*this._scaleU,this.vertexArray[l++]=1-d/this._segmentsH*this._scaleV,this.vertexArray[l++]=p/this._segmentsW,this.vertexArray[l++]=1-d/this._segmentsH,p!=this._segmentsW&&d!=this._segmentsH&&(a=p+d*h,this.indexArray[r++]=a,this.indexArray[r++]=a+h+1,this.indexArray[r++]=a+h,this.indexArray[r++]=a,this.indexArray[r++]=a+1,this.indexArray[r++]=a+h+1);this.updateFaceNormals(),this.buildDefaultSubGeometry()},i.prototype.getPixel=function(t,e){var i=4*(e*this._heightmap.imageData.width+t),r=this.imageData.data[i+3]<<24|this.imageData.data[i+0]<<16|this.imageData.data[i+1]<<8|this.imageData.data[i+2];return r},i.prototype.getHeightBypos=function(t,e){var i=255&this.getPixel(t,e);return i>this._maxElevation?this._maxElevation/255*this._height:i<this._minElevation?this._minElevation/255*this._height:i/255*this._height},i.prototype.updateFaceNormals=function(){for(var t,e,i,r,a,n,o,s,h,l,u,c,d,p,f,_,m,g,v,y,x=0,b=0,D=this.indexCount,T=17,w=0,P=[];D>x;)t=w+this.indexArray[x+0]*T,e=this.vertexArray[t],a=this.vertexArray[t+1],s=this.vertexArray[t+2],t=w+this.indexArray[x+1]*T,i=this.vertexArray[t],n=this.vertexArray[t+1],h=this.vertexArray[t+2],t=w+this.indexArray[x+2]*T,r=this.vertexArray[t],o=this.vertexArray[t+1],l=this.vertexArray[t+2],u=i-e,c=n-a,d=h-s,p=r-e,f=o-a,_=l-s,m=d*f-c*_,g=u*_-d*p,v=c*p-u*f,y=Math.sqrt(m*m+g*g+v*v),P[b++]=v*y,P[b++]=g*y,P[b++]=m*y,x+=3;x=0;for(var S=0,A=1,C=2,E=this.vertexAttLength,M=3;D>x;)t=M+this.indexArray[x++]*E,this.vertexArray[t++]=P[S],this.vertexArray[t++]=P[A],this.vertexArray[t++]=P[C],t=M+this.indexArray[x++]*E,this.vertexArray[t++]=P[S],this.vertexArray[t++]=P[A],this.vertexArray[t++]=P[C],t=M+this.indexArray[x++]*E,this.vertexArray[t++]=P[S],this.vertexArray[t++]=P[A],this.vertexArray[t++]=P[C],S+=3,A+=3,C+=3},i}(t.Geometry);t.ElevationGeometry=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){var i=this;e.call(this),this._time=0,this._keyStatus={},this._mouseStatus={},this._isTouchStart=!1,this._mouseEvent3d=new t.MouseEvent3D,this._keyEvent3d=new t.KeyEvent3D,this._touchEvent3d=new t.TouchEvent3D,this._windowsEvent3d=new t.Event3D,this._orientationEvent3d=new t.OrientationEvent3D,this.onGamepadStick1=null,this.onGamepadStick2=null,this._gp=!1,this._oldPosition1=null,this._oldPosition2=null,window.addEventListener("click",function(t){return i.mouseClick(t)},!0),window.addEventListener("mousedown",function(t){return i.mouseStart(t)},!0),window.addEventListener("mouseup",function(t){return i.mouseEnd(t)},!0),window.addEventListener("mousewheel",function(t){return i.mouseWheel(t)},!0),window.addEventListener("mousemove",function(t){return i.mouseMove(t)},!0),window.addEventListener("mouseover",function(t){return i.mouseOver(t)},!0),window.addEventListener("keydown",function(t){return i.keyDown(t)},!0),window.addEventListener("keyup",function(t){return i.keyUp(t)},!0),this.canGame()&&(window.addEventListener("gamepadconnected",function(t){return i.ongamepadconnected(t)},!0),window.addEventListener("gamepaddisconnected",function(t){return i.ongamepaddisconnected(t)},!0)),window.addEventListener("touchstart",function(t){return i.touchStart(t)},!0),window.addEventListener("touchend",function(t){return i.touchEnd(t)},!0),window.addEventListener("touchmove",function(t){return i.touchMove(t)},!0),window.addEventListener("touchcancel",function(t){return i.touchEnd(t)},!0),window.addEventListener("resize",function(t){return i.onWindowsResize(t)},!0),window.addEventListener("orientationchange",function(t){return i.onOrientationChange(t)},!0),window.addEventListener("devicemotion",function(t){return i.onDeviceMotion(t)},!0),window.addEventListener("deviceorientation",function(t){return i.onDeviceOrientation(t)},!0)}return __extends(i,e),Object.defineProperty(i,"instance",{get:function(){return null==this._instance&&(this._instance=new i),this._instance},enumerable:!0,configurable:!0}),i.addEventListener=function(t,e,r){return i.instance.addEventListener(t,e,r)},i.removeEventListener=function(t,e,r){i.instance.removeEventListener(t,e,r)},i.removeEventListenerAt=function(t){i.instance.removeEventListenerAt(t)},i.prototype.ongamepaddisconnected=function(){this._gp=!1},i.prototype.ongamepadconnected=function(){this._gp=!0},i.prototype.getGamepadButtonState=function(t){return navigator.getGamepads()[0].buttons[t].pressed},i.prototype.getGamepadStick1=function(){return new t.Vector3D(navigator.getGamepads()[0].axes[0],navigator.getGamepads()[0].axes[1],0)},i.prototype.getGamepadStick2=function(){return new t.Vector3D(navigator.getGamepads()[0].axes[2],navigator.getGamepads()[0].axes[3],0)},i.prototype.canGame=function(){return"getGamepads"in navigator},i.reportOnGamepad=function(){i.instance.canGame()&&i.instance._gp&&(null!=i.instance.onGamepadStick1&&i.instance.onGamepadStick1(i.instance.getGamepadStick1()),null!=i.instance.onGamepadStick2&&i.instance.onGamepadStick2(i.instance.getGamepadStick2()))},i.prototype.printout=function(){var t="";t+="id: "+navigator.getGamepads()[0].id+"<br/>";for(var e=navigator.getGamepads()[0].buttons.length,i=0;e>i;i++)t+="Button "+(i+1)+": ",this.getGamepadButtonState(i)&&(t+=" pressed"),t+="<br/>";var r=this.getGamepadStick1();t+="Stick 1: "+r.x+","+r.y+"<br/>",r=this.getGamepadStick2(),t+="Stick 2: "+r.x+","+r.y+"<br/>"},i.prototype.onPinch=function(e,i,r,a){this._oldPosition1=new t.Point(e,i),this._oldPosition2=new t.Point(r,a)},i.prototype.onSwipe=function(t,e){i.mouseX=t,i.mouseY=e,this._oldPosition1=null,this._oldPosition2=null,this._time=(new Date).getTime()},i.prototype.touchStart=function(e){if(this.deliverMessage()){e.preventDefault();var r=e.targetTouches[0].clientX-i.canvas.x+i.canvas.offsetX,a=e.targetTouches[0].clientY-i.canvas.y+i.canvas.offsetY;if(2==e.targetTouches.length){var n=e.targetTouches[1].clientX-i.canvas.x+i.canvas.offsetX,o=e.targetTouches[1].clientY-i.canvas.y+i.canvas.offsetY;this.onPinch(r,a,n,o)}else 1==e.targetTouches.length&&this.onSwipe(r,a);this._touchEvent3d.targetTouches=e.targetTouches,this._touchEvent3d.target=this,this._isTouchStart||(this._isTouchStart=!0,this._touchEvent3d.eventType=t.TouchEvent3D.TOUCH_START,this.dispatchEvent(this._touchEvent3d))}},i.prototype.touchEnd=function(e){if(e.targetTouches.length>1){var r=e.targetTouches[0].clientX-i.canvas.x+i.canvas.offsetX,a=e.targetTouches[0].clientY-i.canvas.y+i.canvas.offsetY,n=e.targetTouches[1].clientX-i.canvas.x+i.canvas.offsetX,o=e.targetTouches[1].clientY-i.canvas.y+i.canvas.offsetY;this.onPinch(r,a,n,o)}else 1==e.targetTouches.length?this.onSwipe(e.targetTouches[0].clientX-i.canvas.x+i.canvas.offsetX,e.targetTouches[0].clientY-i.canvas.y+i.canvas.offsetY):(this._oldPosition1=null,this._oldPosition2=null,this._time=0);this._isTouchStart=!1,this._touchEvent3d.targetTouches=e.targetTouches,this._touchEvent3d.target=this,this._touchEvent3d.eventType=t.TouchEvent3D.TOUCH_END,this.dispatchEvent(this._touchEvent3d)},i.prototype.touchMove=function(e){if(i.mouseLastX=i.mouseX,i.mouseLastY=i.mouseY,i.mouseX=e.targetTouches[0].clientX-i.canvas.x+i.canvas.offsetX,i.mouseY=e.targetTouches[0].clientY-i.canvas.y+i.canvas.offsetY,i.mouseOffsetX=i.mouseX-i.mouseLastX,i.mouseOffsetY=i.mouseY-i.mouseLastY,e.preventDefault(),e.targetTouches.length>1){var r=new t.Point(i.mouseX,i.mouseY),a=new t.Point(e.targetTouches[1].clientX-i.canvas.x+i.canvas.offsetX,e.targetTouches[1].clientY-i.canvas.y+i.canvas.offsetY);null==this._oldPosition1&&(this._oldPosition1=r),null==this._oldPosition2&&(this._oldPosition2=a),i.wheelDelta=this.isEnlarge(this._oldPosition1,this._oldPosition2,r,a)?120:-120,this._oldPosition1=r,this._oldPosition2=a}this._touchEvent3d.targetTouches=e.targetTouches,this._touchEvent3d.target=this,this._touchEvent3d.eventType=t.TouchEvent3D.TOUCH_MOVE,this.dispatchEvent(this._touchEvent3d)},i.prototype.mouseClick=function(e){this.deliverMessage()&&(this._mouseEvent3d.mouseCode=e.button,this._mouseEvent3d.target=this,this._mouseEvent3d.eventType=t.MouseEvent3D.MOUSE_CLICK,this.dispatchEvent(this._mouseEvent3d))},i.prototype.mouseEnd=function(e){this._mouseEvent3d.mouseCode=e.button,this._mouseEvent3d.target=this,this._mouseStatus[this._mouseEvent3d.mouseCode]=!1,this._mouseEvent3d.eventType=t.MouseEvent3D.MOUSE_UP,this.dispatchEvent(this._mouseEvent3d)},i.prototype.deliverMessage=function(){for(var t=i.canvas.view3Ds,e=0;e<t.length;++e)if(t[e].inView3D(i.mouseX,i.mouseY))return!0;return!1},i.prototype.mouseStart=function(e){this.deliverMessage()&&(this._mouseEvent3d.mouseCode=e.button,this._mouseEvent3d.target=this,this._mouseStatus[this._mouseEvent3d.mouseCode]||(this._mouseStatus[this._mouseEvent3d.mouseCode]=!0,this._mouseEvent3d.eventType=t.MouseEvent3D.MOUSE_DOWN,this.dispatchEvent(this._mouseEvent3d)))},i.prototype.mouseMove=function(e){i.mouseLastX=i.mouseX,i.mouseLastY=i.mouseY,i.mouseX=e.clientX-i.canvas.x+i.canvas.offsetX,i.mouseY=e.clientY-i.canvas.y+i.canvas.offsetY,i.mouseOffsetX=i.mouseX-i.mouseLastX,i.mouseOffsetY=i.mouseY-i.mouseLastY,this._mouseEvent3d.target=this,this._mouseEvent3d.eventType=t.MouseEvent3D.MOUSE_MOVE,this.dispatchEvent(this._mouseEvent3d)},i.prototype.mouseOver=function(){this._mouseEvent3d.target=this,this._mouseEvent3d.eventType=t.MouseEvent3D.MOUSE_OVER,this.dispatchEvent(this._mouseEvent3d)},i.prototype.mouseWheel=function(e){i.wheelDelta=e.wheelDelta,this._mouseEvent3d.target=this,this._mouseEvent3d.eventType=t.MouseEvent3D.MOUSE_WHEEL,this.dispatchEvent(this._mouseEvent3d)},i.prototype.keyDown=function(e){this._keyEvent3d.keyCode=e.keyCode,this._keyEvent3d.target=this,this._keyStatus[e.keyCode]||(this._keyStatus[e.keyCode]=!0,this._keyEvent3d.eventType=t.KeyEvent3D.KEY_CLICK,this.dispatchEvent(this._keyEvent3d),this._keyEvent3d.eventType=t.KeyEvent3D.KEY_DOWN,this.dispatchEvent(this._keyEvent3d))},i.prototype.keyUp=function(e){this._keyEvent3d.keyCode=e.keyCode,this._keyEvent3d.target=this,this._keyStatus[e.keyCode]&&(this._keyEvent3d.eventType=t.KeyEvent3D.KEY_CLICK,this.dispatchEvent(this._keyEvent3d)),this._keyStatus[e.keyCode]=!1,this._keyEvent3d.eventType=t.KeyEvent3D.KEY_UP,this.dispatchEvent(this._keyEvent3d)},i.prototype.onWindowsResize=function(){this._windowsEvent3d.target=this,this._windowsEvent3d.eventType=t.Event3D.RESIZE,this.dispatchEvent(this._windowsEvent3d)},i.prototype.onOrientationChange=function(){this._orientationEvent3d.target=this,this._orientationEvent3d.eventType=t.OrientationEvent3D.ORIENTATION_CHANGE,this.dispatchEvent(this._orientationEvent3d)},i.prototype.onDeviceMotion=function(e){this._orientationEvent3d.target=this,this._orientationEvent3d.eventType=t.OrientationEvent3D.DEVICE_MOTION,this._orientationEvent3d.acceleration=e.acceleration,this._orientationEvent3d.accelerationIncludingGravity=e.accelerationIncludingGravity,this._orientationEvent3d.rotationRate=e.rotationRate,this.dispatchEvent(this._orientationEvent3d)},i.prototype.onDeviceOrientation=function(e){this._orientationEvent3d.target=this,this._orientationEvent3d.eventType=t.OrientationEvent3D.DEVICE_ORIENTATION,this._orientationEvent3d.absolute=e.absolute,this._orientationEvent3d.alpha=e.alpha,this._orientationEvent3d.beta=e.beta,this._orientationEvent3d.gamma=e.gamma,this.dispatchEvent(this._orientationEvent3d)},i.prototype.GetSlideAngle=function(t,e){return 180*Math.atan2(e,t)/Math.PI},i.prototype.GetSlideDirection=function(t,e,i,r){var a=e-r,n=i-t,o=0;if(Math.abs(n)<2&&Math.abs(a)<2)return o;var s=this.GetSlideAngle(n,a);return s>=-45&&45>s?o=4:s>=45&&135>s?o=1:s>=-135&&-45>s?o=2:(s>=135&&180>=s||s>=-180&&-135>s)&&(o=3),o},i.prototype.isEnlarge=function(t,e,i,r){var a=Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)),n=Math.sqrt((i.x-r.x)*(i.x-r.x)+(i.y-r.y)*(i.y-r.y));return n>a?!0:!1},i.mouseX=0,i.mouseY=0,i.wheelDelta=0,i.mouseOffsetX=0,i.mouseOffsetY=0,i.mouseLastX=0,i.mouseLastY=0,i._instance=null,i}(t.EventDispatcher);t.Input=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.orientation=new t.Vector3D,this.screenOrientation=0,this.openDebug=!1,this.offsetRotation=new t.Vector3D,this.fixOritation=new t.Vector3D,this.state=-1,this.degtorad=Math.PI/180,this.q=new t.Quaternion,this.q1=new t.Quaternion,this.outQ=new t.Quaternion,this.fix=new t.Vector3D,this.fixinterpolate=new t.Vector3D,this.fixAxis=new t.Vector3D,this.caheFixAxis=new t.Vector3D,this.steps=1,this.interpolate=!0,this.openDebug&&(this.accDiv=document.createElement("div"),this.accGravityDiv=document.createElement("div"),this.rotationRateDiv=document.createElement("div"),this.orientationRateDiv=document.createElement("div"),this.stateDiv=document.createElement("div"),this.accDiv.style.color="red",this.accGravityDiv.style.color="red",this.rotationRateDiv.style.color="red",this.orientationRateDiv.style.color="red",this.stateDiv.style.color="red",this.stateDiv.style.fontSize="52",document.body.appendChild(this.accDiv),document.body.appendChild(this.accGravityDiv),document.body.appendChild(this.rotationRateDiv),document.body.appendChild(this.orientationRateDiv),document.body.appendChild(this.stateDiv))}return e.prototype.start=function(){var t=this;this.orientationchangeHandler(),window.addEventListener("orientationchange",function(){return t.orientationchangeHandler()}),window.addEventListener("devicemotion",function(e){return t.motionHandler(e)}),window.addEventListener("deviceorientation",function(e){return t.orientationHandler(e)})},e.prototype.stop=function(){var t=this;window.removeEventListener("orientationchange",function(){return t.orientationchangeHandler()}),window.removeEventListener("devicemotion",function(e){return t.motionHandler(e)}),window.removeEventListener("deviceorientation",function(e){return t.orientationHandler(e)})},e.prototype.orientationchangeHandler=function(){void 0!=window.orientation&&(this.screenOrientation=window.orientation)},e.prototype.motionHandler=function(t){this.acc=t.acceleration,this.accGravity=t.accelerationIncludingGravity,this.rotationRate=t.rotationRate},e.prototype.orientationHandler=function(t){this.orientation.x=t.alpha,this.orientation.y=t.beta,this.orientation.z=t.gamma,this.openDebug&&this.debug()},e.prototype.debug=function(){this.accGravityDiv.innerHTML="<br><br> Gravity-x:"+this.orientation.x*t.MathUtil.RADIANS_TO_DEGREES+"<br>Gravity-y:"+this.orientation.y+"<br>Gravity-z:"+this.orientation.z,this.orientationRateDiv.innerHTML="<br> orientation-x:"+this.fixOritation.x+"<br>orientation-y:"+this.fixOritation.y+"<br>orientation-z:"+this.fixOritation.z,this.stateDiv.innerHTML="<br> state: "+this.state},e.prototype.getOrientation=function(){switch(window.screen.msOrientation){case"landscape-primary":return-90;case"landscape-secondary":return 90;case"portrait-secondary":return 180;case"portrait-primary":return 0}return window.orientation||0},e.prototype.getQuaternion=function(e,i,r){var a=i?i*this.degtorad:0,n=r?r*this.degtorad:0,o=e?e*this.degtorad:0;a=Math.floor(100*a)/100,n=Math.floor(100*n)/100;var s=-this.getOrientation()*this.degtorad;this.state=this.getOrientation();var h=Math.cos(a/2),l=Math.cos(n/2),u=Math.cos(o/2),c=Math.sin(a/2),d=Math.sin(n/2),p=Math.sin(o/2);this.q.w=h*l*u-c*d*p,this.q.x=c*l*u-h*d*p,this.q.y=h*d*u+c*l*p,this.q.z=h*l*p+c*d*u;var f=new t.Vector3D(0,0,1),_=new t.Quaternion;return _.fromAxisAngle(f,s),this.q.multiply(this.q,_),f.setTo(-1,0,0),_.fromAxisAngle(f,90*this.degtorad),this.q.multiply(this.q,_),this.q},e.prototype.update=function(t){this.getBaseQuaternion(this.orientation.x,this.orientation.y,this.orientation.z),this.q.toEulerAngles(this.fixOritation),this.interpolate?(this.fixinterpolate.x=this.fixOritation.x-this.fix.x,this.fixinterpolate.y=this.fixOritation.y-this.fix.y,this.fixinterpolate.z=this.fixOritation.z-this.fix.z,this.caheFixAxis.x=this.fixOritation.x/Math.abs(this.fixOritation.x),this.caheFixAxis.y=this.fixOritation.y/Math.abs(this.fixOritation.y),this.caheFixAxis.z=this.fixOritation.z/Math.abs(this.fixOritation.z),this.fixAxis.x==this.caheFixAxis.x&&this.fixAxis.y==this.caheFixAxis.y&&this.fixAxis.z==this.caheFixAxis.z?(this.fix.x+=this.fixinterpolate.x/(this.steps+.01),this.fix.y+=this.fixinterpolate.y/(this.steps+.01),this.fix.z+=this.fixinterpolate.z/(this.steps+.01)):(this.fix.x=this.fixOritation.x,this.fix.y=this.fixOritation.y,this.fix.z=this.fixOritation.z,this.fixAxis.x=this.caheFixAxis.x,this.fixAxis.y=this.caheFixAxis.y,this.fixAxis.z=this.caheFixAxis.z),t.camera3D.rotationX=-this.fix.x,t.camera3D.rotationY=-this.fix.y,t.camera3D.rotationZ=this.fix.z):(t.camera3D.rotationX=-this.fixOritation.x,t.camera3D.rotationY=-this.fixOritation.y,t.camera3D.rotationZ=this.fixOritation.z)},e.prototype.getBaseQuaternion=function(t,e,i){var r=e?e*this.degtorad:0,a=i?i*this.degtorad:0,n=t?t*this.degtorad:0,o=Math.cos(r/2),s=Math.cos(a/2),h=Math.cos(n/2),l=Math.sin(r/2),u=Math.sin(a/2),c=Math.sin(n/2),d=o*s*h-l*u*c,p=l*s*h-o*u*c,f=o*u*h+l*s*c,_=o*s*c+l*u*h;return this.q.w=d,this.q.x=p,this.q.y=f,this.q.z=_,this.q},e}();t.OrientationController=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r){void 0===i&&(i=null),void 0===r&&(r=null),e.call(this),this._event=new t.LoaderEvent3D,this._dataformat=null,this.url="",this.parentUrl="",this.resourceName="",this.data=null,i&&(r&&(this.dataformat=r),this.load(i))}return __extends(i,e),i.prototype.load=function(t){var e=this;if(this.data=null,this.url=t,null==this._dataformat&&(this._dataformat=i.DATAFORMAT_TEXT,this.url.lastIndexOf("."),this.url.lastIndexOf("/"),this.url.length>=4))switch(this.url.substr(this.url.length-4,4).toLowerCase()){case".dds":this._dataformat=i.DATAFORMAT_DDS;break;case".tga":this._dataformat=i.DATAFORMAT_TGA;break;case".bmp":this._dataformat=i.DATAFORMAT_BITMAP;break;case".png":this._dataformat=i.DATAFORMAT_BITMAP;break;case".jpg":this._dataformat=i.DATAFORMAT_BITMAP;break;case".hdr":this._dataformat=i.DATAFORMAT_HDR;break;case"glsl":this._dataformat=i.DATAFORMAT_TEXT;break;case".pvr":this._dataformat=i.DATAFORMAT_PVR;break;case".esm":this._dataformat=i.DATAFORMAT_ESM;break;case".eam":this._dataformat=i.DATAFORMAT_EAM;break;case".eca":this._dataformat=i.DATAFORMAT_ECA;break;case".epa":this._dataformat=i.DATAFORMAT_EPA}return null==this._xhr&&(this._xhr=this.getXHR()),null==this._xhr?void alert("Your browser does not support XMLHTTP."):(this._xhr.readyState>0&&this._xhr.abort(),this._xhr.open("GET",this.url,!0),this._xhr.addEventListener("progress",function(t){return e.onProgress(t)},!1),this._xhr.addEventListener("readystatechange",function(t){return e.onReadyStateChange(t)},!1),this._xhr.addEventListener("error",function(t){return e.onError(t)},!1),this.dataformat==i.DATAFORMAT_BITMAP?this._xhr.responseType="blob":this.dataformat!=i.DATAFORMAT_TEXT&&(this._xhr.responseType="arraybuffer"),void this._xhr.send())},Object.defineProperty(i.prototype,"dataformat",{get:function(){return this._dataformat},set:function(t){this._dataformat=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bytesLoaded",{get:function(){return this._progressEvent?this._progressEvent.loaded:0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bytesTotal",{get:function(){return this._progressEvent?this._progressEvent.total:0},enumerable:!0,configurable:!0}),i.prototype.onReadyStateChange=function(){4==this._xhr.readyState&&(this._xhr.status>=400?console.log(this.url,"load fail"):this.loadComplete())},i.prototype.loadComplete=function(){var e=this;switch(this.dataformat){case i.DATAFORMAT_BINARY:this.data=new t.ByteArray(this._xhr.response);break;case i.DATAFORMAT_SOUND:this.data=this._xhr.responseBody;break;case i.DATAFORMAT_TEXT:this.data=this._xhr.responseText;break;case i.DATAFORMAT_BITMAP:var r=document.createElement("img");return void 0!=window.createObjectURL?r.src=window.createObjectURL(this._xhr.response):void 0!=window.URL?r.src=window.URL.createObjectURL(this._xhr.response):void 0!=window.webkitURL&&(r.src=window.webkitURL.createObjectURL(this._xhr.response)),void(r.onload=function(){return e.onLoad(r)});case i.DATAFORMAT_DDS:this.data=t.DDSParser.parse(this._xhr.response),this.checkTexture(this.data);break;case i.DATAFORMAT_TGA:this.data=t.TGAParser.parse(this._xhr.response),this.checkTexture(this.data);break;case i.DATAFORMAT_HDR:this.data=t.HDRParser.parse(this._xhr.response),this.checkTexture(this.data);break;case i.DATAFORMAT_ESM:this.data=t.ESMParser.parse(this._xhr.response);break;case i.DATAFORMAT_EAM:this.data=t.EAMParser.parse(this._xhr.response);break;case i.DATAFORMAT_ECA:this.data=t.ECAParser.parse(this._xhr.response);break;case i.DATAFORMAT_EPA:this.data=t.EPAParser.parse(this._xhr.response);break;default:this.data=this._xhr.responseText}this.doLoadComplete()},i.prototype.onProgress=function(e){this._event.eventType=t.LoaderEvent3D.LOADER_PROGRESS,this._event.target=this,this._event.loader=this,this._progressEvent=e,this.dispatchEvent(this._event)},i.prototype.onError=function(e){this._event.eventType=t.LoaderEvent3D.LOADER_ERROR,this._event.target=this,this._event.loader=this,this.dispatchEvent(this._event),console.log("load error",e)},i.prototype.getXHR=function(){var t=null;return t=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")},i.prototype.onLoad=function(e){this.data=new t.ImageTexture(e),this.checkTexture(this.data),this.doLoadComplete()},i.prototype.checkTexture=function(e){(0!=(e.width&e.width-1)||0!=(e.height&e.height-1))&&t.Egret3DLog.outError("<"+this.url+"><2N>")},i.prototype.doLoadComplete=function(){this.resourceName=t.StringUtil.getURLName(this.url),this._event.eventType=t.LoaderEvent3D.LOADER_COMPLETE,this._event.target=this,this._event.loader=this,this._event.data=this.data,this.dispatchEvent(this._event)},i.DATAFORMAT_BINARY="binary",i.DATAFORMAT_TEXT="text",i.DATAFORMAT_SOUND="sound",i.DATAFORMAT_BITMAP="bitmap",i.DATAFORMAT_DDS="dds",i.DATAFORMAT_TGA="tga",i.DATAFORMAT_ESM="esm",i.DATAFORMAT_EAM="eam",i.DATAFORMAT_ECA="eca",i.DATAFORMAT_EPA="epa",i.DATAFORMAT_PVR="pvr",i.DATAFORMAT_HDR="hdr",i}(t.EventDispatcher);t.URLLoader=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this._loaderDict={},this._loaderEvent=new t.LoaderEvent3D}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e.prototype.loadAsset=function(e,i,r,a){void 0===a&&(a=null);var n=this._loaderDict[e];return n?n.data?(this._loaderEvent.eventType=t.LoaderEvent3D.LOADER_COMPLETE,this._loaderEvent.loader=n,this._loaderEvent.data=n.data,this._loaderEvent.param=a,i.call(r,this._loaderEvent)):n.addEventListener(t.LoaderEvent3D.LOADER_COMPLETE,i,r,a):(n=new t.URLLoader(e),this._loaderDict[e]=n,n.addEventListener(t.LoaderEvent3D.LOADER_COMPLETE,i,r,a)),this._loaderDict[e]},e.prototype.findAsset=function(t){return this._loaderDict[t]},e}();t.AssetManager=e}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t.RGB_S3TC_DXT1_FORMAT=2001]="RGB_S3TC_DXT1_FORMAT",t[t.RGBA_S3TC_DXT1_FORMAT=2002]="RGBA_S3TC_DXT1_FORMAT",t[t.RGBA_S3TC_DXT3_FORMAT=2003]="RGBA_S3TC_DXT3_FORMAT",t[t.RGBA_S3TC_DXT5_FORMAT=2003]="RGBA_S3TC_DXT5_FORMAT"}(t.DDSFormat||(t.DDSFormat={}));var e=t.DDSFormat,i=function(){function i(){}return i.parse=function(r,a){void 0===a&&(a=!0);var n=31,o=0,s=542327876,h=131072,l=512,u=4,c=i.fourCCToInt32("DXT1"),d=i.fourCCToInt32("DXT3"),p=i.fourCCToInt32("DXT5"),f=1021,o=0,_=1,m=2,g=3,v=4,y=7,x=20,b=21,D=22,T=23,w=24,P=25,S=26,A=28,C=new Int32Array(r,0,n);if(C[o]!==s)return console.error("DDSParser.parse: Invalid magic number in DDS header."),null;if(!(C[x]&u))return console.error("DDSParser.parse: Unsupported format, must contain a FourCC code."),null;var E,M,L,z,F,B=C[b],R=!1,O=1;switch(B){case c:E=8,M=e.RGB_S3TC_DXT1_FORMAT;break;case d:E=16,M=e.RGBA_S3TC_DXT3_FORMAT;break;case p:E=16,M=e.RGBA_S3TC_DXT5_FORMAT;break;default:if(!(32==C[D]&&16711680&C[T]&&65280&C[w]&&255&C[P]&&4278190080&C[S]))return console.error("DDSParser.parse: Unsupported FourCC code ",i.int32ToFourCC(B)),null;R=!0,E=64,M=f}C[m]&h&&a!==!1&&(O=Math.max(1,C[y])),L=C[A]&l?!0:!1,z=C[v],F=C[g];var V=C[_]+4,N=L?6:1,I=new Array,U=!1;M==e.RGB_S3TC_DXT1_FORMAT&&0==t.ContextConfig.ColorFormat_DXT1_RGB?U=!0:M==e.RGBA_S3TC_DXT3_FORMAT&&0==t.ContextConfig.ColorFormat_DXT3_RGBA?U=!0:M==e.RGBA_S3TC_DXT5_FORMAT&&0==t.ContextConfig.ColorFormat_DXT5_RGBA&&(U=!0);var k=new t.Texture;k.width=z,k.height=F;for(var G=0;N>G;G++){for(var j=0;O>j;j++){var X;if(R){X=i.loadARGBMip(r,V,z,F);var H=X.length}else{var H=Math.max(4,z)/4*Math.max(4,F)/4*E;X=new Uint8Array(r,V,H),U&&(X=i.softSolutionDXT(z,F,M,X))}var Y=new t.MipmapData(X,z,F);I.push(Y),V+=H,z=Math.max(.5*z,1),F=Math.max(.5*F,1)}z=z,F=F}return U?(k.internalFormat=t.InternalFormat.PixelArray,k.colorFormat=t.ContextConfig.ColorFormat_RGBA8888):(k.internalFormat=t.InternalFormat.CompressData,c==B?k.colorFormat=t.ContextConfig.ColorFormat_DXT1_RGB:d==B?k.colorFormat=t.ContextConfig.ColorFormat_DXT3_RGBA:p==B&&(k.colorFormat=t.ContextConfig.ColorFormat_DXT5_RGBA)),k.mimapData=I,k},i.loadARGBMip=function(t,e,i,r){for(var a=i*r*4,n=new Uint8Array(t,e,a),o=new Uint8Array(a),s=0,h=0,l=0;r>l;l++)for(var u=0;i>u;u++){var c=n[h];h++;var d=n[h];h++;var p=n[h];h++;var f=n[h];h++,o[s]=p,s++,o[s]=d,s++,o[s]=c,s++,o[s]=f,s++}return o},i.fourCCToInt32=function(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)},i.int32ToFourCC=function(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&65385)},i.softSolutionDXT=function(i,r,a,n){var o,s=new Uint8Array(i*r*4),h=[new t.Color,new t.Color,new t.Color,new t.Color],l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];switch(a){case e.RGB_S3TC_DXT1_FORMAT:case e.RGBA_S3TC_DXT1_FORMAT:o=n.length/8;for(var u=0;o>u;u++){var c=n[8*u+0]|n[8*u+1]<<8,d=n[8*u+2]|n[8*u+3]<<8;h[0].r=c>>11&31,h[0].g=c>>5&63,h[0].b=31&c,h[0].a=255,h[1].r=d>>11&31,h[1].g=d>>5&63,h[1].b=31&d,h[1].a=255,c>d?(h[2].lerp(h[0],h[1],.33),h[3].lerp(h[0],h[1],.66)):h[2].lerp(h[0],h[1],.5);for(var p=0;4>p;p++)l[4*p+0]=3&n[8*u+4+p],l[4*p+1]=n[8*u+4+p]>>2&3,l[4*p+2]=n[8*u+4+p]>>4&3,l[4*p+3]=n[8*u+4+p]>>6&3;for(var f=0;f<h.length;f++)h[f].r=8*h[f].r,h[f].g=4*h[f].g,h[f].b=8*h[f].b;var _=u%(i/4)*4,m=4*Math.floor(u/(i/4));r>m+0&&(i>_+0&&(s[4*(m+0)*i+4*(_+0)+0]=h[l[0]].r,s[4*(m+0)*i+4*(_+0)+1]=h[l[0]].g,s[4*(m+0)*i+4*(_+0)+2]=h[l[0]].b,s[4*(m+0)*i+4*(_+0)+3]=h[l[0]].a),i>_+1&&(s[4*(m+0)*i+4*(_+1)+0]=h[l[1]].r,s[4*(m+0)*i+4*(_+1)+1]=h[l[1]].g,s[4*(m+0)*i+4*(_+1)+2]=h[l[1]].b,s[4*(m+0)*i+4*(_+1)+3]=h[l[1]].a),i>_+2&&(s[4*(m+0)*i+4*(_+2)+0]=h[l[2]].r,s[4*(m+0)*i+4*(_+2)+1]=h[l[2]].g,s[4*(m+0)*i+4*(_+2)+2]=h[l[2]].b,s[4*(m+0)*i+4*(_+2)+3]=h[l[2]].a),i>_+3&&(s[4*(m+0)*i+4*(_+3)+0]=h[l[3]].r,s[4*(m+0)*i+4*(_+3)+1]=h[l[3]].g,s[4*(m+0)*i+4*(_+3)+2]=h[l[3]].b,s[4*(m+0)*i+4*(_+3)+3]=h[l[3]].a)),r>m+1&&(i>_+0&&(s[4*(m+1)*i+4*(_+0)+0]=h[l[4]].r,s[4*(m+1)*i+4*(_+0)+1]=h[l[4]].g,s[4*(m+1)*i+4*(_+0)+2]=h[l[4]].b,s[4*(m+1)*i+4*(_+0)+3]=h[l[4]].a),i>_+1&&(s[4*(m+1)*i+4*(_+1)+0]=h[l[5]].r,s[4*(m+1)*i+4*(_+1)+1]=h[l[5]].g,s[4*(m+1)*i+4*(_+1)+2]=h[l[5]].b,s[4*(m+1)*i+4*(_+1)+3]=h[l[5]].a),i>_+2&&(s[4*(m+1)*i+4*(_+2)+0]=h[l[6]].r,s[4*(m+1)*i+4*(_+2)+1]=h[l[6]].g,s[4*(m+1)*i+4*(_+2)+2]=h[l[6]].b,s[4*(m+1)*i+4*(_+2)+3]=h[l[6]].a),i>_+3&&(s[4*(m+1)*i+4*(_+3)+0]=h[l[7]].r,s[4*(m+1)*i+4*(_+3)+1]=h[l[7]].g,s[4*(m+1)*i+4*(_+3)+2]=h[l[7]].b,s[4*(m+1)*i+4*(_+3)+3]=h[l[7]].a)),r>m+2&&(i>_+0&&(s[4*(m+2)*i+4*(_+0)+0]=h[l[8]].r,s[4*(m+2)*i+4*(_+0)+1]=h[l[8]].g,s[4*(m+2)*i+4*(_+0)+2]=h[l[8]].b,s[4*(m+2)*i+4*(_+0)+3]=h[l[8]].a),i>_+1&&(s[4*(m+2)*i+4*(_+1)+0]=h[l[9]].r,s[4*(m+2)*i+4*(_+1)+1]=h[l[9]].g,s[4*(m+2)*i+4*(_+1)+2]=h[l[9]].b,s[4*(m+2)*i+4*(_+1)+3]=h[l[9]].a),i>_+2&&(s[4*(m+2)*i+4*(_+2)+0]=h[l[10]].r,s[4*(m+2)*i+4*(_+2)+1]=h[l[10]].g,s[4*(m+2)*i+4*(_+2)+2]=h[l[10]].b,s[4*(m+2)*i+4*(_+2)+3]=h[l[10]].a),i>_+3&&(s[4*(m+2)*i+4*(_+3)+0]=h[l[11]].r,s[4*(m+2)*i+4*(_+3)+1]=h[l[11]].g,s[4*(m+2)*i+4*(_+3)+2]=h[l[11]].b,s[4*(m+2)*i+4*(_+3)+3]=h[l[11]].a)),r>m+3&&(i>_+0&&(s[4*(m+3)*i+4*(_+0)+0]=h[l[12]].r,s[4*(m+3)*i+4*(_+0)+1]=h[l[12]].g,s[4*(m+3)*i+4*(_+0)+2]=h[l[12]].b,s[4*(m+3)*i+4*(_+0)+3]=h[l[12]].a),i>_+1&&(s[4*(m+3)*i+4*(_+1)+0]=h[l[13]].r,s[4*(m+3)*i+4*(_+1)+1]=h[l[13]].g,s[4*(m+3)*i+4*(_+1)+2]=h[l[13]].b,s[4*(m+3)*i+4*(_+1)+3]=h[l[13]].a),i>_+2&&(s[4*(m+3)*i+4*(_+2)+0]=h[l[14]].r,s[4*(m+3)*i+4*(_+2)+1]=h[l[14]].g,s[4*(m+3)*i+4*(_+2)+2]=h[l[14]].b,s[4*(m+3)*i+4*(_+2)+3]=h[l[14]].a),i>_+3&&(s[4*(m+3)*i+4*(_+3)+0]=h[l[15]].r,s[4*(m+3)*i+4*(_+3)+1]=h[l[15]].g,s[4*(m+3)*i+4*(_+3)+2]=h[l[15]].b,s[4*(m+3)*i+4*(_+3)+3]=h[l[15]].a))
}break;case e.RGBA_S3TC_DXT3_FORMAT:o=n.length/16;for(var u=0;o>u;u++){var c=n[16*u+8]|n[16*u+9]<<8,d=n[16*u+10]|n[16*u+11]<<8;h[0].r=c>>11&31,h[0].g=c>>5&63,h[0].b=31&c,h[0].a=255,h[1].r=d>>11&31,h[1].g=d>>5&63,h[1].b=31&d,h[1].a=255,c>d?(h[2].lerp(h[0],h[1],.33),h[3].lerp(h[0],h[1],.66)):(h[2].lerp(h[0],h[1],.5),h[3].a=0);for(var p=0;4>p;p++)l[4*p+0]=3&n[16*u+12+p],l[4*p+1]=n[16*u+12+p]>>2&3,l[4*p+2]=n[16*u+12+p]>>4&3,l[4*p+3]=n[16*u+12+p]>>6&3;for(var f=0;f<h.length;f++)h[f].r=8*h[f].r,h[f].g=4*h[f].g,h[f].b=8*h[f].b;var _=u%(i/4)*4,m=4*Math.floor(u/(i/4));r>m+0&&(i>_+0&&(s[4*(m+0)*i+4*(_+0)+0]=h[l[0]].r,s[4*(m+0)*i+4*(_+0)+1]=h[l[0]].g,s[4*(m+0)*i+4*(_+0)+2]=h[l[0]].b,s[4*(m+0)*i+4*(_+0)+3]=17*(15&n[16*u+0])),i>_+1&&(s[4*(m+0)*i+4*(_+1)+0]=h[l[1]].r,s[4*(m+0)*i+4*(_+1)+1]=h[l[1]].g,s[4*(m+0)*i+4*(_+1)+2]=h[l[1]].b,s[4*(m+0)*i+4*(_+1)+3]=17*(n[16*u+0]>>4&15)),i>_+2&&(s[4*(m+0)*i+4*(_+2)+0]=h[l[2]].r,s[4*(m+0)*i+4*(_+2)+1]=h[l[2]].g,s[4*(m+0)*i+4*(_+2)+2]=h[l[2]].b,s[4*(m+0)*i+4*(_+2)+3]=17*(15&n[16*u+1])),i>_+3&&(s[4*(m+0)*i+4*(_+3)+0]=h[l[3]].r,s[4*(m+0)*i+4*(_+3)+1]=h[l[3]].g,s[4*(m+0)*i+4*(_+3)+2]=h[l[3]].b,s[4*(m+0)*i+4*(_+3)+3]=17*(n[16*u+1]>>4&15))),r>m+1&&(i>_+0&&(s[4*(m+1)*i+4*(_+0)+0]=h[l[4]].r,s[4*(m+1)*i+4*(_+0)+1]=h[l[4]].g,s[4*(m+1)*i+4*(_+0)+2]=h[l[4]].b,s[4*(m+1)*i+4*(_+0)+3]=17*(15&n[16*u+2])),i>_+1&&(s[4*(m+1)*i+4*(_+1)+0]=h[l[5]].r,s[4*(m+1)*i+4*(_+1)+1]=h[l[5]].g,s[4*(m+1)*i+4*(_+1)+2]=h[l[5]].b,s[4*(m+1)*i+4*(_+1)+3]=17*(n[16*u+2]>>4&15)),i>_+2&&(s[4*(m+1)*i+4*(_+2)+0]=h[l[6]].r,s[4*(m+1)*i+4*(_+2)+1]=h[l[6]].g,s[4*(m+1)*i+4*(_+2)+2]=h[l[6]].b,s[4*(m+1)*i+4*(_+2)+3]=17*(15&n[16*u+3])),i>_+3&&(s[4*(m+1)*i+4*(_+3)+0]=h[l[7]].r,s[4*(m+1)*i+4*(_+3)+1]=h[l[7]].g,s[4*(m+1)*i+4*(_+3)+2]=h[l[7]].b,s[4*(m+1)*i+4*(_+3)+3]=17*(n[16*u+3]>>4&15))),r>m+2&&(i>_+0&&(s[4*(m+2)*i+4*(_+0)+0]=h[l[8]].r,s[4*(m+2)*i+4*(_+0)+1]=h[l[8]].g,s[4*(m+2)*i+4*(_+0)+2]=h[l[8]].b,s[4*(m+2)*i+4*(_+0)+3]=17*(15&n[16*u+4])),i>_+1&&(s[4*(m+2)*i+4*(_+1)+0]=h[l[9]].r,s[4*(m+2)*i+4*(_+1)+1]=h[l[9]].g,s[4*(m+2)*i+4*(_+1)+2]=h[l[9]].b,s[4*(m+2)*i+4*(_+1)+3]=17*(n[16*u+4]>>4&15)),i>_+2&&(s[4*(m+2)*i+4*(_+2)+0]=h[l[10]].r,s[4*(m+2)*i+4*(_+2)+1]=h[l[10]].g,s[4*(m+2)*i+4*(_+2)+2]=h[l[10]].b,s[4*(m+2)*i+4*(_+2)+3]=17*(15&n[16*u+5])),i>_+3&&(s[4*(m+2)*i+4*(_+3)+0]=h[l[11]].r,s[4*(m+2)*i+4*(_+3)+1]=h[l[11]].g,s[4*(m+2)*i+4*(_+3)+2]=h[l[11]].b,s[4*(m+2)*i+4*(_+3)+3]=17*(n[16*u+5]>>4&15))),r>m+3&&(i>_+0&&(s[4*(m+3)*i+4*(_+0)+0]=h[l[12]].r,s[4*(m+3)*i+4*(_+0)+1]=h[l[12]].g,s[4*(m+3)*i+4*(_+0)+2]=h[l[12]].b,s[4*(m+3)*i+4*(_+0)+3]=17*(15&n[16*u+6])),i>_+1&&(s[4*(m+3)*i+4*(_+1)+0]=h[l[13]].r,s[4*(m+3)*i+4*(_+1)+1]=h[l[13]].g,s[4*(m+3)*i+4*(_+1)+2]=h[l[13]].b,s[4*(m+3)*i+4*(_+1)+3]=17*(n[16*u+6]>>4&15)),i>_+2&&(s[4*(m+3)*i+4*(_+2)+0]=h[l[14]].r,s[4*(m+3)*i+4*(_+2)+1]=h[l[14]].g,s[4*(m+3)*i+4*(_+2)+2]=h[l[14]].b,s[4*(m+3)*i+4*(_+2)+3]=17*(15&n[16*u+7])),i>_+3&&(s[4*(m+3)*i+4*(_+3)+0]=h[l[15]].r,s[4*(m+3)*i+4*(_+3)+1]=h[l[15]].g,s[4*(m+3)*i+4*(_+3)+2]=h[l[15]].b,s[4*(m+3)*i+4*(_+3)+3]=17*(n[16*u+7]>>4&15)))}break;case e.RGBA_S3TC_DXT5_FORMAT:}return s},i}();t.DDSParser=i}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t.RGB_PVRTC_4BPPV1_Format=2100]="RGB_PVRTC_4BPPV1_Format",t[t.RGB_PVRTC_2BPPV1_Format=2101]="RGB_PVRTC_2BPPV1_Format",t[t.RGBA_PVRTC_4BPPV1_Format=2102]="RGBA_PVRTC_4BPPV1_Format",t[t.RGBA_PVRTC_2BPPV1_Format=2103]="RGBA_PVRTC_2BPPV1_Format"}(t.PVRFormat||(t.PVRFormat={}));var e=t.PVRFormat,i=function(){function i(){}return i.parse=function(e){var r,a=13,n=new Uint32Array(e,0,a),o={buffer:e,header:n};if(55727696===n[0])r=i._parseV3(o);else{if(559044176!==n[11])return console.log("PVRParser unknow pvr format. PVRParser::parse"),r;r=i._parseV2(o)}return r.internalFormat=t.InternalFormat.PixelArray,r.colorFormat=t.ContextConfig.ColorFormat_RGBA8888,r.useMipmap=!1,r},i._parseV2=function(t){var r,a,n=t.header,o=n[0],s=n[1],h=n[2],l=n[3],u=n[4],r=(n[5],n[6]),c=(n[7],n[8],n[9],n[10]),d=(n[11],n[12]),p=255,f=24,_=25,m=u&p,g=c>0;if(m===_)a=g?e.RGBA_PVRTC_4BPPV1_Format:e.RGB_PVRTC_4BPPV1_Format,r=4;else{if(m!==f)throw new Error("pvrtc - unknown format "+m);a=g?e.RGBA_PVRTC_2BPPV1_Format:e.RGB_PVRTC_2BPPV1_Format,r=2}return t.dataPtr=o,t.bpp=r,t.format=a,t.width=h,t.height=s,t.numSurfaces=d,t.numMipmaps=l+1,t.isCubemap=6===d,i._extract(t)},i._parseV3=function(t){var r,a,n=t.header,o=n[12],s=n[2],h=n[6],l=n[7],u=(n[9],n[10]),c=n[11];switch(s){case 0:r=2,a=e.RGB_PVRTC_2BPPV1_Format;break;case 1:r=2,a=e.RGBA_PVRTC_2BPPV1_Format;break;case 2:r=4,a=e.RGB_PVRTC_4BPPV1_Format;break;case 3:r=4,a=e.RGBA_PVRTC_4BPPV1_Format;break;default:throw new Error("pvrtc - unsupported PVR format "+s)}return t.dataPtr=52+o,t.bpp=r,t.format=a,t.width=l,t.height=h,t.numSurfaces=u,t.numMipmaps=c,t.isCubemap=6===u,i._extract(t)},i._extract=function(e){var i=new t.Texture;i.width=e.width,i.height=e.height;var r=e.buffer,a=e.dataPtr,n=e.bpp,o=e.numSurfaces,s=0,h=0,l=0,u=0,c=0,d=0;2===n?(l=8,u=4):(l=4,u=4),h=l*u*n/8,i.mimapData=[];for(var p=0;p<e.numMipmaps;){var f=e.width>>p,_=e.height>>p;c=f/l,d=_/u,2>c&&(c=2),2>d&&(d=2),s=c*d*h;for(var m=0;o>m;m++){var g=new Uint8Array(r,a,s),v={data:g,width:f,height:_};i.mimapData[m*e.numMipmaps+p]=v,a+=s}p++}return i},i}();t.PVRParser=i}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.parse=function(e){function i(t){switch(t.image_type){case d:case _:(t.colormap_length>256||24!==t.colormap_size||1!==t.colormap_type)&&console.error("TGAParser.parse.tgaCheckHeader: Invalid type colormap data for indexed type");break;case p:case f:case m:case g:t.colormap_type&&console.error("TGAParser.parse.tgaCheckHeader: Invalid type colormap data for colormap type");break;case c:console.error("TGAParser.parse.tgaCheckHeader: No data");break;default:console.error('TGAParser.parse.tgaCheckHeader: Invalid type " '+t.image_type+'"')}(t.width<=0||t.height<=0)&&console.error("TGAParser.parse.tgaCheckHeader: Invalid image size"),8!==t.pixel_size&&16!==t.pixel_size&&24!==t.pixel_size&&32!==t.pixel_size&&console.error('TGAParser.parse.tgaCheckHeader: Invalid pixel size "'+t.pixel_size+'"')}function r(t,e,i,r,a){var n,o,s,h;if(o=i.pixel_size>>3,s=i.width*i.height*o,e&&(h=a.subarray(r,r+=i.colormap_length*(i.colormap_size>>3))),t){n=new Uint8Array(s);for(var l,u,c,d=0,p=new Uint8Array(o);s>d;)if(l=a[r++],u=(127&l)+1,128&l){for(c=0;o>c;++c)p[c]=a[r++];for(c=0;u>c;++c)n.set(p,d+c*o);d+=o*u}else{for(u*=o,c=0;u>c;++c)n[d+c]=a[r++];d+=u}}else n=a.subarray(r,r+=e?i.width*i.height:s);return{pixel_data:n,palettes:h}}function a(t,e,i,r,a,n,o,s,h){var l,u,c,d=h,p=0,f=S.width;for(c=e;c!==r;c+=i)for(u=a;u!==o;u+=n,p++)l=s[p],t[4*(u+f*c)+3]=255,t[4*(u+f*c)+2]=d[3*l+0],t[4*(u+f*c)+1]=d[3*l+1],t[4*(u+f*c)+0]=d[3*l+2];return t}function n(t,e,i,r,a,n,o,s){var h,l,u,c=0,d=S.width;for(u=e;u!==r;u+=i)for(l=a;l!==o;l+=n,c+=2)h=s[c+0]+(s[c+1]<<8),t[4*(l+d*u)+0]=(31744&h)>>7,t[4*(l+d*u)+1]=(992&h)>>2,t[4*(l+d*u)+2]=(31&h)>>3,t[4*(l+d*u)+3]=32768&h?0:255;return t}function o(t,e,i,r,a,n,o,s){var h,l,u=0,c=S.width;for(l=e;l!==r;l+=i)for(h=a;h!==o;h+=n,u+=3)t[4*(h+c*l)+3]=255,t[4*(h+c*l)+2]=s[u+0],t[4*(h+c*l)+1]=s[u+1],t[4*(h+c*l)+0]=s[u+2];return t}function s(t,e,i,r,a,n,o,s){var h,l,u=0,c=S.width;for(l=e;l!==r;l+=i)for(h=a;h!==o;h+=n,u+=4)t[4*(h+c*l)+2]=s[u+0],t[4*(h+c*l)+1]=s[u+1],t[4*(h+c*l)+0]=s[u+2],t[4*(h+c*l)+3]=s[u+3];return t}function h(t,e,i,r,a,n,o,s){var h,l,u,c=0,d=S.width;for(u=e;u!==r;u+=i)for(l=a;l!==o;l+=n,c++)h=s[c],t[4*(l+d*u)+0]=h,t[4*(l+d*u)+1]=h,t[4*(l+d*u)+2]=h,t[4*(l+d*u)+3]=255;return t}function l(t,e,i,r,a,n,o,s){var h,l,u=0,c=S.width;for(l=e;l!==r;l+=i)for(h=a;h!==o;h+=n,u+=2)t[4*(h+c*l)+0]=s[u+0],t[4*(h+c*l)+1]=s[u+0],t[4*(h+c*l)+2]=s[u+0],t[4*(h+c*l)+3]=s[u+1];return t}function u(t,e,i,r){var u,c,d,p,f,_,m=new Uint8Array(t*e*4);switch((S.flags&v)>>y){default:case D:u=0,d=1,f=t,c=0,p=1,_=e;break;case x:u=0,d=1,f=t,c=e-1,p=-1,_=-1;break;case T:u=t-1,d=-1,f=-1,c=0,p=1,_=e;break;case b:u=t-1,d=-1,f=-1,c=e-1,p=-1,_=-1}if(E)switch(S.pixel_size){case 8:h(m,c,p,_,u,d,f,i);break;case 16:l(m,c,p,_,u,d,f,i);break;default:console.error("TGAParser.parse.getTgaRGBA: not support this format")}else switch(S.pixel_size){case 8:a(m,c,p,_,u,d,f,i,r);break;case 16:n(m,c,p,_,u,d,f,i);break;case 24:o(m,c,p,_,u,d,f,i);break;case 32:s(m,c,p,_,u,d,f,i);break;default:console.error("TGAParser.parse.getTgaRGBA: not support this format")}return m}var c=0,d=1,p=2,f=3,_=9,m=10,g=11,v=48,y=4,x=0,b=1,D=2,T=3;e.byteLength<19&&console.error("TGAParser.parse: Not enough data to contain header.");var w=new Uint8Array(e),P=0,S={id_length:w[P++],colormap_type:w[P++],image_type:w[P++],colormap_index:w[P++]|w[P++]<<8,colormap_length:w[P++]|w[P++]<<8,colormap_size:w[P++],origin:[w[P++]|w[P++]<<8,w[P++]|w[P++]<<8],width:w[P++]|w[P++]<<8,height:w[P++]|w[P++]<<8,pixel_size:w[P++],flags:w[P++]};i(S),S.id_length+P>e.byteLength&&console.error("TGAParser.parse: No data"),P+=S.id_length;var A=!1,C=!1,E=!1;switch(S.image_type){case _:A=!0,C=!0;break;case d:C=!0;break;case m:A=!0;break;case p:break;case g:A=!0,E=!0;break;case f:E=!0}var M=r(A,C,S,P,w),L=u(S.width,S.height,M.pixel_data,M.palettes),z=new t.Texture;return z.width=S.width,z.height=S.height,z.internalFormat=t.InternalFormat.PixelArray,z.colorFormat=t.ContextConfig.ColorFormat_RGBA8888,z.mimapData=[new t.MipmapData(L,S.width,S.height)],z},e}();t.TGAParser=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.ldexp=function(t,e){return e>1023?t*Math.pow(2,1023)*Math.pow(2,e-1023):-1074>e?t*Math.pow(2,-1074)*Math.pow(2,e+1074):t*Math.pow(2,e)},e.readPixelsRawRLE=function(t,e,i,r,a,n){function o(e){var i=0;do e[i++]=t[r];while(++r<_&&i<e.length);return i}function s(e,i,a){var n=0;do e[i+n++]=t[r];while(++r<_&&a>n);return n}function h(t,e,i,r){var a=4*r,n=s(e,i,a);if(a>n)throw new Error("Error reading raw pixels: got "+n+" bytes, expected "+a)}for(var l,u,c,d=new Array(4),p=null,f=new Array(2),_=t.length;n>0;){if(o(d)<d.length)throw new Error("Error reading bytes: expected "+d.length);if(2!=d[0]||2!=d[1]||0!=(128&d[2]))return e[i++]=d[0],e[i++]=d[1],e[i++]=d[2],e[i++]=d[3],void h(t,e,i,a*n-1);if(((255&d[2])<<8|255&d[3])!=a)throw new Error("Wrong scanline width "+((255&d[2])<<8|255&d[3])+", expected "+a);null==p&&(p=new Array(4*a)),l=0;for(var m=0;4>m;m++)for(u=(m+1)*a;u>l;){if(o(f)<f.length)throw new Error("Error reading 2-byte buffer");if((255&f[0])>128){if(c=(255&f[0])-128,0==c||c>u-l)throw new Error("Bad scanline data");for(;c-->0;)p[l++]=f[1]}else{if(c=255&f[0],0==c||c>u-l)throw new Error("Bad scanline data");if(p[l++]=f[1],--c>0){if(s(p,l,c)<c)throw new Error("Error reading non-run data");l+=c}}}for(var m=0;a>m;m++)e[i+0]=p[m],e[i+1]=p[m+a],e[i+2]=p[m+2*a],e[i+3]=p[m+3*a],i+=4;n--}},e.parse=function(i){function r(){var t="";do{var e=i[a];if(e==o){++a;break}t+=String.fromCharCode(e)}while(++a<n);return t}i instanceof ArrayBuffer&&(i=new Uint8Array(i));for(var a=0,n=i.length,o=10,s=0,h=0,l=1,u=!1,c=0;20>c;c++){var d,p=r();if(d=p.match(e.radiancePattern));else if(d=p.match(e.formatPattern))u=!0;else if(d=p.match(e.exposurePattern))l=Number(d[1]);else if(d=p.match(e.commentPattern));else if(d=p.match(e.widthHeightPattern)){h=Number(d[1]),s=Number(d[2]);break}}if(!u)throw new Error("File is not run length encoded!");var f=new Uint8Array(s*h*4),_=s,m=h;this.readPixelsRawRLE(i,f,0,a,_,m);var g=new t.MipmapData(f,s,h),v=new t.Texture;return v.internalFormat=t.InternalFormat.PixelArray,v.colorFormat=t.ContextConfig.ColorFormat_RGBA8888,v.mimapData=[g],v.useMipmap=!1,v.width=s,v.height=h,v},e.radiancePattern="#\\?RADIANCE",e.commentPattern="#.*",e.gammaPattern="GAMMA=",e.exposurePattern="EXPOSURE=\\s*([0-9]*[.][0-9]*)",e.formatPattern="FORMAT=32-bit_rle_rgbe",e.widthHeightPattern="-Y ([0-9]+) \\+X ([0-9]+)",e}();t.HDRParser=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.parse=function(e){var i=new t.ByteArray(e),r=new t.ByteArray;i.readBytes(r,0,3);var a=i.readUnsignedInt();return t.EAMVersion.versionDictionary[a]?t.EAMVersion.versionDictionary[a](i):(console.log("egret3d engine not found "+a+" version"),null)},e}();t.EAMParser=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.parserVersion_1=function(e){var i=e.readUnsignedByte();if(e.readUnsignedByte(),0>=i)return null;for(var r=new t.SkeletonAnimationClip,a=new Array,n=new Array,o=0;i>o;o++)a.push(e.readUTF()),n.push(e.readUTF());for(var s=(e.readInt(),e.readInt()),h=new t.Quaternion,l=new t.Vector3D,u=new t.Vector3D,o=0;s>o;o++){var c=new t.SkeletonPose;c.frameTime=e.readInt()/60/80*1e3;for(var d=0;i>d;d++){var p=new t.Joint(a[d]);p.parent=n[d],p.parentIndex=c.findJointIndex(p.parent),h.fromEulerAngles(e.readFloat()*t.MathUtil.RADIANS_TO_DEGREES,e.readFloat()*t.MathUtil.RADIANS_TO_DEGREES,e.readFloat()*t.MathUtil.RADIANS_TO_DEGREES),l.x=e.readFloat(),l.y=e.readFloat(),l.z=e.readFloat(),u.x=e.readFloat(),u.y=e.readFloat(),u.z=e.readFloat(),p.buildLocalMatrix(l,h,u),c.joints.push(p)}c.calculateJointWorldMatrix(),r.addSkeletonPose(c)}return r},e.parserVersion_2=function(e){var i=e.readUnsignedByte();if(e.readUnsignedByte(),0>=i)return null;for(var r=new t.SkeletonAnimationClip,a=new Array,n=new Array,o=0;i>o;o++)a.push(e.readUTF()),n.push(e.readUTF());for(var s=(e.readInt(),e.readInt()),h=new t.Quaternion,l=new t.Vector3D,u=new t.Vector3D,o=0;s>o;o++){var c=new t.SkeletonPose;c.frameTime=e.readInt()/60/80*1e3;for(var d=0;i>d;d++){var p=new t.Joint(a[d]);p.parent=n[d],p.parentIndex=c.findJointIndex(p.parent),h.x=e.readFloat(),h.y=e.readFloat(),h.z=e.readFloat(),h.w=e.readFloat(),l.x=e.readFloat(),l.y=e.readFloat(),l.z=e.readFloat(),u.x=e.readFloat(),u.y=e.readFloat(),u.z=e.readFloat(),p.buildLocalMatrix(l,h,u),c.joints.push(p)}c.calculateJointWorldMatrix(),r.addSkeletonPose(c)}return r},e.parserVersion_3=function(){return null},e.versionDictionary={1:function(t){return e.parserVersion_1(t)},2:function(t){return e.parserVersion_2(t)},3:function(t){return e.parserVersion_3(t)}},e}();t.EAMVersion=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.parse=function(e){var i=new t.ByteArray(e),r=new t.ByteArray;i.readBytes(r,0,3);var a=i.readUnsignedInt();return t.ECAVersion.versionDictionary[a]?t.ECAVersion.versionDictionary[a](i):(console.log("egret3d engine not found "+a+" version"),null)},e}();t.ECAParser=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.parserVersion_1=function(e){for(var i=new t.CameraAnimationController,r=e.readUnsignedInt(),a=null,n=new t.Vector3D(1,1,1,1);r--;)a=new t.CameraAnimationFrame,a.time=e.readInt(),a.fov=e.readFloat(),a.rotation=new t.Vector3D(e.readFloat()*t.MathUtil.RADIANS_TO_DEGREES+90,e.readFloat()*t.MathUtil.RADIANS_TO_DEGREES,e.readFloat()*t.MathUtil.RADIANS_TO_DEGREES),a.translation=new t.Vector3D(e.readFloat(),e.readFloat(),e.readFloat()),a.matrix=new t.Matrix4_4,a.matrix.recompose([a.translation,a.rotation,n]),i.cameraAnimationFrames.push(a);return i},e.versionDictionary={1:function(t){return e.parserVersion_1(t)}},e}();t.ECAVersion=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.parse=function(e){var i=new t.ByteArray(e),r=new t.ByteArray;i.readBytes(r,0,3);var a=i.readUnsignedInt();if(!t.ESMVersion.versionDictionary[a])return console.log("egret3d engine not found "+a+" version"),null;var n=new t.GeometryData;t.ESMVersion.versionDictionary[a](i,n);var o,s=0;return n.source_skinData.length>0?(s=t.VertexFormat.VF_POSITION|t.VertexFormat.VF_NORMAL|t.VertexFormat.VF_TANGENT|t.VertexFormat.VF_COLOR|t.VertexFormat.VF_UV0|t.VertexFormat.VF_SKIN,o=t.GeometryData.buildGeomtry(n,s)):(s=t.VertexFormat.VF_POSITION|t.VertexFormat.VF_NORMAL|t.VertexFormat.VF_TANGENT|t.VertexFormat.VF_COLOR|t.VertexFormat.VF_UV0|t.VertexFormat.VF_UV1,o=t.GeometryData.buildGeomtry(n,s)),o},e}();t.ESMParser=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.parserVersion_1=function(e,i){var r=e.readInt();i.matCount=e.readInt();for(var a=0;a<i.matCount;++a)i.material[a]={},i.material[a].matID=e.readInt(),i.material[a].start=e.readInt(),i.material[a].count=e.readInt(),i.material[a].textureDiffuse=e.readUTF(),i.material[a].textureNormal=e.readUTF(),i.material[a].textureSpecular=e.readUTF();if(r&t.VertexFormat.VF_POSITION)for(var n=e.readInt(),a=0;n>a;a++)i.source_vertexData.push(e.readFloat()),i.source_vertexData.push(e.readFloat()),i.source_vertexData.push(e.readFloat());if(r&t.VertexFormat.VF_NORMAL)for(var o=e.readInt(),a=0;o>a;a++)i.source_normalData.push(e.readFloat()),i.source_normalData.push(e.readFloat()),i.source_normalData.push(e.readFloat());if(r&t.VertexFormat.VF_COLOR)for(var s=e.readInt(),a=0;s>a;a++)i.source_vertexColorData.push(e.readFloat()),i.source_vertexColorData.push(e.readFloat()),i.source_vertexColorData.push(e.readFloat()),i.source_vertexColorData.push(e.readFloat());if(r&t.VertexFormat.VF_UV0)for(var h=e.readInt(),a=0;h>a;a++)i.source_uvData.push(e.readFloat()),i.source_uvData.push(e.readFloat());if(r&t.VertexFormat.VF_UV1)for(var h=e.readInt(),a=0;h>a;a++)i.source_uv2Data.push(e.readFloat()),i.source_uv2Data.push(e.readFloat());i.faces=e.readInt();for(var a=0;a<i.faces;a++)i.vertexIndices.push(e.readUnsignedInt()),i.vertexIndices.push(e.readUnsignedInt()),i.vertexIndices.push(e.readUnsignedInt()),r&t.VertexFormat.VF_NORMAL&&(i.normalIndices.push(e.readUnsignedInt()),i.normalIndices.push(e.readUnsignedInt()),i.normalIndices.push(e.readUnsignedInt())),r&t.VertexFormat.VF_COLOR&&(i.colorIndices.push(e.readUnsignedInt()),i.colorIndices.push(e.readUnsignedInt()),i.colorIndices.push(e.readUnsignedInt())),r&t.VertexFormat.VF_UV0&&(i.uvIndices.push(e.readUnsignedInt()),i.uvIndices.push(e.readUnsignedInt()),i.uvIndices.push(e.readUnsignedInt())),r&t.VertexFormat.VF_UV1&&(i.uv2Indices.push(e.readUnsignedInt()),i.uv2Indices.push(e.readUnsignedInt()),i.uv2Indices.push(e.readUnsignedInt()));var l=e.readUnsignedByte();l>0&&(i.skeleton=new t.Skeleton);for(var u=(new t.Quaternion,new t.Vector3D),c=new t.Vector3D,d=new t.Vector3D,a=0;l>a;++a){var p=new t.Joint(null);e.readInt(),p.parentIndex=e.readInt(),p.name=e.readUTF(),u.x=e.readFloat()*t.MathUtil.RADIANS_TO_DEGREES,u.y=e.readFloat()*t.MathUtil.RADIANS_TO_DEGREES,u.z=e.readFloat()*t.MathUtil.RADIANS_TO_DEGREES,c.x=e.readFloat(),c.y=e.readFloat(),c.z=e.readFloat(),d.x=e.readFloat(),d.y=e.readFloat(),d.z=e.readFloat(),p.buildInverseMatrix(c,u,d),i.skeleton.joints.push(p)}for(var f=e.readInt(),a=0;f>a;a++){for(var _=e.readUnsignedByte(),m=0;_>m;m++)i.source_skinData.push(e.readUnsignedByte()),i.source_skinData.push(e.readFloat());for(var m=_;4>m;m++)i.source_skinData.push(0),i.source_skinData.push(0)}},e.parserVersion_2=function(e,i){var r=e.readInt();i.matCount=e.readInt();for(var a=0;a<i.matCount;++a)i.material[a]={},i.material[a].matID=e.readInt(),i.material[a].start=e.readInt(),i.material[a].count=e.readInt(),i.material[a].textureDiffuse=e.readUTF(),i.material[a].textureNormal=e.readUTF(),i.material[a].textureSpecular=e.readUTF();if(r&t.VertexFormat.VF_POSITION)for(var n=e.readInt(),a=0;n>a;a++)i.source_vertexData.push(e.readFloat()),i.source_vertexData.push(e.readFloat()),i.source_vertexData.push(e.readFloat());if(r&t.VertexFormat.VF_NORMAL)for(var o=e.readInt(),a=0;o>a;a++)i.source_normalData.push(e.readFloat()),i.source_normalData.push(e.readFloat()),i.source_normalData.push(e.readFloat());if(r&t.VertexFormat.VF_COLOR)for(var s=e.readInt(),a=0;s>a;a++)i.source_vertexColorData.push(e.readUnsignedByte()/255),i.source_vertexColorData.push(e.readUnsignedByte()/255),i.source_vertexColorData.push(e.readUnsignedByte()/255),i.source_vertexColorData.push(e.readUnsignedByte()/255);if(r&t.VertexFormat.VF_UV0)for(var h=e.readInt(),a=0;h>a;a++)i.source_uvData.push(e.readFloat()),i.source_uvData.push(e.readFloat());if(r&t.VertexFormat.VF_UV1)for(var h=e.readInt(),a=0;h>a;a++)i.source_uv2Data.push(e.readFloat()),i.source_uv2Data.push(e.readFloat());i.faces=e.readInt();for(var a=0;a<i.faces;a++)i.vertexIndices.push(e.readUnsignedShort()),i.vertexIndices.push(e.readUnsignedShort()),i.vertexIndices.push(e.readUnsignedShort()),r&t.VertexFormat.VF_NORMAL&&(i.normalIndices.push(e.readUnsignedShort()),i.normalIndices.push(e.readUnsignedShort()),i.normalIndices.push(e.readUnsignedShort())),r&t.VertexFormat.VF_COLOR&&(i.colorIndices.push(e.readUnsignedShort()),i.colorIndices.push(e.readUnsignedShort()),i.colorIndices.push(e.readUnsignedShort())),r&t.VertexFormat.VF_UV0&&(i.uvIndices.push(e.readUnsignedShort()),i.uvIndices.push(e.readUnsignedShort()),i.uvIndices.push(e.readUnsignedShort())),r&t.VertexFormat.VF_UV1&&(i.uv2Indices.push(e.readUnsignedShort()),i.uv2Indices.push(e.readUnsignedShort()),i.uv2Indices.push(e.readUnsignedShort()));var l=e.readUnsignedByte();l>0&&(i.skeleton=new t.Skeleton);for(var u=(new t.Quaternion,new t.Vector3D),c=new t.Vector3D,d=new t.Vector3D,a=0;l>a;++a){var p=new t.Joint(null);e.readInt(),p.parentIndex=e.readInt(),p.name=e.readUTF(),u.x=e.readFloat()*t.MathUtil.RADIANS_TO_DEGREES,u.y=e.readFloat()*t.MathUtil.RADIANS_TO_DEGREES,u.z=e.readFloat()*t.MathUtil.RADIANS_TO_DEGREES,c.x=e.readFloat(),c.y=e.readFloat(),c.z=e.readFloat(),d.x=e.readFloat(),d.y=e.readFloat(),d.z=e.readFloat(),p.buildInverseMatrix(c,u,d),i.skeleton.joints.push(p)}for(var f=e.readInt(),a=0;f>a;a++){for(var _=e.readUnsignedByte(),m=0;_>m;m++)i.source_skinData.push(e.readUnsignedByte()),i.source_skinData.push(e.readFloat());for(var m=_;4>m;m++)i.source_skinData.push(0),i.source_skinData.push(0)}},e.parserVersion_3=function(e,i){var r=e.readInt();i.matCount=e.readInt();for(var a=0;a<i.matCount;++a)i.material[a]={},i.material[a].matID=e.readInt(),i.material[a].start=e.readInt(),i.material[a].count=e.readInt(),i.material[a].textureDiffuse=e.readUTF(),i.material[a].textureNormal=e.readUTF(),i.material[a].textureSpecular=e.readUTF();if(r&t.VertexFormat.VF_POSITION)for(var n=e.readInt(),a=0;n>a;a++)i.source_vertexData.push(e.readFloat()),i.source_vertexData.push(e.readFloat()),i.source_vertexData.push(e.readFloat());if(r&t.VertexFormat.VF_NORMAL)for(var o=e.readInt(),a=0;o>a;a++)i.source_normalData.push(e.readFloat()),i.source_normalData.push(e.readFloat()),i.source_normalData.push(e.readFloat());if(r&t.VertexFormat.VF_COLOR)for(var s=e.readInt(),a=0;s>a;a++)i.source_vertexColorData.push(e.readUnsignedByte()/255),i.source_vertexColorData.push(e.readUnsignedByte()/255),i.source_vertexColorData.push(e.readUnsignedByte()/255),i.source_vertexColorData.push(e.readUnsignedByte()/255);if(r&t.VertexFormat.VF_UV0)for(var h=e.readInt(),a=0;h>a;a++)i.source_uvData.push(e.readFloat()),i.source_uvData.push(e.readFloat());if(r&t.VertexFormat.VF_UV1)for(var h=e.readInt(),a=0;h>a;a++)i.source_uv2Data.push(e.readFloat()),i.source_uv2Data.push(e.readFloat());i.faces=e.readInt();for(var a=0;a<i.faces;a++)i.vertexIndices.push(e.readUnsignedShort()),i.vertexIndices.push(e.readUnsignedShort()),i.vertexIndices.push(e.readUnsignedShort()),r&t.VertexFormat.VF_NORMAL&&(i.normalIndices.push(e.readUnsignedShort()),i.normalIndices.push(e.readUnsignedShort()),i.normalIndices.push(e.readUnsignedShort())),r&t.VertexFormat.VF_COLOR&&(i.colorIndices.push(e.readUnsignedShort()),i.colorIndices.push(e.readUnsignedShort()),i.colorIndices.push(e.readUnsignedShort())),r&t.VertexFormat.VF_UV0&&(i.uvIndices.push(e.readUnsignedShort()),i.uvIndices.push(e.readUnsignedShort()),i.uvIndices.push(e.readUnsignedShort())),r&t.VertexFormat.VF_UV1&&(i.uv2Indices.push(e.readUnsignedShort()),i.uv2Indices.push(e.readUnsignedShort()),i.uv2Indices.push(e.readUnsignedShort()));var l=e.readUnsignedByte();l>0&&(i.skeleton=new t.Skeleton);for(var u=new t.Quaternion,c=(new t.Vector3D,new t.Vector3D),d=new t.Vector3D,a=0;l>a;++a){var p=new t.Joint(null);e.readInt(),p.parentIndex=e.readInt(),p.name=e.readUTF(),u.x=e.readFloat(),u.y=e.readFloat(),u.z=e.readFloat(),u.w=e.readFloat(),c.x=e.readFloat(),c.y=e.readFloat(),c.z=e.readFloat(),d.x=e.readFloat(),d.y=e.readFloat(),d.z=e.readFloat(),p.buildInverseMatrix(c,u,d),i.skeleton.joints.push(p)}for(var f=e.readInt(),a=0;f>a;a++){for(var _=e.readUnsignedByte(),m=0;_>m;m++)i.source_skinData.push(e.readUnsignedByte()),i.source_skinData.push(e.readFloat());for(var m=_;4>m;m++)i.source_skinData.push(0),i.source_skinData.push(0)}},e.versionDictionary={1:function(t,i){return e.parserVersion_1(t,i)},2:function(t,i){return e.parserVersion_2(t,i)},3:function(t,i){return e.parserVersion_3(t,i)}},e}();t.ESMVersion=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.parse=function(e){var i=new t.ByteArray(e);if(1701863680!=i.readUnsignedInt())return null;var r=i.readUnsignedInt();return t.EPAVersion.versionDictionary[r]?t.EPAVersion.versionDictionary[r](i):(console.log("egret3d engine not found "+r+" version"),null)},e}();t.EPAParser=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.parserVersion_1=function(e){for(var i=new t.PropertyAnim,r=e.readUnsignedShort(),a=0;r>a;a++){for(var n=e.readUTF(),o=[],s=e.readUnsignedShort(),h=0;s>h;h++){var l=new t.AnimCurve;l.type=e.readUnsignedInt(),l.start.x=e.readFloat(),l.start.y=e.readFloat(),l.end.x=e.readFloat(),l.end.y=e.readFloat(),l.c1.x=e.readFloat(),l.c1.y=e.readFloat(),l.c2.x=e.readFloat(),l.c2.y=e.readFloat(),o.push(l)}i.addAnimCurve(n,o)}return i},e.versionDictionary={1:function(t){return e.parserVersion_1(t)}},e}();t.EPAVersion=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){}return t.parse=function(t){var e=null;if(!window.DOMParser&&window.ActiveXObject)for(var i=["MSXML.2.DOMDocument.6.0","MSXML.2.DOMDocument.3.0","Microsoft.XMLDOM"],r=0;r<i.length;r++)try{e=new ActiveXObject(i[r]),e.async=!1,e.loadXML(t);break}catch(a){}else{if(!(window.DOMParser&&document.implementation&&document.implementation.createDocument))return null;try{var n=new DOMParser;e=n.parseFromString(t,"text/xml")}catch(a){}}return e},t.eachXmlAttr=function(t,e){if(null!=t&&null!=e)for(var i,r=0,a=t.attributes.length;a>r;r++)i=t.attributes[r],e(i.name,i.value)},t}();t.XMLParser=e}(egret3d||(egret3d={}));var egret3d;!function(egret3d){var MapParserUtils=function(){function MapParserUtils(){}return MapParserUtils.parserConfig=function(dataConfig,type){var config=null;switch(type){case"xml":config=egret3d.XMLParser.parse(dataConfig);break;case"json":config=eval("("+dataConfig+")")}return new egret3d.MapConfigParser(config,type)},MapParserUtils.mapParser=function(t,e,i){var r;switch(t){case"xml":r=new egret3d.MapXmlParser(e,i);break;case"json":r=new egret3d.MapJsonParser(e,i)}r&&r.parser()},MapParserUtils.particleParser=function(t,e){var i;switch(t){case"xml":i=(new egret3d.ParticleParser).parseXml(e);break;case"json":i=(new egret3d.ParticleParser).parseJson(e)}return i},MapParserUtils.jsonVersion=function(t,e,i){var r;switch(t){case 1:r=new egret3d.MapJsonParser_1(e,i)}return r},MapParserUtils.xmlVersion=function(t,e,i){var r;switch(t){case 1:r=new egret3d.MapXmlParser_1(e,i)}return r},MapParserUtils.binVersion=function(){return null},MapParserUtils}();egret3d.MapParserUtils=MapParserUtils}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(t,e){this._data=t,this._mapConfigParser=e,this._versionParser=null}return t.prototype.parser=function(){},t.prototype.parseTexture=function(){},t.prototype.parseMethod=function(){return null},t.prototype.parseMat=function(){return null},t.prototype.parseNode=function(){return null},t.prototype.parseEnvironment=function(){},t.prototype.parseHud=function(){return null},t}();t.MapParser=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(t){function e(e,i){t.call(this,e,i)}return __extends(e,t),e}(t.MapParser);t.MapBinParser=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(t,i){e.call(this,t,i),this._mapConfigParser.version=Number(t.version)}return __extends(i,e),i.prototype.parser=function(){if(this._versionParser=t.MapParserUtils.jsonVersion(this._mapConfigParser.version,this._data,this._mapConfigParser),this.parseEnvironment(this._data.env),this._data.skeletonAnimations)for(var e=0;e<this._data.skeletonAnimations.length;e++){var i=this._data.skeletonAnimations[e],r=Number(i.id);i&&(this._mapConfigParser.skeletonAnimationDict[r]=i,this._mapConfigParser.calculateSkeletonAnimationTask(i))}if(this._data.mats)for(var e=0;e<this._data.mats.length;e++){var a=this._versionParser.parseMat(this._data.mats[e]);a&&(this._mapConfigParser.matDict[a.id]=a,this._mapConfigParser.calculateMatTask(a))}if(this._data.nodes)for(var e=0;e<this._data.nodes.length;e++){var n=this._versionParser.parseNode(this._data.nodes[e]);n&&(this._mapConfigParser.nodeList.push(n),this._mapConfigParser.calculateNodeTask(n))}if(this._data.textures)for(var e=0;e<this._data.textures.length;e++)this._versionParser.parseTexture(this._data.textures[e]);if(this._data.huds)for(var e=0;e<this._data.huds.length;e++){var o=this._versionParser.parseHud(this._data.huds[e]);o&&(this._mapConfigParser.hudList.push(o),this._mapConfigParser.calculateHudTask(o))}this._mapConfigParser.processNode()},i}(t.MapParser);t.MapJsonParser=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.apply(this,arguments)}return __extends(i,e),i.prototype.parseMethod=function(e){var i,r=[];for(var a in e){i=new t.MatMethodData,i.type=a;var n=e[a];for(var o in n)if("textures"==o)for(var s in n.textures){var h={};for(var l in n.textures[s])h[l]=n.textures[s][l];i.texturesData.push(h)}else{var u=typeof i[o];i[o]="string"==u?n[o]:"number"==u?Number(n[o]):"boolean"==u?"true"==n[o]?!0:!1:n[o]}r.push(i)}return r},i.prototype.parseMat=function(e){var i=new t.MatSphereData;for(var r in e)switch(r){case"uvRectangle":i.uvRectangle.x=Number(e.uvRectangle.x),i.uvRectangle.y=Number(e.uvRectangle.y),i.uvRectangle.width=Number(e.uvRectangle.width),i.uvRectangle.height=Number(e.uvRectangle.height);break;case"methods":i.methods=this.parseMethod(e.methods);break;case"blendMode":i[r]=t.BlendMode[e[r]];break;case"lightIds":for(var a=e[r].split(","),n=0;n<a.length;++n)i.lightIds.push(Number(a[n]));break;default:var o=typeof i[r];"number"==o?i[r]=Number(e[r]):"boolean"==o?i[r]="true"==e[r]:"string"==o&&(i[r]=e[r])}return i},i.prototype.parseNode=function(e){var i=new t.MapNodeData;for(var r in e)if("pos"==r||"rot"==r||"scale"==r)for(var a in e[r])i[a]=Number(e[r][a]);else if("geometry"==r)for(var n in e[r])i.geometry[n]="type"==n?e[r][n]:Number(e[r][n]);else if("skinClips"==r)for(var o=0;o<e.skinClips.length;++o)i.skinClips.push(e.skinClips[o]);else if("propertyAnims"==r)for(var o=0;o<e.propertyAnims.length;++o)i.propertyAnims.push(e.propertyAnims[o]);else if("mats"==r)i.materialIDs=(e[r]+"").split(",");else if("subs"==r)for(var o=0;o<e.subs.length;++o)i.childs.push(e.subs[o]);else if("boneBind"==r)i.boneBind=e.boneBind;else{var s=typeof i[r];i[r]="number"==s?Number(e[r]):"boolean"==s?"true"==e[r]?!0:!1:e[r]}return i},i.prototype.parseEnvironment=function(e){if(this._mapConfigParser.directLight="open"==e.directLight,this._mapConfigParser.pointLight="open"==e.pointLight,e.lights)for(var i=0;i<e.lights.length;++i){var r=new t.MapLightData,a=e.lights[i];for(var n in a)switch(n){case"id":case"diffuseColor":case"ambientColor":case"intensity":case"halfIntensity":case"falloff":case"radius":r[n]=Number(a[n]);break;case"type":r[n]=a.type;break;case"direction":r.direction.x=Number(a[n].x),r.direction.y=Number(a[n].y),r.direction.z=Number(a[n].z);break;case"position":r.position.x=Number(a[n].x),r.position.y=Number(a[n].y),r.position.z=Number(a[n].z)}this._mapConfigParser.lightDict[r.id]=r}},i.prototype.parseHud=function(e){var i=new t.HUDData;for(var r in e)if("pos"==r||"rot"==r||"size"==r)for(var a in e[r])i[a]=Number(e[r][a]);else i[r]="bothside"==r?"true"==e[r]:e[r];return i},i.prototype.parseTexture=function(t){this._mapConfigParser.textures.push(t),this._mapConfigParser.calculateTextureTask(t)
},i}(t.MapJsonParser);t.MapJsonParser_1=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(t,i){e.call(this,t,i);var r=t.getElementsByTagName("version");this._mapConfigParser.version=Number(r[0].textContent)}return __extends(i,e),i.prototype.parser=function(){this._versionParser=t.MapParserUtils.xmlVersion(this._mapConfigParser.version,this._data,this._mapConfigParser);var e=this._data.getElementsByTagName("mat"),i=this._data.getElementsByTagName("node"),r=this._data.getElementsByTagName("env"),a=(this._data.getElementsByTagName("cameraAnims"),this._data.getElementsByTagName("hud")),n=this._data.getElementsByTagName("texture");this.parseEnvironment(r);for(var o=0;o<e.length;o++){var s=this._versionParser.parseMat(e[o]);s&&(this._mapConfigParser.matDict[s.id]=s,this._mapConfigParser.calculateMatTask(s))}for(var o=0;o<i.length;o++){var h=this._versionParser.parseNode(i[o]);h&&(this._mapConfigParser.nodeList.push(h),this._mapConfigParser.calculateNodeTask(h))}for(var o=0;o<n.length;o++)this.parseTexture(n[o]);for(var o=0;o<a.length;o++){var l=this._versionParser.parseHud(a[o]);l&&(this._mapConfigParser.hudList.push(l),this._mapConfigParser.calculateHudTask(l))}this._mapConfigParser.processNode()},i.prototype.nodeFilter=function(t){return"#text"==t.nodeName||"#comment"==t.nodeName},i}(t.MapParser);t.MapXmlParser=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.apply(this,arguments)}return __extends(i,e),i.prototype.parseTexture=function(t){if(1==t.childNodes.length)return null;var e,i=null,r=0,a=0;for(r=0,a=t.childNodes.length;a>r;r++)if(e=t.childNodes[r],!this.nodeFilter(e)){for(var n={},o=0;o<e.attributes.length;++o)i=e.attributes[o],n[i.name]=i.value;this._mapConfigParser.textures.push(n),this._mapConfigParser.calculateTextureTask(n)}},i.prototype.parseMethod=function(e){if(e.childNodes.length<=1)return null;for(var i,r,a,n=[],o=0,s=null,h=0,o=e.childNodes.length;o>h;h++)if(i=e.childNodes[h],r=i.nodeName,!this.nodeFilter(i)){a=new t.MatMethodData,a.type=r;for(var l=0;l<i.attributes.length;++l){s=i.attributes[l];var u=typeof a[s.name];a[s.name]="string"==u?s.value:"number"==u?Number(s.value):"boolean"==u?"true"==s.value?!0:!1:s.value}for(var l=0;l<i.childNodes.length;++l){var c=i.childNodes[l];if(!this.nodeFilter(c)){for(var d={},p=0;p<c.attributes.length;++p)s=c.attributes[p],d[s.name]=s.value;a.texturesData.push(d)}}n.push(a)}return n},i.prototype.parseMat=function(e){if(0==e.childNodes.length)return null;for(var i=new t.MatSphereData,r=null,a=0;a<e.attributes.length;++a)r=e.attributes[a],i[r.name]=r.value;for(var n,o,s=0,a=0,s=e.childNodes.length;s>a;a++)if(n=e.childNodes[a],o=n.nodeName,!this.nodeFilter(n))if("methods"==o)i.methods=this.parseMethod(n);else if("uvRectangle"==o)for(var h=0;h<n.attributes.length;++h)i.uvRectangle[n.attributes[h].name]=Number(n.attributes[h].value);else if("blendMode"==o)i[n.nodeName]=t.BlendMode[n.textContent];else if("lightIds"==o){if(n.textContent)for(var l=n.textContent.split(","),h=0;h<l.length;++h)i.lightIds.push(Number(l[h]))}else{var u=typeof i[n.nodeName];"string"==u?i[n.nodeName]=n.textContent:"number"==u?i[n.nodeName]=Number(n.textContent):"boolean"==u&&(i[n.nodeName]="true"==n.textContent?!0:!1)}return i},i.prototype.parseNode=function(e){if(1==e.childNodes.length)return null;for(var i=null,r=new t.MapNodeData,a=0;a<e.attributes.length;++a){i=e.attributes[a];var n=typeof r[i.name];r[i.name]="number"==n?Number(i.value):"boolean"==n?"true"==i.value?!0:!1:i.value}var o,s,a=0,h=0;for(a=0,h=e.childNodes.length;h>a;a++)if(o=e.childNodes[a],s=o.nodeName,!this.nodeFilter(o))if("pos"==s)for(var l=0;l<o.attributes.length;++l)i=o.attributes[l],r[i.nodeName]=Number(i.value);else if("rot"==s)for(var l=0;l<o.attributes.length;++l)i=o.attributes[l],r[i.nodeName]=Number(i.value);else if("scale"==s)for(var l=0;l<o.attributes.length;++l)i=o.attributes[l],r[i.nodeName]=Number(i.value);else if("mat"==s)for(var l=0;l<o.attributes.length;++l)i=o.attributes[l],"id"==i.nodeName&&(r.materialIDs=(i.value+"").split(","));else if("skinClip"==s){var u={};r.skinClips.push(u);for(var l=0;l<o.attributes.length;++l)i=o.attributes[l],u[i.nodeName]=i.value}else if("propertyAnim"==s){var c={};r.propertyAnims.push(c);for(var l=0;l<o.attributes.length;++l)i=o.attributes[l],c[i.nodeName]=i.value}else if("geometry"==s){for(var d={},l=0;l<o.attributes.length;++l)i=o.attributes[l],d[i.name]="type"==i.name?i.value:Number(i.value);r.geometry=d}else if("sub"==s){for(var p={},l=0;l<o.attributes.length;++l)i=o.attributes[l],p[i.name]=i.value;r.childs.push(p)}return r},i.prototype.parseEnvironment=function(e){if(!(e.length<=0)){for(var i,r,a,n=null,o=0;o<e[0].attributes.length;++o)n=e[0].attributes[o],this._mapConfigParser[n.name]="open"==n.value;for(var s=0,h=e.length;h>s;s++){i=e[s];for(var l=0;l<i.childNodes.length;++l)if(r=i.childNodes[l],!this.nodeFilter(r))if("light"==r.nodeName){for(var u=new t.MapLightData,o=0;o<r.attributes.length;++o)n=r.attributes[o],u[n.name]="id"==n.name?Number(n.value):n.value;this._mapConfigParser.lightDict[u.id]=u;for(var o=0;o<r.childNodes.length;++o)if(a=r.childNodes[o],!this.nodeFilter(a))if("direction"==a.nodeName)for(var c=0;c<a.attributes.length;++c)n=a.attributes[c],u.direction[n.name]=Number(n.value);else if("position"==a.nodeName)for(var c=0;c<a.attributes.length;++c)n=a.attributes[c],u.position[n.name]=Number(n.value);else"type"==a.nodeName?u.type=t.LightType[a.textContent]:u[a.nodeName]=Number(a.textContent)}else"fog"==r.nodeName}}},i.prototype.parseHud=function(e){if(1==e.childNodes.length)return null;for(var i=null,r=new t.HUDData,a=0;a<e.attributes.length;++a)i=e.attributes[a],r[i.nodeName]="bothside"==i.nodeName?"true"==i.value:i.value;var n,o,a=0,s=0;for(a=0,s=e.childNodes.length;s>a;a++)if(n=e.childNodes[a],o=n.nodeName,!this.nodeFilter(n))for(var h=0;h<n.attributes.length;++h)i=n.attributes[h],r[i.nodeName]="shader"==o?i.value:Number(i.value);return r},i}(t.MapXmlParser);t.MapXmlParser_1=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){void 0===i&&(i=null),e.call(this),this.container=null,this.autoPlayAnimation=!1,this._pathRoot="",this._path="",this._mapParser=null,this._textures={},this._taskCount=0,this._event=new t.LoaderEvent3D,this._type="",this.huds=new Array,this.skinClipDict={},this.taskTotal=0,this.taskCurrent=0,this.lightDict={},this._taskDict={},this.container=new t.Object3D,i&&this.load(i)}return __extends(i,e),Object.defineProperty(i.prototype,"mapParser",{get:function(){return this._mapParser},enumerable:!0,configurable:!0}),i.prototype.findTexture=function(t){return this._textures[t]},i.prototype.load=function(e){var i=e.lastIndexOf("/");i++,this._pathRoot=e.substr(0,i),this._path=e,i=e.lastIndexOf("."),i++,this._type=e.substr(i,e.length-i),this.taskTotal++,this._taskDict[this._path]=1,this.addTask(),t.AssetManager.instance.loadAsset(this._path,this.onConfigLoad,this)},i.prototype.parseConfig=function(e,i){this._mapParser=t.MapParserUtils.parserConfig(e,i);for(var r in this._mapParser.taskDict)this.taskTotal++,this._taskDict[this._pathRoot+r]=1;this.processSkinClip(),this.createLight();for(var a=0;a<this._mapParser.nodeList.length;a++){var n=this._mapParser.nodeList[a];switch(n.object3d.parent||this.container.addChild(n.object3d),("Object3D"==n.type||"Camera3D"==n.type)&&this.doLoadEpa(n),n.type){case"Mesh":if(n.path){var o=this._pathRoot+n.path;this.addTask(),t.AssetManager.instance.loadAsset(o,this.onEsmLoad,this,n)}else n.geometry&&this.processMesh(n,t.GeometryUtil.createGemetryForType(n.geometry.type,n.geometry));break;case"Terrain":if(n.path){var o=this._pathRoot+n.path;this.addTask(),t.AssetManager.instance.loadAsset(o,this.onHeightImg,this,n)}break;case"ParticleEmitter":if(n.path){var o=this._pathRoot+n.path;this.addTask(),t.AssetManager.instance.loadAsset(o,this.onParticleXML,this,n)}}}for(var a=0;a<this._mapParser.textures.length;++a){var s=this._mapParser.textures[a],o=this._pathRoot+s.path;this.addTask(),t.AssetManager.instance.loadAsset(o,this.onTexture,this,s.name)}for(var a=0;a<this._mapParser.hudList.length;++a){var h=this._mapParser.hudList[a],l=new t.HUD;if(l.name=h.name,l.bothside=h.bothside,l.x=h.x,l.y=h.y,l.rotationX=h.rx,l.rotationY=h.ry,l.rotationZ=h.rz,l.width=h.width,l.height=h.height,h.vs&&(l.vsShader=h.vs),h.fs&&(l.fsShader=h.fs),this.huds.push(l),h.hud=l,h.texture){var o=this._pathRoot+h.texture;t.AssetManager.instance.loadAsset(o,this.onHudTexture,this,h)}}},i.prototype.onParticleXML=function(e){var i=e.loader,r=e.param,a=i.ParticleData;a||(a=t.MapParserUtils.particleParser(this._type,i.data),i.ParticleData=a,a.fileUrl=i.url,a.fileName=i.fileName),this.processParticle(a,r),this.processTask(i)},i.prototype.processParticle=function(e,i){if(e.shape.meshFile||e.property.meshFile){if(e.shape.meshFile){var r=this._pathRoot+e.shape.meshFile;this.addTask();var a={};a.particle=e,a.nodeData=i,a.type="shape",t.AssetManager.instance.loadAsset(r,this.onParticleEsmLoad,this,a)}if(e.property.meshFile){var r=this._pathRoot+e.property.meshFile;this.addTask();var a={};a.particle=e,a.nodeData=i,a.type="property",t.AssetManager.instance.loadAsset(r,this.onParticleEsmLoad,this,a)}}else this.processParticleGeometry(e,i);return null},i.prototype.processParticleGeometry=function(e,i){e.materialData=this._mapParser.matDict[i.materialIDs[0]];var r=new t.ParticleEmitter(e,new t.TextureMaterial);this.processObject3d(i,r),r.play(),this.processMat(i)},i.prototype.processObject3d=function(t,e){e.name=t.object3d.name,e.visible=t.object3d.visible,e.position=t.object3d.position,e.orientation=t.object3d.orientation,e.scale=t.object3d.scale,e.tag=t.object3d.tag,t.object3d.swapObject(e),t.object3d=e},i.prototype.onConfigLoad=function(t){var e=t.loader;this.parseConfig(e.data,this._type),this.processTask(e)},i.prototype.onHeightImg=function(e){var i=e.loader,r=e.param,a=r.geometry,n=new t.ElevationGeometry(i.data,a.width,a.height,a.depth,a.segmentsW,a.segmentsH),o=new t.Mesh(n,new t.TextureMaterial(i.data));this.processHeightMesh(r,o),this.doLoadEpa(r),this.processTask(i)},i.prototype.onTexture=function(t){var e=t.loader,i=t.param;this._textures[i]=e.data,this.processTask(e)},i.prototype.onHudTexture=function(t){var e=t.loader,i=t.param;i.hud.diffuseTexture=e.data,this.processTask(e)},i.prototype.onMaterialTexture=function(t){var e=t.loader,i=t.param,r=null,a=null,n=i.mapNodeData;r=n.object3d,a=r.getMaterial(i.matID),a[i.type]=e.data,this.processTask(e)},i.prototype.onMethodTexture=function(t){var e=t.loader,i=t.param;i.method[i.textureName]=e.data,this.processTask(e)},i.prototype.doLoadEpa=function(e){if(e.propertyAnims)for(var i=0;i<e.propertyAnims.length;++i){var r=e.propertyAnims[i],a=this._pathRoot+r.path;this.addTask(),t.AssetManager.instance.loadAsset(a,this.onEpaLoad,this,e)}},i.prototype.processEpa=function(t,e){t.object3d.bindAnimation(e),this.autoPlayAnimation&&t.object3d.proAnimation&&t.object3d.proAnimation.play()},i.prototype.processHeightMesh=function(t,e){this.processObject3d(t,e),this.processMat(t)},i.prototype.processMesh=function(e,i){var r=this.skinClipDict[e.skeletonAnimation],a=new t.Mesh(i,new t.TextureMaterial,r);this.processObject3d(e,a),this.processMat(e);for(var n=0;n<e.skinClips.length;n++){var o=e.skinClips[n],s=this._pathRoot+o.path,h={};h.eamData=o,h.mapNodeData=e,this.addTask(),t.AssetManager.instance.loadAsset(s,this.onEamLoad,this,h)}},i.prototype.onEsmLoad=function(t){var e=t.loader,i=t.param;i&&(this.processMesh(i,e.data),this.doLoadEpa(i)),this.processTask(e)},i.prototype.onParticleEsmLoad=function(t){var e=t.loader,i=t.param,r=i.particle,a=i.nodeData;switch(i.type){case"shape":r.shape.geometry=e.data;break;case"property":r.property.geometry=e.data}var n=0,o=0;r.shape.meshFile&&n++,r.property.meshFile&&n++,r.shape.geometry&&o++,r.property.geometry&&o++,o==n&&this.processParticleGeometry(r,a),this.processTask(e)},i.prototype.onEamLoad=function(t){var e=t.loader,i=t.param,r=e.data;r.animationName=i.eamData.name;var a=i.mapNodeData.object3d;a.animation.skeletonAnimationController.addSkeletonAnimationClip(r.clone()),this.autoPlayAnimation&&a.animation.play(r.animationName,1,!1,!1),this.processTask(e)},i.prototype.onSkinClip=function(t){var e=t.loader,i=t.param,r=i.skinClip,a=e.data;a.animationName=i.name,a=a.clone(),r.addSkeletonAnimationClip(a),this.autoPlayAnimation&&r.play(a.animationName,1,!1,!1),this.processTask(e)},i.prototype.onEpaLoad=function(t){var e=t.loader,i=t.param,r=e.data,a=r.clone();this.processEpa(i,a),this.processTask(e)},i.prototype.addTask=function(){this._taskCount++},i.prototype.processTaskCurrent=function(e){this._taskDict[e.url]&&(this.taskCurrent++,delete this._taskDict[e.url]),this._event.eventType=t.LoaderEvent3D.LOADER_PROGRESS,this._event.target=this,this._event.loader=e,this._event.data=e,this.dispatchEvent(this._event)},i.prototype.processTask=function(e){if(this.processTaskCurrent(e),this._taskCount--,this._taskCount<=0){for(var i=[],r=0;r<this._mapParser.nodeList.length;r++){var a=this._mapParser.nodeList[r];if(a.object3d instanceof t.ParticleEmitter)for(var n=a.object3d,o=0;o<a.childs.length;++o){var s=a.childs[o],h=this.container.findObject3D(s.name);i.push(h),h instanceof t.ParticleEmitter&&n.addSubEmitter(Number(t.ParticleDataSubEmitterPhase[s.phase]),h)}if(a.boneBind.skeletonAnimation){var l=Number(a.boneBind.skeletonAnimation),u=this.skinClipDict[l];u.bindToJointPose(a.boneBind.boneName,a.object3d)}}for(var c,r=0;r<i.length;r++)c=i[r],c&&c.parent&&c.parent.removeChild(c);if(this._event.eventType=t.LoaderEvent3D.LOADER_COMPLETE,this._event.target=this,this.view3d)for(var r=0;r<this.huds.length;++r)this.view3d.addHUD(this.huds[r]);this.dispatchEvent(this._event)}},i.prototype.addImaTask=function(e,i,r,a){var n=null,o=this._pathRoot+e,s={};return s.type=i,s.matID=r,s.mapNodeData=a,this.addTask(),t.AssetManager.instance.loadAsset(o,this.onMaterialTexture,this,s),n},i.prototype.addMethodImgTask=function(e,i,r){var a=this._pathRoot+e,n={};n.method=i,n.textureName=r,this.addTask();var o=t.AssetManager.instance.loadAsset(a,this.onMethodTexture,this,n);return o},i.prototype.processMat=function(e){for(var i=e.object3d,r=0;r<e.materialIDs.length;++r){var a=this._mapParser.matDict[e.materialIDs[r]];if(a){var n=i.getMaterial(r);n||(n=new t.TextureMaterial,i.addSubMaterial(r,n));var o=null;""!=a.diffuseTextureName&&(o=this.addImaTask(a.diffuseTextureName,"diffuseTexture",r,e,n)),""!=a.normalTextureName&&(o=this.addImaTask(a.normalTextureName,"normalTexture",r,e,n)),""!=a.specularTextureName&&(o=this.addImaTask(a.specularTextureName,"specularTexture",r,e,n)),""!=a.matcapTextureName&&(o=this.addImaTask(a.matcapTextureName,"matcapTexture",r,e,n)),n.diffuseColor=a.diffuseColor,n.ambientColor=a.ambientColor,n.specularColor=a.specularColor,n.tintColor=a.tintColor,n.alpha=a.alpha,n.specularLevel=a.specularLevel,n.gloss=a.gloss,n.castShadow=a.castShadow,n.acceptShadow=a.acceptShadow,n.repeat=a.repeat,n.bothside=a.bothside,n.drawMode=a.drawMode,n.cullMode=a.cullMode,n.blendMode=a.blendMode,n.cutAlpha=a.cutAlpha,n.uvRectangle.copyFrom(a.uvRectangle);for(var s=new t.LightGroup,h=0;h<a.lightIds.length;++h){var l=this.lightDict[a.lightIds[h]];l&&s.addLight(l)}s.lightNum>0&&(n.lightGroup=s),this.processMethod(n,a)}}},i.prototype.processMethod=function(e,i){for(var r=null,a=null,n=0,o=i.methods;n<o.length;n++){a=o[n];var s=t.CheckerboardTexture.texture;if(a.type==t.MatMethodData.methodType.lightmapMethod){var h=new t.LightmapMethod(a.usePower);e.diffusePass.addMethod(h),h.lightTexture=s;var l=a.texturesData[0];r=this.addMethodImgTask(l.path,h,l.attributeName)}else if(a.type==t.MatMethodData.methodType.uvRollMethod){var u=new t.UVRollMethod;e.diffusePass.addMethod(u),u.speedU=a.uSpeed,u.speedV=a.vSpeed,e.repeat=!0,u.start(!0)}else if(a.type==t.MatMethodData.methodType.mulUvRollMethod){var c=new t.MulUVRollMethod;e.diffusePass.addMethod(c),c.diffuseTexture1=s,c.setSpeedU(0,a.uSpeed),c.setSpeedV(0,a.vSpeed);var l=a.texturesData[0];c.setSpeedU(1,l.uSpeed),c.setSpeedV(1,l.vSpeed),r=this.addMethodImgTask(l.path,c,l.attributeName),e.repeat=!0,c.start(!0)}else if(a.type==t.MatMethodData.methodType.alphaMaskMethod){var d=new t.AlphaMaskMethod;e.diffusePass.addMethod(d),d.maskTexture=s;var l=a.texturesData[0];r=this.addMethodImgTask(l.path,d,l.attributeName)}else if(a.type==t.MatMethodData.methodType.streamerMethod){var p=new t.StreamerMethod;e.diffusePass.addMethod(p),p.steamerTexture=s;var l=a.texturesData[0];r=this.addMethodImgTask(l.path,p,l.attributeName),p.speedU=a.uSpeed,p.speedV=a.vSpeed,p.start(!0)}else if(a.type==t.MatMethodData.methodType.terrainARGBMethod){var f=new t.TerrainARGBMethod(s,s,s,s,s);e.diffusePass.addMethod(f);for(var l=null,_=0;_<a.texturesData.length;++_)l=a.texturesData[_],r=this.addMethodImgTask(l.path,f,l.attributeName),0!=_&&f.setUVTitling(_-1,Number(l.uvTitlingX),Number(l.uvTitlingY))}else if(a.type==t.MatMethodData.methodType.waterWaveMethod){var m=new t.WaterWaveMethod;e.diffusePass.addMethod(m),a.deepWaterColor&&(m.deepWaterColor=Number(a.deepWaterColor)),a.shallowWaterColor&&(m.shallowWaterColor=Number(a.shallowWaterColor)),e.repeat=!0}else if(a.type==t.MatMethodData.methodType.waterNormalMethod){var g=new t.WaterNormalMethod;e.diffusePass.addMethod(g),g.normalTextureA=s,g.normalTextureB=s,a.uScale&&a.vScale&&g.setUvScale(Number(a.uScale),Number(a.vScale));for(var l=null,_=0;_<a.texturesData.length;++_)l=a.texturesData[_],g.setUvSpeed(_,Number(l.uSpeed),Number(l.vSpeed)),r=this.addMethodImgTask(l.path,g,l.attributeName)}}},i.prototype.processSkinClip=function(){for(var e in this._mapParser.skeletonAnimationDict){var i=this._mapParser.skeletonAnimationDict[e],r=Number(e),a=new t.SkeletonAnimation;this.skinClipDict[r]=a;for(var n=0;n<i.clips.length;++n){var o=i.clips[n],s=this._pathRoot+o.path;o.skinClip=a,this.addTask(),t.AssetManager.instance.loadAsset(s,this.onSkinClip,this,o)}}},i.prototype.createLight=function(){var e=null;for(var i in this._mapParser.lightDict)if(e=this._mapParser.lightDict[i],e.type==t.LightType.directlight&&this._mapParser.directLight){var r=new t.DirectLight(e.direction);r.lightId=e.id,r.diffuse=e.diffuseColor,r.ambient=e.ambientColor,r.halfIntensity=e.halfIntensity,r.intensity=e.intensity,this.lightDict[e.id]=r}else if(e.type==t.LightType.pointlight&&this._mapParser.pointLight){var a=new t.PointLight(0);a.lightId=e.id,a.position=e.position,a.ambient=e.ambientColor,a.diffuse=e.diffuseColor,a.radius=e.radius,a.cutoff=e.falloff,a.intensity=e.intensity,this.lightDict[e.id]=a}},i}(t.EventDispatcher);t.MapLoader=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){this.type="",this.insID=0,this.parent=0,this.name="",this.path="",this.fov=0,this.clipNear=0,this.clipFar=0,this.tagName="",this.materialIDs=[],this.skinClips=[],this.propertyAnims=[],this.billboard=!1,this.visible=!0,this.x=0,this.y=0,this.z=0,this.rx=0,this.ry=0,this.rz=0,this.rw=0,this.sx=1,this.sy=1,this.sz=1,this.skeletonAnimation=0,this.geometry={},this.childs=[],this.boneBind={}}return t}();t.MapNodeData=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e,i){this.version=1,this.nodeList=new Array,this.hudList=new Array,this.matDict={},this.lightDict={},this.skeletonAnimationDict={},this.directLight=!1,this.pointLight=!1,this.textures=[],this.taskDict={},t.MapParserUtils.mapParser(i,e,this)}return e.prototype.calculateSkeletonAnimationTask=function(t){for(var e=0;e<t.clips;++e){var i=t.clips[e];i.path&&(this.taskDict[t.path]=0)}},e.prototype.calculateMatTask=function(t){""!=t.diffuseTextureName&&(this.taskDict[t.diffuseTextureName]=0),""!=t.normalTextureName&&(this.taskDict[t.normalTextureName]=0),""!=t.specularTextureName&&(this.taskDict[t.specularTextureName]=0);for(var e=0;e<t.methods.length;++e)for(var i=t.methods[e],r=0;r<i.texturesData.length;++r){var a=i.texturesData[r];a.path&&(this.taskDict[a.path]=0)}},e.prototype.calculateNodeTask=function(t){t.path&&(this.taskDict[t.path]=0);for(var e=0;e<t.skinClips.length;e++){var i=t.skinClips[e];i.path&&(this.taskDict[i.path]=0)}for(var e=0;e<t.propertyAnims.length;++e){var r=t.propertyAnims[e];r.path&&(this.taskDict[r.path]=0)}},e.prototype.calculateHudTask=function(t){t.texture&&(this.taskDict[t.texture]=0)},e.prototype.calculateTextureTask=function(t){t.path&&(this.taskDict[t.path]=0)},e.prototype.processNode=function(){for(var e=0;e<this.nodeList.length;e++){var i=this.nodeList[e];if("Camera3D"==i.type){var r=new t.Camera3D;r.fieldOfView=i.fov,r.near=i.clipNear,r.far=i.clipFar,i.object3d=r}else i.object3d="Billboard"==i.type?new t.Billboard(new t.TextureMaterial(t.CheckerboardTexture.texture)):("Terrain"==i.type,new t.Object3D);i.object3d.name=i.name,i.object3d.visible=i.visible,i.object3d.position=new t.Vector3D(i.x,i.y,i.z),i.object3d.orientation=new t.Quaternion(i.rx,i.ry,i.rz,i.rw),i.object3d.scale=new t.Vector3D(i.sx,i.sy,i.sz),""!=i.tagName&&(i.object3d.tag.name=i.tagName)}for(var e=0;e<this.nodeList.length;e++)for(var a=this.nodeList[e],n=0;n<this.nodeList.length;n++){var o=this.nodeList[n];if(a.parent==o.insID){o.object3d.addChild(a.object3d);break}}},e}();t.MapConfigParser=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){this.type="",this.usePower=!1,this.texturesData=[],this.uSpeed=0,this.vSpeed=0}return t.methodType={lightmapMethod:"lightmapMethod",uvRollMethod:"uvRollMethod",mulUvRollMethod:"mulUvRollMethod",alphaMaskMethod:"alphaMaskMethod",streamerMethod:"streamerMethod",terrainARGBMethod:"terrainARGBMethod",waterWaveMethod:"waterWaveMethod",waterNormalMethod:"waterNormalMethod",particleUVRoll:"particleUVRoll"},t}();t.MatMethodData=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.id=0,this.diffuseTextureName="",this.normalTextureName="",this.specularTextureName="",this.matcapTextureName="",this.diffuseColor=0,this.ambientColor=0,this.specularColor=0,this.tintColor=2155905152,this.alpha=0,this.specularLevel=0,this.gloss=0,this.ambientPower=0,this.diffusePower=0,this.normalPower=0,this.castShadow=!1,this.acceptShadow=!1,this.smooth=!1,this.repeat=!1,this.bothside=!1,this.drawMode=0,this.cullMode=0,this.blendMode=0,this.cutAlpha=.7,this.methods=[],this.lightIds=[],this.uvRectangle=new t.Rectangle(0,0,1,1)}return e}();t.MatSphereData=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.id=0,this.type=0,this.diffuseColor=16777215,this.ambientColor=16777215,this.intensity=1,this.halfIntensity=0,this.direction=new t.Vector3D(-.5,-.6,.2),this.position=new t.Vector3D,this.falloff=0,this.radius=100}return e}();t.MapLightData=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){this.bothside=!1}return t}();t.HUDData=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.apply(this,arguments),this._event=new t.ParserEvent3D}return __extends(i,e),i.prototype.parser=function(e){var i=this,r=new t.ByteArray(e),a=new t.ByteArray;r.readBytes(a,0,3),r.position=0;var n=0;switch(n|=a.readUnsignedByte()<<16,n|=a.readUnsignedByte()<<8,n|=a.readUnsignedByte()){case 4473939:this.datas=t.DDSParser.parse(e),this.dataFormat=".dds",this.doLoadComplete();break;case 2:case 16:this.datas=t.TGAParser.parse(e),this.dataFormat=".tga",this.doLoadComplete();break;case 16767231:var o=new Blob([e]);this.dataFormat=".jpg";var s=document.createElement("img");void 0!=window.createObjectURL?s.src=window.createObjectURL(o):void 0!=window.URL?s.src=window.URL.createObjectURL(o):void 0!=window.webkitURL&&(s.src=window.webkitURL.createObjectURL(o)),s.onload=function(){return i.onLoad(s)};break;case 8998990:var o=new Blob([e]);this.dataFormat=".png";var s=document.createElement("img");void 0!=window.createObjectURL?s.src=window.createObjectURL(o):void 0!=window.URL?s.src=window.URL.createObjectURL(o):void 0!=window.webkitURL&&(s.src=window.webkitURL.createObjectURL(o)),s.onload=function(){return i.onLoad(s)};break;case 6648685:this.dataFormat=".esm",this.datas=t.ESMParser.parse(e),this.doLoadComplete();break;case 6644077:this.dataFormat=".eam",this.datas=t.EAMParser.parse(e),this.doLoadComplete();break;case 6644577:this.dataFormat=".eca",this.datas=t.ECAParser.parse(e),this.doLoadComplete();break;default:return!1}return!0},i.prototype.onLoad=function(e){this.datas=new t.ImageTexture(e),this.doLoadComplete()},i.prototype.doLoadComplete=function(){this._event.eventType=t.ParserEvent3D.PARSER_COMPLETE,this._event.data=this,this._event.parser=this,this.dispatchEvent(this._event)},i}(t.EventDispatcher);t.ParserUtils=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e}(t.Object3D);t.Role=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){void 0===i&&(i=null),e.call(this),this.addEventListener(t.LoaderEvent3D.LOADER_COMPLETE,this.onLoaderComplete,this),i&&this.load(i)}return __extends(i,e),i.prototype.onLoaderComplete=function(){this.role=new t.Role;for(var e in this.skinClipDict){this.role.skeletonAnimation=this.skinClipDict[e];break}for(var i=this.container.childs,r=0;r<i.length;){var a=i[r];this.container.removeChild(a),this.role.addChild(a)}},i}(t.MapLoader);t.RoleLoader=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){this.vsShaderList=[],this.fsShaderList=[]}return t.prototype.upload=function(){},t.prototype.activeState=function(){},t.prototype.dispose=function(){},t}();t.MethodBase=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.vsShaderList[t.ShaderPhaseType.base_vertex]=this.vsShaderList[t.ShaderPhaseType.base_vertex]||[],this.vsShaderList[t.ShaderPhaseType.base_vertex].push("gui_vs"),this.fsShaderList[t.ShaderPhaseType.base_fragment]=this.fsShaderList[t.ShaderPhaseType.base_fragment]||[],this.fsShaderList[t.ShaderPhaseType.base_fragment].push("gui_fs")}return __extends(i,e),i.prototype.setTextures=function(t,e){var i="uiTexture_"+t.toString();this.materialData[i]=e,this.materialData[i].useMipmap=!1},i.prototype.upload=function(){},i.prototype.activeState=function(){},i}(t.MethodBase);t.GUIMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r,a,n,o){e.call(this),this.uvs=new Float32Array(8),this.fsShaderList[t.ShaderPhaseType.diffuse_fragment]=this.fsShaderList[t.ShaderPhaseType.diffuse_fragment]||[],this.fsShaderList[t.ShaderPhaseType.diffuse_fragment].push("terrainRGBA_fragment"),this.controlTex=i,this.splat_0=r,this.splat_1=a,this.splat_2=n,this.splat_3=o,this.uvs[0]=1,this.uvs[1]=1,this.uvs[2]=1,this.uvs[3]=1,this.uvs[4]=1,this.uvs[5]=1,this.uvs[6]=1,this.uvs[7]=1}return __extends(i,e),i.prototype.setUVTitling=function(t,e,i){this.uvs[2*t]=e,this.uvs[2*t+1]=i},Object.defineProperty(i.prototype,"splat_0_Texture",{set:function(t){this.splat_0=t,this.materialData.splat_0Tex=t,this.materialData.textureChange=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"splat_1_Texture",{set:function(t){this.splat_1=t,this.materialData.splat_1Tex=t,this.materialData.textureChange=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"splat_2_Texture",{set:function(t){this.splat_2=t,this.materialData.splat_2Tex=t,this.materialData.textureChange=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"splat_3_Texture",{set:function(t){this.splat_3=t,this.materialData.splat_3Tex=t,this.materialData.textureChange=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"controlTexture",{set:function(t){this.controlTex=t,this.materialData.blendMaskTexture=t,this.materialData.textureChange=!0},enumerable:!0,configurable:!0}),i.prototype.upload=function(t,e,i,r,a){i.uvs=a.getUniformLocation(i.program3D,"uvs")},i.prototype.activeState=function(t,e,i,r,a){a.uniform1fv(i.uvs,this.uvs)},i.prototype.dispose=function(){},i}(t.MethodBase);t.TerrainARGBMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){void 0===i&&(i="expHeightFog_fs"),e.call(this),this.uniform_globalFog=new Float32Array(7),this._fogColor=204,this._globalDensity=1,this._fogStartDistance=1e3,this._fogDistanceScale=.5,this._height=500,this._fogAlpha=1,this.vsShaderList[t.ShaderPhaseType.local_vertex]=this.vsShaderList[t.ShaderPhaseType.local_vertex]||[],this.vsShaderList[t.ShaderPhaseType.local_vertex].push("vertexPos_vs"),"line"==i?this.fsShaderList[t.ShaderPhaseType.lighting_fragment].push("lineFog"):"exp"==i?this.fsShaderList[t.ShaderPhaseType.lighting_fragment].push("expFog_fs"):"expHeightFog_fs"==i&&(this.fsShaderList[t.ShaderPhaseType.lighting_fragment]=this.fsShaderList[t.ShaderPhaseType.lighting_fragment]||[],this.fsShaderList[t.ShaderPhaseType.lighting_fragment].push("expHeightFog_fs")),this.uniform_globalFog[0]=.5,this.uniform_globalFog[1]=.6,this.uniform_globalFog[2]=.7,this.uniform_globalFog[3]=this._globalDensity,this.uniform_globalFog[4]=this._fogStartDistance,this.uniform_globalFog[5]=this._height,this.uniform_globalFog[6]=this._fogAlpha}return __extends(i,e),Object.defineProperty(i.prototype,"fogColor",{get:function(){return this.fogColor},set:function(t){this._fogColor=t,this.uniform_globalFog[0]=(this._fogColor>>16&255)/255,this.uniform_globalFog[1]=(this._fogColor>>8&255)/255,this.uniform_globalFog[2]=(255&this._fogColor)/255},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalDensity",{get:function(){return this._globalDensity},set:function(t){this._globalDensity=t,this.uniform_globalFog[3]=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fogStartDistance",{get:function(){return this._fogStartDistance},set:function(t){this._fogStartDistance=t,this.uniform_globalFog[4]=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fogHeight",{get:function(){return this._height},set:function(t){this._height=t,this.uniform_globalFog[5]=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fogAlpha",{get:function(){return this._height},set:function(t){this._height=t,this.uniform_globalFog[6]=t},enumerable:!0,configurable:!0}),i.prototype.upload=function(t,e,i,r,a){i.uniform_globalFog=a.getUniformLocation(i.program3D,"uniform_globalFog")},i.prototype.activeState=function(t,e,i,r,a){a.uniform1fv(i.uniform_globalFog,this.uniform_globalFog)},i.prototype.dispose=function(){},i}(t.MethodBase);t.FogMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.uniform_globalFog=new Float32Array(7),this._fogColor=204,this._fogStartDistance=1e3,this._fogFarDistance=4e4,this._fogAlpha=.6,this.vsShaderList[t.ShaderPhaseType.local_vertex]=this.vsShaderList[t.ShaderPhaseType.local_vertex]||[],this.vsShaderList[t.ShaderPhaseType.local_vertex].push("vertexPos_vs"),this.fsShaderList[t.ShaderPhaseType.multi_end_fragment]=this.fsShaderList[t.ShaderPhaseType.multi_end_fragment]||[],this.fsShaderList[t.ShaderPhaseType.multi_end_fragment].push("lineFog"),this.uniform_globalFog[0]=.5,this.uniform_globalFog[1]=.6,this.uniform_globalFog[2]=.7,this.uniform_globalFog[3]=1,this.uniform_globalFog[4]=this._fogStartDistance,this.uniform_globalFog[5]=this._fogFarDistance,this.uniform_globalFog[6]=this._fogAlpha}return __extends(i,e),Object.defineProperty(i.prototype,"fogColor",{get:function(){return this.fogColor},set:function(t){this._fogColor=t,this.uniform_globalFog[0]=(this._fogColor>>16&255)/255,this.uniform_globalFog[1]=(this._fogColor>>8&255)/255,this.uniform_globalFog[2]=(255&this._fogColor)/255},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fogStartDistance",{get:function(){return this._fogStartDistance},set:function(t){this._fogStartDistance=t,this.uniform_globalFog[4]=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fogFarDistance",{get:function(){return this._fogFarDistance},set:function(t){this._fogFarDistance=t,this.uniform_globalFog[5]=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fogAlpha",{get:function(){return this._fogAlpha
},set:function(t){this._fogAlpha=t,this.uniform_globalFog[6]=t},enumerable:!0,configurable:!0}),i.prototype.upload=function(t,e,i,r,a){i.uniform_globalFog=a.getUniformLocation(i.program3D,"uniform_globalFog")},i.prototype.activeState=function(t,e,i,r,a){a.uniform1fv(i.uniform_globalFog,this.uniform_globalFog)},i.prototype.dispose=function(){},i}(t.MethodBase);t.LineFogMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this._uvRoll=new Float32Array(2),this._speedU=5e-5,this._speedV=0,this._time=0,this._start=!1,this.fsShaderList[t.ShaderPhaseType.diffuse_fragment]=this.fsShaderList[t.ShaderPhaseType.diffuse_fragment]||[],this.fsShaderList[t.ShaderPhaseType.diffuse_fragment].push("uvRoll_fs")}return __extends(i,e),Object.defineProperty(i.prototype,"speedU",{get:function(){return this._speedU},set:function(t){this._speedU=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"speedV",{get:function(){return this._speedV},set:function(t){this._speedV=t},enumerable:!0,configurable:!0}),i.prototype.start=function(t){void 0===t&&(t=!1),t&&(this._time=0),this._start=!0},i.prototype.stop=function(){this._start=!1},i.prototype.upload=function(t,e,i,r,a){i.uvRoll=a.getUniformLocation(i.program3D,"uvRoll")},i.prototype.activeState=function(t,e,i,r,a){this._start&&(this._time+=e),this._uvRoll[0]=this._time*this._speedU,this._uvRoll[1]=this._time*this._speedV,a.uniform1fv(i.uvRoll,this._uvRoll)},i}(t.MethodBase);t.UVRollMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this._uvRoll=new Float32Array(4),this._uvSpeed=new Float32Array(4),this._time=0,this._start=!1,this.fsShaderList[t.ShaderPhaseType.diffuse_fragment]=this.fsShaderList[t.ShaderPhaseType.diffuse_fragment]||[],this.fsShaderList[t.ShaderPhaseType.diffuse_fragment].push("mulUvRoll_fs"),this._uvSpeed[0]=5e-5,this._uvSpeed[1]=0,this._uvSpeed[2]=5e-5,this._uvSpeed[3]=0}return __extends(i,e),i.prototype.setSpeedU=function(t,e){this._uvSpeed[2*t+0]=e},i.prototype.getSpeedU=function(t){return this._uvSpeed[2*t+0]},i.prototype.setSpeedV=function(t,e){this._uvSpeed[2*t+1]=e},i.prototype.getSpeedV=function(t){return this._uvSpeed[2*t+1]},i.prototype.start=function(t){void 0===t&&(t=!1),t&&(this._time=0),this._start=!0},i.prototype.stop=function(){this._start=!1},Object.defineProperty(i.prototype,"diffuseTexture1",{get:function(){return this._diffuseTexture1},set:function(t){this._diffuseTexture1=t,this.materialData.diffuseTexture1=t,this.materialData.textureChange=!0},enumerable:!0,configurable:!0}),i.prototype.upload=function(t,e,i,r,a){i.mulUvRoll=a.getUniformLocation(i.program3D,"mulUvRoll")},i.prototype.activeState=function(t,e,i,r,a){this._start&&(this._time+=e);for(var n=0;4>n;++n)this._uvRoll[n]=this._time*this._uvSpeed[n];a.uniform1fv(i.mulUvRoll,this._uvRoll)},i}(t.MethodBase);t.MulUVRollMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r,a,n){e.call(this),this._uvSpriteSheet=new Float32Array(4),this._uvRectangle=new t.Rectangle,this._speed=0,this._time=0,this._numTime=.4,this._start=!1,this._frameNum=12,this._row=4,this._column=4,this._currentFrame=0,this.frameList=[],this._change=!0,this.fsShaderList[t.ShaderPhaseType.diffuse_fragment]=this.fsShaderList[t.ShaderPhaseType.diffuse_fragment]||[],this.fsShaderList[t.ShaderPhaseType.diffuse_fragment].push("uvSpriteSheet_fs"),this.frameNum=i,this.row=r,this.column=a,this.numTime=n}return __extends(i,e),i.prototype.caculate=function(){this._change=!1,this._speed=1e3*this._numTime/this._frameNum,this._uvRectangle.x=0,this._uvRectangle.y=0,this._uvRectangle.width=1/this._row,this._uvRectangle.height=1/this._column,this.frameList.length=this._frameNum;for(var e=0,i=0,r=0;r<this._frameNum;r++){e=r%this._row,i=Math.floor(r/this._column);var a=new t.Rectangle;a.x=e*this._uvRectangle.width+this._uvRectangle.x,a.y=i*this._uvRectangle.height+this._uvRectangle.y,a.width=this._uvRectangle.width,a.height=this._uvRectangle.height,this.frameList[r]=a}},Object.defineProperty(i.prototype,"numTime",{get:function(){return this._numTime},set:function(t){this._numTime!=t&&(this._change=!0,this._numTime=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"frameNum",{get:function(){return this._frameNum},set:function(t){this._frameNum!=t&&(this._change=!0,this._frameNum=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"row",{get:function(){return this._row},set:function(t){this._row!=t&&(this._change=!0,this._row=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"column",{get:function(){return this._column},set:function(t){this._column!=t&&(this._change=!0,this._column=t)},enumerable:!0,configurable:!0}),i.prototype.start=function(t){void 0===t&&(t=!1),t&&(this._time=0),this._start=!0},i.prototype.stop=function(){this._start=!1},i.prototype.upload=function(t,e,i,r,a){i.uvSpriteSheet=a.getUniformLocation(i.program3D,"uvSpriteSheet")},i.prototype.activeState=function(t,e,i,r,a){this._change&&this.caculate(),this._start&&(this._time+=e,this._time/this._speed>1&&(this._currentFrame++,this._time=0)),this._currentFrame=this._currentFrame%this._frameNum,this._uvSpriteSheet[0]=this.frameList[this._currentFrame].x,this._uvSpriteSheet[1]=this.frameList[this._currentFrame].y,this._uvSpriteSheet[2]=this.frameList[this._currentFrame].width,this._uvSpriteSheet[3]=this.frameList[this._currentFrame].height,a.uniform1fv(i.uvSpriteSheet,this._uvSpriteSheet)},i}(t.MethodBase);t.UVSpriteSheetMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){void 0===i&&(i=!0),e.call(this),this.vsShaderList[t.ShaderPhaseType.local_vertex]=this.vsShaderList[t.ShaderPhaseType.local_vertex]||[],this.vsShaderList[t.ShaderPhaseType.local_vertex].push("secondaryUV_vs"),i?(this.fsShaderList[t.ShaderPhaseType.shadow_fragment]=this.fsShaderList[t.ShaderPhaseType.shadow_fragment]||[],this.fsShaderList[t.ShaderPhaseType.shadow_fragment].push("lightMapSpecularPower_fs")):(this.fsShaderList[t.ShaderPhaseType.shadow_fragment]=this.fsShaderList[t.ShaderPhaseType.shadow_fragment]||[],this.fsShaderList[t.ShaderPhaseType.shadow_fragment].push("lightMap_fs"))}return __extends(i,e),Object.defineProperty(i.prototype,"lightTexture",{set:function(t){this.texture=t,this.materialData.lightTexture!=this.texture&&(this.materialData.lightTexture=this.texture,this.materialData.lightTexture.useMipmap=!1,this.materialData.textureChange=!0)},enumerable:!0,configurable:!0}),i.prototype.upload=function(){},i.prototype.activeState=function(){},i}(t.MethodBase);t.LightmapMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this._speed=new t.Vector3D,this._time=0,this._windData=new Float32Array(4),this.vsShaderList[t.ShaderPhaseType.local_vertex]=this.vsShaderList[t.ShaderPhaseType.local_vertex]||[],this.vsShaderList[t.ShaderPhaseType.local_vertex].push("detail_Bending_vs")}return __extends(i,e),Object.defineProperty(i.prototype,"windDirAndSpeed",{get:function(){return this._speed},set:function(t){this._speed=t,this._windData[1]=t.x,this._windData[2]=t.y,this._windData[3]=t.z},enumerable:!0,configurable:!0}),i.prototype.upload=function(t,e,i,r,a){i.uniformTime=a.getUniformLocation(i.program3D,"uniformTime")},i.prototype.activeState=function(t,e,i,r,a){this._time+=e,this._windData[0]=this._time,a.uniform1fv(i.uniformTime,this._windData)},i}(t.MethodBase);t.PlantDistortedMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.fsShaderList[t.ShaderPhaseType.shadow_fragment]=this.fsShaderList[t.ShaderPhaseType.shadow_fragment]||[],this.fsShaderList[t.ShaderPhaseType.shadow_fragment].push("alphaMask_fs")}return __extends(i,e),Object.defineProperty(i.prototype,"maskTexture",{set:function(t){this.texture=t,this.materialData.maskTexture=this.texture,this.materialData.textureChange=!0},enumerable:!0,configurable:!0}),i.prototype.upload=function(){},i.prototype.activeState=function(){},i}(t.MethodBase);t.AlphaMaskMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this),this.aoPower=1,this.fsShaderList[t.ShaderPhaseType.shadow_fragment]=this.fsShaderList[t.ShaderPhaseType.shadow_fragment]||[],this.fsShaderList[t.ShaderPhaseType.shadow_fragment].push("AOMap_fs"),this.lightTexture=i}return __extends(i,e),Object.defineProperty(i.prototype,"lightTexture",{set:function(t){this.texture=t,this.materialData.aoTexture=this.texture,this.materialData.textureChange=!0},enumerable:!0,configurable:!0}),i.prototype.upload=function(t,e,i,r,a){i.aoPower=a.getUniformLocation(i.program3D,"aoPower")},i.prototype.activeState=function(t,e,i,r,a){a.uniform1f(i.aoPower,this.aoPower)},i.prototype.dispose=function(){},i}(t.MethodBase);t.AOMapMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.fsShaderList[t.ShaderPhaseType.multi_end_fragment]=this.fsShaderList[t.ShaderPhaseType.multi_end_fragment]||[],this.fsShaderList[t.ShaderPhaseType.multi_end_fragment].push("colorTransform_fs")}return __extends(i,e),Object.defineProperty(i.prototype,"colorTransform",{get:function(){return this.materialData.colorTransform},set:function(t){this.materialData.colorTransform=t},enumerable:!0,configurable:!0}),i.prototype.upload=function(t,e,i,r,a){i.uniform_colorTransformAlpha=a.getUniformLocation(i.program3D,"uniform_colorTransformAlpha"),i.uniform_colorTransformM44=a.getUniformLocation(i.program3D,"uniform_colorTransformM44")},i.prototype.activeState=function(t,e,i,r,a){a.uniform1f(i.uniform_colorTransformAlpha,this.colorTransform.alpha),a.uniformMatrix4fv(i.uniform_colorTransformM44,!1,this.colorTransform.m44.rawData)},i}(t.MethodBase);t.ColorTransformMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this._posStart=new t.Vector3D,this._posEnd=new t.Vector3D,this._color=new t.Color,this._zeroVector=new t.Vector3D,this._helpVector=new t.Vector3D,this._helpMatrix=new t.Matrix4_4,this.fsShaderList[t.ShaderPhaseType.multi_end_fragment]=this.fsShaderList[t.ShaderPhaseType.multi_end_fragment]||[],this.fsShaderList[t.ShaderPhaseType.multi_end_fragment].push("colorGradients_fs"),this.vsShaderList[t.ShaderPhaseType.local_vertex]=this.vsShaderList[t.ShaderPhaseType.local_vertex]||[],this.vsShaderList[t.ShaderPhaseType.local_vertex].push("vertexPos_vs")}return __extends(i,e),i.prototype.setStartData=function(t,e,i){this._color.copyFrom(i),this._posStart.copyFrom(t),this._posEnd.copyFrom(e),this._posStart.w=0,this._posEnd.w=0},i.prototype.upload=function(t,e,i,r,a){i.uniform_colorGradientsSource=a.getUniformLocation(i.program3D,"uniform_colorGradientsSource")},i.prototype.activeState=function(t,e,i,r,a,n,o){this._helpMatrix.identity(),this._helpMatrix.copyFrom(o.viewMatrix),this._helpMatrix.transformVector(this._posStart,this._helpVector),this.materialData.colorGradientsSource[0]=this._helpVector.x,this.materialData.colorGradientsSource[1]=this._helpVector.y,this.materialData.colorGradientsSource[2]=this._helpVector.z,this._helpMatrix.transformVector(this._posEnd,this._helpVector),this.materialData.colorGradientsSource[3]=this._helpVector.x,this.materialData.colorGradientsSource[4]=this._helpVector.y,this.materialData.colorGradientsSource[5]=this._helpVector.z,this.materialData.colorGradientsSource[6]=this._color.r,this.materialData.colorGradientsSource[7]=this._color.g,this.materialData.colorGradientsSource[8]=this._color.b,this.materialData.colorGradientsSource[9]=this._color.a,a.uniform1fv(i.uniform_colorGradientsSource,this.materialData.colorGradientsSource)},i}(t.MethodBase);t.ColorGradientsMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this._uvRoll=new Float32Array(3),this._speedU=1e-4,this._speedV=1e-4,this._intensity=.9,this._time=0,this._start=!1,this.fsShaderList[t.ShaderPhaseType.diffuse_fragment]=this.fsShaderList[t.ShaderPhaseType.diffuse_fragment]||[],this.fsShaderList[t.ShaderPhaseType.diffuse_fragment].push("uvStreamerRoll_fs"),this.start()}return __extends(i,e),Object.defineProperty(i.prototype,"speedU",{get:function(){return this._speedU},set:function(t){this._speedU=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"speedV",{get:function(){return this._speedV},set:function(t){this._speedV=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"steamerTexture",{get:function(){return this._steamerTexture},set:function(t){this._steamerTexture=t,this.materialData.streamerTexture=t,this.materialData.textureChange=!0},enumerable:!0,configurable:!0}),i.prototype.start=function(t){void 0===t&&(t=!1),t&&(this._time=0),this._start=!0},i.prototype.stop=function(){this._start=!1},i.prototype.upload=function(t,e,i,r,a){i.uvRoll=a.getUniformLocation(i.program3D,"uvRoll")},i.prototype.activeState=function(t,e,i,r,a){this._start&&(this._time+=e),this._uvRoll[0]=this._time*this._speedU,this._uvRoll[1]=this._time*this._speedV,this._uvRoll[2]=this._intensity,a.uniform1fv(i.uvRoll,this._uvRoll)},i}(t.MethodBase);t.StreamerMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this),this.materialData=i.materialData,this.vsShaderList[t.ShaderPhaseType.local_vertex]=this.vsShaderList[t.ShaderPhaseType.local_vertex]||[],this.vsShaderList[t.ShaderPhaseType.local_vertex].push("shadowMapping_vs"),this.fsShaderList[t.ShaderPhaseType.shadow_fragment]=this.fsShaderList[t.ShaderPhaseType.shadow_fragment]||[],this.fsShaderList[t.ShaderPhaseType.shadow_fragment].push("shadowMapping_fs")}return __extends(i,e),Object.defineProperty(i.prototype,"shadowMapTexture",{get:function(){return this.materialData.shadowMapTexture},set:function(t){this.materialData.shadowMapTexture!=t&&(this.materialData.shadowMapTexture=t,this.materialData.textureChange=!0)},enumerable:!0,configurable:!0}),i.prototype.upload=function(t,e,i,r,a){i.uniform_ShadowMatrix&&(i.uniform_ShadowMatrix.uniformIndex=a.getUniformLocation(i.program3D,"uniform_ShadowMatrix"))},i.prototype.activeState=function(e,i,r,a,n){var o=t.ShadowCast.instance.shadowCamera;o&&r.uniform_ShadowMatrix&&r.uniform_ShadowMatrix.uniformIndex&&n.uniformMatrix4fv(r.uniform_ShadowMatrix.uniformIndex,!1,o.viewProjectionMatrix.rawData),n.uniform4fv(r.uniform_ShadowColor.uniformIndex,this.materialData.shadowColor)},i}(t.MethodBase);t.ShadowMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.vsShaderList[t.ShaderPhaseType.global_vertex]=this.fsShaderList[t.ShaderPhaseType.global_vertex]||[],this.vsShaderList[t.ShaderPhaseType.global_vertex].push("cube_vertex"),this.fsShaderList[t.ShaderPhaseType.diffuse_fragment]=this.fsShaderList[t.ShaderPhaseType.diffuse_fragment]||[],this.fsShaderList[t.ShaderPhaseType.diffuse_fragment].push("cube_fragment")}return __extends(i,e),i.prototype.upload=function(){},i.prototype.activeState=function(){},i}(t.MethodBase);t.CubeMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.fsShaderList[t.ShaderPhaseType.diffuse_fragment]=this.fsShaderList[t.ShaderPhaseType.diffuse_fragment]||[],this.fsShaderList[t.ShaderPhaseType.diffuse_fragment].push("color_fragment")}return __extends(i,e),i.prototype.upload=function(){},i.prototype.activeState=function(){},i}(t.MethodBase);t.ColorMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this._waveVSData=new Float32Array(12),this._waveFSData=new Float32Array(8),this._time=0,this._start=!1,this._wave_xyz_intensity_0=new t.Vector3D(120,50,70),this._wave_xyz_intensity_1=new t.Vector3D(80,40,80),this._wave_xyz_speed_0=new t.Vector3D(.001,.001,-.001),this._wave_xyz_speed_1=new t.Vector3D(.001,.001,.001),this.vsShaderList[t.ShaderPhaseType.start_vertex]=this.vsShaderList[t.ShaderPhaseType.start_vertex]||[],this.vsShaderList[t.ShaderPhaseType.start_vertex].push("wave_vs"),this.fsShaderList[t.ShaderPhaseType.multi_end_fragment]=this.fsShaderList[t.ShaderPhaseType.multi_end_fragment]||[],this.fsShaderList[t.ShaderPhaseType.multi_end_fragment].push("wave_fs"),this.start(),this._waveVSData[0]=this._wave_xyz_intensity_0.x,this._waveVSData[1]=this._wave_xyz_intensity_0.y,this._waveVSData[2]=this._wave_xyz_intensity_0.z,this._waveVSData[3]=this._wave_xyz_intensity_1.x,this._waveVSData[4]=this._wave_xyz_intensity_1.y,this._waveVSData[5]=this._wave_xyz_intensity_1.z,this._waveVSData[6]=this._wave_xyz_speed_0.x,this._waveVSData[7]=this._wave_xyz_speed_0.y,this._waveVSData[8]=this._wave_xyz_speed_0.z,this._waveVSData[9]=this._wave_xyz_speed_1.x,this._waveVSData[10]=this._wave_xyz_speed_1.y,this._waveVSData[11]=this._wave_xyz_speed_1.z,this._waveFSData[0]=0,this._waveFSData[1]=63/255,this._waveFSData[2]=77/255,this._waveFSData[3]=1,this._waveFSData[4]=71/255,this._waveFSData[5]=118/255,this._waveFSData[6]=138/255,this._waveFSData[7]=1}return __extends(i,e),Object.defineProperty(i.prototype,"deepWaterColor",{get:function(){var t=255*this._waveFSData[0],e=255*this._waveFSData[1],i=255*this._waveFSData[2],r=255*this._waveFSData[3];return r<<24|t<<16|e<<8|i},set:function(t){var e=t>>24&255,i=t>>16&255,r=t>>8&255,a=255&t;this._waveFSData[0]=i/255,this._waveFSData[1]=r/255,this._waveFSData[2]=a/255,this._waveFSData[3]=e/255},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shallowWaterColor",{get:function(){var t=255*this._waveFSData[4],e=255*this._waveFSData[5],i=255*this._waveFSData[6],r=255*this._waveFSData[7];return r<<24|t<<16|e<<8|i},set:function(t){var e=t>>24&255,i=t>>16&255,r=t>>8&255,a=255&t;this._waveFSData[4]=i/255,this._waveFSData[5]=r/255,this._waveFSData[6]=a/255,this._waveFSData[7]=e/255},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"waveTexture",{set:function(t){this._waveTexture=t,t&&this.materialData.waveTexture!=this._waveTexture&&(this.materialData.waveTexture=t,this.materialData.textureChange=!0)},enumerable:!0,configurable:!0}),i.prototype.start=function(t){void 0===t&&(t=!1),t&&(this._time=0),this._start=!0},i.prototype.stop=function(){this._start=!1},i.prototype.upload=function(t,e,i,r,a){i.waveVSData=a.getUniformLocation(i.program3D,"waveVSData"),i.waveFSData=a.getUniformLocation(i.program3D,"waveFSData"),i.time=a.getUniformLocation(i.program3D,"time")},i.prototype.activeState=function(t,e,i,r,a){this._start&&(this._time+=e),a.uniform3fv(i.waveVSData,this._waveVSData),a.uniform4fv(i.waveFSData,this._waveFSData),a.uniform1f(i.time,this._time)},i}(t.MethodBase);t.WaterWaveMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this._uvData=new Float32Array(8),this._time=0,this._start=!1,this._speedU_0=new t.Point(-9e-6,0),this._speedU_1=new t.Point(3e-5,0),this._distion_intensity=new t.Point(.05,.05),this._normal_0_UVScale=4,this._normal_1_UVScale=4,this.fsShaderList[t.ShaderPhaseType.normal_fragment]=this.fsShaderList[t.ShaderPhaseType.normal_fragment]||[],this.fsShaderList[t.ShaderPhaseType.normal_fragment].push("waterNormal_fs"),this.start(),this._uvData[0]=2.5*this._speedU_0.x,this._uvData[1]=2.5*this._speedU_0.y,this._uvData[2]=2.5*this._speedU_1.x,this._uvData[3]=2.5*this._speedU_1.y,this._uvData[4]=this._distion_intensity.x,this._uvData[5]=this._distion_intensity.y,this._uvData[6]=this._normal_0_UVScale,this._uvData[7]=this._normal_1_UVScale}return __extends(i,e),i.prototype.start=function(t){void 0===t&&(t=!1),t&&(this._time=0),this._start=!0},i.prototype.stop=function(){this._start=!1},i.prototype.setUvSpeed=function(t,e,i){switch(t){case 0:this._speedU_0.x=e,this._speedU_0.y=i,this._uvData[0]=2.5*this._speedU_0.x,this._uvData[1]=2.5*this._speedU_0.y;break;case 1:this._speedU_1.x=e,this._speedU_1.y=i,this._uvData[2]=2.5*this._speedU_1.x,this._uvData[3]=2.5*this._speedU_1.y}},i.prototype.setUvScale=function(t,e){this._normal_0_UVScale=t,this._normal_1_UVScale=e,this._uvData[6]=this._normal_0_UVScale,this._uvData[7]=this._normal_1_UVScale},Object.defineProperty(i.prototype,"normalTextureA",{set:function(t){this._normalTexture_0=t,this.materialData.normalTextureA!=this._normalTexture_0&&(this.materialData.normalTextureA=this._normalTexture_0,this.materialData.textureChange=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"normalTextureB",{set:function(t){this._normalTexture_1=t,this.materialData.normalTextureB!=this._normalTexture_1&&(this.materialData.normalTextureB=this._normalTexture_1,this.materialData.textureChange=!0)},enumerable:!0,configurable:!0}),i.prototype.upload=function(t,e,i,r,a){i.waterNormalData=a.getUniformLocation(i.program3D,"waterNormalData"),i.time=a.getUniformLocation(i.program3D,"time")},i.prototype.activeState=function(t,e,i,r,a){this._start&&(this._time+=e),a.uniform2fv(i.waterNormalData,this._uvData),a.uniform1f(i.time,this._time)},i}(t.MethodBase);t.WaterNormalMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.reflectValue=.3,this.fsShaderList[t.ShaderPhaseType.multi_end_fragment]=this.fsShaderList[t.ShaderPhaseType.multi_end_fragment]||[],this.fsShaderList[t.ShaderPhaseType.multi_end_fragment].push("environmentMapping_fragment")}return __extends(i,e),Object.defineProperty(i.prototype,"reflect",{get:function(){return this.reflectValue},set:function(t){this.reflectValue=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"environmentTexture",{set:function(t){this.texture=t,t&&this.materialData.environmentMapTex!=this.texture&&(this.materialData.environmentMapTex=t,this.materialData.textureChange=!0)},enumerable:!0,configurable:!0}),i.prototype.upload=function(t,e,i,r,a){i.reflectValue=a.getUniformLocation(i.program3D,"reflectValue")},i.prototype.activeState=function(t,e,i,r,a){a.uniform1f(i.reflectValue,this.reflectValue)},i}(t.MethodBase);t.EnvironmentMethod=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.sampler2DList=new Array,this.sampler3DList=new Array,this.vertexShader=new t.ShaderBase(t.Shader.vertex),this.fragmentShader=new t.ShaderBase(t.Shader.fragment),this.maxDirectLight=0,this.maxSpotLight=0,this.maxPointLight=0,this.maxBone=0,this.attributeDiry=!0}return e.prototype.dispose=function(){},e}();t.PassUsage=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.apply(this,arguments),this.shaderPhaseTypes={},this.matID=0,this.drawMode=t.DrawMode.TRIANGLES,this.useMipmap=!0,this.normalTexture=t.CheckerboardTexture.texture,this.matcapTexture=t.CheckerboardTexture.texture,this.specularTexture=t.CheckerboardTexture.texture,this.lightTexture=t.CheckerboardTexture.texture,this.maskTexture=t.CheckerboardTexture.texture,this.aoTexture=t.CheckerboardTexture.texture,this.environmentTexture=t.CheckerboardTexture.texture,this.blendMaskTexture=t.CheckerboardTexture.texture,this.splat_0Tex=t.CheckerboardTexture.texture,this.splat_1Tex=t.CheckerboardTexture.texture,this.splat_2Tex=t.CheckerboardTexture.texture,this.splat_3Tex=t.CheckerboardTexture.texture,this.layer=0,this.castShadow=!1,this.acceptShadow=!1,this.shadowColor=new Float32Array([.2,.2,.2,.003]),this.depthTest=!0,this.depthMode=0,this.blendMode=t.BlendMode.NORMAL,this.alphaBlending=!1,this.ambientColor=3355443,this.diffuseColor=16777215,this.specularColor=16777215,this.tintColor=2155905152,this.specularLevel=4,this.gloss=20,this.cutAlpha=0,this.repeat=!1,this.bothside=!1,this.alpha=1,this.albedo=.95,this.specularScale=1,this.normalScale=1,this.uvRectangle=new t.Rectangle(0,0,1,1),this.materialDataNeedChange=!0,this.textureChange=!1,this.textureStateChage=!0,this.cullFrontOrBack=t.ContextConfig.BACK,this.materialSourceData=new Float32Array(20),this.materialSourceData2=new Float32Array(20),this.colorGradientsSource=new Float32Array(10)}return __extends(i,e),i.prototype.clone=function(){var t=new i;t.drawMode=this.drawMode,t.diffuseTexture=this.diffuseTexture,t.shadowMapTexture=this.shadowMapTexture;for(var e=0;4>e;++e)t.shadowColor[e]=this.shadowColor[e];return t.layer=this.layer,t.castShadow=this.castShadow,t.acceptShadow=this.acceptShadow,t.depthTest=this.depthTest,t.blendMode=this.blendMode,t.blend_src=this.blend_src,t.blend_dest=this.blend_dest,t.ambientColor=this.ambientColor,t.diffuseColor=this.diffuseColor,t.specularColor=this.specularColor,t.cutAlpha=this.cutAlpha,t.alpha=this.alpha,t.specularLevel=this.specularLevel,t.gloss=this.gloss,t.albedo=this.albedo,t.specularScale=this.specularScale,t.materialDataNeedChange=this.materialDataNeedChange,t.textureChange=!0,t.cullFrontOrBack=this.cullFrontOrBack,t.colorTransform=this.colorTransform,t},i.prototype.dispose=function(){},i}(Object);t.MaterialData=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e){this._passChange=!0,this._vs_shader_methods={},this._fs_shader_methods={},this.methodList=new Array,this.methodDatas=new Array,this.vsShaderNames=new Array,this.fsShaderNames=new Array,this._helpMatrix=new t.Matrix4_4,this._materialData=e}return e.prototype.addMethod=function(t){var e=this.methodList.indexOf(t);-1==e&&(this.methodList.push(t),t.materialData=this._materialData,this._passChange=!0)},e.prototype.removeMethod=function(t){var e=this.methodList.indexOf(t);-1!=e&&(this.methodList.slice(e),this._passChange=!0)},e.prototype.materialDataChange=function(){this._materialData.materialDataNeedChange=!0},e.prototype.passInvalid=function(){this._passChange=!0},e.prototype.resetTexture=function(){var t;for(var e in this._passUsage.sampler2DList)t=this._passUsage.sampler2DList[e],this._materialData[t.varName]&&(t.texture=this._materialData[t.varName]);var i;for(var e in this._passUsage.sampler3DList)i=this._passUsage.sampler3DList[e],this._materialData[i.varName]&&(i.texture=this._materialData[i.varName]);this._materialData.textureChange=!1},e.prototype.addMethodShaders=function(t,e){for(var i=0;i<e.length;i++)t.addUseShaderName(e[i])},e.prototype.addShaderPhase=function(e,i,r){var a,n,o;for(n in i){a=i[n];for(var s=0;s<a.length;s++){r[n]=r[n]||[],r[n].push(a[s]),o=t.ShaderPhaseType[n];var h=this._materialData.shaderPhaseTypes[e].indexOf(t.ShaderPhaseType[o]);-1!=h&&this._materialData.shaderPhaseTypes[e].splice(h,1)}}},e.prototype.initOthreMethods=function(){for(var t,e,i=0;i<this.methodList.length;i++){var r=this.methodList[i];for(t in r.vsShaderList){e=r.vsShaderList[t];for(var a=0;a<e.length;a++)this._vs_shader_methods[t]=this._vs_shader_methods[t]||[],this._vs_shader_methods[t].push(e[a])}for(t in r.fsShaderList){e=r.fsShaderList[t];for(var a=0;a<e.length;a++)this._fs_shader_methods[t]=this._fs_shader_methods[t]||[],this._fs_shader_methods[t].push(e[a])}}},e.prototype.initUseMethod=function(e){this._passChange=!1,this._passUsage=new t.PassUsage,this._vs_shader_methods={},this._fs_shader_methods={},e&&(e.skeletonAnimationController?(this._passUsage.maxBone=2*e.skeletonAnimationController.jointNum,this._vs_shader_methods[t.ShaderPhaseType.start_vertex]=[],this._vs_shader_methods[t.ShaderPhaseType.start_vertex].push("skeleton_vs")):e.particleAnimationController&&(this._vs_shader_methods[t.ShaderPhaseType.start_vertex]=[],this._vs_shader_methods[t.ShaderPhaseType.start_vertex].push("particle_vs"),this.addShaderPhase(this._passID,e.particleAnimationController.particleAnimationState.vertex_shaders,this._vs_shader_methods),this.addShaderPhase(this._passID,e.particleAnimationController.particleAnimationState.fragment_shaders,this._fs_shader_methods))),this._materialData.acceptShadow&&(this._vs_shader_methods[t.ShaderPhaseType.global_vertex]=this._vs_shader_methods[t.ShaderPhaseType.global_vertex]||[],this._fs_shader_methods[t.ShaderPhaseType.shadow_fragment]=this._fs_shader_methods[t.ShaderPhaseType.shadow_fragment]||[]),-1!=this._materialData.shaderPhaseTypes[t.PassType.diffusePass].indexOf(t.ShaderPhaseType.diffuse_fragment)&&(this._fs_shader_methods[t.ShaderPhaseType.diffuse_fragment]=[],this._fs_shader_methods[t.ShaderPhaseType.diffuse_fragment].push("diffuse_fragment")),-1!=this._materialData.shaderPhaseTypes[t.PassType.diffusePass].indexOf(t.ShaderPhaseType.normal_fragment)&&(this._fs_shader_methods[t.ShaderPhaseType.normal_fragment]=[],this._fs_shader_methods[t.ShaderPhaseType.normal_fragment].push("normalMap_fragment")),-1!=this._materialData.shaderPhaseTypes[t.PassType.diffusePass].indexOf(t.ShaderPhaseType.specular_fragment)&&(this._fs_shader_methods[t.ShaderPhaseType.specular_fragment]=[],this._fs_shader_methods[t.ShaderPhaseType.specular_fragment].push("specularMap_fragment")),-1!=this._materialData.shaderPhaseTypes[t.PassType.diffusePass].indexOf(t.ShaderPhaseType.matCap_fragment)&&(this._fs_shader_methods[t.ShaderPhaseType.matCap_fragment]=[],this._fs_shader_methods[t.ShaderPhaseType.matCap_fragment].push("matCap_TextureMult_fs")),this.lightGroup&&(this._passUsage.maxDirectLight=this.lightGroup.directLightList.length,this._passUsage.maxSpotLight=this.lightGroup.spotLightList.length,this._passUsage.maxPointLight=this.lightGroup.pointLightList.length,this._vs_shader_methods[t.ShaderPhaseType.local_vertex]=this._vs_shader_methods[t.ShaderPhaseType.local_vertex]||[],this._fs_shader_methods[t.ShaderPhaseType.lighting_fragment]=[],this._fs_shader_methods[t.ShaderPhaseType.lighting_fragment].push("lightingBase_fs"),this.lightGroup.directLightList.length&&(this._passUsage.directLightData=new Float32Array(t.DirectLight.stride*this.lightGroup.directLightList.length),this._vs_shader_methods[t.ShaderPhaseType.local_vertex].push("varyingViewDir_vs"),this._fs_shader_methods[t.ShaderPhaseType.lighting_fragment].push("directLight_fragment")),this.lightGroup.spotLightList.length&&(this._passUsage.spotLightData=new Float32Array(t.SpotLight.stride*this.lightGroup.spotLightList.length),this._fs_shader_methods[t.ShaderPhaseType.lighting_fragment].push("spotLight_fragment")),this.lightGroup.pointLightList.length&&(this._passUsage.pointLightData=new Float32Array(t.PointLight.stride*this.lightGroup.pointLightList.length),this._fs_shader_methods[t.ShaderPhaseType.lighting_fragment].push("pointLight_fragment"))),this.initOthreMethods(),this.phaseEnd(e)},e.prototype.phaseEnd=function(e){var i;i=this._vs_shader_methods[t.ShaderPhaseType.base_vertex],i&&i.length>0?this.addMethodShaders(this._passUsage.vertexShader,i):(this.addMethodShaders(this._passUsage.vertexShader,["base_vs"]),i=this._vs_shader_methods[t.ShaderPhaseType.start_vertex],i&&i.length>0?this.addMethodShaders(this._passUsage.vertexShader,i):this.addMethodShaders(this._passUsage.vertexShader,["diffuse_vertex"]),i=this._vs_shader_methods[t.ShaderPhaseType.local_vertex],i&&i.length>0&&this.addMethodShaders(this._passUsage.vertexShader,i),i=this._vs_shader_methods[t.ShaderPhaseType.global_vertex],i&&i.length>0&&this.addMethodShaders(this._passUsage.vertexShader,i),i=this._vs_shader_methods[t.ShaderPhaseType.end_vertex],i&&i.length>0?this.addMethodShaders(this._passUsage.vertexShader,i):this.addMethodShaders(this._passUsage.vertexShader,["end_vs"])),i=this._fs_shader_methods[t.ShaderPhaseType.base_fragment],i&&i.length>0?this.addMethodShaders(this._passUsage.fragmentShader,i):(this.addMethodShaders(this._passUsage.fragmentShader,["base_fs"]),i=this._fs_shader_methods[t.ShaderPhaseType.start_fragment],i&&i.length>0&&this.addMethodShaders(this._passUsage.fragmentShader,i),i=this._fs_shader_methods[t.ShaderPhaseType.materialsource_fragment],i&&i.length>0?this.addMethodShaders(this._passUsage.fragmentShader,i):this.addMethodShaders(this._passUsage.fragmentShader,["materialSource_fs"]),i=this._fs_shader_methods[t.ShaderPhaseType.diffuse_fragment],i&&i.length>0?this.addMethodShaders(this._passUsage.fragmentShader,i):this.addMethodShaders(this._passUsage.fragmentShader,["diffuse_fragment"]),i=this._fs_shader_methods[t.ShaderPhaseType.normal_fragment],i&&i.length>0&&this.addMethodShaders(this._passUsage.fragmentShader,i),i=this._fs_shader_methods[t.ShaderPhaseType.shadow_fragment],i&&i.length>0&&this.addMethodShaders(this._passUsage.fragmentShader,i),i=this._fs_shader_methods[t.ShaderPhaseType.lighting_fragment],i&&i.length>0&&this.addMethodShaders(this._passUsage.fragmentShader,i),i=this._fs_shader_methods[t.ShaderPhaseType.specular_fragment],i&&i.length>0&&this.addMethodShaders(this._passUsage.fragmentShader,i),i=this._fs_shader_methods[t.ShaderPhaseType.matCap_fragment],i&&i.length>0&&this.addMethodShaders(this._passUsage.fragmentShader,i),i=this._fs_shader_methods[t.ShaderPhaseType.multi_end_fragment],i&&i.length>0&&this.addMethodShaders(this._passUsage.fragmentShader,i),i=this._fs_shader_methods[t.ShaderPhaseType.end_fragment],i&&i.length>0?this.addMethodShaders(this._passUsage.fragmentShader,i):e&&e.particleAnimationController?this.addMethodShaders(this._passUsage.fragmentShader,["particle_end_fs"]):this.addMethodShaders(this._passUsage.fragmentShader,["end_fs"]))
},e.prototype.upload=function(e,i,r,a,n,o,s){this._passChange=!1,this.initUseMethod(o,s),this._passUsage.vertexShader.shader=this._passUsage.vertexShader.getShader(this._passUsage),this._passUsage.fragmentShader.shader=this._passUsage.fragmentShader.getShader(this._passUsage),this._passUsage.program3D=t.ShaderPool.getProgram(this._passUsage.vertexShader.shader.id,this._passUsage.fragmentShader.shader.id);for(var h in this._passUsage)-1!=h.indexOf("uniform")&&this._passUsage[h]&&(this._passUsage[h].uniformIndex=r.getUniformLocation(this._passUsage.program3D,h));var l;for(var u in this._passUsage.sampler2DList)l=this._passUsage.sampler2DList[u],l.uniformIndex=r.getUniformLocation(this._passUsage.program3D,l.varName),l.texture=this._materialData[l.varName];var c;for(var u in this._passUsage.sampler3DList)c=this._passUsage.sampler3DList[u],c.uniformIndex=r.getUniformLocation(this._passUsage.program3D,c.varName);if(this.methodList)for(var d=0;d<this.methodList.length;d++)this.methodList[d].upload(e,i,this._passUsage,null,r,a,n)},e.prototype.draw=function(e,i,r,a,n,o,s){if(this._materialData.materialDataNeedChange){var h=this._materialData.tintColor,l=Math.floor(h/16777216),u=(16711680&h)/65536,c=(65280&h)/256,d=255&h;l/=128,u/=128,c/=128,d/=128,this._materialData.materialSourceData[0]=u*(this._materialData.diffuseColor>>16&255)/255,this._materialData.materialSourceData[1]=c*(this._materialData.diffuseColor>>8&255)/255,this._materialData.materialSourceData[2]=d*(255&this._materialData.diffuseColor)/255,this._materialData.materialSourceData[3]=(this._materialData.ambientColor>>16&255)/255,this._materialData.materialSourceData[4]=(this._materialData.ambientColor>>8&255)/255,this._materialData.materialSourceData[5]=(255&this._materialData.ambientColor)/255,this._materialData.materialSourceData[6]=(this._materialData.specularColor>>16&255)/255,this._materialData.materialSourceData[7]=(this._materialData.specularColor>>8&255)/255,this._materialData.materialSourceData[8]=(255&this._materialData.specularColor)/255,this._materialData.materialSourceData[9]=l*this._materialData.alpha,this._materialData.materialSourceData[10]=this._materialData.cutAlpha,this._materialData.materialSourceData[11]=this._materialData.gloss,this._materialData.materialSourceData[12]=this._materialData.specularLevel,this._materialData.materialSourceData[13]=this._materialData.albedo,this._materialData.materialSourceData[14]=this._materialData.uvRectangle.x,this._materialData.materialSourceData[15]=this._materialData.uvRectangle.y,this._materialData.materialSourceData[16]=this._materialData.uvRectangle.width,this._materialData.materialSourceData[17]=this._materialData.uvRectangle.height,this._materialData.materialSourceData[18]=this._materialData.specularLevel,this._materialData.materialSourceData[19]=window.devicePixelRatio}this._passChange&&this.upload(e,i,r,a,n,s,o.geometry),r.setProgram(this._passUsage.program3D),o.activeState(e,i,this._passUsage,r),this._materialData.depthTest?(r.enableDepth(),r.depthFunc(t.ContextConfig.LEQUAL)):(r.disableDepth(),r.depthFunc(t.ContextConfig.LEQUAL)),r.setCulling(this._materialData.cullFrontOrBack),this._materialData.bothside?r.disableCullFace():r.enableCullFace(),this._passID==t.PassType.shadowPass?(r.disableBlend(),r.setBlendFactors(t.ContextConfig.ONE,t.ContextConfig.ZERO)):(this._materialData.alphaBlending&&t.Context3DProxy.gl.depthMask(!1),r.enableBlend(),r.setBlendFactors(this._materialData.blend_src,this._materialData.blend_dest)),this._passUsage.uniform_materialSource&&r.uniform1fv(this._passUsage.uniform_materialSource.uniformIndex,this._materialData.materialSourceData),this._materialData.textureChange&&this.resetTexture(r);var p;for(var f in this._passUsage.sampler2DList)p=this._passUsage.sampler2DList[f],p.texture=this._materialData[p.varName],p.texture&&(p.texture.upload(r),r.setTexture2DAt(p.activeTextureIndex,p.uniformIndex,p.index,p.texture.texture2D),p.texture.useMipmap&&(p.texture.useMipmap=this._materialData.useMipmap),p.texture.repeat=this._materialData.repeat,p.texture.activeState(r),this._materialData.textureStateChage=!1);var _;for(var f in this._passUsage.sampler3DList)_=this._passUsage.sampler3DList[f],_.texture=this._materialData[_.varName],_.texture&&(_.texture.upload(r),r.setCubeTextureAt(_.activeTextureIndex,_.uniformIndex,_.index,_.texture.texture3D));var m=0;if(this.lightGroup){for(m=0;m<this._passUsage.maxDirectLight;m++)this.lightGroup.directLightList[m].updateLightData(n,m,this._passUsage.directLightData);for(m=0;m<this._passUsage.maxSpotLight;m++)this.lightGroup.spotLightList[m].updateLightData(n,m,this._passUsage.spotLightData);for(m=0;m<this._passUsage.maxPointLight;m++)this.lightGroup.pointLightList[m].updateLightData(n,m,this._passUsage.pointLightData);this._passUsage.uniform_directLightSource&&r.uniform1fv(this._passUsage.uniform_directLightSource.uniformIndex,this._passUsage.directLightData),this._passUsage.uniform_sportLightSource&&r.uniform1fv(this._passUsage.uniform_sportLightSource.uniformIndex,this._passUsage.spotLightData),this._passUsage.uniform_pointLightSource&&r.uniform1fv(this._passUsage.uniform_pointLightSource.uniformIndex,this._passUsage.pointLightData)}if(this._passUsage.uniform_ModelMatrix&&r.uniformMatrix4fv(this._passUsage.uniform_ModelMatrix.uniformIndex,!1,a.rawData),this._passUsage.uniform_ViewMatrix&&r.uniformMatrix4fv(this._passUsage.uniform_ViewMatrix.uniformIndex,!1,n.viewMatrix.rawData),this._passUsage.uniform_ProjectionMatrix&&r.uniformMatrix4fv(this._passUsage.uniform_ProjectionMatrix.uniformIndex,!1,n.projectMatrix.rawData),this._passUsage.uniform_ViewProjectionMatrix&&r.uniformMatrix4fv(this._passUsage.uniform_ViewProjectionMatrix.uniformIndex,!1,n.viewProjectionMatrix.rawData),this._passUsage.uniform_orthProectMatrix&&r.uniformMatrix4fv(this._passUsage.uniform_orthProectMatrix.uniformIndex,!1,n.orthProjectionMatrix.rawData),s&&s.activeState(e,i,this._passUsage,o,r,a,n),this.methodList)for(var m=0;m<this.methodList.length;m++)this.methodList[m].activeState(e,i,this._passUsage,null,r,a,n);this._passUsage.uniform_eyepos&&r.uniform3f(this._passUsage.uniform_eyepos.uniformIndex,n.x,n.y,n.z),this._passUsage.uniform_cameraMatrix&&r.uniformMatrix4fv(this._passUsage.uniform_cameraMatrix.uniformIndex,!1,n.modelMatrix.rawData),r.drawElement(this._materialData.drawMode,o.start,o.count),this._materialData.alphaBlending&&t.Context3DProxy.gl.depthMask(!0)},e.prototype.deactiveState=function(t,e){var i;for(var r in t.sampler2DList)i=this._passUsage.sampler2DList[r],i.texture&&e.disableTexture2DAt(i.activeTextureIndex,i.uniformIndex,i.index)},e.prototype.dispose=function(){},e}();t.MaterialPass=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this,i),this._passID=t.PassType.colorPass}return __extends(i,e),i.prototype.initUseMethod=function(e){this._passChange=!1,this._passUsage=new t.PassUsage,this._passUsage.vertexShader.shaderType=t.Shader.vertex,this._passUsage.fragmentShader.shaderType=t.Shader.fragment,e&&(e.skeletonAnimationController?(this._passUsage.maxBone=2*e.skeletonAnimationController.jointNum,this._vs_shader_methods[t.ShaderPhaseType.start_vertex]=[],this._vs_shader_methods[t.ShaderPhaseType.start_vertex].push("skeleton_vs")):e.particleAnimationController&&(this._vs_shader_methods[t.ShaderPhaseType.start_vertex]=[],this._vs_shader_methods[t.ShaderPhaseType.start_vertex].push("particle_vs"),this.addShaderPhase(this._passID,e.particleAnimationController.particleAnimationState.vertex_shaders,this._vs_shader_methods),this.addShaderPhase(this._passID,e.particleAnimationController.particleAnimationState.fragment_shaders,this._fs_shader_methods))),-1!=this._materialData.shaderPhaseTypes[t.PassType.diffusePass].indexOf(t.ShaderPhaseType.diffuse_fragment)&&(this._fs_shader_methods[t.ShaderPhaseType.diffuse_fragment]=[],this._fs_shader_methods[t.ShaderPhaseType.diffuse_fragment].push("diffuse_fragment")),this._fs_shader_methods[t.ShaderPhaseType.end_fragment]=this._fs_shader_methods[t.ShaderPhaseType.end_fragment]||[],this._fs_shader_methods[t.ShaderPhaseType.end_fragment].push("colorPassEnd_fs"),this.phaseEnd(e)},i}(t.MaterialPass);t.ColorPass=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this,i),this._passID=t.PassType.diffusePass}return __extends(i,e),i.prototype.initUseMethod=function(t,i){e.prototype.initUseMethod.call(this,t,i)},i}(t.MaterialPass);t.DiffusePass=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this,i),this._passID=t.PassType.diffusePass}return __extends(i,e),i.prototype.setTexture=function(t,e){this._materialData[t]=e},i.prototype.initUseMethod=function(){this._passChange=!1,this._passUsage=new t.PassUsage,this._vs_shader_methods={},this._fs_shader_methods={},this.lightGroup&&(this._passUsage.maxDirectLight=this.lightGroup.directLightList.length,this._passUsage.maxSpotLight=this.lightGroup.spotLightList.length,this._passUsage.maxPointLight=this.lightGroup.pointLightList.length,this.lightGroup.directLightList.length&&(this._passUsage.directLightData=new Float32Array(t.DirectLight.stride*this.lightGroup.directLightList.length))),this.addMethodShaders(this._passUsage.vertexShader,["FakePBR_vs"]),this.addMethodShaders(this._passUsage.fragmentShader,["materialSource_fs"]),this.addMethodShaders(this._passUsage.fragmentShader,["FakePBR_fs"])},i}(t.MaterialPass);t.FakePBRPass=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this,i),this._passID=t.PassType.shadowPass}return __extends(i,e),i.prototype.initUseMethod=function(e){if(this._passChange=!1,this._passUsage=new t.PassUsage,this._vs_shader_methods={},this._fs_shader_methods={},e){if(e.skeletonAnimationController)this._passUsage.maxBone=2*e.skeletonAnimationController.jointNum,this.addMethodShaders(this._passUsage.vertexShader,["shadowPass_skeleton_vs"]);else if(e.particleAnimationController){this._vs_shader_methods[t.ShaderPhaseType.start_vertex]=[],this._vs_shader_methods[t.ShaderPhaseType.start_vertex].push("particle_vs"),this.addShaderPhase(this._passID,e.particleAnimationController.particleAnimationState.vertex_shaders,this._vs_shader_methods),this.addMethodShaders(this._passUsage.vertexShader,["base_vs"]);var i;i=this._vs_shader_methods[t.ShaderPhaseType.start_vertex],i&&i.length>0&&this.addMethodShaders(this._passUsage.vertexShader,i),i=this._vs_shader_methods[t.ShaderPhaseType.local_vertex],i&&i.length>0&&this.addMethodShaders(this._passUsage.vertexShader,i),i=this._vs_shader_methods[t.ShaderPhaseType.global_vertex],i&&i.length>0&&this.addMethodShaders(this._passUsage.vertexShader,i),i=this._vs_shader_methods[t.ShaderPhaseType.end_vertex],i&&i.length>0&&this.addMethodShaders(this._passUsage.vertexShader,i)}}else this.addMethodShaders(this._passUsage.vertexShader,["shadowPass_vs"]);this.addMethodShaders(this._passUsage.fragmentShader,["shadowPass_fs"])},i}(t.MaterialPass);t.ShadowPass=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this,i),this._passID=t.PassType.CubePass}return __extends(i,e),i.prototype.initUseMethod=function(e){this._passChange=!1,this._passUsage=new t.PassUsage,this._passUsage.vertexShader.shaderType=t.Shader.vertex,this._passUsage.fragmentShader.shaderType=t.Shader.fragment,e&&(e.skeletonAnimationController?(this._passUsage.maxBone=2*e.skeletonAnimationController.jointNum,this._vs_shader_methods[t.ShaderPhaseType.start_vertex]=[],this._vs_shader_methods[t.ShaderPhaseType.start_vertex].push("skeleton_vs")):e.particleAnimationController&&(this._vs_shader_methods[t.ShaderPhaseType.start_vertex]=[],this._vs_shader_methods[t.ShaderPhaseType.start_vertex].push("particle_vs"),this.addShaderPhase(this._passID,e.particleAnimationController.particleAnimationState.vertex_shaders,this._vs_shader_methods),this.addShaderPhase(this._passID,e.particleAnimationController.particleAnimationState.fragment_shaders,this._fs_shader_methods))),-1!=this._materialData.shaderPhaseTypes[t.PassType.diffusePass].indexOf(t.ShaderPhaseType.normal_fragment)&&(this._fs_shader_methods[t.ShaderPhaseType.normal_fragment]=[],this._fs_shader_methods[t.ShaderPhaseType.normal_fragment].push("normalMap_fragment")),this._fs_shader_methods[t.ShaderPhaseType.end_fragment]=this._fs_shader_methods[t.ShaderPhaseType.end_fragment]||[],this._fs_shader_methods[t.ShaderPhaseType.end_fragment].push("normalPassEnd_fs"),this.phaseEnd(e)},i}(t.MaterialPass);t.NormalPass=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this,i),this._passID=t.PassType.CubePass}return __extends(i,e),i.prototype.initUseMethod=function(e){this._passChange=!1,this._passUsage=new t.PassUsage,this._passUsage.vertexShader.shaderType=t.Shader.vertex,this._passUsage.fragmentShader.shaderType=t.Shader.fragment,e&&(e.skeletonAnimationController?(this._passUsage.maxBone=2*e.skeletonAnimationController.jointNum,this._vs_shader_methods[t.ShaderPhaseType.start_vertex]=[],this._vs_shader_methods[t.ShaderPhaseType.start_vertex].push("skeleton_vs")):e.particleAnimationController&&(this._vs_shader_methods[t.ShaderPhaseType.start_vertex]=[],this._vs_shader_methods[t.ShaderPhaseType.start_vertex].push("particle_vs"),this.addShaderPhase(this._passID,e.particleAnimationController.particleAnimationState.vertex_shaders,this._vs_shader_methods),this.addShaderPhase(this._passID,e.particleAnimationController.particleAnimationState.fragment_shaders,this._fs_shader_methods))),this._vs_shader_methods[t.ShaderPhaseType.end_vertex]=this._vs_shader_methods[t.ShaderPhaseType.end_vertex]||[],this._vs_shader_methods[t.ShaderPhaseType.end_vertex].push("positionEndPass_vs"),this._fs_shader_methods[t.ShaderPhaseType.end_fragment]=this._fs_shader_methods[t.ShaderPhaseType.end_fragment]||[],this._fs_shader_methods[t.ShaderPhaseType.end_fragment].push("positionEndPass_fs"),this.phaseEnd(e)},i}(t.MaterialPass);t.PositionPass=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this,i),this._passID=t.PassType.PickPass}return __extends(i,e),i.prototype.initUseMethod=function(e){this._passChange=!1,this._passUsage=new t.PassUsage,this._vs_shader_methods={},this._fs_shader_methods={},e?e.skeletonAnimationController&&(this._passUsage.maxBone=2*e.skeletonAnimationController.jointNum,this.addMethodShaders(this._passUsage.vertexShader,["pickPass_skeleton_vs"])):this.addMethodShaders(this._passUsage.vertexShader,["pickPass_vs"]),this.addMethodShaders(this._passUsage.fragmentShader,["pickPass_fs"])},i}(t.MaterialPass);t.PickPass=e}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t.diffusePass=0]="diffusePass",t[t.colorPass=1]="colorPass",t[t.normalPass=2]="normalPass",t[t.shadowPass=3]="shadowPass",t[t.lightPass=4]="lightPass",t[t.matCapPass=5]="matCapPass",t[t.depthPass_8=6]="depthPass_8",t[t.depthPass_32=7]="depthPass_32",t[t.CubePass=8]="CubePass",t[t.PickPass=9]="PickPass"}(t.PassType||(t.PassType={}));var e=t.PassType,i=function(){function i(){}return i.CreatPass=function(i,r){switch(i){case e.colorPass:return r.shaderPhaseTypes[e.colorPass]=[],[new t.ColorPass(r)];case e.diffusePass:return r.shaderPhaseTypes[e.diffusePass]=[],[new t.DiffusePass(r)];case e.shadowPass:return r.shaderPhaseTypes[e.shadowPass]=[],[new t.ShadowPass(r)];case e.depthPass_8:return r.shaderPhaseTypes[e.depthPass_8]=[],[new t.PositionPass(r)];case e.normalPass:return r.shaderPhaseTypes[e.normalPass]=[],[new t.NormalPass(r)];case e.PickPass:return r.shaderPhaseTypes[e.PickPass]=[],[new t.PickPass(r)]}return null},i.PassAuto=[!0,!0,!0,!1,!1,!0,!0,!0],i}();t.PassUtil=i}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e){void 0===e&&(e=null),this.passes=[],this.setData(null==e?new t.MaterialData:e)}return e.prototype.setData=function(e){this.materialData=e,this.initPass(),this.blendMode=t.BlendMode.NORMAL},e.prototype.getData=function(){return this.materialData},e.prototype.initPass=function(){this.addPass(t.PassType.colorPass)},Object.defineProperty(e.prototype,"lightGroup",{get:function(){return this._lightGroup},set:function(e){if(this._lightGroup=e,this.passes[t.PassType.diffusePass]&&this.passes[t.PassType.diffusePass].length>0)for(var i=0;i<this.passes[t.PassType.diffusePass].length;i++)this.passes[t.PassType.diffusePass][i].lightGroup=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depth",{get:function(){return this.materialData.depthTest},set:function(t){this.materialData.depthTest=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthMode",{get:function(){return this.materialData.depthMode},set:function(t){this.materialData.depthMode=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"diffuseTexture",{get:function(){return this.materialData.diffuseTexture},set:function(e){e&&(this.materialData.diffuseTexture=e,this.materialData.textureChange=!0,this.materialData.shaderPhaseTypes[t.PassType.diffusePass]&&-1==this.materialData.shaderPhaseTypes[t.PassType.diffusePass].indexOf(t.ShaderPhaseType.diffuse_fragment)&&this.materialData.shaderPhaseTypes[t.PassType.diffusePass].push(t.ShaderPhaseType.diffuse_fragment),this.materialData.shaderPhaseTypes[t.PassType.shadowPass]&&-1==this.materialData.shaderPhaseTypes[t.PassType.shadowPass].indexOf(t.ShaderPhaseType.diffuse_fragment)&&this.materialData.shaderPhaseTypes[t.PassType.shadowPass].push(t.ShaderPhaseType.diffuse_fragment))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"normalTexture",{get:function(){return this.materialData.normalTexture},set:function(e){e&&(this.materialData.normalTexture=e,this.materialData.textureChange=!0,this.materialData.shaderPhaseTypes[t.PassType.diffusePass]&&-1==this.materialData.shaderPhaseTypes[t.PassType.diffusePass].indexOf(t.ShaderPhaseType.normal_fragment)&&(this.materialData.shaderPhaseTypes[t.PassType.diffusePass].push(t.ShaderPhaseType.normal_fragment),this.passInvalid(t.PassType.diffusePass)),this.materialData.shaderPhaseTypes[t.PassType.matCapPass]&&-1==this.materialData.shaderPhaseTypes[t.PassType.matCapPass].indexOf(t.ShaderPhaseType.normal_fragment)&&this.materialData.shaderPhaseTypes[t.PassType.matCapPass].push(t.ShaderPhaseType.normal_fragment))},enumerable:!0,configurable:!0}),e.prototype.passInvalid=function(t){if(this.passes[t]&&this.passes[t].length>0)for(var e=0;e<this.passes[t].length;e++)this.passes[t][e].passInvalid()},Object.defineProperty(e.prototype,"matcapTexture",{get:function(){return this.materialData.normalTexture},set:function(e){e&&(this.materialData.matcapTexture=e,this.materialData.textureChange=!0,this.materialData.shaderPhaseTypes[t.PassType.diffusePass]&&-1==this.materialData.shaderPhaseTypes[t.PassType.diffusePass].indexOf(t.ShaderPhaseType.matCap_fragment)&&(this.materialData.shaderPhaseTypes[t.PassType.diffusePass].push(t.ShaderPhaseType.matCap_fragment),this.passInvalid(t.PassType.diffusePass)),this.materialData.shaderPhaseTypes[t.PassType.matCapPass]&&-1==this.materialData.shaderPhaseTypes[t.PassType.matCapPass].indexOf(t.ShaderPhaseType.matCap_fragment)&&this.materialData.shaderPhaseTypes[t.PassType.matCapPass].push(t.ShaderPhaseType.matCap_fragment))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"specularTexture",{get:function(){return this.materialData.specularTexture},set:function(e){e&&(this.materialData.specularTexture=e,this.materialData.textureChange=!0,this.materialData.shaderPhaseTypes[t.PassType.diffusePass]&&-1==this.materialData.shaderPhaseTypes[t.PassType.diffusePass].indexOf(t.ShaderPhaseType.specular_fragment)&&this.materialData.shaderPhaseTypes[t.PassType.diffusePass].push(t.ShaderPhaseType.specular_fragment))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"drawMode",{get:function(){return this.materialData.drawMode},set:function(t){this.materialData.drawMode=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cutAlpha",{get:function(){return this.materialData.cutAlpha},set:function(t){this.materialData.cutAlpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"diffuseColor",{get:function(){return this.materialData.diffuseColor},set:function(t){this.materialData.materialDataNeedChange=!0,this.materialData.diffuseColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ambientColor",{get:function(){return this.materialData.ambientColor},set:function(t){this.materialData.materialDataNeedChange=!0,this.materialData.ambientColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"specularColor",{get:function(){return this.materialData.specularColor},set:function(t){this.materialData.materialDataNeedChange=!0,this.materialData.specularColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tintColor",{get:function(){return this.materialData.tintColor},set:function(t){this.materialData.materialDataNeedChange=!0,this.materialData.tintColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this.materialData.alpha},set:function(t){this.materialData.alpha!=t&&(this.materialData.alpha=t,this.materialData.materialDataNeedChange=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphaBlending",{get:function(){return this.materialData.alphaBlending},set:function(t){this.materialData.alphaBlending!=t&&(this.materialData.alphaBlending=t,this.materialData.materialDataNeedChange=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"specularLevel",{get:function(){return this.materialData.specularLevel},set:function(t){this.materialData.specularLevel!=t&&(this.materialData.specularLevel=t,this.materialData.materialDataNeedChange=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gloss",{get:function(){return this.materialData.gloss},set:function(t){this.materialData.gloss!=t&&(this.materialData.gloss=t,this.materialData.materialDataNeedChange=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uvRectangle",{get:function(){return this.materialData.uvRectangle},set:function(t){this.materialData.uvRectangle.x=t.x,this.materialData.uvRectangle.y=t.y,this.materialData.uvRectangle.width=t.width,this.materialData.uvRectangle.height=t.height,this.materialData.materialDataNeedChange=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"diffusePass",{get:function(){return this.passes[t.PassType.diffusePass][0]},enumerable:!0,configurable:!0}),e.prototype.addPass=function(e){this.passes[e]=t.PassUtil.CreatPass(e,this.materialData)},Object.defineProperty(e.prototype,"castShadow",{get:function(){return this.materialData.castShadow},set:function(e){this.materialData.castShadow=e,e?(t.ShadowCast.enableShadow=!0,this.addPass(t.PassType.shadowPass)):this.passes[t.PassType.shadowPass]&&(this.disposePass(t.PassType.shadowPass),this.passes[t.PassType.shadowPass]=null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"castPick",{set:function(e){e?(t.PickSystem.instance.enablePick=!0,this.addPass(t.PassType.PickPass)):this.passes[t.PassType.PickPass]&&(this.disposePass(t.PassType.PickPass),this.passes[t.PassType.PickPass]=null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"acceptShadow",{get:function(){return this.materialData.acceptShadow},set:function(e){this.materialData.acceptShadow!=e&&(this.materialData.acceptShadow=e,this.materialData.acceptShadow?(this._shadowMethod=new t.ShadowMethod(this),this._shadowMethod.shadowMapTexture=t.ShadowCast.instance.shadowRender.renderTexture,this.diffusePass.addMethod(this._shadowMethod)):this._shadowMethod&&this.diffusePass.removeMethod(this._shadowMethod))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowColor",{get:function(){var t=0;return t|=255*this.materialData.shadowColor[0]<<16,t|=255*this.materialData.shadowColor[1]<<8,t|=255*this.materialData.shadowColor[2]},set:function(t){this.materialData.shadowColor[0]=t>>16&1,this.materialData.shadowColor[1]=t>>8&1,this.materialData.shadowColor[2]=1&t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowOffset",{get:function(){return this.materialData.shadowColor[3]},set:function(t){this.materialData.shadowColor[3]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"repeat",{get:function(){return this.materialData.repeat},set:function(t){this.materialData.repeat=t,this.materialData.textureStateChage=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bothside",{get:function(){return this.materialData.bothside},set:function(t){this.materialData.textureStateChage=!0,this.materialData.bothside=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cullMode",{get:function(){return this.materialData.cullFrontOrBack},set:function(t){this.materialData.textureStateChage=!0,this.materialData.cullFrontOrBack=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{set:function(e){switch(this.materialData.textureStateChage=!0,this.materialData.blendMode=e,e){case t.BlendMode.NORMAL:this.materialData.blend_src=t.ContextConfig.ONE,this.materialData.blend_dest=t.ContextConfig.ONE_MINUS_SRC_ALPHA,this.materialData.alphaBlending=!1;break;case t.BlendMode.LAYER:this.materialData.blend_src=t.ContextConfig.SRC_ALPHA,this.materialData.blend_dest=t.ContextConfig.ZERO,this.materialData.alphaBlending=!0;break;case t.BlendMode.MULTIPLY:this.materialData.blend_src=t.ContextConfig.ZERO,this.materialData.blend_dest=t.ContextConfig.SRC_COLOR,this.materialData.alphaBlending=!0;break;case t.BlendMode.ADD:this.materialData.blend_src=t.ContextConfig.SRC_ALPHA,this.materialData.blend_dest=t.ContextConfig.ONE,this.materialData.alphaBlending=!0;break;case t.BlendMode.SOFT_ADD:this.materialData.blend_src=t.ContextConfig.SRC_COLOR,this.materialData.blend_dest=t.ContextConfig.ONE,this.materialData.alphaBlending=!0;break;case t.BlendMode.ALPHA:this.materialData.blend_src=t.ContextConfig.ONE,this.materialData.blend_dest=t.ContextConfig.ONE_MINUS_SRC_ALPHA,this.materialData.alphaBlending=!0;break;case t.BlendMode.SCREEN:this.materialData.blend_src=t.ContextConfig.ONE,this.materialData.blend_dest=t.ContextConfig.ONE_MINUS_SRC_COLOR}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pointSize",{get:function(){return this.materialData.specularLevel},set:function(t){t!=this.materialData.specularLevel&&(this.materialData.specularLevel=t,this.materialData.textureStateChage=!0)},enumerable:!0,configurable:!0}),e.prototype.disposePass=function(t){for(var e=0;e<this.passes[t].length;e++)this.passes[t][e].dispose()},e.prototype.renderXRayPass=function(){},e.prototype.renderOutlinePass=function(){},e.prototype.renderNormalPass=function(){},e.prototype.renderDepthPass=function(){},e.prototype.renderPositionPass=function(){},e.prototype.renderUVPass=function(){},e.prototype.renderScendUVPass=function(){},e.prototype.renderVertexColorPass=function(){},e.prototype.renderLightingPass=function(){},e}();t.MaterialBase=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){void 0===i&&(i=13421772),e.call(this),this.color=i,this.diffuseTexture=t.CheckerboardTexture.texture,this.initMatPass()}return __extends(i,e),i.prototype.initMatPass=function(){this.addPass(t.PassType.diffusePass),this.diffusePass.addMethod(new t.ColorMethod)},Object.defineProperty(i.prototype,"color",{get:function(){return this.materialData.diffuseColor},set:function(t){this.materialData.diffuseColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"alpha",{get:function(){return this.materialData.alpha},set:function(t){this.materialData.alpha=t},enumerable:!0,configurable:!0}),i}(t.MaterialBase);t.ColorMaterial=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r){void 0===i&&(i=null),void 0===r&&(r=null),e.call(this,r),this.diffuseTexture=i?i:t.CheckerboardTexture.texture,this.initMatPass()}return __extends(i,e),i.prototype.initMatPass=function(){this.addPass(t.PassType.diffusePass)},i.prototype.clone=function(){var t=new i(this.diffuseTexture,this.materialData.clone());return t},i}(t.MaterialBase);t.TextureMaterial=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r){void 0===i&&(i=null),void 0===r&&(r=null),e.call(this,r),this.diffuseTexture=i?i:t.CheckerboardTexture.texture,this.initMatPass()}return __extends(i,e),i.prototype.initMatPass=function(){this._fakePBR=new t.FakePBRPass(this.materialData),this.materialData.shaderPhaseTypes[t.PassType.diffusePass]=[],this.passes[t.PassType.diffusePass]=[this._fakePBR]},Object.defineProperty(i.prototype,"albedoTexture",{set:function(t){this._fakePBR.setTexture("albedoTex",t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"normalTexture",{set:function(t){this._fakePBR.setTexture("normalTex",t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"glossTexture",{set:function(t){this._fakePBR.setTexture("glossTex",t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"specularTexture",{set:function(t){this._fakePBR.setTexture("specularTex",t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"opacityTexture",{set:function(t){this._fakePBR.setTexture("opacityTex ",t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"reflectionTexture",{set:function(t){this._fakePBR.setTexture("reflectionMap",t)},enumerable:!0,configurable:!0}),i.prototype.clone=function(){var e=new t.TextureMaterial(this.diffuseTexture,this.materialData.clone());return e},i}(t.MaterialBase);t.FakePBRMaterial=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(t,i){void 0===t&&(t=null),void 0===i&&(i=null),e.call(this,i),this.diffuseTexture=t,this.initMatPass()}return __extends(i,e),i.prototype.initMatPass=function(){this.addPass(t.PassType.diffusePass),this.diffusePass.addMethod(new t.CubeMethod)},i.prototype.clone=function(){var t=new i(this.diffuseTexture,this.materialData.clone());return t},i}(t.MaterialBase);t.CubeTextureMaterial=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this._renderIndex=0,this.numEntity=0}return e.prototype.setRenderToTexture=function(e,i,r){void 0===r&&(r=t.FrameBufferFormat.UNSIGNED_BYTE_RGB),this.renderTexture=new t.RenderTexture(e,i,r)},e.prototype.draw=function(t,e,i,r,a,n,o){void 0===n&&(n=null),void 0===o&&(o=!1)},e}();t.RenderBase=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){void 0===i&&(i=t.PassType.diffusePass),e.call(this),this._i=0,this._j=0,this.pass=i}return __extends(i,e),Object.defineProperty(i.prototype,"pass",{get:function(){return this._pass},set:function(t){this._pass=t},enumerable:!0,configurable:!0}),i.prototype.draw=function(e,i,r,a,n,o,s){void 0===o&&(o=null),void 0===s&&(s=!1),this.numEntity=a.renderList.length,this.renderTexture&&(this.renderTexture.upload(r),r.setRenderToTexture(this.renderTexture.texture2D,!0,0));var h;for(this._renderIndex=0;this._renderIndex<this.numEntity;this._renderIndex++)for(this._renderItem=a.renderList[this._renderIndex],this._renderItem.geometry.activeState(e,i,t.Egret3DCanvas.context3DProxy,n),this._i=0;this._i<this._renderItem.geometry.subGeometrys.length;this._i++){var l=this._renderItem.geometry.subGeometrys[this._i],u=l.matID;if(h=this._renderItem.multiMaterial[u],null!=h)if(h.passes[this._pass])for(this._j=h.passes[this._pass].length-1;this._j>=0;this._j--)h.passes[this._pass][this._j].draw(e,i,r,this._renderItem.modelMatrix,n,l,this._renderItem.animation);else if(t.PassUtil.PassAuto[this._pass])for(h.passes[this._pass]||h.addPass(this._pass),this._j=h.passes[this._pass].length-1;this._j>=0;this._j--)h.passes[this._pass]=t.PassUtil.CreatPass(this._pass,h.materialData),h.passes[this._pass][this._j].draw(e,i,r,this._renderItem.modelMatrix,n,l,this._renderItem.animation)
}this.renderTexture&&(r.setRenderToBackBuffer(),o&&(r.viewPort(o.x,o.y,o.width,o.height),r.setScissorRectangle(o.x,o.y,o.width,o.height)))},i}(t.RenderBase);t.MultiRender=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r){e.call(this),this.hud=new t.HUD,this.hud.vsShader=i,this.hud.fsShader=r}return __extends(i,e),i.prototype.setRenderToTexture=function(e,i,r){void 0===r&&(r=t.FrameBufferFormat.UNSIGNED_BYTE_RGB),this.renderTexture=new t.RenderTexture(e,i,t.FrameBufferFormat.UNSIGNED_BYTE_RGB)},i.prototype.draw=function(t,e,i,r,a,n,o){void 0===n&&(n=null),this.numEntity=r.renderList.length,this.renderTexture&&(this.renderTexture.upload(i),i.setRenderToTexture(this.renderTexture.texture2D,!0,0)),this.hud.viewPort=a.viewPort,this.hud.x=a.viewPort.x,this.hud.y=a.viewPort.y,this.hud.width=a.viewPort.width,this.hud.height=a.viewPort.height,this.hud.diffuseTexture=o.end,this.hud.colorTexture=o.colorTexture,this.hud.draw(i,a),this.renderTexture&&i.setRenderToBackBuffer(),n&&(i.viewPort(n.x,n.y,n.width,n.height),i.setScissorRectangle(n.x,n.y,n.width,n.height))},i}(t.RenderBase);t.PostRender=e}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t["float"]=0]="float",t[t.vec2=1]="vec2",t[t.vec3=2]="vec3",t[t.vec4=3]="vec4"}(t.ValueType||(t.ValueType={}));var e=t.ValueType,i=function(){function t(){}return t.prototype.calculate=function(t,e){return void 0===e&&(e=null),new Error("asd"),null},t.prototype.dispose=function(){},t}();t.ValueShape=i;var r=function(t){function i(){t.apply(this,arguments),this.valueType=e["float"],this.value=5}return __extends(i,t),i.prototype.calculate=function(t){for(var e=[],i=0;t>i;i++)e.push(this.value);return e},i}(i);t.ConstValueShape=r;var a=function(t){function i(){t.apply(this,arguments),this.valueType=e["float"],this.min=0,this.max=100}return __extends(i,t),i.prototype.calculate=function(t){for(var e=[],i=0;t>i;i++)e.push(this.min+Math.random()*(this.max-this.min));return e},i}(i);t.ConstRandomValueShape=a;var n=function(i){function r(){i.apply(this,arguments),this.valueType=e.vec2,this.minX=0,this.minY=0}return __extends(r,i),r.prototype.calculate=function(e){for(var i=[],r=0;e>r;r++){var a=new t.Point;a.x=this.minX,a.y=this.minY,i.push(a)}return i},r}(i);t.Vec2ConstValueShape=n;var o=function(i){function r(){i.apply(this,arguments),this.valueType=e.vec2,this.minX=0,this.minY=0,this.maxX=100,this.maxY=100}return __extends(r,i),r.prototype.calculate=function(e){for(var i=[],r=0;e>r;r++){var a=new t.Point;a.x=this.minX+Math.random()*(this.maxX-this.minX),a.y=this.minY+Math.random()*(this.maxY-this.minY),i.push(a)}return i},r}(i);t.Vec2ConstRandomValueShape=o;var s=function(i){function r(){i.apply(this,arguments),this.valueType=e.vec3,this.minX=0,this.minY=0,this.minZ=0}return __extends(r,i),r.prototype.calculate=function(e){for(var i=[],r=0;e>r;r++){var a=new t.Vector3D;a.x=this.minX,a.y=this.minY,a.z=this.minZ,i.push(a)}return i},r}(i);t.Vec3ConstValueShape=s;var h=function(i){function r(){i.apply(this,arguments),this.valueType=e.vec3,this.minX=-50,this.minY=-50,this.minZ=-50,this.maxX=50,this.maxY=50,this.maxZ=50}return __extends(r,i),r.prototype.calculate=function(e){for(var i=[],r=0;e>r;r++){var a=new t.Vector3D;a.x=this.minX+Math.random()*(this.maxX-this.minX),a.y=this.minY+Math.random()*(this.maxY-this.minY),a.z=this.minZ+Math.random()*(this.maxZ-this.minZ),i.push(a)}return i},r}(i);t.Vec3ConstRandomValueShape=h;var l=function(i){function r(){i.apply(this,arguments),this.valueType=e.vec3,this.width=100,this.height=100,this.depth=100}return __extends(r,i),r.prototype.calculate=function(e){for(var i,r=[],a=0;e>a;a++)i=new t.Vector3D,i.x=Math.random()*this.width-.5*this.width,i.y=Math.random()*this.height-.5*this.height,i.z=Math.random()*this.depth-.5*this.depth,r.push(i);return r},r}(i);t.CubeVector3DValueShape=l;var u=function(i){function r(){i.apply(this,arguments),this.valueType=e.vec3,this.width=100,this.height=100}return __extends(r,i),r.prototype.calculate=function(e){for(var i,r=[],a=0;e>a;a++)i=new t.Vector3D,i.x=Math.random()*this.width-.5*this.width,i.y=0,i.z=Math.random()*this.height-.5*this.height,r.push(i);return r},r}(i);t.PlaneValueShape=u;var c=function(i){function r(){i.apply(this,arguments),this.valueType=e.vec3,this.radius=20,this.angle=20,this.length=20,this.coneType=t.ParticleConeShapeType.Volume}return __extends(r,i),r.prototype.dispose=function(){this.directions&&(this.directions.length=0),this.origPoint=null,this.directions=null},r.prototype.calculate=function(e){this.angle>90&&(this.angle=90),this.radius<=0&&(this.radius=.01),90==this.angle?this.origPoint=new t.Vector3D:0==this.angle?this.origPoint=null:(this.origPoint=new t.Vector3D,this.origPoint.z=-this.radius/Math.tan(this.angle*Math.PI/180));var i;return this.directions=[],this.coneType==t.ParticleConeShapeType.Volume?i=90==this.angle?this.calculateBase(e):this.calculateVolume(e):this.coneType==t.ParticleConeShapeType.VolumeShell?i=90==this.angle?this.calculateBaseShell(e):this.calculateVolumeShell(e):this.coneType==t.ParticleConeShapeType.Base?i=this.calculateBase(e):this.coneType==t.ParticleConeShapeType.BaseShell&&(i=this.calculateBaseShell(e)),i},r.prototype.calculateBase=function(e){for(var i,r,a,n,o=[],s=0;e>s;s++)a=Math.random()*Math.PI*2,i=new t.Vector3D,i.z=0,n=Math.random()*this.radius,i.x=Math.sin(a)*n,i.y=Math.cos(a)*n,this.origPoint?(r=i.subtract(this.origPoint),r.normalize()):r=new t.Vector3D(0,0,1),o.push(i),this.directions.push(r);return o},r.prototype.calculateBaseShell=function(e){for(var i,r,a,n,o=[],s=0;e>s;s++)a=Math.random()*Math.PI*2,i=new t.Vector3D,i.z=0,n=this.radius,i.x=Math.sin(a)*n,i.y=Math.cos(a)*n,this.origPoint?(r=i.subtract(this.origPoint),r.normalize()):r=new t.Vector3D(0,0,1),o.push(i),this.directions.push(r);return o},r.prototype.calculateVolume=function(e){for(var i,r,a,n,o=[],s=0;e>s;s++)a=Math.random()*Math.PI*2,i=new t.Vector3D,i.z=this.length*Math.random(),n=this.radius*Math.random(),this.origPoint&&(n*=(i.z-this.origPoint.z)/-this.origPoint.z),i.x=Math.sin(a)*n,i.y=Math.cos(a)*n,this.origPoint?(r=i.subtract(this.origPoint),r.normalize()):r=new t.Vector3D(0,0,1),o.push(i),this.directions.push(r);return o},r.prototype.calculateVolumeShell=function(e){for(var i,r,a,n,o=[],s=0;e>s;s++)a=Math.random()*Math.PI*2,i=new t.Vector3D,i.z=this.length*Math.random(),n=this.radius,this.origPoint&&(n*=(i.z-this.origPoint.z)/-this.origPoint.z),i.x=Math.sin(a)*n,i.y=Math.cos(a)*n,this.origPoint?(r=i.subtract(this.origPoint),r.normalize()):r=new t.Vector3D(0,0,1),o.push(i),this.directions.push(r);return o},r}(i);t.ConeValueShape=c;var d=(function(i){function r(){i.apply(this,arguments),this.valueType=e.vec3,this.points=[new t.Vector3D,new t.Vector3D(100,0,0),new t.Vector3D(100,200,0)]}return __extends(r,i),r.prototype.calculate=function(e){if(1==this.points.length)return this.points;for(var i=[],r=0,a=0,n=1;n<this.points.length;n++)r+=t.Vector3D.distance(this.points[n-1],this.points[n]);a=r/e;for(var o=new t.Vector3D,s=0,h=0,l=0,n=1;n<this.points.length;n++)o.x=this.points[n].x-this.points[n-1].x,o.y=this.points[n].y-this.points[n-1].y,o.z=this.points[n].z-this.points[n-1].z,o.normalize(),o.scaleBy(a+l),s=t.Vector3D.distance(this.points[n-1],this.points[n]),h=t.Vector3D.distance(o,this.points[n]),h>s&&(l+=h);return i},r}(i),function(i){function r(){i.apply(this,arguments),this.valueType=e.vec3,this.r=10,this.fromShell=!1}return __extends(r,i),r.prototype.calculate=function(t){var e=[];return e=this.getPoints1(t,this.r)},r.prototype.getPoints1=function(e,i){for(var r,a,n,o,s=[],h=new t.Vector3D(0,0,0),l=0;e>l;l++)r=2*Math.random()*i-i,a=2*Math.random()*i-i,n=2*Math.random()*i-i,o=new t.Vector3D(r,a,n),this.fromShell&&o.normalize(this.r),t.Vector3D.distance(h,o)>i?l--:s.push(o);return s},r}(i));t.BallValueShape=d;var p=function(i){function r(){i.apply(this,arguments),this.valueType=e.vec3,this.r=10,this.fromShell=!1}return __extends(r,i),r.prototype.calculate=function(t){var e=[];return e=this.getPoints(t,this.r)},r.prototype.getPoints=function(e,i){for(var r,a,n,o,s=[],h=new t.Vector3D(0,0,0),l=0;e>l;l++)r=2*Math.random()*i-i,a=2*Math.random()*i-i,n=Math.abs(2*Math.random()*i-i),o=new t.Vector3D(r,a,n),this.fromShell&&o.normalize(this.r),t.Vector3D.distance(h,o)>i?l--:s.push(o);return s},r}(i);t.HemiBallValueShape=p;var f=(function(i){function r(){i.apply(this,arguments),this.valueType=e.vec3}return __extends(r,i),r.prototype.calculate=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var r,a=e[0],n=a[0];return r=this.createRandomPoint1(t,n)},r.prototype.createRandomPoint1=function(e,i){for(var r=[],a=2*i,n=0;e>n;n++){var o=Math.random()*a-i,s=Math.random()*a-i;o*o+s*s>i*i?n--:r.push(new t.Vector3D(o,0,s))}return r},r.prototype.createRandomPoint2=function(e,i){for(var r,a,n,o=[],s=0;e>s;s++)r=new t.Vector3D,a=Math.sqrt(Math.random())*i,n=360*Math.random(),r.x=a*Math.sin(n),r.z=a*Math.cos(n),r.y=0,o.push(r);return o},r}(i),function(i){function r(){i.apply(this,arguments),this.valueType=e.vec3,this.normalList=[],this.type=t.ParticleMeshShapeType.Edge}return __extends(r,i),r.prototype.calculate=function(e){var i=[];return this.type==t.ParticleMeshShapeType.Edge?this.edgePosition(i,e):this.type==t.ParticleMeshShapeType.Triangle?this.trianglePosition(i,e):this.type==t.ParticleMeshShapeType.Vertex&&this.vertexPosition(i,e),i},r.prototype.edgePosition=function(e,i){for(var a,n,o,s,h,l=this.geometry.faceCount,u=[],c=0;i>c;c++){a=new t.Vector3D,e.push(a);var d=3*Math.floor(l*Math.random());u.length=0,this.geometry.getVertexForIndex(d+0,t.VertexFormat.VF_POSITION,u),r.vct1.setTo(u[0],u[1],u[2]),u.length=0,this.geometry.getVertexForIndex(d+1,t.VertexFormat.VF_POSITION,u),r.vct2.setTo(u[0],u[1],u[2]),u.length=0,this.geometry.getVertexForIndex(d+2,t.VertexFormat.VF_POSITION,u),r.vct3.setTo(u[0],u[1],u[2]),n=this.calcNormal(r.vct1,r.vct2,r.vct3),this.normalList.push(n),h=Math.random(),.333>h?(o=r.vct1,s=r.vct2):.666>h?(o=r.vct2,s=r.vct3):(o=r.vct3,s=r.vct1),o.lerp(o,s,Math.random()),a.copyFrom(o)}},r.prototype.trianglePosition=function(e,i){for(var a,n,o=this.geometry.faceCount,s=new t.Vector3D,h=new t.Vector3D,l=[],u=0;i>u;u++){a=new t.Vector3D,e.push(a);var c=3*Math.floor(o*Math.random());l.length=0,this.geometry.getVertexForIndex(c+0,t.VertexFormat.VF_POSITION,l),r.vct1.setTo(l[0],l[1],l[2]),l.length=0,this.geometry.getVertexForIndex(c+1,t.VertexFormat.VF_POSITION,l),r.vct2.setTo(l[0],l[1],l[2]),l.length=0,this.geometry.getVertexForIndex(c+2,t.VertexFormat.VF_POSITION,l),r.vct3.setTo(l[0],l[1],l[2]),n=this.calcNormal(r.vct1,r.vct2,r.vct3),this.normalList.push(n),s.lerp(r.vct1,r.vct2,Math.random()),h.lerp(r.vct2,r.vct3,Math.random()),a.lerp(s,h,Math.random())}},r.prototype.vertexPosition=function(e,i){for(var a,n,o,s=this.geometry.faceCount,h=[],l=0;i>l;l++){a=new t.Vector3D,e.push(a);var u=3*Math.floor(s*Math.random());h.length=0,this.geometry.getVertexForIndex(u+0,t.VertexFormat.VF_POSITION,h),r.vct1.setTo(h[0],h[1],h[2]),h.length=0,this.geometry.getVertexForIndex(u+1,t.VertexFormat.VF_POSITION,h),r.vct2.setTo(h[0],h[1],h[2]),h.length=0,this.geometry.getVertexForIndex(u+2,t.VertexFormat.VF_POSITION,h),r.vct3.setTo(h[0],h[1],h[2]),n=this.calcNormal(r.vct1,r.vct2,r.vct3),this.normalList.push(n),o=Math.random(),a.copyFrom(.333>o?r.vct1:.666>o?r.vct2:r.vct3)}},r.prototype.calcNormal=function(t,e,i){return r.crsVector1.setTo(e.x-t.x,e.y-t.y,e.z-t.z),r.crsVector2.setTo(i.x-t.x,i.y-t.y,i.z-t.z),this.normal=r.crsVector1.crossProduct(r.crsVector2),this.normal.normalize(),this.normal},r.vct1=new t.Vector3D,r.vct2=new t.Vector3D,r.vct3=new t.Vector3D,r.crsVector1=new t.Vector3D,r.crsVector2=new t.Vector3D,r}(i));t.Mesh3DValueShape=f;var _=(function(i){function r(){i.apply(this,arguments),this.valueType=e.vec3}return __extends(r,i),r.prototype.calculate=function(e){for(var i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];var a=[],n=[];n.push(new t.Vector3D(0,0,0)),n.push(new t.Vector3D(-200,1e3,700)),n.push(new t.Vector3D(200,-50,300)),n.push(new t.Vector3D(-300,-220,500));for(var o,s,h,l,u,c=n[0],d=n[1],p=n[2],f=n[3],_=0;e>_;_++)o=Math.random(),s=1-o,h=c.x*s*s*s+3*d.x*s*s*o+3*p.x*s*o*o+f.x*o*o*o,l=c.y*s*s*s+3*d.y*s*s*o+3*p.y*s*o*o+f.y*o*o*o,u=c.z*s*s*s+3*d.z*s*s*o+3*p.z*s*o*o+f.z*o*o*o,a.push(new t.Vector3D(h,l,u));return a},r}(i),function(){function t(){this.emitter={}}return t.calculate=function(t,e){return e.calculate(t,e)},t.getValues=function(){},t._instance=new t,t}());t.Value=_}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleEndNode",this.vertex_ShaderName[t.ShaderPhaseType.end_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.end_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.end_vertex].push("particle_end_vs")}return __extends(i,e),i.prototype.build=function(){},i}(t.AnimationNode);t.ParticleEndNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this._tiny=.001}return e.prototype.generator=function(e){this._inputCount=2e3,this._data=e,this._node=e.life,this._burstsClone=e.emission.bursts,this._burstsClone&&(this._burstsClone=this._burstsClone.slice()),this.planes=[],this.loopTime=this.circleTime=0,this._data.emission.type==t.ParticleValueType.Const?this.generatorConst():this.generatorBezier(),this.planes.sort(function(t,e){return t.x-e.x});for(var i,r=0,a=0,n=this.planes;a<n.length;a++)i=n[a],this.circleTime=Math.max(this.circleTime,i.x+i.y),this.loopTime=Math.max(this.loopTime,i.y),r=i.x;r>this.loopTime&&(this.loopTime=r),this.circleTime+=this._data.life.delay},e.prototype.burstPlanes=function(t,e){for(var i,r,a,n,o=0,s=this._burstsClone.length;s>o;o++){if(i=this._burstsClone[o],r=i.x,n=!1,r>=t&&e>=r){a=Math.min(i.y,this._data.property.particleCount);for(var h=0;a>h;h++)this.tryCreatePlane(r);n=!0}else r>=this._data.life.duration&&(n=!0);n&&(this._burstsClone.splice(o,1),o--,s--)}},e.prototype.generatorConst=function(){var e=this._data.emission.rate;if(0!=e)for(var i=Math.max(1/e,this._tiny),r=(this._data.life.duration,i),a=r+i;r<=this._data.life.duration&&this.planes.length<this._inputCount;)this.tryCreatePlane(r),a=r+i,this._burstsClone&&this._burstsClone.length>0&&this.burstPlanes(r,a),r=a;else for(;this._burstsClone&&this._burstsClone.length>0&&this.planes.length<this._inputCount;)this.burstPlanes(0,t.MathUtil.MAX_VALUE)},e.prototype.generatorBezier=function(){for(var t=.05,e=this._data.life.duration,i=t,r=i,a=0,n=0,o=0;e>i&&this.planes.length<this._inputCount;)if(a+=this._data.emission.bezier.calc(i/e)*t,n=Math.floor(a),a-=n,n>0)for(o=t/n;n>0;)r+=o,this.tryCreatePlane(i),this._burstsClone&&this._burstsClone.length>0&&this.burstPlanes(i,r),i=r,n--;else r=i+t,this._burstsClone&&this._burstsClone.length>0&&this.burstPlanes(i,r),i=r},e.prototype.tryCreatePlane=function(e){for(var i,r,a=0,n=this._data.property.particleCount,o=0,s=this.planes.length;s>o;o++)r=this.planes[o],i=r.x,r.x+r.y>e&&a++;n>a&&(r=new t.Point(e,this.getLifeTime(e)),this.planes.push(r))},e.prototype.getLifeTime=function(e){var i,r,a=(this._data.life.type,this._data.life);return a.type==t.ParticleValueType.Const?i=r=a.max:a.type==t.ParticleValueType.RandomConst?(i=a.max,r=a.min):a.type==t.ParticleValueType.OneBezier?i=r=a.bezier1.calc(e/a.duration):(i=a.bezier1.calc(e/a.duration),r=a.bezier2.calc(e/a.duration)),Math.random()*(i-r)+r},e.prototype.dispose=function(){this._data=null,this._node=null,this._burstsClone=null,this.planes=null},e}();t.ParticleLifeGenerator=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleSpeedNode",this.vertex_ShaderName[t.ShaderPhaseType.local_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.local_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.local_vertex].push("particle_bezier"),this.vertex_ShaderName[t.ShaderPhaseType.local_vertex].push("particle_time_vs"),this.fragment_ShaderName[t.ShaderPhaseType.start_fragment]=this.fragment_ShaderName[t.ShaderPhaseType.start_fragment]||[],this.fragment_ShaderName[t.ShaderPhaseType.start_fragment].push("particle_time_fs"),this.fragment_ShaderName[t.ShaderPhaseType.diffuse_fragment]=this.fragment_ShaderName[t.ShaderPhaseType.diffuse_fragment]||[],this.fragment_ShaderName[t.ShaderPhaseType.diffuse_fragment].push("particle_diffuse_fragment"),this.attribute_time=new t.GLSL.VarRegister,this.attribute_time.name="attribute_time",this.attribute_time.size=3,this.attributes.push(this.attribute_time)}return __extends(i,e),i.prototype.initNode=function(){},i.prototype.build=function(t,e){this._animationState=this.state;for(var i,r=this._animationState.emitter.generator,a=t.vertexCount/e,n=0,o=r.planes,s=0;e>s;++s){i=o[s];for(var h=0;a>h;++h)n=s*a+h,n=n*t.vertexAttLength+this.attribute_time.offsetIndex,t.vertexArray[n+0]=i.x,t.vertexArray[n+1]=i.y,t.vertexArray[n+2]=s}this._animationState.loopTime=r.loopTime,this._animationState.circleTime=r.circleTime},i.prototype.afterBuild=function(){},Object.defineProperty(i.prototype,"offsetIndex",{get:function(){return this.attribute_time.offsetIndex},enumerable:!0,configurable:!0}),i.prototype.dispose=function(){e.prototype.dispose.call(this),this._animationState=null},i}(t.AnimationNode);t.ParticleTime=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticlePosition",this.attribute_offsetPosition=new t.GLSL.VarRegister,this.attribute_offsetPosition.name="attribute_offsetPosition",this.attribute_offsetPosition.size=3,this.attributes.push(this.attribute_offsetPosition)}return __extends(i,e),i.prototype.initNode=function(e,i){var r,a=i.renderMode;r=a==t.ParticleRenderModeType.Billboard?"particle_rm_billboard":a==t.ParticleRenderModeType.StretchedBillboard?"particle_rm_stretched":"particle_rm_mesh",this.vertex_ShaderName[t.ShaderPhaseType.local_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.local_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.local_vertex].push(r);var n=this._node=e;if(n.type==t.ParticleDataShapeType.Point){var o=new t.Vec3ConstValueShape;o.minX=0,o.minY=0,o.minZ=0,this._positions=o}else if(n.type==t.ParticleDataShapeType.Cube){var s=new t.CubeVector3DValueShape;s.width=n.cubeW,s.height=n.cubeH,s.depth=n.cubeD,this._positions=s}else if(n.type==t.ParticleDataShapeType.Sphere){var h=new t.BallValueShape;h.r=n.sphereRadius,h.fromShell=n.emitFromShell,this._positions=h}else if(n.type==t.ParticleDataShapeType.HemiSphere){var l=new t.HemiBallValueShape;l.r=n.hemiSphereRadius,l.fromShell=n.emitFromShell,this._positions=l}else if(n.type==t.ParticleDataShapeType.Cone){var u=new t.ConeValueShape;u.angle=n.coneAngle,u.length=n.coneLength,u.radius=n.coneRadius,u.coneType=n.coneType,this._positions=u}else if(n.type==t.ParticleDataShapeType.Mesh){var c=new t.Mesh3DValueShape;c.geometry=n.geometry,c.type=n.meshType,this._positions=c}},Object.defineProperty(i.prototype,"offsetIndex",{get:function(){return this.attribute_offsetPosition.offsetIndex},enumerable:!0,configurable:!0}),i.prototype.build=function(e,i){this._animationState=this.state;var r,a=this._positions.calculate(i),n=this._animationState.directionArray=[];this._node.type==t.ParticleDataShapeType.Mesh&&(r=this._positions.normalList);for(var o=e.vertexCount/i,s=0,h=this._animationState.emitter.data,l=new t.Vector3D,u=this._positions,c=0;i>c;++c){var d=a[c];l.copyFrom(d),d.multiply(h.property.scale,d);var p=new t.Vector3D;h.shape.randomDirection?p.setTo(Math.random()-.5,Math.random()-.5,Math.random()-.5):this._node.type==t.ParticleDataShapeType.Point?p.setTo(Math.random()-.5,Math.random()-.5,Math.random()-.5):this._node.type==t.ParticleDataShapeType.Cube?p.setTo(0,0,1,1):this._node.type==t.ParticleDataShapeType.Sphere?p.copyFrom(l):this._node.type==t.ParticleDataShapeType.HemiSphere?p.copyFrom(l):this._node.type==t.ParticleDataShapeType.Cone?p=u.directions[c]:this._node.type==t.ParticleDataShapeType.Mesh&&p.copyFrom(r[c]),p.normalize(),n.push(p);for(var f=0;o>f;++f)s=c*o+f,s=s*e.vertexAttLength+this.attribute_offsetPosition.offsetIndex,e.vertexArray[s+0]=d.x,e.vertexArray[s+1]=d.y,e.vertexArray[s+2]=d.z}},i.prototype.afterBuild=function(){this._positions.dispose(),this._positions=null,this._animationState.directionArray.length=0,this._animationState.directionArray=null},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._positions=null,this._animationState=null,this._node=null},i}(t.AnimationNode);t.ParticlePosition=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.rotationMat=new t.Matrix4_4,this.name="ParticleRotation"}return __extends(i,e),i.prototype.initNode=function(e){var i=this._node=e;this._rotations=new t.ConstRandomValueShape,this._rotations.max=i.max,this._rotations.min=i.min},i.prototype.build=function(e,i){this._animationState=this.state;var r=this._animationState.emitter.data.property.renderMode;if(r!=t.ParticleRenderModeType.StretchedBillboard)for(var a,n,o,s=this._rotations.calculate(i),h=e.vertexCount/i,l=0,u=new t.Vector3D,c=0,d=this._animationState.emitter.data.life.duration,p=this._animationState.emitter.timeNode.offsetIndex,f=0,_=0;i>_;++_){if(this._node.type==t.ParticleValueType.OneBezier||this._node.type==t.ParticleValueType.TwoBezier){if(n=f*e.vertexAttLength+p,o=e.vertexArray[n+0],c=o/d,c-=Math.floor(c),a=this._node.bezier1.calc(c),this._node.type==t.ParticleValueType.TwoBezier){var m=Math.random();a*=m,a+=this._node.bezier2.calc(c)*(1-m)}}else a=s[_];this.rotationMat.identity(),r==t.ParticleRenderModeType.VerticalBillboard||r==t.ParticleRenderModeType.HorizontalBillboard?this.rotationMat.rotation(0,a,0):this.rotationMat.rotation(0,0,a);for(var g=0;h>g;++g)l=_*h+g,l*=e.vertexAttLength,u.x=e.vertexArray[l+0],u.y=e.vertexArray[l+1],u.z=e.vertexArray[l+2],this.rotationMat.transformVector4(u,u),e.vertexArray[l+0]=u.x,e.vertexArray[l+1]=u.y,e.vertexArray[l+2]=u.z}},i.prototype.afterBuild=function(){this._rotations.dispose(),this._rotations=null},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._animationState=null,this._node=null,this._rotations=null},i}(t.AnimationNode);t.ParticleRotation=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleScale"}return __extends(i,e),i.prototype.initNode=function(e){var i=this._node=e;this._scaleValue=new t.ConstRandomValueShape,this._scaleValue.max=i.max,this._scaleValue.min=i.min},i.prototype.build=function(e,i){this._animationState=this.state;for(var r,a,n=this._scaleValue.calculate(i),o=e.vertexCount/i,s=0,h=0,l=this._animationState.emitter.data.life.duration,u=this._animationState.emitter.timeNode.offsetIndex,c=0,d=0,p=0;i>p;++p){if(this._node.type==t.ParticleValueType.OneBezier||this._node.type==t.ParticleValueType.TwoBezier){if(r=c*e.vertexAttLength+u,a=e.vertexArray[r+0],h=a/l,h-=Math.floor(h),d=this._node.bezier1.calc(h),this._node.type==t.ParticleValueType.TwoBezier){var f=Math.random();d*=f,d+=this._node.bezier2.calc(h)*(1-f)}}else d=n[p];for(var _=0;o>_;++_)s=p*o+_,s*=e.vertexAttLength,e.vertexArray[s+0]*=d,e.vertexArray[s+1]*=d,e.vertexArray[s+2]*=d}},i.prototype.afterBuild=function(){this._scaleValue.dispose(),this._scaleValue=null},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._animationState=null,this._node=null,this._scaleValue=null},i}(t.AnimationNode);t.ParticleScale=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.bornTime=0,this.life=0,this.id=0,this.timeIndex=0,this.name="ParticleStartColor"}return __extends(i,e),i.prototype.initNode=function(t){this._node=t},i.prototype.build=function(e,i){this.particleAnimationState=this.state;for(var r=3,a=e.vertexCount/i,n=0,o=this.particleAnimationState.emitter.timeNode.offsetIndex,s=0,h=new t.Color,l=new t.Color,u=0,c=this.particleAnimationState.emitter.data.life.duration,d=0;i>d;++d){s=d*a,this.timeIndex=s*e.vertexAttLength+o,this.bornTime=e.vertexArray[this.timeIndex+0],u=this.bornTime/c,u-=Math.floor(u),this.lerpBirthColor(h,l,u),h.a/=256,h.r/=256,h.g/=256,h.b/=256;for(var p=0;a>p;++p)n=d*a+p,n=n*e.vertexAttLength+r,e.vertexArray[n+0]=h.r,e.vertexArray[n+1]=h.g,e.vertexArray[n+2]=h.b,e.vertexArray[n+3]=h.a}},i.prototype.lerpBirthColor=function(e,i,r){this._node.colorType==t.ParticleBirthColorType.Const?e.copyFrom(this._node.colorConst1):this._node.colorType==t.ParticleBirthColorType.RandomConst?e.randomColor(this._node.colorConst1,this._node.colorConst2,!0):this._node.colorType==t.ParticleBirthColorType.OneGradients?this._node.colorGradients1.lerpColor(r,e):this._node.colorType==t.ParticleBirthColorType.TwoGradients&&(this._node.colorGradients1.lerpColor(r,e),this._node.colorGradients2.lerpColor(r,i),e.lerp(e,i,.5))},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._node=null},i}(t.AnimationNode);t.ParticleStartColor=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this._count=0,this._followRotation=!1,this._followScale=!1,this.bornTime=0,this.life=0,this.id=0,this.timeIndex=0,this.geometryDirty=!1,this.name="ParticleFollowNode",this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_follow_vs"),this.attribute_followPosition=new t.GLSL.VarRegister,this.attribute_followPosition.name="attribute_followPosition",this.attribute_followPosition.size=3,this.attributes.push(this.attribute_followPosition),this.attribute_followRotation=new t.GLSL.VarRegister,this.attribute_followRotation.name="attribute_followRotation",this.attribute_followRotation.size=4,this.attributes.push(this.attribute_followRotation),this.attribute_followScale=new t.GLSL.VarRegister,this.attribute_followScale.name="attribute_followScale",this.attribute_followScale.size=3,this.attributes.push(this.attribute_followScale)}return __extends(i,e),i.prototype.initNode=function(t){var e=t;this._followScale=e.followScale,this._followRotation=e.followRotation},i.prototype.build=function(t,e){this._count=e,this._animationState=this.state,this._lifeCircles=[];for(var i=0;i<this._count;i++)this._lifeCircles[i]=-1},i.prototype.update=function(t,e,i){this.geometryDirty=this.geometryDirty;var r=this._animationState.emitter.data,a=r.life.loop,n=this._animationState.loopTime+r.life.duration+r.life.delay;if(a||!(.001*t>=n)){for(var o=0,s=i.vertexCount/this._count,h=0,l=!1,u=this._animationState.emitter.timeNode.offsetIndex,c=.001*t-r.life.delay,d=i.sharedVertexBuffer?i.sharedVertexBuffer.arrayBuffer:i.vertexArray,p=this._animationState.followTarget||this._animationState.emitter,f=0;f<this._count;++f){h=f*s,this.timeIndex=h*i.vertexAttLength+u,this.bornTime=d[this.timeIndex+0],this.life=d[this.timeIndex+1];var _=-1;if(c>=this.bornTime){if(c>this.bornTime+this.life&&!a)continue;if(_=Math.floor((c-this.bornTime)/this._animationState.loopTime),_!=this._lifeCircles[f]){this._lifeCircles[f]=_,l=!0;for(var m=0;s>m;++m)o=h+m,o=o*i.vertexAttLength+this.attribute_followPosition.offsetIndex,d[o+0]=p.globalPosition.x,d[o+1]=p.globalPosition.y,d[o+2]=p.globalPosition.z,o=h+m,o=o*i.vertexAttLength+this.attribute_followRotation.offsetIndex,this._followRotation?(d[o+0]=p.globalOrientation.x,d[o+1]=p.globalOrientation.y,d[o+2]=p.globalOrientation.z,d[o+3]=p.globalOrientation.w):(d[o+0]=0,d[o+1]=0,d[o+2]=0,d[o+3]=0),o=h+m,o=o*i.vertexAttLength+this.attribute_followScale.offsetIndex,this._followScale?(d[o+0]=p.globalScaleX,d[o+1]=p.globalScaleY,d[o+2]=p.globalScaleZ):(d[o+0]=0,d[o+1]=0,d[o+2]=0)}}}this.geometryDirty=l}},i.prototype.activeState=function(t,e,i,r,a,n,o){this.geometryDirty&&(n.geometry.upload(o),this.geometryDirty=!1)},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._animationState=null,this._lifeCircles=null},i}(t.AnimationNode);t.ParticleFollowNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleVelocityNode",this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocity"),this.attribute_velocity=new t.GLSL.VarRegister,this.attribute_velocity.name="attribute_velocity",this.attribute_velocity.size=3,this.attributes.push(this.attribute_velocity)}return __extends(i,e),i.prototype.initNode=function(e){var i=this._node=e;(i.type==t.ParticleValueType.Const||i.type==t.ParticleValueType.RandomConst)&&(this._constValue=new t.ConstRandomValueShape,this._constValue.max=i.max,this._constValue.min=i.min)},i.prototype.build=function(e,i){this._animationState=this.state;var r,a=e.vertexCount/i,n=0;this._constValue&&(r=this._constValue.calculate(i));for(var o,s,h,l=this._animationState.directionArray,u=new t.Vector3D,c=0,d=this._animationState.emitter.data.life.duration,p=this._animationState.emitter.timeNode.offsetIndex,f=0,_=0;i>_;++_){if(f=_*a,this._node.type==t.ParticleValueType.OneBezier||this._node.type==t.ParticleValueType.TwoBezier){if(o=f*e.vertexAttLength+p,s=e.vertexArray[o+0],c=s/d,c-=Math.floor(c),h=this._node.bezier1.calc(c),this._node.type==t.ParticleValueType.TwoBezier){var m=Math.random();h*=m,h+=this._node.bezier2.calc(c)*(1-m)}}else h=r[_];u.copyFrom(l[_]),u.scaleBy(h);for(var g=0;a>g;++g)n=_*a+g,n=n*e.vertexAttLength+this.attribute_velocity.offsetIndex,e.vertexArray[n+0]=u.x,e.vertexArray[n+1]=u.y,e.vertexArray[n+2]=u.z}},i.prototype.afterBuild=function(){this._constValue&&this._constValue.dispose(),this._constValue=null},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._constValue=null,this._animationState=null,this._node=null},i}(t.AnimationNode);t.ParticleVelocityNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this._colorSegment=new Float32Array(2*i.MaxColor),this.name="ParticleColorGlobalNode",this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_color_vs"),this.fragment_ShaderName[t.ShaderPhaseType.multi_end_fragment]=this.fragment_ShaderName[t.ShaderPhaseType.multi_end_fragment]||[],this.fragment_ShaderName[t.ShaderPhaseType.multi_end_fragment].push("particle_color_fs")}return __extends(i,e),i.prototype.initNode=function(t){var e=t,r=i.MaxColor,a=e.data;a.colors.length=a.times.length=r;for(var n,o=0;r>o;o++)n=a.colors[o],n?(this._colorSegment[o]=this.getGpuColor(n.r,n.g,n.b),this._colorSegment[o+r]=this.getTimeAndAlpha(a.times[o],n.a)):(this._colorSegment[o]=0,this._colorSegment[o+r]=0)},i.prototype.build=function(){},i.prototype.activeState=function(t,e,i,r,a,n,o){a.uniform_colorTransform&&o.uniform1fv(a.uniform_colorTransform.uniformIndex,this._colorSegment)},i.prototype.getGpuColor=function(t,e,i){var r;return t=this.normalizeChannel(t),e=this.normalizeChannel(e),i=this.normalizeChannel(i),r=256*t+e+i/256},i.prototype.normalizeChannel=function(t){return t>255?t=255:0>t&&(t=0),t=Math.floor(t)},i.prototype.normalizeTime=function(t){return t>=1?t=.9999:0>t&&(t=0),t},i.prototype.getTimeAndAlpha=function(t,e){return e=this.normalizeChannel(e),t=this.normalizeTime(t),e+t},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._colorSegment=null},i.MaxColor=20,i}(t.AnimationNode);t.ParticleColorGlobalNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleSizeGlobalNode",this.vertex_ShaderName[t.ShaderPhaseType.local_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.local_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.local_vertex].push("particle_size_vs")}return __extends(i,e),i.prototype.initNode=function(t){this._node=t,this._floatCompressData=this._node.data.sampler()},i.prototype.build=function(){},i.prototype.activeState=function(t,e,i,r,a,n,o){o.uniform1fv(a.uniform_bezierSize.uniformIndex,this._floatCompressData)
},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._floatCompressData=null,this._node=null},i}(t.AnimationNode);t.ParticleSizeGlobalNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleVelocityOverConstNode",this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityOverConst"),this.attribute_velocityOver=new t.GLSL.VarRegister,this.attribute_velocityOver.name="attribute_velocityOverConst",this.attribute_velocityOver.size=3,this.attributes.push(this.attribute_velocityOver)}return __extends(i,e),i.prototype.initNode=function(e){var i=e;this._overValue=new t.Vec3ConstRandomValueShape,this._overValue.maxX=i.velocityOver.max.x,this._overValue.maxY=i.velocityOver.max.y,this._overValue.maxZ=i.velocityOver.max.z,this._overValue.minX=i.velocityOver.min.x,this._overValue.minY=i.velocityOver.min.y,this._overValue.minZ=i.velocityOver.min.z},i.prototype.build=function(t,e){this._animationState=this.state;for(var i=t.vertexCount/e,r=0,a=this._overValue.calculate(e),n=0;e>n;++n)for(var o=a[n],s=0;i>s;++s)r=n*i+s,r=r*t.vertexAttLength+this.attribute_velocityOver.offsetIndex,t.vertexArray[r+0]=o.x,t.vertexArray[r+1]=o.y,t.vertexArray[r+2]=o.z},i.prototype.afterBuild=function(){this._overValue.dispose(),this._overValue=null},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._overValue=null,this._animationState=null},i}(t.AnimationNode);t.ParticleVelocityOverConstNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleVelocityOverOneBezierNode"}return __extends(i,e),i.prototype.initNode=function(e){this._node=e,this._floatCompressDataX=this._node.velocityOver.xBezier1.trySampler(),this._floatCompressDataY=this._node.velocityOver.yBezier1.trySampler(),this._floatCompressDataZ=this._node.velocityOver.zBezier1.trySampler(),this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityOverOneBezier"),this._floatCompressDataX&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityOverOneBezierX"),this._floatCompressDataY&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityOverOneBezierY"),this._floatCompressDataZ&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityOverOneBezierZ")},i.prototype.build=function(){},i.prototype.activeState=function(t,e,i,r,a,n,o){this._floatCompressDataX&&o.uniform1fv(a.uniform_velocityOverX.uniformIndex,this._floatCompressDataX),this._floatCompressDataY&&o.uniform1fv(a.uniform_velocityOverY.uniformIndex,this._floatCompressDataY),this._floatCompressDataZ&&o.uniform1fv(a.uniform_velocityOverZ.uniformIndex,this._floatCompressDataZ)},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._floatCompressDataX=this._floatCompressDataY=this._floatCompressDataZ=null,this._node=null},i}(t.AnimationNode);t.ParticleVelocityOverOneBezierNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleVelocityOverTwoBezierNode",this.attribute_randomSeed=new t.GLSL.VarRegister,this.attribute_randomSeed.name="attribute_velocityOverRandomSeed",this.attribute_randomSeed.size=1,this.attributes.push(this.attribute_randomSeed)}return __extends(i,e),i.prototype.initNode=function(e){this._node=e,this._floatCompressDataX1=this._node.velocityOver.xBezier1.trySampler(),this._floatCompressDataY1=this._node.velocityOver.yBezier1.trySampler(),this._floatCompressDataZ1=this._node.velocityOver.zBezier1.trySampler(),this._floatCompressDataX2=this._node.velocityOver.xBezier2.trySampler(),this._floatCompressDataY2=this._node.velocityOver.yBezier2.trySampler(),this._floatCompressDataZ2=this._node.velocityOver.zBezier2.trySampler(),this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityOverTwoBezier"),this._floatCompressDataX1&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityOverTwoBezierX1"),this._floatCompressDataX2&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityOverTwoBezierX2"),this._floatCompressDataY1&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityOverTwoBezierY1"),this._floatCompressDataY2&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityOverTwoBezierY2"),this._floatCompressDataZ1&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityOverTwoBezierZ1"),this._floatCompressDataZ2&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityOverTwoBezierZ2")},i.prototype.build=function(t,e){this._animationState=this.state;for(var i=t.vertexCount/e,r=0,a=0;e>a;++a)for(var n=Math.random(),o=0;i>o;++o)r=a*i+o,r=r*t.vertexAttLength+this.attribute_randomSeed.offsetIndex,t.vertexArray[r+0]=n},i.prototype.activeState=function(t,e,i,r,a,n,o){this._floatCompressDataX1&&o.uniform1fv(a.uniform_velocityOverX1.uniformIndex,this._floatCompressDataX1),this._floatCompressDataX2&&o.uniform1fv(a.uniform_velocityOverX2.uniformIndex,this._floatCompressDataX2),this._floatCompressDataY1&&o.uniform1fv(a.uniform_velocityOverY1.uniformIndex,this._floatCompressDataY1),this._floatCompressDataY2&&o.uniform1fv(a.uniform_velocityOverY2.uniformIndex,this._floatCompressDataY2),this._floatCompressDataZ1&&o.uniform1fv(a.uniform_velocityOverZ1.uniformIndex,this._floatCompressDataZ1),this._floatCompressDataZ2&&o.uniform1fv(a.uniform_velocityOverZ2.uniformIndex,this._floatCompressDataZ2)},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._floatCompressDataX1=this._floatCompressDataY1=this._floatCompressDataZ1=null,this._floatCompressDataX2=this._floatCompressDataY2=this._floatCompressDataZ2=null,this._node=null,this._animationState=null},i}(t.AnimationNode);t.ParticleVelocityOverTwoBezierNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleVelocityForceConstNode",this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityForceConst"),this.attribute_accelerationSpeed=new t.GLSL.VarRegister,this.attribute_accelerationSpeed.name="attribute_velocityForceConst",this.attribute_accelerationSpeed.size=3,this.attributes.push(this.attribute_accelerationSpeed)}return __extends(i,e),i.prototype.initNode=function(e){this._node=e;var i=this._node.velocityForce;this._forceValue=new t.Vec3ConstRandomValueShape,this._forceValue.maxX=i.max.x,this._forceValue.maxY=i.max.y,this._forceValue.maxZ=i.max.z,this._forceValue.minX=i.min.x,this._forceValue.minY=i.min.y,this._forceValue.minZ=i.min.z},i.prototype.build=function(t,e){for(var i=t.vertexCount/e,r=0,a=this._forceValue.calculate(e),n=0;e>n;++n)for(var o=a[n],s=0;i>s;++s)r=n*i+s,r=r*t.vertexAttLength+this.attribute_accelerationSpeed.offsetIndex,t.vertexArray[r+0]=o.x,t.vertexArray[r+1]=o.y,t.vertexArray[r+2]=o.z},i.prototype.afterBuild=function(){this._forceValue.dispose(),this._forceValue=null},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._forceValue=null,this._node=null},i}(t.AnimationNode);t.ParticleVelocityForceConstNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleVelocityForceOneBezierNode"}return __extends(i,e),i.prototype.initNode=function(e){this._node=e,this._floatCompressDataX=this._node.velocityForce.xBezier1.trySampler(),this._floatCompressDataY=this._node.velocityForce.yBezier1.trySampler(),this._floatCompressDataZ=this._node.velocityForce.zBezier1.trySampler(),this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityForceOneBezier"),this._floatCompressDataX&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityForceOneBezierX"),this._floatCompressDataY&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityForceOneBezierY"),this._floatCompressDataZ&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityForceOneBezierZ")},i.prototype.build=function(){},i.prototype.activeState=function(t,e,i,r,a,n,o){this._floatCompressDataX&&o.uniform1fv(a.uniform_velocityForceX.uniformIndex,this._floatCompressDataX),this._floatCompressDataY&&o.uniform1fv(a.uniform_velocityForceY.uniformIndex,this._floatCompressDataY),this._floatCompressDataZ&&o.uniform1fv(a.uniform_velocityForceZ.uniformIndex,this._floatCompressDataZ)},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._floatCompressDataX=this._floatCompressDataY=this._floatCompressDataZ=null,this._node=null},i}(t.AnimationNode);t.ParticleVelocityForceOneBezierNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleVelocityForceTwoBezierNode",this.attribute_randomSeed=new t.GLSL.VarRegister,this.attribute_randomSeed.name="attribute_velocityForceRandomSeed",this.attribute_randomSeed.size=1,this.attributes.push(this.attribute_randomSeed)}return __extends(i,e),i.prototype.initNode=function(e){this._node=e,this._floatCompressDataX1=this._node.velocityForce.xBezier1.trySampler(),this._floatCompressDataY1=this._node.velocityForce.yBezier1.trySampler(),this._floatCompressDataZ1=this._node.velocityForce.zBezier1.trySampler(),this._floatCompressDataX2=this._node.velocityForce.xBezier2.trySampler(),this._floatCompressDataY2=this._node.velocityForce.yBezier2.trySampler(),this._floatCompressDataZ2=this._node.velocityForce.zBezier2.trySampler(),this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityForceTwoBezier"),this._floatCompressDataX1&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityForceTwoBezierX1"),this._floatCompressDataX2&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityForceTwoBezierX2"),this._floatCompressDataY1&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityForceTwoBezierY1"),this._floatCompressDataY2&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityForceTwoBezierY2"),this._floatCompressDataZ1&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityForceTwoBezierZ1"),this._floatCompressDataZ2&&this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityForceTwoBezierZ2")},i.prototype.build=function(t,e){this._animationState=this.state;for(var i=t.vertexCount/e,r=0,a=0;e>a;++a)for(var n=Math.random(),o=0;i>o;++o)r=a*i+o,r=r*t.vertexAttLength+this.attribute_randomSeed.offsetIndex,t.vertexArray[r+0]=n},i.prototype.activeState=function(t,e,i,r,a,n,o){this._floatCompressDataX1&&o.uniform1fv(a.uniform_velocityForceX1.uniformIndex,this._floatCompressDataX1),this._floatCompressDataX2&&o.uniform1fv(a.uniform_velocityForceX2.uniformIndex,this._floatCompressDataX2),this._floatCompressDataY1&&o.uniform1fv(a.uniform_velocityForceY1.uniformIndex,this._floatCompressDataY1),this._floatCompressDataY2&&o.uniform1fv(a.uniform_velocityForceY2.uniformIndex,this._floatCompressDataY2),this._floatCompressDataZ1&&o.uniform1fv(a.uniform_velocityForceZ1.uniformIndex,this._floatCompressDataZ1),this._floatCompressDataZ2&&o.uniform1fv(a.uniform_velocityForceZ2.uniformIndex,this._floatCompressDataZ2)},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._floatCompressDataX1=this._floatCompressDataY1=this._floatCompressDataZ1=null,this._floatCompressDataX2=this._floatCompressDataY2=this._floatCompressDataZ2=null,this._node=null,this._animationState=null},i}(t.AnimationNode);t.ParticleVelocityForceTwoBezierNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleVelocityLimitConstNode",this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityLimitConst"),this.attribute_velocityLimit=new t.GLSL.VarRegister,this.attribute_velocityLimit.name="attribute_velocityLimit",this.attribute_velocityLimit.size=1,this.attributes.push(this.attribute_velocityLimit)}return __extends(i,e),i.prototype.initNode=function(e){var i=e;this._limitValue=new t.ConstRandomValueShape,this._limitValue.max=i.velocityLimit.max,this._limitValue.min=i.velocityLimit.min},i.prototype.build=function(t,e){this._animationState=this.state;for(var i=t.vertexCount/e,r=0,a=this._limitValue.calculate(e),n=0;e>n;++n)for(var o=a[n],s=0;i>s;++s)r=n*i+s,r=r*t.vertexAttLength+this.attribute_velocityLimit.offsetIndex,t.vertexArray[r+0]=o},i.prototype.afterBuild=function(){this._limitValue.dispose(),this._limitValue=null},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._animationState=null,this._limitValue=null},i}(t.AnimationNode);t.ParticleVelocityLimitConstNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleVelocityLimitOneBezierNode",this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityLimitOneBezier")}return __extends(i,e),i.prototype.initNode=function(t){this._node=t,this._floatCompressData=this._node.velocityLimit.bezier1.sampler()},i.prototype.build=function(){},i.prototype.activeState=function(t,e,i,r,a,n,o){o.uniform1fv(a.uniform_velocityLimit.uniformIndex,this._floatCompressData)},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._floatCompressData=null,this._node=null},i}(t.AnimationNode);t.ParticleVelocityLimitOneBezierNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleVelocityLimitTwoBezierNode",this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_velocityLimitTwoBezier"),this.attribute_randomSeed=new t.GLSL.VarRegister,this.attribute_randomSeed.name="attribute_velocityLimitRandomSeed",this.attribute_randomSeed.size=1,this.attributes.push(this.attribute_randomSeed)}return __extends(i,e),i.prototype.initNode=function(t){this._node=t,this._floatCompressData=this._node.velocityLimit.bezier1.sampler(),this._floatCompressData2=this._node.velocityLimit.bezier2.sampler()},i.prototype.build=function(t,e){this._animationState=this.state;for(var i=t.vertexCount/e,r=0,a=0;e>a;++a)for(var n=Math.random(),o=0;i>o;++o)r=a*i+o,r=r*t.vertexAttLength+this.attribute_randomSeed.offsetIndex,t.vertexArray[r+0]=n},i.prototype.activeState=function(t,e,i,r,a,n,o){o.uniform1fv(a.uniform_velocityLimit.uniformIndex,this._floatCompressData),o.uniform1fv(a.uniform_velocityLimit2.uniformIndex,this._floatCompressData2)},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._floatCompressData=null,this._floatCompressData2=null,this._animationState=null,this._node=null},i}(t.AnimationNode);t.ParticleVelocityLimitTwoBezierNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleRotationConstNode",this.vertex_ShaderName[t.ShaderPhaseType.local_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.local_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.local_vertex].push("particle_rotationConst"),this.attribute_Rotation=new t.GLSL.VarRegister,this.attribute_Rotation.name="attribute_rotationZ",this.attribute_Rotation.size=1,this.attributes.push(this.attribute_Rotation)}return __extends(i,e),i.prototype.initNode=function(e){var i=e;this._rotation=new t.ConstRandomValueShape,this._rotation.max=i.max.z,this._rotation.min=i.min.z},i.prototype.build=function(t,e){for(var i=0,r=t.vertexCount/e,a=this._rotation.calculate(e),n=0;e>n;++n)for(var o=a[n],s=0;r>s;++s)i=n*r+s,i=i*t.vertexAttLength+this.attribute_Rotation.offsetIndex,t.vertexArray[i+0]=o},i.prototype.afterBuild=function(){this._rotation.dispose(),this._rotation=null},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._rotation=null},i}(t.AnimationNode);t.ParticleRotationConstNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleRotationOneBezierNode",this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_rotationOneBezier")}return __extends(i,e),i.prototype.initNode=function(t){this._node=t,this._floatCompressData=this._node.bezier1.sampler()},i.prototype.build=function(){},i.prototype.activeState=function(t,e,i,r,a,n,o){o.uniform1fv(a.uniform_rotationBezier.uniformIndex,this._floatCompressData)},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._floatCompressData=null,this._node=null},i}(t.AnimationNode);t.ParticleRotationOneBezierNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.name="ParticleRotationTwoBezierNode",this.attribute_randomSeed=new t.GLSL.VarRegister,this.attribute_randomSeed.name="attribute_rotationRandomSeed",this.attribute_randomSeed.size=1,this.attributes.push(this.attribute_randomSeed)}return __extends(i,e),i.prototype.initNode=function(e){this._node=e,this._floatCompressData=this._node.bezier1.sampler(),this._floatCompressData2=this._node.bezier2.sampler(),this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.global_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.global_vertex].push("particle_rotationTwoBezier")},i.prototype.build=function(t,e){this._animationState=this.state;for(var i=t.vertexCount/e,r=0,a=0;e>a;++a)for(var n=Math.random(),o=0;i>o;++o)r=a*i+o,r=r*t.vertexAttLength+this.attribute_randomSeed.offsetIndex,t.vertexArray[r+0]=n},i.prototype.activeState=function(t,e,i,r,a,n,o){o.uniform1fv(a.uniform_rotationBezier.uniformIndex,this._floatCompressData),o.uniform1fv(a.uniform_rotationBezier2.uniformIndex,this._floatCompressData2)},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._floatCompressData=null,this._floatCompressData2=null,this._animationState=null,this._node=null},i}(t.AnimationNode);t.ParticleRotationTwoBezierNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this._sheetFloatData=new Float32Array(5),this.name="ParticleTextureSheetNode",this.attribute_textureSheetData=new t.GLSL.VarRegister,this.attribute_textureSheetData.name="attribute_textureSheetData",this.attribute_textureSheetData.size=3,this.attributes.push(this.attribute_textureSheetData),this.vertex_ShaderName[t.ShaderPhaseType.local_vertex]=this.vertex_ShaderName[t.ShaderPhaseType.local_vertex]||[],this.vertex_ShaderName[t.ShaderPhaseType.local_vertex].push("particle_textureSheet_vs")}return __extends(i,e),i.prototype.initNode=function(e,i){this._sheetData=i,this._sheetFloatData[0]=this._sheetData.tileX,this._sheetFloatData[1]=this._sheetData.tileY,this._sheetFloatData[2]=this._sheetData.circles,this._sheetData.whole?(this._sheetFloatData[3]=0,this._sheetFloatData[4]=this._sheetData.tileX*this._sheetData.tileY-1):(this._sheetFloatData[3]=0,this._sheetFloatData[4]=this._sheetData.tileY-1),this._sheetData.frameType==t.ParticleValueType.Const||this._sheetData.frameType==t.ParticleValueType.RandomConst?(this.fragment_ShaderName[t.ShaderPhaseType.start_fragment]=this.fragment_ShaderName[t.ShaderPhaseType.start_fragment]||[],this.fragment_ShaderName[t.ShaderPhaseType.start_fragment].push("particle_textureSheetConst")):this._sheetData.frameType==t.ParticleValueType.OneBezier?(this.fragment_ShaderName[t.ShaderPhaseType.start_fragment]=this.fragment_ShaderName[t.ShaderPhaseType.start_fragment]||[],this.fragment_ShaderName[t.ShaderPhaseType.start_fragment].push("particle_bezier"),this.fragment_ShaderName[t.ShaderPhaseType.start_fragment].push("particle_textureSheetOneBezier"),this._floatCompressData1=this._sheetData.bezier1.sampler()):this._sheetData.frameType==t.ParticleValueType.TwoBezier&&(this.fragment_ShaderName[t.ShaderPhaseType.start_fragment]=this.fragment_ShaderName[t.ShaderPhaseType.start_fragment]||[],this.fragment_ShaderName[t.ShaderPhaseType.start_fragment].push("particle_bezier"),this.fragment_ShaderName[t.ShaderPhaseType.start_fragment].push("particle_textureSheetTwoBezier"),this._floatCompressData1=this._sheetData.bezier1.sampler(),this._floatCompressData2=this._sheetData.bezier2.sampler())},i.prototype.build=function(e,i){for(var r=0,a=0,n=0,o=0,s=e.vertexCount/i,h=0;i>h;++h){r=this._sheetData.whole?0:this._sheetData.randomRow?Math.floor(this._sheetData.tileY*Math.random())*this._sheetData.tileX:this._sheetData.row*this._sheetData.tileX,this._sheetData.frameType==t.ParticleValueType.Const||this._sheetData.frameType==t.ParticleValueType.RandomConst?(a=(this._sheetData.max-this._sheetData.min)*Math.random()+this._sheetData.min,a=Math.floor(a)):a=0,n=this._sheetData.frameType==t.ParticleValueType.TwoBezier?Math.random():1;for(var l=0;s>l;++l)o=h*s+l,o=o*e.vertexAttLength+this.attribute_textureSheetData.offsetIndex,e.vertexArray[o+0]=r+.001,e.vertexArray[o+1]=a,e.vertexArray[o+2]=n}},i.prototype.activeState=function(e,i,r,a,n,o,s){s.uniform1fv(n.uniform_textureSheet.uniformIndex,this._sheetFloatData),this._sheetData.frameType==t.ParticleValueType.OneBezier?s.uniform1fv(n.uniform_frameBezier.uniformIndex,this._floatCompressData1):this._sheetData.frameType==t.ParticleValueType.TwoBezier&&(s.uniform1fv(n.uniform_frameBezier1.uniformIndex,this._floatCompressData1),s.uniform1fv(n.uniform_frameBezier2.uniformIndex,this._floatCompressData2))},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._animationState=null,this._floatCompressData1=this._floatCompressData2=null,this._sheetData=null,this._sheetFloatData=null},i}(t.AnimationNode);t.ParticleTextureSheetNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this._uvRollData=new Float32Array(2),this.name="ParticleUVRollNode",this.fragment_ShaderName[t.ShaderPhaseType.start_fragment]=this.fragment_ShaderName[t.ShaderPhaseType.start_fragment]||[],this.fragment_ShaderName[t.ShaderPhaseType.start_fragment].push("particle_uv_roll_fs")}return __extends(i,e),i.prototype.initNode=function(t,e){this._methodData=e,this._uvRollData[0]=this._methodData.uSpeed,this._uvRollData[1]=this._methodData.vSpeed},i.prototype.build=function(){},i.prototype.activeState=function(t,e,i,r,a,n,o){o.uniform1fv(a.uniform_particleUVRoll.uniformIndex,this._uvRollData)},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._animationState=null,this._methodData=null,this._uvRollData=null},i}(t.AnimationNode);t.ParticleUVRollNode=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function r(){e.call(this),this._empty=!0,this.bornTime=0,this.life=0,this.id=0,this.timeIndex=0,this.count=0,this.position=new t.Vector3D,this._added=!1,this._orientation=new t.Quaternion,this._birthPhase=new i(t.ParticleDataSubEmitterPhase.BIRTH),this._collisionPhase=new i(t.ParticleDataSubEmitterPhase.COLLISION),this._deathPhase=new i(t.ParticleDataSubEmitterPhase.DEATH),this.name="ParticleSubEmitterNode"}return __extends(r,e),r.prototype.initNode=function(t,e){void 0===e&&(e=null),this._parent=e},r.prototype.importSubEmitter=function(e,i){var r;e==t.ParticleDataSubEmitterPhase.BIRTH?r=this._birthPhase:e==t.ParticleDataSubEmitterPhase.COLLISION?r=this._collisionPhase:e==t.ParticleDataSubEmitterPhase.DEATH&&(r=this._deathPhase),r&&(this._empty=!1,r.importSubEmitter(i))},r.prototype.getSubEmitters=function(e){return e==t.ParticleDataSubEmitterPhase.BIRTH?this._birthPhase.playing.getKeys():e==t.ParticleDataSubEmitterPhase.COLLISION?this._collisionPhase.playing.getKeys():e==t.ParticleDataSubEmitterPhase.DEATH?this._deathPhase.playing.getKeys():null},r.prototype.build=function(t,e){this.count=e,this._animationState=this.state,this._lifeCircles=[];for(var i=0;i<this.count;i++)this._lifeCircles[i]=-1},r.prototype.update=function(t,e,i){if(!this._empty){this.recycleParticle(),this.ignoreEmit=e>25;var r=this._animationState.emitter.data,a=r.life.loop,n=this._animationState.loopTime+r.life.duration+r.life.delay;if(a||!(.001*t>=n))for(var o=0,s=i.vertexCount/this.count,h=0,l=this._animationState.emitter.positionNode.offsetIndex,u=this._animationState.emitter.timeNode.offsetIndex,c=.001*t-r.life.delay,d=i.sharedVertexBuffer?i.sharedVertexBuffer.arrayBuffer:i.vertexArray,p=(this._animationState.followTarget||this._animationState.emitter,0);p<this.count;++p){h=p*s,this.timeIndex=h*i.vertexAttLength+u,this.bornTime=d[this.timeIndex+0],this.life=d[this.timeIndex+1];var f=-1;if(c>=this.bornTime){if(c>this.bornTime+this.life&&!a)continue;if(f=Math.floor((c-this.bornTime)/this._animationState.loopTime),f!=this._lifeCircles[p]){if(this._lifeCircles[p]=f,this.ignoreEmit)continue;o=h*i.vertexAttLength+l,this.position.x=d[o+0],this.position.y=d[o+1],this.position.z=d[o+2],this.emitParticleAtPhase(this._birthPhase,this.position)}}}}},r.prototype.emitParticleAtPhase=function(e,i){var r,a,n,o,s=e.playing.getKeys();this._orientation.copyFrom(this._parent.orientation),this._orientation.w*=-1;for(var h=0,l=s.length;l>h;h++)r=s[h],n=e.recycle.getValueByKey(r),a=e.playing.getValueByKey(r),o=n.shift(),null==o&&(o=new t.ParticleEmitter(r.data,r.material)),a.push(o),o.play(),o.position=i,o.orientation=this._orientation,this._parent.addChild(o)},r.prototype.recycleParticle=function(){this.recycleParticleAtPhase(this._birthPhase),this.recycleParticleAtPhase(this._collisionPhase),this.recycleParticleAtPhase(this._deathPhase)},r.prototype.recycleParticleAtPhase=function(t){for(var e,i,r,a,n,o=t.playing.getKeys(),s=0,h=o.length;h>s;s++)for(e=o[s],i=t.playing.getValueByKey(e),r=t.recycle.getValueByKey(e),n=i.length-1;n>=0;n--)a=i[n],a.loopProgress>1&&(i.splice(n,1),a.stop(),this._parent.removeChild(a),r.push(a))},r.prototype.activeState=function(){},r.prototype.dispose=function(){e.prototype.dispose.call(this),this._animationState=null,this._birthPhase&&this._birthPhase.dispose(),this._birthPhase=null,this._collisionPhase&&this._collisionPhase.dispose(),this._collisionPhase=null,this._deathPhase&&this._deathPhase.dispose(),this._deathPhase=null,this._lifeCircles=null,this._orientation=null,this._parent=null},r}(t.AnimationNode);t.ParticleSubEmitterNode=e;var i=function(){function e(e){this.playing=new t.DoubleArray,this.recycle=new t.DoubleArray,this._phase=e}return e.prototype.importSubEmitter=function(t){this.playing.getKeys().indexOf(t)>=0||(this.playing.put(t,[]),this.recycle.put(t,[]))},e.prototype.dispose=function(){for(var t,e=0,i=this.playing.getValues();e<i.length;e++)t=i[e],t.dispose();for(var r=0,a=this.recycle.getValues();r<a.length;r++)t=a[r],t.dispose();this.playing.clear(),this.recycle.clear(),this.playing=this.recycle=null},e}();t.ParticleSubEmitterNodePhase=i}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(t,e){this.numberOfVertices=0,this.vertexSizeInBytes=0,this.vertex_shaders={},this.fragment_shaders={},this.loopTime=0,this.circleTime=0,this.reverse=1,this.followTarget=null,this._particleProperty=new Float32Array(24),this._particleFsData=new Float32Array(3),this._emitter=e,this.name=t,this.animNodes=[],this.keyFrames=[]}return Object.defineProperty(t.prototype,"emitter",{get:function(){return this._emitter},enumerable:!0,configurable:!0}),t.prototype.addNode=function(t){t.state=this,this.animNodes.push(t)},t.prototype.removeNode=function(t){var e=this.animNodes.indexOf(t);-1!=e&&this.animNodes.splice(e,1)},t.prototype.clean=function(){this.animNodes.length=0},t.prototype.addShaderPhase=function(t,e){var i,r;for(r in t){i=t[r];for(var a=0;a<i.length;a++)e[r]=e[r]||[],e[r].push(i[a])}},t.prototype.calculate=function(t){for(var e=0;e<this.animNodes.length;e++){this.addShaderPhase(this.animNodes[e].vertex_ShaderName,this.vertex_shaders),this.addShaderPhase(this.animNodes[e].fragment_ShaderName,this.fragment_shaders);for(var i=t.vertexAttLength,r=0;r<this.animNodes[e].attributes.length;++r)this.animNodes[e].attributes[r].size>0&&(this.animNodes[e].attributes[r].offsetIndex=i,t.vertexAttLength+=this.animNodes[e].attributes[r].size,t.vertexSizeInBytes+=4*this.animNodes[e].attributes[r].size,t.subGeometrys[0].preAttList.push(this.animNodes[e].attributes[r])),i=t.vertexAttLength}},t.prototype.fill=function(t,e){for(var i=0;i<this.animNodes.length;i++)this.animNodes[i].build(t,e);for(var i=0;i<this.animNodes.length;i++)this.animNodes[i].afterBuild()},t.prototype.update=function(t,e,i){for(var r=0;r<this.animNodes.length;r++)this.animNodes[r].update(t,e,i)},t.prototype.activeState=function(t,e,i,r,a,n,o,s){var h,l,u=this._emitter.data;u.followTarget&&this._emitter.followTarget?(h=this._emitter.followTarget.globalOrientation,l=this._emitter.followTarget.globalPosition):(h=this._emitter.globalOrientation,l=this._emitter.globalPosition),this._particleProperty[0]=.001*e,this._particleProperty[1]=u.life.loop?1:0,this._particleProperty[2]=u.followTarget?1:0,this._particleProperty[3]=1,this._particleProperty[4]=1,this._particleProperty[5]=1,this._particleProperty[6]=h.x,this._particleProperty[7]=h.y,this._particleProperty[8]=h.z,this._particleProperty[9]=h.w,this._particleProperty[10]=l.x,this._particleProperty[11]=l.y,this._particleProperty[12]=l.z,this._particleProperty[13]=this.loopTime,this._particleProperty[14]=u.life.delay,this._particleProperty[15]=u.life.duration,this._particleProperty[16]=u.property.gravity,this._particleProperty[17]=u.moveSpeed.velocityOver&&u.moveSpeed.velocityOver.worldSpace?1:0,this._particleProperty[18]=u.moveSpeed.velocityForce&&u.moveSpeed.velocityForce.worldSpace?1:0,this._particleProperty[19]=u.moveSpeed.velocityLimit?u.moveSpeed.velocityLimit.dampen:0,this._particleProperty[20]=u.property.cameraScale,this._particleProperty[21]=u.property.speedScale,this._particleProperty[22]=u.property.lengthScale,this._particleProperty[23]=u.property.renderMode,o.uniform1fv(a.uniform_particleState.uniformIndex,this._particleProperty),a.uniform_particleFsData&&(this._particleFsData[0]=s.far,this._particleFsData[1]=s.near,this._particleFsData[2]=this._emitter.material.materialData.blendMode,o.uniform1fv(a.uniform_particleFsData.uniformIndex,this._particleFsData));for(var c=0;c<this.animNodes.length;c++)this.animNodes[c].activeState(t,e,i,r,a,n,o)},t.prototype.dispose=function(){for(var t,e=0,i=this.animNodes;e<i.length;e++)t=i[e],t.dispose();this.animNodes.length=0,this.animNodes=null,this.keyFrames.length=0,this.keyFrames=null},t}();t.ParticleAnimationState=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this),this.animTime=0,this.delay=0,this.speed=1,this._play=!1,this.animStates=[],this.particleAnimationState=new t.ParticleAnimationState("particle",i),this.addAnimState(this.particleAnimationState)}return __extends(i,e),i.prototype.update=function(t,e,r){this._play&&(i.Reset&&(this.animTime=0),this.delay=e,this.animTime+=this.delay,this.particleAnimationState&&this.particleAnimationState.update(this.animTime,this.delay,r))},i.prototype.activeState=function(t,e,i,r,a,n,o){this.particleAnimationState&&this.particleAnimationState.activeState(t,this.animTime,e,this.delay,i,r,a,o)
},i.prototype.play=function(t,e,i,r){void 0===e&&(e=1),void 0===i&&(i=!0),void 0===r&&(r=!0),this._play=!0,i&&(this.animTime=0),r&&(this.animTime=this.particleAnimationState.loopTime),this.delay=0},i.prototype.stop=function(){this._play=!1},i.prototype.isPlay=function(){return this._play},i.prototype.addAnimState=function(t){var e=this.animStates.indexOf(t);-1==e&&this.animStates.push(t)},i.prototype.removeAnimState=function(t){var e=this.animStates.indexOf(t);-1!=e&&this.animStates.splice(e,1)},i.prototype.getAnimList=function(){return[]},i.prototype.getAnimNode=function(){return[]},i.prototype.clone=function(){return null},i}(t.EventDispatcher);t.ParticleAnimation=e}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t.Property=0]="Property",t[t.Emission=1]="Emission",t[t.Life=2]="Life",t[t.Shape=3]="Shape",t[t.RotationBirth=4]="RotationBirth",t[t.ScaleBirth=5]="ScaleBirth",t[t.Geometry=6]="Geometry",t[t.MoveSpeed=7]="MoveSpeed",t[t.FollowTarget=8]="FollowTarget",t[t.ScaleBezier=9]="ScaleBezier",t[t.RotationSpeed=10]="RotationSpeed",t[t.ColorOffset=11]="ColorOffset",t[t.TextureSheet=12]="TextureSheet"}(t.ParticleDataNodeType||(t.ParticleDataNodeType={}));var e=t.ParticleDataNodeType;!function(t){t[t.BIRTH=0]="BIRTH",t[t.COLLISION=1]="COLLISION",t[t.DEATH=2]="DEATH"}(t.ParticleDataSubEmitterPhase||(t.ParticleDataSubEmitterPhase={})),t.ParticleDataSubEmitterPhase,!function(t){t[t.Const=0]="Const",t[t.RandomConst=1]="RandomConst",t[t.OneBezier=2]="OneBezier",t[t.TwoBezier=3]="TwoBezier"}(t.ParticleValueType||(t.ParticleValueType={}));var i=t.ParticleValueType;!function(t){t[t.Billboard=0]="Billboard",t[t.StretchedBillboard=1]="StretchedBillboard",t[t.HorizontalBillboard=2]="HorizontalBillboard",t[t.VerticalBillboard=3]="VerticalBillboard",t[t.Mesh=4]="Mesh"}(t.ParticleRenderModeType||(t.ParticleRenderModeType={}));var r=t.ParticleRenderModeType;!function(t){t[t.Const=0]="Const",t[t.RandomConst=1]="RandomConst",t[t.OneGradients=2]="OneGradients",t[t.TwoGradients=3]="TwoGradients"}(t.ParticleBirthColorType||(t.ParticleBirthColorType={}));var a=t.ParticleBirthColorType;!function(t){t[t.Point=0]="Point",t[t.Cube=1]="Cube",t[t.Sphere=2]="Sphere",t[t.HemiSphere=3]="HemiSphere",t[t.Cone=4]="Cone",t[t.Mesh=5]="Mesh"}(t.ParticleDataShapeType||(t.ParticleDataShapeType={}));var n=t.ParticleDataShapeType;!function(t){t[t.Vertex=0]="Vertex",t[t.Triangle=1]="Triangle",t[t.Edge=2]="Edge"}(t.ParticleMeshShapeType||(t.ParticleMeshShapeType={}));var o=t.ParticleMeshShapeType;!function(t){t[t.Base=0]="Base",t[t.BaseShell=1]="BaseShell",t[t.Volume=2]="Volume",t[t.VolumeShell=3]="VolumeShell"}(t.ParticleConeShapeType||(t.ParticleConeShapeType={}));var s=t.ParticleConeShapeType,h=function(){function t(){this.property=new u,this.emission=new c,this.life=new d,this.shape=new p,this.rotationBirth=new f,this.scaleBirth=new _,this.geometry=new m,this.moveSpeed=new g}return t.prototype.validate=function(){this.property.validate(),this.emission.validate(),this.life.validate(),this.shape.validate(),this.rotationBirth.validate(),this.scaleBirth.validate(),this.geometry.validate(),this.moveSpeed.validate(),this.scaleBezier&&this.scaleBezier.validate(),this.rotationSpeed&&this.rotationSpeed.validate(),this.colorOffset&&this.colorOffset.validate(),this.followTarget&&this.followTarget.validate(),this.textureSheet&&this.textureSheet.validate()},t}();t.ParticleData=h;var l=function(){function t(t){this._nodeType=t}return Object.defineProperty(t.prototype,"nodeType",{get:function(){return this._nodeType},enumerable:!0,configurable:!0}),t}();t.ParticleDataNode=l;var u=function(i){function n(){i.call(this,e.Property),this.particleCount=10,this.bounds=new t.Vector3D(10,10,10),this.colorType=a.Const,this.colorConst1=new t.Color(255,255,255,255),this.colorConst2=new t.Color(255,255,255,255),this.gravity=0,this.prewarm=!1,this.rotation=new t.Vector3D(0,0,0,1),this.scale=new t.Vector3D(1,1,1,1),this.position=new t.Vector3D(0,0,0,1),this.sortingFudge=0,this.renderMode=r.Billboard,this.cameraScale=0,this.speedScale=0,this.lengthScale=1}return __extends(n,i),n.prototype.validate=function(){null==this.bounds&&(this.bounds=new t.Vector3D(10,10,10)),this.bounds.x<0&&(this.bounds.x=1),this.bounds.y<0&&(this.bounds.y=1),this.bounds.z<0&&(this.bounds.z=1),this.particleCount<0&&(this.particleCount=10),null==this.colorConst1&&(this.colorConst1=new t.Color(255,255,255,255)),null==this.colorConst2&&(this.colorConst2=new t.Color(255,255,255,255)),(this.colorType==a.OneGradients||this.colorType==a.TwoGradients)&&null==this.colorGradients1&&(this.colorGradients1=new t.ColorGradients),this.colorType==a.TwoGradients&&null==this.colorGradients2&&(this.colorGradients2=new t.ColorGradients),null==this.rotation&&(this.rotation=new t.Vector3D(0,0,0,1)),null==this.scale&&(this.scale=new t.Vector3D(1,1,1,1)),null==this.position&&(this.rotation=new t.Vector3D(0,0,0,1))},n}(l);t.ParticleDataProperty=u;var c=function(r){function a(){r.call(this,e.Emission),this.rate=10,this.type=i.Const,this.bezier=new t.BezierData}return __extends(a,r),a.prototype.validate=function(){this.rate<0&&(this.rate=1e-5),this.type==i.OneBezier&&(null==this.bezier&&(this.bezier=new t.BezierData),this.bezier.validate())},a}(l);t.ParticleDataEmission=c;var d=function(r){function a(){r.call(this,e.Life),this.type=i.Const,this.max=0,this.min=0,this.duration=5,this.delay=0,this.loop=!0}return __extends(a,r),a.prototype.validate=function(){this.max<=0&&(this.max=1e-6),this.min<=0&&(this.min=1e-6),this.type==i.Const&&(this.min=this.max),this.type==i.RandomConst,(this.type==i.OneBezier||this.type==i.TwoBezier)&&(null==this.bezier1&&(this.bezier1=new t.BezierData),this.bezier1.validate()),this.type==i.TwoBezier&&(null==this.bezier2&&(this.bezier2=new t.BezierData),this.bezier2.validate()),this.delay<0&&(this.delay=0),this.duration<0&&(this.duration=5)},a}(l);t.ParticleDataLife=d;var p=function(t){function i(){t.call(this,e.Shape),this.type=n.Cube,this.randomDirection=!1,this.emitFromShell=!1,this.cubeW=0,this.cubeH=0,this.cubeD=0,this.sphereRadius=10,this.hemiSphereRadius=10,this.coneType=s.Volume,this.coneLength=10,this.coneRadius=10,this.coneAngle=30,this.meshType=o.Vertex}return __extends(i,t),i.prototype.validate=function(){this.type==n.Cube?(this.cubeW<0&&(this.cubeW=0),this.cubeH<0&&(this.cubeH=0),this.cubeD<0&&(this.cubeD=0)):this.type==n.Sphere&&this.sphereRadius<0&&(this.sphereRadius=10)},i}(l);t.ParticleDataShape=p;var f=function(r){function a(){r.call(this,e.RotationBirth),this.type=i.Const,this.max=0,this.min=0}return __extends(a,r),a.prototype.validate=function(){this.type==i.Const&&(this.min=this.max),this.type==i.RandomConst,(this.type==i.OneBezier||this.type==i.TwoBezier)&&(null==this.bezier1&&(this.bezier1=new t.BezierData),this.bezier1.validate()),this.type==i.TwoBezier&&(null==this.bezier2&&(this.bezier2=new t.BezierData),this.bezier2.validate())},a}(l);t.ParticleDataRotationBirth=f;var _=function(r){function a(){r.call(this,e.ScaleBirth),this.type=i.Const,this.max=1,this.min=1}return __extends(a,r),a.prototype.validate=function(){this.type==i.Const&&(this.min=this.max),this.type==i.RandomConst,(this.type==i.OneBezier||this.type==i.TwoBezier)&&(null==this.bezier1&&(this.bezier1=new t.BezierData),this.bezier1.validate()),this.type==i.TwoBezier&&(null==this.bezier2&&(this.bezier2=new t.BezierData),this.bezier2.validate())},a}(l);t.ParticleDataScaleBirth=_;var m=function(t){function i(){t.call(this,e.Geometry),this.planeW=10,this.planeH=10}return __extends(i,t),i.prototype.validate=function(){this.planeW<0&&(this.planeW=10),this.planeH<0&&(this.planeH=10)},i}(l);t.ParticleDataGeometry=m;var g=function(r){function a(){r.call(this,e.MoveSpeed),this.type=i.Const,this.max=0,this.min=0}return __extends(a,r),a.prototype.validate=function(){this.velocityOver&&this.velocityOver.validate(),this.velocityLimit&&this.velocityLimit.validate(),this.velocityForce&&this.velocityForce.validate(),this.type==i.Const&&(this.min=this.max),(this.type==i.OneBezier||this.type==i.TwoBezier)&&(null==this.bezier1&&(this.bezier1=new t.BezierData),this.bezier1.validate()),this.type==i.TwoBezier&&(null==this.bezier2&&(this.bezier2=new t.BezierData),this.bezier2.validate())},a}(l);t.ParticleDataMoveSpeed=g;var v=function(){function e(){this.type=i.Const,this.max=0,this.min=0,this.dampen=0,this.bezier1=new t.BezierData,this.bezier2=new t.BezierData}return e.prototype.validate=function(){this.max<0&&(this.max=0),this.min<0&&(this.min=0),this.dampen=this.dampen||0,this.type==i.Const&&(this.min=this.max),(this.type==i.OneBezier||this.type==i.TwoBezier)&&(null==this.bezier1&&(this.bezier1=new t.BezierData),this.bezier1.validate()),this.type==i.TwoBezier&&(null==this.bezier2&&(this.bezier2=new t.BezierData),this.bezier2.validate())},e}();t.VelocityLimitLifeTimeData=v;var y=function(){function e(){this.type=i.Const,this.max=new t.Vector3D,this.min=new t.Vector3D,this.worldSpace=!1,this.xBezier1=new t.BezierData,this.yBezier1=new t.BezierData,this.zBezier1=new t.BezierData,this.xBezier2=new t.BezierData,this.yBezier2=new t.BezierData,this.zBezier2=new t.BezierData}return e.prototype.validate=function(){null==this.max&&(this.max=new t.Vector3D),null==this.min&&(this.min=this.max.clone()),(this.type==i.OneBezier||this.type==i.TwoBezier)&&(null==this.xBezier1&&(this.xBezier1=new t.BezierData),null==this.yBezier1&&(this.yBezier1=new t.BezierData),null==this.zBezier1&&(this.zBezier1=new t.BezierData),this.xBezier1.validate(),this.yBezier1.validate(),this.zBezier1.validate()),this.type==i.TwoBezier&&(null==this.xBezier2&&(this.xBezier2=new t.BezierData),null==this.yBezier2&&(this.yBezier2=new t.BezierData),null==this.zBezier2&&(this.zBezier2=new t.BezierData),this.xBezier2.validate(),this.yBezier2.validate(),this.zBezier2.validate())},e}();t.VelocityOverLifeTimeData=y;var x=function(){function e(){this.type=i.Const,this.max=new t.Vector3D,this.min=new t.Vector3D,this.worldSpace=!1,this.xBezier1=new t.BezierData,this.yBezier1=new t.BezierData,this.zBezier1=new t.BezierData,this.xBezier2=new t.BezierData,this.yBezier2=new t.BezierData,this.zBezier2=new t.BezierData}return e.prototype.validate=function(){null==this.max&&(this.max=new t.Vector3D),null==this.min&&(this.min=this.max.clone()),(this.type==i.OneBezier||this.type==i.TwoBezier)&&(null==this.xBezier1&&(this.xBezier1=new t.BezierData),null==this.yBezier1&&(this.yBezier1=new t.BezierData),null==this.zBezier1&&(this.zBezier1=new t.BezierData),this.xBezier1.validate(),this.yBezier1.validate(),this.zBezier1.validate()),this.type==i.TwoBezier&&(null==this.xBezier2&&(this.xBezier2=new t.BezierData),null==this.yBezier2&&(this.yBezier2=new t.BezierData),null==this.zBezier2&&(this.zBezier2=new t.BezierData),this.xBezier2.validate(),this.yBezier2.validate(),this.zBezier2.validate())},e}();t.VelocityForceLifeTimeData=x;var b=function(i){function r(){i.call(this,e.ScaleBezier),this.data=new t.BezierData}return __extends(r,i),r.prototype.validate=function(){null==this.data&&(this.data=new t.BezierData),this.data.validate()},r}(l);t.ParticleDataScaleBezier=b;var D=function(r){function a(){r.call(this,e.RotationSpeed),this.max=new t.Vector3D,this.min=new t.Vector3D,this.type=i.Const,this.bezier1=new t.BezierData,this.bezier2=new t.BezierData}return __extends(a,r),a.prototype.validate=function(){null==this.max&&(this.max=new t.Vector3D),null==this.min&&(this.min=this.max.clone()),(this.type==i.OneBezier||this.type==i.TwoBezier)&&(null==this.bezier1&&(this.bezier1=new t.BezierData),this.bezier1.validate()),this.type==i.TwoBezier&&(null==this.bezier2&&(this.bezier2=new t.BezierData),this.bezier2.validate())},a}(l);t.ParticleDataRotationSpeed=D;var T=function(i){function r(){i.call(this,e.ColorOffset),this.data=new t.ColorGradients}return __extends(r,i),r.prototype.validate=function(){null==this.data.colors&&(this.data.colors=[]),null==this.data.times&&(this.data.times=[])},r}(l);t.ParticleDataColorOffset=T;var w=function(t){function i(){t.call(this,e.FollowTarget),this.followRotation=!0,this.followScale=!0}return __extends(i,t),i.prototype.validate=function(){},i}(l);t.ParticleDataFollowTarget=w;var P=function(r){function a(){r.call(this,e.TextureSheet),this.tileX=1,this.tileY=1,this.whole=!0,this.frameType=i.Const,this.randomRow=!1,this.row=0,this.min=0,this.max=0,this.circles=1,this.bezier1=new t.BezierData,this.bezier2=new t.BezierData}return __extends(a,r),a.prototype.validate=function(){this.tileX<0&&(this.tileX=1),this.tileX=Math.floor(this.tileX),this.tileY<0&&(this.tileY=1),this.tileY=Math.floor(this.tileY),this.max<0&&(this.max=0),this.min>this.max&&(this.min=this.max),(this.frameType==i.OneBezier||this.frameType==i.TwoBezier)&&(null==this.bezier1&&(this.bezier1=new t.BezierData),this.bezier1.validate()),this.frameType==i.TwoBezier&&(null==this.bezier2&&(this.bezier2=new t.BezierData),this.bezier2.validate()),this.circles<1&&(this.circles=1)},a}(l);t.ParticleDataTextureSheet=P}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.prototype.parse=function(t,e){this._particleData=e,this.version=this.getNode(t,"version").textContent;var i=this.getNode(t,"property");this.parseProperty(i);var r=this.getNode(t,"emission");this.parseEmission(r);var a=this.getNode(t,"life");this.parseLife(a);var n=this.getNode(t,"shape");this.parseShape(n);var o=this.getNode(t,"rotationBirth");this.parseRotationBirth(o);var s=this.getNode(t,"scaleBirth");this.parseScaleBirth(s);var h=this.getNode(t,"geometry");this.parseGeometry(h);var l=this.getNode(t,"moveSpeed");this.parseMoveSpeed(l);var u=this.getNode(t,"followTarget");this.parseFollowTarget(u);var c=this.getNode(t,"scaleBezier");this.parseScaleBeizer(c);var d=this.getNode(t,"rotationSpeed");this.parseRotationSpeed(d);var p=this.getNode(t,"colorOffset");this.parseColorOffset(p);var f=(this.getNode(t,"mat"),this.getNode(t,"textureSheet"));this.parseTextureSheet(f)},e.prototype.parseProperty=function(e){var i=this._particleData.property;i.particleCount=Number(this.getNode(e,"particleCount").textContent),i.prewarm="true"==this.getNode(e,"prewarm").textContent;var r=this.getNode(e,"bounds");i.bounds=this.parseVector3D(r,i.bounds),i.colorType=t.ParticleBirthColorType[this.getNode(e,"colorType").textContent];var a=this.getNode(e,"colorConst1"),n=this.getNode(e,"colorConst2"),o=this.getNode(e,"colorGradients1"),s=this.getNode(e,"colorGradients2");this.parseColorProperty(i,a,n,o,s),i.gravity=Number(this.getNode(e,"gravity").textContent);var h=this.getNode(e,"transform"),l=this.getNode(h,"rotation"),u=this.getNode(h,"scale"),c=this.getNode(h,"position");i.rotation=this.parseVector3D(l,i.rotation),i.scale=this.parseVector3D(u,i.scale),i.position=this.parseVector3D(c,i.position);var d=this.getNode(e,"render"),p=this.getNode(d,"renderMode");p&&(i.renderMode=t.ParticleRenderModeType[p.textContent]);var f=this.getNode(d,"lengthScale");f&&(i.lengthScale=Number(f.textContent));var _=this.getNode(d,"cameraScale");_&&(i.cameraScale=Number(_.textContent));var m=this.getNode(d,"speedScale");m&&(i.speedScale=Number(m.textContent));var g=this.getNode(d,"meshFile");g&&""!=g.textContent&&(i.meshFile=g.textContent);var v=this.getNode(e,"sortingFudge");v&&(i.sortingFudge=Number(v.textContent))},e.prototype.parseColorProperty=function(e,i,r,a,n){if(i&&(e.colorConst1=t.Color.createColor(Number(i.textContent))),r&&(e.colorConst2=t.Color.createColor(Number(r.textContent))),a){var o=this.getNodeList(a,"item");e.colorGradients1=this.parseGradientsColor(o,e.colorGradients1)}if(n){var o=this.getNodeList(n,"item");e.colorGradients2=this.parseGradientsColor(o,e.colorGradients2)}},e.prototype.parseEmission=function(e){var i=this._particleData.emission;i.type=t.ParticleValueType[this.getNode(e,"type").textContent],i.rate=Number(this.getNode(e,"rate").textContent);var r,a,n=this.getNode(e,"bursts"),o=0,s=0;if(n){i.bursts=[];var h=this.getNodeList(n,"item");for(o=0,s=h?h.length:0;s>o;o++)r=h[o],a=new t.Point,i.bursts.push(a),this.eachAttr(r,function(t,e){"time"==t?a.x=Number(e):"count"==t&&(a.y=Number(e))})}var l=this.getNode(e,"bezier");i.type==t.ParticleValueType.OneBezier&&(i.bezier=this.parseBezierData(l))},e.prototype.parseLife=function(e){var i=this._particleData.life;i.type=t.ParticleValueType[this.getNode(e,"type").textContent],i.min=Number(this.getNode(e,"min").textContent),i.max=Number(this.getNode(e,"max").textContent),i.bezier1=this.parseBezierData(this.getNode(e,"bezier1")),i.bezier2=this.parseBezierData(this.getNode(e,"bezier2")),i.duration=Number(this.getNode(e,"duration").textContent),i.delay=Number(this.getNode(e,"delay").textContent),i.loop="true"==this.getNode(e,"loop").textContent},e.prototype.parseShape=function(e){if(null!=e){var i=this._particleData.shape;i.type=t.ParticleDataShapeType[this.getNode(e,"type").textContent],i.randomDirection="true"==this.getNode(e,"randomDirection").textContent;var r=this.getNode(e,"emitFromShell");i.emitFromShell=r&&"true"==r.textContent;var a=this.getNode(e,"cube");this.eachAttr(a,function(t,e){"width"==t?i.cubeW=Number(e):"height"==t?i.cubeH=Number(e):"depth"==t&&(i.cubeD=Number(e))});var n=this.getNode(e,"sphereRadius");n&&(i.sphereRadius=Number(n.textContent));var o=this.getNode(e,"hemiSphereRadius");o&&(i.hemiSphereRadius=Number(o.textContent));var s=this.getNode(e,"cone");this.eachAttr(s,function(e,r){"type"==e?i.coneType=t.ParticleConeShapeType[r]:"length"==e?i.coneLength=Number(r):"radius"==e?i.coneRadius=Number(r):"angle"==e&&(i.coneAngle=Number(r))});var h=this.getNode(e,"meshType");h&&(i.meshType=t.ParticleMeshShapeType[h.textContent]);var l=this.getNode(e,"meshFile");l&&""!=l.textContent&&(i.meshFile=l.textContent)}},e.prototype.parseRotationBirth=function(e){var i=this._particleData.rotationBirth;i.type=t.ParticleValueType[this.getNode(e,"type").textContent],i.min=Number(this.getNode(e,"min").textContent),i.max=Number(this.getNode(e,"max").textContent),i.bezier1=this.parseBezierData(this.getNode(e,"bezier1")),i.bezier2=this.parseBezierData(this.getNode(e,"bezier2"))},e.prototype.parseScaleBirth=function(e){var i=this._particleData.scaleBirth;i.type=t.ParticleValueType[this.getNode(e,"type").textContent],i.min=Number(this.getNode(e,"min").textContent),i.max=Number(this.getNode(e,"max").textContent),i.bezier1=this.parseBezierData(this.getNode(e,"bezier1")),i.bezier2=this.parseBezierData(this.getNode(e,"bezier2"))},e.prototype.parseGeometry=function(t){var e=this._particleData.geometry,i=this.getNode(t,"plane");this.eachAttr(i,function(t,i){"width"==t?e.planeW=Number(i):"height"==t&&(e.planeH=Number(i))})},e.prototype.parseMoveSpeed=function(e){var i=this._particleData.moveSpeed;i.type=t.ParticleValueType[this.getNode(e,"type").textContent],i.min=Number(this.getNode(e,"min").textContent),i.max=Number(this.getNode(e,"max").textContent),i.bezier1=this.parseBezierData(this.getNode(e,"bezier1")),i.bezier2=this.parseBezierData(this.getNode(e,"bezier2"));var r=this.getNode(e,"velocityOver");if(r){var a=new t.VelocityOverLifeTimeData;a.type=t.ParticleValueType[this.getNode(r,"type").textContent];var n=this.getNode(r,"min"),o=this.getNode(r,"max");a.min=this.parseVector3D(n,a.min),a.max=this.parseVector3D(o,a.max),a.worldSpace="true"==this.getNode(r,"worldSpace").textContent,a.xBezier1=this.parseBezierData(this.getNode(r,"xBezier1")),a.yBezier1=this.parseBezierData(this.getNode(r,"yBezier1")),a.zBezier1=this.parseBezierData(this.getNode(r,"zBezier1")),a.xBezier2=this.parseBezierData(this.getNode(r,"xBezier2")),a.yBezier2=this.parseBezierData(this.getNode(r,"yBezier2")),a.zBezier2=this.parseBezierData(this.getNode(r,"zBezier2")),i.velocityOver=a}var s=this.getNode(e,"velocityForce");if(s){var h=new t.VelocityForceLifeTimeData;h.type=t.ParticleValueType[this.getNode(s,"type").textContent];var n=this.getNode(s,"min"),o=this.getNode(s,"max");h.min=this.parseVector3D(n,h.min),h.max=this.parseVector3D(o,h.max),h.worldSpace="true"==this.getNode(s,"worldSpace").textContent,h.xBezier1=this.parseBezierData(this.getNode(s,"xBezier1")),h.yBezier1=this.parseBezierData(this.getNode(s,"yBezier1")),h.zBezier1=this.parseBezierData(this.getNode(s,"zBezier1")),h.xBezier2=this.parseBezierData(this.getNode(s,"xBezier2")),h.yBezier2=this.parseBezierData(this.getNode(s,"yBezier2")),h.zBezier2=this.parseBezierData(this.getNode(s,"zBezier2")),i.velocityForce=h}var l=this.getNode(e,"velocityLimit");if(l){var u=new t.VelocityLimitLifeTimeData;u.type=t.ParticleValueType[this.getNode(l,"type").textContent];var n=this.getNode(l,"min"),o=this.getNode(l,"max"),c=this.getNode(l,"dampen");u.min=Number(n.textContent),u.max=Number(o.textContent),u.dampen=c?Number(c.textContent):0,u.bezier1=this.parseBezierData(this.getNode(l,"bezier1")),u.bezier2=this.parseBezierData(this.getNode(l,"bezier2")),i.velocityLimit=u}},e.prototype.parseFollowTarget=function(e){if(null!=e){var i=this._particleData.followTarget=new t.ParticleDataFollowTarget;i.followRotation="true"==this.getNode(e,"followRotation").textContent,i.followScale="true"==this.getNode(e,"followScale").textContent}},e.prototype.parseScaleBeizer=function(e){if(null!=e){var i=this._particleData.scaleBezier=new t.ParticleDataScaleBezier;i.data=this.parseBezierData(this.getNode(e,"bezier"))}},e.prototype.parseRotationSpeed=function(e){if(null!=e){var i=this._particleData.rotationSpeed=new t.ParticleDataRotationSpeed;i.type=t.ParticleValueType[this.getNode(e,"type").textContent];var r=this.getNode(e,"min"),a=this.getNode(e,"max");i.min=this.parseVector3D(r,i.min),i.max=this.parseVector3D(a,i.max),i.bezier1=this.parseBezierData(this.getNode(e,"bezier1")),i.bezier2=this.parseBezierData(this.getNode(e,"bezier2"))}},e.prototype.parseColorOffset=function(e){if(null!=e){var i=this._particleData.colorOffset=new t.ParticleDataColorOffset,r=this.getNodeList(e,"item");i.data=this.parseGradientsColor(r,i.data)}},e.prototype.parseTextureSheet=function(e){if(null==e)return null;var i=this._particleData.textureSheet=new t.ParticleDataTextureSheet;return i.frameType=t.ParticleValueType[this.getNode(e,"frameType").textContent],i.tileX=Number(this.getNode(e,"tileX").textContent),i.tileY=Number(this.getNode(e,"tileY").textContent),i.whole="true"==this.getNode(e,"whole").textContent,i.row=Number(this.getNode(e,"row").textContent),i.min=Number(this.getNode(e,"min").textContent),i.max=Number(this.getNode(e,"max").textContent),i.circles=Number(this.getNode(e,"circles").textContent),i.bezier1=this.parseBezierData(this.getNode(e,"bezier1")),i.bezier2=this.parseBezierData(this.getNode(e,"bezier2")),i},e.prototype.parseGradientsColor=function(e,i){i||(i=new t.ColorGradients);var r,a,n=0,o=0;for(n=0,o=e?e.length:0;o>n;n++)r=e[n],this.eachAttr(r,function(e,r){"time"==e?i.times.push(Number(r)):"color"==e&&(a=t.Color.createColor(Number(r)),i.colors.push(a))});var s=i.times.slice(),h=i.colors.slice();for(s.sort(function(t,e){return t-e}),n=0,o=i?i.times.length:0;o>n;n++){var l=s.indexOf(i.times[n]);i.colors[n]=h[l]}return i.times=s,i},e.prototype.parseBezierData=function(e){var i=new t.BezierData;if(null==e)return i;var r,a,n=this.getNodeList(e,"pos"),o=this.getNodeList(e,"ctrl"),s=0,h=0;for(s=0,h=n?n.length:0;h>s;s++)r=n[s],a=new t.Point,i.posPoints.push(a),this.eachAttr(r,function(t,e){"x"==t?a.x=Number(e):"y"==t&&(a.y=Number(e))});for(s=0,h=o?o.length:0;h>s;s++)r=o[s],a=new t.Point,i.ctrlPoints.push(a),this.eachAttr(r,function(t,e){"x"==t?a.x=Number(e):"y"==t&&(a.y=Number(e))});return i},e.prototype.parseVector3D=function(e,i){return null==i&&(i=new t.Vector3D),this.eachAttr(e,function(t,e){"x"==t?i.x=Number(e):"y"==t?i.y=Number(e):"z"==t&&(i.z=Number(e))}),i},e.prototype.getNode=function(t,e){if(null==t)return null;var i=t.getElementsByTagName(e);return null==i||0==i.length?null:i[0]},e.prototype.getNodeList=function(t,e){if(null==t)return null;var i=t.getElementsByTagName(e);return null==i||0==i.length?null:i},e.prototype.eachAttr=function(e,i){t.XMLParser.eachXmlAttr(e,i)},e}();t.ParticleXmlParser=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.prototype.parse=function(t,e){this._particleData=e,this.version=t.version+"";var i=t.property;this.parseProperty(i);var r=t.emission;this.parseEmission(r);var a=t.life;this.parseLife(a);var n=t.shape;this.parseShape(n);var o=t.rotationBirth;this.parseRotationBirth(o);var s=t.scaleBirth;this.parseScaleBirth(s);var h=t.geometry;this.parseGeometry(h);var l=t.moveSpeed;this.parseMoveSpeed(l);var u=t.followTarget;this.parseFollowTarget(u);var c=t.scaleBezier;this.parseScaleBeizer(c);var d=t.rotationSpeed;this.parseRotationSpeed(d);var p=t.colorOffset;this.parseColorOffset(p);var f=(t.mat,t.textureSheet);this.parseTextureSheet(f)},e.prototype.parseProperty=function(e){var i=this._particleData.property;i.particleCount=Number(e.particleCount),i.prewarm=e.prewarm,i.bounds=this.parseVector3D(e.bounds,i.bounds),i.colorType=t.ParticleBirthColorType[e.colorType+""];var r=e.colorConst1,a=e.colorConst2,n=e.colorGradients1,o=e.colorGradients2;this.parseColorProperty(i,r,a,n,o),i.gravity=Number(e.gravity);var s=e.transform,h=s.rotation,l=s.scale,u=s.position;i.rotation=this.parseVector3D(h,i.rotation),i.scale=this.parseVector3D(l,i.scale),i.position=this.parseVector3D(u,i.position);var c=e.render;i.renderMode=t.ParticleRenderModeType[c.renderMode+""],i.lengthScale=Number(c.lengthScale),i.cameraScale=Number(c.cameraScale),i.speedScale=Number(c.speedScale),i.meshFile=c.meshFile,""==i.meshFile&&(i.meshFile=null),i.sortingFudge=Number(e.sortingFudge)},e.prototype.parseColorProperty=function(e,i,r,a,n){i&&(e.colorConst1=t.Color.createColor(Number(i))),r&&(e.colorConst2=t.Color.createColor(Number(r))),a&&(e.colorGradients1=this.parseGradientsColor(a,e.colorGradients1)),n&&(e.colorGradients2=this.parseGradientsColor(n,e.colorGradients2))},e.prototype.parseEmission=function(e){var i=this._particleData.emission;i.type=t.ParticleValueType[e.type+""],i.rate=Number(e.rate);var r,a,n=e.bursts,o=0,s=0;if(n)for(i.bursts=[],o=0,s=n?n.length:0;s>o;o++)a=n[o],r=new t.Point,r.x=Number(a[0]),r.y=Number(a[1]),i.bursts.push(r);var h=e.bezier;i.type==t.ParticleValueType.OneBezier&&(i.bezier=this.parseBezierData(h))},e.prototype.parseLife=function(e){var i=this._particleData.life;i.type=t.ParticleValueType[e.type+""],i.min=Number(e.min),i.max=Number(e.max),i.bezier1=this.parseBezierData(e.bezier1),i.bezier2=this.parseBezierData(e.bezier2),i.duration=Number(e.duration),i.delay=Number(e.delay),i.loop=e.loop},e.prototype.parseShape=function(e){if(null!=e){var i=this._particleData.shape;i.type=t.ParticleDataShapeType[e.type+""],i.randomDirection=e.randomDirection,i.emitFromShell=e.emitFromShell;var r=e.cube;if(r&&(i.cubeW=Number(r[0]),i.cubeH=Number(r[1]),i.cubeD=Number(r[2])),i.sphereRadius=Number(e.sphereRadius),i.hemiSphereRadius=Number(e.hemiSphereRadius),i.type==t.ParticleDataShapeType.Cone){var a=e.cone;i.coneType=t.ParticleConeShapeType[a.type+""],i.coneLength=Number(a.length),i.coneRadius=Number(a.radius),i.coneAngle=Number(a.angle)}i.meshType=t.ParticleMeshShapeType[e.meshType+""],i.meshFile=e.meshFile,""==i.meshFile&&(i.meshFile=null)}},e.prototype.parseRotationBirth=function(e){var i=this._particleData.rotationBirth;i.type=t.ParticleValueType[e.type+""],i.min=Number(e.min),i.max=Number(e.max),i.bezier1=this.parseBezierData(e.bezier1),i.bezier2=this.parseBezierData(e.bezier2)},e.prototype.parseScaleBirth=function(e){var i=this._particleData.scaleBirth;i.type=t.ParticleValueType[e.type+""],i.min=Number(e.min),i.max=Number(e.max),i.bezier1=this.parseBezierData(e.bezier1),i.bezier2=this.parseBezierData(e.bezier2)},e.prototype.parseGeometry=function(t){var e=this._particleData.geometry,i=t.plane;e.planeW=Number(i[0]),e.planeH=Number(i[1])},e.prototype.parseMoveSpeed=function(e){var i=this._particleData.moveSpeed;i.type=t.ParticleValueType[e.type+""],i.min=Number(e.min),i.max=Number(e.max),i.bezier1=this.parseBezierData(e.bezier1),i.bezier2=this.parseBezierData(e.bezier2);var r=e.velocityOver;if(r){var a=new t.VelocityOverLifeTimeData;a.type=t.ParticleValueType[r.type+""],a.min=this.parseVector3D(r.min,a.min),a.max=this.parseVector3D(r.max,a.max),a.worldSpace=r.worldSpace,a.xBezier1=this.parseBezierData(r.xBezier1),a.yBezier1=this.parseBezierData(r.yBezier1),a.zBezier1=this.parseBezierData(r.zBezier1),a.xBezier2=this.parseBezierData(r.xBezier2),a.yBezier2=this.parseBezierData(r.yBezier2),a.zBezier2=this.parseBezierData(r.zBezier2),i.velocityOver=a}var n=e.velocityForce;if(n){var o=new t.VelocityForceLifeTimeData;o.type=t.ParticleValueType[n.type+""],o.min=this.parseVector3D(n.min,o.min),o.max=this.parseVector3D(n.max,o.max),o.worldSpace=n.worldSpace,o.xBezier1=this.parseBezierData(n.xBezier1),o.yBezier1=this.parseBezierData(n.yBezier1),o.zBezier1=this.parseBezierData(n.zBezier1),o.xBezier2=this.parseBezierData(n.xBezier2),o.yBezier2=this.parseBezierData(n.yBezier2),o.zBezier2=this.parseBezierData(n.zBezier2),i.velocityForce=o}var s=e.velocityLimit;if(s){var h=new t.VelocityLimitLifeTimeData;h.type=t.ParticleValueType[s.type+""],h.min=Number(s.min),h.max=Number(s.max),h.dampen=Number(s.dampen),h.bezier1=this.parseBezierData(s.bezier1),h.bezier2=this.parseBezierData(s.bezier2),i.velocityLimit=h}},e.prototype.parseFollowTarget=function(e){if(null!=e){var i=this._particleData.followTarget=new t.ParticleDataFollowTarget;i.followRotation=e.followRotation,i.followScale=e.followScale}},e.prototype.parseScaleBeizer=function(e){if(null!=e){var i=this._particleData.scaleBezier=new t.ParticleDataScaleBezier;i.data=this.parseBezierData(e.bezier)}},e.prototype.parseRotationSpeed=function(e){if(null!=e){var i=this._particleData.rotationSpeed=new t.ParticleDataRotationSpeed;i.type=t.ParticleValueType[e.type+""],i.min=this.parseVector3D(e.min,i.min),i.max=this.parseVector3D(e.max,i.max),i.bezier1=this.parseBezierData(e.bezier1),i.bezier2=this.parseBezierData(e.bezier2)}},e.prototype.parseColorOffset=function(e){if(null!=e){var i=this._particleData.colorOffset=new t.ParticleDataColorOffset;i.data=this.parseGradientsColor(e.item,i.data)}},e.prototype.parseTextureSheet=function(e){if(null==e)return null;var i=this._particleData.textureSheet=new t.ParticleDataTextureSheet;return i.frameType=t.ParticleValueType[e.frameType+""],i.tileX=Number(e.tileX),i.tileY=Number(e.tileY),i.whole=e.whole,i.row=Number(e.row),i.min=Number(e.min),i.max=Number(e.max),i.circles=Number(e.circles),i.bezier1=this.parseBezierData(e.bezier1),i.bezier2=this.parseBezierData(e.bezier2),i},e.prototype.parseGradientsColor=function(e,i){i||(i=new t.ColorGradients);var r,a,n=0,o=0;for(n=0,o=e?e.length:0;o>n;n++)r=e[n],i.times.push(Number(r[0])),a=t.Color.createColor(Number(r[1])),i.colors.push(a);var s=i.times.slice(),h=i.colors.slice();for(s.sort(function(t,e){return t-e}),n=0,o=i?i.times.length:0;o>n;n++){var l=s.indexOf(i.times[n]);i.colors[n]=h[l]}return i.times=s,i},e.prototype.parseBezierData=function(e){var i=new t.BezierData;if(null==e)return i;var r,a,n=0,o=0;for(n=0,o=e?e.length:0;o>n;n++)r=e[n],a=new t.Point,a.x=Number(r[1]),a.y=Number(r[2]),"pos"==r[0]?i.posPoints.push(a):i.ctrlPoints.push(a);return i},e.prototype.parseVector3D=function(e,i){return null==i&&(i=new t.Vector3D),e&&(i.x=Number(e[0]),i.y=Number(e[1]),i.z=Number(e[2])),i},e}();t.ParticleJsonParser=e}(egret3d||(egret3d={}));var egret3d;!function(egret3d){var ParticleParser=function(){function ParticleParser(){}return ParticleParser.prototype.parseJson=function(text){this.data=new egret3d.ParticleData;var parser=new egret3d.ParticleJsonParser;return parser.parse(eval("("+text+")"),this.data),this.version=parser.version,this.data.validate(),this.data},ParticleParser.prototype.parseXml=function(t){this.data=new egret3d.ParticleData;var e=new egret3d.ParticleXmlParser;return e.parse(egret3d.XMLParser.parse(t),this.data),this.version=e.version,this.data.validate(),this.data},ParticleParser}();egret3d.ParticleParser=ParticleParser}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r){void 0===r&&(r=null),e.call(this,null,r),this._isEmitterDirty=!0,this._userNodes=[],this.tag.name="effect",this.type="particleEmit",this._data=i,this._externalGeometry=i.property.geometry,this.animation=this._particleAnimation=new t.ParticleAnimation(this),this.animation.particleAnimationController=this._particleAnimation,this._particleState=this._particleAnimation.particleAnimationState,this._generator=new t.ParticleLifeGenerator,this._particleAnimation.emit=this,this.buildParticle()
}return __extends(i,e),Object.defineProperty(i.prototype,"generator",{get:function(){return this._generator},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"drawOrder",{get:function(){return this._data.property.sortingFudge},enumerable:!0,configurable:!0}),i.prototype.addSubEmitter=function(t,e){e.animation.stop(),this._subEmitterNode.importSubEmitter(t,e)},i.prototype.buildParticle=function(){this._geometryShape=null==this._externalGeometry?this.createPlane():this._externalGeometry,this.initialize(),this.initBoudBox(this._data.property.bounds),this._isEmitterDirty=!1},i.prototype.createPlane=function(){var e,i=this._data.geometry,r=t.Vector3D.Z_AXIS;r=this._data.property.renderMode==t.ParticleRenderModeType.VerticalBillboard?t.Vector3D.Y_AXIS:this._data.property.renderMode==t.ParticleRenderModeType.HorizontalBillboard?t.Vector3D.Y_AXIS:t.Vector3D.Z_AXIS;var a=!0,n=!0;return this._data.property.renderMode==t.ParticleRenderModeType.StretchedBillboard&&(a=!1,n=!0),e=new t.PlaneGeometry(i.planeW,i.planeH,1,1,1,1,r,a,n)},Object.defineProperty(i.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"timeNode",{get:function(){return this._timeNode},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"positionNode",{get:function(){return this._positionNode},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"followTarget",{get:function(){return this._particleState.followTarget},set:function(t){this._particleState.followTarget=t},enumerable:!0,configurable:!0}),i.prototype.addAnimNode=function(t){var e=this._userNodes.indexOf(t);-1==e&&(this._userNodes.push(t),this._isEmitterDirty=!0)},i.prototype.removeAnimNode=function(t){var e=this._userNodes.indexOf(t);-1!=e&&(this._userNodes.slice(e),this._isEmitterDirty=!0)},i.prototype.play=function(t){void 0===t&&(t=!1),t?this.animation.play("",1,!1,!0):this.animation.play("",1,!0,!1)},i.prototype.stop=function(){this.animation.stop()},i.prototype.initialize=function(){this._particleAnimation.particleAnimationState.clean(),this._generator.generator(this._data);var e=this._generator.planes.length;this.geometry=new t.Geometry,this.geometry.buildDefaultSubGeometry(),this.geometry.subGeometrys[0].count=e*this._geometryShape.indexCount;var i=0,r=new Array,a=t.VertexFormat.VF_POSITION|t.VertexFormat.VF_UV0|t.VertexFormat.VF_COLOR;this.geometry.vertexFormat=a,this.initMainAnimNode(),this.initUserAnimNode(),this.initEndNode(),this.geometry.vertexCount=e*this._geometryShape.vertexCount,this.geometry.indexCount=e*this._geometryShape.indexCount,this._geometryShape.getVertexForIndex(0,a,r,this._geometryShape.vertexCount);for(var n=0;e>n;++n)i=n*this._geometryShape.vertexCount,this.geometry.setVerticesForIndex(i,a,r,this._geometryShape.vertexCount);for(var n=0;e>n;++n)for(var o=0;o<this._geometryShape.indexArray.length;++o)this.geometry.indexArray[n*this._geometryShape.indexArray.length+o]=this._geometryShape.indexArray[o]+n*this._geometryShape.vertexCount;this._particleAnimation.particleAnimationState.fill(this.geometry,e)},i.prototype.initMainAnimNode=function(){var e=[];this._timeNode=new t.ParticleTime,this._timeNode.initNode(this._data.life),e.push(this._timeNode),this._positionNode=new t.ParticlePosition,this._positionNode.initNode(this._data.shape,this._data.property),e.push(this._positionNode);var i=new t.ParticleVelocityNode;i.initNode(this._data.moveSpeed),e.push(i),this._subEmitterNode=new t.ParticleSubEmitterNode,this._subEmitterNode.initNode(null,this),this._particleAnimation.particleAnimationState.addNode(this._subEmitterNode);var r=this._data.moveSpeed.velocityOver;if(r)if(r.type==t.ParticleValueType.Const||r.type==t.ParticleValueType.RandomConst){var a=new t.ParticleVelocityOverConstNode;a.initNode(this._data.moveSpeed),e.push(a)}else if(r.type==t.ParticleValueType.OneBezier){var n=new t.ParticleVelocityOverOneBezierNode;n.initNode(this._data.moveSpeed),e.push(n)}else if(r.type==t.ParticleValueType.TwoBezier){var o=new t.ParticleVelocityOverTwoBezierNode;o.initNode(this._data.moveSpeed),e.push(o)}var s=this._data.moveSpeed.velocityLimit;if(s)if(s.type==t.ParticleValueType.Const||s.type==t.ParticleValueType.RandomConst){var h=new t.ParticleVelocityLimitConstNode;h.initNode(this._data.moveSpeed),e.push(h)}else if(s.type==t.ParticleValueType.OneBezier){var l=new t.ParticleVelocityLimitOneBezierNode;l.initNode(this._data.moveSpeed),e.push(l)}else if(s.type==t.ParticleValueType.TwoBezier){var u=new t.ParticleVelocityLimitTwoBezierNode;u.initNode(this._data.moveSpeed),e.push(u)}var c=this._data.moveSpeed.velocityForce;if(c)if(c.type==t.ParticleValueType.Const||c.type==t.ParticleValueType.RandomConst){var d=new t.ParticleVelocityForceConstNode;d.initNode(this._data.moveSpeed),e.push(d)}else if(c.type==t.ParticleValueType.OneBezier){var p=new t.ParticleVelocityForceOneBezierNode;p.initNode(this._data.moveSpeed),e.push(p)}else if(c.type==t.ParticleValueType.TwoBezier){var f=new t.ParticleVelocityForceTwoBezierNode;f.initNode(this._data.moveSpeed),e.push(f)}var _=new t.ParticleRotation;_.initNode(this._data.rotationBirth),e.push(_);var m=new t.ParticleScale;m.initNode(this._data.scaleBirth),e.push(m);var g=new t.ParticleStartColor;if(g.initNode(this._data.property),e.push(g),this._data.followTarget){var v=new t.ParticleFollowNode;v.initNode(this._data.followTarget),e.push(v)}if(this._data.scaleBezier){var y=new t.ParticleSizeGlobalNode;y.initNode(this._data.scaleBezier),e.push(y)}if(this._data.rotationSpeed)if(this._data.rotationSpeed.type==t.ParticleValueType.Const||this._data.rotationSpeed.type==t.ParticleValueType.RandomConst){var x=new t.ParticleRotationConstNode;x.initNode(this._data.rotationSpeed),e.push(x)}else if(this._data.rotationSpeed.type==t.ParticleValueType.OneBezier){var b=new t.ParticleRotationOneBezierNode;b.initNode(this._data.rotationSpeed),e.push(b)}else if(this._data.rotationSpeed.type==t.ParticleValueType.TwoBezier){var D=new t.ParticleRotationTwoBezierNode;D.initNode(this._data.rotationSpeed),e.push(D)}if(this._data.colorOffset){var T=new t.ParticleColorGlobalNode;T.initNode(this._data.colorOffset),e.push(T)}if(this._data.materialData)for(var w,P=0,S=this._data.materialData.methods;P<S.length;P++)if(w=S[P],w.type==t.MatMethodData.methodType.lightmapMethod);else if(w.type==t.MatMethodData.methodType.uvRollMethod){var A=new t.ParticleUVRollNode;A.initNode(null,w),e.push(A)}else w.type==t.MatMethodData.methodType.alphaMaskMethod||w.type==t.MatMethodData.methodType.streamerMethod;if(this._data.textureSheet){var C=new t.ParticleTextureSheetNode;C.initNode(null,this._data.textureSheet),e.push(C)}for(var E=0,M=e.length;M>E;E++)this._particleAnimation.particleAnimationState.addNode(e[E])},i.prototype.initUserAnimNode=function(){for(var t=0;t<this._userNodes.length;t++)this._particleAnimation.particleAnimationState.addNode(this._userNodes[t])},i.prototype.initEndNode=function(){var e=new t.ParticleEndNode;this._particleAnimation.particleAnimationState.addNode(e),this._particleAnimation.particleAnimationState.calculate(this.geometry)},i.prototype.initBoudBox=function(e){var i=new t.BoundBox(this);i.fillBox(new t.Vector3D(-e.x/2,-e.y/2,-e.z/2),new t.Vector3D(e.x/2,e.y/2,e.z/2)),this.bound=i,this.initAABB()},Object.defineProperty(i.prototype,"loopProgress",{get:function(){var t;return t=this.animation.animTime/(1e3*this._particleState.circleTime)},enumerable:!0,configurable:!0}),i.prototype.update=function(t,i,r){this._isEmitterDirty&&this.buildParticle(),e.prototype.update.call(this,t,i,r)},i.prototype.clone=function(){var e;e=new i(this.data,this.material),e.position=this.position,e.orientation=this.orientation,e.scale=this.scale;var r=[t.ParticleDataSubEmitterPhase.BIRTH,t.ParticleDataSubEmitterPhase.COLLISION,t.ParticleDataSubEmitterPhase.DEATH];if(this._subEmitterNode)for(var a=0;a<r.length;a++){var n=r[a],o=this._subEmitterNode.getSubEmitters(n);if(o&&o.length>0)for(var s=0;s<o.length;s++)e.addSubEmitter(n,o[s])}return e},i.prototype.dispose=function(){e.prototype.dispose.call(this),this._generator&&(this._generator.dispose(),this._generator=null),this._timeNode=null,this._positionNode=null,this._geometryShape=null,this._externalGeometry=null,this._particleAnimation=null,this._particleState&&(this._particleState.dispose(),this._particleState=null),this._subEmitterNode=null,this._userNodes=null,this._data=null},i}(t.Mesh);t.ParticleEmitter=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(t){this._animations=[],this._animCount=0,this._animations=[],this.collectAnimations(t,this._animations),this._timeOffset=[],this._animCount=this._timeOffset.length=this._animations.length;for(var e=0;e<this._animCount;e++)this._timeOffset[e]=0}return e.prototype.collectAnimations=function(e,i){var r,a;e instanceof t.Mesh&&(r=e,a=r.animation,a&&i.push(a));for(var n=e.childs.length,o=0;n>o;o++)this.collectAnimations(e.childs[o],i)},e.prototype.play=function(t,e,i,r){for(var a;a<this._animCount;a++){var n=this._animations[a];n.play(t,e,i,r)}this._isPlay=!0},e.prototype.resetTime=function(t){void 0===t&&(t=0);for(var e;e<this._animCount;e++){var i=this._animations[e];i.animTime=this._timeOffset[e]+t}},e.prototype.stop=function(){for(var t;t<this._animCount;t++)this._animations[t].stop();this._isPlay=!1},e.prototype.isPlay=function(){return this._isPlay},e.prototype.dispose=function(){this.stop(),this._animations.length=0,this._animations=null},e}();t.EffectGroup=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){void 0===i&&(i=null),e.call(this,i),this.addEventListener(t.LoaderEvent3D.LOADER_COMPLETE,this.onResourceLoaded,this)}return __extends(i,e),i.prototype.onResourceLoaded=function(){this.removeEventListener(t.LoaderEvent3D.LOADER_COMPLETE,this.onResourceLoaded,this),this._effectGroup=new t.EffectGroup(this.container)},Object.defineProperty(i.prototype,"effectGroup",{get:function(){return this._effectGroup},enumerable:!0,configurable:!0}),i}(t.MapLoader);t.EffectGroupLoader=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.enablePick=!1,this.pickRender=new t.MultiRender(t.PassType.PickPass),this.pickRender.setRenderToTexture(128,128,t.FrameBufferFormat.UNSIGNED_BYTE_RGBA)}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e.prototype.update=function(e,i,r,a,n){t.Egret3DCanvas.context3DProxy.clearColor(1,1,1,1),t.Egret3DCanvas.context3DProxy.clear(t.Context3DProxy.gl.COLOR_BUFFER_BIT|t.Context3DProxy.gl.DEPTH_BUFFER_BIT),this.pickRender.draw(r,a,t.Egret3DCanvas.context3DProxy,e,i,n)},e}();t.PickSystem=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this._root=new t.Object3D,this._tree=new t.TreeBase(this._root)}return Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"quad",{get:function(){return this._quad},enumerable:!0,configurable:!0}),e.prototype.addChild3D=function(t){this._root.addChild(t)},e.prototype.removeChild3D=function(t){this._root.removeChild(t)},e.prototype.update=function(){},e.prototype.infrustumList=function(t){return this._tree.infrustumList(t)},e.prototype.createQuadTree=function(){this._quad=new t.QuadRoot(16,2500);var e=new Array;this.collectQuadList(e,this.root),this._quad.createQuadTree(e)},e.prototype.collectQuadList=function(e,i){e=e||new Array;var r;i instanceof t.Mesh&&(r=i,r.aabb&&e.push(r));var a;if(i.childs&&i.childs.length>0)for(var n=0,o=i.childs;n<o.length;n++)a=o[n],this.collectQuadList(e,a);return e},e}();t.Scene3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(t){this._searchList=new Array,this._root=t}return t.prototype.infrustumList=function(){return this._searchList.length=0,this._searchList},t}();t.TreeBase=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.useMipmap=!0,this.smooth=!0,this.repeat=!1,this.premultiply_alpha=0,this.filp_y=0,this.hasMipmap=!1,this.ready=!1}return e.prototype.copyFromTexture=function(e,i,r,a,n){this.parentTexture=e,e.width=a,e.height=n,this.guiIndex=e.guiIndex,this.texture2D=e.texture2D,this.uvRectangle=this.uvRectangle||new t.Rectangle,this.uvRectangle.x=i,this.uvRectangle.y=r,this.uvRectangle.width=a,this.uvRectangle.height=n},e.prototype.upload=function(){},e.prototype.uploadForcing=function(){},e.prototype.activeState=function(e){this.ready||(this.ready=!0,this.premultiply_alpha||t.Context3DProxy.gl.pixelStorei(t.Context3DProxy.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this.useMipmap&&!this.hasMipmap&&(t.Context3DProxy.gl.generateMipmap(t.Context3DProxy.gl.TEXTURE_2D),this.hasMipmap=!0),this.smooth?this.hasMipmap?(e.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_MIN_FILTER,t.Context3DProxy.gl.LINEAR_MIPMAP_LINEAR),e.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_MAG_FILTER,t.Context3DProxy.gl.LINEAR)):(e.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_MIN_FILTER,t.Context3DProxy.gl.LINEAR),e.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_MAG_FILTER,t.Context3DProxy.gl.LINEAR)):(e.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_MIN_FILTER,t.Context3DProxy.gl.NEAREST),e.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_MAG_FILTER,t.Context3DProxy.gl.NEAREST)),this.repeat?(e.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_WRAP_S,t.Context3DProxy.gl.REPEAT),e.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_WRAP_T,t.Context3DProxy.gl.REPEAT)):(e.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_WRAP_S,t.Context3DProxy.gl.CLAMP_TO_EDGE),e.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_WRAP_T,t.Context3DProxy.gl.CLAMP_TO_EDGE)),this.filp_y&&t.Context3DProxy.gl.pixelStorei(t.Context3DProxy.gl.UNPACK_FLIP_Y_WEBGL,this.filp_y))},e.prototype.dispose=function(){this.texture2D&&this.texture2D.dispose(),this.texture3D&&this.texture3D.dispose()},e}();t.ITexture=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){e.call(this),this.imageData=i,this.texture2D=new t.ContextTexture2D,this.texture2D.imageData=i}return __extends(i,e),Object.defineProperty(i.prototype,"width",{get:function(){return this.imageData.width},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this.imageData.height},enumerable:!0,configurable:!0}),i.prototype.upload=function(e){this.texture2D.textureBuffer||(this.texture2D.textureBuffer=this.texture2D.textureBuffer||e.creatTexture(),this.texture2D.internalFormat=t.InternalFormat.ImageData,this.texture2D.imageData=this.imageData,this.texture2D.dataFormat=t.Context3DProxy.gl.UNSIGNED_BYTE,this.texture2D.colorFormat=t.ContextConfig.ColorFormat_RGBA8888,e.upLoadTextureData(0,this))},i.prototype.uploadForcing=function(t){t.upLoadTextureData(0,this)},i}(t.ITexture);t.ImageTexture=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.smooth=!0,this.texture2D=new t.ContextTexture2D}return __extends(i,e),i.prototype.upload=function(e){if(!this.texture2D.textureBuffer){if(this.texture2D.textureBuffer=this.texture2D.textureBuffer||e.creatTexture(),this.texture2D.internalFormat=this.internalFormat,this.texture2D.colorFormat=this.colorFormat,this.texture2D.mimapData=this.mimapData,this.texture2D.dataFormat=t.Context3DProxy.gl.UNSIGNED_BYTE,this.mimapData&&this.mimapData.length>0)for(var i=0;i<this.mimapData.length;i++)e.upLoadTextureData(i,this);else e.upLoadTextureData(0,this);this.parentTexture&&(this.parentTexture.texture2D||this.parentTexture.upload(e),this.texture2D=this.parentTexture.texture2D,this.texture2D.internalFormat=this.parentTexture.internalFormat,this.texture2D.colorFormat=this.parentTexture.colorFormat,this.texture2D.mimapData=this.parentTexture.mimapData)}},i.prototype.uploadForcing=function(t){t.upLoadTextureData(0,this)},i}(t.ITexture);t.Texture=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r,a,n,o,s){void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===s&&(s=null),e.call(this),this.image_front=i,this.image_back=r,this.image_left=a,this.image_right=n,this.image_up=o,this.image_down=s,this.texture3D=new t.ContextTexture3D}return __extends(i,e),i.createCubeTexture=function(e,r,a,n,o,s){var h=new t.ContextTexture2D;h.imageData=e;var l=new t.ContextTexture2D;l.imageData=r;var u=new t.ContextTexture2D;u.imageData=a;var c=new t.ContextTexture2D;c.imageData=n;var d=new t.ContextTexture2D;d.imageData=o;var p=new t.ContextTexture2D;p.imageData=s;var f=new i(h,l,u,c,d,p);return f},i.createCubeTextureByImageTexture=function(t,e,r,a,n,o){return new i(t.texture2D,e.texture2D,r.texture2D,a.texture2D,n.texture2D,o.texture2D)},i.setCubeTexture=function(t,e,i,r,a,n,o){t.image_front=e.texture2D,t.image_back=i.texture2D,t.image_left=r.texture2D,t.image_right=a.texture2D,t.image_up=n.texture2D,t.image_down=o.texture2D},i.prototype.upload=function(t){this.image_front&&this.image_back&&this.image_left&&this.image_right&&this.image_up&&this.image_down&&(this.texture3D.texture||(this.texture3D.texture=this.texture3D.texture||t.creatTexture(),this.texture3D.border=0,this.texture3D.image_front=this.image_front,this.texture3D.image_back=this.image_back,this.texture3D.image_left=this.image_left,this.texture3D.image_right=this.image_right,this.texture3D.image_up=this.image_up,this.texture3D.image_down=this.image_down,t.uploadCubetexture(this.texture3D)))},i.prototype.uploadForcing=function(){},i}(t.ITexture);t.CubeTexture=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(){e.call(this),this.width=32,this.height=32,this.uvRectangle=new t.Rectangle(0,0,1,1),this.buildCheckerboard(),this.texture2D=new t.ContextTexture2D}return __extends(i,e),i.prototype.upload=function(e){this.texture2D.textureBuffer||(this.texture2D.textureBuffer=this.texture2D.textureBuffer||e.creatTexture(),this.texture2D.border=0,this.texture2D.internalFormat=t.InternalFormat.PixelArray,this.texture2D.colorFormat=t.Context3DProxy.gl.RGBA,this.texture2D.mimapData=new Array,this.texture2D.mimapData.push(new t.MipmapData(this._pixelArray,this.width,this.height)),this.texture2D.width=this.width,this.texture2D.height=this.height,this.useMipmap=!1,this.texture2D.dataFormat=t.Context3DProxy.gl.UNSIGNED_BYTE,e.upLoadTextureData(0,this))},i.prototype.buildCheckerboard=function(){if(!this._pixelArray){this._pixelArray=new Uint8Array(this.width*this.height*4);for(var e=[t.Color.white(),t.Color.black()],i=0,r=4,a=0;a<this.height;a++)for(var n=0;n<this.width;n++){if(n%r==0&&(i=(i+1)%2),a%r==0&&0==n){var o=e[0];e[0]=e[1],e[1]=o,i=0}this._pixelArray[4*a*this.width+4*n+0]=e[i].r,this._pixelArray[4*a*this.width+4*n+1]=e[i].g,this._pixelArray[4*a*this.width+4*n+2]=e[i].b,this._pixelArray[4*a*this.width+4*n+3]=e[i].a}}},i.prototype.uploadForcing=function(){},i.texture=new i,i}(t.ITexture);t.CheckerboardTexture=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r){var a=this;void 0===i&&(i=256),void 0===r&&(r=256),e.call(this),this.canUpdataTexture=!1,this.width=i,this.height=r,this.texture2D=new t.ContextTexture2D,this.tmpCanvas=document.createElement("canvas"),this.tmpCanvas.width=i,this.tmpCanvas.height=r,this.context=this.tmpCanvas.getContext("2d"),this.video=document.createElement("video"),this.video.msZoom=!0,this.video.width=i,this.video.height=r,this.video.videoWidth=i,this.video.videoHeight=r,this.video.controls=!1,this.video.autoplay=!0,this.video.addEventListener("canplaythrough",function(){return a.loadReady()},!0),this.tmpCanvas.hidden=!0}return __extends(i,e),i.prototype.loadReady=function(){this.canUpdataTexture=!0},Object.defineProperty(i.prototype,"source",{get:function(){return this.video.src},set:function(t){this.video.src=t},enumerable:!0,configurable:!0}),i.prototype.play=function(){this.video.play()},i.prototype.pause=function(){this.video.pause()},i.prototype.upload=function(e){this.texture2D.textureBuffer||(this.texture2D.textureBuffer=this.texture2D.textureBuffer||e.creatTexture(),this.context.drawImage(this.video,0,0,this.width,this.height),t.Context3DProxy.gl.pixelStorei(t.Context3DProxy.gl.UNPACK_ALIGNMENT,1),t.Context3DProxy.gl.bindTexture(t.Context3DProxy.gl.TEXTURE_2D,this.texture2D.textureBuffer),t.Context3DProxy.gl.texImage2D(t.Context3DProxy.gl.TEXTURE_2D,0,t.Context3DProxy.gl.RGB,t.Context3DProxy.gl.RGB,t.Context3DProxy.gl.UNSIGNED_BYTE,this.tmpCanvas),t.Context3DProxy.gl.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_MIN_FILTER,t.Context3DProxy.gl.LINEAR),t.Context3DProxy.gl.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_MAG_FILTER,t.Context3DProxy.gl.LINEAR),t.Context3DProxy.gl.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_WRAP_S,t.Context3DProxy.gl.CLAMP_TO_EDGE),t.Context3DProxy.gl.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_WRAP_T,t.Context3DProxy.gl.CLAMP_TO_EDGE)),this.canUpdataTexture&&(this.context.drawImage(this.video,0,0,this.width,this.height),t.Context3DProxy.gl.pixelStorei(t.Context3DProxy.gl.UNPACK_ALIGNMENT,1),t.Context3DProxy.gl.bindTexture(t.Context3DProxy.gl.TEXTURE_2D,this.texture2D.textureBuffer),t.Context3DProxy.gl.texImage2D(t.Context3DProxy.gl.TEXTURE_2D,0,t.Context3DProxy.gl.RGB,t.Context3DProxy.gl.RGB,t.Context3DProxy.gl.UNSIGNED_BYTE,this.tmpCanvas),t.Context3DProxy.gl.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_MIN_FILTER,t.Context3DProxy.gl.LINEAR),t.Context3DProxy.gl.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_MAG_FILTER,t.Context3DProxy.gl.LINEAR),t.Context3DProxy.gl.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_WRAP_S,t.Context3DProxy.gl.CLAMP_TO_EDGE),t.Context3DProxy.gl.texParameteri(t.Context3DProxy.gl.TEXTURE_2D,t.Context3DProxy.gl.TEXTURE_WRAP_T,t.Context3DProxy.gl.CLAMP_TO_EDGE))},i.prototype.uploadForcing=function(){},i}(t.ITexture);t.VideoTexture=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r,a){void 0===i&&(i=512),void 0===r&&(r=512),void 0===a&&(a=t.FrameBufferFormat.UNSIGNED_BYTE_RGB),e.call(this),this.frameBufferFormat=t.FrameBufferFormat.UNSIGNED_BYTE_RGB,this.useMipmap=!1,this.smooth=!1,this.width=i,this.height=r,this.frameBufferFormat=a,this.uvRectangle=new t.Rectangle(0,0,1,1)}return __extends(i,e),i.prototype.upload=function(t){this.texture2D||(this.texture2D=t.createFramebuffer(this.width,this.height,this.frameBufferFormat))},i.prototype.uploadForcing=function(){},i}(t.ITexture);t.RenderTexture=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){}return t.LITTLE_ENDIAN="littleEndian",t.BIG_ENDIAN="bigEndian",t}();t.Endian=e;var i=function(){function t(t){this.BUFFER_EXT_SIZE=0,this.EOF_byte=-1,this.EOF_code_point=-1,this._setArrayBuffer(t||new ArrayBuffer(this.BUFFER_EXT_SIZE)),this.endian=e.BIG_ENDIAN}return t.prototype._setArrayBuffer=function(t){this.write_position=t.byteLength,this.data=new DataView(t),this._position=0},t.prototype.setArrayBuffer=function(){},Object.defineProperty(t.prototype,"buffer",{get:function(){return this.data.buffer},set:function(t){this.data=new DataView(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataView",{get:function(){return this.data},set:function(t){this.data=t,this.write_position=t.byteLength},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bufferOffset",{get:function(){return this.data.byteOffset},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t,this.write_position=t>this.write_position?t:this.write_position},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this.write_position},set:function(t){this.write_position=t;var e=new Uint8Array(new ArrayBuffer(t)),i=this.data.buffer.byteLength;i>t&&(this._position=t);var r=Math.min(i,t);e.set(new Uint8Array(this.data.buffer,0,r)),this.buffer=e.buffer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bytesAvailable",{get:function(){return this.data.byteLength-this._position},enumerable:!0,configurable:!0}),t.prototype.clear=function(){this._setArrayBuffer(new ArrayBuffer(this.BUFFER_EXT_SIZE))},t.prototype.readBoolean=function(){return this.validate(t.SIZE_OF_BOOLEAN)?0!=this.data.getUint8(this.position++):null},t.prototype.readByte=function(){return this.validate(t.SIZE_OF_INT8)?this.data.getInt8(this.position++):null},t.prototype.readBytes=function(e,i,r){if(void 0===i&&(i=0),void 0===r&&(r=0),0==r)r=this.bytesAvailable;else if(!this.validate(r))return null;e?e.validateBuffer(i+r):e=new t(new ArrayBuffer(i+r));for(var a=0;r>a;a++)e.data.setUint8(a+i,this.data.getUint8(this.position++))},t.prototype.readDouble=function(){if(!this.validate(t.SIZE_OF_FLOAT64))return null;var i=this.data.getFloat64(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=t.SIZE_OF_FLOAT64,i},t.prototype.readFloat=function(){if(!this.validate(t.SIZE_OF_FLOAT32))return null;var i=this.data.getFloat32(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=t.SIZE_OF_FLOAT32,i},t.prototype.readInt=function(){if(!this.validate(t.SIZE_OF_INT32))return null;var i=this.data.getInt32(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=t.SIZE_OF_INT32,i},t.prototype.readShort=function(){if(!this.validate(t.SIZE_OF_INT16))return null;var i=this.data.getInt16(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=t.SIZE_OF_INT16,i},t.prototype.readUnsignedByte=function(){return this.validate(t.SIZE_OF_UINT8)?this.data.getUint8(this.position++):null},t.prototype.readUnsignedInt=function(){if(!this.validate(t.SIZE_OF_UINT32))return null;var i=this.data.getUint32(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=t.SIZE_OF_UINT32,i},t.prototype.readUnsignedShort=function(){if(!this.validate(t.SIZE_OF_UINT16))return null;var i=this.data.getUint16(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=t.SIZE_OF_UINT16,i},t.prototype.readUTF=function(){if(!this.validate(t.SIZE_OF_UINT16))return null;var i=this.data.getUint16(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=t.SIZE_OF_UINT16,i>0?this.readUTFBytes(i):""},t.prototype.readUTFBytes=function(t){if(!this.validate(t))return null;var e=new Uint8Array(this.buffer,this.bufferOffset+this.position,t);return this.position+=t,this.decodeUTF8(e)},t.prototype.writeBoolean=function(e){this.validateBuffer(t.SIZE_OF_BOOLEAN),this.data.setUint8(this.position++,e?1:0)},t.prototype.writeByte=function(e){this.validateBuffer(t.SIZE_OF_INT8),this.data.setInt8(this.position++,e)},t.prototype.writeBytes=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);var r;if(!(0>e)&&!(0>i)&&(r=0==i?t.length-e:Math.min(t.length-e,i),r>0)){this.validateBuffer(r);for(var a=new DataView(t.buffer),i=r,n=4;i>n;i-=n)this.data.setUint32(this._position,a.getUint32(e)),this.position+=n,e+=n;for(;i>0;i--)this.data.setUint8(this.position++,a.getUint8(e++))}},t.prototype.writeDouble=function(i){this.validateBuffer(t.SIZE_OF_FLOAT64),this.data.setFloat64(this.position,i,this.endian==e.LITTLE_ENDIAN),this.position+=t.SIZE_OF_FLOAT64},t.prototype.writeFloat=function(i){this.validateBuffer(t.SIZE_OF_FLOAT32),this.data.setFloat32(this.position,i,this.endian==e.LITTLE_ENDIAN),this.position+=t.SIZE_OF_FLOAT32},t.prototype.writeInt=function(i){this.validateBuffer(t.SIZE_OF_INT32),this.data.setInt32(this.position,i,this.endian==e.LITTLE_ENDIAN),this.position+=t.SIZE_OF_INT32},t.prototype.writeShort=function(i){this.validateBuffer(t.SIZE_OF_INT16),this.data.setInt16(this.position,i,this.endian==e.LITTLE_ENDIAN),this.position+=t.SIZE_OF_INT16},t.prototype.writeUnsignedInt=function(i){this.validateBuffer(t.SIZE_OF_UINT32),this.data.setUint32(this.position,i,this.endian==e.LITTLE_ENDIAN),this.position+=t.SIZE_OF_UINT32},t.prototype.writeUnsignedShort=function(i){this.validateBuffer(t.SIZE_OF_UINT16),this.data.setUint16(this.position,i,this.endian==e.LITTLE_ENDIAN),this.position+=t.SIZE_OF_UINT16},t.prototype.writeUTF=function(i){var r=this.encodeUTF8(i),a=r.length;this.validateBuffer(t.SIZE_OF_UINT16+a),this.data.setUint16(this.position,a,this.endian==e.LITTLE_ENDIAN),this.position+=t.SIZE_OF_UINT16,this._writeUint8Array(r,!1)},t.prototype.writeUTFBytes=function(t){this._writeUint8Array(this.encodeUTF8(t))},t.prototype.toString=function(){return"[ByteArray] length:"+this.length+", bytesAvailable:"+this.bytesAvailable},t.prototype._writeUint8Array=function(t,e){void 0===e&&(e=!0),e&&this.validateBuffer(this.position+t.length);for(var i=0;i<t.length;i++)this.data.setUint8(this.position++,t[i])},t.prototype.validate=function(t){return this.data.byteLength>0&&this._position+t<=this.data.byteLength?!0:void 0},t.prototype.validateBuffer=function(t,e){if(void 0===e&&(e=!1),this.write_position=t>this.write_position?t:this.write_position,t+=this._position,this.data.byteLength<t||e){var i=new Uint8Array(new ArrayBuffer(t+this.BUFFER_EXT_SIZE)),r=Math.min(this.data.buffer.byteLength,t+this.BUFFER_EXT_SIZE);i.set(new Uint8Array(this.data.buffer,0,r)),this.buffer=i.buffer}},t.prototype.encodeUTF8=function(t){for(var e=0,i=this.stringToCodePoints(t),r=[];i.length>e;){var a=i[e++];if(this.inRange(a,55296,57343))this.encoderError(a);else if(this.inRange(a,0,127))r.push(a);else{var n,o;for(this.inRange(a,128,2047)?(n=1,o=192):this.inRange(a,2048,65535)?(n=2,o=224):this.inRange(a,65536,1114111)&&(n=3,o=240),r.push(this.div(a,Math.pow(64,n))+o);n>0;){var s=this.div(a,Math.pow(64,n-1));r.push(128+s%64),n-=1}}}return new Uint8Array(r)},t.prototype.decodeUTF8=function(t){for(var e,i=!1,r=0,a="",n=0,o=0,s=0,h=0;t.length>r;){var l=t[r++];if(l==this.EOF_byte)e=0!=o?this.decoderError(i):this.EOF_code_point;else if(0==o)this.inRange(l,0,127)?e=l:(this.inRange(l,194,223)?(o=1,h=128,n=l-192):this.inRange(l,224,239)?(o=2,h=2048,n=l-224):this.inRange(l,240,244)?(o=3,h=65536,n=l-240):this.decoderError(i),n*=Math.pow(64,o),e=null);else if(this.inRange(l,128,191))if(s+=1,n+=(l-128)*Math.pow(64,o-s),s!==o)e=null;else{var u=n,c=h;n=0,o=0,s=0,h=0,e=this.inRange(u,c,1114111)&&!this.inRange(u,55296,57343)?u:this.decoderError(i,l)}else n=0,o=0,s=0,h=0,r--,e=this.decoderError(i,l);null!==e&&e!==this.EOF_code_point&&(65535>=e?e>0&&(a+=String.fromCharCode(e)):(e-=65536,a+=String.fromCharCode(55296+(e>>10&1023)),a+=String.fromCharCode(56320+(1023&e))))}return a},t.prototype.encoderError=function(){},t.prototype.decoderError=function(t,e){return e||65533},t.prototype.inRange=function(t,e,i){return t>=e&&i>=t},t.prototype.div=function(t,e){return Math.floor(t/e)},t.prototype.stringToCodePoints=function(t){for(var e=[],i=0,r=t.length;i<t.length;){var a=t.charCodeAt(i);if(this.inRange(a,55296,57343))if(this.inRange(a,56320,57343))e.push(65533);else if(i==r-1)e.push(65533);else{var n=t.charCodeAt(i+1);if(this.inRange(n,56320,57343)){var o=1023&a,s=1023&n;i+=1,e.push(65536+(o<<10)+s)}else e.push(65533)}else e.push(a);i+=1}return e},t.SIZE_OF_BOOLEAN=1,t.SIZE_OF_INT8=1,t.SIZE_OF_INT16=2,t.SIZE_OF_INT32=4,t.SIZE_OF_UINT8=1,t.SIZE_OF_UINT16=2,t.SIZE_OF_UINT32=4,t.SIZE_OF_FLOAT32=4,t.SIZE_OF_FLOAT64=8,t}();t.ByteArray=i}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){this.isDebug=!1,this._console=document.createElement("console"),document.body.appendChild(this._console),this._console.style.color="red",this._console.style.zIndex="1000",this._console.style.position="absolute",this._console.style.top="10px",this._console.style.left="10px"
}return t.prototype.trace=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];if(this.isDebug){this.reset();for(var i=t.length,r=0;i>r;r++)this._console.innerHTML+=t[r]+"</br>"}},t.prototype.reset=function(){this._console.innerHTML=""},Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t._instance=null,t}();t.Debug=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.parseContent=function(t){for(var e=new Array,i="",r=";",a=-1,n=0;n<t.length;++n)if("{"==t.charAt(n)&&(a=i.indexOf("="),0>a&&(r="}")),(""!=i||" "!=t.charAt(n)&&"    "!=t.charAt(n)&&"	"!=t.charAt(n))&&(i+=t.charAt(n),"\n"!=r&&(i.indexOf("#extension")>=0?r="\n":i.indexOf("#define")>=0&&(r="\n")),r==t.charAt(n))){if("}"==r){for(var o=0,s=0,h=0;h<i.length;++h)"{"==i.charAt(h)?o++:"}"==i.charAt(h)&&s++;if(o!=s)continue;if(i.indexOf("struct")>=0){r=";";continue}}i.length>0&&e.push(i),i="",r=";"}return e},e.parseLines=function(t){for(var e=new Array,i="",r=!1,a=0;a<t.length;++a)if(r){if(";"==t.charAt(a)){r=!1,i.length>0&&(e.push(i),i="");break}i+=t.charAt(a)}else if(" "!=t.charAt(a)&&"	"!=t.charAt(a)&&","!=t.charAt(a)&&"\r"!=t.charAt(a)&&"\n"!=t.charAt(a)&&":"!=t.charAt(a)){if(";"==t.charAt(a)){i.length>0&&(e.push(i),i="");break}if("="==t.charAt(a)){i.length>0&&(e.push(i),i=""),e.push("="),r=!0;continue}i+=t.charAt(a),a==t.length-1&&""!=t&&(e.push(i),i="")}else""!=i&&(e.push(i),i="");return e},e.hasString=function(t,e){for(var i=0;i<t.length;++i)if(t[i]==e)return i;return-1},e.getVarName=function(t){var e=this.hasString(t,"=");if(e>=0){if(e-=1,e>=0&&e<t.length)return t[e]}else if(e=t.length-1,e>=0&&e<t.length)return t[e];return""},e.getVarValue=function(t){var e=this.hasString(t,"=");return e>=0&&(e+=1,e>=0&&e<t.length)?t[e]:""},e.getVarType=function(t){var e=this.hasString(t,"=");if(e>=0){if(e-=2,e>=0&&e<t.length)return t[e]}else if(e=t.length-2,e>=0&&e<t.length)return t[e];return""},e.getVarKey=function(t){var e=this.hasString(t,"=");return e>=0?(e-=3,e>=0&&e<t.length?t[e]:""):(e=t.length-3,e>=0&&e<t.length?t[e]:t[0])},e.processShaderFile=function(t){var e=["\n","\r"];e=[];for(var i=t,r=i;;){var a=i.indexOf("//");if(0>a)break;var n=i.indexOf("\r\n",a);-1==n&&(n=i.indexOf("\n",a));var o=i.slice(a,n);if(i=i.replace(o,""),i==r)break;r=i}for(var s=0;s<e.length;++s)for(;r=i.replace(e[s],""),i!=r;)i=r;return i},e.colorRgb=function(t){var e=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/,i=t.toLowerCase();if(i&&e.test(i)){if(4===i.length){for(var r="#",a=1;4>a;a+=1)r+=i.slice(a,a+1).concat(i.slice(a,a+1));i=r}for(var n=[],a=1;7>a;a+=2)n.push(parseInt("0x"+i.slice(a,a+2)));return"RGB("+n.join(",")+")"}return i},e.getLineType=function(t){var e=t.indexOf("{");if(e>0){var i=t.substr(0,e);if(i.indexOf("struct")>=0){var r=i.lastIndexOf(" ");r++;var a=i.substr(r,i.length-r);return"struct "+a}if(i.indexOf("=")<0){var n=t.indexOf("("),r=t.lastIndexOf(" ",n);r++;var o=t.substr(r,n-r);return"function "+o}}return"unknown"},e.processStruct=function(t,i,r){var a=i.lastIndexOf("}");a++;for(var n=i.lastIndexOf(";"),o=i.substr(a,n-a),s=e.parseLines(o),h=0;h<s.length;++h){var l=e.getTemper(t+" "+s[h]+";");l&&r.addVar(l)}},e.getAttribute=function(i){var r,a,n,o=i,s=e.parseLines(o);return r=e.getVarName(s),a=e.getVarType(s),n=new t.GLSL.Attribute(r,a),n.value=e.getVarValue(s),n},e.getTemper=function(i){var r,a,n,o=i,s=e.parseLines(o);return r=e.getVarName(s),a=e.getVarType(s),n=new t.GLSL.TmpVar(r,a),n.value=e.getVarValue(s),n},e.getVarying=function(i){var r,a,n,o=i,s=e.parseLines(o);return r=e.getVarName(s),a=e.getVarType(s),n=new t.GLSL.Varying(r,a)},e.getUniform=function(i){var r,a,n,o=i,s=e.parseLines(o);return r=e.getVarName(s),a=e.getVarType(s),n=new t.GLSL.Uniform(r,a)},e.getConst=function(i){var r,a,n,o,s=i,h=e.parseLines(s);return r=e.getVarName(h),a=e.getVarType(h),n=e.getVarValue(h),o=new t.GLSL.ConstVar(r,a,n)},e.getExtension=function(i){var r=i.indexOf("#"),a=i.indexOf(" "),n=(i.substr(r,a),i.indexOf(":")),o=i.substr(a,n-a);o=e.replaceCharacter(o,[" "],""),n+=1;var s=i.substr(n,i.length-n);s=e.replaceCharacter(s,[" ",":","\n","\r"],"");var h=new t.GLSL.Extension(o);return h.value=s,h},e.getDefine=function(i){var r,a=i,n="",o="",s=e.parseLines(a);return n=s[1],s.length>=3&&(o=s[2]),r=new t.GLSL.DefineVar(n,o)},e.getSampler2D=function(i){var r,a,n=i,o=e.parseLines(n);return r=e.getVarName(o),a=new t.GLSL.Sampler2D(r)},e.getSampler3D=function(i){var r,a,n=i,o=e.parseLines(n);return r=e.getVarName(o),a=new t.GLSL.Sampler3D(r)},e.filterCharacter=function(t){for(var i=t,r=i,a=0;a<e._filterChar.length;++a)for(;r=i.replace(e._filterChar[a],""),i!=r;)i=r;return r},e.replaceCharacter=function(t,e,i){for(var r=t,a=!1;!a;){a=!0;for(var n=0;n<e.length;++n)if(r.indexOf(e[n])>=0){a=!1;break}for(var n=0;n<e.length;++n)r=r.replace(e[n],i)}return r},e.getURLName=function(t){var e=t.split(".");return e=e[0].split("/"),e[e.length-1]},e._filterChar=[" ","  ",";","\n","\r","	","\n","\r","	"],e}();t.StringUtil=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i){void 0===i&&(i=100),e.call(this),this._xMat=new t.ColorMaterial(16711680),this._xMat.ambientColor=15790320,this._yMat=new t.ColorMaterial(65280),this._yMat.ambientColor=15790320,this._zMat=new t.ColorMaterial(255),this._zMat.ambientColor=15790320;var r,a=i/100;r=new t.CubeGeometry(i,a,a),this._lineX=new t.Mesh(r,this._xMat),this.addChild(this._lineX),r=new t.CubeGeometry(a,i,a),this._lineY=new t.Mesh(r,this._yMat),this.addChild(this._lineY),r=new t.CubeGeometry(a,a,i),this._lineZ=new t.Mesh(r,this._zMat),this.addChild(this._lineZ);var n=i/25,o=(i-n)/2;r=new t.CubeGeometry(n,n,n),this._boxX=new t.Mesh(r,this._xMat),this._boxX.position=new t.Vector3D(o,0,0),this.addChild(this._boxX),this._boxY=new t.Mesh(r,this._yMat),this._boxY.position=new t.Vector3D(0,o,0),this.addChild(this._boxY),this._boxZ=new t.Mesh(r,this._zMat),this._boxZ.position=new t.Vector3D(0,0,o),this.addChild(this._boxZ)}return __extends(i,e),i}(t.Object3D);t.AxisMesh=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e){void 0===e&&(e=null),this.cameraAnimationFrames=[],this._playing=!1,this._playTime=0,this._currentFrameIndex=0,this._loop=!0,this._smooth=!0,this._cameraAnimationFrame=new i,this._event=new t.Event3D,this._quatCurrentFrame=new t.Quaternion,this._quatnNextFrame=new t.Quaternion,this._quatn=new t.Quaternion,this._camera=e,this._cameraAnimationFrame.fov=45,this._cameraAnimationFrame.rotation=new t.Vector3D,this._cameraAnimationFrame.translation=new t.Vector3D}return e.prototype.bindCamera=function(t){this._camera=t},e.prototype.play=function(t){this.cameraAnimationFrames.length<=0||(this._loop=t,this._playTime=0,this._camera.isController=!1,this._playing=!0)},e.prototype.stop=function(){this._camera.isController=!0,this._playing=!1},e.prototype.update=function(t,i){if(this._playing){this._playTime+=5*i;var r=this._playTime%(this.cameraAnimationFrames[this.cameraAnimationFrames.length-1].time-this.cameraAnimationFrames[0].time+160),a=Math.floor(r/160)%this.cameraAnimationFrames.length;this._currentFrameIndex>a&&(this._loop||(this._playing=!1,this._camera.isController=!0),this._camera&&(this._event.eventType=e.EVENT_CAMERA_COMPLETE,this._event.target=this,this._camera.dispatchEvent(this._event))),this._currentFrameIndex=a;var n=this.cameraAnimationFrames[a];if(this._smooth){var o=(a+1)%this.cameraAnimationFrames.length,s=this.cameraAnimationFrames[o],h=(r-n.time)/Math.abs(s.time-n.time);this._cameraAnimationFrame.fov=(s.fov-n.fov)*h+n.fov,this._quatCurrentFrame.fromEulerAngles(n.rotation.x,n.rotation.y,n.rotation.z),this._quatnNextFrame.fromEulerAngles(s.rotation.x,s.rotation.y,s.rotation.z),this._quatn.lerp(this._quatCurrentFrame,this._quatnNextFrame,h),this._quatn.toEulerAngles(this._cameraAnimationFrame.rotation),this._cameraAnimationFrame.translation.lerp(n.translation,s.translation,h)}else this._cameraAnimationFrame.fov=n.fov,this._cameraAnimationFrame.rotation.copyFrom(n.rotation),this._cameraAnimationFrame.translation.copyFrom(n.translation);this._camera.rotation=this._cameraAnimationFrame.rotation,this._camera.position=this._cameraAnimationFrame.translation}},e.EVENT_CAMERA_COMPLETE="event_camera_complete",e}();t.CameraAnimationController=e;var i=function(){function t(){}return t}();t.CameraAnimationFrame=i}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){this.cameras=new Array}return t.prototype.addCamera=function(t){this.cameras.push(t)},t.prototype.update=function(){},t.instance=new t,t}();t.CameraManager=e}(egret3d||(egret3d={}));var egret3d;!function(t){!function(t){t[t.perspective=0]="perspective",t[t.orthogonal=1]="orthogonal",t[t.orthogonalToCenter=2]="orthogonalToCenter",t[t.VR=3]="VR"}(t.CameraType||(t.CameraType={}));var e=t.CameraType;!function(t){t[t.left=0]="left",t[t.right=1]="right"}(t.VRType||(t.VRType={}));var i=t.VRType,r=function(r){function a(i){void 0===i&&(i=e.perspective),r.call(this),this.projectMatrix=new t.Matrix4_4,this._orthProjectMatrix=new t.Matrix4_4,this._viewPort=new t.Rectangle,this._scissorRect=new t.Rectangle,this._aspectRatio=1,this._fovY=45,this._near=1,this._far=1e4,this.temp=new t.Matrix4_4,this._lookAtPosition=new t.Vector3D,this._up=new t.Vector3D(0,1,0),this._cameraType=0,this._cameraMatrixChange=!1,this._viewMatrix=new t.Matrix4_4,this._tempQuat=new t.Quaternion,this._normalMatrix=new t.Matrix4_4,this._unprojection=new t.Matrix4_4,this._animation=[],this.orthProjectChange=!0,this._mat=new t.Matrix4_4,this.raw=new Float32Array(16),this.v=new t.Vector3D,this.p=new t.Vector3D,this.frustum=new t.Frustum(this),this._orthProjectMatrix.ortho(this._viewPort.width,this._viewPort.height,this._near,this._far),this.cameraType=i,t.CameraManager.instance.addCamera(this)}return __extends(a,r),Object.defineProperty(a.prototype,"cameraType",{get:function(){return this._cameraType},set:function(i){switch(this._cameraType=i,i){case e.orthogonal:this.projectMatrix.ortho(this._viewPort.width,this._viewPort.height,this._near,this._far);break;case e.orthogonalToCenter:this.projectMatrix.orthoOffCenter(this._viewPort.x,this._viewPort.y,this._viewPort.width,this._viewPort.height,this._near,this._far);break;case e.perspective:this.projectMatrix.perspective(this._fovY,this._aspectRatio,this._near,this._far);break;case e.VR:this.projectMatrix.perspective(this._fovY,1,this._near,this._far),this.eyeMatrix=this.eyeMatrix||new t.EyesMatrix}this._orthProjectMatrix.ortho(this._viewPort.width,this._viewPort.height,this._near,this._far),this.frustum.updateFrustum()},enumerable:!0,configurable:!0}),a.prototype.tap=function(t,r){void 0===r&&(r=null),t==e.VR&&(this.eyeMatrix.update(this),this.orthProjectChange=!0,r==i.left?this.viewMatrix.copyFrom(this.eyeMatrix.leftEyeMatrix):r==i.right&&this.viewMatrix.copyFrom(this.eyeMatrix.rightEyeMatrix),this.viewMatrix.invert())},Object.defineProperty(a.prototype,"aspectRatio",{get:function(){return this._aspectRatio},set:function(t){this._aspectRatio!=t&&(this._aspectRatio=t,this.cameraType=this._cameraType)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fieldOfView",{get:function(){return this._fovY},set:function(t){this._fovY!=t&&(this._fovY=t,this.cameraType=this._cameraType)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"near",{get:function(){return this._near},set:function(t){this._near!=t&&(this._near=t,this.cameraType=this._cameraType)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"far",{get:function(){return this._far},set:function(t){this._far!=t&&(this._far=t,this.cameraType=this._cameraType)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"viewPort",{get:function(){return this._viewPort},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"viewProjectionMatrix",{get:function(){return this.temp.copyFrom(this.viewMatrix),this.temp.multiply(this.projectMatrix),this.temp},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"orthProjectionMatrix",{get:function(){return this.orthProjectChange&&(this.orthProjectChange=!1,this._orthProjectMatrix.ortho(this._viewPort.width,this._viewPort.height,this._near,this._far)),this._orthProjectMatrix},enumerable:!0,configurable:!0}),a.prototype.updateScissorRect=function(t,e,i,r){this._scissorRect.x=t,this._scissorRect.y=e,this._scissorRect.width=i,this._scissorRect.height=r},a.prototype.updateViewport=function(t,i,r,a){if(t!=this._viewPort.x||i!=this._viewPort.y||r!=this._viewPort.width||a!=this._viewPort.height)switch(this.orthProjectChange=!0,this._viewPort.x=t,this._viewPort.y=i,this._viewPort.width=r,this._viewPort.height=a,this.cameraType){case e.orthogonal:case e.orthogonalToCenter:this.cameraType=this.cameraType}},a.prototype.lookAt=function(e,i,r){void 0===r&&(r=t.Vector3D.Y_AXIS),this.position=e,this._lookAtPosition.copyFrom(i),this._up.copyFrom(r),this._viewMatrix.lookAt(this._pos,this._lookAtPosition,this._up),this._mat.copyFrom(this._viewMatrix),this._mat.invert();var a=this._mat.decompose(t.Orientation3D.QUATERNION);this._tempQuat.x=a[1].x,this._tempQuat.y=a[1].y,this._tempQuat.z=a[1].z,this._tempQuat.w=a[1].w,this.orientation=this._tempQuat},a.prototype.onUpdateTransform=function(){this._viewMatrix.copyFrom(this._modelMatrix3D),this._viewMatrix.invert(),this.frustum.update()},Object.defineProperty(a.prototype,"viewMatrix",{get:function(){return this._transformChange&&this.modelMatrix,this._viewMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"lookAtPosition",{get:function(){return this._lookAtPosition},enumerable:!0,configurable:!0}),a.prototype.updataOrth=function(t){var e,i,r,a,n=2e3,o=.5*n,s=o*this._aspectRatio;if(0==this._scissorRect.x&&0==this._scissorRect.y&&this._scissorRect.width==this._viewPort.width&&this._scissorRect.height==this._viewPort.height)e=-s,i=s,r=-o,a=o,this.raw[0]=2/(n*this._aspectRatio),this.raw[5]=2/n,this.raw[10]=1/(this._far-this._near),this.raw[14]=this._near/(this._near-this._far),this.raw[1]=this.raw[2]=this.raw[3]=this.raw[4]=this.raw[6]=this.raw[7]=this.raw[8]=this.raw[9]=this.raw[11]=this.raw[12]=this.raw[13]=0,this.raw[15]=1;else{var h=s*(this._viewPort.width/this._scissorRect.width),l=o*(this._viewPort.height/this._scissorRect.height),u=s*(2*this._scissorRect.x-this._viewPort.width)/this._scissorRect.width+s,c=-o*(2*this._scissorRect.y-this._viewPort.height)/this._scissorRect.height-o;e=u-h,i=u+h,r=c-l,a=c+l,this.raw[0]=2/(i-e),this.raw[5]=-2/(r-a),this.raw[10]=1/(this._far-this._near),this.raw[12]=(i+e)/(i-e),this.raw[13]=(a+r)/(a-r),this.raw[14]=this._near/(this.near-this.far),this.raw[1]=this.raw[2]=this.raw[3]=this.raw[4]=this.raw[6]=this.raw[7]=this.raw[8]=this.raw[9]=this.raw[11]=0,this.raw[15]=1}t.copyRawDataFrom(this.raw)},a.prototype.isVisibleToCamera=function(t){return t.modelMatrix,this.modelMatrix,t.bound?t.bound.inBound(this.frustum):!0},a.prototype.addAnimation=function(t,e){this._animation[t]=e},a.prototype.play=function(t,e){void 0===e&&(e=!1),this._animation[t]&&(this._animation[t].bindCamera(this),this._animation[t].play(e))},a.prototype.update=function(t,e,i){r.prototype.update.call(this,t,e,i);for(var a in this._animation)this._animation[a].update(t,e)},a.prototype.object3DToScreenRay=function(e,i){return void 0===i&&(i=null),i||(i=new t.Vector3D),this._halfw=.5*this.viewPort.width,this._halfh=.5*this.viewPort.height,i=this.viewMatrix.transformVector(e,i),this.project(i,i),i.x=this._halfw+i.x*this._halfw,i.y=this.viewPort.height-(this._halfh-i.y*this._halfh),i},a.prototype.ScreenRayToObject3D=function(e,i){return void 0===i&&(i=null),i||(i=new t.Vector3D),this._halfw=.5*this.viewPort.width,this._halfh=.5*this.viewPort.height,i.x=(e.x-this._halfw)/this._halfw,i.y=(this._halfh-(this.viewPort.height-e.y))/this._halfh,this.unproject(i.x,i.y,e.z,i),this.modelMatrix.transformVector(i,i),i},a.prototype.unproject=function(t,e,i,r){return r.x=t,r.y=-e,r.z=i,r.w=1,r.x*=i,r.y*=i,this._unprojection.copyFrom(this.projectMatrix),this._unprojection.invert(),this._unprojection.transformVector(r,r),r.z=i,r},a.prototype.project=function(t,e){return e=this.projectMatrix.transformVector(t,e),e.x=e.x/e.w,e.y=-e.y/e.w,e.z=t.z,e},a.prototype.onMakeTransform=function(){t.MathUtil.CALCULATION_VECTOR3D.x=1,t.MathUtil.CALCULATION_VECTOR3D.y=1,t.MathUtil.CALCULATION_VECTOR3D.z=1,this._modelMatrix3D.makeTransform(this._globalPos,t.MathUtil.CALCULATION_VECTOR3D,this._globalOrientation)},a}(t.Object3D);t.Camera3D=r}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.minPosX=0,this.minPosY=0,this.maxPosX=0,this.maxPosY=0,this.testID=0,this.points=new Array,this.offsetPosition=new t.Vector3D(0,0,0,0),this.clear()}return e.prototype.setAABox=function(t,i,r,a){this.minPosX=t-r/2-e.TINY,this.maxPosX=t+r/2+e.TINY,this.minPosY=i-a/2-e.TINY,this.maxPosY=i+a/2+e.TINY,this.offsetPosition.setTo(0,0,0)},e.prototype.setOffset=function(t){this.maxPosX+=t.x-this.offsetPosition.x,this.minPosX+=t.x-this.offsetPosition.x,this.minPosY+=t.z-this.offsetPosition.z,this.maxPosY+=t.z-this.offsetPosition.z,this.offsetPosition.copyFrom(t)},e.prototype.setContainRect=function(t,e,i,r){this.minPosX>t&&(this.minPosX=t),this.minPosY>e&&(this.minPosY=e),this.maxPosX<i&&(this.maxPosX=i),this.maxPosY<r&&(this.maxPosY=r)},e.prototype.clear=function(){var t=1e9;this.minPosX=this.minPosY=t,this.maxPosX=this.maxPosY=-t,this.points.length=0,this.testID=0,this.offsetPosition.setTo(0,0,0)},e.prototype.addPoint=function(t){-1==this.points.indexOf(t)&&(t.x<this.minPosX&&(this.minPosX=t.x-e.TINY),t.x>this.maxPosX&&(this.maxPosX=t.x+e.TINY),t.z<this.minPosY&&(this.minPosY=t.z-e.TINY),t.z>this.maxPosY&&(this.maxPosY=t.z+e.TINY),this.points.push(t))},e.prototype.clone=function(){var t=new e;return t.minPosX=this.minPosX,t.minPosY=this.minPosY,t.maxPosX=this.maxPosX,t.maxPosY=this.maxPosY,t},Object.defineProperty(e.prototype,"radius",{get:function(){return Math.sqrt((this.maxPosY-this.minPosY)*(this.maxPosY-this.minPosY)+(this.maxPosX-this.minPosX)*(this.maxPosX-this.minPosX))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sideX",{get:function(){return this.maxPosX-this.minPosX},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sideY",{get:function(){return this.maxPosY-this.minPosY},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"centreX",{get:function(){return.5*(this.maxPosX-this.minPosX)+this.minPosX},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"centreY",{get:function(){return.5*(this.maxPosY-this.minPosY)+this.minPosY},enumerable:!0,configurable:!0}),e.prototype.overlapTest=function(t){return this.minPosY>=t.maxPosY||this.maxPosY<=t.minPosY||this.minPosX>=t.maxPosX||this.maxPosX<=t.minPosX?!1:!0},e.prototype.isPointInside=function(t){return t.x>=this.minPosX&&t.x<=this.maxPosX&&t.z>=this.minPosY&&t.z<=this.maxPosY},e.prototype.isIntersectLineSegment=function(t,e,i,r){var a=!1,n=e-r,o=i-t,s=t*r-i*e,h=(-s-n*this.minPosX)/o;h<=this.maxPosY&&h>=this.minPosY&&(a=!0),h=(-s-n*this.maxPosX)/o,h<=this.maxPosY&&h>=this.minPosY&&(a=!0);var l=(-s-o*this.minPosY)/n;return l<=this.maxPosX&&l>=this.minPosX&&(a=!0),l=(-s-o*this.maxPosY)/n,l<=this.maxPosX&&l>=this.minPosX&&(a=!0),a},e.TINY=1e-6,e}();t.QuadAABB=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.logDeep=0,this._testID=0,this._cells=new Array,this._quadNodes=new Array,this._cellsToTest=new Array,this._aabb=new t.QuadAABB}return e.prototype.getQuadNode=function(t){return this._quadNodes[t]},e.prototype.clear=function(){this._cells.length=0,this._quadNodes.length=0},e.prototype.initNodes=function(t){this.clear();for(var e=0,i=t.length;i>e;)t[e].calcGlobalQuadAABB(),this._quadNodes.push(t[e]),e++},e.prototype.buildQuadTree=function(e,i){this._aabb.clear();for(var r=0,a=this._quadNodes;r<a.length;r++){var n=a[r];if(n.isTriangle)for(var o=0,s=n.aabb.points;o<s.length;o++){var h=s[o];this._aabb.addPoint(h)}else this._aabb.setContainRect(n.aabb.minPosX,n.aabb.minPosY,n.aabb.maxPosX,n.aabb.maxPosY)}this._cells.length=0,this._rootCell=new t.QuadTreeCell(this._aabb),this._cells.push(this._rootCell);for(var l=this._quadNodes.length,u=0;l>u;u++)this._cells[0].nodeIndices[u]=u;var c=new Array;c.push(0);for(var d,p,f;0!=c.length;)if(p=c.pop(),!(this._cells[p].nodeIndices.length<=e||this._cells[p].aabb.radius<i)){for(u=0;u<t.QuadTreeCell.NUM_CHILDREN;u++){this._cells[p].childCellIndices[u]=this._cells.length,c.push(this._cells.length),this._cells.push(new t.QuadTreeCell(this.createAABox(this._cells[p].aabb,u))),f=this._cells[this._cells.length-1],l=this._cells[p].nodeIndices.length;for(var _=0,m=0;l>m;m++)d=this._cells[p].nodeIndices[m],this.doesNodeIntersectCell(this._quadNodes[d],f)&&(_++,f.nodeIndices.push(d))}this._cells[p].nodeIndices.length=0}},e.prototype.createAABox=function(e,i){var r=e.centreX,a=e.centreY,n=e.sideX,o=e.sideY,s=new t.QuadAABB;switch(i){case 0:s.setAABox(r+n/4,a+o/4,n/2,o/2);break;case 1:s.setAABox(r-n/4,a+o/4,n/2,o/2);break;case 2:s.setAABox(r-n/4,a-o/4,n/2,o/2);break;case 3:s.setAABox(r+n/4,a-o/4,n/2,o/2);break;default:s.setAABox(r+n/4,a-o/4,n/2,o/2)}return s},e.prototype.doesNodeIntersectCell=function(t,e){var i=t.aabb;if(!i.overlapTest(e.aabb))return!1;if(!t.isTriangle)return!0;var r=i.points,a=r[0],n=r[1],o=r[2];if(e.aabb.isPointInside(a)||e.aabb.isPointInside(n)||e.aabb.isPointInside(o))return!0;var s=this.pointInTriangle(e.aabb.minPosX,e.aabb.minPosY,a,n,o)||this.pointInTriangle(e.aabb.minPosX,e.aabb.maxPosY,a,n,o)||this.pointInTriangle(e.aabb.maxPosX,e.aabb.maxPosY,a,n,o)||this.pointInTriangle(e.aabb.maxPosX,e.aabb.minPosY,a,n,o);return s?!0:s=e.aabb.isIntersectLineSegment(a.x,a.z,n.x,n.z)||e.aabb.isIntersectLineSegment(a.x,a.z,o.x,o.z)||e.aabb.isIntersectLineSegment(n.x,n.z,o.x,o.z)},e.prototype.getNodesIntersectingtAABox=function(e,i){if(0==this._cells.length)return 0;this._cellsToTest.length=0,this._cellsToTest.push(0),this.incrementTestCounter();for(var r,a,n,o,s=0;0!=this._cellsToTest.length;)if(r=this._cellsToTest.pop(),n=this._cells[r],i.overlapTest(n.aabb))if(n.isLeaf())for(a=n.nodeIndices.length,s=0;a>s;s++)o=this.getQuadNode(n.nodeIndices[s]).aabb,o.testID!=this._testID&&(o.testID=this._testID,i.overlapTest(o)&&e.push(n.nodeIndices[s]));else for(s=0;s<t.QuadTreeCell.NUM_CHILDREN;s++)this._cellsToTest.push(n.childCellIndices[s]);return e.length},e.prototype.pointInTriangle=function(t,e,i,r,a){var n=i,o=r,s=a,h=n.z-o.z,l=o.x-n.x,u=n.x*o.z-o.x*n.z,c=o.z-s.z,d=s.x-o.x,p=o.x*s.z-s.x*o.z,f=s.z-n.z,_=n.x-s.x,m=s.x*n.z-n.x*s.z,g=!1,v=h*t+l*e+u,y=c*t+d*e+p,x=f*t+_*e+m,b=.01;return(v>=-b&&y>=-b&&x>=-b||b>=v&&b>=y&&b>=x)&&(g=!0),g},e.prototype.incrementTestCounter=function(){if(++this._testID,0==this._testID){for(var t=this._quadNodes.length,e=0;t>e;e++)this._quadNodes[e].aabb.testID=0;this._testID=1}},e.prototype.logTree=function(t){if(!(0>t)){this.logDeep++;for(var e=this._cells[t],i="",r=0;r<this.logDeep-1;r++)i+="-|";console.log(i+"i="+t+" "+e.aabb.minPosX.toFixed(2)+" "+e.aabb.maxPosX.toFixed(2)+" "+e.aabb.minPosY.toFixed(2)+" "+e.aabb.maxPosY.toFixed(2));var a;for(a=0;a<e.nodeIndices.length;a++)if(e.nodeIndices[a]>=0){var n=this._quadNodes[e.nodeIndices[a]];console.log(i+" t="+e.nodeIndices[a]+" "+n.aabb.minPosX.toFixed(2)+" "+n.aabb.maxPosX.toFixed(2)+" "+n.aabb.minPosY.toFixed(2)+" "+n.aabb.maxPosY.toFixed(2))}for(a=0;a<e.childCellIndices.length;a++)e.childCellIndices[a]>=0&&this.logTree(e.childCellIndices[a]);this.logDeep--}},e}();t.QuadTree=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e,i){void 0===e&&(e=10),void 0===i&&(i=500),this._maxNodesPerCell=e,this._minCellSize=i,this._segBox=new t.QuadAABB,this._collisionNodesIdx=new Array,this._collisionNodes=new Array}return e.prototype.createQuadTree=function(e){this._quadTree=new t.QuadTree,this._quadTree.initNodes(e),this._quadTree.buildQuadTree(this._maxNodesPerCell,this._minCellSize)},e.prototype.getNodesByAABB=function(t,e,i,r){this._segBox.clear(),this._segBox.maxPosX=i,this._segBox.maxPosY=r,this._segBox.minPosX=t,this._segBox.minPosY=e,this._collisionNodesIdx.length=0,this._collisionNodes.length=0;for(var a,n=(this._quadTree.getNodesIntersectingtAABox(this._collisionNodesIdx,this._segBox),0);n<this._collisionNodesIdx.length;n++)a=this._quadTree.getQuadNode(this._collisionNodesIdx[n]),this._collisionNodes.push(a);return this._collisionNodes},e.prototype.getTriangleAtPoint=function(e,i){void 0===i&&(i=5),this._segBox.clear(),this._segBox.setAABox(e.x,e.z,1,1),this._collisionNodesIdx.length=0,this._collisionNodes.length=0;for(var r,a,n,o,s=(this._quadTree.getNodesIntersectingtAABox(this._collisionNodesIdx,this._segBox),4294967295),h=0,l=0;l<this._collisionNodesIdx.length;l++)a=this._quadTree.getQuadNode(this._collisionNodesIdx[l]),o=a.aabb,t.Navi3DTriangle.pointInsideTriangle(e,o.points[0],o.points[1],o.points[2])&&(n=a,h=Math.abs(n.plane.distance(e)),h>i||(null==a||s>=h)&&(r=n,s=h));return r},e}();t.QuadRoot=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(i){this.childCellIndices=new Array,this.childCellIndices.length=e.NUM_CHILDREN,this.nodeIndices=new Array,this.clear(),this.aabb=i?i.clone():new t.QuadAABB}return e.prototype.isLeaf=function(){return-1==this.childCellIndices[0]},e.prototype.clear=function(){for(var t=0;t<e.NUM_CHILDREN;t++)this.childCellIndices[t]=-1;this.nodeIndices.splice(0,this.nodeIndices.length)},e.NUM_CHILDREN=4,e}();t.QuadTreeCell=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){this._keys=new Array,this._values=new Array}return t.prototype.getIndexByKey=function(t){return this._keys.indexOf(t)},t.prototype.getValueByKey=function(t){var e=this.getIndexByKey(t);return e>-1?this._values[e]:null},t.prototype.put=function(t,e){if(null==t)return null;var i=this.remove(t);return this._keys.push(t),this._values.push(e),i},t.prototype.remove=function(t){var e,i=this._keys.indexOf(t);return i>-1&&(e=this._values[i],this._keys.splice(i,1),this._values.splice(i,1)),e},t.prototype.getValues=function(){return this._values},t.prototype.getKeys=function(){return this._keys},t.prototype.clear=function(){this._values.length=0,this._keys.length=0},t}();t.DoubleArray=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this._findIndex=0,this._openedList=new Array,this._closedList=new Array}return e.prototype.findPath=function(t,e,i){return this._findIndex++,this._navMesh=t,this._startNode=e,this._endNode=i,this._openedList.length=0,this._closedList.length=0,this._startNode&&this._endNode?(this._startNode.g=0,this._startNode.h=0,this._startNode.f=0,this._startNode.parent=null,this.search()):!1},e.prototype.search=function(){for(var e,i=this._startNode,r=new Array;i!=this._endNode;){r=i.getNeibourTriangles(r,t.Navi3DMaskType.WalkAble,t.Navi3DMaskType.WalkAble);for(var a=0,n=r;a<n.length;a++)if(e=n[a],e.closeId!=this._findIndex&&e!=i&&e.walkAble){var o=i.g+t.Navi3DPoint.calcDistance(e,i)*e.costMultiplier,s=t.Navi3DPoint.calcDistance(e,this._endNode),h=o+s;e.openId==this._findIndex?e.f>h&&(e.f=h,e.g=o,e.h=s,e.parent=i):(e.f=h,e.g=o,e.h=s,e.parent=i,e.openId=this._findIndex,this._openedList.push(e))}if(i.closeId=this._findIndex,this._closedList.push(i),0==this._openedList.length)return!1;this._openedList.sort(function(t,e){return t.f-e.f}),i=this._openedList.shift()}return this.buildPath(),!0},e.prototype.buildPath=function(){this._triangleChannel=[];var t=this._endNode;for(this._triangleChannel.push(t);t!=this._startNode;)t=t.parent,this._triangleChannel.unshift(t)},Object.defineProperty(e.prototype,"channel",{get:function(){return this._triangleChannel},enumerable:!0,configurable:!0}),e}();t.Navi3DAstar=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e,i){if(this._edgeMask=0,this._edgeSize=0,this._pointA=e,this._pointB=i,e.id>=i.id)throw new Error("edge point order error!!!");this._triangleOwners=new Array,this._centerPoint=new t.Vector3D,this._edgeMask=t.Navi3DMaskType.WalkAble,t.Navi3DPoint.CALC_VECTOR3D1.setTo(e.x-i.x,e.y-i.y,e.z-i.z),this._edgeSize=t.Navi3DPoint.CALC_VECTOR3D1.length,this._centerPoint.setTo((e.x+i.x)/2,(e.y+i.y)/2,(e.z+i.z)/2)}return Object.defineProperty(e.prototype,"size",{get:function(){return this._edgeSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"triangleOwners",{get:function(){return this._triangleOwners},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"centerPoint",{get:function(){return this._centerPoint},enumerable:!0,configurable:!0}),e.prototype.initFatPoints=function(i){this._edgeDirA2B=this._pointB.subtract(this._pointA),this._edgeDirA2B.normalize(),this.fatPointA=this.fatPointA||new t.Navi3DPointFat(this._pointA,this),this.fatPointB=this.fatPointB||new t.Navi3DPointFat(this._pointB,this),this.fatPointA.radius!=i&&(e.CALC_FAT_VECTOR.copyFrom(this._edgeDirA2B),e.CALC_FAT_VECTOR.scaleBy(i),e.CALC_FAT_VECTOR.incrementBy(this._pointA),this.fatPointA.copyFrom(e.CALC_FAT_VECTOR),this.fatPointA.radius=i),this.fatPointB.radius!=i&&(e.CALC_FAT_VECTOR.copyFrom(this._edgeDirA2B),e.CALC_FAT_VECTOR.scaleBy(-i),e.CALC_FAT_VECTOR.incrementBy(this._pointB),this.fatPointB.copyFrom(e.CALC_FAT_VECTOR),this.fatPointB.radius=i)},e.prototype.getFatPoint=function(t){return t==this._pointA?this.fatPointA:this.fatPointB},e.prototype.getAnotherFatPoint=function(t){return t==this._pointA?this.fatPointB:this.fatPointA},e.prototype.getAnotherPoint=function(t){return t==this._pointA?this._pointB:this._pointA},e.prototype.containsPoint=function(e){return t.Navi3DPoint.equalPoint(e,this._pointA)?this._pointA:t.Navi3DPoint.equalPoint(e,this._pointB)?this._pointB:null},e.prototype.addTriangleOwners=function(t){if(-1==t.edges.indexOf(this))throw new Error("the edge is not belong triangle!!!");-1==this._triangleOwners.indexOf(t)&&this._triangleOwners.push(t)},e.prototype.getPublicPoint=function(t){return this._pointA==t._pointA||this._pointA==t._pointB?this._pointA:this._pointB==t._pointA||this._pointB==t._pointB?this._pointB:null},e.prototype.getEqualPoint=function(e){return t.Navi3DPoint.equalPoint(e,this._pointA)?this._pointA:t.Navi3DPoint.equalPoint(e,this._pointB)?this._pointB:null},Object.defineProperty(e.prototype,"pointA",{get:function(){return this._pointA},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pointB",{get:function(){return this._pointB},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"walkAble",{get:function(){return(this._edgeMask&t.Navi3DMaskType.WalkAble)==t.Navi3DMaskType.WalkAble},enumerable:!0,configurable:!0}),e.prototype.testMask=function(t){return(this._edgeMask&t)==t},e.CALC_FAT_VECTOR=new t.Vector3D,e}();t.Navi3DEdge=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){}return t.WalkAble=1,t}();t.Navi3DMaskType=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function t(){}return t.prototype.setTo=function(t,e){this.x=t,this.y=e},t.prototype.equals=function(t,e){return t==this.x&&e==this.y},t.prototype.equalPoint=function(t){return this.equals(t.x,t.y)},Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},enumerable:!0,configurable:!0}),t.prototype.clone=function(){var e=new t;return e.setTo(this.x,this.y),e},t.prototype.normalize=function(){var t=length;0!=t&&this.setTo(this.x/t,this.y/t)},t}();t.Navi3DPoint2D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(t,i,r,a){e.call(this,i,r,a,0),this._pointId=0,this._pointId=t}return __extends(i,e),Object.defineProperty(i.prototype,"id",{get:function(){return this._pointId},enumerable:!0,configurable:!0}),i.equalPoint=function(e,i){return(e.x-i.x)*(e.x-i.x)+(e.y-i.y)*(e.y-i.y)+(e.z-i.z)*(e.z-i.z)<t.Navi3DFunnel.POWER_EPSILON},i.calcDistance=function(t,e){return i.CALC_VECTOR3D3.setTo(t.x-e.x,t.y-e.y,t.z-e.z),i.CALC_VECTOR3D3.length
},i.CALC_VECTOR3D1=new t.Vector3D,i.CALC_VECTOR3D2=new t.Vector3D,i.CALC_VECTOR3D3=new t.Vector3D,i.CALC_VECTOR3D4=new t.Vector3D,i.CALC_VECTOR3D5=new t.Vector3D,i}(t.Vector3D);t.Navi3DPoint=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(t){function e(e,i){t.call(this,e.id,0,0,0),this.radius=0,this._ownerEdge=i,this._ownerPoint=e}return __extends(e,t),Object.defineProperty(e.prototype,"ownerPoint",{get:function(){return this._ownerPoint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ownerEdge",{get:function(){return this._ownerEdge},enumerable:!0,configurable:!0}),e.prototype.scalePoint=function(t){void 0===t&&(t=.7);var i=new e(this._ownerPoint,this._ownerEdge);return i.copyFrom(this),i.decrementBy(this._ownerPoint),i.scaleBy(t),i.radius=i.length,i.incrementBy(this._ownerPoint),i},e}(t.Navi3DPoint);t.Navi3DPointFat=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r,a,n){e.call(this,0,0,0,0),this._id=0,this._points=new Array,this._edges=new Array,this._neibourTriangles=new t.DoubleArray,this._pointAgainstEdge=new t.DoubleArray,this._edgeAgainstPoint=new t.DoubleArray,this._mask=0,this.f=0,this.g=0,this.h=0,this.costMultiplier=1,this.openId=0,this.closeId=0,this._id=i,this._mask=t.Navi3DMaskType.WalkAble,this._edges.push(r,a,n);for(var o,s=0,h=this._edges;s<h.length;s++)o=h[s],-1==this._points.indexOf(o.pointA)&&this._points.push(o.pointA),-1==this._points.indexOf(o.pointB)&&this._points.push(o.pointB);this.x=(this._points[0].x+this._points[1].x+this._points[2].x)/3,this.y=(this._points[0].y+this._points[1].y+this._points[2].y)/3,this.z=(this._points[0].z+this._points[1].z+this._points[2].z)/3,this._plane=new t.Plane3D,this._plane.fromPoints(this._points[0],this._points[1],this._points[2]),this._plane.normalize(),this.genarateAgainstData(),this.initAABB()}return __extends(i,e),Object.defineProperty(i.prototype,"aabb",{get:function(){return this._aabbBox},enumerable:!0,configurable:!0}),i.prototype.initAABB=function(){this._aabbBox=new t.QuadAABB,this._aabbBox.addPoint(this._points[0]),this._aabbBox.addPoint(this._points[1]),this._aabbBox.addPoint(this._points[2])},i.prototype.calcGlobalQuadAABB=function(){},Object.defineProperty(i.prototype,"isTriangle",{get:function(){return!0},enumerable:!0,configurable:!0}),i.prototype.genarateAgainstData=function(){for(var t,e,i=0,r=this._edges;i<r.length;i++){t=r[i];for(var a=0,n=this._points;a<n.length;a++)e=n[a],t.pointA!=e&&t.pointB!=e&&(this._edgeAgainstPoint.put(t,e),this._pointAgainstEdge.put(e,t))}},Object.defineProperty(i.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"plane",{get:function(){return this._plane},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"points",{get:function(){return this._points},enumerable:!0,configurable:!0}),i.prototype.addNeibour=function(t,e){if(!(this._edges.indexOf(t)>=0))throw new Error("the edge is not in triangle!!!");this._neibourTriangles.put(t,e)},i.prototype.getNeibourTriangles=function(t,e,i){void 0===t&&(t=null),void 0===e&&(e=1),void 0===i&&(i=1),t=t||new Array,t.length=0;for(var r,a,n,o=this._neibourTriangles.getKeys(),s=0,h=o;s<h.length;s++)n=h[s],a=n,a.testMask(e)&&(r=this._neibourTriangles.getValueByKey(a),r.testMask(i)&&t.push(r));return t},i.prototype.getEdges=function(t,e){void 0===t&&(t=null),void 0===e&&(e=1),t=t||new Array,t.length=0;for(var i,r=0,a=this._edges;r<a.length;r++)i=a[r],i.testMask(e)&&t.push(i);return t},Object.defineProperty(i.prototype,"walkAble",{get:function(){return this.testMask(t.Navi3DMaskType.WalkAble)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"edges",{get:function(){return this._edges},enumerable:!0,configurable:!0}),i.prototype.testMask=function(t){return(this._mask&t)==t},i.prototype.getEdgeAgainstPoint=function(t){return this._edgeAgainstPoint.getValueByKey(t)},i.prototype.getPointAgainstEdge=function(t){return this._pointAgainstEdge.getValueByKey(t)},i.prototype.getPublicEdge=function(t){if(t&&t!=this)for(var e,i=this._neibourTriangles.getKeys(),r=0,a=i;r<a.length;r++)if(e=a[r],this._neibourTriangles.getValueByKey(e)==t)return e;return null},i.prototype.loopPublicEdge=function(t){var e,i;if(t&&t!=this)for(var r=0,a=this._edges;r<a.length;r++){e=a[r];for(var n=0,o=t._edges;n<o.length;n++)if(i=o[n],e==i)return e}return null},i.prototype.randomPoint=function(){var t=this._points[2].subtract(this._points[0]);t.scaleBy(Math.random()),t.incrementBy(this._points[0]);var e=this._points[1].subtract(t);return e.scaleBy(Math.random()),e.incrementBy(t),e},i.pointInsideTriangle=function(t,e,r,a){return i.pp.setTo(t.x,t.z),i.p1.setTo(e.x,e.z),i.p2.setTo(r.x,r.z),i.p3.setTo(a.x,a.z),i.pointInsideTriangle2d()},i.pointInsideTriangle2d=function(){return i.product2d(i.p1,i.p2,i.p3)>=0?i.product2d(i.p1,i.p2,i.pp)>=0&&i.product2d(i.p2,i.p3,i.pp)>=0&&i.product2d(i.p3,i.p1,i.pp)>=0:i.product2d(i.p1,i.p2,i.pp)<=0&&i.product2d(i.p2,i.p3,i.pp)<=0&&i.product2d(i.p3,i.p1,i.pp)<=0},i.product2d=function(t,e,i){var r=(t.x-i.x)*(e.y-i.y)-(t.y-i.y)*(e.x-i.x);return r>-1e-5&&1e-5>r&&(r=0),r},i.p1=new t.Navi3DPoint2D,i.p2=new t.Navi3DPoint2D,i.p3=new t.Navi3DPoint2D,i.pp=new t.Navi3DPoint2D,i}(t.Vector3D);t.Navi3DTriangle=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e,i){this._nav3dPoints=new Array,this._nav3dEdges=new Array,this._nav3dTriangles=new Array,this._edgesDict=new t.DoubleArray,this.initPoints(e),this.initEdgesAndTriangles(i),this.createConnections(),this._nav3dAstar=new t.Navi3DAstar,this._nav3dFunnel=new t.Navi3DFunnel,this._terrainQuad=new t.QuadRoot(8,128),this._terrainQuad.createQuadTree(this._nav3dTriangles)}return Object.defineProperty(e.prototype,"edges",{get:function(){return this._nav3dEdges},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"points",{get:function(){return this._nav3dPoints},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._path},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"triangles",{get:function(){return this._nav3dTriangles},enumerable:!0,configurable:!0}),e.prototype.getTriangleAtPoint=function(t,e){return void 0===e&&(e=5),this._terrainQuad.getTriangleAtPoint(t,e)},e.prototype.findPath=function(t,e,i){void 0===i&&(i=5),this._path=null,this._triangleList=null;var r=this.getTriangleAtPoint(t,10),a=this.getTriangleAtPoint(e,10),n=this._nav3dAstar.findPath(this,r,a);return n?(this._triangleList=this._nav3dAstar.channel,n=this._nav3dFunnel.searchPath(this,t,e,this._triangleList,i),this._path=this._nav3dFunnel.path,n):!1},e.prototype.initPoints=function(e){for(var i,r,a=e.length,n=0;a>n;n++)i=e[n],r=new t.Navi3DPoint(n,i.x,i.y,i.z),this._nav3dPoints.push(r)},e.prototype.initEdgesAndTriangles=function(e){for(var i,r,a,n,o,s=e.length,h=0;s>h;h++)i=e[h],r=this.tryCreateEdge(i[0],i[1]),a=this.tryCreateEdge(i[1],i[2]),n=this.tryCreateEdge(i[2],i[0]),null!=r&&null!=a&&null!=n&&(o=new t.Navi3DTriangle(h,r,a,n),this._nav3dTriangles.push(o))},e.prototype.tryCreateEdge=function(e,i){if(e==i)throw new Error("edge point index error!!!");if(e>i){var r=e;e=i,i=r}var a=this._edgesDict.getValueByKey(e+"_"+i);return null==a&&(a=new t.Navi3DEdge(this._nav3dPoints[e],this._nav3dPoints[i]),this._nav3dEdges.push(a),this._edgesDict.put(e+"_"+i,a)),a},e.prototype.createConnections=function(){for(var t,e,i,r,a=this._nav3dTriangles.length,n=this._nav3dTriangles.length,o=0;a>o;o++){t=this._nav3dTriangles[o];for(var s=0,h=t.edges;s<h.length;s++)i=h[s],i.addTriangleOwners(t);for(var l=0;n>l;l++)e=this._nav3dTriangles[l],t!=e&&(r=t.loopPublicEdge(e),r&&(t.addNeibour(r,e),e.addNeibour(r,t)))}},e}();t.Navi3DMesh=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this._aiRadius=0,this._tempPublicEdgeList=new Array,this._tempSamePlaneList=new Array,this._router=new t.Navi3DRouter}return e.prototype.searchPath=function(t,e,i,r,a){return void 0===a&&(a=0),0>=a&&(a=1),this._aiRadius=1.5*a,this._navMesh=t,this.searchEnable(e,i,r)?(this.search(e,i,r),!0):!1},Object.defineProperty(e.prototype,"path",{get:function(){return this._result},enumerable:!0,configurable:!0}),e.prototype.searchEnable=function(i,r,a){return null==i||null==r||null==this._navMesh||null==a?!1:a[0].plane.classifyPoint(i,e.EPSILON)!=t.PlaneClassification.INTERSECT?!1:a[a.length-1].plane.classifyPoint(r,e.EPSILON)!=t.PlaneClassification.INTERSECT?!1:!0},e.prototype.search=function(i,r,a){this._tempPublicEdgeList.length=0,this._tempSamePlaneList.length=0;var n,o,s,h,l=0,u=a.length-1;for(l=0;u>l;l++)o=a[l].getPublicEdge(a[l+1]),o.crossPoint=null,o.initFatPoints(this._aiRadius),this._tempPublicEdgeList.push(o),n=a[l],h=n.plane,n=a[l+1],s=n.getEdgeAgainstPoint(o),this._tempSamePlaneList.push(h.classifyPoint(s,e.EPSILON)==t.PlaneClassification.INTERSECT);this._router.continuePass(i,r,this._tempPublicEdgeList[0]),u=this._tempPublicEdgeList.length;var c,d,p,f;for(l=0;u>l;l++)o=this._tempPublicEdgeList[l],n=a[l+1],f=l==u-1,s=f?r:n.getEdgeAgainstPoint(o),p=this._router.passEdge(o,this._tempPublicEdgeList[l+1],s,f),p||(c=this._router.cornerPoint,d=this._router.cornerEdge,l=this._tempPublicEdgeList.indexOf(d),this._router.continuePass(c,r,this._tempPublicEdgeList[l+1]));this.pushAllPathPoint2(i,r),this._result.length>=3&&(this.optimusTerminusFat(),this.optimusByRadius())},e.prototype.optimusTerminusFat=function(){var e,i,r;r=this._result[1],r instanceof t.Navi3DPointFat&&(e=r),r=this._result[this._result.length-2],r instanceof t.Navi3DPointFat&&(i=r),e&&(this._result[1]=e.scalePoint()),i&&e!=i&&(this._result[this._result.length-2]=i.scalePoint())},e.prototype.pushAllPathPoint2=function(t,i){var r,a,n=this._tempPublicEdgeList.length;this._result=new Array,this._result.push(t);for(var o,s,h,l=t,u=0;n>u;u++)if(r=this._tempPublicEdgeList[u],s=null,r.crossPoint)s=this.getFatPoint(r,r.crossPoint),this._result.push(s?s:r.crossPoint),l=r.crossPoint;else{a=null,o=null;for(var c=u+1;n>c&&(a=this._tempPublicEdgeList[c],!(o=a.crossPoint));c++);null==o&&(o=i),s=this.getFatPoint(r,o),s?this._result.push(s):(e.CROSS_TEST_DIRECTION.setTo(o.x-l.x,0,o.z-l.z),h=this._router.calcCrossEdge(r,l,e.CROSS_TEST_DIRECTION),this._result.push(h))}this._result.push(i)},e.prototype.optimusByRadius=function(){var i=new Array;i.length=this._result.length;var r,a,n,o,s,h,l,u,c,d,p,f,_,m=this._result.length-2;for(_=0;m>_;_++)l=u=c=null,o=s=h=null,p=!1,f=null,r=this._result[_],a=this._result[_+1],n=this._result[_+2],r instanceof t.Navi3DPointFat&&(o=r),a instanceof t.Navi3DPointFat&&(s=a),n instanceof t.Navi3DPointFat&&(h=n),o&&(l=o.ownerPoint),s&&(u=s.ownerPoint),h&&(c=h.ownerPoint),l&&u&&l==u&&u!=c&&(p=!0),c&&u&&c==u&&l!=u&&(p=!0),p&&(e.CROSS_TEST_DIRECTION.copyFrom(r),e.CROSS_TEST_DIRECTION.decrementBy(n),d=s.ownerEdge,p=this._router.hasCrossPoint(d.pointA,d.pointB,n,e.CROSS_TEST_DIRECTION),p&&(f=this._router.calcCrossPointOut(u,a,n,e.CROSS_TEST_DIRECTION)),f&&(i[_+1]=f))},e.prototype.getFatPoint=function(e,i){if(null==e)return null;var r;i instanceof t.Navi3DPointFat&&(r=i);var a;return a=r?r.ownerPoint:e.getEqualPoint(i),null==a?null:r=e.getFatPoint(a)},e.EPSILON=5,e.POWER_EPSILON=e.EPSILON*e.EPSILON,e.CROSS_TEST_DIRECTION=new t.Vector3D,e}();t.Navi3DFunnel=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){}return e.prototype.continuePass=function(t,e,i){this.resetData(),this.curPoint=t,this.endPoint=e,this.cornerEdge=i},e.prototype.passEdge=function(i,r,a,n){if((null==this.rayA||null==this.rayB)&&(this.rayA=e.RAY_1,this.rayB=e.RAY_2,this.rayAPoint=i.pointA,this.rayBPoint=i.pointB,this.rayA.setTo(this.rayAPoint.x-this.curPoint.x,0,this.rayAPoint.z-this.curPoint.z),this.rayB.setTo(this.rayBPoint.x-this.curPoint.x,0,this.rayBPoint.z-this.curPoint.z)),n)return this.checkEndPoint(a);if(e.TEST_RAY.setTo(a.x-this.curPoint.x,0,a.z-this.curPoint.z),this.isPointAtCenter(e.TEST_RAY,this.rayA,this.rayB)){this.hasCrossPoint(r.pointA,r.pointB,this.rayAPoint,this.rayA)?(this.rayB.copyFrom(e.TEST_RAY),this.rayBPoint=a instanceof t.Navi3DPoint?a:null):(this.rayA.copyFrom(e.TEST_RAY),this.rayAPoint=a instanceof t.Navi3DPoint?a:null);var o=r.getAnotherPoint(a);e.TEST_RAY.setTo(o.x-this.curPoint.x,0,o.z-this.curPoint.z),(o==this.rayAPoint||o==this.rayBPoint||this.isPointAtCenter(e.TEST_RAY,this.rayA,this.rayB))&&(this.cornerEdge=r)}else{var s;if(e.TEST_RAY_1.copyFrom(r.pointA),e.TEST_RAY_1.decrementBy(this.curPoint),e.TEST_RAY_2.copyFrom(r.pointB),e.TEST_RAY_2.decrementBy(this.curPoint),e.TEST_RAY_1.y=0,e.TEST_RAY_2.y=0,s=this.isPointAtCenter(this.rayA,e.TEST_RAY_1,e.TEST_RAY_2)||this.isPointAtCenter(this.rayB,e.TEST_RAY_1,e.TEST_RAY_2)?!1:!0)return this.cornerPoint=this.isPointAtCenter(this.rayA,e.TEST_RAY,this.rayB)?this.rayAPoint:this.rayBPoint,this.cornerEdge.crossPoint=this.cornerPoint,!1}return!0},e.prototype.checkEndPoint=function(t){return e.TEST_RAY.setTo(t.x-this.curPoint.x,0,t.z-this.curPoint.z),this.isPointAtCenter(e.TEST_RAY,this.rayA,this.rayB)?!0:(this.cornerPoint=this.isPointAtCenter(this.rayA,e.TEST_RAY,this.rayB)?this.rayAPoint:this.rayBPoint,this.cornerEdge.crossPoint=this.cornerPoint,!1)},e.prototype.calcCrossEdge=function(t,e,i){return this.calcCrossPoint(t.fatPointA,t.fatPointB,e,i)},e.prototype.calcCrossPoint=function(t,i,r,a){e.CALC_CROSS_POINT.copyFrom(i),e.CALC_CROSS_POINT.decrementBy(t);var n=((t.z-r.z)*a.x-(t.x-r.x)*a.z)/(e.CALC_CROSS_POINT.x*a.z-a.x*e.CALC_CROSS_POINT.z);return n>1?n=1:0>n&&(n=0),e.CALC_CROSS_POINT.scaleBy(n),e.CALC_CROSS_POINT.incrementBy(t),e.CALC_CROSS_POINT.clone()},e.prototype.calcCrossPointOut=function(t,i,r,a){e.CALC_CROSS_POINT.copyFrom(i),e.CALC_CROSS_POINT.decrementBy(t);var n=((t.z-r.z)*a.x-(t.x-r.x)*a.z)/(e.CALC_CROSS_POINT.x*a.z-a.x*e.CALC_CROSS_POINT.z);return 1>=n&&n>=0?null:(e.CALC_CROSS_POINT.scaleBy(n),e.CALC_CROSS_POINT.incrementBy(t),e.CALC_CROSS_POINT.clone())},e.prototype.hasCrossPoint=function(t,i,r,a){e.CALC_CROSS_TEST.copyFrom(i),e.CALC_CROSS_TEST.decrementBy(t);var n=((t.z-r.z)*a.x-(t.x-r.x)*a.z)/(e.CALC_CROSS_TEST.x*a.z-a.x*e.CALC_CROSS_TEST.z);return 1>=n&&n>=0},e.prototype.isPointAtCenter=function(t,e,i){var r=e.crossProduct(t);if(0==r.length&&t.length<e.length)return!0;var a=i.crossProduct(t);return 0==a.length&&t.length<i.length?!0:(r.normalize(),a.normalize(),r.incrementBy(a),r.length<.01)},e.prototype.resetData=function(){this.cornerEdge=null,this.cornerPoint=null,this.curPoint=null,this.rayA=this.rayB=null,this.rayAPoint=this.rayBPoint=null,e.RAY_1.setTo(0,0,0),e.RAY_2.setTo(0,0,0)},e.RAY_1=new t.Vector3D,e.RAY_2=new t.Vector3D,e.TEST_RAY=new t.Vector3D,e.TEST_RAY_1=new t.Vector3D,e.TEST_RAY_2=new t.Vector3D,e.CALC_CROSS_POINT=new t.Vector3D,e.CALC_CROSS_TEST=new t.Vector3D,e}();t.Navi3DRouter=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e,i,r,a){void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=100),void 0===a&&(a=100),this._rectangle=new t.Rectangle,this._transformMatrix=new t.Matrix4_4,this._change=!1,this._rotation=new t.Vector3D,this._scale=new t.Vector3D(1,1,1),this._position=new t.Vector3D,this._transformComponents=[],this._changeTexture=!1,this._textureStage=!1,this._vertexFormat=t.VertexFormat.VF_POSITION|t.VertexFormat.VF_UV0,this._uv_scale=new Float32Array(2),this.name="",this.bothside=!1,this.cullMode=t.ContextConfig.BACK,this.visible=!0,this.vsShader="hud_vs",this.fsShader="hud_V_fs",this._passUsage=new t.PassUsage,this._attList=new Array,this._transformComponents.push(this._position),this._transformComponents.push(this._rotation),this._transformComponents.push(this._scale),this.x=e,this.y=i,this.width=r,this.height=a,this._uv_scale[0]=1,this._uv_scale[1]=1}return Object.defineProperty(e.prototype,"diffuseTexture",{get:function(){return this._diffuseTexture},set:function(t){this._changeTexture=!0,this._diffuseTexture=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._rectangle.x},set:function(t){this._change=!0,this._rectangle.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._rectangle.y},set:function(t){this._change=!0,this._rectangle.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._rectangle.width},set:function(t){this._change=!0,this._rectangle.width=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._rectangle.height},set:function(t){this._change=!0,this._rectangle.height=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationX",{get:function(){return this._rotation.x},set:function(t){this._change=!0,this._rotation.x!=t&&(this._rotation.x=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationY",{get:function(){return this._rotation.y},set:function(t){this._change=!0,this._rotation.y!=t&&(this._rotation.y=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationZ",{get:function(){return this._rotation.z},set:function(t){this._change=!0,this._rotation.z!=t&&(this._rotation.z=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewPort",{set:function(t){this._viewPort=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uScale",{get:function(){return this._uv_scale[0]},set:function(t){this._uv_scale[0]=t,this._uv_scale[0]>1&&(this._uv_scale[0]=1),this._uv_scale[0]<0&&(this._uv_scale[0]=0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vScale",{get:function(){return this._uv_scale[1]},set:function(t){this._uv_scale[1]=t,this._uv_scale[1]>1&&(this._uv_scale[1]=1),this._uv_scale[1]<0&&(this._uv_scale[1]=0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transformMatrix",{get:function(){return this._viewPort?(this._change&&(this._scale.x=this._rectangle.width/this._viewPort.width,this._scale.y=this._rectangle.height/this._viewPort.height,this._position.x=t.MathUtil.ScreenToPosition(this._rectangle.x,this._rectangle.width,this._viewPort.width),this._position.y=-t.MathUtil.ScreenToPosition(this._rectangle.y,this._rectangle.height,this._viewPort.height),this._transformMatrix.recompose(this._transformComponents),this._change=!1),this._transformMatrix):this._transformMatrix},enumerable:!0,configurable:!0}),e.prototype.updateTexture=function(t){var e;for(var i in this._passUsage.sampler2DList)e=this._passUsage.sampler2DList[i],e.uniformIndex=t.getUniformLocation(this._passUsage.program3D,e.varName),e.texture=this[e.varName];this._changeTexture=!1},e.prototype.upload=function(i){this._vertexBuffer3D||(this._vertexBuffer3D=i.creatVertexBuffer(e.singleQuadData)),this._indexBuffer3D||(this._indexBuffer3D=i.creatIndexBuffer(e.singleQuadIndex)),this._passUsage.vertexShader.shaderType=t.Shader.vertex,this._passUsage.fragmentShader.shaderType=t.Shader.fragment,this._passUsage.vertexShader.addUseShaderName(this.vsShader),this._passUsage.fragmentShader.addUseShaderName(this.fsShader),this._passUsage.vertexShader.shader=this._passUsage.vertexShader.getShader(this._passUsage),this._passUsage.fragmentShader.shader=this._passUsage.fragmentShader.getShader(this._passUsage),this._passUsage.program3D=t.ShaderPool.getProgram(this._passUsage.vertexShader.shader.id,this._passUsage.fragmentShader.shader.id);for(var r in this._passUsage)-1!=r.indexOf("uniform")&&this._passUsage[r]&&(this._passUsage[r].uniformIndex=i.getUniformLocation(this._passUsage.program3D,r));this._attList.length=0;var a=0;this._passUsage.attribute_position&&(this._passUsage.attribute_position.uniformIndex||(this._passUsage.attribute_position.uniformIndex=i.getShaderAttribLocation(this._passUsage.program3D,this._passUsage.attribute_position.varName)),this._attList.push(this._passUsage.attribute_position),this._passUsage.attribute_position.size=t.Geometry.positionSize,this._passUsage.attribute_position.dataType=t.ContextConfig.FLOAT,this._passUsage.attribute_position.normalized=!1,this._passUsage.attribute_position.stride=e.vertexBytes,this._passUsage.attribute_position.offset=a,a+=t.Geometry.positionSize*Float32Array.BYTES_PER_ELEMENT),this._passUsage.attribute_uv0&&(this._passUsage.attribute_uv0.uniformIndex||(this._passUsage.attribute_uv0.uniformIndex=i.getShaderAttribLocation(this._passUsage.program3D,this._passUsage.attribute_uv0.varName)),this._attList.push(this._passUsage.attribute_uv0),this._passUsage.attribute_uv0.size=t.Geometry.uvSize,this._passUsage.attribute_uv0.dataType=t.ContextConfig.FLOAT,this._passUsage.attribute_uv0.normalized=!1,this._passUsage.attribute_uv0.stride=e.vertexBytes,this._passUsage.attribute_uv0.offset=a,a+=t.Geometry.uvSize*Float32Array.BYTES_PER_ELEMENT),this._passUsage.uv_scale=i.getUniformLocation(this._passUsage.program3D,"uv_scale")},e.prototype.draw=function(e,i){if(void 0===i&&(i=null),this.visible){this._passUsage.program3D||this.upload(e),e.setProgram(this._passUsage.program3D),e.bindVertexBuffer(this._vertexBuffer3D),e.bindIndexBuffer(this._indexBuffer3D);for(var r=0;8>r;r++)t.Context3DProxy.gl.disableVertexAttribArray(r);for(var r=0;r<this._attList.length;++r){var a=this._attList[r];a.uniformIndex>=0&&e.vertexAttribPointer(a.uniformIndex,a.size,a.dataType,a.normalized,a.stride,a.offset)}this._changeTexture&&this.updateTexture(e);var n;for(var o in this._passUsage.sampler2DList)n=this._passUsage.sampler2DList[o],n.texture&&(n.texture.upload(e),e.setTexture2DAt(n.activeTextureIndex,n.uniformIndex,n.index,n.texture.texture2D),this._textureStage&&(n.texture.activeState(e),this._textureStage=!1));this._passUsage.uniform_ViewProjectionMatrix&&e.uniformMatrix4fv(this._passUsage.uniform_ViewProjectionMatrix.uniformIndex,!1,this.transformMatrix.rawData),this._passUsage.uniform_ViewMatrix&&i&&e.uniformMatrix4fv(this._passUsage.uniform_ViewMatrix.uniformIndex,!1,i.viewMatrix.rawData),this._passUsage.uniform_ProjectionMatrix&&i&&e.uniformMatrix4fv(this._passUsage.uniform_ProjectionMatrix.uniformIndex,!1,i.projectMatrix.rawData),this._passUsage.uv_scale&&-1!=this._passUsage.uv_scale&&e.uniform2f(this._passUsage.uv_scale,this._uv_scale[0],this._uv_scale[1]),e.setCulling(this.cullMode),this.bothside?e.disableCullFace():e.enableCullFace(),e.enableBlend(),e.setBlendFactors(t.ContextConfig.SRC_ALPHA,t.ContextConfig.ONE_MINUS_SRC_ALPHA),e.drawElement(t.DrawMode.TRIANGLES,0,6),e.clear(t.ContextConfig.DEPTH_BUFFER_BIT)}},e.singleQuadData=new Float32Array([-1,-1,0,0,1,1,-1,0,1,1,1,1,0,1,0,-1,1,0,0,0]),e.singleQuadIndex=new Uint16Array([0,1,2,0,2,3]),e.vertexBytes=20,e}();t.HUD=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(e,i,r,a,n){void 0===n&&(n=null),this._viewPort=new t.Rectangle,this._scene=new t.Scene3D,this._scissorRect=new t.Rectangle,this._viewMatrix=new t.Matrix4_4,this._backColor=new t.Vector3D(.3,.3,.6,1),this._cleanParmerts=t.Context3DProxy.gl.COLOR_BUFFER_BIT|t.Context3DProxy.gl.DEPTH_BUFFER_BIT,this._sizeDiry=!1,this._huds=new Array,this._postList=[],this.a=0,this._entityCollect=new t.EntityCollect,this._entityCollect.root=this._scene,this._render=new t.MultiRender(t.PassType.diffusePass),this._camera=n||new t.Camera3D(t.CameraType.perspective),this._camera.name="MainCamera",this._scene.addChild3D(this._camera),this.x=e,this.y=i,this.width=r,this.height=a,this._camera.aspectRatio=this._viewPort.width/this._viewPort.height,this._camera.updateViewport(this._viewPort.x,this._viewPort.y,this._viewPort.width,this._viewPort.height)}return Object.defineProperty(e.prototype,"render",{get:function(){return this._render},set:function(t){this._render=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"quadStage",{get:function(){return this._quadStage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"post",{set:function(e){this._postList=e,e.length>0&&(this._postProcessing=this._postProcessing||new t.PostProcessing,this._postHUD=this._postHUD||new t.HUD(0,0,512,512),this._postHUD.fsShader="hud_H_fs")},enumerable:!0,configurable:!0}),e.prototype.blender=function(e,i){this._cleanParmerts=(e?t.Context3DProxy.gl.COLOR_BUFFER_BIT:0)|(i?t.Context3DProxy.gl.DEPTH_BUFFER_BIT:0)},Object.defineProperty(e.prototype,"backColor",{get:function(){return 255*this._backColor.w<<24|255*this._backColor.x<<16|255*this._backColor.y<<8|255*this._backColor.z},set:function(t){this._backColor.w=(t>>24&255)/255,this._backColor.x=(t>>16&255)/255,this._backColor.y=(t>>8&255)/255,this._backColor.z=(255&t)/255},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backImage",{get:function(){return this._backImg.diffuseTexture},set:function(e){e&&(this._backImg=this._backImg||new t.HUD,this._backImg.diffuseTexture=e,this._backImg.x=this.x,this._backImg.y=this.y,this._backImg.width=this.width,this._backImg.height=this.height)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"camera3D",{get:function(){return this._camera},set:function(t){this._camera=t,this._camera.aspectRatio=this._viewPort.width/this._viewPort.height,this._camera.updateViewport(this._viewPort.x,this._viewPort.y,this._viewPort.width,this._viewPort.height),this._quadStage&&this._quadStage.changeCamera()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scene",{get:function(){return this._scene},set:function(t){this._scene=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._viewPort.x},set:function(t){this._viewPort.x=t,this._camera.updateViewport(this._viewPort.x,this._viewPort.y,this._viewPort.width,this._viewPort.height),this._backImg&&(this._backImg.x=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._viewPort.y},set:function(t){this._viewPort.y=t,this._camera.updateViewport(this._viewPort.x,this._viewPort.y,this._viewPort.width,this._viewPort.height),this._backImg&&(this._backImg.y=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._viewPort.width},set:function(t){this._viewPort.width=t,this._camera.aspectRatio=this._viewPort.width/this._viewPort.height,this._camera.updateViewport(this._viewPort.x,this._viewPort.y,this._viewPort.width,this._viewPort.height),this._backImg&&(this._backImg.width=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._viewPort.height},set:function(t){this._viewPort.height=t,this._camera.aspectRatio=this._viewPort.width/this._viewPort.height,this._camera.updateViewport(this._viewPort.x,this._viewPort.y,this._viewPort.width,this._viewPort.height),this._backImg&&(this._backImg.height=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewPort",{get:function(){return this._viewPort},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entityCollect",{get:function(){return this._entityCollect},enumerable:!0,configurable:!0}),e.prototype.getGUIStage=function(){return this._quadStage||(this._quadStage=new t.QuadStage(this)),this._quadStage},e.prototype.addGUI=function(e){this._quadStage||(this._quadStage=new t.QuadStage(this)),this._quadStage.addChild(e)},e.prototype.removeGUI=function(t){this._quadStage.removeChild(t)},e.prototype.addChild3D=function(t){this._scene.addChild3D(t)},e.prototype.removeChild3D=function(t){this._scene.removeChild3D(t)},e.prototype.inView3D=function(t,e){return this._viewPort.inner(t,e)},e.prototype.addHUD=function(t){-1==this._huds.indexOf(t)&&(t.viewPort=this._viewPort,this._huds.push(t))},e.prototype.findHud=function(t){for(var e=0;e<this._huds.length;++e)if(this._huds[e].name==t)return this._huds[e];return null},e.prototype.delHUD=function(t){var e=this._huds.indexOf(t);e>=0&&e<this._huds.length&&this._huds.splice(e,1)},e.prototype.update=function(e,i){if(this._camera.viewPort=this._viewPort,this.updateObject3D(this._scene.root,e,i),t.Egret3DCanvas.context3DProxy.viewPort(this._viewPort.x,this._viewPort.y,this._viewPort.width,this._viewPort.height),t.Egret3DCanvas.context3DProxy.setScissorRectangle(this._viewPort.x,this._viewPort.y,this._viewPort.width,this._viewPort.height),this._entityCollect.update(this._camera),t.Egret3DEngine.instance.debug){t.Egret3DState.showDataInfo("drawCall : "+this._entityCollect.numberDraw.toString()),t.Egret3DState.showDataInfo("vertex : "+this._entityCollect.numberVertex.toString()),t.Egret3DState.showDataInfo("tris : "+this._entityCollect.numberFace.toString()),t.Egret3DState.showDataInfo("skin : "+this._entityCollect.numberSkin.toString()),t.Egret3DState.showDataInfo("proAnim : "+this._entityCollect.numberAnimation.toString()),t.Egret3DState.showDataInfo("particleEmiter : "+this._entityCollect.numberParticle.toString());for(var r,a=0;a<t.Layer.layerType.length;a++)r=t.Layer.layerType[a]+" layer: "+this._entityCollect.softRenderItems[t.Layer.layerType[a]].length.toString(),t.Egret3DState.showDataInfo(r)}t.PickSystem.instance.enablePick&&t.PickSystem.instance.update(this._entityCollect,this._camera,e,i,this._viewPort),t.ShadowCast.enableShadow&&t.ShadowCast.instance.update(this._entityCollect,this._camera,e,i,this._viewPort),this._cleanParmerts&t.Context3DProxy.gl.COLOR_BUFFER_BIT&&t.Egret3DCanvas.context3DProxy.clearColor(this._backColor.x,this._backColor.y,this._backColor.z,this._backColor.w),t.Egret3DCanvas.context3DProxy.clear(this._cleanParmerts),this._backImg&&this._backImg.draw(t.Egret3DCanvas.context3DProxy),this._postList.length>0?(this._postProcessing.postItem=this._postList,this._postProcessing.drawFrameBuffer(e,i,t.Egret3DCanvas.context3DProxy,this._entityCollect,this._camera,this._viewPort)):this._render.draw(e,i,t.Egret3DCanvas.context3DProxy,this._entityCollect,this._camera,this._viewPort);for(var a=0;a<this._huds.length;++a)this._huds[a].draw(t.Egret3DCanvas.context3DProxy);this._quadStage&&this._quadStage.update(e,i,t.Egret3DCanvas.context3DProxy,this)},e.prototype.updateObject3D=function(t,e,i){if(t){t.update(e,i,this.camera3D);for(var r=0;r<t.childs.length;++r)this.updateObject3D(t.childs[r],e,i)}},e.requestFullScreen=function(){var t=document.documentElement;t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullScreen&&t.webkitRequestFullScreen()},e.exitFullscreen=function(){var t=document;t.exitFullscreen?t.exitFullscreen():t.webkitCancelFullScreen&&t.webkitCancelFullScreen()},e}();t.View3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(i,r,a,n){e.call(this,i,r,a,n,new t.Camera3D(t.CameraType.VR)),this.leftViewPort=new t.Rectangle,this.rightViewPort=new t.Rectangle,this.updateViewport()}return __extends(i,e),i.prototype.updateViewport=function(){this.leftViewPort.x=this._viewPort.x,this.leftViewPort.y=this._viewPort.y,this.leftViewPort.width=this._viewPort.width/2,this.leftViewPort.height=this._viewPort.height,this.rightViewPort.x=this._viewPort.x+this.leftViewPort.width,this.rightViewPort.y=this._viewPort.y,this.rightViewPort.width=this.leftViewPort.width,this.rightViewPort.height=this.leftViewPort.height},Object.defineProperty(i.prototype,"x",{set:function(t){this._viewPort.x=t,this.updateViewport()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{set:function(t){this._viewPort.y=t,this.updateViewport()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{set:function(t){this._viewPort.width=t,this._camera.aspectRatio=this._viewPort.width/this._viewPort.height,this.updateViewport()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{set:function(t){this._viewPort.height=t,this._camera.aspectRatio=this._viewPort.width/this._viewPort.height,this.updateViewport()},enumerable:!0,configurable:!0}),i.prototype.update=function(e,i){for(this._entityCollect.update(this._camera),this._numberEntity=this._entityCollect.renderList.length,this._index=0;this._index<this._numberEntity;this._index++)this._entityCollect.renderList[this._index].update(e,i,this._camera);var r=this.leftViewPort;
this._camera.viewPort=r,this._camera.tap(t.CameraType.VR,t.VRType.left),t.Egret3DCanvas.context3DProxy.viewPort(r.x,r.y,r.width,r.height),t.Egret3DCanvas.context3DProxy.setScissorRectangle(r.x,r.y,r.width,r.height),this._cleanParmerts&t.Context3DProxy.gl.COLOR_BUFFER_BIT&&t.Egret3DCanvas.context3DProxy.clearColor(this._backColor.x,this._backColor.y,this._backColor.z,this._backColor.w),t.Egret3DCanvas.context3DProxy.clear(this._cleanParmerts),this._render.draw(e,i,t.Egret3DCanvas.context3DProxy,this._entityCollect,this._camera),r=this.rightViewPort,this._camera.viewPort=r,this._camera.tap(t.CameraType.VR,t.VRType.right),t.Egret3DCanvas.context3DProxy.viewPort(r.x,r.y,r.width,r.height),t.Egret3DCanvas.context3DProxy.setScissorRectangle(r.x,r.y,r.width,r.height),this._cleanParmerts&t.Context3DProxy.gl.COLOR_BUFFER_BIT&&t.Egret3DCanvas.context3DProxy.clearColor(this._backColor.x,this._backColor.y,this._backColor.z,this._backColor.w),t.Egret3DCanvas.context3DProxy.clear(this._cleanParmerts),this._render.draw(e,i,t.Egret3DCanvas.context3DProxy,this._entityCollect,this._camera)},Object.defineProperty(i.prototype,"eyeDistance",{get:function(){return this._camera.eyeMatrix.eyeSpace},set:function(t){this._camera.eyeMatrix.eyeSpace=t},enumerable:!0,configurable:!0}),i}(t.View3D);t.VRView3D=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(e){function i(r){void 0===r&&(r=!1),e.call(this),this.canvas3DRectangle=new t.Rectangle,this._view3DS=new Array,this.sizeDiry=!0,this._time=0,this._delay=0,this._renderer=0,this._timeDate=null,this.offsetX=0,this.offsetY=0,t.ShaderUtil.instance.load(),this._envetManager=new t.EventManager(this),this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.zIndex="-1",document.getElementsByClassName("egret-player").length>0?document.getElementsByClassName("egret-player")[0].appendChild(this.canvas):document.body.appendChild(this.canvas),this.canvas.id="egret3D",this.canvas.oncontextmenu=function(){return!1},i.context3DProxy=new t.Context3DProxy,t.Context3DProxy.gl=this.canvas.getContext("experimental-webgl"),t.Context3DProxy.gl||(t.Context3DProxy.gl=this.canvas.getContext("webgl")),t.Context3DProxy.gl.getExtension("WEBGL_draw_buffers"),t.Context3DProxy.gl||alert("you drivers not suport webgl"),i.context3DProxy.register(),console.log("this.context3D ==>",t.Context3DProxy.gl),t.Input.canvas=this,this.initEvent()}return __extends(i,e),i.prototype.initEvent=function(){this._enterFrameEvent3D=new t.Event3D(t.Event3D.ENTER_FRAME),this._enterFrameEvent3D.target=this},Object.defineProperty(i.prototype,"x",{get:function(){return this.canvas3DRectangle.x},set:function(t){this.canvas3DRectangle.x!=t&&this.resize(t,this.canvas3DRectangle.y,this.canvas3DRectangle.width,this.canvas3DRectangle.height)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this.canvas3DRectangle.y},set:function(t){this.canvas3DRectangle.y!=t&&this.resize(this.canvas3DRectangle.x,t,this.canvas3DRectangle.width,this.canvas3DRectangle.height)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this.canvas3DRectangle.width},set:function(t){this.canvas3DRectangle.width!=t&&this.resize(this.canvas3DRectangle.x,this.canvas3DRectangle.y,t,this.canvas3DRectangle.height)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this.canvas3DRectangle.height},set:function(t){this.canvas3DRectangle.height!=t&&this.resize(this.canvas3DRectangle.x,this.canvas3DRectangle.y,this.canvas3DRectangle.width,t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"view3Ds",{get:function(){return this._view3DS},enumerable:!0,configurable:!0}),i.prototype.addView3D=function(t){var e=this._view3DS.indexOf(t);-1==e&&this._view3DS.push(t)},i.prototype.removeView3D=function(t){var e=this._view3DS.indexOf(t);-1!=e&&this._view3DS.splice(e)},i.prototype.start=function(){this.update(0),i.context3DProxy.enableBlend(),i.context3DProxy.enableCullFace(),t.Context3DProxy.gl.enable(t.Context3DProxy.gl.SCISSOR_TEST),t.Context3DProxy.gl.enableVertexAttribArray(0),t.Context3DProxy.gl.enableVertexAttribArray(1),t.Context3DProxy.gl.enableVertexAttribArray(2),t.Context3DProxy.gl.enableVertexAttribArray(3),t.Context3DProxy.gl.enableVertexAttribArray(4),t.Context3DProxy.gl.enableVertexAttribArray(5),t.Context3DProxy.gl.enableVertexAttribArray(6)},i.prototype.update=function(){var e=this;this._timeDate=new Date,this._delay=this._timeDate.getTime()-this._time,this._time=this._timeDate.getTime(),this._enterFrameEvent3D.time+=this._time,this._enterFrameEvent3D.delay=this._delay,this.dispatchEvent(this._enterFrameEvent3D),i.context3DProxy.viewPort(this.canvas3DRectangle.x,this.canvas3DRectangle.y,this.canvas3DRectangle.width,this.canvas3DRectangle.height),i.context3DProxy.setScissorRectangle(this.canvas3DRectangle.x,this.canvas3DRectangle.y,this.canvas3DRectangle.width,this.canvas3DRectangle.height),t.CameraManager.instance.update(this._time,this._delay);for(var r=0;r<this._view3DS.length;r++)this._view3DS[r].update(this._time,this._delay);t.Egret3DEngine.instance.debug&&(this._renderer=Math.floor((new Date).getTime()-this._time),t.Egret3DState.showTime(this._time,this._delay),t.Egret3DState.showDataInfo("renderer: "+this._renderer.toString()+" ms"),t.Egret3DState.show()),this.afterRender&&this.afterRender(),t.Context3DProxy.gl.flush(),requestAnimationFrame(function(t){return e.update(t)})},i.prototype.resize=function(e,i,r,a){this.canvas3DRectangle.x=e,this.canvas3DRectangle.y=i,this.canvas3DRectangle.width=r,this.canvas3DRectangle.height=a,t.ContextConfig.canvasRectangle=this.canvas3DRectangle,this.canvas.style.left=this.canvas3DRectangle.x.toString()+"px",this.canvas.style.top=this.canvas3DRectangle.y.toString()+"px",this.canvas.width=this.canvas3DRectangle.width,this.canvas.height=this.canvas3DRectangle.height},i}(t.EventDispatcher);t.Egret3DCanvas=e}(egret3d||(egret3d={}));var egret3d;!function(egret3d){var Egret3DEngine=function(){function Egret3DEngine(){this.jsPath="js/",this.debug=!1,this._tsconfigs=[],this.importList=[],this._tsconfigs.push("Egret3D/tsconfig.json")}return Egret3DEngine.getXHR=function(){var t=null;return t=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")},Egret3DEngine.prototype.addTsconfig=function(t){this._tsconfigs.push(t)},Egret3DEngine.prototype.setTsconfig=function(t,e){this._tsconfigs[t]=e},Egret3DEngine.prototype.clearTsconfig=function(){this._tsconfigs.length=0},Egret3DEngine.prototype.preload=function(t,e){void 0===e&&(e=null),this._complete=t,this._thisObject=e,this._tsconfigs.length>0?this.doLoader(this._tsconfigs[0]):this.onAllLoadComplete()},Egret3DEngine.prototype.addImportScript=function(t){this.importList.push(t)},Egret3DEngine.prototype.doLoader=function(t){var e=this;return this._currentConfig=t,null==this._xhr&&(this._xhr=Egret3DEngine.getXHR()),null==this._xhr?void alert("Your browser does not support XMLHTTP."):(this._xhr.readyState>0&&this._xhr.abort(),this._xhr.open("GET",t+"?"+1e5*Math.random(),!0),this._xhr.addEventListener("progress",function(t){return e.onProgress(t)},!1),this._xhr.addEventListener("readystatechange",function(t){return e.onReadyStateChange(t)},!1),this._xhr.addEventListener("error",function(t){return e.onError(t)},!1),this._xhr.responseType="text",void this._xhr.send())},Egret3DEngine.prototype.onProgress=function(t){var e=t.loaded.toString()+t.total;console.log("progress event```"+e)},Egret3DEngine.prototype.onReadyStateChange=function(){4==this._xhr.readyState&&(this._xhr.status>=400||0==this._xhr.status?console.log(this._currentConfig,"load fail"):this.onLoadComplete(this._xhr.responseText))},Egret3DEngine.prototype.onLoadComplete=function(source){for(var s_pos=this._currentConfig.lastIndexOf("/"),dir=this._currentConfig.substr(0,s_pos+1),obj=eval("("+source+")"),importName,i=0;i<obj.files.length;++i)importName=this.jsPath+dir,importName+=obj.files[i],importName=importName.replace(".ts",".js"),this.importList.push(importName);var index=this._tsconfigs.indexOf(this._currentConfig);index==this._tsconfigs.length-1?this.onAllLoadTsconfigComplete():(this._xhr=null,this.doLoader(this._tsconfigs[++index]))},Egret3DEngine.prototype.onError=function(){},Egret3DEngine.prototype.onAllLoadTsconfigComplete=function(){this.onTsconfig&&this.onTsconfig(),this.startLoadScript(null)},Egret3DEngine.prototype.onAllLoadComplete=function(){this._complete&&(this._thisObject?this._complete.call(this._thisObject):this._complete())},Egret3DEngine.prototype.startLoadScript=function(){var t=this;if(this.importList.length>0){var e=document.createElement("script");e.src=this.importList.shift(),e.onload=function(e){return t.startLoadScript(e)},e.onerror=function(e){return t.loadScriptError(e)},document.head.appendChild(e)}else console.log("all complete"),this.onAllLoadComplete()},Egret3DEngine.prototype.loadScriptError=function(t){var e="load Script Error \r\n no file:"+t.srcElement.src;alert(e),this.startLoadScript(null)},Egret3DEngine.instance=new Egret3DEngine,Egret3DEngine}();egret3d.Egret3DEngine=Egret3DEngine}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this._debugHud=new t.HUD,this.postRender=new t.PostRender("hud_vs","SSAO")}return e.prototype.drawTexture=function(t,e,i,r,a,n,o){this.postRender.hud.colorPass=o.colorPass,this.postRender.hud.positionPass=o.positionPass,this.postRender.hud.normalPass=o.normalPass,this.postRender.draw(t,e,i,r,a,n,o),o.end=this.postRender.renderTexture},e}();t.AmbientOcclusion=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this._debugHud=new t.HUD,this.mainPassRender=new t.MultiRender(t.PassType.normalPass),this.mainPassRender.setRenderToTexture(2048,2048,t.FrameBufferFormat.UNSIGNED_BYTE_RGB),this._debugHud.fsShader="hud_H_fs",this._debugHud.x=512,this._debugHud.y=0,this._debugHud.width=256,this._debugHud.height=256}return e.prototype.drawTexture=function(t,e,i,r,a,n,o){this.mainPassRender.draw(t,e,i,r,a,n),o.mainPass=this.mainPassRender.renderTexture,o.end=this.mainPassRender.renderTexture,o.colorTexture=this.mainPassRender.renderTexture},e}();t.MainPass=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this._debugHud=new t.HUD,this.colorPassRender=new t.MultiRender(t.PassType.colorPass),this.colorPassRender.setRenderToTexture(2048,2048,t.FrameBufferFormat.UNSIGNED_BYTE_RGB),this.PositionPassRender=new t.MultiRender(t.PassType.depthPass_8),this.PositionPassRender.setRenderToTexture(2048,2048,t.FrameBufferFormat.FLOAT_RGBA),this.NormalPassRender=new t.MultiRender(t.PassType.normalPass),this.NormalPassRender.setRenderToTexture(2048,2048,t.FrameBufferFormat.UNSIGNED_BYTE_RGB),this._debugHud.fsShader="hud_H_fs",this._debugHud.x=512,this._debugHud.y=0,this._debugHud.width=256,this._debugHud.height=256}return e.prototype.drawTexture=function(t,e,i,r,a,n,o){this.colorPassRender.draw(t,e,i,r,a,n),this.NormalPassRender.draw(t,e,i,r,a,n),this.PositionPassRender.draw(t,e,i,r,a,n),o.colorPass=this.colorPassRender.renderTexture,o.positionPass=this.PositionPassRender.renderTexture,o.normalPass=this.NormalPassRender.renderTexture,this._debugHud.viewPort=a.viewPort,this._debugHud.diffuseTexture=this.colorPassRender.renderTexture,this._debugHud.draw(i)},e}();t.DeferredShadingProcessing=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this._debugHud=new t.HUD,this.postRender=new t.PostRender("hud_vs","bloom_fs"),this.postRender.setRenderToTexture(256,256,t.FrameBufferFormat.UNSIGNED_BYTE_RGB),this.gaussPass=new t.GaussPass,this._debugHud.fsShader="hud_H_fs",this._debugHud.x=768,this._debugHud.y=0,this._debugHud.width=128,this._debugHud.height=128}return e.prototype.drawTexture=function(t,e,i,r,a,n,o){this.postRender.draw(t,e,i,r,a,n,o),o.bloomPass=this.postRender.renderTexture,o.end=this.postRender.renderTexture,this.gaussPass.drawTexture(t,e,i,r,a,n,o)},e}();t.BloomPass=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this._debugHud=new t.HUD,this._h_postRender=new t.PostRender("hud_vs","gaussian_H_fs"),this._h_postRender.setRenderToTexture(2048,2048,t.FrameBufferFormat.UNSIGNED_BYTE_RGB),this._v_postRender=new t.PostRender("hud_vs","gaussian_V_fs"),this._v_postRender.setRenderToTexture(2048,2048,t.FrameBufferFormat.UNSIGNED_BYTE_RGB),this._debugHud.fsShader="hud_H_fs",this._debugHud.x=768,this._debugHud.y=0,this._debugHud.width=128,this._debugHud.height=128}return e.prototype.drawTexture=function(t,e,i,r,a,n,o){this._h_postRender.draw(t,e,i,r,a,n,o),o.end=this._h_postRender.renderTexture,this._v_postRender.draw(t,e,i,r,a,n,o),o.end=this._v_postRender.renderTexture,o.bloomPass=this._v_postRender.renderTexture},e}();t.GaussPass=e}(egret3d||(egret3d={}));var egret3d;!function(t){var e=function(){function e(){this.posTex={},this.postItem=[],this.postRender=new t.MultiRender(t.PassType.diffusePass),this.postRender.setRenderToTexture(1024,1024,t.FrameBufferFormat.FLOAT_RGB),this.endTexture=this.posTex.end=this.postRender.renderTexture}return e.prototype.drawFrameBuffer=function(t,e,i,r,a,n){void 0===n&&(n=null);for(var o=0;o<this.postItem.length;o++)this.postItem[o].drawTexture(t,e,i,r,a,n,this.posTex),this.endTexture=this.posTex.end},e}();t.PostProcessing=e}(egret3d||(egret3d={}));
;/*!libs/libs/static/tween/TweenMax.js*/
var _gsScope="undefined"!=typeof module&&module.exports&&"undefined"!=typeof global?global:this||window;(_gsScope._gsQueue||(_gsScope._gsQueue=[])).push(function(){"use strict";_gsScope._gsDefine("TweenMax",["core.Animation","core.SimpleTimeline","TweenLite"],function(t,e,i){var s=function(t){var e,i=[],s=t.length;for(e=0;e!==s;i.push(t[e++]));return i},r=function(t,e,i){var s,r,n=t.cycle;for(s in n)r=n[s],t[s]="function"==typeof r?r(i,e[i]):r[i%r.length];delete t.cycle},n=function(t,e,s){i.call(this,t,e,s),this._cycle=0,this._yoyo=this.vars.yoyo===!0,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._dirty=!0,this.render=n.prototype.render},a=1e-10,o=i._internals,l=o.isSelector,h=o.isArray,_=n.prototype=i.to({},.1,{}),u=[];n.version="1.19.0",_.constructor=n,_.kill()._gc=!1,n.killTweensOf=n.killDelayedCallsTo=i.killTweensOf,n.getTweensOf=i.getTweensOf,n.lagSmoothing=i.lagSmoothing,n.ticker=i.ticker,n.render=i.render,_.invalidate=function(){return this._yoyo=this.vars.yoyo===!0,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._uncache(!0),i.prototype.invalidate.call(this)},_.updateTo=function(t,e){var s,r=this.ratio,n=this.vars.immediateRender||t.immediateRender;e&&this._startTime<this._timeline._time&&(this._startTime=this._timeline._time,this._uncache(!1),this._gc?this._enabled(!0,!1):this._timeline.insert(this,this._startTime-this._delay));for(s in t)this.vars[s]=t[s];if(this._initted||n)if(e)this._initted=!1,n&&this.render(0,!0,!0);else if(this._gc&&this._enabled(!0,!1),this._notifyPluginsOfEnabled&&this._firstPT&&i._onPluginEvent("_onDisable",this),this._time/this._duration>.998){var a=this._totalTime;this.render(0,!0,!1),this._initted=!1,this.render(a,!0,!1)}else if(this._initted=!1,this._init(),this._time>0||n)for(var o,l=1/(1-r),h=this._firstPT;h;)o=h.s+h.c,h.c*=l,h.s=o-h.c,h=h._next;return this},_.render=function(t,e,i){this._initted||0===this._duration&&this.vars.repeat&&this.invalidate();var s,r,n,l,h,_,u,f,c=this._dirty?this.totalDuration():this._totalDuration,p=this._time,m=this._totalTime,d=this._cycle,g=this._duration,v=this._rawPrevTime;if(t>=c-1e-7?(this._totalTime=c,this._cycle=this._repeat,this._yoyo&&0!==(1&this._cycle)?(this._time=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0):(this._time=g,this.ratio=this._ease._calcEnd?this._ease.getRatio(1):1),this._reversed||(s=!0,r="onComplete",i=i||this._timeline.autoRemoveChildren),0===g&&(this._initted||!this.vars.lazy||i)&&(this._startTime===this._timeline._duration&&(t=0),(0>v||0>=t&&t>=-1e-7||v===a&&"isPause"!==this.data)&&v!==t&&(i=!0,v>a&&(r="onReverseComplete")),this._rawPrevTime=f=!e||t||v===t?t:a)):1e-7>t?(this._totalTime=this._time=this._cycle=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0,(0!==m||0===g&&v>0)&&(r="onReverseComplete",s=this._reversed),0>t&&(this._active=!1,0===g&&(this._initted||!this.vars.lazy||i)&&(v>=0&&(i=!0),this._rawPrevTime=f=!e||t||v===t?t:a)),this._initted||(i=!0)):(this._totalTime=this._time=t,0!==this._repeat&&(l=g+this._repeatDelay,this._cycle=this._totalTime/l>>0,0!==this._cycle&&this._cycle===this._totalTime/l&&t>=m&&this._cycle--,this._time=this._totalTime-this._cycle*l,this._yoyo&&0!==(1&this._cycle)&&(this._time=g-this._time),this._time>g?this._time=g:this._time<0&&(this._time=0)),this._easeType?(h=this._time/g,_=this._easeType,u=this._easePower,(1===_||3===_&&h>=.5)&&(h=1-h),3===_&&(h*=2),1===u?h*=h:2===u?h*=h*h:3===u?h*=h*h*h:4===u&&(h*=h*h*h*h),this.ratio=1===_?1-h:2===_?h:this._time/g<.5?h/2:1-h/2):this.ratio=this._ease.getRatio(this._time/g)),p===this._time&&!i&&d===this._cycle)return void(m!==this._totalTime&&this._onUpdate&&(e||this._callback("onUpdate")));if(!this._initted){if(this._init(),!this._initted||this._gc)return;if(!i&&this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration))return this._time=p,this._totalTime=m,this._rawPrevTime=v,this._cycle=d,o.lazyTweens.push(this),void(this._lazy=[t,e]);this._time&&!s?this.ratio=this._ease.getRatio(this._time/g):s&&this._ease._calcEnd&&(this.ratio=this._ease.getRatio(0===this._time?0:1))}for(this._lazy!==!1&&(this._lazy=!1),this._active||!this._paused&&this._time!==p&&t>=0&&(this._active=!0),0===m&&(2===this._initted&&t>0&&this._init(),this._startAt&&(t>=0?this._startAt.render(t,e,i):r||(r="_dummyGS")),this.vars.onStart&&(0!==this._totalTime||0===g)&&(e||this._callback("onStart"))),n=this._firstPT;n;)n.f?n.t[n.p](n.c*this.ratio+n.s):n.t[n.p]=n.c*this.ratio+n.s,n=n._next;this._onUpdate&&(0>t&&this._startAt&&this._startTime&&this._startAt.render(t,e,i),e||(this._totalTime!==m||r)&&this._callback("onUpdate")),this._cycle!==d&&(e||this._gc||this.vars.onRepeat&&this._callback("onRepeat")),r&&(!this._gc||i)&&(0>t&&this._startAt&&!this._onUpdate&&this._startTime&&this._startAt.render(t,e,i),s&&(this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!e&&this.vars[r]&&this._callback(r),0===g&&this._rawPrevTime===a&&f!==a&&(this._rawPrevTime=0))},n.to=function(t,e,i){return new n(t,e,i)},n.from=function(t,e,i){return i.runBackwards=!0,i.immediateRender=0!=i.immediateRender,new n(t,e,i)},n.fromTo=function(t,e,i,s){return s.startAt=i,s.immediateRender=0!=s.immediateRender&&0!=i.immediateRender,new n(t,e,s)},n.staggerTo=n.allTo=function(t,e,a,o,_,f,c){o=o||0;var p,m,d,g,v=0,y=[],T=function(){a.onComplete&&a.onComplete.apply(a.onCompleteScope||this,arguments),_.apply(c||a.callbackScope||this,f||u)},x=a.cycle,w=a.startAt&&a.startAt.cycle;for(h(t)||("string"==typeof t&&(t=i.selector(t)||t),l(t)&&(t=s(t))),t=t||[],0>o&&(t=s(t),t.reverse(),o*=-1),p=t.length-1,d=0;p>=d;d++){m={};for(g in a)m[g]=a[g];if(x&&(r(m,t,d),null!=m.duration&&(e=m.duration,delete m.duration)),w){w=m.startAt={};for(g in a.startAt)w[g]=a.startAt[g];r(m.startAt,t,d)}m.delay=v+(m.delay||0),d===p&&_&&(m.onComplete=T),y[d]=new n(t[d],e,m),v+=o}return y},n.staggerFrom=n.allFrom=function(t,e,i,s,r,a,o){return i.runBackwards=!0,i.immediateRender=0!=i.immediateRender,n.staggerTo(t,e,i,s,r,a,o)},n.staggerFromTo=n.allFromTo=function(t,e,i,s,r,a,o,l){return s.startAt=i,s.immediateRender=0!=s.immediateRender&&0!=i.immediateRender,n.staggerTo(t,e,s,r,a,o,l)},n.delayedCall=function(t,e,i,s,r){return new n(e,0,{delay:t,onComplete:e,onCompleteParams:i,callbackScope:s,onReverseComplete:e,onReverseCompleteParams:i,immediateRender:!1,useFrames:r,overwrite:0})},n.set=function(t,e){return new n(t,0,e)},n.isTweening=function(t){return i.getTweensOf(t,!0).length>0};var f=function(t,e){for(var s=[],r=0,n=t._first;n;)n instanceof i?s[r++]=n:(e&&(s[r++]=n),s=s.concat(f(n,e)),r=s.length),n=n._next;return s},c=n.getAllTweens=function(e){return f(t._rootTimeline,e).concat(f(t._rootFramesTimeline,e))};n.killAll=function(t,i,s,r){null==i&&(i=!0),null==s&&(s=!0);var n,a,o,l=c(0!=r),h=l.length,_=i&&s&&r;for(o=0;h>o;o++)a=l[o],(_||a instanceof e||(n=a.target===a.vars.onComplete)&&s||i&&!n)&&(t?a.totalTime(a._reversed?0:a.totalDuration()):a._enabled(!1,!1))},n.killChildTweensOf=function(t,e){if(null!=t){var r,a,_,u,f,c=o.tweenLookup;if("string"==typeof t&&(t=i.selector(t)||t),l(t)&&(t=s(t)),h(t))for(u=t.length;--u>-1;)n.killChildTweensOf(t[u],e);else{r=[];for(_ in c)for(a=c[_].target.parentNode;a;)a===t&&(r=r.concat(c[_].tweens)),a=a.parentNode;for(f=r.length,u=0;f>u;u++)e&&r[u].totalTime(r[u].totalDuration()),r[u]._enabled(!1,!1)}}};var p=function(t,i,s,r){i=i!==!1,s=s!==!1,r=r!==!1;for(var n,a,o=c(r),l=i&&s&&r,h=o.length;--h>-1;)a=o[h],(l||a instanceof e||(n=a.target===a.vars.onComplete)&&s||i&&!n)&&a.paused(t)};return n.pauseAll=function(t,e,i){p(!0,t,e,i)},n.resumeAll=function(t,e,i){p(!1,t,e,i)},n.globalTimeScale=function(e){var s=t._rootTimeline,r=i.ticker.time;return arguments.length?(e=e||a,s._startTime=r-(r-s._startTime)*s._timeScale/e,s=t._rootFramesTimeline,r=i.ticker.frame,s._startTime=r-(r-s._startTime)*s._timeScale/e,s._timeScale=t._rootTimeline._timeScale=e,e):s._timeScale},_.progress=function(t,e){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&0!==(1&this._cycle)?1-t:t)+this._cycle*(this._duration+this._repeatDelay),e):this._time/this.duration()},_.totalProgress=function(t,e){return arguments.length?this.totalTime(this.totalDuration()*t,e):this._totalTime/this.totalDuration()},_.time=function(t,e){return arguments.length?(this._dirty&&this.totalDuration(),t>this._duration&&(t=this._duration),this._yoyo&&0!==(1&this._cycle)?t=this._duration-t+this._cycle*(this._duration+this._repeatDelay):0!==this._repeat&&(t+=this._cycle*(this._duration+this._repeatDelay)),this.totalTime(t,e)):this._time},_.duration=function(e){return arguments.length?t.prototype.duration.call(this,e):this._duration},_.totalDuration=function(t){return arguments.length?-1===this._repeat?this:this.duration((t-this._repeat*this._repeatDelay)/(this._repeat+1)):(this._dirty&&(this._totalDuration=-1===this._repeat?999999999999:this._duration*(this._repeat+1)+this._repeatDelay*this._repeat,this._dirty=!1),this._totalDuration)},_.repeat=function(t){return arguments.length?(this._repeat=t,this._uncache(!0)):this._repeat},_.repeatDelay=function(t){return arguments.length?(this._repeatDelay=t,this._uncache(!0)):this._repeatDelay},_.yoyo=function(t){return arguments.length?(this._yoyo=t,this):this._yoyo},n},!0),_gsScope._gsDefine("TimelineLite",["core.Animation","core.SimpleTimeline","TweenLite"],function(t,e,i){var s=function(t){e.call(this,t),this._labels={},this.autoRemoveChildren=this.vars.autoRemoveChildren===!0,this.smoothChildTiming=this.vars.smoothChildTiming===!0,this._sortChildren=!0,this._onUpdate=this.vars.onUpdate;var i,s,r=this.vars;for(s in r)i=r[s],l(i)&&-1!==i.join("").indexOf("{self}")&&(r[s]=this._swapSelfInParams(i));l(r.tweens)&&this.add(r.tweens,0,r.align,r.stagger)},r=1e-10,n=i._internals,a=s._internals={},o=n.isSelector,l=n.isArray,h=n.lazyTweens,_=n.lazyRender,u=_gsScope._gsDefine.globals,f=function(t){var e,i={};for(e in t)i[e]=t[e];return i},c=function(t,e,i){var s,r,n=t.cycle;for(s in n)r=n[s],t[s]="function"==typeof r?r.call(e[i],i):r[i%r.length];delete t.cycle},p=a.pauseCallback=function(){},m=function(t){var e,i=[],s=t.length;for(e=0;e!==s;i.push(t[e++]));return i},d=s.prototype=new e;return s.version="1.19.0",d.constructor=s,d.kill()._gc=d._forcingPlayhead=d._hasPause=!1,d.to=function(t,e,s,r){var n=s.repeat&&u.TweenMax||i;return e?this.add(new n(t,e,s),r):this.set(t,s,r)},d.from=function(t,e,s,r){return this.add((s.repeat&&u.TweenMax||i).from(t,e,s),r)},d.fromTo=function(t,e,s,r,n){var a=r.repeat&&u.TweenMax||i;return e?this.add(a.fromTo(t,e,s,r),n):this.set(t,r,n)},d.staggerTo=function(t,e,r,n,a,l,h,_){var u,p,d=new s({onComplete:l,onCompleteParams:h,callbackScope:_,smoothChildTiming:this.smoothChildTiming}),g=r.cycle;for("string"==typeof t&&(t=i.selector(t)||t),t=t||[],o(t)&&(t=m(t)),n=n||0,0>n&&(t=m(t),t.reverse(),n*=-1),p=0;p<t.length;p++)u=f(r),u.startAt&&(u.startAt=f(u.startAt),u.startAt.cycle&&c(u.startAt,t,p)),g&&(c(u,t,p),null!=u.duration&&(e=u.duration,delete u.duration)),d.to(t[p],e,u,p*n);return this.add(d,a)},d.staggerFrom=function(t,e,i,s,r,n,a,o){return i.immediateRender=0!=i.immediateRender,i.runBackwards=!0,this.staggerTo(t,e,i,s,r,n,a,o)},d.staggerFromTo=function(t,e,i,s,r,n,a,o,l){return s.startAt=i,s.immediateRender=0!=s.immediateRender&&0!=i.immediateRender,this.staggerTo(t,e,s,r,n,a,o,l)},d.call=function(t,e,s,r){return this.add(i.delayedCall(0,t,e,s),r)},d.set=function(t,e,s){return s=this._parseTimeOrLabel(s,0,!0),null==e.immediateRender&&(e.immediateRender=s===this._time&&!this._paused),this.add(new i(t,0,e),s)},s.exportRoot=function(t,e){t=t||{},null==t.smoothChildTiming&&(t.smoothChildTiming=!0);var r,n,a=new s(t),o=a._timeline;for(null==e&&(e=!0),o._remove(a,!0),a._startTime=0,a._rawPrevTime=a._time=a._totalTime=o._time,r=o._first;r;)n=r._next,e&&r instanceof i&&r.target===r.vars.onComplete||a.add(r,r._startTime-r._delay),r=n;return o.add(a,0),a},d.add=function(r,n,a,o){var h,_,u,f,c,p;if("number"!=typeof n&&(n=this._parseTimeOrLabel(n,0,!0,r)),!(r instanceof t)){if(r instanceof Array||r&&r.push&&l(r)){for(a=a||"normal",o=o||0,h=n,_=r.length,u=0;_>u;u++)l(f=r[u])&&(f=new s({tweens:f})),this.add(f,h),"string"!=typeof f&&"function"!=typeof f&&("sequence"===a?h=f._startTime+f.totalDuration()/f._timeScale:"start"===a&&(f._startTime-=f.delay())),h+=o;return this._uncache(!0)}if("string"==typeof r)return this.addLabel(r,n);if("function"!=typeof r)throw"Cannot add "+r+" into the timeline; it is not a tween, timeline, function, or string.";r=i.delayedCall(0,r)}if(e.prototype.add.call(this,r,n),(this._gc||this._time===this._duration)&&!this._paused&&this._duration<this.duration())for(c=this,p=c.rawTime()>r._startTime;c._timeline;)p&&c._timeline.smoothChildTiming?c.totalTime(c._totalTime,!0):c._gc&&c._enabled(!0,!1),c=c._timeline;return this},d.remove=function(e){if(e instanceof t){this._remove(e,!1);var i=e._timeline=e.vars.useFrames?t._rootFramesTimeline:t._rootTimeline;return e._startTime=(e._paused?e._pauseTime:i._time)-(e._reversed?e.totalDuration()-e._totalTime:e._totalTime)/e._timeScale,this}if(e instanceof Array||e&&e.push&&l(e)){for(var s=e.length;--s>-1;)this.remove(e[s]);return this}return"string"==typeof e?this.removeLabel(e):this.kill(null,e)},d._remove=function(t,i){e.prototype._remove.call(this,t,i);var s=this._last;return s?this._time>s._startTime+s._totalDuration/s._timeScale&&(this._time=this.duration(),this._totalTime=this._totalDuration):this._time=this._totalTime=this._duration=this._totalDuration=0,this},d.append=function(t,e){return this.add(t,this._parseTimeOrLabel(null,e,!0,t))},d.insert=d.insertMultiple=function(t,e,i,s){return this.add(t,e||0,i,s)},d.appendMultiple=function(t,e,i,s){return this.add(t,this._parseTimeOrLabel(null,e,!0,t),i,s)},d.addLabel=function(t,e){return this._labels[t]=this._parseTimeOrLabel(e),this},d.addPause=function(t,e,s,r){var n=i.delayedCall(0,p,s,r||this);return n.vars.onComplete=n.vars.onReverseComplete=e,n.data="isPause",this._hasPause=!0,this.add(n,t)},d.removeLabel=function(t){return delete this._labels[t],this},d.getLabelTime=function(t){return null!=this._labels[t]?this._labels[t]:-1},d._parseTimeOrLabel=function(e,i,s,r){var n;if(r instanceof t&&r.timeline===this)this.remove(r);else if(r&&(r instanceof Array||r.push&&l(r)))for(n=r.length;--n>-1;)r[n]instanceof t&&r[n].timeline===this&&this.remove(r[n]);if("string"==typeof i)return this._parseTimeOrLabel(i,s&&"number"==typeof e&&null==this._labels[i]?e-this.duration():0,s);if(i=i||0,"string"!=typeof e||!isNaN(e)&&null==this._labels[e])null==e&&(e=this.duration());else{if(n=e.indexOf("="),-1===n)return null==this._labels[e]?s?this._labels[e]=this.duration()+i:i:this._labels[e]+i;i=parseInt(e.charAt(n-1)+"1",10)*Number(e.substr(n+1)),e=n>1?this._parseTimeOrLabel(e.substr(0,n-1),0,s):this.duration()}return Number(e)+i},d.seek=function(t,e){return this.totalTime("number"==typeof t?t:this._parseTimeOrLabel(t),e!==!1)},d.stop=function(){return this.paused(!0)},d.gotoAndPlay=function(t,e){return this.play(t,e)},d.gotoAndStop=function(t,e){return this.pause(t,e)},d.render=function(t,e,i){this._gc&&this._enabled(!0,!1);var s,n,a,o,l,u,f,c=this._dirty?this.totalDuration():this._totalDuration,p=this._time,m=this._startTime,d=this._timeScale,g=this._paused;if(t>=c-1e-7)this._totalTime=this._time=c,this._reversed||this._hasPausedChild()||(n=!0,o="onComplete",l=!!this._timeline.autoRemoveChildren,0===this._duration&&(0>=t&&t>=-1e-7||this._rawPrevTime<0||this._rawPrevTime===r)&&this._rawPrevTime!==t&&this._first&&(l=!0,this._rawPrevTime>r&&(o="onReverseComplete"))),this._rawPrevTime=this._duration||!e||t||this._rawPrevTime===t?t:r,t=c+1e-4;else if(1e-7>t)if(this._totalTime=this._time=0,(0!==p||0===this._duration&&this._rawPrevTime!==r&&(this._rawPrevTime>0||0>t&&this._rawPrevTime>=0))&&(o="onReverseComplete",n=this._reversed),0>t)this._active=!1,this._timeline.autoRemoveChildren&&this._reversed?(l=n=!0,o="onReverseComplete"):this._rawPrevTime>=0&&this._first&&(l=!0),this._rawPrevTime=t;else{if(this._rawPrevTime=this._duration||!e||t||this._rawPrevTime===t?t:r,0===t&&n)for(s=this._first;s&&0===s._startTime;)s._duration||(n=!1),s=s._next;t=0,this._initted||(l=!0)}else{if(this._hasPause&&!this._forcingPlayhead&&!e){if(t>=p)for(s=this._first;s&&s._startTime<=t&&!u;)s._duration||"isPause"!==s.data||s.ratio||0===s._startTime&&0===this._rawPrevTime||(u=s),s=s._next;else for(s=this._last;s&&s._startTime>=t&&!u;)s._duration||"isPause"===s.data&&s._rawPrevTime>0&&(u=s),s=s._prev;u&&(this._time=t=u._startTime,this._totalTime=t+this._cycle*(this._totalDuration+this._repeatDelay))}this._totalTime=this._time=this._rawPrevTime=t}if(this._time!==p&&this._first||i||l||u){if(this._initted||(this._initted=!0),this._active||!this._paused&&this._time!==p&&t>0&&(this._active=!0),0===p&&this.vars.onStart&&(0===this._time&&this._duration||e||this._callback("onStart")),f=this._time,f>=p)for(s=this._first;s&&(a=s._next,f===this._time&&(!this._paused||g));)(s._active||s._startTime<=f&&!s._paused&&!s._gc)&&(u===s&&this.pause(),s._reversed?s.render((s._dirty?s.totalDuration():s._totalDuration)-(t-s._startTime)*s._timeScale,e,i):s.render((t-s._startTime)*s._timeScale,e,i)),s=a;else for(s=this._last;s&&(a=s._prev,f===this._time&&(!this._paused||g));){if(s._active||s._startTime<=p&&!s._paused&&!s._gc){if(u===s){for(u=s._prev;u&&u.endTime()>this._time;)u.render(u._reversed?u.totalDuration()-(t-u._startTime)*u._timeScale:(t-u._startTime)*u._timeScale,e,i),u=u._prev;u=null,this.pause()}s._reversed?s.render((s._dirty?s.totalDuration():s._totalDuration)-(t-s._startTime)*s._timeScale,e,i):s.render((t-s._startTime)*s._timeScale,e,i)}s=a}this._onUpdate&&(e||(h.length&&_(),this._callback("onUpdate"))),o&&(this._gc||(m===this._startTime||d!==this._timeScale)&&(0===this._time||c>=this.totalDuration())&&(n&&(h.length&&_(),this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!e&&this.vars[o]&&this._callback(o)))}},d._hasPausedChild=function(){for(var t=this._first;t;){if(t._paused||t instanceof s&&t._hasPausedChild())return!0;t=t._next}return!1},d.getChildren=function(t,e,s,r){r=r||-9999999999;for(var n=[],a=this._first,o=0;a;)a._startTime<r||(a instanceof i?e!==!1&&(n[o++]=a):(s!==!1&&(n[o++]=a),t!==!1&&(n=n.concat(a.getChildren(!0,e,s)),o=n.length))),a=a._next;return n},d.getTweensOf=function(t,e){var s,r,n=this._gc,a=[],o=0;for(n&&this._enabled(!0,!0),s=i.getTweensOf(t),r=s.length;--r>-1;)(s[r].timeline===this||e&&this._contains(s[r]))&&(a[o++]=s[r]);return n&&this._enabled(!1,!0),a},d.recent=function(){return this._recent},d._contains=function(t){for(var e=t.timeline;e;){if(e===this)return!0;e=e.timeline}return!1},d.shiftChildren=function(t,e,i){i=i||0;for(var s,r=this._first,n=this._labels;r;)r._startTime>=i&&(r._startTime+=t),r=r._next;if(e)for(s in n)n[s]>=i&&(n[s]+=t);return this._uncache(!0)},d._kill=function(t,e){if(!t&&!e)return this._enabled(!1,!1);for(var i=e?this.getTweensOf(e):this.getChildren(!0,!0,!1),s=i.length,r=!1;--s>-1;)i[s]._kill(t,e)&&(r=!0);return r},d.clear=function(t){var e=this.getChildren(!1,!0,!0),i=e.length;for(this._time=this._totalTime=0;--i>-1;)e[i]._enabled(!1,!1);return t!==!1&&(this._labels={}),this._uncache(!0)},d.invalidate=function(){for(var e=this._first;e;)e.invalidate(),e=e._next;return t.prototype.invalidate.call(this)},d._enabled=function(t,i){if(t===this._gc)for(var s=this._first;s;)s._enabled(t,!0),s=s._next;return e.prototype._enabled.call(this,t,i)},d.totalTime=function(){this._forcingPlayhead=!0;var e=t.prototype.totalTime.apply(this,arguments);return this._forcingPlayhead=!1,e},d.duration=function(t){return arguments.length?(0!==this.duration()&&0!==t&&this.timeScale(this._duration/t),this):(this._dirty&&this.totalDuration(),this._duration)},d.totalDuration=function(t){if(!arguments.length){if(this._dirty){for(var e,i,s=0,r=this._last,n=999999999999;r;)e=r._prev,r._dirty&&r.totalDuration(),r._startTime>n&&this._sortChildren&&!r._paused?this.add(r,r._startTime-r._delay):n=r._startTime,r._startTime<0&&!r._paused&&(s-=r._startTime,this._timeline.smoothChildTiming&&(this._startTime+=r._startTime/this._timeScale),this.shiftChildren(-r._startTime,!1,-9999999999),n=0),i=r._startTime+r._totalDuration/r._timeScale,i>s&&(s=i),r=e;this._duration=this._totalDuration=s,this._dirty=!1}return this._totalDuration}return t&&this.totalDuration()?this.timeScale(this._totalDuration/t):this},d.paused=function(e){if(!e)for(var i=this._first,s=this._time;i;)i._startTime===s&&"isPause"===i.data&&(i._rawPrevTime=0),i=i._next;return t.prototype.paused.apply(this,arguments)},d.usesFrames=function(){for(var e=this._timeline;e._timeline;)e=e._timeline;return e===t._rootFramesTimeline},d.rawTime=function(){return this._paused?this._totalTime:(this._timeline.rawTime()-this._startTime)*this._timeScale},s},!0),_gsScope._gsDefine("TimelineMax",["TimelineLite","TweenLite","easing.Ease"],function(t,e,i){var s=function(e){t.call(this,e),this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._cycle=0,this._yoyo=this.vars.yoyo===!0,this._dirty=!0},r=1e-10,n=e._internals,a=n.lazyTweens,o=n.lazyRender,l=_gsScope._gsDefine.globals,h=new i(null,null,1,0),_=s.prototype=new t;return _.constructor=s,_.kill()._gc=!1,s.version="1.19.0",_.invalidate=function(){return this._yoyo=this.vars.yoyo===!0,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._uncache(!0),t.prototype.invalidate.call(this)},_.addCallback=function(t,i,s,r){return this.add(e.delayedCall(0,t,s,r),i)},_.removeCallback=function(t,e){if(t)if(null==e)this._kill(null,t);else for(var i=this.getTweensOf(t,!1),s=i.length,r=this._parseTimeOrLabel(e);--s>-1;)i[s]._startTime===r&&i[s]._enabled(!1,!1);return this},_.removePause=function(e){return this.removeCallback(t._internals.pauseCallback,e)},_.tweenTo=function(t,i){i=i||{};var s,r,n,a={ease:h,useFrames:this.usesFrames(),immediateRender:!1},o=i.repeat&&l.TweenMax||e;for(r in i)a[r]=i[r];return a.time=this._parseTimeOrLabel(t),s=Math.abs(Number(a.time)-this._time)/this._timeScale||.001,n=new o(this,s,a),a.onStart=function(){n.target.paused(!0),n.vars.time!==n.target.time()&&s===n.duration()&&n.duration(Math.abs(n.vars.time-n.target.time())/n.target._timeScale),i.onStart&&n._callback("onStart")},n},_.tweenFromTo=function(t,e,i){i=i||{},t=this._parseTimeOrLabel(t),i.startAt={onComplete:this.seek,onCompleteParams:[t],callbackScope:this},i.immediateRender=i.immediateRender!==!1;var s=this.tweenTo(e,i);return s.duration(Math.abs(s.vars.time-t)/this._timeScale||.001)},_.render=function(t,e,i){this._gc&&this._enabled(!0,!1);var s,n,l,h,_,u,f,c,p=this._dirty?this.totalDuration():this._totalDuration,m=this._duration,d=this._time,g=this._totalTime,v=this._startTime,y=this._timeScale,T=this._rawPrevTime,x=this._paused,w=this._cycle;if(t>=p-1e-7)this._locked||(this._totalTime=p,this._cycle=this._repeat),this._reversed||this._hasPausedChild()||(n=!0,h="onComplete",_=!!this._timeline.autoRemoveChildren,0===this._duration&&(0>=t&&t>=-1e-7||0>T||T===r)&&T!==t&&this._first&&(_=!0,T>r&&(h="onReverseComplete"))),this._rawPrevTime=this._duration||!e||t||this._rawPrevTime===t?t:r,this._yoyo&&0!==(1&this._cycle)?this._time=t=0:(this._time=m,t=m+1e-4);else if(1e-7>t)if(this._locked||(this._totalTime=this._cycle=0),this._time=0,(0!==d||0===m&&T!==r&&(T>0||0>t&&T>=0)&&!this._locked)&&(h="onReverseComplete",n=this._reversed),0>t)this._active=!1,this._timeline.autoRemoveChildren&&this._reversed?(_=n=!0,h="onReverseComplete"):T>=0&&this._first&&(_=!0),this._rawPrevTime=t;else{if(this._rawPrevTime=m||!e||t||this._rawPrevTime===t?t:r,0===t&&n)for(s=this._first;s&&0===s._startTime;)s._duration||(n=!1),s=s._next;t=0,this._initted||(_=!0)}else if(0===m&&0>T&&(_=!0),this._time=this._rawPrevTime=t,this._locked||(this._totalTime=t,0!==this._repeat&&(u=m+this._repeatDelay,this._cycle=this._totalTime/u>>0,0!==this._cycle&&this._cycle===this._totalTime/u&&t>=g&&this._cycle--,this._time=this._totalTime-this._cycle*u,this._yoyo&&0!==(1&this._cycle)&&(this._time=m-this._time),this._time>m?(this._time=m,t=m+1e-4):this._time<0?this._time=t=0:t=this._time)),this._hasPause&&!this._forcingPlayhead&&!e){if(t=this._time,t>=d)for(s=this._first;s&&s._startTime<=t&&!f;)s._duration||"isPause"!==s.data||s.ratio||0===s._startTime&&0===this._rawPrevTime||(f=s),s=s._next;else for(s=this._last;s&&s._startTime>=t&&!f;)s._duration||"isPause"===s.data&&s._rawPrevTime>0&&(f=s),s=s._prev;f&&(this._time=t=f._startTime,this._totalTime=t+this._cycle*(this._totalDuration+this._repeatDelay))}if(this._cycle!==w&&!this._locked){var b=this._yoyo&&0!==(1&w),P=b===(this._yoyo&&0!==(1&this._cycle)),O=this._totalTime,k=this._cycle,S=this._rawPrevTime,R=this._time;if(this._totalTime=w*m,this._cycle<w?b=!b:this._totalTime+=m,this._time=d,this._rawPrevTime=0===m?T-1e-4:T,this._cycle=w,this._locked=!0,d=b?0:m,this.render(d,e,0===m),e||this._gc||this.vars.onRepeat&&this._callback("onRepeat"),d!==this._time)return;if(P&&(d=b?m+1e-4:-1e-4,this.render(d,!0,!1)),this._locked=!1,this._paused&&!x)return;this._time=R,this._totalTime=O,this._cycle=k,this._rawPrevTime=S}if(!(this._time!==d&&this._first||i||_||f))return void(g!==this._totalTime&&this._onUpdate&&(e||this._callback("onUpdate")));if(this._initted||(this._initted=!0),this._active||!this._paused&&this._totalTime!==g&&t>0&&(this._active=!0),0===g&&this.vars.onStart&&(0===this._totalTime&&this._totalDuration||e||this._callback("onStart")),c=this._time,c>=d)for(s=this._first;s&&(l=s._next,c===this._time&&(!this._paused||x));)(s._active||s._startTime<=this._time&&!s._paused&&!s._gc)&&(f===s&&this.pause(),s._reversed?s.render((s._dirty?s.totalDuration():s._totalDuration)-(t-s._startTime)*s._timeScale,e,i):s.render((t-s._startTime)*s._timeScale,e,i)),s=l;else for(s=this._last;s&&(l=s._prev,c===this._time&&(!this._paused||x));){if(s._active||s._startTime<=d&&!s._paused&&!s._gc){if(f===s){for(f=s._prev;f&&f.endTime()>this._time;)f.render(f._reversed?f.totalDuration()-(t-f._startTime)*f._timeScale:(t-f._startTime)*f._timeScale,e,i),f=f._prev;f=null,this.pause()}s._reversed?s.render((s._dirty?s.totalDuration():s._totalDuration)-(t-s._startTime)*s._timeScale,e,i):s.render((t-s._startTime)*s._timeScale,e,i)}s=l}this._onUpdate&&(e||(a.length&&o(),this._callback("onUpdate"))),h&&(this._locked||this._gc||(v===this._startTime||y!==this._timeScale)&&(0===this._time||p>=this.totalDuration())&&(n&&(a.length&&o(),this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!e&&this.vars[h]&&this._callback(h)))},_.getActive=function(t,e,i){null==t&&(t=!0),null==e&&(e=!0),null==i&&(i=!1);var s,r,n=[],a=this.getChildren(t,e,i),o=0,l=a.length;for(s=0;l>s;s++)r=a[s],r.isActive()&&(n[o++]=r);return n},_.getLabelAfter=function(t){t||0!==t&&(t=this._time);var e,i=this.getLabelsArray(),s=i.length;for(e=0;s>e;e++)if(i[e].time>t)return i[e].name;return null},_.getLabelBefore=function(t){null==t&&(t=this._time);for(var e=this.getLabelsArray(),i=e.length;--i>-1;)if(e[i].time<t)return e[i].name;return null},_.getLabelsArray=function(){var t,e=[],i=0;for(t in this._labels)e[i++]={time:this._labels[t],name:t};return e.sort(function(t,e){return t.time-e.time}),e},_.progress=function(t,e){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&0!==(1&this._cycle)?1-t:t)+this._cycle*(this._duration+this._repeatDelay),e):this._time/this.duration()},_.totalProgress=function(t,e){return arguments.length?this.totalTime(this.totalDuration()*t,e):this._totalTime/this.totalDuration()},_.totalDuration=function(e){return arguments.length?-1!==this._repeat&&e?this.timeScale(this.totalDuration()/e):this:(this._dirty&&(t.prototype.totalDuration.call(this),this._totalDuration=-1===this._repeat?999999999999:this._duration*(this._repeat+1)+this._repeatDelay*this._repeat),this._totalDuration)},_.time=function(t,e){return arguments.length?(this._dirty&&this.totalDuration(),t>this._duration&&(t=this._duration),this._yoyo&&0!==(1&this._cycle)?t=this._duration-t+this._cycle*(this._duration+this._repeatDelay):0!==this._repeat&&(t+=this._cycle*(this._duration+this._repeatDelay)),this.totalTime(t,e)):this._time},_.repeat=function(t){return arguments.length?(this._repeat=t,this._uncache(!0)):this._repeat},_.repeatDelay=function(t){return arguments.length?(this._repeatDelay=t,this._uncache(!0)):this._repeatDelay},_.yoyo=function(t){return arguments.length?(this._yoyo=t,this):this._yoyo},_.currentLabel=function(t){return arguments.length?this.seek(t,!0):this.getLabelBefore(this._time+1e-8)},s},!0),function(){var t=180/Math.PI,e=[],i=[],s=[],r={},n=_gsScope._gsDefine.globals,a=function(t,e,i,s){i===s&&(i=s-(s-e)/1e6),t===e&&(e=t+(i-t)/1e6),this.a=t,this.b=e,this.c=i,this.d=s,this.da=s-t,this.ca=i-t,this.ba=e-t},o=",x,y,z,left,top,right,bottom,marginTop,marginLeft,marginRight,marginBottom,paddingLeft,paddingTop,paddingRight,paddingBottom,backgroundPosition,backgroundPosition_y,",l=function(t,e,i,s){var r={a:t},n={},a={},o={c:s},l=(t+e)/2,h=(e+i)/2,_=(i+s)/2,u=(l+h)/2,f=(h+_)/2,c=(f-u)/8;return r.b=l+(t-l)/4,n.b=u+c,r.c=n.a=(r.b+n.b)/2,n.c=a.a=(u+f)/2,a.b=f-c,o.b=_+(s-_)/4,a.c=o.a=(a.b+o.b)/2,[r,n,a,o]},h=function(t,r,n,a,o){var h,_,u,f,c,p,m,d,g,v,y,T,x,w=t.length-1,b=0,P=t[0].a;for(h=0;w>h;h++)c=t[b],_=c.a,u=c.d,f=t[b+1].d,o?(y=e[h],T=i[h],x=(T+y)*r*.25/(a?.5:s[h]||.5),p=u-(u-_)*(a?.5*r:0!==y?x/y:0),m=u+(f-u)*(a?.5*r:0!==T?x/T:0),d=u-(p+((m-p)*(3*y/(y+T)+.5)/4||0))):(p=u-(u-_)*r*.5,m=u+(f-u)*r*.5,d=u-(p+m)/2),p+=d,m+=d,c.c=g=p,c.b=0!==h?P:P=c.a+.6*(c.c-c.a),c.da=u-_,c.ca=g-_,c.ba=P-_,n?(v=l(_,P,g,u),t.splice(b,1,v[0],v[1],v[2],v[3]),b+=4):b++,P=m;c=t[b],c.b=P,c.c=P+.4*(c.d-P),c.da=c.d-c.a,c.ca=c.c-c.a,c.ba=P-c.a,n&&(v=l(c.a,P,c.c,c.d),t.splice(b,1,v[0],v[1],v[2],v[3]))},_=function(t,s,r,n){var o,l,h,_,u,f,c=[];if(n)for(t=[n].concat(t),l=t.length;--l>-1;)"string"==typeof(f=t[l][s])&&"="===f.charAt(1)&&(t[l][s]=n[s]+Number(f.charAt(0)+f.substr(2)));if(o=t.length-2,0>o)return c[0]=new a(t[0][s],0,0,t[-1>o?0:1][s]),c;for(l=0;o>l;l++)h=t[l][s],_=t[l+1][s],c[l]=new a(h,0,0,_),r&&(u=t[l+2][s],e[l]=(e[l]||0)+(_-h)*(_-h),i[l]=(i[l]||0)+(u-_)*(u-_));return c[l]=new a(t[l][s],0,0,t[l+1][s]),c},u=function(t,n,a,l,u,f){var c,p,m,d,g,v,y,T,x={},w=[],b=f||t[0];u="string"==typeof u?","+u+",":o,null==n&&(n=1);for(p in t[0])w.push(p);if(t.length>1){for(T=t[t.length-1],y=!0,c=w.length;--c>-1;)if(p=w[c],Math.abs(b[p]-T[p])>.05){y=!1;break}y&&(t=t.concat(),f&&t.unshift(f),t.push(t[1]),f=t[t.length-3])}for(e.length=i.length=s.length=0,c=w.length;--c>-1;)p=w[c],r[p]=-1!==u.indexOf(","+p+","),x[p]=_(t,p,r[p],f);for(c=e.length;--c>-1;)e[c]=Math.sqrt(e[c]),i[c]=Math.sqrt(i[c]);if(!l){for(c=w.length;--c>-1;)if(r[p])for(m=x[w[c]],v=m.length-1,d=0;v>d;d++)g=m[d+1].da/i[d]+m[d].da/e[d]||0,s[d]=(s[d]||0)+g*g;for(c=s.length;--c>-1;)s[c]=Math.sqrt(s[c])}for(c=w.length,d=a?4:1;--c>-1;)p=w[c],m=x[p],h(m,n,a,l,r[p]),y&&(m.splice(0,d),m.splice(m.length-d,d));return x},f=function(t,e,i){e=e||"soft";var s,r,n,o,l,h,_,u,f,c,p,m={},d="cubic"===e?3:2,g="soft"===e,v=[];if(g&&i&&(t=[i].concat(t)),null==t||t.length<d+1)throw"invalid Bezier data";for(f in t[0])v.push(f);for(h=v.length;--h>-1;){for(f=v[h],m[f]=l=[],c=0,u=t.length,_=0;u>_;_++)s=null==i?t[_][f]:"string"==typeof(p=t[_][f])&&"="===p.charAt(1)?i[f]+Number(p.charAt(0)+p.substr(2)):Number(p),g&&_>1&&u-1>_&&(l[c++]=(s+l[c-2])/2),l[c++]=s;for(u=c-d+1,c=0,_=0;u>_;_+=d)s=l[_],r=l[_+1],n=l[_+2],o=2===d?0:l[_+3],l[c++]=p=3===d?new a(s,r,n,o):new a(s,(2*r+s)/3,(2*r+n)/3,n);l.length=c}return m},c=function(t,e,i){for(var s,r,n,a,o,l,h,_,u,f,c,p=1/i,m=t.length;--m>-1;)for(f=t[m],n=f.a,a=f.d-n,o=f.c-n,l=f.b-n,s=r=0,_=1;i>=_;_++)h=p*_,u=1-h,s=r-(r=(h*h*a+3*u*(h*o+u*l))*h),c=m*i+_-1,e[c]=(e[c]||0)+s*s},p=function(t,e){e=e>>0||6;var i,s,r,n,a=[],o=[],l=0,h=0,_=e-1,u=[],f=[];for(i in t)c(t[i],a,e);for(r=a.length,s=0;r>s;s++)l+=Math.sqrt(a[s]),n=s%e,f[n]=l,n===_&&(h+=l,n=s/e>>0,u[n]=f,o[n]=h,l=0,f=[]);return{length:h,lengths:o,segments:u}},m=_gsScope._gsDefine.plugin({propName:"bezier",priority:-1,version:"1.3.7",API:2,global:!0,init:function(t,e,i){this._target=t,e instanceof Array&&(e={values:e}),this._func={},this._mod={},this._props=[],this._timeRes=null==e.timeResolution?6:parseInt(e.timeResolution,10);
var s,r,n,a,o,l=e.values||[],h={},_=l[0],c=e.autoRotate||i.vars.orientToBezier;this._autoRotate=c?c instanceof Array?c:[["x","y","rotation",c===!0?0:Number(c)||0]]:null;for(s in _)this._props.push(s);for(n=this._props.length;--n>-1;)s=this._props[n],this._overwriteProps.push(s),r=this._func[s]="function"==typeof t[s],h[s]=r?t[s.indexOf("set")||"function"!=typeof t["get"+s.substr(3)]?s:"get"+s.substr(3)]():parseFloat(t[s]),o||h[s]!==l[0][s]&&(o=h);if(this._beziers="cubic"!==e.type&&"quadratic"!==e.type&&"soft"!==e.type?u(l,isNaN(e.curviness)?1:e.curviness,!1,"thruBasic"===e.type,e.correlate,o):f(l,e.type,h),this._segCount=this._beziers[s].length,this._timeRes){var m=p(this._beziers,this._timeRes);this._length=m.length,this._lengths=m.lengths,this._segments=m.segments,this._l1=this._li=this._s1=this._si=0,this._l2=this._lengths[0],this._curSeg=this._segments[0],this._s2=this._curSeg[0],this._prec=1/this._curSeg.length}if(c=this._autoRotate)for(this._initialRotations=[],c[0]instanceof Array||(this._autoRotate=c=[c]),n=c.length;--n>-1;){for(a=0;3>a;a++)s=c[n][a],this._func[s]="function"==typeof t[s]?t[s.indexOf("set")||"function"!=typeof t["get"+s.substr(3)]?s:"get"+s.substr(3)]:!1;s=c[n][2],this._initialRotations[n]=(this._func[s]?this._func[s].call(this._target):this._target[s])||0,this._overwriteProps.push(s)}return this._startRatio=i.vars.runBackwards?1:0,!0},set:function(e){var i,s,r,n,a,o,l,h,_,u,f=this._segCount,c=this._func,p=this._target,m=e!==this._startRatio;if(this._timeRes){if(_=this._lengths,u=this._curSeg,e*=this._length,r=this._li,e>this._l2&&f-1>r){for(h=f-1;h>r&&(this._l2=_[++r])<=e;);this._l1=_[r-1],this._li=r,this._curSeg=u=this._segments[r],this._s2=u[this._s1=this._si=0]}else if(e<this._l1&&r>0){for(;r>0&&(this._l1=_[--r])>=e;);0===r&&e<this._l1?this._l1=0:r++,this._l2=_[r],this._li=r,this._curSeg=u=this._segments[r],this._s1=u[(this._si=u.length-1)-1]||0,this._s2=u[this._si]}if(i=r,e-=this._l1,r=this._si,e>this._s2&&r<u.length-1){for(h=u.length-1;h>r&&(this._s2=u[++r])<=e;);this._s1=u[r-1],this._si=r}else if(e<this._s1&&r>0){for(;r>0&&(this._s1=u[--r])>=e;);0===r&&e<this._s1?this._s1=0:r++,this._s2=u[r],this._si=r}o=(r+(e-this._s1)/(this._s2-this._s1))*this._prec||0}else i=0>e?0:e>=1?f-1:f*e>>0,o=(e-i*(1/f))*f;for(s=1-o,r=this._props.length;--r>-1;)n=this._props[r],a=this._beziers[n][i],l=(o*o*a.da+3*s*(o*a.ca+s*a.ba))*o+a.a,this._mod[n]&&(l=this._mod[n](l,p)),c[n]?p[n](l):p[n]=l;if(this._autoRotate){var d,g,v,y,T,x,w,b=this._autoRotate;for(r=b.length;--r>-1;)n=b[r][2],x=b[r][3]||0,w=b[r][4]===!0?1:t,a=this._beziers[b[r][0]],d=this._beziers[b[r][1]],a&&d&&(a=a[i],d=d[i],g=a.a+(a.b-a.a)*o,y=a.b+(a.c-a.b)*o,g+=(y-g)*o,y+=(a.c+(a.d-a.c)*o-y)*o,v=d.a+(d.b-d.a)*o,T=d.b+(d.c-d.b)*o,v+=(T-v)*o,T+=(d.c+(d.d-d.c)*o-T)*o,l=m?Math.atan2(T-v,y-g)*w+x:this._initialRotations[r],this._mod[n]&&(l=this._mod[n](l,p)),c[n]?p[n](l):p[n]=l)}}}),d=m.prototype;m.bezierThrough=u,m.cubicToQuadratic=l,m._autoCSS=!0,m.quadraticToCubic=function(t,e,i){return new a(t,(2*e+t)/3,(2*e+i)/3,i)},m._cssRegister=function(){var t=n.CSSPlugin;if(t){var e=t._internals,i=e._parseToProxy,s=e._setPluginRatio,r=e.CSSPropTween;e._registerComplexSpecialProp("bezier",{parser:function(t,e,n,a,o,l){e instanceof Array&&(e={values:e}),l=new m;var h,_,u,f=e.values,c=f.length-1,p=[],d={};if(0>c)return o;for(h=0;c>=h;h++)u=i(t,f[h],a,o,l,c!==h),p[h]=u.end;for(_ in e)d[_]=e[_];return d.values=p,o=new r(t,"bezier",0,0,u.pt,2),o.data=u,o.plugin=l,o.setRatio=s,0===d.autoRotate&&(d.autoRotate=!0),!d.autoRotate||d.autoRotate instanceof Array||(h=d.autoRotate===!0?0:Number(d.autoRotate),d.autoRotate=null!=u.end.left?[["left","top","rotation",h,!1]]:null!=u.end.x?[["x","y","rotation",h,!1]]:!1),d.autoRotate&&(a._transform||a._enableTransforms(!1),u.autoRotate=a._target._gsTransform,u.proxy.rotation=u.autoRotate.rotation||0,a._overwriteProps.push("rotation")),l._onInitTween(u.proxy,d,a._tween),o}})}},d._mod=function(t){for(var e,i=this._overwriteProps,s=i.length;--s>-1;)e=t[i[s]],e&&"function"==typeof e&&(this._mod[i[s]]=e)},d._kill=function(t){var e,i,s=this._props;for(e in this._beziers)if(e in t)for(delete this._beziers[e],delete this._func[e],i=s.length;--i>-1;)s[i]===e&&s.splice(i,1);if(s=this._autoRotate)for(i=s.length;--i>-1;)t[s[i][2]]&&s.splice(i,1);return this._super._kill.call(this,t)}}(),_gsScope._gsDefine("plugins.CSSPlugin",["plugins.TweenPlugin","TweenLite"],function(t,e){var i,s,r,n,a=function(){t.call(this,"css"),this._overwriteProps.length=0,this.setRatio=a.prototype.setRatio},o=_gsScope._gsDefine.globals,l={},h=a.prototype=new t("css");h.constructor=a,a.version="1.19.0",a.API=2,a.defaultTransformPerspective=0,a.defaultSkewType="compensated",a.defaultSmoothOrigin=!0,h="px",a.suffixMap={top:h,right:h,bottom:h,left:h,width:h,height:h,fontSize:h,padding:h,margin:h,perspective:h,lineHeight:""};var _,u,f,c,p,m,d,g,v=/(?:\-|\.|\b)(\d|\.|e\-)+/g,y=/(?:\d|\-\d|\.\d|\-\.\d|\+=\d|\-=\d|\+=.\d|\-=\.\d)+/g,T=/(?:\+=|\-=|\-|\b)[\d\-\.]+[a-zA-Z0-9]*(?:%|\b)/gi,x=/(?![+-]?\d*\.?\d+|[+-]|e[+-]\d+)[^0-9]/g,w=/(?:\d|\-|\+|=|#|\.)*/g,b=/opacity *= *([^)]*)/i,P=/opacity:([^;]*)/i,O=/alpha\(opacity *=.+?\)/i,k=/^(rgb|hsl)/,S=/([A-Z])/g,R=/-([a-z])/gi,A=/(^(?:url\(\"|url\())|(?:(\"\))$|\)$)/gi,C=function(t,e){return e.toUpperCase()},D=/(?:Left|Right|Width)/i,M=/(M11|M12|M21|M22)=[\d\-\.e]+/gi,F=/progid\:DXImageTransform\.Microsoft\.Matrix\(.+?\)/i,z=/,(?=[^\)]*(?:\(|$))/gi,X=/[\s,\(]/i,I=Math.PI/180,N=180/Math.PI,L={},E=document,Y=function(t){return E.createElementNS?E.createElementNS("http://www.w3.org/1999/xhtml",t):E.createElement(t)},B=Y("div"),j=Y("img"),U=a._internals={_specialProps:l},V=navigator.userAgent,q=function(){var t=V.indexOf("Android"),e=Y("a");return f=-1!==V.indexOf("Safari")&&-1===V.indexOf("Chrome")&&(-1===t||Number(V.substr(t+8,1))>3),p=f&&Number(V.substr(V.indexOf("Version/")+8,1))<6,c=-1!==V.indexOf("Firefox"),(/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(V)||/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(V))&&(m=parseFloat(RegExp.$1)),e?(e.style.cssText="top:1px;opacity:.55;",/^0.55/.test(e.style.opacity)):!1}(),W=function(t){return b.test("string"==typeof t?t:(t.currentStyle?t.currentStyle.filter:t.style.filter)||"")?parseFloat(RegExp.$1)/100:1},Z=function(t){window.console&&console.log(t)},G="",$="",Q=function(t,e){e=e||B;var i,s,r=e.style;if(void 0!==r[t])return t;for(t=t.charAt(0).toUpperCase()+t.substr(1),i=["O","Moz","ms","Ms","Webkit"],s=5;--s>-1&&void 0===r[i[s]+t];);return s>=0?($=3===s?"ms":i[s],G="-"+$.toLowerCase()+"-",$+t):null},H=E.defaultView?E.defaultView.getComputedStyle:function(){},K=a.getStyle=function(t,e,i,s,r){var n;return q||"opacity"!==e?(!s&&t.style[e]?n=t.style[e]:(i=i||H(t))?n=i[e]||i.getPropertyValue(e)||i.getPropertyValue(e.replace(S,"-$1").toLowerCase()):t.currentStyle&&(n=t.currentStyle[e]),null==r||n&&"none"!==n&&"auto"!==n&&"auto auto"!==n?n:r):W(t)},J=U.convertToPixels=function(t,i,s,r,n){if("px"===r||!r)return s;if("auto"===r||!s)return 0;var o,l,h,_=D.test(i),u=t,f=B.style,c=0>s,p=1===s;if(c&&(s=-s),p&&(s*=100),"%"===r&&-1!==i.indexOf("border"))o=s/100*(_?t.clientWidth:t.clientHeight);else{if(f.cssText="border:0 solid red;position:"+K(t,"position")+";line-height:0;","%"!==r&&u.appendChild&&"v"!==r.charAt(0)&&"rem"!==r)f[_?"borderLeftWidth":"borderTopWidth"]=s+r;else{if(u=t.parentNode||E.body,l=u._gsCache,h=e.ticker.frame,l&&_&&l.time===h)return l.width*s/100;f[_?"width":"height"]=s+r}u.appendChild(B),o=parseFloat(B[_?"offsetWidth":"offsetHeight"]),u.removeChild(B),_&&"%"===r&&a.cacheWidths!==!1&&(l=u._gsCache=u._gsCache||{},l.time=h,l.width=o/s*100),0!==o||n||(o=J(t,i,s,r,!0))}return p&&(o/=100),c?-o:o},te=U.calculateOffset=function(t,e,i){if("absolute"!==K(t,"position",i))return 0;var s="left"===e?"Left":"Top",r=K(t,"margin"+s,i);return t["offset"+s]-(J(t,e,parseFloat(r),r.replace(w,""))||0)},ee=function(t,e){var i,s,r,n={};if(e=e||H(t,null))if(i=e.length)for(;--i>-1;)r=e[i],(-1===r.indexOf("-transform")||Re===r)&&(n[r.replace(R,C)]=e.getPropertyValue(r));else for(i in e)(-1===i.indexOf("Transform")||Se===i)&&(n[i]=e[i]);else if(e=t.currentStyle||t.style)for(i in e)"string"==typeof i&&void 0===n[i]&&(n[i.replace(R,C)]=e[i]);return q||(n.opacity=W(t)),s=Be(t,e,!1),n.rotation=s.rotation,n.skewX=s.skewX,n.scaleX=s.scaleX,n.scaleY=s.scaleY,n.x=s.x,n.y=s.y,Ce&&(n.z=s.z,n.rotationX=s.rotationX,n.rotationY=s.rotationY,n.scaleZ=s.scaleZ),n.filters&&delete n.filters,n},ie=function(t,e,i,s,r){var n,a,o,l={},h=t.style;for(a in i)"cssText"!==a&&"length"!==a&&isNaN(a)&&(e[a]!==(n=i[a])||r&&r[a])&&-1===a.indexOf("Origin")&&("number"==typeof n||"string"==typeof n)&&(l[a]="auto"!==n||"left"!==a&&"top"!==a?""!==n&&"auto"!==n&&"none"!==n||"string"!=typeof e[a]||""===e[a].replace(x,"")?n:0:te(t,a),void 0!==h[a]&&(o=new ge(h,a,h[a],o)));if(s)for(a in s)"className"!==a&&(l[a]=s[a]);return{difs:l,firstMPT:o}},se={width:["Left","Right"],height:["Top","Bottom"]},re=["marginLeft","marginRight","marginTop","marginBottom"],ne=function(t,e,i){if("svg"===(t.nodeName+"").toLowerCase())return(i||H(t))[e]||0;if(t.getBBox&&Le(t))return t.getBBox()[e]||0;var s=parseFloat("width"===e?t.offsetWidth:t.offsetHeight),r=se[e],n=r.length;for(i=i||H(t,null);--n>-1;)s-=parseFloat(K(t,"padding"+r[n],i,!0))||0,s-=parseFloat(K(t,"border"+r[n]+"Width",i,!0))||0;return s},ae=function(t,e){if("contain"===t||"auto"===t||"auto auto"===t)return t+" ";(null==t||""===t)&&(t="0 0");var i,s=t.split(" "),r=-1!==t.indexOf("left")?"0%":-1!==t.indexOf("right")?"100%":s[0],n=-1!==t.indexOf("top")?"0%":-1!==t.indexOf("bottom")?"100%":s[1];if(s.length>3&&!e){for(s=t.split(", ").join(",").split(","),t=[],i=0;i<s.length;i++)t.push(ae(s[i]));return t.join(",")}return null==n?n="center"===r?"50%":"0":"center"===n&&(n="50%"),("center"===r||isNaN(parseFloat(r))&&-1===(r+"").indexOf("="))&&(r="50%"),t=r+" "+n+(s.length>2?" "+s[2]:""),e&&(e.oxp=-1!==r.indexOf("%"),e.oyp=-1!==n.indexOf("%"),e.oxr="="===r.charAt(1),e.oyr="="===n.charAt(1),e.ox=parseFloat(r.replace(x,"")),e.oy=parseFloat(n.replace(x,"")),e.v=t),e||t},oe=function(t,e){return"function"==typeof t&&(t=t(g,d)),"string"==typeof t&&"="===t.charAt(1)?parseInt(t.charAt(0)+"1",10)*parseFloat(t.substr(2)):parseFloat(t)-parseFloat(e)||0},le=function(t,e){return"function"==typeof t&&(t=t(g,d)),null==t?e:"string"==typeof t&&"="===t.charAt(1)?parseInt(t.charAt(0)+"1",10)*parseFloat(t.substr(2))+e:parseFloat(t)||0},he=function(t,e,i,s){var r,n,a,o,l,h=1e-6;return"function"==typeof t&&(t=t(g,d)),null==t?o=e:"number"==typeof t?o=t:(r=360,n=t.split("_"),l="="===t.charAt(1),a=(l?parseInt(t.charAt(0)+"1",10)*parseFloat(n[0].substr(2)):parseFloat(n[0]))*(-1===t.indexOf("rad")?1:N)-(l?0:e),n.length&&(s&&(s[i]=e+a),-1!==t.indexOf("short")&&(a%=r,a!==a%(r/2)&&(a=0>a?a+r:a-r)),-1!==t.indexOf("_cw")&&0>a?a=(a+9999999999*r)%r-(a/r|0)*r:-1!==t.indexOf("ccw")&&a>0&&(a=(a-9999999999*r)%r-(a/r|0)*r)),o=e+a),h>o&&o>-h&&(o=0),o},_e={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},ue=function(t,e,i){return t=0>t?t+1:t>1?t-1:t,255*(1>6*t?e+(i-e)*t*6:.5>t?i:2>3*t?e+(i-e)*(2/3-t)*6:e)+.5|0},fe=a.parseColor=function(t,e){var i,s,r,n,a,o,l,h,_,u,f;if(t)if("number"==typeof t)i=[t>>16,t>>8&255,255&t];else{if(","===t.charAt(t.length-1)&&(t=t.substr(0,t.length-1)),_e[t])i=_e[t];else if("#"===t.charAt(0))4===t.length&&(s=t.charAt(1),r=t.charAt(2),n=t.charAt(3),t="#"+s+s+r+r+n+n),t=parseInt(t.substr(1),16),i=[t>>16,t>>8&255,255&t];else if("hsl"===t.substr(0,3))if(i=f=t.match(v),e){if(-1!==t.indexOf("="))return t.match(y)}else a=Number(i[0])%360/360,o=Number(i[1])/100,l=Number(i[2])/100,r=.5>=l?l*(o+1):l+o-l*o,s=2*l-r,i.length>3&&(i[3]=Number(t[3])),i[0]=ue(a+1/3,s,r),i[1]=ue(a,s,r),i[2]=ue(a-1/3,s,r);else i=t.match(v)||_e.transparent;i[0]=Number(i[0]),i[1]=Number(i[1]),i[2]=Number(i[2]),i.length>3&&(i[3]=Number(i[3]))}else i=_e.black;return e&&!f&&(s=i[0]/255,r=i[1]/255,n=i[2]/255,h=Math.max(s,r,n),_=Math.min(s,r,n),l=(h+_)/2,h===_?a=o=0:(u=h-_,o=l>.5?u/(2-h-_):u/(h+_),a=h===s?(r-n)/u+(n>r?6:0):h===r?(n-s)/u+2:(s-r)/u+4,a*=60),i[0]=a+.5|0,i[1]=100*o+.5|0,i[2]=100*l+.5|0),i},ce=function(t,e){var i,s,r,n=t.match(pe)||[],a=0,o=n.length?"":t;for(i=0;i<n.length;i++)s=n[i],r=t.substr(a,t.indexOf(s,a)-a),a+=r.length+s.length,s=fe(s,e),3===s.length&&s.push(1),o+=r+(e?"hsla("+s[0]+","+s[1]+"%,"+s[2]+"%,"+s[3]:"rgba("+s.join(","))+")";return o+t.substr(a)},pe="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3}){1,2}\\b";for(h in _e)pe+="|"+h+"\\b";pe=new RegExp(pe+")","gi"),a.colorStringFilter=function(t){var e,i=t[0]+t[1];pe.test(i)&&(e=-1!==i.indexOf("hsl(")||-1!==i.indexOf("hsla("),t[0]=ce(t[0],e),t[1]=ce(t[1],e)),pe.lastIndex=0},e.defaultStringFilter||(e.defaultStringFilter=a.colorStringFilter);var me=function(t,e,i,s){if(null==t)return function(t){return t};var r,n=e?(t.match(pe)||[""])[0]:"",a=t.split(n).join("").match(T)||[],o=t.substr(0,t.indexOf(a[0])),l=")"===t.charAt(t.length-1)?")":"",h=-1!==t.indexOf(" ")?" ":",",_=a.length,u=_>0?a[0].replace(v,""):"";return _?r=e?function(t){var e,f,c,p;if("number"==typeof t)t+=u;else if(s&&z.test(t)){for(p=t.replace(z,"|").split("|"),c=0;c<p.length;c++)p[c]=r(p[c]);return p.join(",")}if(e=(t.match(pe)||[n])[0],f=t.split(e).join("").match(T)||[],c=f.length,_>c--)for(;++c<_;)f[c]=i?f[(c-1)/2|0]:a[c];return o+f.join(h)+h+e+l+(-1!==t.indexOf("inset")?" inset":"")}:function(t){var e,n,f;if("number"==typeof t)t+=u;else if(s&&z.test(t)){for(n=t.replace(z,"|").split("|"),f=0;f<n.length;f++)n[f]=r(n[f]);return n.join(",")}if(e=t.match(T)||[],f=e.length,_>f--)for(;++f<_;)e[f]=i?e[(f-1)/2|0]:a[f];return o+e.join(h)+l}:function(t){return t}},de=function(t){return t=t.split(","),function(e,i,s,r,n,a,o){var l,h=(i+"").split(" ");for(o={},l=0;4>l;l++)o[t[l]]=h[l]=h[l]||h[(l-1)/2>>0];return r.parse(e,o,n,a)}},ge=(U._setPluginRatio=function(t){this.plugin.setRatio(t);for(var e,i,s,r,n,a=this.data,o=a.proxy,l=a.firstMPT,h=1e-6;l;)e=o[l.v],l.r?e=Math.round(e):h>e&&e>-h&&(e=0),l.t[l.p]=e,l=l._next;if(a.autoRotate&&(a.autoRotate.rotation=a.mod?a.mod(o.rotation,this.t):o.rotation),1===t||0===t)for(l=a.firstMPT,n=1===t?"e":"b";l;){if(i=l.t,i.type){if(1===i.type){for(r=i.xs0+i.s+i.xs1,s=1;s<i.l;s++)r+=i["xn"+s]+i["xs"+(s+1)];i[n]=r}}else i[n]=i.s+i.xs0;l=l._next}},function(t,e,i,s,r){this.t=t,this.p=e,this.v=i,this.r=r,s&&(s._prev=this,this._next=s)}),ve=(U._parseToProxy=function(t,e,i,s,r,n){var a,o,l,h,_,u=s,f={},c={},p=i._transform,m=L;for(i._transform=null,L=e,s=_=i.parse(t,e,s,r),L=m,n&&(i._transform=p,u&&(u._prev=null,u._prev&&(u._prev._next=null)));s&&s!==u;){if(s.type<=1&&(o=s.p,c[o]=s.s+s.c,f[o]=s.s,n||(h=new ge(s,"s",o,h,s.r),s.c=0),1===s.type))for(a=s.l;--a>0;)l="xn"+a,o=s.p+"_"+l,c[o]=s.data[l],f[o]=s[l],n||(h=new ge(s,l,o,h,s.rxp[l]));s=s._next}return{proxy:f,end:c,firstMPT:h,pt:_}},U.CSSPropTween=function(t,e,s,r,a,o,l,h,_,u,f){this.t=t,this.p=e,this.s=s,this.c=r,this.n=l||e,t instanceof ve||n.push(this.n),this.r=h,this.type=o||0,_&&(this.pr=_,i=!0),this.b=void 0===u?s:u,this.e=void 0===f?s+r:f,a&&(this._next=a,a._prev=this)}),ye=function(t,e,i,s,r,n){var a=new ve(t,e,i,s-i,r,-1,n);return a.b=i,a.e=a.xs0=s,a},Te=a.parseComplex=function(t,e,i,s,r,n,o,l,h,u){i=i||n||"","function"==typeof s&&(s=s(g,d)),o=new ve(t,e,0,0,o,u?2:1,null,!1,l,i,s),s+="",r&&pe.test(s+i)&&(s=[i,s],a.colorStringFilter(s),i=s[0],s=s[1]);var f,c,p,m,T,x,w,b,P,O,k,S,R,A=i.split(", ").join(",").split(" "),C=s.split(", ").join(",").split(" "),D=A.length,M=_!==!1;for((-1!==s.indexOf(",")||-1!==i.indexOf(","))&&(A=A.join(" ").replace(z,", ").split(" "),C=C.join(" ").replace(z,", ").split(" "),D=A.length),D!==C.length&&(A=(n||"").split(" "),D=A.length),o.plugin=h,o.setRatio=u,pe.lastIndex=0,f=0;D>f;f++)if(m=A[f],T=C[f],b=parseFloat(m),b||0===b)o.appendXtra("",b,oe(T,b),T.replace(y,""),M&&-1!==T.indexOf("px"),!0);else if(r&&pe.test(m))S=T.indexOf(")")+1,S=")"+(S?T.substr(S):""),R=-1!==T.indexOf("hsl")&&q,m=fe(m,R),T=fe(T,R),P=m.length+T.length>6,P&&!q&&0===T[3]?(o["xs"+o.l]+=o.l?" transparent":"transparent",o.e=o.e.split(C[f]).join("transparent")):(q||(P=!1),R?o.appendXtra(P?"hsla(":"hsl(",m[0],oe(T[0],m[0]),",",!1,!0).appendXtra("",m[1],oe(T[1],m[1]),"%,",!1).appendXtra("",m[2],oe(T[2],m[2]),P?"%,":"%"+S,!1):o.appendXtra(P?"rgba(":"rgb(",m[0],T[0]-m[0],",",!0,!0).appendXtra("",m[1],T[1]-m[1],",",!0).appendXtra("",m[2],T[2]-m[2],P?",":S,!0),P&&(m=m.length<4?1:m[3],o.appendXtra("",m,(T.length<4?1:T[3])-m,S,!1))),pe.lastIndex=0;else if(x=m.match(v)){if(w=T.match(y),!w||w.length!==x.length)return o;for(p=0,c=0;c<x.length;c++)k=x[c],O=m.indexOf(k,p),o.appendXtra(m.substr(p,O-p),Number(k),oe(w[c],k),"",M&&"px"===m.substr(O+k.length,2),0===c),p=O+k.length;o["xs"+o.l]+=m.substr(p)}else o["xs"+o.l]+=o.l||o["xs"+o.l]?" "+T:T;if(-1!==s.indexOf("=")&&o.data){for(S=o.xs0+o.data.s,f=1;f<o.l;f++)S+=o["xs"+f]+o.data["xn"+f];o.e=S+o["xs"+f]}return o.l||(o.type=-1,o.xs0=o.e),o.xfirst||o},xe=9;for(h=ve.prototype,h.l=h.pr=0;--xe>0;)h["xn"+xe]=0,h["xs"+xe]="";h.xs0="",h._next=h._prev=h.xfirst=h.data=h.plugin=h.setRatio=h.rxp=null,h.appendXtra=function(t,e,i,s,r,n){var a=this,o=a.l;return a["xs"+o]+=n&&(o||a["xs"+o])?" "+t:t||"",i||0===o||a.plugin?(a.l++,a.type=a.setRatio?2:1,a["xs"+a.l]=s||"",o>0?(a.data["xn"+o]=e+i,a.rxp["xn"+o]=r,a["xn"+o]=e,a.plugin||(a.xfirst=new ve(a,"xn"+o,e,i,a.xfirst||a,0,a.n,r,a.pr),a.xfirst.xs0=0),a):(a.data={s:e+i},a.rxp={},a.s=e,a.c=i,a.r=r,a)):(a["xs"+o]+=e+(s||""),a)};var we=function(t,e){e=e||{},this.p=e.prefix?Q(t)||t:t,l[t]=l[this.p]=this,this.format=e.formatter||me(e.defaultValue,e.color,e.collapsible,e.multi),e.parser&&(this.parse=e.parser),this.clrs=e.color,this.multi=e.multi,this.keyword=e.keyword,this.dflt=e.defaultValue,this.pr=e.priority||0},be=U._registerComplexSpecialProp=function(t,e,i){"object"!=typeof e&&(e={parser:i});var s,r,n=t.split(","),a=e.defaultValue;for(i=i||[a],s=0;s<n.length;s++)e.prefix=0===s&&e.prefix,e.defaultValue=i[s]||a,r=new we(n[s],e)},Pe=U._registerPluginProp=function(t){if(!l[t]){var e=t.charAt(0).toUpperCase()+t.substr(1)+"Plugin";be(t,{parser:function(t,i,s,r,n,a,h){var _=o.com.greensock.plugins[e];return _?(_._cssRegister(),l[s].parse(t,i,s,r,n,a,h)):(Z("Error: "+e+" js file not loaded."),n)}})}};h=we.prototype,h.parseComplex=function(t,e,i,s,r,n){var a,o,l,h,_,u,f=this.keyword;if(this.multi&&(z.test(i)||z.test(e)?(o=e.replace(z,"|").split("|"),l=i.replace(z,"|").split("|")):f&&(o=[e],l=[i])),l){for(h=l.length>o.length?l.length:o.length,a=0;h>a;a++)e=o[a]=o[a]||this.dflt,i=l[a]=l[a]||this.dflt,f&&(_=e.indexOf(f),u=i.indexOf(f),_!==u&&(-1===u?o[a]=o[a].split(f).join(""):-1===_&&(o[a]+=" "+f)));e=o.join(", "),i=l.join(", ")}return Te(t,this.p,e,i,this.clrs,this.dflt,s,this.pr,r,n)},h.parse=function(t,e,i,s,n,a){return this.parseComplex(t.style,this.format(K(t,this.p,r,!1,this.dflt)),this.format(e),n,a)},a.registerSpecialProp=function(t,e,i){be(t,{parser:function(t,s,r,n,a,o){var l=new ve(t,r,0,0,a,2,r,!1,i);return l.plugin=o,l.setRatio=e(t,s,n._tween,r),l},priority:i})},a.useSVGTransformAttr=f||c;var Oe,ke="scaleX,scaleY,scaleZ,x,y,z,skewX,skewY,rotation,rotationX,rotationY,perspective,xPercent,yPercent".split(","),Se=Q("transform"),Re=G+"transform",Ae=Q("transformOrigin"),Ce=null!==Q("perspective"),De=U.Transform=function(){this.perspective=parseFloat(a.defaultTransformPerspective)||0,this.force3D=a.defaultForce3D!==!1&&Ce?a.defaultForce3D||"auto":!1},Me=window.SVGElement,Fe=function(t,e,i){var s,r=E.createElementNS("http://www.w3.org/2000/svg",t),n=/([a-z])([A-Z])/g;for(s in i)r.setAttributeNS(null,s.replace(n,"$1-$2").toLowerCase(),i[s]);return e.appendChild(r),r},ze=E.documentElement,Xe=function(){var t,e,i,s=m||/Android/i.test(V)&&!window.chrome;return E.createElementNS&&!s&&(t=Fe("svg",ze),e=Fe("rect",t,{width:100,height:50,x:100}),i=e.getBoundingClientRect().width,e.style[Ae]="50% 50%",e.style[Se]="scaleX(0.5)",s=i===e.getBoundingClientRect().width&&!(c&&Ce),ze.removeChild(t)),s}(),Ie=function(t,e,i,s,r,n){var o,l,h,_,u,f,c,p,m,d,g,v,y,T,x=t._gsTransform,w=Ye(t,!0);x&&(y=x.xOrigin,T=x.yOrigin),(!s||(o=s.split(" ")).length<2)&&(c=t.getBBox(),e=ae(e).split(" "),o=[(-1!==e[0].indexOf("%")?parseFloat(e[0])/100*c.width:parseFloat(e[0]))+c.x,(-1!==e[1].indexOf("%")?parseFloat(e[1])/100*c.height:parseFloat(e[1]))+c.y]),i.xOrigin=_=parseFloat(o[0]),i.yOrigin=u=parseFloat(o[1]),s&&w!==Ee&&(f=w[0],c=w[1],p=w[2],m=w[3],d=w[4],g=w[5],v=f*m-c*p,l=_*(m/v)+u*(-p/v)+(p*g-m*d)/v,h=_*(-c/v)+u*(f/v)-(f*g-c*d)/v,_=i.xOrigin=o[0]=l,u=i.yOrigin=o[1]=h),x&&(n&&(i.xOffset=x.xOffset,i.yOffset=x.yOffset,x=i),r||r!==!1&&a.defaultSmoothOrigin!==!1?(l=_-y,h=u-T,x.xOffset+=l*w[0]+h*w[2]-l,x.yOffset+=l*w[1]+h*w[3]-h):x.xOffset=x.yOffset=0),n||t.setAttribute("data-svg-origin",o.join(" "))},Ne=function(t){try{return t.getBBox()}catch(t){}},Le=function(t){return!!(Me&&t.getBBox&&t.getCTM&&Ne(t)&&(!t.parentNode||t.parentNode.getBBox&&t.parentNode.getCTM))},Ee=[1,0,0,1,0,0],Ye=function(t,e){var i,s,r,n,a,o,l=t._gsTransform||new De,h=1e5,_=t.style;if(Se?s=K(t,Re,null,!0):t.currentStyle&&(s=t.currentStyle.filter.match(M),s=s&&4===s.length?[s[0].substr(4),Number(s[2].substr(4)),Number(s[1].substr(4)),s[3].substr(4),l.x||0,l.y||0].join(","):""),i=!s||"none"===s||"matrix(1, 0, 0, 1, 0, 0)"===s,i&&Se&&((o="none"===H(t).display)||!t.parentNode)&&(o&&(n=_.display,_.display="block"),t.parentNode||(a=1,ze.appendChild(t)),s=K(t,Re,null,!0),i=!s||"none"===s||"matrix(1, 0, 0, 1, 0, 0)"===s,n?_.display=n:o&&qe(_,"display"),a&&ze.removeChild(t)),(l.svg||t.getBBox&&Le(t))&&(i&&-1!==(_[Se]+"").indexOf("matrix")&&(s=_[Se],i=0),r=t.getAttribute("transform"),i&&r&&(-1!==r.indexOf("matrix")?(s=r,i=0):-1!==r.indexOf("translate")&&(s="matrix(1,0,0,1,"+r.match(/(?:\-|\b)[\d\-\.e]+\b/gi).join(",")+")",i=0))),i)return Ee;for(r=(s||"").match(v)||[],xe=r.length;--xe>-1;)n=Number(r[xe]),r[xe]=(a=n-(n|=0))?(a*h+(0>a?-.5:.5)|0)/h+n:n;return e&&r.length>6?[r[0],r[1],r[4],r[5],r[12],r[13]]:r},Be=U.getTransform=function(t,i,s,r){if(t._gsTransform&&s&&!r)return t._gsTransform;var n,o,l,h,_,u,f=s?t._gsTransform||new De:new De,c=f.scaleX<0,p=2e-5,m=1e5,d=Ce?parseFloat(K(t,Ae,i,!1,"0 0 0").split(" ")[2])||f.zOrigin||0:0,g=parseFloat(a.defaultTransformPerspective)||0;if(f.svg=!(!t.getBBox||!Le(t)),f.svg&&(Ie(t,K(t,Ae,i,!1,"50% 50%")+"",f,t.getAttribute("data-svg-origin")),Oe=a.useSVGTransformAttr||Xe),n=Ye(t),n!==Ee){if(16===n.length){var v,y,T,x,w,b=n[0],P=n[1],O=n[2],k=n[3],S=n[4],R=n[5],A=n[6],C=n[7],D=n[8],M=n[9],F=n[10],z=n[12],X=n[13],I=n[14],L=n[11],E=Math.atan2(A,F);f.zOrigin&&(I=-f.zOrigin,z=D*I-n[12],X=M*I-n[13],I=F*I+f.zOrigin-n[14]),f.rotationX=E*N,E&&(x=Math.cos(-E),w=Math.sin(-E),v=S*x+D*w,y=R*x+M*w,T=A*x+F*w,D=S*-w+D*x,M=R*-w+M*x,F=A*-w+F*x,L=C*-w+L*x,S=v,R=y,A=T),E=Math.atan2(-O,F),f.rotationY=E*N,E&&(x=Math.cos(-E),w=Math.sin(-E),v=b*x-D*w,y=P*x-M*w,T=O*x-F*w,M=P*w+M*x,F=O*w+F*x,L=k*w+L*x,b=v,P=y,O=T),E=Math.atan2(P,b),f.rotation=E*N,E&&(x=Math.cos(-E),w=Math.sin(-E),b=b*x+S*w,y=P*x+R*w,R=P*-w+R*x,A=O*-w+A*x,P=y),f.rotationX&&Math.abs(f.rotationX)+Math.abs(f.rotation)>359.9&&(f.rotationX=f.rotation=0,f.rotationY=180-f.rotationY),f.scaleX=(Math.sqrt(b*b+P*P)*m+.5|0)/m,f.scaleY=(Math.sqrt(R*R+M*M)*m+.5|0)/m,f.scaleZ=(Math.sqrt(A*A+F*F)*m+.5|0)/m,f.rotationX||f.rotationY?f.skewX=0:(f.skewX=S||R?Math.atan2(S,R)*N+f.rotation:f.skewX||0,Math.abs(f.skewX)>90&&Math.abs(f.skewX)<270&&(c?(f.scaleX*=-1,f.skewX+=f.rotation<=0?180:-180,f.rotation+=f.rotation<=0?180:-180):(f.scaleY*=-1,f.skewX+=f.skewX<=0?180:-180))),f.perspective=L?1/(0>L?-L:L):0,f.x=z,f.y=X,f.z=I,f.svg&&(f.x-=f.xOrigin-(f.xOrigin*b-f.yOrigin*S),f.y-=f.yOrigin-(f.yOrigin*P-f.xOrigin*R))}else if(!Ce||r||!n.length||f.x!==n[4]||f.y!==n[5]||!f.rotationX&&!f.rotationY){var Y=n.length>=6,B=Y?n[0]:1,j=n[1]||0,U=n[2]||0,V=Y?n[3]:1;f.x=n[4]||0,f.y=n[5]||0,l=Math.sqrt(B*B+j*j),h=Math.sqrt(V*V+U*U),_=B||j?Math.atan2(j,B)*N:f.rotation||0,u=U||V?Math.atan2(U,V)*N+_:f.skewX||0,Math.abs(u)>90&&Math.abs(u)<270&&(c?(l*=-1,u+=0>=_?180:-180,_+=0>=_?180:-180):(h*=-1,u+=0>=u?180:-180)),f.scaleX=l,f.scaleY=h,f.rotation=_,f.skewX=u,Ce&&(f.rotationX=f.rotationY=f.z=0,f.perspective=g,f.scaleZ=1),f.svg&&(f.x-=f.xOrigin-(f.xOrigin*B+f.yOrigin*U),f.y-=f.yOrigin-(f.xOrigin*j+f.yOrigin*V))}f.zOrigin=d;for(o in f)f[o]<p&&f[o]>-p&&(f[o]=0)}return s&&(t._gsTransform=f,f.svg&&(Oe&&t.style[Se]?e.delayedCall(.001,function(){qe(t.style,Se)}):!Oe&&t.getAttribute("transform")&&e.delayedCall(.001,function(){t.removeAttribute("transform")}))),f},je=function(t){var e,i,s=this.data,r=-s.rotation*I,n=r+s.skewX*I,a=1e5,o=(Math.cos(r)*s.scaleX*a|0)/a,l=(Math.sin(r)*s.scaleX*a|0)/a,h=(Math.sin(n)*-s.scaleY*a|0)/a,_=(Math.cos(n)*s.scaleY*a|0)/a,u=this.t.style,f=this.t.currentStyle;if(f){i=l,l=-h,h=-i,e=f.filter,u.filter="";var c,p,d=this.t.offsetWidth,g=this.t.offsetHeight,v="absolute"!==f.position,y="progid:DXImageTransform.Microsoft.Matrix(M11="+o+", M12="+l+", M21="+h+", M22="+_,T=s.x+d*s.xPercent/100,x=s.y+g*s.yPercent/100;if(null!=s.ox&&(c=(s.oxp?d*s.ox*.01:s.ox)-d/2,p=(s.oyp?g*s.oy*.01:s.oy)-g/2,T+=c-(c*o+p*l),x+=p-(c*h+p*_)),v?(c=d/2,p=g/2,y+=", Dx="+(c-(c*o+p*l)+T)+", Dy="+(p-(c*h+p*_)+x)+")"):y+=", sizingMethod='auto expand')",u.filter=-1!==e.indexOf("DXImageTransform.Microsoft.Matrix(")?e.replace(F,y):y+" "+e,(0===t||1===t)&&1===o&&0===l&&0===h&&1===_&&(v&&-1===y.indexOf("Dx=0, Dy=0")||b.test(e)&&100!==parseFloat(RegExp.$1)||-1===e.indexOf("gradient("&&e.indexOf("Alpha"))&&u.removeAttribute("filter")),!v){var P,O,k,S=8>m?1:-1;for(c=s.ieOffsetX||0,p=s.ieOffsetY||0,s.ieOffsetX=Math.round((d-((0>o?-o:o)*d+(0>l?-l:l)*g))/2+T),s.ieOffsetY=Math.round((g-((0>_?-_:_)*g+(0>h?-h:h)*d))/2+x),xe=0;4>xe;xe++)O=re[xe],P=f[O],i=-1!==P.indexOf("px")?parseFloat(P):J(this.t,O,parseFloat(P),P.replace(w,""))||0,k=i!==s[O]?2>xe?-s.ieOffsetX:-s.ieOffsetY:2>xe?c-s.ieOffsetX:p-s.ieOffsetY,u[O]=(s[O]=Math.round(i-k*(0===xe||2===xe?1:S)))+"px"}}},Ue=U.set3DTransformRatio=U.setTransformRatio=function(t){var e,i,s,r,n,a,o,l,h,_,u,f,p,m,d,g,v,y,T,x,w,b,P,O=this.data,k=this.t.style,S=O.rotation,R=O.rotationX,A=O.rotationY,C=O.scaleX,D=O.scaleY,M=O.scaleZ,F=O.x,z=O.y,X=O.z,N=O.svg,L=O.perspective,E=O.force3D;if(!(((1!==t&&0!==t||"auto"!==E||this.tween._totalTime!==this.tween._totalDuration&&this.tween._totalTime)&&E||X||L||A||R||1!==M)&&(!Oe||!N)&&Ce))return void(S||O.skewX||N?(S*=I,b=O.skewX*I,P=1e5,e=Math.cos(S)*C,r=Math.sin(S)*C,i=Math.sin(S-b)*-D,n=Math.cos(S-b)*D,b&&"simple"===O.skewType&&(v=Math.tan(b-O.skewY*I),v=Math.sqrt(1+v*v),i*=v,n*=v,O.skewY&&(v=Math.tan(O.skewY*I),v=Math.sqrt(1+v*v),e*=v,r*=v)),N&&(F+=O.xOrigin-(O.xOrigin*e+O.yOrigin*i)+O.xOffset,z+=O.yOrigin-(O.xOrigin*r+O.yOrigin*n)+O.yOffset,Oe&&(O.xPercent||O.yPercent)&&(m=this.t.getBBox(),F+=.01*O.xPercent*m.width,z+=.01*O.yPercent*m.height),m=1e-6,m>F&&F>-m&&(F=0),m>z&&z>-m&&(z=0)),T=(e*P|0)/P+","+(r*P|0)/P+","+(i*P|0)/P+","+(n*P|0)/P+","+F+","+z+")",N&&Oe?this.t.setAttribute("transform","matrix("+T):k[Se]=(O.xPercent||O.yPercent?"translate("+O.xPercent+"%,"+O.yPercent+"%) matrix(":"matrix(")+T):k[Se]=(O.xPercent||O.yPercent?"translate("+O.xPercent+"%,"+O.yPercent+"%) matrix(":"matrix(")+C+",0,0,"+D+","+F+","+z+")");if(c&&(m=1e-4,m>C&&C>-m&&(C=M=2e-5),m>D&&D>-m&&(D=M=2e-5),!L||O.z||O.rotationX||O.rotationY||(L=0)),S||O.skewX)S*=I,d=e=Math.cos(S),g=r=Math.sin(S),O.skewX&&(S-=O.skewX*I,d=Math.cos(S),g=Math.sin(S),"simple"===O.skewType&&(v=Math.tan((O.skewX-O.skewY)*I),v=Math.sqrt(1+v*v),d*=v,g*=v,O.skewY&&(v=Math.tan(O.skewY*I),v=Math.sqrt(1+v*v),e*=v,r*=v))),i=-g,n=d;else{if(!(A||R||1!==M||L||N))return void(k[Se]=(O.xPercent||O.yPercent?"translate("+O.xPercent+"%,"+O.yPercent+"%) translate3d(":"translate3d(")+F+"px,"+z+"px,"+X+"px)"+(1!==C||1!==D?" scale("+C+","+D+")":""));e=n=1,i=r=0}h=1,s=a=o=l=_=u=0,f=L?-1/L:0,p=O.zOrigin,m=1e-6,x=",",w="0",S=A*I,S&&(d=Math.cos(S),g=Math.sin(S),o=-g,_=f*-g,s=e*g,a=r*g,h=d,f*=d,e*=d,r*=d),S=R*I,S&&(d=Math.cos(S),g=Math.sin(S),v=i*d+s*g,y=n*d+a*g,l=h*g,u=f*g,s=i*-g+s*d,a=n*-g+a*d,h*=d,f*=d,i=v,n=y),1!==M&&(s*=M,a*=M,h*=M,f*=M),1!==D&&(i*=D,n*=D,l*=D,u*=D),1!==C&&(e*=C,r*=C,o*=C,_*=C),(p||N)&&(p&&(F+=s*-p,z+=a*-p,X+=h*-p+p),N&&(F+=O.xOrigin-(O.xOrigin*e+O.yOrigin*i)+O.xOffset,z+=O.yOrigin-(O.xOrigin*r+O.yOrigin*n)+O.yOffset),m>F&&F>-m&&(F=w),m>z&&z>-m&&(z=w),m>X&&X>-m&&(X=0)),T=O.xPercent||O.yPercent?"translate("+O.xPercent+"%,"+O.yPercent+"%) matrix3d(":"matrix3d(",T+=(m>e&&e>-m?w:e)+x+(m>r&&r>-m?w:r)+x+(m>o&&o>-m?w:o),T+=x+(m>_&&_>-m?w:_)+x+(m>i&&i>-m?w:i)+x+(m>n&&n>-m?w:n),R||A||1!==M?(T+=x+(m>l&&l>-m?w:l)+x+(m>u&&u>-m?w:u)+x+(m>s&&s>-m?w:s),T+=x+(m>a&&a>-m?w:a)+x+(m>h&&h>-m?w:h)+x+(m>f&&f>-m?w:f)+x):T+=",0,0,0,0,1,0,",T+=F+x+z+x+X+x+(L?1+-X/L:1)+")",k[Se]=T};h=De.prototype,h.x=h.y=h.z=h.skewX=h.skewY=h.rotation=h.rotationX=h.rotationY=h.zOrigin=h.xPercent=h.yPercent=h.xOffset=h.yOffset=0,h.scaleX=h.scaleY=h.scaleZ=1,be("transform,scale,scaleX,scaleY,scaleZ,x,y,z,rotation,rotationX,rotationY,rotationZ,skewX,skewY,shortRotation,shortRotationX,shortRotationY,shortRotationZ,transformOrigin,svgOrigin,transformPerspective,directionalRotation,parseTransform,force3D,skewType,xPercent,yPercent,smoothOrigin",{parser:function(t,e,i,s,n,o,l){if(s._lastParsedTransform===l)return n;s._lastParsedTransform=l;var h;"function"==typeof l[i]&&(h=l[i],l[i]=e);var _,u,f,c,p,m,v,y,T,x=t._gsTransform,w=t.style,b=1e-6,P=ke.length,O=l,k={},S="transformOrigin",R=Be(t,r,!0,O.parseTransform),A=O.transform&&("function"==typeof O.transform?O.transform(g,d):O.transform);if(s._transform=R,A&&"string"==typeof A&&Se)u=B.style,u[Se]=A,u.display="block",u.position="absolute",E.body.appendChild(B),_=Be(B,null,!1),R.svg&&(m=R.xOrigin,v=R.yOrigin,_.x-=R.xOffset,_.y-=R.yOffset,(O.transformOrigin||O.svgOrigin)&&(A={},Ie(t,ae(O.transformOrigin),A,O.svgOrigin,O.smoothOrigin,!0),m=A.xOrigin,v=A.yOrigin,_.x-=A.xOffset-R.xOffset,_.y-=A.yOffset-R.yOffset),(m||v)&&(y=Ye(B,!0),_.x-=m-(m*y[0]+v*y[2]),_.y-=v-(m*y[1]+v*y[3]))),E.body.removeChild(B),_.perspective||(_.perspective=R.perspective),null!=O.xPercent&&(_.xPercent=le(O.xPercent,R.xPercent)),null!=O.yPercent&&(_.yPercent=le(O.yPercent,R.yPercent));else if("object"==typeof O){if(_={scaleX:le(null!=O.scaleX?O.scaleX:O.scale,R.scaleX),scaleY:le(null!=O.scaleY?O.scaleY:O.scale,R.scaleY),scaleZ:le(O.scaleZ,R.scaleZ),x:le(O.x,R.x),y:le(O.y,R.y),z:le(O.z,R.z),xPercent:le(O.xPercent,R.xPercent),yPercent:le(O.yPercent,R.yPercent),perspective:le(O.transformPerspective,R.perspective)},p=O.directionalRotation,null!=p)if("object"==typeof p)for(u in p)O[u]=p[u];else O.rotation=p;"string"==typeof O.x&&-1!==O.x.indexOf("%")&&(_.x=0,_.xPercent=le(O.x,R.xPercent)),"string"==typeof O.y&&-1!==O.y.indexOf("%")&&(_.y=0,_.yPercent=le(O.y,R.yPercent)),_.rotation=he("rotation"in O?O.rotation:"shortRotation"in O?O.shortRotation+"_short":"rotationZ"in O?O.rotationZ:R.rotation-R.skewY,R.rotation-R.skewY,"rotation",k),Ce&&(_.rotationX=he("rotationX"in O?O.rotationX:"shortRotationX"in O?O.shortRotationX+"_short":R.rotationX||0,R.rotationX,"rotationX",k),_.rotationY=he("rotationY"in O?O.rotationY:"shortRotationY"in O?O.shortRotationY+"_short":R.rotationY||0,R.rotationY,"rotationY",k)),_.skewX=he(O.skewX,R.skewX-R.skewY),(_.skewY=he(O.skewY,R.skewY))&&(_.skewX+=_.skewY,_.rotation+=_.skewY)}for(Ce&&null!=O.force3D&&(R.force3D=O.force3D,c=!0),R.skewType=O.skewType||R.skewType||a.defaultSkewType,f=R.force3D||R.z||R.rotationX||R.rotationY||_.z||_.rotationX||_.rotationY||_.perspective,f||null==O.scale||(_.scaleZ=1);--P>-1;)T=ke[P],A=_[T]-R[T],(A>b||-b>A||null!=O[T]||null!=L[T])&&(c=!0,n=new ve(R,T,R[T],A,n),T in k&&(n.e=k[T]),n.xs0=0,n.plugin=o,s._overwriteProps.push(n.n));return A=O.transformOrigin,R.svg&&(A||O.svgOrigin)&&(m=R.xOffset,v=R.yOffset,Ie(t,ae(A),_,O.svgOrigin,O.smoothOrigin),n=ye(R,"xOrigin",(x?R:_).xOrigin,_.xOrigin,n,S),n=ye(R,"yOrigin",(x?R:_).yOrigin,_.yOrigin,n,S),(m!==R.xOffset||v!==R.yOffset)&&(n=ye(R,"xOffset",x?m:R.xOffset,R.xOffset,n,S),n=ye(R,"yOffset",x?v:R.yOffset,R.yOffset,n,S)),A=Oe?null:"0px 0px"),(A||Ce&&f&&R.zOrigin)&&(Se?(c=!0,T=Ae,A=(A||K(t,T,r,!1,"50% 50%"))+"",n=new ve(w,T,0,0,n,-1,S),n.b=w[T],n.plugin=o,Ce?(u=R.zOrigin,A=A.split(" "),R.zOrigin=(A.length>2&&(0===u||"0px"!==A[2])?parseFloat(A[2]):u)||0,n.xs0=n.e=A[0]+" "+(A[1]||"50%")+" 0px",n=new ve(R,"zOrigin",0,0,n,-1,n.n),n.b=u,n.xs0=n.e=R.zOrigin):n.xs0=n.e=A):ae(A+"",R)),c&&(s._transformType=R.svg&&Oe||!f&&3!==this._transformType?2:3),h&&(l[i]=h),n
},prefix:!0}),be("boxShadow",{defaultValue:"0px 0px 0px 0px #999",prefix:!0,color:!0,multi:!0,keyword:"inset"}),be("borderRadius",{defaultValue:"0px",parser:function(t,e,i,n,a){e=this.format(e);var o,l,h,_,u,f,c,p,m,d,g,v,y,T,x,w,b=["borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"],P=t.style;for(m=parseFloat(t.offsetWidth),d=parseFloat(t.offsetHeight),o=e.split(" "),l=0;l<b.length;l++)this.p.indexOf("border")&&(b[l]=Q(b[l])),u=_=K(t,b[l],r,!1,"0px"),-1!==u.indexOf(" ")&&(_=u.split(" "),u=_[0],_=_[1]),f=h=o[l],c=parseFloat(u),v=u.substr((c+"").length),y="="===f.charAt(1),y?(p=parseInt(f.charAt(0)+"1",10),f=f.substr(2),p*=parseFloat(f),g=f.substr((p+"").length-(0>p?1:0))||""):(p=parseFloat(f),g=f.substr((p+"").length)),""===g&&(g=s[i]||v),g!==v&&(T=J(t,"borderLeft",c,v),x=J(t,"borderTop",c,v),"%"===g?(u=T/m*100+"%",_=x/d*100+"%"):"em"===g?(w=J(t,"borderLeft",1,"em"),u=T/w+"em",_=x/w+"em"):(u=T+"px",_=x+"px"),y&&(f=parseFloat(u)+p+g,h=parseFloat(_)+p+g)),a=Te(P,b[l],u+" "+_,f+" "+h,!1,"0px",a);return a},prefix:!0,formatter:me("0px 0px 0px 0px",!1,!0)}),be("borderBottomLeftRadius,borderBottomRightRadius,borderTopLeftRadius,borderTopRightRadius",{defaultValue:"0px",parser:function(t,e,i,s,n){return Te(t.style,i,this.format(K(t,i,r,!1,"0px 0px")),this.format(e),!1,"0px",n)},prefix:!0,formatter:me("0px 0px",!1,!0)}),be("backgroundPosition",{defaultValue:"0 0",parser:function(t,e,i,s,n,a){var o,l,h,_,u,f,c="background-position",p=r||H(t,null),d=this.format((p?m?p.getPropertyValue(c+"-x")+" "+p.getPropertyValue(c+"-y"):p.getPropertyValue(c):t.currentStyle.backgroundPositionX+" "+t.currentStyle.backgroundPositionY)||"0 0"),g=this.format(e);if(-1!==d.indexOf("%")!=(-1!==g.indexOf("%"))&&g.split(",").length<2&&(f=K(t,"backgroundImage").replace(A,""),f&&"none"!==f)){for(o=d.split(" "),l=g.split(" "),j.setAttribute("src",f),h=2;--h>-1;)d=o[h],_=-1!==d.indexOf("%"),_!==(-1!==l[h].indexOf("%"))&&(u=0===h?t.offsetWidth-j.width:t.offsetHeight-j.height,o[h]=_?parseFloat(d)/100*u+"px":parseFloat(d)/u*100+"%");d=o.join(" ")}return this.parseComplex(t.style,d,g,n,a)},formatter:ae}),be("backgroundSize",{defaultValue:"0 0",formatter:function(t){return t+="",ae(-1===t.indexOf(" ")?t+" "+t:t)}}),be("perspective",{defaultValue:"0px",prefix:!0}),be("perspectiveOrigin",{defaultValue:"50% 50%",prefix:!0}),be("transformStyle",{prefix:!0}),be("backfaceVisibility",{prefix:!0}),be("userSelect",{prefix:!0}),be("margin",{parser:de("marginTop,marginRight,marginBottom,marginLeft")}),be("padding",{parser:de("paddingTop,paddingRight,paddingBottom,paddingLeft")}),be("clip",{defaultValue:"rect(0px,0px,0px,0px)",parser:function(t,e,i,s,n,a){var o,l,h;return 9>m?(l=t.currentStyle,h=8>m?" ":",",o="rect("+l.clipTop+h+l.clipRight+h+l.clipBottom+h+l.clipLeft+")",e=this.format(e).split(",").join(h)):(o=this.format(K(t,this.p,r,!1,this.dflt)),e=this.format(e)),this.parseComplex(t.style,o,e,n,a)}}),be("textShadow",{defaultValue:"0px 0px 0px #999",color:!0,multi:!0}),be("autoRound,strictUnits",{parser:function(t,e,i,s,r){return r}}),be("border",{defaultValue:"0px solid #000",parser:function(t,e,i,s,n,a){var o=K(t,"borderTopWidth",r,!1,"0px"),l=this.format(e).split(" "),h=l[0].replace(w,"");return"px"!==h&&(o=parseFloat(o)/J(t,"borderTopWidth",1,h)+h),this.parseComplex(t.style,this.format(o+" "+K(t,"borderTopStyle",r,!1,"solid")+" "+K(t,"borderTopColor",r,!1,"#000")),l.join(" "),n,a)},color:!0,formatter:function(t){var e=t.split(" ");return e[0]+" "+(e[1]||"solid")+" "+(t.match(pe)||["#000"])[0]}}),be("borderWidth",{parser:de("borderTopWidth,borderRightWidth,borderBottomWidth,borderLeftWidth")}),be("float,cssFloat,styleFloat",{parser:function(t,e,i,s,r){var n=t.style,a="cssFloat"in n?"cssFloat":"styleFloat";return new ve(n,a,0,0,r,-1,i,!1,0,n[a],e)}});var Ve=function(t){var e,i=this.t,s=i.filter||K(this.data,"filter")||"",r=this.s+this.c*t|0;100===r&&(-1===s.indexOf("atrix(")&&-1===s.indexOf("radient(")&&-1===s.indexOf("oader(")?(i.removeAttribute("filter"),e=!K(this.data,"filter")):(i.filter=s.replace(O,""),e=!0)),e||(this.xn1&&(i.filter=s=s||"alpha(opacity="+r+")"),-1===s.indexOf("pacity")?0===r&&this.xn1||(i.filter=s+" alpha(opacity="+r+")"):i.filter=s.replace(b,"opacity="+r))};be("opacity,alpha,autoAlpha",{defaultValue:"1",parser:function(t,e,i,s,n,a){var o=parseFloat(K(t,"opacity",r,!1,"1")),l=t.style,h="autoAlpha"===i;return"string"==typeof e&&"="===e.charAt(1)&&(e=("-"===e.charAt(0)?-1:1)*parseFloat(e.substr(2))+o),h&&1===o&&"hidden"===K(t,"visibility",r)&&0!==e&&(o=0),q?n=new ve(l,"opacity",o,e-o,n):(n=new ve(l,"opacity",100*o,100*(e-o),n),n.xn1=h?1:0,l.zoom=1,n.type=2,n.b="alpha(opacity="+n.s+")",n.e="alpha(opacity="+(n.s+n.c)+")",n.data=t,n.plugin=a,n.setRatio=Ve),h&&(n=new ve(l,"visibility",0,0,n,-1,null,!1,0,0!==o?"inherit":"hidden",0===e?"hidden":"inherit"),n.xs0="inherit",s._overwriteProps.push(n.n),s._overwriteProps.push(i)),n}});var qe=function(t,e){e&&(t.removeProperty?(("ms"===e.substr(0,2)||"webkit"===e.substr(0,6))&&(e="-"+e),t.removeProperty(e.replace(S,"-$1").toLowerCase())):t.removeAttribute(e))},We=function(t){if(this.t._gsClassPT=this,1===t||0===t){this.t.setAttribute("class",0===t?this.b:this.e);for(var e=this.data,i=this.t.style;e;)e.v?i[e.p]=e.v:qe(i,e.p),e=e._next;1===t&&this.t._gsClassPT===this&&(this.t._gsClassPT=null)}else this.t.getAttribute("class")!==this.e&&this.t.setAttribute("class",this.e)};be("className",{parser:function(t,e,s,n,a,o,l){var h,_,u,f,c,p=t.getAttribute("class")||"",m=t.style.cssText;if(a=n._classNamePT=new ve(t,s,0,0,a,2),a.setRatio=We,a.pr=-11,i=!0,a.b=p,_=ee(t,r),u=t._gsClassPT){for(f={},c=u.data;c;)f[c.p]=1,c=c._next;u.setRatio(1)}return t._gsClassPT=a,a.e="="!==e.charAt(1)?e:p.replace(new RegExp("(?:\\s|^)"+e.substr(2)+"(?![\\w-])"),"")+("+"===e.charAt(0)?" "+e.substr(2):""),t.setAttribute("class",a.e),h=ie(t,_,ee(t),l,f),t.setAttribute("class",p),a.data=h.firstMPT,t.style.cssText=m,a=a.xfirst=n.parse(t,h.difs,a,o)}});var Ze=function(t){if((1===t||0===t)&&this.data._totalTime===this.data._totalDuration&&"isFromStart"!==this.data.data){var e,i,s,r,n,a=this.t.style,o=l.transform.parse;if("all"===this.e)a.cssText="",r=!0;else for(e=this.e.split(" ").join("").split(","),s=e.length;--s>-1;)i=e[s],l[i]&&(l[i].parse===o?r=!0:i="transformOrigin"===i?Ae:l[i].p),qe(a,i);r&&(qe(a,Se),n=this.t._gsTransform,n&&(n.svg&&(this.t.removeAttribute("data-svg-origin"),this.t.removeAttribute("transform")),delete this.t._gsTransform))}};for(be("clearProps",{parser:function(t,e,s,r,n){return n=new ve(t,s,0,0,n,2),n.setRatio=Ze,n.e=e,n.pr=-10,n.data=r._tween,i=!0,n}}),h="bezier,throwProps,physicsProps,physics2D".split(","),xe=h.length;xe--;)Pe(h[xe]);h=a.prototype,h._firstPT=h._lastParsedTransform=h._transform=null,h._onInitTween=function(t,e,o,h){if(!t.nodeType)return!1;this._target=d=t,this._tween=o,this._vars=e,g=h,_=e.autoRound,i=!1,s=e.suffixMap||a.suffixMap,r=H(t,""),n=this._overwriteProps;var c,m,v,y,T,x,w,b,O,k=t.style;if(u&&""===k.zIndex&&(c=K(t,"zIndex",r),("auto"===c||""===c)&&this._addLazySet(k,"zIndex",0)),"string"==typeof e&&(y=k.cssText,c=ee(t,r),k.cssText=y+";"+e,c=ie(t,c,ee(t)).difs,!q&&P.test(e)&&(c.opacity=parseFloat(RegExp.$1)),e=c,k.cssText=y),this._firstPT=m=e.className?l.className.parse(t,e.className,"className",this,null,null,e):this.parse(t,e,null),this._transformType){for(O=3===this._transformType,Se?f&&(u=!0,""===k.zIndex&&(w=K(t,"zIndex",r),("auto"===w||""===w)&&this._addLazySet(k,"zIndex",0)),p&&this._addLazySet(k,"WebkitBackfaceVisibility",this._vars.WebkitBackfaceVisibility||(O?"visible":"hidden"))):k.zoom=1,v=m;v&&v._next;)v=v._next;b=new ve(t,"transform",0,0,null,2),this._linkCSSP(b,null,v),b.setRatio=Se?Ue:je,b.data=this._transform||Be(t,r,!0),b.tween=o,b.pr=-1,n.pop()}if(i){for(;m;){for(x=m._next,v=y;v&&v.pr>m.pr;)v=v._next;(m._prev=v?v._prev:T)?m._prev._next=m:y=m,(m._next=v)?v._prev=m:T=m,m=x}this._firstPT=y}return!0},h.parse=function(t,e,i,n){var a,o,h,u,f,c,p,m,v,y,T=t.style;for(a in e)c=e[a],"function"==typeof c&&(c=c(g,d)),o=l[a],o?i=o.parse(t,c,a,this,i,n,e):(f=K(t,a,r)+"",v="string"==typeof c,"color"===a||"fill"===a||"stroke"===a||-1!==a.indexOf("Color")||v&&k.test(c)?(v||(c=fe(c),c=(c.length>3?"rgba(":"rgb(")+c.join(",")+")"),i=Te(T,a,f,c,!0,"transparent",i,0,n)):v&&X.test(c)?i=Te(T,a,f,c,!0,null,i,0,n):(h=parseFloat(f),p=h||0===h?f.substr((h+"").length):"",(""===f||"auto"===f)&&("width"===a||"height"===a?(h=ne(t,a,r),p="px"):"left"===a||"top"===a?(h=te(t,a,r),p="px"):(h="opacity"!==a?0:1,p="")),y=v&&"="===c.charAt(1),y?(u=parseInt(c.charAt(0)+"1",10),c=c.substr(2),u*=parseFloat(c),m=c.replace(w,"")):(u=parseFloat(c),m=v?c.replace(w,""):""),""===m&&(m=a in s?s[a]:p),c=u||0===u?(y?u+h:u)+m:e[a],p!==m&&""!==m&&(u||0===u)&&h&&(h=J(t,a,h,p),"%"===m?(h/=J(t,a,100,"%")/100,e.strictUnits!==!0&&(f=h+"%")):"em"===m||"rem"===m||"vw"===m||"vh"===m?h/=J(t,a,1,m):"px"!==m&&(u=J(t,a,u,m),m="px"),y&&(u||0===u)&&(c=u+h+m)),y&&(u+=h),!h&&0!==h||!u&&0!==u?void 0!==T[a]&&(c||c+""!="NaN"&&null!=c)?(i=new ve(T,a,u||h||0,0,i,-1,a,!1,0,f,c),i.xs0="none"!==c||"display"!==a&&-1===a.indexOf("Style")?c:f):Z("invalid "+a+" tween value: "+e[a]):(i=new ve(T,a,h,u-h,i,0,a,_!==!1&&("px"===m||"zIndex"===a),0,f,c),i.xs0=m))),n&&i&&!i.plugin&&(i.plugin=n);return i},h.setRatio=function(t){var e,i,s,r=this._firstPT,n=1e-6;if(1!==t||this._tween._time!==this._tween._duration&&0!==this._tween._time)if(t||this._tween._time!==this._tween._duration&&0!==this._tween._time||this._tween._rawPrevTime===-1e-6)for(;r;){if(e=r.c*t+r.s,r.r?e=Math.round(e):n>e&&e>-n&&(e=0),r.type)if(1===r.type)if(s=r.l,2===s)r.t[r.p]=r.xs0+e+r.xs1+r.xn1+r.xs2;else if(3===s)r.t[r.p]=r.xs0+e+r.xs1+r.xn1+r.xs2+r.xn2+r.xs3;else if(4===s)r.t[r.p]=r.xs0+e+r.xs1+r.xn1+r.xs2+r.xn2+r.xs3+r.xn3+r.xs4;else if(5===s)r.t[r.p]=r.xs0+e+r.xs1+r.xn1+r.xs2+r.xn2+r.xs3+r.xn3+r.xs4+r.xn4+r.xs5;else{for(i=r.xs0+e+r.xs1,s=1;s<r.l;s++)i+=r["xn"+s]+r["xs"+(s+1)];r.t[r.p]=i}else-1===r.type?r.t[r.p]=r.xs0:r.setRatio&&r.setRatio(t);else r.t[r.p]=e+r.xs0;r=r._next}else for(;r;)2!==r.type?r.t[r.p]=r.b:r.setRatio(t),r=r._next;else for(;r;){if(2!==r.type)if(r.r&&-1!==r.type)if(e=Math.round(r.s+r.c),r.type){if(1===r.type){for(s=r.l,i=r.xs0+e+r.xs1,s=1;s<r.l;s++)i+=r["xn"+s]+r["xs"+(s+1)];r.t[r.p]=i}}else r.t[r.p]=e+r.xs0;else r.t[r.p]=r.e;else r.setRatio(t);r=r._next}},h._enableTransforms=function(t){this._transform=this._transform||Be(this._target,r,!0),this._transformType=this._transform.svg&&Oe||!t&&3!==this._transformType?2:3};var Ge=function(){this.t[this.p]=this.e,this.data._linkCSSP(this,this._next,null,!0)};h._addLazySet=function(t,e,i){var s=this._firstPT=new ve(t,e,0,0,this._firstPT,2);s.e=i,s.setRatio=Ge,s.data=this},h._linkCSSP=function(t,e,i,s){return t&&(e&&(e._prev=t),t._next&&(t._next._prev=t._prev),t._prev?t._prev._next=t._next:this._firstPT===t&&(this._firstPT=t._next,s=!0),i?i._next=t:s||null!==this._firstPT||(this._firstPT=t),t._next=e,t._prev=i),t},h._mod=function(t){for(var e=this._firstPT;e;)"function"==typeof t[e.p]&&t[e.p]===Math.round&&(e.r=1),e=e._next},h._kill=function(e){var i,s,r,n=e;if(e.autoAlpha||e.alpha){n={};for(s in e)n[s]=e[s];n.opacity=1,n.autoAlpha&&(n.visibility=1)}for(e.className&&(i=this._classNamePT)&&(r=i.xfirst,r&&r._prev?this._linkCSSP(r._prev,i._next,r._prev._prev):r===this._firstPT&&(this._firstPT=i._next),i._next&&this._linkCSSP(i._next,i._next._next,r._prev),this._classNamePT=null),i=this._firstPT;i;)i.plugin&&i.plugin!==s&&i.plugin._kill&&(i.plugin._kill(e),s=i.plugin),i=i._next;return t.prototype._kill.call(this,n)};var $e=function(t,e,i){var s,r,n,a;if(t.slice)for(r=t.length;--r>-1;)$e(t[r],e,i);else for(s=t.childNodes,r=s.length;--r>-1;)n=s[r],a=n.type,n.style&&(e.push(ee(n)),i&&i.push(n)),1!==a&&9!==a&&11!==a||!n.childNodes.length||$e(n,e,i)};return a.cascadeTo=function(t,i,s){var r,n,a,o,l=e.to(t,i,s),h=[l],_=[],u=[],f=[],c=e._internals.reservedProps;for(t=l._targets||l.target,$e(t,_,f),l.render(i,!0,!0),$e(t,u),l.render(0,!0,!0),l._enabled(!0),r=f.length;--r>-1;)if(n=ie(f[r],_[r],u[r]),n.firstMPT){n=n.difs;for(a in s)c[a]&&(n[a]=s[a]);o={};for(a in n)o[a]=_[r][a];h.push(e.fromTo(f[r],i,o,n))}return h},t.activate([a]),a},!0),function(){var t=_gsScope._gsDefine.plugin({propName:"roundProps",version:"1.6.0",priority:-1,API:2,init:function(t,e,i){return this._tween=i,!0}}),e=function(t){for(;t;)t.f||t.blob||(t.m=Math.round),t=t._next},i=t.prototype;i._onInitAllProps=function(){for(var t,i,s,r=this._tween,n=r.vars.roundProps.join?r.vars.roundProps:r.vars.roundProps.split(","),a=n.length,o={},l=r._propLookup.roundProps;--a>-1;)o[n[a]]=Math.round;for(a=n.length;--a>-1;)for(t=n[a],i=r._firstPT;i;)s=i._next,i.pg?i.t._mod(o):i.n===t&&(2===i.f&&i.t?e(i.t._firstPT):(this._add(i.t,t,i.s,i.c),s&&(s._prev=i._prev),i._prev?i._prev._next=s:r._firstPT===i&&(r._firstPT=s),i._next=i._prev=null,r._propLookup[t]=l)),i=s;return!1},i._add=function(t,e,i,s){this._addTween(t,e,i,i+s,e,Math.round),this._overwriteProps.push(e)}}(),function(){_gsScope._gsDefine.plugin({propName:"attr",API:2,version:"0.6.0",init:function(t,e,i,s){var r,n;if("function"!=typeof t.setAttribute)return!1;for(r in e)n=e[r],"function"==typeof n&&(n=n(s,t)),this._addTween(t,"setAttribute",t.getAttribute(r)+"",n+"",r,!1,r),this._overwriteProps.push(r);return!0}})}(),_gsScope._gsDefine.plugin({propName:"directionalRotation",version:"0.3.0",API:2,init:function(t,e,i,s){"object"!=typeof e&&(e={rotation:e}),this.finals={};var r,n,a,o,l,h,_=e.useRadians===!0?2*Math.PI:360,u=1e-6;for(r in e)"useRadians"!==r&&(o=e[r],"function"==typeof o&&(o=o(s,t)),h=(o+"").split("_"),n=h[0],a=parseFloat("function"!=typeof t[r]?t[r]:t[r.indexOf("set")||"function"!=typeof t["get"+r.substr(3)]?r:"get"+r.substr(3)]()),o=this.finals[r]="string"==typeof n&&"="===n.charAt(1)?a+parseInt(n.charAt(0)+"1",10)*Number(n.substr(2)):Number(n)||0,l=o-a,h.length&&(n=h.join("_"),-1!==n.indexOf("short")&&(l%=_,l!==l%(_/2)&&(l=0>l?l+_:l-_)),-1!==n.indexOf("_cw")&&0>l?l=(l+9999999999*_)%_-(l/_|0)*_:-1!==n.indexOf("ccw")&&l>0&&(l=(l-9999999999*_)%_-(l/_|0)*_)),(l>u||-u>l)&&(this._addTween(t,r,a,a+l,r),this._overwriteProps.push(r)));return!0},set:function(t){var e;if(1!==t)this._super.setRatio.call(this,t);else for(e=this._firstPT;e;)e.f?e.t[e.p](this.finals[e.p]):e.t[e.p]=this.finals[e.p],e=e._next}})._autoCSS=!0,_gsScope._gsDefine("easing.Back",["easing.Ease"],function(t){var e,i,s,r=_gsScope.GreenSockGlobals||_gsScope,n=r.com.greensock,a=2*Math.PI,o=Math.PI/2,l=n._class,h=function(e,i){var s=l("easing."+e,function(){},!0),r=s.prototype=new t;return r.constructor=s,r.getRatio=i,s},_=t.register||function(){},u=function(t,e,i,s){var r=l("easing."+t,{easeOut:new e,easeIn:new i,easeInOut:new s},!0);return _(r,t),r},f=function(t,e,i){this.t=t,this.v=e,i&&(this.next=i,i.prev=this,this.c=i.v-e,this.gap=i.t-t)},c=function(e,i){var s=l("easing."+e,function(t){this._p1=t||0===t?t:1.70158,this._p2=1.525*this._p1},!0),r=s.prototype=new t;return r.constructor=s,r.getRatio=i,r.config=function(t){return new s(t)},s},p=u("Back",c("BackOut",function(t){return(t-=1)*t*((this._p1+1)*t+this._p1)+1}),c("BackIn",function(t){return t*t*((this._p1+1)*t-this._p1)}),c("BackInOut",function(t){return(t*=2)<1?.5*t*t*((this._p2+1)*t-this._p2):.5*((t-=2)*t*((this._p2+1)*t+this._p2)+2)})),m=l("easing.SlowMo",function(t,e,i){e=e||0===e?e:.7,null==t?t=.7:t>1&&(t=1),this._p=1!==t?e:0,this._p1=(1-t)/2,this._p2=t,this._p3=this._p1+this._p2,this._calcEnd=i===!0},!0),d=m.prototype=new t;return d.constructor=m,d.getRatio=function(t){var e=t+(.5-t)*this._p;return t<this._p1?this._calcEnd?1-(t=1-t/this._p1)*t:e-(t=1-t/this._p1)*t*t*t*e:t>this._p3?this._calcEnd?1-(t=(t-this._p3)/this._p1)*t:e+(t-e)*(t=(t-this._p3)/this._p1)*t*t*t:this._calcEnd?1:e},m.ease=new m(.7,.7),d.config=m.config=function(t,e,i){return new m(t,e,i)},e=l("easing.SteppedEase",function(t){t=t||1,this._p1=1/t,this._p2=t+1},!0),d=e.prototype=new t,d.constructor=e,d.getRatio=function(t){return 0>t?t=0:t>=1&&(t=.999999999),(this._p2*t>>0)*this._p1},d.config=e.config=function(t){return new e(t)},i=l("easing.RoughEase",function(e){e=e||{};for(var i,s,r,n,a,o,l=e.taper||"none",h=[],_=0,u=0|(e.points||20),c=u,p=e.randomize!==!1,m=e.clamp===!0,d=e.template instanceof t?e.template:null,g="number"==typeof e.strength?.4*e.strength:.4;--c>-1;)i=p?Math.random():1/u*c,s=d?d.getRatio(i):i,"none"===l?r=g:"out"===l?(n=1-i,r=n*n*g):"in"===l?r=i*i*g:.5>i?(n=2*i,r=n*n*.5*g):(n=2*(1-i),r=n*n*.5*g),p?s+=Math.random()*r-.5*r:c%2?s+=.5*r:s-=.5*r,m&&(s>1?s=1:0>s&&(s=0)),h[_++]={x:i,y:s};for(h.sort(function(t,e){return t.x-e.x}),o=new f(1,1,null),c=u;--c>-1;)a=h[c],o=new f(a.x,a.y,o);this._prev=new f(0,0,0!==o.t?o:o.next)},!0),d=i.prototype=new t,d.constructor=i,d.getRatio=function(t){var e=this._prev;if(t>e.t){for(;e.next&&t>=e.t;)e=e.next;e=e.prev}else for(;e.prev&&t<=e.t;)e=e.prev;return this._prev=e,e.v+(t-e.t)/e.gap*e.c},d.config=function(t){return new i(t)},i.ease=new i,u("Bounce",h("BounceOut",function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}),h("BounceIn",function(t){return(t=1-t)<1/2.75?1-7.5625*t*t:2/2.75>t?1-(7.5625*(t-=1.5/2.75)*t+.75):2.5/2.75>t?1-(7.5625*(t-=2.25/2.75)*t+.9375):1-(7.5625*(t-=2.625/2.75)*t+.984375)}),h("BounceInOut",function(t){var e=.5>t;return t=e?1-2*t:2*t-1,t=1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,e?.5*(1-t):.5*t+.5})),u("Circ",h("CircOut",function(t){return Math.sqrt(1-(t-=1)*t)}),h("CircIn",function(t){return-(Math.sqrt(1-t*t)-1)}),h("CircInOut",function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)})),s=function(e,i,s){var r=l("easing."+e,function(t,e){this._p1=t>=1?t:1,this._p2=(e||s)/(1>t?t:1),this._p3=this._p2/a*(Math.asin(1/this._p1)||0),this._p2=a/this._p2},!0),n=r.prototype=new t;return n.constructor=r,n.getRatio=i,n.config=function(t,e){return new r(t,e)},r},u("Elastic",s("ElasticOut",function(t){return this._p1*Math.pow(2,-10*t)*Math.sin((t-this._p3)*this._p2)+1},.3),s("ElasticIn",function(t){return-(this._p1*Math.pow(2,10*(t-=1))*Math.sin((t-this._p3)*this._p2))},.3),s("ElasticInOut",function(t){return(t*=2)<1?-.5*this._p1*Math.pow(2,10*(t-=1))*Math.sin((t-this._p3)*this._p2):this._p1*Math.pow(2,-10*(t-=1))*Math.sin((t-this._p3)*this._p2)*.5+1},.45)),u("Expo",h("ExpoOut",function(t){return 1-Math.pow(2,-10*t)}),h("ExpoIn",function(t){return Math.pow(2,10*(t-1))-.001}),h("ExpoInOut",function(t){return(t*=2)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*(t-1)))})),u("Sine",h("SineOut",function(t){return Math.sin(t*o)}),h("SineIn",function(t){return-Math.cos(t*o)+1}),h("SineInOut",function(t){return-.5*(Math.cos(Math.PI*t)-1)})),l("easing.EaseLookup",{find:function(e){return t.map[e]}},!0),_(r.SlowMo,"SlowMo","ease,"),_(i,"RoughEase","ease,"),_(e,"SteppedEase","ease,"),p},!0)}),_gsScope._gsDefine&&_gsScope._gsQueue.pop()(),function(t,e){"use strict";var i={},s=t.GreenSockGlobals=t.GreenSockGlobals||t;if(!s.TweenLite){var r,n,a,o,l,h=function(t){var e,i=t.split("."),r=s;for(e=0;e<i.length;e++)r[i[e]]=r=r[i[e]]||{};return r},_=h("com.greensock"),u=1e-10,f=function(t){var e,i=[],s=t.length;for(e=0;e!==s;i.push(t[e++]));return i},c=function(){},p=function(){var t=Object.prototype.toString,e=t.call([]);return function(i){return null!=i&&(i instanceof Array||"object"==typeof i&&!!i.push&&t.call(i)===e)}}(),m={},d=function(r,n,a,o){this.sc=m[r]?m[r].sc:[],m[r]=this,this.gsClass=null,this.func=a;var l=[];this.check=function(_){for(var u,f,c,p,g,v=n.length,y=v;--v>-1;)(u=m[n[v]]||new d(n[v],[])).gsClass?(l[v]=u.gsClass,y--):_&&u.sc.push(this);if(0===y&&a){if(f=("com.greensock."+r).split("."),c=f.pop(),p=h(f.join("."))[c]=this.gsClass=a.apply(a,l),o)if(s[c]=i[c]=p,g="undefined"!=typeof module&&module.exports,!g&&"function"==typeof define&&define.amd)define((t.GreenSockAMDPath?t.GreenSockAMDPath+"/":"")+r.split(".").pop(),[],function(){return p});else if(g)if(r===e){module.exports=i[e]=p;for(v in i)p[v]=i[v]}else i[e]&&(i[e][c]=p);for(v=0;v<this.sc.length;v++)this.sc[v].check()}},this.check(!0)},g=t._gsDefine=function(t,e,i,s){return new d(t,e,i,s)},v=_._class=function(t,e,i){return e=e||function(){},g(t,[],function(){return e},i),e};g.globals=s;var y=[0,0,1,1],T=v("easing.Ease",function(t,e,i,s){this._func=t,this._type=i||0,this._power=s||0,this._params=e?y.concat(e):y},!0),x=T.map={},w=T.register=function(t,e,i,s){for(var r,n,a,o,l=e.split(","),h=l.length,u=(i||"easeIn,easeOut,easeInOut").split(",");--h>-1;)for(n=l[h],r=s?v("easing."+n,null,!0):_.easing[n]||{},a=u.length;--a>-1;)o=u[a],x[n+"."+o]=x[o+n]=r[o]=t.getRatio?t:t[o]||new t};for(a=T.prototype,a._calcEnd=!1,a.getRatio=function(t){if(this._func)return this._params[0]=t,this._func.apply(null,this._params);var e=this._type,i=this._power,s=1===e?1-t:2===e?t:.5>t?2*t:2*(1-t);return 1===i?s*=s:2===i?s*=s*s:3===i?s*=s*s*s:4===i&&(s*=s*s*s*s),1===e?1-s:2===e?s:.5>t?s/2:1-s/2},r=["Linear","Quad","Cubic","Quart","Quint,Strong"],n=r.length;--n>-1;)a=r[n]+",Power"+n,w(new T(null,null,1,n),a,"easeOut",!0),w(new T(null,null,2,n),a,"easeIn"+(0===n?",easeNone":"")),w(new T(null,null,3,n),a,"easeInOut");x.linear=_.easing.Linear.easeIn,x.swing=_.easing.Quad.easeInOut;var b=v("events.EventDispatcher",function(t){this._listeners={},this._eventTarget=t||this});a=b.prototype,a.addEventListener=function(t,e,i,s,r){r=r||0;var n,a,h=this._listeners[t],_=0;for(this!==o||l||o.wake(),null==h&&(this._listeners[t]=h=[]),a=h.length;--a>-1;)n=h[a],n.c===e&&n.s===i?h.splice(a,1):0===_&&n.pr<r&&(_=a+1);h.splice(_,0,{c:e,s:i,up:s,pr:r})},a.removeEventListener=function(t,e){var i,s=this._listeners[t];if(s)for(i=s.length;--i>-1;)if(s[i].c===e)return void s.splice(i,1)},a.dispatchEvent=function(t){var e,i,s,r=this._listeners[t];if(r)for(e=r.length,e>1&&(r=r.slice(0)),i=this._eventTarget;--e>-1;)s=r[e],s&&(s.up?s.c.call(s.s||i,{type:t,target:i}):s.c.call(s.s||i))};var P=t.requestAnimationFrame,O=t.cancelAnimationFrame,k=Date.now||function(){return(new Date).getTime()},S=k();for(r=["ms","moz","webkit","o"],n=r.length;--n>-1&&!P;)P=t[r[n]+"RequestAnimationFrame"],O=t[r[n]+"CancelAnimationFrame"]||t[r[n]+"CancelRequestAnimationFrame"];v("Ticker",function(t,e){var i,s,r,n,a,h=this,_=k(),f=e!==!1&&P?"auto":!1,p=500,m=33,d="tick",g=function(t){var e,o,l=k()-S;l>p&&(_+=l-m),S+=l,h.time=(S-_)/1e3,e=h.time-a,(!i||e>0||t===!0)&&(h.frame++,a+=e+(e>=n?.004:n-e),o=!0),t!==!0&&(r=s(g)),o&&h.dispatchEvent(d)};b.call(h),h.time=h.frame=0,h.tick=function(){g(!0)},h.lagSmoothing=function(t,e){p=t||1/u,m=Math.min(e,p,0)},h.sleep=function(){null!=r&&(f&&O?O(r):clearTimeout(r),s=c,r=null,h===o&&(l=!1))},h.wake=function(t){null!==r?h.sleep():t?_+=-S+(S=k()):h.frame>10&&(S=k()-p+5),s=0===i?c:f&&P?P:function(t){return setTimeout(t,1e3*(a-h.time)+1|0)},h===o&&(l=!0),g(2)},h.fps=function(t){return arguments.length?(i=t,n=1/(i||60),a=this.time+n,void h.wake()):i},h.useRAF=function(t){return arguments.length?(h.sleep(),f=t,void h.fps(i)):f},h.fps(t),setTimeout(function(){"auto"===f&&h.frame<5&&"hidden"!==document.visibilityState&&h.useRAF(!1)},1500)}),a=_.Ticker.prototype=new _.events.EventDispatcher,a.constructor=_.Ticker;var R=v("core.Animation",function(t,e){if(this.vars=e=e||{},this._duration=this._totalDuration=t||0,this._delay=Number(e.delay)||0,this._timeScale=1,this._active=e.immediateRender===!0,this.data=e.data,this._reversed=e.reversed===!0,Z){l||o.wake();var i=this.vars.useFrames?W:Z;i.add(this,i._time),this.vars.paused&&this.paused(!0)}});o=R.ticker=new _.Ticker,a=R.prototype,a._dirty=a._gc=a._initted=a._paused=!1,a._totalTime=a._time=0,a._rawPrevTime=-1,a._next=a._last=a._onUpdate=a._timeline=a.timeline=null,a._paused=!1;var A=function(){l&&k()-S>2e3&&o.wake(),setTimeout(A,2e3)};A(),a.play=function(t,e){return null!=t&&this.seek(t,e),this.reversed(!1).paused(!1)},a.pause=function(t,e){return null!=t&&this.seek(t,e),this.paused(!0)},a.resume=function(t,e){return null!=t&&this.seek(t,e),this.paused(!1)},a.seek=function(t,e){return this.totalTime(Number(t),e!==!1)},a.restart=function(t,e){return this.reversed(!1).paused(!1).totalTime(t?-this._delay:0,e!==!1,!0)},a.reverse=function(t,e){return null!=t&&this.seek(t||this.totalDuration(),e),this.reversed(!0).paused(!1)},a.render=function(){},a.invalidate=function(){return this._time=this._totalTime=0,this._initted=this._gc=!1,this._rawPrevTime=-1,(this._gc||!this.timeline)&&this._enabled(!0),this},a.isActive=function(){var t,e=this._timeline,i=this._startTime;return!e||!this._gc&&!this._paused&&e.isActive()&&(t=e.rawTime())>=i&&t<i+this.totalDuration()/this._timeScale},a._enabled=function(t,e){return l||o.wake(),this._gc=!t,this._active=this.isActive(),e!==!0&&(t&&!this.timeline?this._timeline.add(this,this._startTime-this._delay):!t&&this.timeline&&this._timeline._remove(this,!0)),!1},a._kill=function(){return this._enabled(!1,!1)},a.kill=function(t,e){return this._kill(t,e),this},a._uncache=function(t){for(var e=t?this:this.timeline;e;)e._dirty=!0,e=e.timeline;return this},a._swapSelfInParams=function(t){for(var e=t.length,i=t.concat();--e>-1;)"{self}"===t[e]&&(i[e]=this);return i},a._callback=function(t){var e=this.vars,i=e[t],s=e[t+"Params"],r=e[t+"Scope"]||e.callbackScope||this,n=s?s.length:0;switch(n){case 0:i.call(r);break;case 1:i.call(r,s[0]);break;case 2:i.call(r,s[0],s[1]);break;default:i.apply(r,s)}},a.eventCallback=function(t,e,i,s){if("on"===(t||"").substr(0,2)){var r=this.vars;if(1===arguments.length)return r[t];null==e?delete r[t]:(r[t]=e,r[t+"Params"]=p(i)&&-1!==i.join("").indexOf("{self}")?this._swapSelfInParams(i):i,r[t+"Scope"]=s),"onUpdate"===t&&(this._onUpdate=e)}return this},a.delay=function(t){return arguments.length?(this._timeline.smoothChildTiming&&this.startTime(this._startTime+t-this._delay),this._delay=t,this):this._delay},a.duration=function(t){return arguments.length?(this._duration=this._totalDuration=t,this._uncache(!0),this._timeline.smoothChildTiming&&this._time>0&&this._time<this._duration&&0!==t&&this.totalTime(this._totalTime*(t/this._duration),!0),this):(this._dirty=!1,this._duration)},a.totalDuration=function(t){return this._dirty=!1,arguments.length?this.duration(t):this._totalDuration},a.time=function(t,e){return arguments.length?(this._dirty&&this.totalDuration(),this.totalTime(t>this._duration?this._duration:t,e)):this._time},a.totalTime=function(t,e,i){if(l||o.wake(),!arguments.length)return this._totalTime;if(this._timeline){if(0>t&&!i&&(t+=this.totalDuration()),this._timeline.smoothChildTiming){this._dirty&&this.totalDuration();var s=this._totalDuration,r=this._timeline;if(t>s&&!i&&(t=s),this._startTime=(this._paused?this._pauseTime:r._time)-(this._reversed?s-t:t)/this._timeScale,r._dirty||this._uncache(!1),r._timeline)for(;r._timeline;)r._timeline._time!==(r._startTime+r._totalTime)/r._timeScale&&r.totalTime(r._totalTime,!0),r=r._timeline}this._gc&&this._enabled(!0,!1),(this._totalTime!==t||0===this._duration)&&(z.length&&$(),this.render(t,e,!1),z.length&&$())}return this},a.progress=a.totalProgress=function(t,e){var i=this.duration();return arguments.length?this.totalTime(i*t,e):i?this._time/i:this.ratio},a.startTime=function(t){return arguments.length?(t!==this._startTime&&(this._startTime=t,this.timeline&&this.timeline._sortChildren&&this.timeline.add(this,t-this._delay)),this):this._startTime},a.endTime=function(t){return this._startTime+(0!=t?this.totalDuration():this.duration())/this._timeScale},a.timeScale=function(t){if(!arguments.length)return this._timeScale;if(t=t||u,this._timeline&&this._timeline.smoothChildTiming){var e=this._pauseTime,i=e||0===e?e:this._timeline.totalTime();this._startTime=i-(i-this._startTime)*this._timeScale/t}return this._timeScale=t,this._uncache(!1)},a.reversed=function(t){return arguments.length?(t!=this._reversed&&(this._reversed=t,this.totalTime(this._timeline&&!this._timeline.smoothChildTiming?this.totalDuration()-this._totalTime:this._totalTime,!0)),this):this._reversed},a.paused=function(t){if(!arguments.length)return this._paused;var e,i,s=this._timeline;return t!=this._paused&&s&&(l||t||o.wake(),e=s.rawTime(),i=e-this._pauseTime,!t&&s.smoothChildTiming&&(this._startTime+=i,this._uncache(!1)),this._pauseTime=t?e:null,this._paused=t,this._active=this.isActive(),!t&&0!==i&&this._initted&&this.duration()&&(e=s.smoothChildTiming?this._totalTime:(e-this._startTime)/this._timeScale,this.render(e,e===this._totalTime,!0))),this._gc&&!t&&this._enabled(!0,!1),this};var C=v("core.SimpleTimeline",function(t){R.call(this,0,t),this.autoRemoveChildren=this.smoothChildTiming=!0});a=C.prototype=new R,a.constructor=C,a.kill()._gc=!1,a._first=a._last=a._recent=null,a._sortChildren=!1,a.add=a.insert=function(t,e){var i,s;if(t._startTime=Number(e||0)+t._delay,t._paused&&this!==t._timeline&&(t._pauseTime=t._startTime+(this.rawTime()-t._startTime)/t._timeScale),t.timeline&&t.timeline._remove(t,!0),t.timeline=t._timeline=this,t._gc&&t._enabled(!0,!0),i=this._last,this._sortChildren)for(s=t._startTime;i&&i._startTime>s;)i=i._prev;return i?(t._next=i._next,i._next=t):(t._next=this._first,this._first=t),t._next?t._next._prev=t:this._last=t,t._prev=i,this._recent=t,this._timeline&&this._uncache(!0),this},a._remove=function(t,e){return t.timeline===this&&(e||t._enabled(!1,!0),t._prev?t._prev._next=t._next:this._first===t&&(this._first=t._next),t._next?t._next._prev=t._prev:this._last===t&&(this._last=t._prev),t._next=t._prev=t.timeline=null,t===this._recent&&(this._recent=this._last),this._timeline&&this._uncache(!0)),this},a.render=function(t,e,i){var s,r=this._first;for(this._totalTime=this._time=this._rawPrevTime=t;r;)s=r._next,(r._active||t>=r._startTime&&!r._paused)&&(r._reversed?r.render((r._dirty?r.totalDuration():r._totalDuration)-(t-r._startTime)*r._timeScale,e,i):r.render((t-r._startTime)*r._timeScale,e,i)),r=s},a.rawTime=function(){return l||o.wake(),this._totalTime};var D=v("TweenLite",function(e,i,s){if(R.call(this,i,s),this.render=D.prototype.render,null==e)throw"Cannot tween a null target.";this.target=e="string"!=typeof e?e:D.selector(e)||e;var r,n,a,o=e.jquery||e.length&&e!==t&&e[0]&&(e[0]===t||e[0].nodeType&&e[0].style&&!e.nodeType),l=this.vars.overwrite;if(this._overwrite=l=null==l?q[D.defaultOverwrite]:"number"==typeof l?l>>0:q[l],(o||e instanceof Array||e.push&&p(e))&&"number"!=typeof e[0])for(this._targets=a=f(e),this._propLookup=[],this._siblings=[],r=0;r<a.length;r++)n=a[r],n?"string"!=typeof n?n.length&&n!==t&&n[0]&&(n[0]===t||n[0].nodeType&&n[0].style&&!n.nodeType)?(a.splice(r--,1),this._targets=a=a.concat(f(n))):(this._siblings[r]=Q(n,this,!1),1===l&&this._siblings[r].length>1&&K(n,this,null,1,this._siblings[r])):(n=a[r--]=D.selector(n),"string"==typeof n&&a.splice(r+1,1)):a.splice(r--,1);else this._propLookup={},this._siblings=Q(e,this,!1),1===l&&this._siblings.length>1&&K(e,this,null,1,this._siblings);(this.vars.immediateRender||0===i&&0===this._delay&&this.vars.immediateRender!==!1)&&(this._time=-u,this.render(Math.min(0,-this._delay)))},!0),M=function(e){return e&&e.length&&e!==t&&e[0]&&(e[0]===t||e[0].nodeType&&e[0].style&&!e.nodeType)},F=function(t,e){var i,s={};for(i in t)V[i]||i in e&&"transform"!==i&&"x"!==i&&"y"!==i&&"width"!==i&&"height"!==i&&"className"!==i&&"border"!==i||!(!B[i]||B[i]&&B[i]._autoCSS)||(s[i]=t[i],delete t[i]);t.css=s};a=D.prototype=new R,a.constructor=D,a.kill()._gc=!1,a.ratio=0,a._firstPT=a._targets=a._overwrittenProps=a._startAt=null,a._notifyPluginsOfEnabled=a._lazy=!1,D.version="1.19.0",D.defaultEase=a._ease=new T(null,null,1,1),D.defaultOverwrite="auto",D.ticker=o,D.autoSleep=120,D.lagSmoothing=function(t,e){o.lagSmoothing(t,e)},D.selector=t.$||t.jQuery||function(e){var i=t.$||t.jQuery;return i?(D.selector=i,i(e)):"undefined"==typeof document?e:document.querySelectorAll?document.querySelectorAll(e):document.getElementById("#"===e.charAt(0)?e.substr(1):e)};var z=[],X={},I=/(?:(-|-=|\+=)?\d*\.?\d*(?:e[\-+]?\d+)?)[0-9]/gi,N=function(t){for(var e,i=this._firstPT,s=1e-6;i;)e=i.blob?t?this.join(""):this.start:i.c*t+i.s,i.m?e=i.m(e,this._target||i.t):s>e&&e>-s&&(e=0),i.f?i.fp?i.t[i.p](i.fp,e):i.t[i.p](e):i.t[i.p]=e,i=i._next
},L=function(t,e,i,s){var r,n,a,o,l,h,_,u=[t,e],f=0,c="",p=0;for(u.start=t,i&&(i(u),t=u[0],e=u[1]),u.length=0,r=t.match(I)||[],n=e.match(I)||[],s&&(s._next=null,s.blob=1,u._firstPT=u._applyPT=s),l=n.length,o=0;l>o;o++)_=n[o],h=e.substr(f,e.indexOf(_,f)-f),c+=h||!o?h:",",f+=h.length,p?p=(p+1)%5:"rgba("===h.substr(-5)&&(p=1),_===r[o]||r.length<=o?c+=_:(c&&(u.push(c),c=""),a=parseFloat(r[o]),u.push(a),u._firstPT={_next:u._firstPT,t:u,p:u.length-1,s:a,c:("="===_.charAt(1)?parseInt(_.charAt(0)+"1",10)*parseFloat(_.substr(2)):parseFloat(_)-a)||0,f:0,m:p&&4>p?Math.round:0}),f+=_.length;return c+=e.substr(f),c&&u.push(c),u.setRatio=N,u},E=function(t,e,i,s,r,n,a,o,l){"function"==typeof s&&(s=s(l||0,t));var h,_,u="get"===i?t[e]:i,f=typeof t[e],c="string"==typeof s&&"="===s.charAt(1),p={t:t,p:e,s:u,f:"function"===f,pg:0,n:r||e,m:n?"function"==typeof n?n:Math.round:0,pr:0,c:c?parseInt(s.charAt(0)+"1",10)*parseFloat(s.substr(2)):parseFloat(s)-u||0};return"number"!==f&&("function"===f&&"get"===i&&(_=e.indexOf("set")||"function"!=typeof t["get"+e.substr(3)]?e:"get"+e.substr(3),p.s=u=a?t[_](a):t[_]()),"string"==typeof u&&(a||isNaN(u))?(p.fp=a,h=L(u,s,o||D.defaultStringFilter,p),p={t:h,p:"setRatio",s:0,c:1,f:2,pg:0,n:r||e,pr:0,m:0}):c||(p.s=parseFloat(u),p.c=parseFloat(s)-p.s||0)),p.c?((p._next=this._firstPT)&&(p._next._prev=p),this._firstPT=p,p):void 0},Y=D._internals={isArray:p,isSelector:M,lazyTweens:z,blobDif:L},B=D._plugins={},j=Y.tweenLookup={},U=0,V=Y.reservedProps={ease:1,delay:1,overwrite:1,onComplete:1,onCompleteParams:1,onCompleteScope:1,useFrames:1,runBackwards:1,startAt:1,onUpdate:1,onUpdateParams:1,onUpdateScope:1,onStart:1,onStartParams:1,onStartScope:1,onReverseComplete:1,onReverseCompleteParams:1,onReverseCompleteScope:1,onRepeat:1,onRepeatParams:1,onRepeatScope:1,easeParams:1,yoyo:1,immediateRender:1,repeat:1,repeatDelay:1,data:1,paused:1,reversed:1,autoCSS:1,lazy:1,onOverwrite:1,callbackScope:1,stringFilter:1,id:1},q={none:0,all:1,auto:2,concurrent:3,allOnStart:4,preexisting:5,"true":1,"false":0},W=R._rootFramesTimeline=new C,Z=R._rootTimeline=new C,G=30,$=Y.lazyRender=function(){var t,e=z.length;for(X={};--e>-1;)t=z[e],t&&t._lazy!==!1&&(t.render(t._lazy[0],t._lazy[1],!0),t._lazy=!1);z.length=0};Z._startTime=o.time,W._startTime=o.frame,Z._active=W._active=!0,setTimeout($,1),R._updateRoot=D.render=function(){var t,e,i;if(z.length&&$(),Z.render((o.time-Z._startTime)*Z._timeScale,!1,!1),W.render((o.frame-W._startTime)*W._timeScale,!1,!1),z.length&&$(),o.frame>=G){G=o.frame+(parseInt(D.autoSleep,10)||120);for(i in j){for(e=j[i].tweens,t=e.length;--t>-1;)e[t]._gc&&e.splice(t,1);0===e.length&&delete j[i]}if(i=Z._first,(!i||i._paused)&&D.autoSleep&&!W._first&&1===o._listeners.tick.length){for(;i&&i._paused;)i=i._next;i||o.sleep()}}},o.addEventListener("tick",R._updateRoot);var Q=function(t,e,i){var s,r,n=t._gsTweenID;if(j[n||(t._gsTweenID=n="t"+U++)]||(j[n]={target:t,tweens:[]}),e&&(s=j[n].tweens,s[r=s.length]=e,i))for(;--r>-1;)s[r]===e&&s.splice(r,1);return j[n].tweens},H=function(t,e,i,s){var r,n,a=t.vars.onOverwrite;return a&&(r=a(t,e,i,s)),a=D.onOverwrite,a&&(n=a(t,e,i,s)),r!==!1&&n!==!1},K=function(t,e,i,s,r){var n,a,o,l;if(1===s||s>=4){for(l=r.length,n=0;l>n;n++)if((o=r[n])!==e)o._gc||o._kill(null,t,e)&&(a=!0);else if(5===s)break;return a}var h,_=e._startTime+u,f=[],c=0,p=0===e._duration;for(n=r.length;--n>-1;)(o=r[n])===e||o._gc||o._paused||(o._timeline!==e._timeline?(h=h||J(e,0,p),0===J(o,h,p)&&(f[c++]=o)):o._startTime<=_&&o._startTime+o.totalDuration()/o._timeScale>_&&((p||!o._initted)&&_-o._startTime<=2e-10||(f[c++]=o)));for(n=c;--n>-1;)if(o=f[n],2===s&&o._kill(i,t,e)&&(a=!0),2!==s||!o._firstPT&&o._initted){if(2!==s&&!H(o,e))continue;o._enabled(!1,!1)&&(a=!0)}return a},J=function(t,e,i){for(var s=t._timeline,r=s._timeScale,n=t._startTime;s._timeline;){if(n+=s._startTime,r*=s._timeScale,s._paused)return-100;s=s._timeline}return n/=r,n>e?n-e:i&&n===e||!t._initted&&2*u>n-e?u:(n+=t.totalDuration()/t._timeScale/r)>e+u?0:n-e-u};a._init=function(){var t,e,i,s,r,n,a=this.vars,o=this._overwrittenProps,l=this._duration,h=!!a.immediateRender,_=a.ease;if(a.startAt){this._startAt&&(this._startAt.render(-1,!0),this._startAt.kill()),r={};for(s in a.startAt)r[s]=a.startAt[s];if(r.overwrite=!1,r.immediateRender=!0,r.lazy=h&&a.lazy!==!1,r.startAt=r.delay=null,this._startAt=D.to(this.target,0,r),h)if(this._time>0)this._startAt=null;else if(0!==l)return}else if(a.runBackwards&&0!==l)if(this._startAt)this._startAt.render(-1,!0),this._startAt.kill(),this._startAt=null;else{0!==this._time&&(h=!1),i={};for(s in a)V[s]&&"autoCSS"!==s||(i[s]=a[s]);if(i.overwrite=0,i.data="isFromStart",i.lazy=h&&a.lazy!==!1,i.immediateRender=h,this._startAt=D.to(this.target,0,i),h){if(0===this._time)return}else this._startAt._init(),this._startAt._enabled(!1),this.vars.immediateRender&&(this._startAt=null)}if(this._ease=_=_?_ instanceof T?_:"function"==typeof _?new T(_,a.easeParams):x[_]||D.defaultEase:D.defaultEase,a.easeParams instanceof Array&&_.config&&(this._ease=_.config.apply(_,a.easeParams)),this._easeType=this._ease._type,this._easePower=this._ease._power,this._firstPT=null,this._targets)for(n=this._targets.length,t=0;n>t;t++)this._initProps(this._targets[t],this._propLookup[t]={},this._siblings[t],o?o[t]:null,t)&&(e=!0);else e=this._initProps(this.target,this._propLookup,this._siblings,o,0);if(e&&D._onPluginEvent("_onInitAllProps",this),o&&(this._firstPT||"function"!=typeof this.target&&this._enabled(!1,!1)),a.runBackwards)for(i=this._firstPT;i;)i.s+=i.c,i.c=-i.c,i=i._next;this._onUpdate=a.onUpdate,this._initted=!0},a._initProps=function(e,i,s,r,n){var a,o,l,h,_,u;if(null==e)return!1;X[e._gsTweenID]&&$(),this.vars.css||e.style&&e!==t&&e.nodeType&&B.css&&this.vars.autoCSS!==!1&&F(this.vars,e);for(a in this.vars)if(u=this.vars[a],V[a])u&&(u instanceof Array||u.push&&p(u))&&-1!==u.join("").indexOf("{self}")&&(this.vars[a]=u=this._swapSelfInParams(u,this));else if(B[a]&&(h=new B[a])._onInitTween(e,this.vars[a],this,n)){for(this._firstPT=_={_next:this._firstPT,t:h,p:"setRatio",s:0,c:1,f:1,n:a,pg:1,pr:h._priority,m:0},o=h._overwriteProps.length;--o>-1;)i[h._overwriteProps[o]]=this._firstPT;(h._priority||h._onInitAllProps)&&(l=!0),(h._onDisable||h._onEnable)&&(this._notifyPluginsOfEnabled=!0),_._next&&(_._next._prev=_)}else i[a]=E.call(this,e,a,"get",u,a,0,null,this.vars.stringFilter,n);return r&&this._kill(r,e)?this._initProps(e,i,s,r,n):this._overwrite>1&&this._firstPT&&s.length>1&&K(e,this,i,this._overwrite,s)?(this._kill(i,e),this._initProps(e,i,s,r,n)):(this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration)&&(X[e._gsTweenID]=!0),l)},a.render=function(t,e,i){var s,r,n,a,o=this._time,l=this._duration,h=this._rawPrevTime;if(t>=l-1e-7)this._totalTime=this._time=l,this.ratio=this._ease._calcEnd?this._ease.getRatio(1):1,this._reversed||(s=!0,r="onComplete",i=i||this._timeline.autoRemoveChildren),0===l&&(this._initted||!this.vars.lazy||i)&&(this._startTime===this._timeline._duration&&(t=0),(0>h||0>=t&&t>=-1e-7||h===u&&"isPause"!==this.data)&&h!==t&&(i=!0,h>u&&(r="onReverseComplete")),this._rawPrevTime=a=!e||t||h===t?t:u);else if(1e-7>t)this._totalTime=this._time=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0,(0!==o||0===l&&h>0)&&(r="onReverseComplete",s=this._reversed),0>t&&(this._active=!1,0===l&&(this._initted||!this.vars.lazy||i)&&(h>=0&&(h!==u||"isPause"!==this.data)&&(i=!0),this._rawPrevTime=a=!e||t||h===t?t:u)),this._initted||(i=!0);else if(this._totalTime=this._time=t,this._easeType){var _=t/l,f=this._easeType,c=this._easePower;(1===f||3===f&&_>=.5)&&(_=1-_),3===f&&(_*=2),1===c?_*=_:2===c?_*=_*_:3===c?_*=_*_*_:4===c&&(_*=_*_*_*_),this.ratio=1===f?1-_:2===f?_:.5>t/l?_/2:1-_/2}else this.ratio=this._ease.getRatio(t/l);if(this._time!==o||i){if(!this._initted){if(this._init(),!this._initted||this._gc)return;if(!i&&this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration))return this._time=this._totalTime=o,this._rawPrevTime=h,z.push(this),void(this._lazy=[t,e]);this._time&&!s?this.ratio=this._ease.getRatio(this._time/l):s&&this._ease._calcEnd&&(this.ratio=this._ease.getRatio(0===this._time?0:1))}for(this._lazy!==!1&&(this._lazy=!1),this._active||!this._paused&&this._time!==o&&t>=0&&(this._active=!0),0===o&&(this._startAt&&(t>=0?this._startAt.render(t,e,i):r||(r="_dummyGS")),this.vars.onStart&&(0!==this._time||0===l)&&(e||this._callback("onStart"))),n=this._firstPT;n;)n.f?n.t[n.p](n.c*this.ratio+n.s):n.t[n.p]=n.c*this.ratio+n.s,n=n._next;this._onUpdate&&(0>t&&this._startAt&&t!==-1e-4&&this._startAt.render(t,e,i),e||(this._time!==o||s||i)&&this._callback("onUpdate")),r&&(!this._gc||i)&&(0>t&&this._startAt&&!this._onUpdate&&t!==-1e-4&&this._startAt.render(t,e,i),s&&(this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!e&&this.vars[r]&&this._callback(r),0===l&&this._rawPrevTime===u&&a!==u&&(this._rawPrevTime=0))}},a._kill=function(t,e,i){if("all"===t&&(t=null),null==t&&(null==e||e===this.target))return this._lazy=!1,this._enabled(!1,!1);e="string"!=typeof e?e||this._targets||this.target:D.selector(e)||e;var s,r,n,a,o,l,h,_,u,f=i&&this._time&&i._startTime===this._startTime&&this._timeline===i._timeline;if((p(e)||M(e))&&"number"!=typeof e[0])for(s=e.length;--s>-1;)this._kill(t,e[s],i)&&(l=!0);else{if(this._targets){for(s=this._targets.length;--s>-1;)if(e===this._targets[s]){o=this._propLookup[s]||{},this._overwrittenProps=this._overwrittenProps||[],r=this._overwrittenProps[s]=t?this._overwrittenProps[s]||{}:"all";break}}else{if(e!==this.target)return!1;o=this._propLookup,r=this._overwrittenProps=t?this._overwrittenProps||{}:"all"}if(o){if(h=t||o,_=t!==r&&"all"!==r&&t!==o&&("object"!=typeof t||!t._tempKill),i&&(D.onOverwrite||this.vars.onOverwrite)){for(n in h)o[n]&&(u||(u=[]),u.push(n));if((u||!t)&&!H(this,i,e,u))return!1}for(n in h)(a=o[n])&&(f&&(a.f?a.t[a.p](a.s):a.t[a.p]=a.s,l=!0),a.pg&&a.t._kill(h)&&(l=!0),a.pg&&0!==a.t._overwriteProps.length||(a._prev?a._prev._next=a._next:a===this._firstPT&&(this._firstPT=a._next),a._next&&(a._next._prev=a._prev),a._next=a._prev=null),delete o[n]),_&&(r[n]=1);!this._firstPT&&this._initted&&this._enabled(!1,!1)}}return l},a.invalidate=function(){return this._notifyPluginsOfEnabled&&D._onPluginEvent("_onDisable",this),this._firstPT=this._overwrittenProps=this._startAt=this._onUpdate=null,this._notifyPluginsOfEnabled=this._active=this._lazy=!1,this._propLookup=this._targets?{}:[],R.prototype.invalidate.call(this),this.vars.immediateRender&&(this._time=-u,this.render(Math.min(0,-this._delay))),this},a._enabled=function(t,e){if(l||o.wake(),t&&this._gc){var i,s=this._targets;if(s)for(i=s.length;--i>-1;)this._siblings[i]=Q(s[i],this,!0);else this._siblings=Q(this.target,this,!0)}return R.prototype._enabled.call(this,t,e),this._notifyPluginsOfEnabled&&this._firstPT?D._onPluginEvent(t?"_onEnable":"_onDisable",this):!1},D.to=function(t,e,i){return new D(t,e,i)},D.from=function(t,e,i){return i.runBackwards=!0,i.immediateRender=0!=i.immediateRender,new D(t,e,i)},D.fromTo=function(t,e,i,s){return s.startAt=i,s.immediateRender=0!=s.immediateRender&&0!=i.immediateRender,new D(t,e,s)},D.delayedCall=function(t,e,i,s,r){return new D(e,0,{delay:t,onComplete:e,onCompleteParams:i,callbackScope:s,onReverseComplete:e,onReverseCompleteParams:i,immediateRender:!1,lazy:!1,useFrames:r,overwrite:0})},D.set=function(t,e){return new D(t,0,e)},D.getTweensOf=function(t,e){if(null==t)return[];t="string"!=typeof t?t:D.selector(t)||t;var i,s,r,n;if((p(t)||M(t))&&"number"!=typeof t[0]){for(i=t.length,s=[];--i>-1;)s=s.concat(D.getTweensOf(t[i],e));for(i=s.length;--i>-1;)for(n=s[i],r=i;--r>-1;)n===s[r]&&s.splice(i,1)}else for(s=Q(t).concat(),i=s.length;--i>-1;)(s[i]._gc||e&&!s[i].isActive())&&s.splice(i,1);return s},D.killTweensOf=D.killDelayedCallsTo=function(t,e,i){"object"==typeof e&&(i=e,e=!1);for(var s=D.getTweensOf(t,e),r=s.length;--r>-1;)s[r]._kill(i,t)};var te=v("plugins.TweenPlugin",function(t,e){this._overwriteProps=(t||"").split(","),this._propName=this._overwriteProps[0],this._priority=e||0,this._super=te.prototype},!0);if(a=te.prototype,te.version="1.19.0",te.API=2,a._firstPT=null,a._addTween=E,a.setRatio=N,a._kill=function(t){var e,i=this._overwriteProps,s=this._firstPT;if(null!=t[this._propName])this._overwriteProps=[];else for(e=i.length;--e>-1;)null!=t[i[e]]&&i.splice(e,1);for(;s;)null!=t[s.n]&&(s._next&&(s._next._prev=s._prev),s._prev?(s._prev._next=s._next,s._prev=null):this._firstPT===s&&(this._firstPT=s._next)),s=s._next;return!1},a._mod=a._roundProps=function(t){for(var e,i=this._firstPT;i;)e=t[this._propName]||null!=i.n&&t[i.n.split(this._propName+"_").join("")],e&&"function"==typeof e&&(2===i.f?i.t._applyPT.m=e:i.m=e),i=i._next},D._onPluginEvent=function(t,e){var i,s,r,n,a,o=e._firstPT;if("_onInitAllProps"===t){for(;o;){for(a=o._next,s=r;s&&s.pr>o.pr;)s=s._next;(o._prev=s?s._prev:n)?o._prev._next=o:r=o,(o._next=s)?s._prev=o:n=o,o=a}o=e._firstPT=r}for(;o;)o.pg&&"function"==typeof o.t[t]&&o.t[t]()&&(i=!0),o=o._next;return i},te.activate=function(t){for(var e=t.length;--e>-1;)t[e].API===te.API&&(B[(new t[e])._propName]=t[e]);return!0},g.plugin=function(t){if(!(t&&t.propName&&t.init&&t.API))throw"illegal plugin definition.";var e,i=t.propName,s=t.priority||0,r=t.overwriteProps,n={init:"_onInitTween",set:"setRatio",kill:"_kill",round:"_mod",mod:"_mod",initAll:"_onInitAllProps"},a=v("plugins."+i.charAt(0).toUpperCase()+i.substr(1)+"Plugin",function(){te.call(this,i,s),this._overwriteProps=r||[]},t.global===!0),o=a.prototype=new te(i);o.constructor=a,a.API=t.API;for(e in n)"function"==typeof t[e]&&(o[n[e]]=t[e]);return a.version=t.version,te.activate([a]),a},r=t._gsQueue){for(n=0;n<r.length;n++)r[n]();for(a in m)m[a].func||t.console.log("GSAP encountered missing dependency: "+a)}l=!1}}("undefined"!=typeof module&&module.exports&&"undefined"!=typeof global?global:this||window,"TweenMax");
;/*!libs/libs/static/physics/p2.js*/
!function(t){if("object"==typeof exports)module.exports=t();else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.p2=t()}}(function(){return function t(e,o,i){function n(a,s){if(!o[a]){if(!e[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(r)return r(a,!0);throw new Error("Cannot find module '"+a+"'")}var h=o[a]={exports:{}};e[a][0].call(h.exports,function(t){var o=e[a][1][t];return n(o?o:t)},h,h.exports,t,e,o,i)}return o[a].exports}for(var r="function"==typeof require&&require,a=0;a<i.length;a++)n(i[a]);return n}({1:[function(t,e){function o(){}var i=t("./Scalar");e.exports=o,o.lineInt=function(t,e,o){o=o||0;var n,r,a,s,c,h,l,p=[0,0];return n=t[1][1]-t[0][1],r=t[0][0]-t[1][0],a=n*t[0][0]+r*t[0][1],s=e[1][1]-e[0][1],c=e[0][0]-e[1][0],h=s*e[0][0]+c*e[0][1],l=n*c-s*r,i.eq(l,0,o)||(p[0]=(c*a-r*h)/l,p[1]=(n*h-s*a)/l),p},o.segmentsIntersect=function(t,e,o,i){var n=e[0]-t[0],r=e[1]-t[1],a=i[0]-o[0],s=i[1]-o[1];if(a*r-s*n==0)return!1;var c=(n*(o[1]-t[1])+r*(t[0]-o[0]))/(a*r-s*n),h=(a*(t[1]-o[1])+s*(o[0]-t[0]))/(s*n-a*r);return c>=0&&1>=c&&h>=0&&1>=h}},{"./Scalar":4}],2:[function(t,e){function o(){}e.exports=o,o.area=function(t,e,o){return(e[0]-t[0])*(o[1]-t[1])-(o[0]-t[0])*(e[1]-t[1])},o.left=function(t,e,i){return o.area(t,e,i)>0},o.leftOn=function(t,e,i){return o.area(t,e,i)>=0},o.right=function(t,e,i){return o.area(t,e,i)<0},o.rightOn=function(t,e,i){return o.area(t,e,i)<=0};var i=[],n=[];o.collinear=function(t,e,r,a){if(a){var s=i,c=n;s[0]=e[0]-t[0],s[1]=e[1]-t[1],c[0]=r[0]-e[0],c[1]=r[1]-e[1];var h=s[0]*c[0]+s[1]*c[1],l=Math.sqrt(s[0]*s[0]+s[1]*s[1]),p=Math.sqrt(c[0]*c[0]+c[1]*c[1]),u=Math.acos(h/(l*p));return a>u}return 0==o.area(t,e,r)},o.sqdist=function(t,e){var o=e[0]-t[0],i=e[1]-t[1];return o*o+i*i}},{}],3:[function(t,e){function o(){this.vertices=[]}function i(t,e,o,i,n){n=n||0;var r=e[1]-t[1],s=t[0]-e[0],c=r*t[0]+s*t[1],h=i[1]-o[1],l=o[0]-i[0],p=h*o[0]+l*o[1],u=r*l-h*s;return a.eq(u,0,n)?[0,0]:[(l*c-s*p)/u,(r*p-h*c)/u]}var n=t("./Line"),r=t("./Point"),a=t("./Scalar");e.exports=o,o.prototype.at=function(t){var e=this.vertices,o=e.length;return e[0>t?t%o+o:t%o]},o.prototype.first=function(){return this.vertices[0]},o.prototype.last=function(){return this.vertices[this.vertices.length-1]},o.prototype.clear=function(){this.vertices.length=0},o.prototype.append=function(t,e,o){if("undefined"==typeof e)throw new Error("From is not given!");if("undefined"==typeof o)throw new Error("To is not given!");if(e>o-1)throw new Error("lol1");if(o>t.vertices.length)throw new Error("lol2");if(0>e)throw new Error("lol3");for(var i=e;o>i;i++)this.vertices.push(t.vertices[i])},o.prototype.makeCCW=function(){for(var t=0,e=this.vertices,o=1;o<this.vertices.length;++o)(e[o][1]<e[t][1]||e[o][1]==e[t][1]&&e[o][0]>e[t][0])&&(t=o);r.left(this.at(t-1),this.at(t),this.at(t+1))||this.reverse()},o.prototype.reverse=function(){for(var t=[],e=0,o=this.vertices.length;e!==o;e++)t.push(this.vertices.pop());this.vertices=t},o.prototype.isReflex=function(t){return r.right(this.at(t-1),this.at(t),this.at(t+1))};var s=[],c=[];o.prototype.canSee=function(t,e){var o,i,a=s,h=c;if(r.leftOn(this.at(t+1),this.at(t),this.at(e))&&r.rightOn(this.at(t-1),this.at(t),this.at(e)))return!1;i=r.sqdist(this.at(t),this.at(e));for(var l=0;l!==this.vertices.length;++l)if((l+1)%this.vertices.length!==t&&l!==t&&r.leftOn(this.at(t),this.at(e),this.at(l+1))&&r.rightOn(this.at(t),this.at(e),this.at(l))&&(a[0]=this.at(t),a[1]=this.at(e),h[0]=this.at(l),h[1]=this.at(l+1),o=n.lineInt(a,h),r.sqdist(this.at(t),o)<i))return!1;return!0},o.prototype.copy=function(t,e,i){var n=i||new o;if(n.clear(),e>t)for(var r=t;e>=r;r++)n.vertices.push(this.vertices[r]);else{for(var r=0;e>=r;r++)n.vertices.push(this.vertices[r]);for(var r=t;r<this.vertices.length;r++)n.vertices.push(this.vertices[r])}return n},o.prototype.getCutEdges=function(){for(var t=[],e=[],i=[],n=new o,r=Number.MAX_VALUE,a=0;a<this.vertices.length;++a)if(this.isReflex(a))for(var s=0;s<this.vertices.length;++s)if(this.canSee(a,s)){e=this.copy(a,s,n).getCutEdges(),i=this.copy(s,a,n).getCutEdges();for(var c=0;c<i.length;c++)e.push(i[c]);e.length<r&&(t=e,r=e.length,t.push([this.at(a),this.at(s)]))}return t},o.prototype.decomp=function(){var t=this.getCutEdges();return t.length>0?this.slice(t):[this]},o.prototype.slice=function(t){if(0==t.length)return[this];if(t instanceof Array&&t.length&&t[0]instanceof Array&&2==t[0].length&&t[0][0]instanceof Array){for(var e=[this],o=0;o<t.length;o++)for(var i=t[o],n=0;n<e.length;n++){var r=e[n],a=r.slice(i);if(a){e.splice(n,1),e.push(a[0],a[1]);break}}return e}var i=t,o=this.vertices.indexOf(i[0]),n=this.vertices.indexOf(i[1]);return-1!=o&&-1!=n?[this.copy(o,n),this.copy(n,o)]:!1},o.prototype.isSimple=function(){for(var t=this.vertices,e=0;e<t.length-1;e++)for(var o=0;e-1>o;o++)if(n.segmentsIntersect(t[e],t[e+1],t[o],t[o+1]))return!1;for(var e=1;e<t.length-2;e++)if(n.segmentsIntersect(t[0],t[t.length-1],t[e],t[e+1]))return!1;return!0},o.prototype.quickDecomp=function(t,e,n,a,s,c){s=s||100,c=c||0,a=a||25,t="undefined"!=typeof t?t:[],e=e||[],n=n||[];var h=[0,0],l=[0,0],p=[0,0],u=0,d=0,f=0,v=0,y=0,m=0,g=0,A=new o,b=new o,E=this,B=this.vertices;if(B.length<3)return t;if(c++,c>s)return console.warn("quickDecomp: max level ("+s+") reached."),t;for(var q=0;q<this.vertices.length;++q)if(E.isReflex(q)){e.push(E.vertices[q]),u=d=Number.MAX_VALUE;for(var P=0;P<this.vertices.length;++P)r.left(E.at(q-1),E.at(q),E.at(P))&&r.rightOn(E.at(q-1),E.at(q),E.at(P-1))&&(p=i(E.at(q-1),E.at(q),E.at(P),E.at(P-1)),r.right(E.at(q+1),E.at(q),p)&&(f=r.sqdist(E.vertices[q],p),d>f&&(d=f,l=p,m=P))),r.left(E.at(q+1),E.at(q),E.at(P+1))&&r.rightOn(E.at(q+1),E.at(q),E.at(P))&&(p=i(E.at(q+1),E.at(q),E.at(P),E.at(P+1)),r.left(E.at(q-1),E.at(q),p)&&(f=r.sqdist(E.vertices[q],p),u>f&&(u=f,h=p,y=P)));if(m==(y+1)%this.vertices.length)p[0]=(l[0]+h[0])/2,p[1]=(l[1]+h[1])/2,n.push(p),y>q?(A.append(E,q,y+1),A.vertices.push(p),b.vertices.push(p),0!=m&&b.append(E,m,E.vertices.length),b.append(E,0,q+1)):(0!=q&&A.append(E,q,E.vertices.length),A.append(E,0,y+1),A.vertices.push(p),b.vertices.push(p),b.append(E,m,q+1));else{if(m>y&&(y+=this.vertices.length),v=Number.MAX_VALUE,m>y)return t;for(var P=m;y>=P;++P)r.leftOn(E.at(q-1),E.at(q),E.at(P))&&r.rightOn(E.at(q+1),E.at(q),E.at(P))&&(f=r.sqdist(E.at(q),E.at(P)),v>f&&(v=f,g=P%this.vertices.length));g>q?(A.append(E,q,g+1),0!=g&&b.append(E,g,B.length),b.append(E,0,q+1)):(0!=q&&A.append(E,q,B.length),A.append(E,0,g+1),b.append(E,g,q+1))}return A.vertices.length<b.vertices.length?(A.quickDecomp(t,e,n,a,s,c),b.quickDecomp(t,e,n,a,s,c)):(b.quickDecomp(t,e,n,a,s,c),A.quickDecomp(t,e,n,a,s,c)),t}return t.push(this),t},o.prototype.removeCollinearPoints=function(t){for(var e=0,o=this.vertices.length-1;this.vertices.length>3&&o>=0;--o)r.collinear(this.at(o-1),this.at(o),this.at(o+1),t)&&(this.vertices.splice(o%this.vertices.length,1),o--,e++);return e}},{"./Line":1,"./Point":2,"./Scalar":4}],4:[function(t,e){function o(){}e.exports=o,o.eq=function(t,e,o){return o=o||0,Math.abs(t-e)<o}},{}],5:[function(t,e){e.exports={Polygon:t("./Polygon"),Point:t("./Point")}},{"./Point":2,"./Polygon":3}],6:[function(t,e){e.exports={name:"p2",version:"0.7.0",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"^0.4.5","grunt-contrib-jshint":"^0.11.2","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.0"}}},{}],7:[function(t,e){function o(t){this.lowerBound=i.create(),t&&t.lowerBound&&i.copy(this.lowerBound,t.lowerBound),this.upperBound=i.create(),t&&t.upperBound&&i.copy(this.upperBound,t.upperBound)}var i=t("../math/vec2");t("../utils/Utils"),e.exports=o;var n=i.create();o.prototype.setFromPoints=function(t,e,o,r){var a=this.lowerBound,s=this.upperBound;"number"!=typeof o&&(o=0),0!==o?i.rotate(a,t[0],o):i.copy(a,t[0]),i.copy(s,a);for(var c=Math.cos(o),h=Math.sin(o),l=1;l<t.length;l++){var p=t[l];if(0!==o){var u=p[0],d=p[1];n[0]=c*u-h*d,n[1]=h*u+c*d,p=n}for(var f=0;2>f;f++)p[f]>s[f]&&(s[f]=p[f]),p[f]<a[f]&&(a[f]=p[f])}e&&(i.add(this.lowerBound,this.lowerBound,e),i.add(this.upperBound,this.upperBound,e)),r&&(this.lowerBound[0]-=r,this.lowerBound[1]-=r,this.upperBound[0]+=r,this.upperBound[1]+=r)},o.prototype.copy=function(t){i.copy(this.lowerBound,t.lowerBound),i.copy(this.upperBound,t.upperBound)},o.prototype.extend=function(t){for(var e=2;e--;){var o=t.lowerBound[e];this.lowerBound[e]>o&&(this.lowerBound[e]=o);var i=t.upperBound[e];this.upperBound[e]<i&&(this.upperBound[e]=i)}},o.prototype.overlaps=function(t){var e=this.lowerBound,o=this.upperBound,i=t.lowerBound,n=t.upperBound;return(i[0]<=o[0]&&o[0]<=n[0]||e[0]<=n[0]&&n[0]<=o[0])&&(i[1]<=o[1]&&o[1]<=n[1]||e[1]<=n[1]&&n[1]<=o[1])},o.prototype.containsPoint=function(t){var e=this.lowerBound,o=this.upperBound;return e[0]<=t[0]&&t[0]<=o[0]&&e[1]<=t[1]&&t[1]<=o[1]},o.prototype.overlapsRay=function(t){var e=1/t.direction[0],o=1/t.direction[1],i=(this.lowerBound[0]-t.from[0])*e,n=(this.upperBound[0]-t.from[0])*e,r=(this.lowerBound[1]-t.from[1])*o,a=(this.upperBound[1]-t.from[1])*o,s=Math.max(Math.max(Math.min(i,n),Math.min(r,a))),c=Math.min(Math.min(Math.max(i,n),Math.max(r,a)));return 0>c?-1:s>c?-1:s}},{"../math/vec2":30,"../utils/Utils":57}],8:[function(t,e){function o(t){this.type=t,this.result=[],this.world=null,this.boundingVolumeType=o.AABB}var i=t("../math/vec2"),n=t("../objects/Body");e.exports=o,o.AABB=1,o.BOUNDING_CIRCLE=2,o.prototype.setWorld=function(t){this.world=t},o.prototype.getCollisionPairs=function(){};var r=i.create();o.boundingRadiusCheck=function(t,e){i.sub(r,t.position,e.position);var o=i.squaredLength(r),n=t.boundingRadius+e.boundingRadius;return n*n>=o},o.aabbCheck=function(t,e){return t.getAABB().overlaps(e.getAABB())},o.prototype.boundingVolumeCheck=function(t,e){var i;switch(this.boundingVolumeType){case o.BOUNDING_CIRCLE:i=o.boundingRadiusCheck(t,e);break;case o.AABB:i=o.aabbCheck(t,e);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return i},o.canCollide=function(t,e){var o=n.KINEMATIC,i=n.STATIC;return t.type===i&&e.type===i?!1:t.type===o&&e.type===i||t.type===i&&e.type===o?!1:t.type===o&&e.type===o?!1:t.sleepState===n.SLEEPING&&e.sleepState===n.SLEEPING?!1:t.sleepState===n.SLEEPING&&e.type===i||e.sleepState===n.SLEEPING&&t.type===i?!1:!0},o.NAIVE=1,o.SAP=2},{"../math/vec2":30,"../objects/Body":31}],9:[function(t,e){function o(){i.call(this,i.NAIVE)}var i=(t("../shapes/Circle"),t("../shapes/Plane"),t("../shapes/Shape"),t("../shapes/Particle"),t("../collision/Broadphase"));t("../math/vec2"),e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.getCollisionPairs=function(t){var e=t.bodies,o=this.result;o.length=0;for(var n=0,r=e.length;n!==r;n++)for(var a=e[n],s=0;n>s;s++){var c=e[s];i.canCollide(a,c)&&this.boundingVolumeCheck(a,c)&&o.push(a,c)}return o},o.prototype.aabbQuery=function(t,e,o){o=o||[];for(var i=t.bodies,n=0;n<i.length;n++){var r=i[n];r.aabbNeedsUpdate&&r.updateAABB(),r.aabb.overlaps(e)&&o.push(r)}return o}},{"../collision/Broadphase":8,"../math/vec2":30,"../shapes/Circle":39,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45}],10:[function(t,e){function o(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.enabledEquations=!0,this.slipForce=10,this.frictionCoefficient=.3,this.surfaceVelocity=0,this.contactEquationPool=new h({size:32}),this.frictionEquationPool=new l({size:64}),this.restitution=0,this.stiffness=u.DEFAULT_STIFFNESS,this.relaxation=u.DEFAULT_RELAXATION,this.frictionStiffness=u.DEFAULT_STIFFNESS,this.frictionRelaxation=u.DEFAULT_RELAXATION,this.enableFrictionReduction=!0,this.collidingBodiesLastStep=new p,this.contactSkinSize=.01}function i(t,e){r.set(t.vertices[0],.5*-e.length,-e.radius),r.set(t.vertices[1],.5*e.length,-e.radius),r.set(t.vertices[2],.5*e.length,e.radius),r.set(t.vertices[3],.5*-e.length,e.radius)}function n(t,e,o,i){for(var n=X,c=j,h=z,l=Y,p=t,u=e.vertices,d=null,f=0;f!==u.length+1;f++){var v=u[f%u.length],y=u[(f+1)%u.length];r.rotate(n,v,i),r.rotate(c,y,i),s(n,n,o),s(c,c,o),a(h,n,p),a(l,c,p);var m=r.crossLength(h,l);if(null===d&&(d=m),0>=m*d)return!1;d=m}return!0}var r=t("../math/vec2"),a=r.sub,s=r.add,c=r.dot,h=(t("../utils/Utils"),t("../utils/ContactEquationPool")),l=t("../utils/FrictionEquationPool"),p=t("../utils/TupleDictionary"),u=t("../equations/Equation"),d=(t("../equations/ContactEquation"),t("../equations/FrictionEquation"),t("../shapes/Circle")),f=t("../shapes/Convex"),v=t("../shapes/Shape"),y=(t("../objects/Body"),t("../shapes/Box"));e.exports=o;var m=r.fromValues(0,1),g=r.fromValues(0,0),A=r.fromValues(0,0),b=r.fromValues(0,0),E=r.fromValues(0,0),B=r.fromValues(0,0),q=r.fromValues(0,0),P=r.fromValues(0,0),w=r.fromValues(0,0),S=r.fromValues(0,0),C=r.fromValues(0,0),L=r.fromValues(0,0),x=r.fromValues(0,0),F=r.fromValues(0,0),M=r.fromValues(0,0),I=r.fromValues(0,0),R=r.fromValues(0,0),V=r.fromValues(0,0),T=r.fromValues(0,0),N=[],G=r.create(),O=r.create();o.prototype.bodiesOverlap=function(t,e){for(var o=G,i=O,n=0,r=t.shapes.length;n!==r;n++){var a=t.shapes[n];t.toWorldFrame(o,a.position);for(var s=0,c=e.shapes.length;s!==c;s++){var h=e.shapes[s];if(e.toWorldFrame(i,h.position),this[a.type|h.type](t,a,o,a.angle+t.angle,e,h,i,h.angle+e.angle,!0))return!0}}return!1},o.prototype.collidedLastStep=function(t,e){var o=0|t.id,i=0|e.id;return!!this.collidingBodiesLastStep.get(o,i)},o.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var t=this.contactEquations,e=t.length;e--;){var o=t[e],i=o.bodyA.id,n=o.bodyB.id;this.collidingBodiesLastStep.set(i,n,!0)}for(var r=this.contactEquations,a=this.frictionEquations,s=0;s<r.length;s++)this.contactEquationPool.release(r[s]);for(var s=0;s<a.length;s++)this.frictionEquationPool.release(a[s]);this.contactEquations.length=this.frictionEquations.length=0},o.prototype.createContactEquation=function(t,e,o,i){var n=this.contactEquationPool.get();return n.bodyA=t,n.bodyB=e,n.shapeA=o,n.shapeB=i,n.restitution=this.restitution,n.firstImpact=!this.collidedLastStep(t,e),n.stiffness=this.stiffness,n.relaxation=this.relaxation,n.needsUpdate=!0,n.enabled=this.enabledEquations,n.offset=this.contactSkinSize,n},o.prototype.createFrictionEquation=function(t,e,o,i){var n=this.frictionEquationPool.get();return n.bodyA=t,n.bodyB=e,n.shapeA=o,n.shapeB=i,n.setSlipForce(this.slipForce),n.frictionCoefficient=this.frictionCoefficient,n.relativeVelocity=this.surfaceVelocity,n.enabled=this.enabledEquations,n.needsUpdate=!0,n.stiffness=this.frictionStiffness,n.relaxation=this.frictionRelaxation,n.contactEquations.length=0,n},o.prototype.createFrictionFromContact=function(t){var e=this.createFrictionEquation(t.bodyA,t.bodyB,t.shapeA,t.shapeB);return r.copy(e.contactPointA,t.contactPointA),r.copy(e.contactPointB,t.contactPointB),r.rotate90cw(e.t,t.normalA),e.contactEquations.push(t),e},o.prototype.createFrictionFromAverage=function(t){var e=this.contactEquations[this.contactEquations.length-1],o=this.createFrictionEquation(e.bodyA,e.bodyB,e.shapeA,e.shapeB),i=e.bodyA;e.bodyB,r.set(o.contactPointA,0,0),r.set(o.contactPointB,0,0),r.set(o.t,0,0);for(var n=0;n!==t;n++)e=this.contactEquations[this.contactEquations.length-1-n],e.bodyA===i?(r.add(o.t,o.t,e.normalA),r.add(o.contactPointA,o.contactPointA,e.contactPointA),r.add(o.contactPointB,o.contactPointB,e.contactPointB)):(r.sub(o.t,o.t,e.normalA),r.add(o.contactPointA,o.contactPointA,e.contactPointB),r.add(o.contactPointB,o.contactPointB,e.contactPointA)),o.contactEquations.push(e);var a=1/t;return r.scale(o.contactPointA,o.contactPointA,a),r.scale(o.contactPointB,o.contactPointB,a),r.normalize(o.t,o.t),r.rotate90cw(o.t,o.t),o},o.prototype[v.LINE|v.CONVEX]=o.prototype.convexLine=function(t,e,o,i,n,r,a,s,c){return c?!1:0},o.prototype[v.LINE|v.BOX]=o.prototype.lineBox=function(t,e,o,i,n,r,a,s,c){return c?!1:0};var U=new y({width:1,height:1}),k=r.create();o.prototype[v.CAPSULE|v.CONVEX]=o.prototype[v.CAPSULE|v.BOX]=o.prototype.convexCapsule=function(t,e,o,n,a,s,c,h,l){var p=k;r.set(p,s.length/2,0),r.rotate(p,p,h),r.add(p,p,c);var u=this.circleConvex(a,s,p,h,t,e,o,n,l,s.radius);r.set(p,-s.length/2,0),r.rotate(p,p,h),r.add(p,p,c);var d=this.circleConvex(a,s,p,h,t,e,o,n,l,s.radius);if(l&&(u||d))return!0;var f=U;i(f,s);var v=this.convexConvex(t,e,o,n,a,f,c,h,l);return v+u+d},o.prototype[v.CAPSULE|v.LINE]=o.prototype.lineCapsule=function(t,e,o,i,n,r,a,s,c){return c?!1:0};var _=r.create(),D=r.create(),W=new y({width:1,height:1});o.prototype[v.CAPSULE|v.CAPSULE]=o.prototype.capsuleCapsule=function(t,e,o,n,a,s,c,h,l){for(var p,u=_,d=D,f=0,v=0;2>v;v++){r.set(u,(0===v?-1:1)*e.length/2,0),r.rotate(u,u,n),r.add(u,u,o);for(var y=0;2>y;y++){r.set(d,(0===y?-1:1)*s.length/2,0),r.rotate(d,d,h),r.add(d,d,c),this.enableFrictionReduction&&(p=this.enableFriction,this.enableFriction=!1);var m=this.circleCircle(t,e,u,n,a,s,d,h,l,e.radius,s.radius);if(this.enableFrictionReduction&&(this.enableFriction=p),l&&m)return!0;f+=m}}this.enableFrictionReduction&&(p=this.enableFriction,this.enableFriction=!1);var g=W;i(g,e);var A=this.convexCapsule(t,g,o,n,a,s,c,h,l);if(this.enableFrictionReduction&&(this.enableFriction=p),l&&A)return!0;if(f+=A,this.enableFrictionReduction){var p=this.enableFriction;this.enableFriction=!1}i(g,s);var b=this.convexCapsule(a,g,c,h,t,e,o,n,l);return this.enableFrictionReduction&&(this.enableFriction=p),l&&b?!0:(f+=b,this.enableFrictionReduction&&f&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(f)),f)},o.prototype[v.LINE|v.LINE]=o.prototype.lineLine=function(t,e,o,i,n,r,a,s,c){return c?!1:0},o.prototype[v.PLANE|v.LINE]=o.prototype.planeLine=function(t,e,o,i,n,h,l,p,u){var d=g,f=A,v=b,y=E,C=B,L=q,x=P,F=w,M=S,I=N,R=0;r.set(d,-h.length/2,0),r.set(f,h.length/2,0),r.rotate(v,d,p),r.rotate(y,f,p),s(v,v,l),s(y,y,l),r.copy(d,v),r.copy(f,y),a(C,f,d),r.normalize(L,C),r.rotate90cw(M,L),r.rotate(F,m,i),I[0]=d,I[1]=f;for(var V=0;V<I.length;V++){var T=I[V];a(x,T,o);var G=c(x,F);if(0>G){if(u)return!0;var O=this.createContactEquation(t,n,e,h);R++,r.copy(O.normalA,F),r.normalize(O.normalA,O.normalA),r.scale(x,F,G),a(O.contactPointA,T,x),a(O.contactPointA,O.contactPointA,t.position),a(O.contactPointB,T,l),s(O.contactPointB,O.contactPointB,l),a(O.contactPointB,O.contactPointB,n.position),this.contactEquations.push(O),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(O))}}return u?!1:(this.enableFrictionReduction||R&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(R)),R)},o.prototype[v.PARTICLE|v.CAPSULE]=o.prototype.particleCapsule=function(t,e,o,i,n,r,a,s,c){return this.circleLine(t,e,o,i,n,r,a,s,c,r.radius,0)},o.prototype[v.CIRCLE|v.LINE]=o.prototype.circleLine=function(t,e,o,i,n,h,l,p,u,d,f){var d=d||0,f="undefined"!=typeof f?f:e.radius,v=g,y=A,m=b,I=E,R=B,V=q,T=P,G=w,O=S,U=C,k=L,_=x,D=F,W=M,X=N;r.set(G,-h.length/2,0),r.set(O,h.length/2,0),r.rotate(U,G,p),r.rotate(k,O,p),s(U,U,l),s(k,k,l),r.copy(G,U),r.copy(O,k),a(V,O,G),r.normalize(T,V),r.rotate90cw(R,T),a(_,o,G);var j=c(_,R);a(I,G,l),a(D,o,l);var z=f+d;if(Math.abs(j)<z){r.scale(v,R,j),a(m,o,v),r.scale(y,R,c(R,D)),r.normalize(y,y),r.scale(y,y,d),s(m,m,y);var Y=c(T,m),K=c(T,G),H=c(T,O);if(Y>K&&H>Y){if(u)return!0;var Z=this.createContactEquation(t,n,e,h);return r.scale(Z.normalA,v,-1),r.normalize(Z.normalA,Z.normalA),r.scale(Z.contactPointA,Z.normalA,f),s(Z.contactPointA,Z.contactPointA,o),a(Z.contactPointA,Z.contactPointA,t.position),a(Z.contactPointB,m,l),s(Z.contactPointB,Z.contactPointB,l),a(Z.contactPointB,Z.contactPointB,n.position),this.contactEquations.push(Z),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Z)),1}}X[0]=G,X[1]=O;for(var J=0;J<X.length;J++){var Q=X[J];if(a(_,Q,o),r.squaredLength(_)<Math.pow(z,2)){if(u)return!0;var Z=this.createContactEquation(t,n,e,h);return r.copy(Z.normalA,_),r.normalize(Z.normalA,Z.normalA),r.scale(Z.contactPointA,Z.normalA,f),s(Z.contactPointA,Z.contactPointA,o),a(Z.contactPointA,Z.contactPointA,t.position),a(Z.contactPointB,Q,l),r.scale(W,Z.normalA,-d),s(Z.contactPointB,Z.contactPointB,W),s(Z.contactPointB,Z.contactPointB,l),a(Z.contactPointB,Z.contactPointB,n.position),this.contactEquations.push(Z),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Z)),1}}return 0},o.prototype[v.CIRCLE|v.CAPSULE]=o.prototype.circleCapsule=function(t,e,o,i,n,r,a,s,c){return this.circleLine(t,e,o,i,n,r,a,s,c,r.radius)},o.prototype[v.CIRCLE|v.CONVEX]=o.prototype[v.CIRCLE|v.BOX]=o.prototype.circleConvex=function(t,e,o,i,c,h,l,p,u,d){for(var d="number"==typeof d?d:e.radius,f=g,v=A,y=b,m=E,q=B,P=C,w=L,S=F,x=M,V=I,T=R,N=!1,G=Number.MAX_VALUE,O=h.vertices,U=0;U!==O.length+1;U++){var k=O[U%O.length],_=O[(U+1)%O.length];if(r.rotate(f,k,p),r.rotate(v,_,p),s(f,f,l),s(v,v,l),a(y,v,f),r.normalize(m,y),r.rotate90cw(q,m),r.scale(x,q,-e.radius),s(x,x,o),n(x,h,l,p)){r.sub(V,f,x);var D=Math.abs(r.dot(V,q));G>D&&(r.copy(T,x),G=D,r.scale(S,q,D),r.add(S,S,x),N=!0)}}if(N){if(u)return!0;var W=this.createContactEquation(t,c,e,h);return r.sub(W.normalA,T,o),r.normalize(W.normalA,W.normalA),r.scale(W.contactPointA,W.normalA,d),s(W.contactPointA,W.contactPointA,o),a(W.contactPointA,W.contactPointA,t.position),a(W.contactPointB,S,l),s(W.contactPointB,W.contactPointB,l),a(W.contactPointB,W.contactPointB,c.position),this.contactEquations.push(W),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(W)),1}if(d>0)for(var U=0;U<O.length;U++){var X=O[U];if(r.rotate(w,X,p),s(w,w,l),a(P,w,o),r.squaredLength(P)<Math.pow(d,2)){if(u)return!0;var W=this.createContactEquation(t,c,e,h);return r.copy(W.normalA,P),r.normalize(W.normalA,W.normalA),r.scale(W.contactPointA,W.normalA,d),s(W.contactPointA,W.contactPointA,o),a(W.contactPointA,W.contactPointA,t.position),a(W.contactPointB,w,l),s(W.contactPointB,W.contactPointB,l),a(W.contactPointB,W.contactPointB,c.position),this.contactEquations.push(W),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(W)),1}}return 0};var X=r.create(),j=r.create(),z=r.create(),Y=r.create();o.prototype[v.PARTICLE|v.CONVEX]=o.prototype[v.PARTICLE|v.BOX]=o.prototype.particleConvex=function(t,e,o,i,h,l,p,u,d){var f=g,v=A,y=b,m=E,w=B,S=q,L=P,x=C,M=F,I=V,R=T,N=Number.MAX_VALUE,G=!1,O=l.vertices;if(!n(o,l,p,u))return 0;if(d)return!0;for(var U=0;U!==O.length+1;U++){var k=O[U%O.length],_=O[(U+1)%O.length];r.rotate(f,k,u),r.rotate(v,_,u),s(f,f,p),s(v,v,p),a(y,v,f),r.normalize(m,y),r.rotate90cw(w,m),a(x,o,f),c(x,w),a(S,f,p),a(L,o,p),r.sub(I,f,o);var D=Math.abs(r.dot(I,w));N>D&&(N=D,r.scale(M,w,D),r.add(M,M,o),r.copy(R,w),G=!0)}if(G){var W=this.createContactEquation(t,h,e,l);return r.scale(W.normalA,R,-1),r.normalize(W.normalA,W.normalA),r.set(W.contactPointA,0,0),s(W.contactPointA,W.contactPointA,o),a(W.contactPointA,W.contactPointA,t.position),a(W.contactPointB,M,p),s(W.contactPointB,W.contactPointB,p),a(W.contactPointB,W.contactPointB,h.position),this.contactEquations.push(W),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(W)),1}return 0},o.prototype[v.CIRCLE]=o.prototype.circleCircle=function(t,e,o,i,n,c,h,l,p,u,d){var f=g,u=u||e.radius,d=d||c.radius;a(f,o,h);var v=u+d;if(r.squaredLength(f)>Math.pow(v,2))return 0;if(p)return!0;var y=this.createContactEquation(t,n,e,c);return a(y.normalA,h,o),r.normalize(y.normalA,y.normalA),r.scale(y.contactPointA,y.normalA,u),r.scale(y.contactPointB,y.normalA,-d),s(y.contactPointA,y.contactPointA,o),a(y.contactPointA,y.contactPointA,t.position),s(y.contactPointB,y.contactPointB,h),a(y.contactPointB,y.contactPointB,n.position),this.contactEquations.push(y),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(y)),1},o.prototype[v.PLANE|v.CONVEX]=o.prototype[v.PLANE|v.BOX]=o.prototype.planeConvex=function(t,e,o,i,n,h,l,p,u){var d=g,f=A,v=b,y=0;r.rotate(f,m,i);for(var E=0;E!==h.vertices.length;E++){var B=h.vertices[E];if(r.rotate(d,B,p),s(d,d,l),a(v,d,o),c(v,f)<=0){if(u)return!0;y++;var q=this.createContactEquation(t,n,e,h);a(v,d,o),r.copy(q.normalA,f);var P=c(v,q.normalA);r.scale(v,q.normalA,P),a(q.contactPointB,d,n.position),a(q.contactPointA,d,v),a(q.contactPointA,q.contactPointA,t.position),this.contactEquations.push(q),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(q))}}return this.enableFrictionReduction&&this.enableFriction&&y&&this.frictionEquations.push(this.createFrictionFromAverage(y)),y},o.prototype[v.PARTICLE|v.PLANE]=o.prototype.particlePlane=function(t,e,o,i,n,s,h,l,p){var u=g,d=A;l=l||0,a(u,o,h),r.rotate(d,m,l);var f=c(u,d);if(f>0)return 0;if(p)return!0;var v=this.createContactEquation(n,t,s,e);return r.copy(v.normalA,d),r.scale(u,v.normalA,f),a(v.contactPointA,o,u),a(v.contactPointA,v.contactPointA,n.position),a(v.contactPointB,o,t.position),this.contactEquations.push(v),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(v)),1},o.prototype[v.CIRCLE|v.PARTICLE]=o.prototype.circleParticle=function(t,e,o,i,n,c,h,l,p){var u=g;if(a(u,h,o),r.squaredLength(u)>Math.pow(e.radius,2))return 0;if(p)return!0;var d=this.createContactEquation(t,n,e,c);return r.copy(d.normalA,u),r.normalize(d.normalA,d.normalA),r.scale(d.contactPointA,d.normalA,e.radius),s(d.contactPointA,d.contactPointA,o),a(d.contactPointA,d.contactPointA,t.position),a(d.contactPointB,h,n.position),this.contactEquations.push(d),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(d)),1};var K=new d({radius:1}),H=r.create(),Z=r.create();r.create(),o.prototype[v.PLANE|v.CAPSULE]=o.prototype.planeCapsule=function(t,e,o,i,n,a,c,h,l){var p=H,u=Z,d=K;r.set(p,-a.length/2,0),r.rotate(p,p,h),s(p,p,c),r.set(u,a.length/2,0),r.rotate(u,u,h),s(u,u,c),d.radius=a.radius;var f;this.enableFrictionReduction&&(f=this.enableFriction,this.enableFriction=!1);var v=this.circlePlane(n,d,p,0,t,e,o,i,l),y=this.circlePlane(n,d,u,0,t,e,o,i,l);if(this.enableFrictionReduction&&(this.enableFriction=f),l)return v||y;var m=v+y;return this.enableFrictionReduction&&m&&this.frictionEquations.push(this.createFrictionFromAverage(m)),m},o.prototype[v.CIRCLE|v.PLANE]=o.prototype.circlePlane=function(t,e,o,i,n,h,l,p,u){var d=t,f=e,v=o,y=n,E=l,B=p;B=B||0;var q=g,P=A,w=b;a(q,v,E),r.rotate(P,m,B);var S=c(P,q);if(S>f.radius)return 0;if(u)return!0;var C=this.createContactEquation(y,d,h,e);return r.copy(C.normalA,P),r.scale(C.contactPointB,C.normalA,-f.radius),s(C.contactPointB,C.contactPointB,v),a(C.contactPointB,C.contactPointB,d.position),r.scale(w,C.normalA,S),a(C.contactPointA,q,w),s(C.contactPointA,C.contactPointA,E),a(C.contactPointA,C.contactPointA,y.position),this.contactEquations.push(C),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(C)),1},o.prototype[v.CONVEX]=o.prototype[v.CONVEX|v.BOX]=o.prototype[v.BOX]=o.prototype.convexConvex=function(t,e,i,n,h,l,p,u,d,f){var v=g,y=A,m=b,q=E,C=B,L=P,x=w,F=S,M=0,f="number"==typeof f?f:0,I=o.findSeparatingAxis(e,i,n,l,p,u,v);if(!I)return 0;a(x,p,i),c(v,x)>0&&r.scale(v,v,-1);var R=o.getClosestEdge(e,n,v,!0),V=o.getClosestEdge(l,u,v);if(-1===R||-1===V)return 0;for(var T=0;2>T;T++){var N=R,G=V,O=e,U=l,k=i,_=p,D=n,W=u,X=t,j=h;if(0===T){var z;z=N,N=G,G=z,z=O,O=U,U=z,z=k,k=_,_=z,z=D,D=W,W=z,z=X,X=j,j=z}for(var Y=G;G+2>Y;Y++){var K=U.vertices[(Y+U.vertices.length)%U.vertices.length];r.rotate(y,K,W),s(y,y,_);for(var H=0,Z=N-1;N+2>Z;Z++){var J=O.vertices[(Z+O.vertices.length)%O.vertices.length],Q=O.vertices[(Z+1+O.vertices.length)%O.vertices.length];r.rotate(m,J,D),r.rotate(q,Q,D),s(m,m,k),s(q,q,k),a(C,q,m),r.rotate90cw(F,C),r.normalize(F,F),a(x,y,m);var $=c(F,x);(Z===N&&f>=$||Z!==N&&0>=$)&&H++}if(H>=3){if(d)return!0;var te=this.createContactEquation(X,j,O,U);M++;var J=O.vertices[N%O.vertices.length],Q=O.vertices[(N+1)%O.vertices.length];r.rotate(m,J,D),r.rotate(q,Q,D),s(m,m,k),s(q,q,k),a(C,q,m),r.rotate90cw(te.normalA,C),r.normalize(te.normalA,te.normalA),a(x,y,m);var $=c(te.normalA,x);r.scale(L,te.normalA,$),a(te.contactPointA,y,k),a(te.contactPointA,te.contactPointA,L),s(te.contactPointA,te.contactPointA,k),a(te.contactPointA,te.contactPointA,X.position),a(te.contactPointB,y,_),s(te.contactPointB,te.contactPointB,_),a(te.contactPointB,te.contactPointB,j.position),this.contactEquations.push(te),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(te))}}}return this.enableFrictionReduction&&this.enableFriction&&M&&this.frictionEquations.push(this.createFrictionFromAverage(M)),M};var J=r.fromValues(0,0);o.projectConvexOntoAxis=function(t,e,o,i,n){var a,s,h=null,l=null,p=J;r.rotate(p,i,-o);for(var u=0;u<t.vertices.length;u++)a=t.vertices[u],s=c(a,p),(null===h||s>h)&&(h=s),(null===l||l>s)&&(l=s);if(l>h){var d=l;l=h,h=d}var f=c(e,i);r.set(n,l+f,h+f)};var Q=r.fromValues(0,0),$=r.fromValues(0,0),te=r.fromValues(0,0),ee=r.fromValues(0,0),oe=r.fromValues(0,0),ie=r.fromValues(0,0);o.findSeparatingAxis=function(t,e,i,n,s,c,h){var l=null,p=!1,u=!1,d=Q,f=$,v=te,m=ee,g=oe,A=ie;if(t instanceof y&&n instanceof y)for(var b=0;2!==b;b++){var E=t,B=i;1===b&&(E=n,B=c);for(var q=0;2!==q;q++){0===q?r.set(m,0,1):1===q&&r.set(m,1,0),0!==B&&r.rotate(m,m,B),o.projectConvexOntoAxis(t,e,i,m,g),o.projectConvexOntoAxis(n,s,c,m,A);var P=g,w=A,S=!1;g[0]>A[0]&&(w=g,P=A,S=!0);var C=w[0]-P[1];p=0>=C,(null===l||C>l)&&(r.copy(h,m),l=C,u=p)}}else for(var b=0;2!==b;b++){var E=t,B=i;1===b&&(E=n,B=c);for(var q=0;q!==E.vertices.length;q++){r.rotate(f,E.vertices[q],B),r.rotate(v,E.vertices[(q+1)%E.vertices.length],B),a(d,v,f),r.rotate90cw(m,d),r.normalize(m,m),o.projectConvexOntoAxis(t,e,i,m,g),o.projectConvexOntoAxis(n,s,c,m,A);var P=g,w=A,S=!1;g[0]>A[0]&&(w=g,P=A,S=!0);var C=w[0]-P[1];p=0>=C,(null===l||C>l)&&(r.copy(h,m),l=C,u=p)}}return u};var ne=r.fromValues(0,0),re=r.fromValues(0,0),ae=r.fromValues(0,0);o.getClosestEdge=function(t,e,o,i){var n=ne,s=re,h=ae;r.rotate(n,o,-e),i&&r.scale(n,n,-1);for(var l=-1,p=t.vertices.length,u=-1,d=0;d!==p;d++){a(s,t.vertices[(d+1)%p],t.vertices[d%p]),r.rotate90cw(h,s),r.normalize(h,h);var f=c(h,n);(-1===l||f>u)&&(l=d%p,u=f)}return l};var se=r.create(),ce=r.create(),he=r.create(),le=r.create(),pe=r.create(),ue=r.create(),de=r.create();o.prototype[v.CIRCLE|v.HEIGHTFIELD]=o.prototype.circleHeightfield=function(t,e,o,i,n,c,h,l,p,u){var d=c.heights,u=u||e.radius,f=c.elementWidth,v=ce,y=se,m=pe,g=de,A=ue,b=he,E=le,B=Math.floor((o[0]-u-h[0])/f),q=Math.ceil((o[0]+u-h[0])/f);0>B&&(B=0),q>=d.length&&(q=d.length-1);for(var P=d[B],w=d[q],S=B;q>S;S++)d[S]<w&&(w=d[S]),d[S]>P&&(P=d[S]);if(o[1]-u>P)return p?!1:0;for(var C=!1,S=B;q>S;S++){r.set(b,S*f,d[S]),r.set(E,(S+1)*f,d[S+1]),r.add(b,b,h),r.add(E,E,h),r.sub(A,E,b),r.rotate(A,A,Math.PI/2),r.normalize(A,A),r.scale(y,A,-u),r.add(y,y,o),r.sub(v,y,b);var L=r.dot(v,A);if(y[0]>=b[0]&&y[0]<E[0]&&0>=L){if(p)return!0;C=!0,r.scale(v,A,-L),r.add(m,y,v),r.copy(g,A);var x=this.createContactEquation(n,t,c,e);r.copy(x.normalA,g),r.scale(x.contactPointB,x.normalA,-u),s(x.contactPointB,x.contactPointB,o),a(x.contactPointB,x.contactPointB,t.position),r.copy(x.contactPointA,m),r.sub(x.contactPointA,x.contactPointA,n.position),this.contactEquations.push(x),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(x))}}if(C=!1,u>0)for(var S=B;q>=S;S++)if(r.set(b,S*f,d[S]),r.add(b,b,h),r.sub(v,o,b),r.squaredLength(v)<Math.pow(u,2)){if(p)return!0;C=!0;var x=this.createContactEquation(n,t,c,e);r.copy(x.normalA,v),r.normalize(x.normalA,x.normalA),r.scale(x.contactPointB,x.normalA,-u),s(x.contactPointB,x.contactPointB,o),a(x.contactPointB,x.contactPointB,t.position),a(x.contactPointA,b,h),s(x.contactPointA,x.contactPointA,h),a(x.contactPointA,x.contactPointA,n.position),this.contactEquations.push(x),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(x))
}return C?1:0};var fe=r.create(),ve=r.create(),ye=r.create(),me=new f({vertices:[r.create(),r.create(),r.create(),r.create()]});o.prototype[v.BOX|v.HEIGHTFIELD]=o.prototype[v.CONVEX|v.HEIGHTFIELD]=o.prototype.convexHeightfield=function(t,e,o,i,n,a,s,c,h){var l=a.heights,p=a.elementWidth,u=fe,d=ve,f=ye,v=me,y=Math.floor((t.aabb.lowerBound[0]-s[0])/p),m=Math.ceil((t.aabb.upperBound[0]-s[0])/p);0>y&&(y=0),m>=l.length&&(m=l.length-1);for(var g=l[y],A=l[m],b=y;m>b;b++)l[b]<A&&(A=l[b]),l[b]>g&&(g=l[b]);if(t.aabb.lowerBound[1]>g)return h?!1:0;for(var E=0,b=y;m>b;b++){r.set(u,b*p,l[b]),r.set(d,(b+1)*p,l[b+1]),r.add(u,u,s),r.add(d,d,s);var B=100;r.set(f,.5*(d[0]+u[0]),.5*(d[1]+u[1]-B)),r.sub(v.vertices[0],d,f),r.sub(v.vertices[1],u,f),r.copy(v.vertices[2],v.vertices[1]),r.copy(v.vertices[3],v.vertices[0]),v.vertices[2][1]-=B,v.vertices[3][1]-=B,E+=this.convexConvex(t,e,o,i,n,v,f,0,h)}return E}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../shapes/Box":37,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Shape":45,"../utils/ContactEquationPool":48,"../utils/FrictionEquationPool":49,"../utils/TupleDictionary":56,"../utils/Utils":57}],11:[function(t,e){function o(t){t=t||{},this.from=t.from?n.fromValues(t.from[0],t.from[1]):n.create(),this.to=t.to?n.fromValues(t.to[0],t.to[1]):n.create(),this.checkCollisionResponse=void 0!==t.checkCollisionResponse?t.checkCollisionResponse:!0,this.skipBackfaces=!!t.skipBackfaces,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:-1,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:-1,this.mode=void 0!==t.mode?t.mode:o.ANY,this.callback=t.callback||function(){},this.direction=n.create(),this.length=1,this.update()}function i(t,e,o){n.sub(a,o,t);var i=n.dot(a,e);return n.scale(s,e,i),n.add(s,s,t),n.squaredDistance(o,s)}e.exports=o;var n=t("../math/vec2");t("../collision/RaycastResult"),t("../shapes/Shape"),t("../collision/AABB"),o.prototype.constructor=o,o.CLOSEST=1,o.ANY=2,o.ALL=4,o.prototype.update=function(){var t=this.direction;n.sub(t,this.to,this.from),this.length=n.length(t),n.normalize(t,t)},o.prototype.intersectBodies=function(t,e){for(var o=0,i=e.length;!t.shouldStop(this)&&i>o;o++){var n=e[o],r=n.getAABB();(r.overlapsRay(this)>=0||r.containsPoint(this.from))&&this.intersectBody(t,n)}};var r=n.create();o.prototype.intersectBody=function(t,e){var o=this.checkCollisionResponse;if(!o||e.collisionResponse)for(var i=r,a=0,s=e.shapes.length;s>a;a++){var c=e.shapes[a];if((!o||c.collisionResponse)&&0!==(this.collisionGroup&c.collisionMask)&&0!==(c.collisionGroup&this.collisionMask)){n.rotate(i,c.position,e.angle),n.add(i,i,e.position);var h=c.angle+e.angle;if(this.intersectShape(t,c,h,i,e),t.shouldStop(this))break}}},o.prototype.intersectShape=function(t,e,o,n,r){var a=this.from,s=i(a,this.direction,n);s>e.boundingRadius*e.boundingRadius||(this._currentBody=r,this._currentShape=e,e.raycast(t,this,n,o),this._currentBody=this._currentShape=null)},o.prototype.getAABB=function(t){var e=this.to,o=this.from;n.set(t.lowerBound,Math.min(e[0],o[0]),Math.min(e[1],o[1])),n.set(t.upperBound,Math.max(e[0],o[0]),Math.max(e[1],o[1]))},n.create(),o.prototype.reportIntersection=function(t,e,i,r){var a=(this.from,this.to,this._currentShape),s=this._currentBody;if(!(this.skipBackfaces&&n.dot(i,this.direction)>0))switch(this.mode){case o.ALL:t.set(i,a,s,e,r),this.callback(t);break;case o.CLOSEST:(e<t.fraction||!t.hasHit())&&t.set(i,a,s,e,r);break;case o.ANY:t.set(i,a,s,e,r)}};var a=n.create(),s=n.create()},{"../collision/AABB":7,"../collision/RaycastResult":12,"../math/vec2":30,"../shapes/Shape":45}],12:[function(t,e){function o(){this.normal=i.create(),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1}var i=t("../math/vec2"),n=t("../collision/Ray");e.exports=o,o.prototype.reset=function(){i.set(this.normal,0,0),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1},o.prototype.getHitDistance=function(t){return i.distance(t.from,t.to)*this.fraction},o.prototype.hasHit=function(){return-1!==this.fraction},o.prototype.getHitPoint=function(t,e){i.lerp(t,e.from,e.to,this.fraction)},o.prototype.stop=function(){this.isStopped=!0},o.prototype.shouldStop=function(t){return this.isStopped||-1!==this.fraction&&t.mode===n.ANY},o.prototype.set=function(t,e,o,n,r){i.copy(this.normal,t),this.shape=e,this.body=o,this.fraction=n,this.faceIndex=r}},{"../collision/Ray":11,"../math/vec2":30}],13:[function(t,e){function o(){n.call(this,n.SAP),this.axisList=[],this.axisIndex=0;var t=this;this._addBodyHandler=function(e){t.axisList.push(e.body)},this._removeBodyHandler=function(e){var o=t.axisList.indexOf(e.body);-1!==o&&t.axisList.splice(o,1)}}var i=t("../utils/Utils"),n=t("../collision/Broadphase");e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.setWorld=function(t){this.axisList.length=0,i.appendArray(this.axisList,t.bodies),t.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),t.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=t},o.sortAxisList=function(t,e){e=0|e;for(var o=1,i=t.length;i>o;o++){for(var n=t[o],r=o-1;r>=0&&!(t[r].aabb.lowerBound[e]<=n.aabb.lowerBound[e]);r--)t[r+1]=t[r];t[r+1]=n}return t},o.prototype.sortList=function(){var t=this.axisList,e=this.axisIndex;o.sortAxisList(t,e)},o.prototype.getCollisionPairs=function(){var t=this.axisList,e=this.result,o=this.axisIndex;e.length=0;for(var i=t.length;i--;){var r=t[i];r.aabbNeedsUpdate&&r.updateAABB()}this.sortList();for(var a=0,s=0|t.length;a!==s;a++)for(var c=t[a],h=a+1;s>h;h++){var l=t[h],p=l.aabb.lowerBound[o]<=c.aabb.upperBound[o];if(!p)break;n.canCollide(c,l)&&this.boundingVolumeCheck(c,l)&&e.push(c,l)}return e},o.prototype.aabbQuery=function(t,e,o){o=o||[],this.sortList();var i=this.axisIndex,n="x";1===i&&(n="y"),2===i&&(n="z");for(var r=this.axisList,a=(e.lowerBound[n],e.upperBound[n],0);a<r.length;a++){var s=r[a];s.aabbNeedsUpdate&&s.updateAABB(),s.aabb.overlaps(e)&&o.push(s)}return o}},{"../collision/Broadphase":8,"../utils/Utils":57}],14:[function(t,e){function o(t,e,o,n){this.type=o,n=i.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}e.exports=o;var i=t("../utils/Utils");o.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},o.DISTANCE=1,o.GEAR=2,o.LOCK=3,o.PRISMATIC=4,o.REVOLUTE=5,o.prototype.setStiffness=function(t){for(var e=this.equations,o=0;o!==e.length;o++){var i=e[o];i.stiffness=t,i.needsUpdate=!0}},o.prototype.setRelaxation=function(t){for(var e=this.equations,o=0;o!==e.length;o++){var i=e[o];i.relaxation=t,i.needsUpdate=!0}}},{"../utils/Utils":57}],15:[function(t,e){function o(t,e,o){o=a.defaults(o,{localAnchorA:[0,0],localAnchorB:[0,0]}),i.call(this,t,e,i.DISTANCE,o),this.localAnchorA=r.fromValues(o.localAnchorA[0],o.localAnchorA[1]),this.localAnchorB=r.fromValues(o.localAnchorB[0],o.localAnchorB[1]);var s=this.localAnchorA,c=this.localAnchorB;if(this.distance=0,"number"==typeof o.distance)this.distance=o.distance;else{var h=r.create(),l=r.create(),p=r.create();r.rotate(h,s,t.angle),r.rotate(l,c,e.angle),r.add(p,e.position,l),r.sub(p,p,h),r.sub(p,p,t.position),this.distance=r.length(p)}var u;u="undefined"==typeof o.maxForce?Number.MAX_VALUE:o.maxForce;var d=new n(t,e,-u,u);this.equations=[d],this.maxForce=u;var p=r.create(),f=r.create(),v=r.create(),y=this;d.computeGq=function(){var t=this.bodyA,e=this.bodyB,o=t.position,i=e.position;return r.rotate(f,s,t.angle),r.rotate(v,c,e.angle),r.add(p,i,v),r.sub(p,p,f),r.sub(p,p,o),r.length(p)-y.distance},this.setMaxForce(u),this.upperLimitEnabled=!1,this.upperLimit=1,this.lowerLimitEnabled=!1,this.lowerLimit=0,this.position=0}var i=t("./Constraint"),n=t("../equations/Equation"),r=t("../math/vec2"),a=t("../utils/Utils");e.exports=o,o.prototype=new i,o.prototype.constructor=o;var s=r.create(),c=r.create(),h=r.create();o.prototype.update=function(){var t=this.equations[0],e=this.bodyA,o=this.bodyB,i=(this.distance,e.position),n=o.position,a=this.equations[0],l=t.G;r.rotate(c,this.localAnchorA,e.angle),r.rotate(h,this.localAnchorB,o.angle),r.add(s,n,h),r.sub(s,s,c),r.sub(s,s,i),this.position=r.length(s);var p=!1;if(this.upperLimitEnabled&&this.position>this.upperLimit&&(a.maxForce=0,a.minForce=-this.maxForce,this.distance=this.upperLimit,p=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(a.maxForce=this.maxForce,a.minForce=0,this.distance=this.lowerLimit,p=!0),(this.lowerLimitEnabled||this.upperLimitEnabled)&&!p)return void(a.enabled=!1);a.enabled=!0,r.normalize(s,s);var u=r.crossLength(c,s),d=r.crossLength(h,s);l[0]=-s[0],l[1]=-s[1],l[2]=-u,l[3]=s[0],l[4]=s[1],l[5]=d},o.prototype.setMaxForce=function(t){var e=this.equations[0];e.minForce=-t,e.maxForce=t},o.prototype.getMaxForce=function(){var t=this.equations[0];return t.maxForce}},{"../equations/Equation":22,"../math/vec2":30,"../utils/Utils":57,"./Constraint":14}],16:[function(t,e){function o(t,e,o){o=o||{},i.call(this,t,e,i.GEAR,o),this.ratio=void 0!==o.ratio?o.ratio:1,this.angle=void 0!==o.angle?o.angle:e.angle-this.ratio*t.angle,o.angle=this.angle,o.ratio=this.ratio,this.equations=[new n(t,e,o)],void 0!==o.maxTorque&&this.setMaxTorque(o.maxTorque)}var i=t("./Constraint"),n=(t("../equations/Equation"),t("../equations/AngleLockEquation"));t("../math/vec2"),e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.update=function(){var t=this.equations[0];t.ratio!==this.ratio&&t.setRatio(this.ratio),t.angle=this.angle},o.prototype.setMaxTorque=function(t){this.equations[0].setMaxTorque(t)},o.prototype.getMaxTorque=function(){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":20,"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],17:[function(t,e){function o(t,e,o){o=o||{},i.call(this,t,e,i.LOCK,o);var a="undefined"==typeof o.maxForce?Number.MAX_VALUE:o.maxForce,s=(o.localAngleB||0,new r(t,e,-a,a)),c=new r(t,e,-a,a),h=new r(t,e,-a,a),l=n.create(),p=n.create(),u=this;s.computeGq=function(){return n.rotate(l,u.localOffsetB,t.angle),n.sub(p,e.position,t.position),n.sub(p,p,l),p[0]},c.computeGq=function(){return n.rotate(l,u.localOffsetB,t.angle),n.sub(p,e.position,t.position),n.sub(p,p,l),p[1]};var d=n.create(),f=n.create();h.computeGq=function(){return n.rotate(d,u.localOffsetB,e.angle-u.localAngleB),n.scale(d,d,-1),n.sub(p,t.position,e.position),n.add(p,p,d),n.rotate(f,d,-Math.PI/2),n.normalize(f,f),n.dot(p,f)},this.localOffsetB=n.create(),o.localOffsetB?n.copy(this.localOffsetB,o.localOffsetB):(n.sub(this.localOffsetB,e.position,t.position),n.rotate(this.localOffsetB,this.localOffsetB,-t.angle)),this.localAngleB=0,this.localAngleB="number"==typeof o.localAngleB?o.localAngleB:e.angle-t.angle,this.equations.push(s,c,h),this.setMaxForce(a)}var i=t("./Constraint"),n=t("../math/vec2"),r=t("../equations/Equation");e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.setMaxForce=function(t){for(var e=this.equations,o=0;o<this.equations.length;o++)e[o].maxForce=t,e[o].minForce=-t},o.prototype.getMaxForce=function(){return this.equations[0].maxForce};var a=n.create(),s=n.create(),c=n.create(),h=n.fromValues(1,0),l=n.fromValues(0,1);o.prototype.update=function(){var t=this.equations[0],e=this.equations[1],o=this.equations[2],i=this.bodyA,r=this.bodyB;n.rotate(a,this.localOffsetB,i.angle),n.rotate(s,this.localOffsetB,r.angle-this.localAngleB),n.scale(s,s,-1),n.rotate(c,s,Math.PI/2),n.normalize(c,c),t.G[0]=-1,t.G[1]=0,t.G[2]=-n.crossLength(a,h),t.G[3]=1,e.G[0]=0,e.G[1]=-1,e.G[2]=-n.crossLength(a,l),e.G[4]=1,o.G[0]=-c[0],o.G[1]=-c[1],o.G[3]=c[0],o.G[4]=c[1],o.G[5]=n.crossLength(s,c)}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],18:[function(t,e){function o(t,e,o){o=o||{},i.call(this,t,e,i.PRISMATIC,o);var c=a.fromValues(0,0),h=a.fromValues(1,0),l=a.fromValues(0,0);o.localAnchorA&&a.copy(c,o.localAnchorA),o.localAxisA&&a.copy(h,o.localAxisA),o.localAnchorB&&a.copy(l,o.localAnchorB),this.localAnchorA=c,this.localAnchorB=l,this.localAxisA=h;var p=this.maxForce="undefined"!=typeof o.maxForce?o.maxForce:Number.MAX_VALUE,u=new r(t,e,-p,p),d=new a.create,f=new a.create,v=new a.create,y=new a.create;if(u.computeGq=function(){return a.dot(v,y)},u.updateJacobian=function(){var o=this.G,i=t.position,n=e.position;a.rotate(d,c,t.angle),a.rotate(f,l,e.angle),a.add(v,n,f),a.sub(v,v,i),a.sub(v,v,d),a.rotate(y,h,t.angle+Math.PI/2),o[0]=-y[0],o[1]=-y[1],o[2]=-a.crossLength(d,y)+a.crossLength(y,v),o[3]=y[0],o[4]=y[1],o[5]=a.crossLength(f,y)},this.equations.push(u),!o.disableRotationalLock){var m=new s(t,e,-p,p);this.equations.push(m)}this.position=0,this.velocity=0,this.lowerLimitEnabled="undefined"!=typeof o.lowerLimit?!0:!1,this.upperLimitEnabled="undefined"!=typeof o.upperLimit?!0:!1,this.lowerLimit="undefined"!=typeof o.lowerLimit?o.lowerLimit:0,this.upperLimit="undefined"!=typeof o.upperLimit?o.upperLimit:1,this.upperLimitEquation=new n(t,e),this.lowerLimitEquation=new n(t,e),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=p,this.motorEquation=new r(t,e),this.motorEnabled=!1,this.motorSpeed=0;var g=this,A=this.motorEquation;A.computeGW,A.computeGq=function(){return 0},A.computeGW=function(){var t=this.G,e=this.bodyA,o=this.bodyB,i=e.velocity,n=o.velocity,r=e.angularVelocity,a=o.angularVelocity;return this.gmult(t,i,r,n,a)+g.motorSpeed}}var i=t("./Constraint"),n=t("../equations/ContactEquation"),r=t("../equations/Equation"),a=t("../math/vec2"),s=t("../equations/RotationalLockEquation");e.exports=o,o.prototype=new i,o.prototype.constructor=o;var c=a.create(),h=a.create(),l=a.create(),p=a.create(),u=a.create(),d=a.create();o.prototype.update=function(){var t=this.equations,e=t[0],o=this.upperLimit,i=this.lowerLimit,n=this.upperLimitEquation,r=this.lowerLimitEquation,s=this.bodyA,f=this.bodyB,v=this.localAxisA,y=this.localAnchorA,m=this.localAnchorB;e.updateJacobian(),a.rotate(c,v,s.angle),a.rotate(p,y,s.angle),a.add(h,p,s.position),a.rotate(u,m,f.angle),a.add(l,u,f.position);var g=this.position=a.dot(l,c)-a.dot(h,c);if(this.motorEnabled){var A=this.motorEquation.G;A[0]=c[0],A[1]=c[1],A[2]=a.crossLength(c,u),A[3]=-c[0],A[4]=-c[1],A[5]=-a.crossLength(c,p)}if(this.upperLimitEnabled&&g>o)a.scale(n.normalA,c,-1),a.sub(n.contactPointA,h,s.position),a.sub(n.contactPointB,l,f.position),a.scale(d,c,o),a.add(n.contactPointA,n.contactPointA,d),-1===t.indexOf(n)&&t.push(n);else{var b=t.indexOf(n);-1!==b&&t.splice(b,1)}if(this.lowerLimitEnabled&&i>g)a.scale(r.normalA,c,1),a.sub(r.contactPointA,h,s.position),a.sub(r.contactPointB,l,f.position),a.scale(d,c,i),a.sub(r.contactPointB,r.contactPointB,d),-1===t.indexOf(r)&&t.push(r);else{var b=t.indexOf(r);-1!==b&&t.splice(b,1)}},o.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},o.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},o.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../math/vec2":30,"./Constraint":14}],19:[function(t,e){function o(t,e,o){o=o||{},i.call(this,t,e,i.REVOLUTE,o);var d=this.maxForce="undefined"!=typeof o.maxForce?o.maxForce:Number.MAX_VALUE;this.pivotA=s.create(),this.pivotB=s.create(),o.worldPivot?(s.sub(this.pivotA,o.worldPivot,t.position),s.sub(this.pivotB,o.worldPivot,e.position),s.rotate(this.pivotA,this.pivotA,-t.angle),s.rotate(this.pivotB,this.pivotB,-e.angle)):(s.copy(this.pivotA,o.localPivotA),s.copy(this.pivotB,o.localPivotB));var f=this.equations=[new n(t,e,-d,d),new n(t,e,-d,d)],v=f[0],y=f[1],m=this;v.computeGq=function(){return s.rotate(c,m.pivotA,t.angle),s.rotate(h,m.pivotB,e.angle),s.add(u,e.position,h),s.sub(u,u,t.position),s.sub(u,u,c),s.dot(u,l)},y.computeGq=function(){return s.rotate(c,m.pivotA,t.angle),s.rotate(h,m.pivotB,e.angle),s.add(u,e.position,h),s.sub(u,u,t.position),s.sub(u,u,c),s.dot(u,p)},y.minForce=v.minForce=-d,y.maxForce=v.maxForce=d,this.motorEquation=new r(t,e),this.motorEnabled=!1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0,this.upperLimitEquation=new a(t,e),this.lowerLimitEquation=new a(t,e),this.upperLimitEquation.minForce=0,this.lowerLimitEquation.maxForce=0}var i=t("./Constraint"),n=t("../equations/Equation"),r=t("../equations/RotationalVelocityEquation"),a=t("../equations/RotationalLockEquation"),s=t("../math/vec2");e.exports=o;var c=s.create(),h=s.create(),l=s.fromValues(1,0),p=s.fromValues(0,1),u=s.create();o.prototype=new i,o.prototype.constructor=o,o.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)},o.prototype.update=function(){var t=this.bodyA,e=this.bodyB,o=this.pivotA,i=this.pivotB,n=this.equations,r=(n[0],n[1],n[0]),a=n[1],u=this.upperLimit,d=this.lowerLimit,f=this.upperLimitEquation,v=this.lowerLimitEquation,y=this.angle=e.angle-t.angle;if(this.upperLimitEnabled&&y>u)f.angle=u,-1===n.indexOf(f)&&n.push(f);else{var m=n.indexOf(f);-1!==m&&n.splice(m,1)}if(this.lowerLimitEnabled&&d>y)v.angle=d,-1===n.indexOf(v)&&n.push(v);else{var m=n.indexOf(v);-1!==m&&n.splice(m,1)}s.rotate(c,o,t.angle),s.rotate(h,i,e.angle),r.G[0]=-1,r.G[1]=0,r.G[2]=-s.crossLength(c,l),r.G[3]=1,r.G[4]=0,r.G[5]=s.crossLength(h,l),a.G[0]=0,a.G[1]=-1,a.G[2]=-s.crossLength(c,p),a.G[3]=0,a.G[4]=1,a.G[5]=s.crossLength(h,p)},o.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},o.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},o.prototype.motorIsEnabled=function(){return!!this.motorEnabled},o.prototype.setMotorSpeed=function(t){if(this.motorEnabled){var e=this.equations.indexOf(this.motorEquation);this.equations[e].relativeVelocity=t}},o.prototype.getMotorSpeed=function(){return this.motorEnabled?this.motorEquation.relativeVelocity:!1}},{"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../equations/RotationalVelocityEquation":25,"../math/vec2":30,"./Constraint":14}],20:[function(t,e){function o(t,e,o){o=o||{},i.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=o.angle||0,this.ratio="number"==typeof o.ratio?o.ratio:1,this.setRatio(this.ratio)}var i=t("./Equation");t("../math/vec2"),e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},o.prototype.setRatio=function(t){var e=this.G;e[2]=t,e[5]=-1,this.ratio=t},o.prototype.setMaxTorque=function(t){this.maxForce=t,this.minForce=-t}},{"../math/vec2":30,"./Equation":22}],21:[function(t,e){function o(t,e){i.call(this,t,e,0,Number.MAX_VALUE),this.contactPointA=n.create(),this.penetrationVec=n.create(),this.contactPointB=n.create(),this.normalA=n.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}var i=t("./Equation"),n=t("../math/vec2");e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.computeB=function(t,e,o){var i=this.bodyA,r=this.bodyB,a=this.contactPointA,s=this.contactPointB,c=i.position,h=r.position,l=this.penetrationVec,p=this.normalA,u=this.G,d=n.crossLength(a,p),f=n.crossLength(s,p);u[0]=-p[0],u[1]=-p[1],u[2]=-d,u[3]=p[0],u[4]=p[1],u[5]=f,n.add(l,h,s),n.sub(l,l,c),n.sub(l,l,a);var v,y;this.firstImpact&&0!==this.restitution?(y=0,v=1/e*(1+this.restitution)*this.computeGW()):(y=n.dot(p,l)+this.offset,v=this.computeGW());var m=this.computeGiMf(),g=-y*t-v*e-o*m;return g}},{"../math/vec2":30,"./Equation":22}],22:[function(t,e){function o(t,e,i,r){this.minForce="undefined"==typeof i?-Number.MAX_VALUE:i,this.maxForce="undefined"==typeof r?Number.MAX_VALUE:r,this.bodyA=t,this.bodyB=e,this.stiffness=o.DEFAULT_STIFFNESS,this.relaxation=o.DEFAULT_RELAXATION,this.G=new n.ARRAY_TYPE(6);for(var a=0;6>a;a++)this.G[a]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0}e.exports=o;var i=t("../math/vec2"),n=t("../utils/Utils");t("../objects/Body"),o.prototype.constructor=o,o.DEFAULT_STIFFNESS=1e6,o.DEFAULT_RELAXATION=4,o.prototype.update=function(){var t=this.stiffness,e=this.relaxation,o=this.timeStep;this.a=4/(o*(1+4*e)),this.b=4*e/(1+4*e),this.epsilon=4/(o*o*t*(1+4*e)),this.needsUpdate=!1},o.prototype.gmult=function(t,e,o,i,n){return t[0]*e[0]+t[1]*e[1]+t[2]*o+t[3]*i[0]+t[4]*i[1]+t[5]*n},o.prototype.computeB=function(t,e,o){var i=this.computeGW(),n=this.computeGq(),r=this.computeGiMf();return-n*t-i*e-r*o};var r=i.create(),a=i.create();o.prototype.computeGq=function(){var t=this.G,e=this.bodyA,o=this.bodyB,i=(e.position,o.position,e.angle),n=o.angle;return this.gmult(t,r,i,a,n)+this.offset},o.prototype.computeGW=function(){var t=this.G,e=this.bodyA,o=this.bodyB,i=e.velocity,n=o.velocity,r=e.angularVelocity,a=o.angularVelocity;return this.gmult(t,i,r,n,a)+this.relativeVelocity},o.prototype.computeGWlambda=function(){var t=this.G,e=this.bodyA,o=this.bodyB,i=e.vlambda,n=o.vlambda,r=e.wlambda,a=o.wlambda;return this.gmult(t,i,r,n,a)};var s=i.create(),c=i.create();o.prototype.computeGiMf=function(){var t=this.bodyA,e=this.bodyB,o=t.force,n=t.angularForce,r=e.force,a=e.angularForce,h=t.invMassSolve,l=e.invMassSolve,p=t.invInertiaSolve,u=e.invInertiaSolve,d=this.G;return i.scale(s,o,h),i.multiply(s,t.massMultiplier,s),i.scale(c,r,l),i.multiply(c,e.massMultiplier,c),this.gmult(d,s,n*p,c,a*u)},o.prototype.computeGiMGt=function(){var t=this.bodyA,e=this.bodyB,o=t.invMassSolve,i=e.invMassSolve,n=t.invInertiaSolve,r=e.invInertiaSolve,a=this.G;return a[0]*a[0]*o*t.massMultiplier[0]+a[1]*a[1]*o*t.massMultiplier[1]+a[2]*a[2]*n+a[3]*a[3]*i*e.massMultiplier[0]+a[4]*a[4]*i*e.massMultiplier[1]+a[5]*a[5]*r};var h=i.create(),l=i.create(),p=i.create();i.create(),i.create(),i.create(),o.prototype.addToWlambda=function(t){var e=this.bodyA,o=this.bodyB,n=h,r=l,a=p,s=e.invMassSolve,c=o.invMassSolve,u=e.invInertiaSolve,d=o.invInertiaSolve,f=this.G;r[0]=f[0],r[1]=f[1],a[0]=f[3],a[1]=f[4],i.scale(n,r,s*t),i.multiply(n,n,e.massMultiplier),i.add(e.vlambda,e.vlambda,n),e.wlambda+=u*f[2]*t,i.scale(n,a,c*t),i.multiply(n,n,o.massMultiplier),i.add(o.vlambda,o.vlambda,n),o.wlambda+=d*f[5]*t},o.prototype.computeInvC=function(t){return 1/(this.computeGiMGt()+t)}},{"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],23:[function(t,e){function o(t,e,o){n.call(this,t,e,-o,o),this.contactPointA=i.create(),this.contactPointB=i.create(),this.t=i.create(),this.contactEquations=[],this.shapeA=null,this.shapeB=null,this.frictionCoefficient=.3}var i=t("../math/vec2"),n=t("./Equation");t("../utils/Utils"),e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.setSlipForce=function(t){this.maxForce=t,this.minForce=-t},o.prototype.getSlipForce=function(){return this.maxForce},o.prototype.computeB=function(t,e,o){var n=(this.bodyA,this.bodyB,this.contactPointA),r=this.contactPointB,a=this.t,s=this.G;s[0]=-a[0],s[1]=-a[1],s[2]=-i.crossLength(n,a),s[3]=a[0],s[4]=a[1],s[5]=i.crossLength(r,a);var c=this.computeGW(),h=this.computeGiMf(),l=-c*e-o*h;return l}},{"../math/vec2":30,"../utils/Utils":57,"./Equation":22}],24:[function(t,e){function o(t,e,o){o=o||{},i.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=o.angle||0;var n=this.G;n[2]=1,n[5]=-1}var i=t("./Equation"),n=t("../math/vec2");e.exports=o,o.prototype=new i,o.prototype.constructor=o;var r=n.create(),a=n.create(),s=n.fromValues(1,0),c=n.fromValues(0,1);o.prototype.computeGq=function(){return n.rotate(r,s,this.bodyA.angle+this.angle),n.rotate(a,c,this.bodyB.angle),n.dot(r,a)}},{"../math/vec2":30,"./Equation":22}],25:[function(t,e){function o(t,e){i.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}var i=t("./Equation");t("../math/vec2"),e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.computeB=function(t,e,o){var i=this.G;i[2]=-1,i[5]=this.ratio;var n=this.computeGiMf(),r=this.computeGW(),a=-r*e-o*n;return a}},{"../math/vec2":30,"./Equation":22}],26:[function(t,e){var o=function(){};e.exports=o,o.prototype={constructor:o,on:function(t,e,o){e.context=o||this,void 0===this._listeners&&(this._listeners={});var i=this._listeners;return void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e),this},has:function(t,e){if(void 0===this._listeners)return!1;var o=this._listeners;if(e){if(void 0!==o[t]&&-1!==o[t].indexOf(e))return!0}else if(void 0!==o[t])return!0;return!1},off:function(t,e){if(void 0===this._listeners)return this;var o=this._listeners,i=o[t].indexOf(e);return-1!==i&&o[t].splice(i,1),this},emit:function(t){if(void 0===this._listeners)return this;var e=this._listeners,o=e[t.type];if(void 0!==o){t.target=this;for(var i=0,n=o.length;n>i;i++){var r=o[i];r.call(r.context,t)}}return this}}},{}],27:[function(t,e){function o(t,e,r){if(r=r||{},!(t instanceof i&&e instanceof i))throw new Error("First two arguments must be Material instances.");this.id=o.idCounter++,this.materialA=t,this.materialB=e,this.friction="undefined"!=typeof r.friction?Number(r.friction):.3,this.restitution="undefined"!=typeof r.restitution?Number(r.restitution):0,this.stiffness="undefined"!=typeof r.stiffness?Number(r.stiffness):n.DEFAULT_STIFFNESS,this.relaxation="undefined"!=typeof r.relaxation?Number(r.relaxation):n.DEFAULT_RELAXATION,this.frictionStiffness="undefined"!=typeof r.frictionStiffness?Number(r.frictionStiffness):n.DEFAULT_STIFFNESS,this.frictionRelaxation="undefined"!=typeof r.frictionRelaxation?Number(r.frictionRelaxation):n.DEFAULT_RELAXATION,this.surfaceVelocity="undefined"!=typeof r.surfaceVelocity?Number(r.surfaceVelocity):0,this.contactSkinSize=.005}var i=t("./Material"),n=t("../equations/Equation");e.exports=o,o.idCounter=0},{"../equations/Equation":22,"./Material":28}],28:[function(t,e){function o(t){this.id=t||o.idCounter++}e.exports=o,o.idCounter=0},{}],29:[function(t,e){var o={};o.GetArea=function(t){if(t.length<6)return 0;for(var e=t.length-2,o=0,i=0;e>i;i+=2)o+=(t[i+2]-t[i])*(t[i+1]+t[i+3]);return o+=(t[0]-t[e])*(t[e+1]+t[1]),.5*-o},o.Triangulate=function(t){var e=t.length>>1;if(3>e)return[];for(var i=[],n=[],r=0;e>r;r++)n.push(r);for(var r=0,a=e;a>3;){var s=n[(r+0)%a],c=n[(r+1)%a],h=n[(r+2)%a],l=t[2*s],p=t[2*s+1],u=t[2*c],d=t[2*c+1],f=t[2*h],v=t[2*h+1],y=!1;if(o._convex(l,p,u,d,f,v)){y=!0;for(var m=0;a>m;m++){var g=n[m];if(g!=s&&g!=c&&g!=h&&o._PointInTriangle(t[2*g],t[2*g+1],l,p,u,d,f,v)){y=!1;break}}}if(y)i.push(s,c,h),n.splice((r+1)%a,1),a--,r=0;else if(r++>3*a)break}return i.push(n[0],n[1],n[2]),i},o._PointInTriangle=function(t,e,o,i,n,r,a,s){var c=a-o,h=s-i,l=n-o,p=r-i,u=t-o,d=e-i,f=c*c+h*h,v=c*l+h*p,y=c*u+h*d,m=l*l+p*p,g=l*u+p*d,A=1/(f*m-v*v),b=(m*y-v*g)*A,E=(f*g-v*y)*A;return b>=0&&E>=0&&1>b+E},o._convex=function(t,e,o,i,n,r){return(e-i)*(n-o)+(o-t)*(r-i)>=0},e.exports=o},{}],30:[function(t,e){var o=e.exports={},i=t("../utils/Utils");o.crossLength=function(t,e){return t[0]*e[1]-t[1]*e[0]},o.crossVZ=function(t,e,i){return o.rotate(t,e,-Math.PI/2),o.scale(t,t,i),t},o.crossZV=function(t,e,i){return o.rotate(t,i,Math.PI/2),o.scale(t,t,e),t},o.rotate=function(t,e,o){if(0!==o){var i=Math.cos(o),n=Math.sin(o),r=e[0],a=e[1];t[0]=i*r-n*a,t[1]=n*r+i*a}else t[0]=e[0],t[1]=e[1]},o.rotate90cw=function(t,e){var o=e[0],i=e[1];t[0]=i,t[1]=-o},o.toLocalFrame=function(t,e,i,n){o.copy(t,e),o.sub(t,t,i),o.rotate(t,t,-n)},o.toGlobalFrame=function(t,e,i,n){o.copy(t,e),o.rotate(t,t,n),o.add(t,t,i)},o.vectorToLocalFrame=function(t,e,i){o.rotate(t,e,-i)},o.vectorToGlobalFrame=function(t,e,i){o.rotate(t,e,i)},o.centroid=function(t,e,i,n){return o.add(t,e,i),o.add(t,t,n),o.scale(t,t,1/3),t},o.create=function(){var t=new i.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},o.clone=function(t){var e=new i.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},o.fromValues=function(t,e){var o=new i.ARRAY_TYPE(2);return o[0]=t,o[1]=e,o},o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},o.set=function(t,e,o){return t[0]=e,t[1]=o,t},o.add=function(t,e,o){return t[0]=e[0]+o[0],t[1]=e[1]+o[1],t},o.subtract=function(t,e,o){return t[0]=e[0]-o[0],t[1]=e[1]-o[1],t},o.sub=o.subtract,o.multiply=function(t,e,o){return t[0]=e[0]*o[0],t[1]=e[1]*o[1],t},o.mul=o.multiply,o.divide=function(t,e,o){return t[0]=e[0]/o[0],t[1]=e[1]/o[1],t},o.div=o.divide,o.scale=function(t,e,o){return t[0]=e[0]*o,t[1]=e[1]*o,t},o.distance=function(t,e){var o=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(o*o+i*i)},o.dist=o.distance,o.squaredDistance=function(t,e){var o=e[0]-t[0],i=e[1]-t[1];return o*o+i*i},o.sqrDist=o.squaredDistance,o.length=function(t){var e=t[0],o=t[1];return Math.sqrt(e*e+o*o)},o.len=o.length,o.squaredLength=function(t){var e=t[0],o=t[1];return e*e+o*o},o.sqrLen=o.squaredLength,o.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},o.normalize=function(t,e){var o=e[0],i=e[1],n=o*o+i*i;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t},o.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},o.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},o.lerp=function(t,e,o,i){var n=e[0],r=e[1];return t[0]=n+i*(o[0]-n),t[1]=r+i*(o[1]-r),t},o.reflect=function(t,e,o){var i=e[0]*o[0]+e[1]*o[1];t[0]=e[0]-2*o[0]*i,t[1]=e[1]-2*o[1]*i},o.getLineSegmentsIntersection=function(t,e,i,n,r){var a=o.getLineSegmentsIntersectionFraction(e,i,n,r);return 0>a?!1:(t[0]=e[0]+a*(i[0]-e[0]),t[1]=e[1]+a*(i[1]-e[1]),!0)},o.getLineSegmentsIntersectionFraction=function(t,e,o,i){var n,r,a=e[0]-t[0],s=e[1]-t[1],c=i[0]-o[0],h=i[1]-o[1];return n=(-s*(t[0]-o[0])+a*(t[1]-o[1]))/(-c*s+a*h),r=(c*(t[1]-o[1])-h*(t[0]-o[0]))/(-c*s+a*h),n>=0&&1>=n&&r>=0&&1>=r?r:-1}},{"../utils/Utils":57}],31:[function(t,e){function o(t){t=t||{},h.call(this),this.id=t.id||++o._idCounter,this.world=null,this.shapes=[],this.mass=t.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.invMassSolve=0,this.invInertiaSolve=0,this.fixedRotation=!!t.fixedRotation,this.fixedX=!!t.fixedX,this.fixedY=!!t.fixedY,this.massMultiplier=i.create(),this.position=i.fromValues(0,0),t.position&&i.copy(this.position,t.position),this.interpolatedPosition=i.fromValues(0,0),this.interpolatedAngle=0,this.previousPosition=i.fromValues(0,0),this.previousAngle=0,this.velocity=i.fromValues(0,0),t.velocity&&i.copy(this.velocity,t.velocity),this.vlambda=i.fromValues(0,0),this.wlambda=0,this.angle=t.angle||0,this.angularVelocity=t.angularVelocity||0,this.force=i.create(),t.force&&i.copy(this.force,t.force),this.angularForce=t.angularForce||0,this.damping="number"==typeof t.damping?t.damping:.1,this.angularDamping="number"==typeof t.angularDamping?t.angularDamping:.1,this.type=o.STATIC,this.type="undefined"!=typeof t.type?t.type:t.mass?o.DYNAMIC:o.STATIC,this.boundingRadius=0,this.aabb=new c,this.aabbNeedsUpdate=!0,this.allowSleep=void 0!==t.allowSleep?t.allowSleep:!0,this.wantsToSleep=!1,this.sleepState=o.AWAKE,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.2,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.gravityScale=void 0!==t.gravityScale?t.gravityScale:1,this.collisionResponse=void 0!==t.collisionResponse?t.collisionResponse:!0,this.idleTime=0,this.timeLastSleepy=0,this.ccdSpeedThreshold=void 0!==t.ccdSpeedThreshold?t.ccdSpeedThreshold:-1,this.ccdIterations=void 0!==t.ccdIterations?t.ccdIterations:10,this.concavePath=null,this._wakeUpAfterNarrowphase=!1,this.updateMassProperties()
}var i=t("../math/vec2"),n=t("poly-decomp"),r=t("../shapes/Convex"),a=t("../collision/RaycastResult"),s=t("../collision/Ray"),c=t("../collision/AABB"),h=t("../events/EventEmitter");e.exports=o,o.prototype=new h,o.prototype.constructor=o,o._idCounter=0,o.prototype.updateSolveMassProperties=function(){this.sleepState===o.SLEEPING||this.type===o.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)},o.prototype.setDensity=function(t){var e=this.getArea();this.mass=e*t,this.updateMassProperties()},o.prototype.getArea=function(){for(var t=0,e=0;e<this.shapes.length;e++)t+=this.shapes[e].area;return t},o.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var l=new c,p=i.create();o.prototype.updateAABB=function(){for(var t=this.shapes,e=t.length,o=p,n=this.angle,r=0;r!==e;r++){var a=t[r],s=a.angle+n;i.rotate(o,a.position,n),i.add(o,o,this.position),a.computeAABB(l,o,s),0===r?this.aabb.copy(l):this.aabb.extend(l)}this.aabbNeedsUpdate=!1},o.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=t.length,o=0,n=0;n!==e;n++){var r=t[n],a=i.length(r.position),s=r.boundingRadius;a+s>o&&(o=a+s)}this.boundingRadius=o},o.prototype.addShape=function(t,e,o){if(t.body)throw new Error("A shape can only be added to one body.");t.body=this,e?i.copy(t.position,e):i.set(t.position,0,0),t.angle=o||0,this.shapes.push(t),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},o.prototype.removeShape=function(t){var e=this.shapes.indexOf(t);return-1!==e?(this.shapes.splice(e,1),this.aabbNeedsUpdate=!0,t.body=null,!0):!1},o.prototype.updateMassProperties=function(){if(this.type===o.STATIC||this.type===o.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var t=this.shapes,e=t.length,n=this.mass/e,r=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(var a=0;e>a;a++){var s=t[a],c=i.squaredLength(s.position),h=s.computeMomentOfInertia(n);r+=h+n*c}this.inertia=r,this.invInertia=r>0?1/r:0}this.invMass=1/this.mass,i.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}},i.create(),o.prototype.applyForce=function(t,e){if(i.add(this.force,this.force,t),e){var o=i.crossLength(e,t);this.angularForce+=o}};var u=i.create(),d=i.create(),f=i.create();o.prototype.applyForceLocal=function(t,e){e=e||f;var o=u,i=d;this.vectorToWorldFrame(o,t),this.vectorToWorldFrame(i,e),this.applyForce(o,i)};var v=i.create();o.prototype.applyImpulse=function(t,e){if(this.type===o.DYNAMIC){var n=v;if(i.scale(n,t,this.invMass),i.multiply(n,this.massMultiplier,n),i.add(this.velocity,n,this.velocity),e){var r=i.crossLength(e,t);r*=this.invInertia,this.angularVelocity+=r}}};var y=i.create(),m=i.create(),g=i.create();o.prototype.applyImpulseLocal=function(t,e){e=e||g;var o=y,i=m;this.vectorToWorldFrame(o,t),this.vectorToWorldFrame(i,e),this.applyImpulse(o,i)},o.prototype.toLocalFrame=function(t,e){i.toLocalFrame(t,e,this.position,this.angle)},o.prototype.toWorldFrame=function(t,e){i.toGlobalFrame(t,e,this.position,this.angle)},o.prototype.vectorToLocalFrame=function(t,e){i.vectorToLocalFrame(t,e,this.angle)},o.prototype.vectorToWorldFrame=function(t,e){i.vectorToGlobalFrame(t,e,this.angle)},o.prototype.fromPolygon=function(t,e){e=e||{};for(var o=this.shapes.length;o>=0;--o)this.removeShape(this.shapes[o]);var a=new n.Polygon;if(a.vertices=t,a.makeCCW(),"number"==typeof e.removeCollinearPoints&&a.removeCollinearPoints(e.removeCollinearPoints),"undefined"==typeof e.skipSimpleCheck&&!a.isSimple())return!1;this.concavePath=a.vertices.slice(0);for(var o=0;o<this.concavePath.length;o++){var s=[0,0];i.copy(s,this.concavePath[o]),this.concavePath[o]=s}var c;c=e.optimalDecomp?a.decomp():a.quickDecomp();for(var h=i.create(),o=0;o!==c.length;o++){for(var l=new r({vertices:c[o].vertices}),p=0;p!==l.vertices.length;p++){var s=l.vertices[p];i.sub(s,s,l.centerOfMass)}i.scale(h,l.centerOfMass,1),l.updateTriangles(),l.updateCenterOfMass(),l.updateBoundingRadius(),this.addShape(l,h)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0};var A=(i.fromValues(0,0),i.fromValues(0,0)),b=i.fromValues(0,0),E=i.fromValues(0,0);o.prototype.adjustCenterOfMass=function(){var t=A,e=b,o=E,n=0;i.set(e,0,0);for(var r=0;r!==this.shapes.length;r++){var a=this.shapes[r];i.scale(t,a.position,a.area),i.add(e,e,t),n+=a.area}i.scale(o,e,1/n);for(var r=0;r!==this.shapes.length;r++){var a=this.shapes[r];i.sub(a.position,a.position,o)}i.add(this.position,this.position,o);for(var r=0;this.concavePath&&r<this.concavePath.length;r++)i.sub(this.concavePath[r],this.concavePath[r],o);this.updateMassProperties(),this.updateBoundingRadius()},o.prototype.setZeroForce=function(){i.set(this.force,0,0),this.angularForce=0},o.prototype.resetConstraintVelocity=function(){var t=this,e=t.vlambda;i.set(e,0,0),t.wlambda=0},o.prototype.addConstraintVelocity=function(){var t=this,e=t.velocity;i.add(e,e,t.vlambda),t.angularVelocity+=t.wlambda},o.prototype.applyDamping=function(t){if(this.type===o.DYNAMIC){var e=this.velocity;i.scale(e,e,Math.pow(1-this.damping,t)),this.angularVelocity*=Math.pow(1-this.angularDamping,t)}},o.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=o.AWAKE,this.idleTime=0,t!==o.AWAKE&&this.emit(o.wakeUpEvent)},o.prototype.sleep=function(){this.sleepState=o.SLEEPING,this.angularVelocity=0,this.angularForce=0,i.set(this.velocity,0,0),i.set(this.force,0,0),this.emit(o.sleepEvent)},o.prototype.sleepTick=function(t,e,n){if(this.allowSleep&&this.type!==o.SLEEPING){this.wantsToSleep=!1;var r=(this.sleepState,i.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2)),a=Math.pow(this.sleepSpeedLimit,2);r>=a?(this.idleTime=0,this.sleepState=o.AWAKE):(this.idleTime+=n,this.sleepState=o.SLEEPY),this.idleTime>this.sleepTimeLimit&&(e?this.wantsToSleep=!0:this.sleep())}},o.prototype.overlaps=function(t){return this.world.overlapKeeper.bodiesAreOverlapping(this,t)};var B=i.create(),q=i.create();o.prototype.integrate=function(t){var e=this.invMass,o=this.force,n=this.position,r=this.velocity;i.copy(this.previousPosition,this.position),this.previousAngle=this.angle,this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*t),i.scale(B,o,t*e),i.multiply(B,this.massMultiplier,B),i.add(r,B,r),this.integrateToTimeOfImpact(t)||(i.scale(q,r,t),i.add(n,n,q),this.fixedRotation||(this.angle+=this.angularVelocity*t)),this.aabbNeedsUpdate=!0};var P=new a,w=new s({mode:s.ALL}),S=i.create(),C=i.create(),L=i.create(),x=i.create();o.prototype.integrateToTimeOfImpact=function(t){if(this.ccdSpeedThreshold<0||i.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2))return!1;i.normalize(S,this.velocity),i.scale(C,this.velocity,t),i.add(C,C,this.position),i.sub(L,C,this.position);var e,o=this.angularVelocity*t,n=i.length(L),r=1,a=this;if(P.reset(),w.callback=function(t){t.body!==a&&(e=t.body,t.getHitPoint(C,w),i.sub(L,C,a.position),r=i.length(L)/n,t.stop())},i.copy(w.from,this.position),i.copy(w.to,C),w.update(),this.world.raycast(P,w),!e)return!1;var s=this.angle;i.copy(x,this.position);for(var c=0,h=0,l=0,p=r;p>=h&&c<this.ccdIterations;){c++,l=(p-h)/2,i.scale(q,L,r),i.add(this.position,x,q),this.angle=s+o*r,this.updateAABB();var u=this.aabb.overlaps(e.aabb)&&this.world.narrowphase.bodiesOverlap(this,e);u?h=l:p=l}return r=l,i.copy(this.position,x),this.angle=s,i.scale(q,L,r),i.add(this.position,this.position,q),this.fixedRotation||(this.angle+=o*r),!0},o.prototype.getVelocityAtPoint=function(t,e){return i.crossVZ(t,e,this.angularVelocity),i.subtract(t,this.velocity,t),t},o.sleepyEvent={type:"sleepy"},o.sleepEvent={type:"sleep"},o.wakeUpEvent={type:"wakeup"},o.DYNAMIC=1,o.STATIC=2,o.KINEMATIC=4,o.AWAKE=0,o.SLEEPY=1,o.SLEEPING=2},{"../collision/AABB":7,"../collision/Ray":11,"../collision/RaycastResult":12,"../events/EventEmitter":26,"../math/vec2":30,"../shapes/Convex":40,"poly-decomp":5}],32:[function(t,e){function o(t,e,o){o=o||{},n.call(this,t,e,o),this.localAnchorA=i.fromValues(0,0),this.localAnchorB=i.fromValues(0,0),o.localAnchorA&&i.copy(this.localAnchorA,o.localAnchorA),o.localAnchorB&&i.copy(this.localAnchorB,o.localAnchorB),o.worldAnchorA&&this.setWorldAnchorA(o.worldAnchorA),o.worldAnchorB&&this.setWorldAnchorB(o.worldAnchorB);var r=i.create(),a=i.create();this.getWorldAnchorA(r),this.getWorldAnchorB(a);var s=i.distance(r,a);this.restLength="number"==typeof o.restLength?o.restLength:s}var i=t("../math/vec2"),n=t("./Spring");t("../utils/Utils"),e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.setWorldAnchorA=function(t){this.bodyA.toLocalFrame(this.localAnchorA,t)},o.prototype.setWorldAnchorB=function(t){this.bodyB.toLocalFrame(this.localAnchorB,t)},o.prototype.getWorldAnchorA=function(t){this.bodyA.toWorldFrame(t,this.localAnchorA)},o.prototype.getWorldAnchorB=function(t){this.bodyB.toWorldFrame(t,this.localAnchorB)};var r=i.create(),a=i.create(),s=i.create(),c=i.create(),h=i.create(),l=i.create(),p=i.create(),u=i.create(),d=i.create();o.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,o=this.restLength,n=this.bodyA,f=this.bodyB,v=r,y=a,m=s,g=c,A=d,b=h,E=l,B=p,q=u;this.getWorldAnchorA(b),this.getWorldAnchorB(E),i.sub(B,b,n.position),i.sub(q,E,f.position),i.sub(v,E,b);var P=i.len(v);i.normalize(y,v),i.sub(m,f.velocity,n.velocity),i.crossZV(A,f.angularVelocity,q),i.add(m,m,A),i.crossZV(A,n.angularVelocity,B),i.sub(m,m,A),i.scale(g,y,-t*(P-o)-e*i.dot(m,y)),i.sub(n.force,n.force,g),i.add(f.force,f.force,g);var w=i.crossLength(B,g),S=i.crossLength(q,g);n.angularForce-=w,f.angularForce+=S}},{"../math/vec2":30,"../utils/Utils":57,"./Spring":34}],33:[function(t,e){function o(t,e,o){o=o||{},i.call(this,t,e,o),this.restAngle="number"==typeof o.restAngle?o.restAngle:e.angle-t.angle}var i=(t("../math/vec2"),t("./Spring"));e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,o=this.restAngle,i=this.bodyA,n=this.bodyB,r=n.angle-i.angle,a=n.angularVelocity-i.angularVelocity,s=-t*(r-o)-e*a*0;i.angularForce-=s,n.angularForce+=s}},{"../math/vec2":30,"./Spring":34}],34:[function(t,e){function o(t,e,o){o=i.defaults(o,{stiffness:100,damping:1}),this.stiffness=o.stiffness,this.damping=o.damping,this.bodyA=t,this.bodyB=e}var i=(t("../math/vec2"),t("../utils/Utils"));e.exports=o,o.prototype.applyForce=function(){}},{"../math/vec2":30,"../utils/Utils":57}],35:[function(t,e){function o(t,e){e=e||{},this.chassisBody=t,this.wheels=[],this.groundBody=new s({mass:0}),this.world=null;var o=this;this.preStepCallback=function(){o.update()}}function i(t,e){e=e||{},this.vehicle=t,this.forwardEquation=new a(t.chassisBody,t.groundBody),this.sideEquation=new a(t.chassisBody,t.groundBody),this.steerValue=0,this.engineForce=0,this.setSideFriction(void 0!==e.sideFriction?e.sideFriction:5),this.localForwardVector=n.fromValues(0,1),e.localForwardVector&&n.copy(this.localForwardVector,e.localForwardVector),this.localPosition=n.fromValues(0,0),e.localPosition&&n.copy(this.localPosition,e.localPosition),r.apply(this,t.chassisBody,t.groundBody),this.equations.push(this.forwardEquation,this.sideEquation),this.setBrakeForce(0)}var n=t("../math/vec2"),r=(t("../utils/Utils"),t("../constraints/Constraint")),a=t("../equations/FrictionEquation"),s=t("../objects/Body");e.exports=o,o.prototype.addToWorld=function(t){this.world=t,t.addBody(this.groundBody),t.on("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var o=this.wheels[e];t.addConstraint(o)}},o.prototype.removeFromWorld=function(){var t=this.world;t.removeBody(this.groundBody),t.off("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var o=this.wheels[e];t.removeConstraint(o)}this.world=null},o.prototype.addWheel=function(t){var e=new i(this,t);return this.wheels.push(e),e},o.prototype.update=function(){for(var t=0;t<this.wheels.length;t++)this.wheels[t].update()},i.prototype=new r,i.prototype.setBrakeForce=function(t){this.forwardEquation.setSlipForce(t)},i.prototype.setSideFriction=function(t){this.sideEquation.setSlipForce(t)};var c=n.create(),h=n.create();i.prototype.getSpeed=function(){return this.vehicle.chassisBody.vectorToWorldFrame(h,this.localForwardVector),this.vehicle.chassisBody.getVelocityAtPoint(c,h),n.dot(c,h)};var l=n.create();i.prototype.update=function(){this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.t,this.localForwardVector),n.rotate(this.sideEquation.t,this.localForwardVector,Math.PI/2),this.vehicle.chassisBody.vectorToWorldFrame(this.sideEquation.t,this.sideEquation.t),n.rotate(this.forwardEquation.t,this.forwardEquation.t,this.steerValue),n.rotate(this.sideEquation.t,this.sideEquation.t,this.steerValue),this.vehicle.chassisBody.toWorldFrame(this.forwardEquation.contactPointB,this.localPosition),n.copy(this.sideEquation.contactPointB,this.forwardEquation.contactPointB),this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.contactPointA,this.localPosition),n.copy(this.sideEquation.contactPointA,this.forwardEquation.contactPointA),n.normalize(l,this.forwardEquation.t),n.scale(l,l,this.engineForce),this.vehicle.chassisBody.applyForce(l,this.forwardEquation.contactPointA)}},{"../constraints/Constraint":14,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],36:[function(t,e){var o=e.exports={AABB:t("./collision/AABB"),AngleLockEquation:t("./equations/AngleLockEquation"),Body:t("./objects/Body"),Broadphase:t("./collision/Broadphase"),Capsule:t("./shapes/Capsule"),Circle:t("./shapes/Circle"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),ContactEquationPool:t("./utils/ContactEquationPool"),ContactMaterial:t("./material/ContactMaterial"),Convex:t("./shapes/Convex"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventEmitter:t("./events/EventEmitter"),FrictionEquation:t("./equations/FrictionEquation"),FrictionEquationPool:t("./utils/FrictionEquationPool"),GearConstraint:t("./constraints/GearConstraint"),GSSolver:t("./solver/GSSolver"),Heightfield:t("./shapes/Heightfield"),Line:t("./shapes/Line"),LockConstraint:t("./constraints/LockConstraint"),Material:t("./material/Material"),Narrowphase:t("./collision/Narrowphase"),NaiveBroadphase:t("./collision/NaiveBroadphase"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),Pool:t("./utils/Pool"),RevoluteConstraint:t("./constraints/RevoluteConstraint"),PrismaticConstraint:t("./constraints/PrismaticConstraint"),Ray:t("./collision/Ray"),RaycastResult:t("./collision/RaycastResult"),Box:t("./shapes/Box"),RotationalVelocityEquation:t("./equations/RotationalVelocityEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Spring:t("./objects/Spring"),TopDownVehicle:t("./objects/TopDownVehicle"),LinearSpring:t("./objects/LinearSpring"),RotationalSpring:t("./objects/RotationalSpring"),Utils:t("./utils/Utils"),World:t("./world/World"),vec2:t("./math/vec2"),version:t("../package.json").version};Object.defineProperty(o,"Rectangle",{get:function(){return console.warn("The Rectangle class has been renamed to Box."),this.Box}})},{"../package.json":6,"./collision/AABB":7,"./collision/Broadphase":8,"./collision/NaiveBroadphase":9,"./collision/Narrowphase":10,"./collision/Ray":11,"./collision/RaycastResult":12,"./collision/SAPBroadphase":13,"./constraints/Constraint":14,"./constraints/DistanceConstraint":15,"./constraints/GearConstraint":16,"./constraints/LockConstraint":17,"./constraints/PrismaticConstraint":18,"./constraints/RevoluteConstraint":19,"./equations/AngleLockEquation":20,"./equations/ContactEquation":21,"./equations/Equation":22,"./equations/FrictionEquation":23,"./equations/RotationalVelocityEquation":25,"./events/EventEmitter":26,"./material/ContactMaterial":27,"./material/Material":28,"./math/vec2":30,"./objects/Body":31,"./objects/LinearSpring":32,"./objects/RotationalSpring":33,"./objects/Spring":34,"./objects/TopDownVehicle":35,"./shapes/Box":37,"./shapes/Capsule":38,"./shapes/Circle":39,"./shapes/Convex":40,"./shapes/Heightfield":41,"./shapes/Line":42,"./shapes/Particle":43,"./shapes/Plane":44,"./shapes/Shape":45,"./solver/GSSolver":46,"./solver/Solver":47,"./utils/ContactEquationPool":48,"./utils/FrictionEquationPool":49,"./utils/Pool":55,"./utils/Utils":57,"./world/World":61}],37:[function(t,e){function o(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={width:arguments[0],height:arguments[1]},console.warn("The Rectangle has been renamed to Box and its constructor signature has changed. Please use the following format: new Box({ width: 1, height: 1, ... })")),t=t||{};var e=this.width=t.width||1,o=this.height=t.height||1,a=[i.fromValues(-e/2,-o/2),i.fromValues(e/2,-o/2),i.fromValues(e/2,o/2),i.fromValues(-e/2,o/2)],s=[i.fromValues(1,0),i.fromValues(0,1)];t.vertices=a,t.axes=s,t.type=n.BOX,r.call(this,t)}var i=t("../math/vec2"),n=t("./Shape"),r=t("./Convex");e.exports=o,o.prototype=new r,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(t){var e=this.width,o=this.height;return t*(o*o+e*e)/12},o.prototype.updateBoundingRadius=function(){var t=this.width,e=this.height;this.boundingRadius=Math.sqrt(t*t+e*e)/2},i.create(),i.create(),i.create(),i.create(),o.prototype.computeAABB=function(t,e,o){t.setFromPoints(this.vertices,e,o,0)},o.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":30,"./Convex":40,"./Shape":45}],38:[function(t,e){function o(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={length:arguments[0],radius:arguments[1]},console.warn("The Capsule constructor signature has changed. Please use the following format: new Capsule({ radius: 1, length: 1 })")),t=t||{},this.length=t.length||1,this.radius=t.radius||1,t.type=i.CAPSULE,i.call(this,t)}var i=t("./Shape"),n=t("../math/vec2");e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(t){var e=this.radius,o=this.length+e,i=2*e;return t*(i*i+o*o)/12},o.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},o.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var r=n.create();o.prototype.computeAABB=function(t,e,o){var i=this.radius;n.set(r,this.length/2,0),0!==o&&n.rotate(r,r,o),n.set(t.upperBound,Math.max(r[0]+i,-r[0]+i),Math.max(r[1]+i,-r[1]+i)),n.set(t.lowerBound,Math.min(r[0]-i,-r[0]-i),Math.min(r[1]-i,-r[1]-i)),n.add(t.lowerBound,t.lowerBound,e),n.add(t.upperBound,t.upperBound,e)};var a=n.create(),s=n.create(),c=n.create(),h=n.create(),l=n.fromValues(0,1);o.prototype.raycast=function(t,e,o,i){for(var r=e.from,p=e.to,u=(e.direction,a),d=s,f=c,v=h,y=this.length/2,m=0;2>m;m++){var g=this.radius*(2*m-1);n.set(f,-y,g),n.set(v,y,g),n.toGlobalFrame(f,f,o,i),n.toGlobalFrame(v,v,o,i);var A=n.getLineSegmentsIntersectionFraction(r,p,f,v);if(A>=0&&(n.rotate(d,l,i),n.scale(d,d,2*m-1),e.reportIntersection(t,A,d,-1),t.shouldStop(e)))return}for(var b=Math.pow(this.radius,2)+Math.pow(y,2),m=0;2>m;m++){n.set(f,y*(2*m-1),0),n.toGlobalFrame(f,f,o,i);var E=Math.pow(p[0]-r[0],2)+Math.pow(p[1]-r[1],2),B=2*((p[0]-r[0])*(r[0]-f[0])+(p[1]-r[1])*(r[1]-f[1])),q=Math.pow(r[0]-f[0],2)+Math.pow(r[1]-f[1],2)-Math.pow(this.radius,2),A=Math.pow(B,2)-4*E*q;if(!(0>A))if(0===A){if(n.lerp(u,r,p,A),n.squaredDistance(u,o)>b&&(n.sub(d,u,f),n.normalize(d,d),e.reportIntersection(t,A,d,-1),t.shouldStop(e)))return}else{var P=Math.sqrt(A),w=1/(2*E),S=(-B-P)*w,C=(-B+P)*w;if(S>=0&&1>=S&&(n.lerp(u,r,p,S),n.squaredDistance(u,o)>b&&(n.sub(d,u,f),n.normalize(d,d),e.reportIntersection(t,S,d,-1),t.shouldStop(e))))return;if(C>=0&&1>=C&&(n.lerp(u,r,p,C),n.squaredDistance(u,o)>b&&(n.sub(d,u,f),n.normalize(d,d),e.reportIntersection(t,C,d,-1),t.shouldStop(e))))return}}}},{"../math/vec2":30,"./Shape":45}],39:[function(t,e){function o(t){"number"==typeof arguments[0]&&(t={radius:arguments[0]},console.warn("The Circle constructor signature has changed. Please use the following format: new Circle({ radius: 1 })")),t=t||{},this.radius=t.radius||1,t.type=i.CIRCLE,i.call(this,t)}var i=t("./Shape"),n=t("../math/vec2");e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(t){var e=this.radius;return t*e*e/2},o.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},o.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius},o.prototype.computeAABB=function(t,e){var o=this.radius;n.set(t.upperBound,o,o),n.set(t.lowerBound,-o,-o),e&&(n.add(t.lowerBound,t.lowerBound,e),n.add(t.upperBound,t.upperBound,e))};var r=n.create(),a=n.create();o.prototype.raycast=function(t,e,o){var i=e.from,s=e.to,c=this.radius,h=Math.pow(s[0]-i[0],2)+Math.pow(s[1]-i[1],2),l=2*((s[0]-i[0])*(i[0]-o[0])+(s[1]-i[1])*(i[1]-o[1])),p=Math.pow(i[0]-o[0],2)+Math.pow(i[1]-o[1],2)-Math.pow(c,2),u=Math.pow(l,2)-4*h*p,d=r,f=a;if(!(0>u))if(0===u)n.lerp(d,i,s,u),n.sub(f,d,o),n.normalize(f,f),e.reportIntersection(t,u,f,-1);else{var v=Math.sqrt(u),y=1/(2*h),m=(-l-v)*y,g=(-l+v)*y;if(m>=0&&1>=m&&(n.lerp(d,i,s,m),n.sub(f,d,o),n.normalize(f,f),e.reportIntersection(t,m,f,-1),t.shouldStop(e)))return;g>=0&&1>=g&&(n.lerp(d,i,s,g),n.sub(f,d,o),n.normalize(f,f),e.reportIntersection(t,g,f,-1))}}},{"../math/vec2":30,"./Shape":45}],40:[function(t,e){function o(t){Array.isArray(arguments[0])&&(t={vertices:arguments[0],axes:arguments[1]},console.warn("The Convex constructor signature has changed. Please use the following format: new Convex({ vertices: [...], ... })")),t=t||{},this.vertices=[];for(var e=void 0!==t.vertices?t.vertices:[],o=0;o<e.length;o++){var r=n.create();n.copy(r,e[o]),this.vertices.push(r)}if(this.axes=[],t.axes)for(var o=0;o<t.axes.length;o++){var a=n.create();n.copy(a,t.axes[o]),this.axes.push(a)}else for(var o=0;o<this.vertices.length;o++){var s=this.vertices[o],c=this.vertices[(o+1)%this.vertices.length],h=n.create();n.sub(h,c,s),n.rotate90cw(h,h),n.normalize(h,h),this.axes.push(h)}if(this.centerOfMass=n.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,t.type=i.CONVEX,i.call(this,t),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in conter-clockwise winding.")}var i=t("./Shape"),n=t("../math/vec2"),r=t("../math/polyk");t("poly-decomp"),e.exports=o,o.prototype=new i,o.prototype.constructor=o;var a=n.create(),s=n.create();o.prototype.projectOntoLocalAxis=function(t,e){for(var o,i,r=null,s=null,t=a,c=0;c<this.vertices.length;c++)o=this.vertices[c],i=n.dot(o,t),(null===r||i>r)&&(r=i),(null===s||s>i)&&(s=i);if(s>r){var h=s;s=r,r=h}n.set(e,s,r)},o.prototype.projectOntoWorldAxis=function(t,e,o,i){var r=s;this.projectOntoLocalAxis(t,i),0!==o?n.rotate(r,t,o):r=t;var a=n.dot(e,r);n.set(i,i[0]+a,i[1]+a)},o.prototype.updateTriangles=function(){this.triangles.length=0;for(var t=[],e=0;e<this.vertices.length;e++){var o=this.vertices[e];t.push(o[0],o[1])}for(var i=r.Triangulate(t),e=0;e<i.length;e+=3){var n=i[e],a=i[e+1],s=i[e+2];this.triangles.push([n,a,s])}};var c=n.create(),h=n.create(),l=n.create(),p=n.create(),u=n.create();n.create(),n.create(),n.create(),n.create(),o.prototype.updateCenterOfMass=function(){var t=this.triangles,e=this.vertices,i=this.centerOfMass,r=c,a=l,s=p,d=u,f=h;n.set(i,0,0);for(var v=0,y=0;y!==t.length;y++){var m=t[y],a=e[m[0]],s=e[m[1]],d=e[m[2]];n.centroid(r,a,s,d);var g=o.triangleArea(a,s,d);v+=g,n.scale(f,r,g),n.add(i,i,f)}n.scale(i,i,1/v)},o.prototype.computeMomentOfInertia=function(t){for(var e=0,o=0,i=this.vertices.length,r=i-1,a=0;i>a;r=a,a++){var s=this.vertices[r],c=this.vertices[a],h=Math.abs(n.crossLength(s,c)),l=n.dot(c,c)+n.dot(c,s)+n.dot(s,s);e+=h*l,o+=h}return t/6*(e/o)},o.prototype.updateBoundingRadius=function(){for(var t=this.vertices,e=0,o=0;o!==t.length;o++){var i=n.squaredLength(t[o]);i>e&&(e=i)}this.boundingRadius=Math.sqrt(e)},o.triangleArea=function(t,e,o){return.5*((e[0]-t[0])*(o[1]-t[1])-(o[0]-t[0])*(e[1]-t[1]))},o.prototype.updateArea=function(){this.updateTriangles(),this.area=0;for(var t=this.triangles,e=this.vertices,i=0;i!==t.length;i++){var n=t[i],r=e[n[0]],a=e[n[1]],s=e[n[2]],c=o.triangleArea(r,a,s);this.area+=c}},o.prototype.computeAABB=function(t,e,o){t.setFromPoints(this.vertices,e,o,0)};var d=n.create(),f=n.create(),v=n.create();o.prototype.raycast=function(t,e,o,i){var r=d,a=f,s=v,c=this.vertices;n.toLocalFrame(r,e.from,o,i),n.toLocalFrame(a,e.to,o,i);for(var h=c.length,l=0;h>l&&!t.shouldStop(e);l++){var p=c[l],u=c[(l+1)%h],y=n.getLineSegmentsIntersectionFraction(r,a,p,u);y>=0&&(n.sub(s,u,p),n.rotate(s,s,-Math.PI/2+i),n.normalize(s,s),e.reportIntersection(t,y,s,l))}}},{"../math/polyk":29,"../math/vec2":30,"./Shape":45,"poly-decomp":5}],41:[function(t,e){function o(t){if(Array.isArray(arguments[0])){if(t={heights:arguments[0]},"object"==typeof arguments[1])for(var e in arguments[1])t[e]=arguments[1][e];console.warn("The Heightfield constructor signature has changed. Please use the following format: new Heightfield({ heights: [...], ... })")}t=t||{},this.heights=t.heights?t.heights.slice(0):[],this.maxValue=t.maxValue||null,this.minValue=t.minValue||null,this.elementWidth=t.elementWidth||.1,(void 0===t.maxValue||void 0===t.minValue)&&this.updateMaxMinValues(),t.type=i.HEIGHTFIELD,i.call(this,t)}var i=t("./Shape"),n=t("../math/vec2");t("../utils/Utils"),e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.updateMaxMinValues=function(){for(var t=this.heights,e=t[0],o=t[0],i=0;i!==t.length;i++){var n=t[i];n>e&&(e=n),o>n&&(o=n)}this.maxValue=e,this.minValue=o},o.prototype.computeMomentOfInertia=function(){return Number.MAX_VALUE},o.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},o.prototype.updateArea=function(){for(var t=this.heights,e=0,o=0;o<t.length-1;o++)e+=(t[o]+t[o+1])/2*this.elementWidth;this.area=e};var r=[n.create(),n.create(),n.create(),n.create()];o.prototype.computeAABB=function(t,e,o){n.set(r[0],0,this.maxValue),n.set(r[1],this.elementWidth*this.heights.length,this.maxValue),n.set(r[2],this.elementWidth*this.heights.length,this.minValue),n.set(r[3],0,this.minValue),t.setFromPoints(r,e,o)},o.prototype.getLineSegment=function(t,e,o){var i=this.heights,r=this.elementWidth;n.set(t,o*r,i[o]),n.set(e,(o+1)*r,i[o+1])},o.prototype.getSegmentIndex=function(t){return Math.floor(t[0]/this.elementWidth)},o.prototype.getClampedSegmentIndex=function(t){var e=this.getSegmentIndex(t);return e=Math.min(this.heights.length,Math.max(e,0))};var a=(n.create(),n.create()),s=n.create(),c=n.create(),h=n.create(),l=n.create();n.fromValues(0,1),o.prototype.raycast=function(t,e,o,i){var r=e.from,p=e.to,u=(e.direction,a),d=s,f=c,v=h,y=l;n.toLocalFrame(v,r,o,i),n.toLocalFrame(y,p,o,i);var m=this.getClampedSegmentIndex(v),g=this.getClampedSegmentIndex(y);if(m>g){var A=m;m=g,g=A}for(var b=0;b<this.heights.length-1;b++){this.getLineSegment(d,f,b);var E=n.getLineSegmentsIntersectionFraction(v,y,d,f);if(E>=0&&(n.sub(u,f,d),n.rotate(u,u,i+Math.PI/2),n.normalize(u,u),e.reportIntersection(t,E,u,-1),t.shouldStop(e)))return}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],42:[function(t,e){function o(t){"number"==typeof arguments[0]&&(t={length:arguments[0]},console.warn("The Line constructor signature has changed. Please use the following format: new Line({ length: 1, ... })")),t=t||{},this.length=t.length||1,t.type=i.LINE,i.call(this,t)}var i=t("./Shape"),n=t("../math/vec2");e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(t){return t*Math.pow(this.length,2)/12},o.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var r=[n.create(),n.create()];o.prototype.computeAABB=function(t,e,o){var i=this.length/2;n.set(r[0],-i,0),n.set(r[1],i,0),t.setFromPoints(r,e,o,0)};var a=(n.create(),n.create()),s=n.create(),c=n.create(),h=n.fromValues(0,1);o.prototype.raycast=function(t,e,o,i){var r=e.from,l=e.to,p=s,u=c,d=this.length/2;n.set(p,-d,0),n.set(u,d,0),n.toGlobalFrame(p,p,o,i),n.toGlobalFrame(u,u,o,i);var f=n.getLineSegmentsIntersectionFraction(p,u,r,l);if(f>=0){var v=a;n.rotate(v,h,i),e.reportIntersection(t,f,v,-1)}}},{"../math/vec2":30,"./Shape":45}],43:[function(t,e){function o(t){t=t||{},t.type=i.PARTICLE,i.call(this,t)}var i=t("./Shape"),n=t("../math/vec2");e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(){return 0},o.prototype.updateBoundingRadius=function(){this.boundingRadius=0},o.prototype.computeAABB=function(t,e){n.copy(t.lowerBound,e),n.copy(t.upperBound,e)}},{"../math/vec2":30,"./Shape":45}],44:[function(t,e){function o(t){t=t||{},t.type=i.PLANE,i.call(this,t)}var i=t("./Shape"),n=t("../math/vec2");t("../utils/Utils"),e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(){return 0},o.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},o.prototype.computeAABB=function(t,e,o){var i=o%(2*Math.PI),r=n.set,a=Number.MAX_VALUE,s=t.lowerBound,c=t.upperBound;0===i?(r(s,-a,-a),r(c,a,0)):i===Math.PI/2?(r(s,0,-a),r(c,a,a)):i===Math.PI?(r(s,-a,0),r(c,a,a)):i===3*Math.PI/2?(r(s,-a,-a),r(c,0,a)):(r(s,-a,-a),r(c,a,a)),n.add(s,s,e),n.add(c,c,e)},o.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var r=n.create(),a=(n.create(),n.create(),n.create()),s=n.create();o.prototype.raycast=function(t,e,o,i){var c=e.from,h=e.to,l=e.direction,p=r,u=a,d=s;n.set(u,0,1),n.rotate(u,u,i),n.sub(d,c,o);var f=n.dot(d,u);n.sub(d,h,o);var v=n.dot(d,u);if(!(f*v>0||n.squaredDistance(c,h)<f*f)){var y=n.dot(u,l);n.sub(p,c,o);var m=-n.dot(u,p)/y/e.length;e.reportIntersection(t,m,u,-1)}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],45:[function(t,e){function o(t){t=t||{},this.body=null,this.position=i.fromValues(0,0),t.position&&i.copy(this.position,t.position),this.angle=t.angle||0,this.type=t.type||0,this.id=o.idCounter++,this.boundingRadius=0,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:1,this.collisionResponse=void 0!==t.collisionResponse?t.collisionResponse:!0,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:1,this.material=t.material||null,this.area=0,this.sensor=void 0!==t.sensor?t.sensor:!1,this.type&&this.updateBoundingRadius(),this.updateArea()}e.exports=o;var i=t("../math/vec2");o.idCounter=0,o.CIRCLE=1,o.PARTICLE=2,o.PLANE=4,o.CONVEX=8,o.LINE=16,o.BOX=32,Object.defineProperty(o,"RECTANGLE",{get:function(){return console.warn("Shape.RECTANGLE is deprecated, use Shape.BOX instead."),o.BOX}}),o.CAPSULE=64,o.HEIGHTFIELD=128,o.prototype.computeMomentOfInertia=function(){},o.prototype.updateBoundingRadius=function(){},o.prototype.updateArea=function(){},o.prototype.computeAABB=function(){},o.prototype.raycast=function(){}},{"../math/vec2":30}],46:[function(t,e){function o(t){r.call(this,t,r.GS),t=t||{},this.iterations=t.iterations||10,this.tolerance=t.tolerance||1e-7,this.arrayStep=30,this.lambda=new a.ARRAY_TYPE(this.arrayStep),this.Bs=new a.ARRAY_TYPE(this.arrayStep),this.invCs=new a.ARRAY_TYPE(this.arrayStep),this.useZeroRHS=!1,this.frictionIterations=0,this.usedIterations=0}function i(t){for(var e=t.length;e--;)t[e]=0}var n=t("../math/vec2"),r=t("./Solver"),a=t("../utils/Utils"),s=t("../equations/FrictionEquation");e.exports=o,o.prototype=new r,o.prototype.constructor=o,o.prototype.solve=function(t,e){this.sortEquations();var r=0,c=this.iterations,h=this.frictionIterations,l=this.equations,p=l.length,u=Math.pow(this.tolerance*p,2),d=e.bodies,f=e.bodies.length,v=(n.add,n.set,this.useZeroRHS),y=this.lambda;if(this.usedIterations=0,p)for(var m=0;m!==f;m++){var g=d[m];g.updateSolveMassProperties()}y.length<p&&(y=this.lambda=new a.ARRAY_TYPE(p+this.arrayStep),this.Bs=new a.ARRAY_TYPE(p+this.arrayStep),this.invCs=new a.ARRAY_TYPE(p+this.arrayStep)),i(y);
for(var A=this.invCs,b=this.Bs,y=this.lambda,m=0;m!==l.length;m++){var E=l[m];(E.timeStep!==t||E.needsUpdate)&&(E.timeStep=t,E.update()),b[m]=E.computeB(E.a,E.b,t),A[m]=E.computeInvC(E.epsilon)}var E,B,m,q;if(0!==p){for(m=0;m!==f;m++){var g=d[m];g.resetConstraintVelocity()}if(h){for(r=0;r!==h;r++){for(B=0,q=0;q!==p;q++){E=l[q];var P=o.iterateEquation(q,E,E.epsilon,b,A,y,v,t,r);B+=Math.abs(P)}if(this.usedIterations++,u>=B*B)break}for(o.updateMultipliers(l,y,1/t),q=0;q!==p;q++){var w=l[q];if(w instanceof s){for(var S=0,C=0;C!==w.contactEquations.length;C++)S+=w.contactEquations[C].multiplier;S*=w.frictionCoefficient/w.contactEquations.length,w.maxForce=S,w.minForce=-S}}}for(r=0;r!==c;r++){for(B=0,q=0;q!==p;q++){E=l[q];var P=o.iterateEquation(q,E,E.epsilon,b,A,y,v,t,r);B+=Math.abs(P)}if(this.usedIterations++,u>=B*B)break}for(m=0;m!==f;m++)d[m].addConstraintVelocity();o.updateMultipliers(l,y,1/t)}},o.updateMultipliers=function(t,e,o){for(var i=t.length;i--;)t[i].multiplier=e[i]*o},o.iterateEquation=function(t,e,o,i,n,r,a,s){var c=i[t],h=n[t],l=r[t],p=e.computeGWlambda(),u=e.maxForce,d=e.minForce;a&&(c=0);var f=h*(c-p-o*l),v=l+f;return d*s>v?f=d*s-l:v>u*s&&(f=u*s-l),r[t]+=f,e.addToWlambda(f),f}},{"../equations/FrictionEquation":23,"../math/vec2":30,"../utils/Utils":57,"./Solver":47}],47:[function(t,e){function o(t,e){t=t||{},i.call(this),this.type=e,this.equations=[],this.equationSortFunction=t.equationSortFunction||!1}var i=(t("../utils/Utils"),t("../events/EventEmitter"));e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.solve=function(){throw new Error("Solver.solve should be implemented by subclasses!")};var n={bodies:[]};o.prototype.solveIsland=function(t,e){this.removeAllEquations(),e.equations.length&&(this.addEquations(e.equations),n.bodies.length=0,e.getBodies(n.bodies),n.bodies.length&&this.solve(t,n))},o.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},o.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},o.prototype.addEquations=function(t){for(var e=0,o=t.length;e!==o;e++){var i=t[e];i.enabled&&this.equations.push(i)}},o.prototype.removeEquation=function(t){var e=this.equations.indexOf(t);-1!==e&&this.equations.splice(e,1)},o.prototype.removeAllEquations=function(){this.equations.length=0},o.GS=1,o.ISLAND=2},{"../events/EventEmitter":26,"../utils/Utils":57}],48:[function(t,e){function o(){n.apply(this,arguments)}var i=t("../equations/ContactEquation"),n=t("./Pool");e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.create=function(){return new i},o.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},{"../equations/ContactEquation":21,"./Pool":55}],49:[function(t,e){function o(){n.apply(this,arguments)}var i=t("../equations/FrictionEquation"),n=t("./Pool");e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.create=function(){return new i},o.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},{"../equations/FrictionEquation":23,"./Pool":55}],50:[function(t,e){function o(){n.apply(this,arguments)}var i=t("../world/IslandNode"),n=t("./Pool");e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.create=function(){return new i},o.prototype.destroy=function(t){return t.reset(),this}},{"../world/IslandNode":60,"./Pool":55}],51:[function(t,e){function o(){n.apply(this,arguments)}var i=t("../world/Island"),n=t("./Pool");e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.create=function(){return new i},o.prototype.destroy=function(t){return t.reset(),this}},{"../world/Island":58,"./Pool":55}],52:[function(t,e){function o(){this.overlappingShapesLastState=new i,this.overlappingShapesCurrentState=new i,this.recordPool=new n({size:16}),this.tmpDict=new i,this.tmpArray1=[]}var i=t("./TupleDictionary"),n=(t("./OverlapKeeperRecord"),t("./OverlapKeeperRecordPool"));t("./Utils"),e.exports=o,o.prototype.tick=function(){for(var t=this.overlappingShapesLastState,e=this.overlappingShapesCurrentState,o=t.keys.length;o--;){var i=t.keys[o],n=t.getByKey(i);e.getByKey(i),n&&this.recordPool.release(n)}t.reset(),t.copy(e),e.reset()},o.prototype.setOverlapping=function(t,e,o,i){var n=(this.overlappingShapesLastState,this.overlappingShapesCurrentState);if(!n.get(e.id,i.id)){var r=this.recordPool.get();r.set(t,e,o,i),n.set(e.id,i.id,r)}},o.prototype.getNewOverlaps=function(t){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,t)},o.prototype.getEndOverlaps=function(t){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,t)},o.prototype.bodiesAreOverlapping=function(t,e){for(var o=this.overlappingShapesCurrentState,i=o.keys.length;i--;){var n=o.keys[i],r=o.data[n];if(r.bodyA===t&&r.bodyB===e||r.bodyA===e&&r.bodyB===t)return!0}return!1},o.prototype.getDiff=function(t,e,o){var o=o||[],i=t,n=e;o.length=0;for(var r=n.keys.length;r--;){var a=n.keys[r],s=n.data[a];if(!s)throw new Error("Key "+a+" had no data!");var c=i.data[a];c||o.push(s)}return o},o.prototype.isNewOverlap=function(t,e){var o=0|t.id,i=0|e.id,n=this.overlappingShapesLastState,r=this.overlappingShapesCurrentState;return!n.get(o,i)&&!!r.get(o,i)},o.prototype.getNewBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},o.prototype.getEndBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},o.prototype.getBodyDiff=function(t,e){e=e||[];for(var o=this.tmpDict,i=t.length;i--;){var n=t[i];o.set(0|n.bodyA.id,0|n.bodyB.id,n)}for(i=o.keys.length;i--;){var n=o.getByKey(o.keys[i]);n&&e.push(n.bodyA,n.bodyB)}return o.reset(),e}},{"./OverlapKeeperRecord":53,"./OverlapKeeperRecordPool":54,"./TupleDictionary":56,"./Utils":57}],53:[function(t,e){function o(t,e,o,i){this.shapeA=e,this.shapeB=i,this.bodyA=t,this.bodyB=o}e.exports=o,o.prototype.set=function(t,e,i,n){o.call(this,t,e,i,n)}},{}],54:[function(t,e){function o(){n.apply(this,arguments)}var i=t("./OverlapKeeperRecord"),n=t("./Pool");e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.create=function(){return new i},o.prototype.destroy=function(t){return t.bodyA=t.bodyB=t.shapeA=t.shapeB=null,this}},{"./OverlapKeeperRecord":53,"./Pool":55}],55:[function(t,e){function o(t){t=t||{},this.objects=[],void 0!==t.size&&this.resize(t.size)}e.exports=o,o.prototype.resize=function(t){for(var e=this.objects;e.length>t;)e.pop();for(;e.length<t;)e.push(this.create());return this},o.prototype.get=function(){var t=this.objects;return t.length?t.pop():this.create()},o.prototype.release=function(t){return this.destroy(t),this.objects.push(t),this}},{}],56:[function(t,e){function o(){this.data={},this.keys=[]}var i=t("./Utils");e.exports=o,o.prototype.getKey=function(t,e){return t=0|t,e=0|e,(0|t)===(0|e)?-1:0|((0|t)>(0|e)?t<<16|65535&e:e<<16|65535&t)},o.prototype.getByKey=function(t){return t=0|t,this.data[t]},o.prototype.get=function(t,e){return this.data[this.getKey(t,e)]},o.prototype.set=function(t,e,o){if(!o)throw new Error("No data!");var i=this.getKey(t,e);return this.data[i]||this.keys.push(i),this.data[i]=o,i},o.prototype.reset=function(){for(var t=this.data,e=this.keys,o=e.length;o--;)delete t[e[o]];e.length=0},o.prototype.copy=function(t){this.reset(),i.appendArray(this.keys,t.keys);for(var e=t.keys.length;e--;){var o=t.keys[e];this.data[o]=t.data[o]}}},{"./Utils":57}],57:[function(t,e){function o(){}e.exports=o,o.appendArray=function(t,e){if(e.length<15e4)t.push.apply(t,e);else for(var o=0,i=e.length;o!==i;++o)t.push(e[o])},o.splice=function(t,e,o){o=o||1;for(var i=e,n=t.length-o;n>i;i++)t[i]=t[i+o];t.length=n},o.ARRAY_TYPE="undefined"!=typeof P2_ARRAY_TYPE?P2_ARRAY_TYPE:"undefined"!=typeof Float32Array?Float32Array:Array,o.extend=function(t,e){for(var o in e)t[o]=e[o]},o.defaults=function(t,e){t=t||{};for(var o in e)o in t||(t[o]=e[o]);return t}},{}],58:[function(t,e){function o(){this.equations=[],this.bodies=[]}var i=t("../objects/Body");e.exports=o,o.prototype.reset=function(){this.equations.length=this.bodies.length=0};var n=[];o.prototype.getBodies=function(t){var e=t||[],o=this.equations;n.length=0;for(var i=0;i!==o.length;i++){var r=o[i];-1===n.indexOf(r.bodyA.id)&&(e.push(r.bodyA),n.push(r.bodyA.id)),-1===n.indexOf(r.bodyB.id)&&(e.push(r.bodyB),n.push(r.bodyB.id))}return e},o.prototype.wantsToSleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];if(e.type===i.DYNAMIC&&!e.wantsToSleep)return!1}return!0},o.prototype.sleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];e.sleep()}return!0}},{"../objects/Body":31}],59:[function(t,e){function o(){this.nodePool=new i({size:16}),this.islandPool=new n({size:8}),this.equations=[],this.islands=[],this.nodes=[],this.queue=[]}var i=(t("../math/vec2"),t("./Island"),t("./IslandNode"),t("./../utils/IslandNodePool")),n=t("./../utils/IslandPool"),r=t("../objects/Body");e.exports=o,o.getUnvisitedNode=function(t){for(var e=t.length,o=0;o!==e;o++){var i=t[o];if(!i.visited&&i.body.type===r.DYNAMIC)return i}return!1},o.prototype.visit=function(t,e,o){e.push(t.body);for(var i=t.equations.length,n=0;n!==i;n++){var r=t.equations[n];-1===o.indexOf(r)&&o.push(r)}},o.prototype.bfs=function(t,e,i){var n=this.queue;for(n.length=0,n.push(t),t.visited=!0,this.visit(t,e,i);n.length;)for(var a,s=n.pop();a=o.getUnvisitedNode(s.neighbors);)a.visited=!0,this.visit(a,e,i),a.body.type===r.DYNAMIC&&n.push(a)},o.prototype.split=function(t){for(var e=t.bodies,i=this.nodes,n=this.equations;i.length;)this.nodePool.release(i.pop());for(var r=0;r!==e.length;r++){var a=this.nodePool.get();a.body=e[r],i.push(a)}for(var s=0;s!==n.length;s++){var c=n[s],r=e.indexOf(c.bodyA),h=e.indexOf(c.bodyB),l=i[r],p=i[h];l.neighbors.push(p),p.neighbors.push(l),l.equations.push(c),p.equations.push(c)}for(var u=this.islands,r=0;r<u.length;r++)this.islandPool.release(u[r]);u.length=0;for(var d;d=o.getUnvisitedNode(i);){var f=this.islandPool.get();this.bfs(d,f.bodies,f.equations),u.push(f)}return u}},{"../math/vec2":30,"../objects/Body":31,"./../utils/IslandNodePool":50,"./../utils/IslandPool":51,"./Island":58,"./IslandNode":60}],60:[function(t,e){function o(t){this.body=t,this.neighbors=[],this.equations=[],this.visited=!1}e.exports=o,o.prototype.reset=function(){this.equations.length=0,this.neighbors.length=0,this.visited=!1,this.body=null}},{}],61:[function(t,e){function o(t){l.apply(this),t=t||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=t.solver||new i,this.narrowphase=new y(this),this.islandManager=new A,this.gravity=n.fromValues(0,-9.78),t.gravity&&n.copy(this.gravity,t.gravity),this.frictionGravity=n.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.broadphase=t.broadphase||new v,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new u,this.defaultContactMaterial=new d(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.accumulator=0,this.stepping=!1,this.bodiesToBeRemoved=[],this.islandSplit="undefined"!=typeof t.islandSplit?!!t.islandSplit:!0,this.emitImpactEvent=!0,this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.addSpringEvent={type:"addSpring",spring:null},this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},this.postBroadphaseEvent={type:"postBroadphase",pairs:null},this.sleepMode=o.NO_SLEEPING,this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null},this.overlappingShapesLastState={keys:[]},this.overlappingShapesCurrentState={keys:[]},this.overlapKeeper=new g}var i=t("../solver/GSSolver"),n=(t("../solver/Solver"),t("../collision/Ray"),t("../math/vec2")),r=t("../shapes/Circle"),a=t("../shapes/Convex"),s=(t("../shapes/Line"),t("../shapes/Plane")),c=t("../shapes/Capsule"),h=t("../shapes/Particle"),l=t("../events/EventEmitter"),p=t("../objects/Body"),u=(t("../shapes/Shape"),t("../objects/LinearSpring"),t("../material/Material")),d=t("../material/ContactMaterial"),f=(t("../constraints/DistanceConstraint"),t("../constraints/Constraint"),t("../constraints/LockConstraint"),t("../constraints/RevoluteConstraint"),t("../constraints/PrismaticConstraint"),t("../constraints/GearConstraint"),t("../../package.json"),t("../collision/Broadphase"),t("../collision/AABB")),v=t("../collision/SAPBroadphase"),y=t("../collision/Narrowphase"),m=t("../utils/Utils"),g=t("../utils/OverlapKeeper"),A=t("./IslandManager");t("../objects/RotationalSpring"),e.exports=o,o.prototype=new Object(l.prototype),o.prototype.constructor=o,o.NO_SLEEPING=1,o.BODY_SLEEPING=2,o.ISLAND_SLEEPING=4,o.prototype.addConstraint=function(t){this.constraints.push(t)},o.prototype.addContactMaterial=function(t){this.contactMaterials.push(t)},o.prototype.removeContactMaterial=function(t){var e=this.contactMaterials.indexOf(t);-1!==e&&m.splice(this.contactMaterials,e,1)},o.prototype.getContactMaterial=function(t,e){for(var o=this.contactMaterials,i=0,n=o.length;i!==n;i++){var r=o[i];if(r.materialA.id===t.id&&r.materialB.id===e.id||r.materialA.id===e.id&&r.materialB.id===t.id)return r}return!1},o.prototype.removeConstraint=function(t){var e=this.constraints.indexOf(t);-1!==e&&m.splice(this.constraints,e,1)};var b=(n.create(),n.create(),n.create(),n.create(),n.create(),n.create(),n.create()),E=n.fromValues(0,0),B=n.fromValues(0,0);n.fromValues(0,0),n.fromValues(0,0),o.prototype.step=function(t,e,o){if(o=o||10,e=e||0,0===e)this.internalStep(t),this.time+=t;else{this.accumulator+=e;for(var i=0;this.accumulator>=t&&o>i;)this.internalStep(t),this.time+=t,this.accumulator-=t,i++;for(var r=this.accumulator%t/t,a=0;a!==this.bodies.length;a++){var s=this.bodies[a];n.lerp(s.interpolatedPosition,s.previousPosition,s.position,r),s.interpolatedAngle=s.previousAngle+r*(s.angle-s.previousAngle)}}};var q=[];o.prototype.internalStep=function(t){this.stepping=!0;var e=this.springs.length,i=this.springs,r=this.bodies,a=this.gravity,s=this.solver,c=this.bodies.length,h=this.broadphase,l=this.narrowphase,u=this.constraints,d=b,f=(n.scale,n.add),v=(n.rotate,this.islandManager);if(this.overlapKeeper.tick(),this.lastTimeStep=t,this.useWorldGravityAsFrictionGravity){var y=n.length(this.gravity);0===y&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=y)}if(this.applyGravity)for(var g=0;g!==c;g++){var A=r[g],E=A.force;A.type===p.DYNAMIC&&A.sleepState!==p.SLEEPING&&(n.scale(d,a,A.mass*A.gravityScale),f(E,E,d))}if(this.applySpringForces)for(var g=0;g!==e;g++){var B=i[g];B.applyForce()}if(this.applyDamping)for(var g=0;g!==c;g++){var A=r[g];A.type===p.DYNAMIC&&A.applyDamping(t)}for(var P=h.getCollisionPairs(this),w=this.disabledBodyCollisionPairs,g=w.length-2;g>=0;g-=2)for(var S=P.length-2;S>=0;S-=2)(w[g]===P[S]&&w[g+1]===P[S+1]||w[g+1]===P[S]&&w[g]===P[S+1])&&P.splice(S,2);var C=u.length;for(g=0;g!==C;g++){var L=u[g];if(!L.collideConnected)for(var S=P.length-2;S>=0;S-=2)(L.bodyA===P[S]&&L.bodyB===P[S+1]||L.bodyB===P[S]&&L.bodyA===P[S+1])&&P.splice(S,2)}this.postBroadphaseEvent.pairs=P,this.emit(this.postBroadphaseEvent),this.postBroadphaseEvent.pairs=null,l.reset(this);for(var g=0,x=P.length;g!==x;g+=2)for(var F=P[g],M=P[g+1],I=0,R=F.shapes.length;I!==R;I++)for(var V=F.shapes[I],T=V.position,N=V.angle,G=0,O=M.shapes.length;G!==O;G++){var U=M.shapes[G],k=U.position,_=U.angle,D=this.defaultContactMaterial;if(V.material&&U.material){var W=this.getContactMaterial(V.material,U.material);W&&(D=W)}this.runNarrowphase(l,F,V,T,N,M,U,k,_,D,this.frictionGravity)}for(var g=0;g!==c;g++){var X=r[g];X._wakeUpAfterNarrowphase&&(X.wakeUp(),X._wakeUpAfterNarrowphase=!1)}if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(q);for(var j=this.endContactEvent,G=q.length;G--;){var z=q[G];j.shapeA=z.shapeA,j.shapeB=z.shapeB,j.bodyA=z.bodyA,j.bodyB=z.bodyB,this.emit(j)}q.length=0}var Y=this.preSolveEvent;Y.contactEquations=l.contactEquations,Y.frictionEquations=l.frictionEquations,this.emit(Y),Y.contactEquations=Y.frictionEquations=null;var C=u.length;for(g=0;g!==C;g++)u[g].update();if(l.contactEquations.length||l.frictionEquations.length||C)if(this.islandSplit){for(v.equations.length=0,m.appendArray(v.equations,l.contactEquations),m.appendArray(v.equations,l.frictionEquations),g=0;g!==C;g++)m.appendArray(v.equations,u[g].equations);v.split(this);for(var g=0;g!==v.islands.length;g++){var K=v.islands[g];K.equations.length&&s.solveIsland(t,K)}}else{for(s.addEquations(l.contactEquations),s.addEquations(l.frictionEquations),g=0;g!==C;g++)s.addEquations(u[g].equations);this.solveConstraints&&s.solve(t,this),s.removeAllEquations()}for(var g=0;g!==c;g++){var X=r[g];X.integrate(t)}for(var g=0;g!==c;g++)r[g].setZeroForce();if(this.emitImpactEvent&&this.has("impact"))for(var H=this.impactEvent,g=0;g!==l.contactEquations.length;g++){var Z=l.contactEquations[g];Z.firstImpact&&(H.bodyA=Z.bodyA,H.bodyB=Z.bodyB,H.shapeA=Z.shapeA,H.shapeB=Z.shapeB,H.contactEquation=Z,this.emit(H))}if(this.sleepMode===o.BODY_SLEEPING)for(g=0;g!==c;g++)r[g].sleepTick(this.time,!1,t);else if(this.sleepMode===o.ISLAND_SLEEPING&&this.islandSplit){for(g=0;g!==c;g++)r[g].sleepTick(this.time,!0,t);for(var g=0;g<this.islandManager.islands.length;g++){var K=this.islandManager.islands[g];K.wantsToSleep()&&K.sleep()}}this.stepping=!1;for(var J=this.bodiesToBeRemoved,g=0;g!==J.length;g++)this.removeBody(J[g]);J.length=0,this.emit(this.postStepEvent)},o.prototype.runNarrowphase=function(t,e,o,i,r,a,s,c,h,l,u){if(0!==(o.collisionGroup&s.collisionMask)&&0!==(s.collisionGroup&o.collisionMask)){n.rotate(E,i,e.angle),n.rotate(B,c,a.angle),n.add(E,E,e.position),n.add(B,B,a.position);var d=r+e.angle,f=h+a.angle;t.enableFriction=l.friction>0,t.frictionCoefficient=l.friction;var v;v=e.type===p.STATIC||e.type===p.KINEMATIC?a.mass:a.type===p.STATIC||a.type===p.KINEMATIC?e.mass:e.mass*a.mass/(e.mass+a.mass),t.slipForce=l.friction*u*v,t.restitution=l.restitution,t.surfaceVelocity=l.surfaceVelocity,t.frictionStiffness=l.frictionStiffness,t.frictionRelaxation=l.frictionRelaxation,t.stiffness=l.stiffness,t.relaxation=l.relaxation,t.contactSkinSize=l.contactSkinSize,t.enabledEquations=e.collisionResponse&&a.collisionResponse&&o.collisionResponse&&s.collisionResponse;var y=t[o.type|s.type],m=0;if(y){var g=o.sensor||s.sensor,A=t.frictionEquations.length;m=o.type<s.type?y.call(t,e,o,E,d,a,s,B,f,g):y.call(t,a,s,B,f,e,o,E,d,g);var b=t.frictionEquations.length-A;if(m){if(e.allowSleep&&e.type===p.DYNAMIC&&e.sleepState===p.SLEEPING&&a.sleepState===p.AWAKE&&a.type!==p.STATIC){var q=n.squaredLength(a.velocity)+Math.pow(a.angularVelocity,2),P=Math.pow(a.sleepSpeedLimit,2);q>=2*P&&(e._wakeUpAfterNarrowphase=!0)}if(a.allowSleep&&a.type===p.DYNAMIC&&a.sleepState===p.SLEEPING&&e.sleepState===p.AWAKE&&e.type!==p.STATIC){var w=n.squaredLength(e.velocity)+Math.pow(e.angularVelocity,2),S=Math.pow(e.sleepSpeedLimit,2);w>=2*S&&(a._wakeUpAfterNarrowphase=!0)}if(this.overlapKeeper.setOverlapping(e,o,a,s),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(o,s)){var C=this.beginContactEvent;if(C.shapeA=o,C.shapeB=s,C.bodyA=e,C.bodyB=a,C.contactEquations.length=0,"number"==typeof m)for(var L=t.contactEquations.length-m;L<t.contactEquations.length;L++)C.contactEquations.push(t.contactEquations[L]);this.emit(C)}if("number"==typeof m&&b>1)for(var L=t.frictionEquations.length-b;L<t.frictionEquations.length;L++){var x=t.frictionEquations[L];x.setSlipForce(x.getSlipForce()/b)}}}}},o.prototype.addSpring=function(t){this.springs.push(t);var e=this.addSpringEvent;e.spring=t,this.emit(e),e.spring=null},o.prototype.removeSpring=function(t){var e=this.springs.indexOf(t);-1!==e&&m.splice(this.springs,e,1)},o.prototype.addBody=function(t){if(-1===this.bodies.indexOf(t)){this.bodies.push(t),t.world=this;var e=this.addBodyEvent;e.body=t,this.emit(e),e.body=null}},o.prototype.removeBody=function(t){if(this.stepping)this.bodiesToBeRemoved.push(t);else{t.world=null;var e=this.bodies.indexOf(t);-1!==e&&(m.splice(this.bodies,e,1),this.removeBodyEvent.body=t,t.resetConstraintVelocity(),this.emit(this.removeBodyEvent),this.removeBodyEvent.body=null)}},o.prototype.getBodyById=function(t){for(var e=this.bodies,o=0;o<e.length;o++){var i=e[o];if(i.id===t)return i}return!1},o.prototype.disableBodyCollision=function(t,e){this.disabledBodyCollisionPairs.push(t,e)},o.prototype.enableBodyCollision=function(t,e){for(var o=this.disabledBodyCollisionPairs,i=0;i<o.length;i+=2)if(o[i]===t&&o[i+1]===e||o[i+1]===t&&o[i]===e)return void o.splice(i,2)},o.prototype.clear=function(){this.time=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();for(var t=this.constraints,e=t.length-1;e>=0;e--)this.removeConstraint(t[e]);for(var i=this.bodies,e=i.length-1;e>=0;e--)this.removeBody(i[e]);for(var n=this.springs,e=n.length-1;e>=0;e--)this.removeSpring(n[e]);for(var r=this.contactMaterials,e=r.length-1;e>=0;e--)this.removeContactMaterial(r[e]);o.apply(this)};var P=n.create(),w=(n.fromValues(0,0),n.fromValues(0,0));o.prototype.hitTest=function(t,e,o){o=o||0;var i=new p({position:t}),l=new h,u=t,d=0,f=P,v=w;i.addShape(l);for(var y=this.narrowphase,m=[],g=0,A=e.length;g!==A;g++)for(var b=e[g],E=0,B=b.shapes.length;E!==B;E++){var q=b.shapes[E];n.rotate(f,q.position,b.angle),n.add(f,f,b.position);var S=q.angle+b.angle;(q instanceof r&&y.circleParticle(b,q,f,S,i,l,u,d,!0)||q instanceof a&&y.particleConvex(i,l,u,d,b,q,f,S,!0)||q instanceof s&&y.particlePlane(i,l,u,d,b,q,f,S,!0)||q instanceof c&&y.particleCapsule(i,l,u,d,b,q,f,S,!0)||q instanceof h&&n.squaredLength(n.sub(v,f,t))<o*o)&&m.push(b)}return m},o.prototype.setGlobalStiffness=function(t){for(var e=this.constraints,o=0;o!==e.length;o++)for(var i=e[o],n=0;n!==i.equations.length;n++){var r=i.equations[n];r.stiffness=t,r.needsUpdate=!0}for(var a=this.contactMaterials,o=0;o!==a.length;o++){var i=a[o];i.stiffness=i.frictionStiffness=t}var i=this.defaultContactMaterial;i.stiffness=i.frictionStiffness=t},o.prototype.setGlobalRelaxation=function(t){for(var e=0;e!==this.constraints.length;e++)for(var o=this.constraints[e],i=0;i!==o.equations.length;i++){var n=o.equations[i];n.relaxation=t,n.needsUpdate=!0}for(var e=0;e!==this.contactMaterials.length;e++){var o=this.contactMaterials[e];o.relaxation=o.frictionRelaxation=t}var o=this.defaultContactMaterial;o.relaxation=o.frictionRelaxation=t};var S=new f,C=[];o.prototype.raycast=function(t,e){return e.getAABB(S),this.broadphase.aabbQuery(this,S,C),e.intersectBodies(t,C),C.length=0,t.hasHit()}},{"../../package.json":6,"../collision/AABB":7,"../collision/Broadphase":8,"../collision/Narrowphase":10,"../collision/Ray":11,"../collision/SAPBroadphase":13,"../constraints/Constraint":14,"../constraints/DistanceConstraint":15,"../constraints/GearConstraint":16,"../constraints/LockConstraint":17,"../constraints/PrismaticConstraint":18,"../constraints/RevoluteConstraint":19,"../events/EventEmitter":26,"../material/ContactMaterial":27,"../material/Material":28,"../math/vec2":30,"../objects/Body":31,"../objects/LinearSpring":32,"../objects/RotationalSpring":33,"../shapes/Capsule":38,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Line":42,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45,"../solver/GSSolver":46,"../solver/Solver":47,"../utils/OverlapKeeper":52,"../utils/Utils":57,"./IslandManager":59}]},{},[36])(36)});
;/*!libs/main.min.js*/
var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var i=t,a=i.prototype;return a.createView=function(){var e=egret.MainContext.instance.stage.stageWidth,t=egret.MainContext.instance.stage.stageHeight;this.bg=new egret.Shape,this.bg.graphics.beginFill(16767502,1),this.bg.graphics.drawRect(0,0,e,t),this.bg.graphics.endFill(),this.addChild(this.bg),this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=500,this.textField.width=e,this.textField.height=100,this.textField.textColor=0,this.textField.textAlign="center",this.textfield=new egret.TextField,this.addChild(this.textfield),this.textfield.y=532,this.textfield.width=e,this.textfield.height=100,this.textfield.textColor=0,this.textfield.textAlign="center"},a.setProgress=function(e,t){this.textfield.text=""+e+","+(t-e)+"",this.textField.text="..."},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=t,a=i.prototype;return a.onAddToStage=function(){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},a.onConfigComplete=function(){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},a.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},a.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},a.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},a.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},a.createGameScene=function(){this.createGameScene1()},a.createGameScene1=function(){var e=this,t=new egret.DisplayObjectContainer,i=new egret.Shape,a=this.stage.stageWidth,n=this.stage.stageHeight;i.graphics.beginFill(16767502,1),i.graphics.drawRect(0,0,a,n),i.graphics.endFill(),t.addChild(i);var s=this.createBitmapByName("bk-sanshe_png");t.addChild(s);var r=this.createBitmapByName("bk-dian_png");t.addChild(r);var h=this.createBitmapByName("bk-p1_png");t.addChild(h);var o=this.createBitmapByName("left_png"),d=this.createBitmapByName("right_png");o.x=0,o.y=658,t.addChild(o),d.x=a-141,d.y=658,t.addChild(d);var c=this.createBitmapByName("icon-emao_png");t.addChild(c);var l=this.createBitmapByName("btn-lijixiaheishou_png");t.addChild(l),l.x=82,l.y=995,this.addChild(t),l.touchEnabled=!0,l.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){TweenMax.to(t,1,{x:-1e3,y:-1e3,scale:0,appha:0,rotation:-100,ease:Back.easeInOut,onComplete:function(){e.removeChild(t)}}),e.createGameScene2(),e.setChildIndex(t,t.numChildren-1)},this,!0),c.touchEnabled=!0,c.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){window.location.href="http://m.emao.com"},this,!0)},a.createGameScene2=function(){new P2Scene(P2Scene.scene,this.stage)},a.createGameScene3=function(){new P3Scene(P3Scene.scene,this.stage)},a.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},a.startAnimation=function(e){for(var t=this,i=new egret.HtmlTextParser,a=[],n=0;n<e.length;n++)a.push(i.parser(e[n]));var s=t.textfield,r=-1,h=function(){r++,r>=a.length&&(r=0);var e=a[r];t.changeDescription(s,e);var i=egret.Tween.get(s);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(h,t)};h()},a.changeDescription=function(e,t){e.textFlow=t},t}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var P2Scene=function(){function e(t,i){var a=this;this.scene=e.scene,this.bodyType=p2.Body.DYNAMIC,this.world=e.world,this.factor=50,this.stageWidth=egret.MainContext.instance.stage.stageWidth,this.stageHeight=egret.MainContext.instance.stage.stageHeight,this.scoreLabel=new egret.TextField,this.deadlineLabel=new egret.TextField,this.flag=!1,this.container=t,this.stage=i,this.createScene();var n=e.world.bodies.slice();n.forEach(function(t){e.world.removeBody(t)}),e.world.sleepMode=p2.World.BODY_SLEEPING,this.createScore(),this.show(function(){return a.loop()}),this.createDeadline(),this.createGround(),e.stageHeight=egret.MainContext.instance.stage.$stageHeight,e.stageWidth=egret.MainContext.instance.stage.$stageWidth}var t=e,i=t.prototype;return i.createScore=function(){this.container.addChild(this.scoreLabel),this.setScore(e.score=0),this.scoreLabel.x=this.stageWidth-60,this.scoreLabel.y=30,this.scoreLabel.textColor=14685975},i.createDeadline=function(){this.container.addChild(this.deadlineLabel),this.setDeadline(this.deadline=e.TIME),this.deadlineLabel.x=this.stageWidth/2-80,this.deadlineLabel.textColor=16777215,this.deadlineLabel.size=60},i.setScore=function(e){this.scoreLabel.text=""+e},i.setDeadline=function(e){e%60==0?this.deadlineLabel.text="0"+Math.floor(e/60)+":00":(9>=e&&(e="0"+e),this.deadlineLabel.text="00:"+e)},e.getInstance=function(t,i){return e.instance?e.instance:new e(t,i)},i.createDurex=function(e,t,i){var a=this.createBitmapByName(t,i);a.x=Math.random()*this.stageWidth,a.y=Math.random()*(this.stageHeight-1e3);var n=new p2.Body({mass:100,position:[a.x/this.factor*10,(this.stageHeight-a.y)/this.factor],angle:.01*(180*Math.random()-360),velocity:[80*Math.random()-40,40*-Math.random()],angularVelocity:50*Math.random()-25,type:this.bodyType});n.addShape(new p2.Box({width:77/this.factor,height:215/this.factor})),n.userData=a,a.__body=n,a.addEventListener(egret.TouchEvent.TOUCH_TAP,e,{display:a,P2Scene:this}),a.touchEnabled=!0,this.world.addBody(n),this.container.addChild(a)},i.createGround=function(){var e=new p2.Plane({}),t=new p2.Body({mass:0,position:[0,-1e3]});t.addShape(e),this.world.addBody(t)},i.createBitmapByName=function(e,t){var i=new egret.Bitmap,a=RES.getRes(e);return i.texture=a,i.__textureName=e,t&&(i.__anotherTextureName=t),i},i.loop=function(){var t=0,i=this,a=function(){i.flag||(this.display.__body.userData=this.P2Scene.createBitmapByName(this.display.__anotherTextureName),this.P2Scene.container.removeChild(this.display),this.P2Scene.container.addChild(this.display.__body.userData),this.P2Scene.setScore(++e.score))},n=function(t){if(!i.flag){var a=e.world;a.step(t/1e3),egret.MainContext.instance.stage.stageHeight,a.bodies.length,a.bodies.forEach(function(t){var i=t.userData;i&&(i.x=t.position[0]*this.factor/10,i.y=e.stageHeight-t.position[1]*this.factor,i.rotation=t.angle)},this)}},s=egret.Ticker.getInstance();s.register(n,this);var r=new egret.Timer(200,5*e.TIME);r.addEventListener(egret.TimerEvent.TIMER,function(){var i=this.random(1,3);t++,t%5===0&&this.setDeadline(--e.deadline),this.createDurex(a,"tt"+i+"_png","xtt"+i+"_png")},this),r.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(){s.unregister(n,null),this.alert(e.score)},this),r.start()},i.random=function(e,t){var i=t-e,a=Math.random();return e+Math.round(a*i)},i.alert=function(e){var t=this;void 0===e&&(e=0),this.flag=!0;var i=new egret.DisplayObjectContainer;this.dialog=this.createBitmapByName("dialog_png"),i.addChild(this.dialog),this.dialog.x=27,this.dialog.y=370;var a=new egret.TextField;a.text=""+e+"";var n=new egret.TextField;n.text="",a.textAlign="center",n.textAlign="center",a.width=686,n.width=686,a.size=50,n.size=50,a.textColor=0,n.textColor=0,a.y=445,n.y=503,a.x=32,n.x=32,this.btn_queding=this.createBitmapByName("btn-queding_png"),this.btn_queding.y=616,this.btn_queding.x=136,i.addChild(this.btn_queding),this.btn_queding.touchEnabled=!0,this.btn_queding.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){TweenMax.to(i,1,{x:-1e3,y:-1e3,scale:0,opacity:0,rotation:-100,ease:Back.easeInOut,onComplete:function(){new P3Scene(P3Scene.scene,t.stage),P3Scene.scene.x=0,P3Scene.scene.y=0,P3Scene.scene.alpha=1,P3Scene.scene.rotation=0,TweenMax.from(P3Scene.scene,.8,{x:-100,y:-100,scale:.4,alpha:0,rotation:-100,ease:Back.easeInOut,yoyo:!0})}})}),i.addChild(a),i.addChild(n),this.scene.addChild(i),i.x=0,i.y=0,TweenMax.from(i,1,{y:100,alpha:0})},i.createScene=function(){var t=e.scene;t.removeChildren(),t.x=0,t.y=0;var i=this.createBitmapByName("bk-p2_png"),a=this.createBitmapByName("car_png"),n=new egret.Shape,s=[this.createBitmapByName("n3_png"),this.createBitmapByName("n2_png"),this.createBitmapByName("n1_png")],r=s[0],h=s[1],o=s[2];r.x=370,r.y=499,h.x=370,h.y=499,o.x=370,o.y=499,r.anchorOffsetX=43,r.anchorOffsetY=43,h.anchorOffsetX=43,h.anchorOffsetY=43,o.anchorOffsetX=43,o.anchorOffsetY=43,n.graphics.beginFill(0,1),n.graphics.drawRect(0,0,this.stage.width,this.stage.height),n.graphics.endFill(),t.addChild(i),t.addChild(a),t.addChild(n),t.addChild(r),t.addChild(h),t.addChild(o),this.stage.addChild(t),this.stage.setChildIndex(t,t.numChildren-3),this.car=a,this.mask=n,this.djs1=r,this.djs2=h,this.djs3=o},i.show=function(e){var t=this.scene,i=this.car,a=this.mask,n=this.djs1,s=this.djs2,r=this.djs3,h=new TimelineMax({onComplete:function(){e()}});t.anchorOffsetX=this.stage.width/2,t.anchorOffsetY=this.stage.height/2,h.fromTo(t,1,{x:0,y:0,alpha:.1,ease:Back.easeOut,scaleX:9,scaleY:9},{x:0,y:0,alpha:1,ease:Back.easeInOut,scaleX:9,scaleY:9}).fromTo(t,1,{scaleX:9,scaleY:9},{scaleX:1,scaleY:1,anchorOffsetX:0,anchorOffsetY:0}).fromTo(i,1,{x:-400,y:40},{x:0,y:0}).fromTo(a,.2,{alpha:0},{alpha:.7}).staggerFromTo([n,s,r],1,{alpha:0,scaleX:1.6,scaleY:1.6,ease:Power4.easeInOut},{alpha:1,scaleX:.6,scaleY:.6,ease:Power4.easeInOut,onComplete:function(){TweenMax.to(this.target,.2,{alpha:0,onComplete:function(){t.removeChild(this.target)}})}},1)},e.damping=.5,e.gravity=[0,-4],e.world=new p2.World({gravity:e.gravity}),e.scene=new egret.DisplayObjectContainer,e.score=0,e.TIME=30,e.deadline=e.TIME,e}();egret.registerClass(P2Scene,"P2Scene");var P3Scene=function(){function e(e,t){this.cst(e,t),this.init(),this.createView(),this.bindEvent()}var t=e,i=t.prototype;return e.getInstance=function(t,i){return e.instance?e.instance:new e(t,i)},i.cst=function(e,t){this.scene=e,this.stage=t,this.stageWidth=this.stage.stageWidth,this.stageHeight=this.stage.stageHeight},i.init=function(){this.stage.scaleMode=egret.StageScaleMode.EXACT_FIT,this.stage.addChild(this.scene)},i.createView=function(){var e=this.createBitmapByName("bk-sanshe_png"),t=this.createBitmapByName("bk-dian_png"),i=new egret.Shape;i.graphics.beginFill(16767502,1),i.graphics.drawRect(0,0,this.stageWidth,this.stageHeight),i.graphics.endFill(),this.scene.addChild(i),this.scene.addChild(e),this.scene.addChild(t);var a=this.createBitmapByName("xinzhi_png");this.scene.addChild(a),a.y=28,a.x=29;var n=this.createBitmapByName("icon-emao_png");this.scene.addChild(n),n.y=22,n.x=29,this.logo=n;var s=this.createBitmapByName("tts_png");this.scene.addChild(s),s.y=279,s.x=64;var r=this.createBitmapByName("xinfeng_png");this.scene.addChild(r),r.y=866,r.x=0;var h=this.createBitmapByName("btn-1_png");this.scene.addChild(h),h.y=940,h.x=64,this.btn1=h;var o=this.createBitmapByName("btn-2_png");this.scene.addChild(o),o.y=940,o.x=350,this.btn2=o;var d=this.createBitmapByName("btn-3_png");this.scene.addChild(d),d.y=1041,d.x=350,this.btn3=d;var c=this.createBitmapByName("shou--left_png");this.scene.addChild(c),c.y=963,c.x=0;var l=this.createBitmapByName("shou--right_png");this.scene.addChild(l),l.y=963,l.x=639},i.bindEvent=function(){this.btn1.touchEnabled=!0,this.btn1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){btn1()},this),this.btn2.touchEnabled=!0,this.btn2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this;this.stage.removeChildren(),this.stage.addChild(this.scene),P2Scene.deadline=P2Scene.TIME,P2Scene.scene=new egret.DisplayObjectContainer,new P2Scene(P2Scene.scene,this.stage),this.scene.x=0,this.scene.y=0,TweenMax.to(this.scene,.6,{y:0,x:0,rotation:100,alpha:0,onComplete:function(){return e.stage.removeChild(e.scene)},ease:Back.easeInOut})},this),this.btn3.touchEnabled=!0,this.btn3.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){btn3()},this),this.logo.touchEnabled=!0,this.logo.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){window.location.href="http://m.emao.com"},this,!0)},i.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},e.scene=new egret.DisplayObjectContainer,e}();egret.registerClass(P3Scene,"P3Scene");